<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us" dir="ltr">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Step 15: Aggregation Binding Using a Factory Function</title>
      <link rel="icon" href="themes/sap-default/img/favicon.ico" type="image/x-icon">
      <link rel="shortcut icon" href="themes/sap-default/img/favicon.ico">
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="abstract" content="Instead of hard-coding a single template control, we will use a factory function to generate different controls based on the data received at runtime. This approach is much more flexible and allows complex or heterogeneous data to be displayed.">
      
      <meta name="description" content="Instead of hard-coding a single template control, we will use a factory function to generate different controls based on the data received at runtime. This approach is much more flexible and allows complex or heterogeneous data to be displayed.">
      <script type="text/javascript">var d4p = {"relativePath":'',"dev":false,"debug":false,"draft":false,"nextTopicHref":"1b6dcd39a6a74f528b27ddb22f15af0d.html","previousTopicHref":"5cff8d1c3fb84c5db7a00f2daca125af.html"}</script>
      <link rel="stylesheet" type="text/css" media="screen, projection" href="themes/sap-default/css/style.css">
      <script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,

          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,

          // Optional callback... myCallback(i, width)
          callback: doc_resize,

          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  =',
             // medium (size-1, size-2)
            '760px  to 980px  = ',
            '980px  to 1270px = ',
             // large (size-3, size-5)
            '1270px to 1600px = ',
            '1600px to 1940px = ',
             // extra large (size-6)
            '1940px to 2540px = ',
            '2540px           = '
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script>
      <script type="text/javascript" src="toc-info.js"></script>
      <script type="text/javascript" src="themes/sap-default/js/script.js"></script>
      
      		<!--[if lt IE 9]>
      			<script>
      			  var e = ("abbr,article,aside,audio,canvas,datalist,details," +
      			    "figure,footer,header,hgroup,mark,menu,meter,nav,output," +
      			    "progress,section,time,video").split(',');
      			  for (var i = 0; i < e.length; i++) {
      			    document.createElement(e[i]);
      			  }
      			</script>
      		<![endif]-->
      
      <script>
      function addLoadEvent(func) {
      var oldonload = window.onload;
      if (typeof window.onload != 'function') {
      window.onload = func;
      } else {
      window.onload = function() {
      if (oldonload) {
      oldonload();
      }
      func();
      }
      }
      }
      
      addLoadEvent(function() { prettyPrint();
      if ($('#local-navigation').length) {
      $('#local-navigation').navigation();
      }
      
      
      });
      
      </script>
      <script type="text/javascript" src="js/prettify.js"> </script>
      <script id="search-processing" type="text/javascript" src="js/search-processing.js"> </script>
      <link type="text/css" rel="stylesheet" href="css/overrides.css"></head>
   <body class="en-us sap-default centered navigation-default">
      <div id="d4h5-main-container" class="container_12" role="application">
         <ul id="page-links" class="hidden">
            <li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li>
            <li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li>
            <li><a id="skip-to-footer" href="#footer">Skip to footer</a></li>
         </ul>
         
         
         <div id="d4h5-section-container" class="grid_12" style="padding-top: 0;">
            
            
            
            <div id="d4h5-main-content" class="grid_8 alpha omega" style="margin: 0 0.5em;">
               <section>
                  <div id="content-toolbar" class="toolbar hide-for-small">
                     
                     <div class="familylinks">
                        
                        <div class="parentlink"><br>
                           <strong>Parent topic: </strong><a class="link" href="../../#/topic/e5310932a71f42daa41f3a6143efca9c.html" title="In this tutorial, we will explain the concepts of data binding in OpenUI5." target="_top">Data Binding</a><br>
                           
                        </div>
                        
                        <div class="previouslink"><br>
                           <strong>Previous: </strong><a class="link" href="../../#/topic/5cff8d1c3fb84c5db7a00f2daca125af.html" title="Expression binding allows you to display a value on the screen that has been calculated from values found in some model object. This way simple formatting or calculations can be inserted directly into the data binding string. In this example, we will change the color of the price depending on whether it is above or below some arbitrary threshold. The threshold value is also stored in the JSON model." target="_top">Step 14: Expression Binding</a><br>
                           
                        </div>
                        
                     </div>
                     
                  </div>
                  <div class="page concept  - topic-topic concept-concept " id="loio284a036c8ff943238fb65bf5a2676fb7">
                     
                     <h1 class="title topictitle1" hidden>Step 15: Aggregation Binding Using a Factory Function</h1>
                     
                     <div class="body conbody">
                        <p class="shortdesc" hidden>Instead of hard-coding a single template control, we will use a factory function to
                           		generate different controls based on the data received at runtime. This approach is much
                           		more flexible and allows complex or heterogeneous data to be displayed.
                        </p>
                        
                        		
                        <div class="section">
                           <section class="section" type="Preview">
                              <h2 class="section_title" style="font-size: 1.15em;">Preview</h2>
                              			
                              			
                              <div xmlns="http://www.w3.org/1999/xhtml" class="fig fignone" id="loio284a036c8ff943238fb65bf5a2676fb7__fig_r1j_pst_mr">
                                 <div class="figbody">
                                    				
                                    				<img xmlns="" class="inline  " id="loio284a036c8ff943238fb65bf5a2676fb7__image_bkf_ybs_vs" src="loiodb27ba88d80c4778809bdb9b971531f9_HiRes.png">
                                    			
                                 </div><span class="figcap"><span class="enumeration fig-enumeration">Figure 67: </span>Controls generated based on data</span></div>
                              
                              		
                           </section>
                        </div>
                        
                        		
                        <div class="section">
                           <section class="section" type="Coding">
                              <h2 class="section_title" style="font-size: 1.15em;">Coding</h2>
                              			
                              			
                              <p class="p">You can view and download all files in the Demo Kit
                                 <span class="ph">at <a class="xref" href="../../#/sample/sap.ui.core.tutorial.databinding.15/preview" target="_top" alt="#/sample/sap.ui.core.tutorial.databinding.15/preview" title="#/sample/sap.ui.core.tutorial.databinding.15/preview">Data Binding - Step 15</a></span>.
                              </p>
                              
                              		
                           </section>
                        </div>
                        
                        		
                        <div class="section">
                           <section class="section" type="webapp/view/App.view.xml">
                              <h2 class="section_title" style="font-size: 1.15em;">webapp/view/App.view.xml</h2>
                              			
                              			<pre class="pre codeblock prettyprint lang-xml">... 
	&lt;Panel headerText=&quot;{i18n&gt;panel3HeaderText}&quot; class=&quot;sapUiResponsiveMargin&quot; width=&quot;auto&quot;&gt;
		&lt;content&gt;
			<span class="ph emphasis emphasis">&lt;List id=&quot;ProductList&quot; headerText=&quot;{i18n&gt;productListTitle}&quot; items=&quot;{
				path: &apos;products&gt;/Products&apos;,
				factory: &apos;.productListFactory&apos;
			}&quot; /&gt;</span>
		&lt;/content&gt;
	&lt;/Panel&gt;
...</pre>
                              
                              			<p class="p">The <samp class="ph codeph">List</samp> XML element that previously held the product list is now reduced
                                 				simply to a named, but otherwise empty placeholder. Without a factory function to
                                 				populate it, this <samp class="ph codeph">List</samp> would always remain empty.
                              </p>
                              
                              		
                           </section>
                        </div>
                        
                        		
                        <div class="section">
                           <section class="section" type="webapp/controller/App.controller.js">
                              <h2 class="section_title" style="font-size: 1.15em;">webapp/controller/App.controller.js</h2>
                              
                              <pre class="pre codeblock prettyprint lang-js">sap.ui.define([ &quot;sap/ui/core/mvc/Controller&quot;, &quot;sap/ui/model/type/Currency&quot; ],
function(Controller, Currency) {
	&quot;use strict&quot;;
 
	return Controller.extend(&quot;sap.ui.demo.db.controller.App&quot;, {
		formatMail: function(sFirstName, sLastName) {
			var oBundle = this.getView().getModel(&quot;i18n&quot;).getResourceBundle();
			return sap.m.URLHelper.normalizeEmail(
				sFirstName + &quot;.&quot; + sLastName + &quot;@example.com&quot;,
				oBundle.getText(&quot;mailSubject&quot;, [sFirstName]),
				oBundle.getText(&quot;mailBody&quot;));
		},
		formatStockValue : function(fUnitPrice,
				iStockLevel, sCurrCode) {
			var sBrowserLocale = sap.ui.getCore().getConfiguration().getLanguage();
			var oLocale = new sap.ui.core.Locale(sBrowserLocale);
			var oLocaleData = new sap.ui.core.LocaleData(oLocale);
			var oCurrency = new Currency(oLocaleData.mData.currencyFormat);
			return oCurrency.formatValue([fUnitPrice * iStockLevel, sCurrCode ], &quot;string&quot;);
		},
		onItemSelected : function(oEvent) {
			var oSelectedItem = oEvent.getSource();
			var oContext = oSelectedItem.getBindingContext(&quot;products&quot;);
			var sPath = oContext.getPath();
			var oProductDetailPanel = this.byId(&quot;productDetailsPanel&quot;);
			oProductDetailPanel.bindElement({path : sPath, model : &quot;products&quot;});
		}<span class="ph emphasis emphasis">,
		productListFactory : function(sId,oContext) {
			var oUIControl = null;
 
			// Define the item description
			var sDescription = oContext.getProperty(&quot;ProductName&quot;) + &quot; (&quot; + oContext.getProperty(&quot;QuantityPerUnit&quot;) + &quot;)&quot;;
 
			// This item is out of stock and discontinued
			// *and* discontinued?
			if (oContext.getProperty(&quot;UnitsInStock&quot;) === 0 &amp;&amp; oContext.getProperty(&quot;Discontinued&quot;)) {
				// Yup, so use a
				// StandardListItem
				oUIControl = new sap.m.StandardListItem(sId, {
					icon : &quot;sap-icon://warning&quot;,
					title : sDescription,
					info : { path: &quot;i18n&gt;Discontinued&quot; },
					infoState : &quot;Error&quot;
				});
			} else {
				// Nope, so we will create an
				// ObjectListItem
				
				oUIControl = new sap.m.ObjectListItem(sId, {
					title : sDescription,
					number : {
						parts : [ &quot;products&gt;UnitPrice&quot;, &quot;/currencyCode&quot; ],
						type : &quot;sap.ui.model.type.Currency&quot;,
						formatOptions : {
							showMeasure : false
						}
					},
					numberUnit : {
						path : &quot;/currencyCode&quot;
					}
				});
				
				// Is this item out of stock?
				if (oContext.getProperty(&quot;UnitsInStock&quot;) &lt; 1) {
					// Nope, so this item is just temporarily out of stock
					oUIControl.addAttribute(new sap.m.ObjectAttribute({
						text : { path: &quot;i18n&gt;outOfStock&quot; }
					}));
				}
			}
 
			// Set item active (so it is clickable) and attach the press event
			// handler for showing the details
			oUIControl.setType(sap.m.ListType.Active);
			oUIControl.attachPress(this.onItemSelected, this);
			return oUIControl;
		} 
</span>
	});
});</pre>
                              
                              <p class="p">In the <samp class="ph codeph">App</samp> controller, we create a new function called
                                 <samp class="ph codeph">productListFactory</samp>. The types of controls returned from this factory
                                 function must be limited to those suitable for inclusion in the items aggregation of a
                                 <samp class="ph codeph">sap.m.List</samp> object. In this case, we will return either a
                                 <samp class="ph codeph">StandardListItem</samp> or an <samp class="ph codeph">ObjectListItem</samp> using the
                                 following logic:
                              </p>
                              
                              
                              <div class="p">We decide which type of control to return by checking the current stock level and whether or not the product has been discontinued.
                                 This creates the
                                 following possible responses:
                                 <ol class="ol" id="loio284a036c8ff943238fb65bf5a2676fb7__ol_efm_1ds_vs">
                                    
                                    <li class="li">
                                       
                                       <p class="p">First, eliminate the minority case.</p>
                                       
                                       
                                       <p class="p">If the stock level is zero and the product has also been discontinued, then use a <samp class="ph codeph">StandardListItem</samp> with a warning icon and a
                                          <span class="ph uicontrol">Product Discontinued</span> message in the <samp class="ph codeph">status</samp> property. All other possibilities will use an
                                          <samp class="ph codeph">ObjectListItem</samp>.
                                       </p>
                                       
                                       
                                    </li>
                                    
                                    
                                    <li class="li">
                                       
                                       <p class="p">Create an <samp class="ph codeph">ObjectListItem</samp> then for the remaining three possibilities.
                                       </p>
                                       
                                       
                                       <p class="p">The product is in stock and the product has not been discontinued. This is the majority case.</p>
                                       
                                       
                                    </li>
                                    
                                    
                                    <li class="li">
                                       
                                       <p class="p">The stock level is zero, therefore we are temporarily out of stock. In this case, add a single <samp class="ph codeph">ObjectAttribute</samp> that displays the
                                          <span class="ph uicontrol">Out of Stock</span> message.
                                       </p>
                                       
                                       
                                    </li>
                                    
                                    
                                 </ol>
                                 
                              </div>
                              
                              
                           </section>
                        </div>
                        
                        		
                        <div class="section">
                           <section class="section" type="webapp/i18n/i18n.properties">
                              <h2 class="section_title" style="font-size: 1.15em;">webapp/i18n/i18n.properties</h2>
                              			
                              			<pre class="pre codeblock prettyprint lang-prefs">...
# Product Details
...
<span class="ph emphasis emphasis">outOfStock=Out of Stock</span></pre>
                              
                              		</section>
                        </div>
                        
                        		
                        <div class="section">
                           <section class="section" type="webapp/i18n/i18n_de.properties">
                              <h2 class="section_title" style="font-size: 1.15em;">webapp/i18n/i18n_de.properties</h2>
                              			
                              			<pre class="pre codeblock prettyprint lang-prefs">...
# Product Details
...
<span class="ph emphasis emphasis">outOfStock=Nicht Vorr&#xE4;tig</span></pre>
                              
                              			<p class="p">We add the missing texts to the <samp class="ph codeph">properties</samp> files.
                              </p>
                              
                              			
                              <p class="p">That&apos;s all - you completed the Data Binding tutorial!</p>
                              
                              		
                           </section>
                        </div>
                        
                        	
                     </div>
                     
                     <div class="related-links"> 
                        
                        
                        <div class="familylinks">
                           
                           <div class="parentlink"><br>
                              <strong>Parent topic: </strong><a class="link" href="../../#/topic/e5310932a71f42daa41f3a6143efca9c.html" title="In this tutorial, we will explain the concepts of data binding in OpenUI5." target="_top">Data Binding</a><br>
                              
                           </div>
                           
                           <div class="previouslink"><br>
                              <strong>Previous: </strong><a class="link" href="../../#/topic/5cff8d1c3fb84c5db7a00f2daca125af.html" title="Expression binding allows you to display a value on the screen that has been calculated from values found in some model object. This way simple formatting or calculations can be inserted directly into the data binding string. In this example, we will change the color of the price depending on whether it is above or below some arbitrary threshold. The threshold value is also stored in the JSON model." target="_top">Step 14: Expression Binding</a><br>
                              
                           </div>
                           
                        </div>
                        
                        <div class="relinfo">
                           <div class="relinfotitle ">Related Information</div>
                           
                           <div><a class="link" href="../../#/topic/91f057786f4d1014b6dd926db0e91070.html" title="Aggregation binding is used to automatically create child controls according to model data." target="_top">Aggregation Binding</a></div>
                           
                        </div>
                        
                     </div>
                  </div>
                  
               </section>
               <div class="clear"></div>
               
            </div>
            <div class="clearfix"></div>
         </div>
      </div>
      <div class="clearfix"></div>
      <div id="footer-container" class="grid_12">
         <footer>
            	
            <div id="custom-footerSpacer"></div>
            	
            
         </footer>
         
         
      </div>
   </body>
</html>