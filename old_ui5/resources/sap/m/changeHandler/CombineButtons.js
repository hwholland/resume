/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","jquery.sap.global"],function(F,q){"use strict";var C={};C.applyChange=function(c,o,p){if(p.modifier.targets!=="jsControlTree"){throw new Error("Combine buttons change can't be applied on XML tree");}var a=c.getDefinition(),m=p.modifier,v=F.getViewForControl(o),s=m.bySelector(a.content.combineButtonSelectors[0],p.appComponent),A=p.appComponent,P=m.getParent(s),i,b,B,I=sap.ui.getCore().getConfiguration().getRTL(),M,d,e=[],r={menuButtonId:"",parentAggregation:"",insertIndex:0};B=a.content.combineButtonSelectors.map(function(f){return m.bySelector(f,A);});b=B[0].sParentAggregationName;r.parentAggregation=b;i=m.findIndexInParentAggregation(s);r.insertIndex=i;M=m.createControl("sap.m.Menu",p.appComponent,v);B.forEach(function(f,g){var h=v.createId(q.sap.uid()),j=m.getProperty(f,"text");var k=m.createControl("sap.m.MenuItem",p.appComponent,v,h);m.setProperty(k,"text",f.mProperties.text);m.setProperty(k,"icon",f.mProperties.icon);k.attachPress(function(E){return f.firePress(E);});if(j){I?e.unshift(j):e.push(j);}var l=m.createControl("sap.ui.core.CustomData",p.appComponent,v,h+"-originalButtonId");m.setProperty(l,"key","originalButtonId");m.setProperty(l,"value",m.getId(f));m.removeAggregation(P,b,f);m.insertAggregation(k,"dependents",f);m.insertAggregation(k,"customData",l);m.insertAggregation(M,"items",k,g);});d=m.createControl("sap.m.MenuButton",p.appComponent,v,v.createId(q.sap.uid()));r.menuButtonId=m.getId(d);m.setProperty(d,"text",e.join("/"));m.insertAggregation(d,"menu",M,0);m.insertAggregation(P,b,d,i);c.setRevertData(r);return true;};C.revertChange=function(c,o,p){var m=p.modifier,r=c.getRevertData(),a=c.getDefinition(),P=o,s=r.parentAggregation,A=r.insertIndex,M=m.bySelector(r.menuButtonId,p.appComponent),b=a.content.combineButtonSelectors;for(var i=0;i<b.length;i++){var B=m.bySelector(b[i],p.appComponent);m.insertAggregation(P,s,B,A+i);}m.removeAggregation(P,s,M);c.resetRevertData();return true;};C.completeChangeContent=function(c,s,p){var m=p.modifier,a=p.appComponent,o=c.getDefinition(),b=s.combineFieldIds;if(b&&b.length>=2){c.addDependentControl(b,"combinedButtons",p);o.content.combineButtonSelectors=b.map(function(d){return m.getSelector(d,a);});}else{throw new Error("Combine buttons action cannot be completed: oSpecificChangeInfo.combineFieldIds attribute required");}};return C;},true);
