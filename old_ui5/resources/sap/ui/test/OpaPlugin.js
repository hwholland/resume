/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(g){"use strict";var o;if(g.module){o=g.module;g.module=undefined;}sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/core/mvc/View','./matchers/Ancestor','./matchers/Interactable','./matchers/Visible','./pipelines/MatcherPipeline','sap/ui/test/_opaCorePlugin','sap/ui/test/_OpaLogger'],function($,U,V,A,I,a,M,_,b){var m=new M(),i=new I(),v=new a(),c=["id","viewName","controlType","searchOpenDialogs"];var O=U.extend("sap.ui.test.OpaPlugin",{constructor:function(){this._oLogger=b.getLogger("sap.ui.test.Opa5");},getAllControls:function(C,s){var d=_.getAllControls(C);this._oLogger.debug("Found "+d.length+" controls"+(C?" of type '"+(s||C)+"'":"")+" in page");return d;},getView:function(s){var d=this.getAllControls(V,"View");return d.filter(function(e){return e.getViewName()===s;})[0];},getControlInView:function(d){var s=(d.viewNamespace||"")+"."+(d.viewName||""),e=s.replace(/\.+/g,'.').replace(/^\.|\.$/g,""),f=this.getView(e),S=typeof d.id==="string";if(!f){this._oLogger.debug("Found no view with the name: '"+e+"'");return S?null:[];}if($.isArray(d.id)){var C=[];var u=[];$.each(d.id,function(p,q){var j=f.byId(q);if(j){C.push(j);}else{u.push(q);}});var h=u.length?". Found no controls matching the subset of IDs "+u:"";this._oLogger.debug("Found "+C.length+" controls with ID contained in "+d.id+" in view '"+e+"'"+h);return C;}if(S){var j=f.byId(d.id)||null;this._oLogger.debug("Found "+(j?"":"no ")+"control with ID '"+d.id+"' in view '"+e+"'");return j;}var k=this.getAllControlsWithTheParent(f,d.controlType,d.sOriginalControlType);var l=$.type(d.id)==="regexp";if(l){var n=f.getId();k=k.filter(function(j){var p=j.getId().replace(n,"");return d.id.test(p);});}this._oLogger.debug("Found "+k.length+" controls of type "+d.sOriginalControlType+(l?" with ID matching "+d.id:"")+" in view '"+e+"'");return k;},getAllControlsWithTheParent:function(p,C,s){var d=new A(p);return this._filterUniqueControlsByCondition(this.getAllControls(C,s),d);},getAllControlsInContainer:function(C,f,s,d){var e=this._filterUniqueControlsByCondition(C.find("*").control(),function(h){return _.checkControlType(h,f);});this._oLogger.debug("Found "+e.length+" controls in "+(d?d:"container")+" with controlType '"+s+"'");return e;},getMatchingControls:function(d){var r=null;d=d||{};var h=this._modifyControlType(d);if(!h){return typeof d.id==="string"?r:[];}if(d.searchOpenDialogs){r=this.getAllControlsInContainer($("#sap-ui-static"),d.controlType,d.sOriginalControlType,"the static UI area");}else if(d.viewName){r=this.getControlInView(d);}else if(d.id){r=this.getControlByGlobalId(d);}else if(d.controlType){r=this.getAllControls(d.controlType,d.sOriginalControlType);}else{r=this.getAllControls();}if(!r||d.visible===false){return r;}var e=[];if(d.interactable){e.push(i);}else{e.push(v);}var p=m.process({control:r,matchers:e});if(!p){if($.isArray(r)){return[];}if(r){return null;}return r;}return p;},_getFilteredControls:function(d){var p=this._isLookingForAControl(d);var C=null;var r=null;if(p){C=this.getMatchingControls(d);}var e=[typeof d.id==="string"&&!C,!d.id&&(d.viewName||d.searchOpenDialogs)&&!C.length,$.type(d.id)==="regexp"&&!C.length,$.isArray(d.id)&&(!C||C.length!==d.id.length),d.controlType&&$.isArray(C)&&!C.length];if(e.some(Boolean)){return O.FILTER_FOUND_NO_CONTROLS;}if((C||!p)&&d.matchers){r=m.process({matchers:d.matchers,control:C});if(!r){return O.FILTER_FOUND_NO_CONTROLS;}}else{r=C;}return r;},getControlByGlobalId:function(d){var C=_.getCoreElements();if(typeof d.id==="string"){var e=C[d.id]||null;if(e&&!_.checkControlType(e,d.controlType)){this._oLogger.error("A control with global ID '"+d.id+"' is found but does not have required controlType '"+d.sOriginalControlType+"'. Found control is '"+e+"' but null is returned instead");return null;}this._oLogger.debug("Found "+(e?"":"no ")+"control with the global ID '"+d.id+"'");return e;}var f=[];var h=$.type(d.id)==="regexp";if(h){for(var p in C){if(!C.hasOwnProperty(p)||!d.id.test(p)){continue;}f.push(p);}}else if($.isArray(d.id)){f=d.id;}var j=[];var u=[];f.forEach(function(k){var e=C[k];if(e&&_.checkControlType(e,d.controlType)&&!e.bIsDestroyed){j.push(e);}else{u.push(k);}});var s=!h&&u.length?". Found no controls of matching the subset of IDs "+u:"";this._oLogger.debug("Found "+j.length+" controls of type "+d.sOriginalControlType+(h?" with ID matching '":" with ID contained in '")+d.id+s);return j;},getControlConstructor:function(C){if(sap.ui.lazyRequire._isStub(C)){this._oLogger.debug("The control type "+C+" is currently a lazy stub.");return null;}var f=$.sap.getObject(C);if(!f){this._oLogger.debug("The control type "+C+" is undefined.");return null;}return f;},_isLookingForAControl:function(d){return Object.keys(d).some(function(k){return c.indexOf(k)!==-1&&!!d[k];});},_filterUniqueControlsByCondition:function(C,f){return C.filter(function(d,p,e){var k=!!f(d);return k&&e.indexOf(d)===p;});},_modifyControlType:function(d){var C=d.controlType;if(typeof C!=="string"){if(C&&C._sapUiLazyLoader){this._oLogger.debug("The control type is currently a lazy stub");return false;}return true;}var f=this.getControlConstructor(C);if(!f){return false;}d.sOriginalControlType=C;d.controlType=f;return true;}});O.FILTER_FOUND_NO_CONTROLS="FILTER_FOUND_NO_CONTROL";return O;});if(o){g.module=o;}})(window);
