(function(){"use strict";var d={onBeforeRendering:function(e){this.itemOnBeforeRendering(e);}};var D={onAfterRendering:function(e){this.itemOnAfterRendering(e);}};sap.ui.controller("sap.ovp.cards.linklist.LinkList",{onInit:function(){jQuery.sap.log.setLevel(jQuery.sap.log.Level.INFO);this._bInitialLoad=true;this._iColumns=0;},onBeforeRendering:function(e){var c=this.getCardPropertiesModel();var v=this.getView();if(c.getProperty("/listFlavor")==="standard"){var l=v.byId("ovpCLI");if(l){l.addEventDelegate(d,this);}}},onAfterRendering:function(e){var v=this.getView();var c=this.getCardPropertiesModel();var r=c.getProperty("/cardLayout/rowSpan");var C=c.getProperty("/cardLayout/colSpan");switch(c.getProperty("/listFlavor")){case"standard":if(c.getProperty("/staticContent")){if(C&&r){this._itemOnEventBuildStandard(v,c,C,r,true);}else{this._aLinkListIds=["ovpLinkList"];this._setListColumnWidthInStandardCard(v,1);}}break;case"carousel":if(r){this._setListHeightInCarouselCard(v,r);}var o=v.byId("pictureCarousel");o.addEventDelegate(D,this);this._setCarouselImageProperties(v);break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},itemOnBeforeRendering:function(e){var c=this.getCardPropertiesModel();var v=this.getView();switch(c.getProperty("/listFlavor")){case"standard":var r=c.getProperty("/cardLayout/rowSpan");var C=c.getProperty("/cardLayout/colSpan");var l=v.byId("ovpLinkList");var L=l.getItems();for(var j=0;j<L.length;j++){L[j].removeEventDelegate(d);}if(this._bInitialLoad){this._itemOnEventBuildStandard(v,c,C,r,true);}else{this._itemOnEventBuildStandard(v,c,C,r,false);}break;case"carousel":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},itemOnAfterRendering:function(E){var c=this.getCardPropertiesModel();var r=c.getProperty("/cardLayout/rowSpan");var C=c.getProperty("/cardLayout/colSpan");var v=this.getView();switch(c.getProperty("/listFlavor")){case"standard":try{var l=v.byId("ovpLinkList");var L=l.getItems(this._aLinkListIds[this._aLinkListIds.length-1]);L[L.length-1].removeEventDelegate(D);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event at the last item of the last list");}if(r){this._setListHeightInStandardCard(v,r);}if(C){this._setListColumnWidthInStandardCard(v,C);}else{this._setListColumnWidthInStandardCard(v,1);}break;case"carousel":try{var o=v.byId("pictureCarousel");o.removeEventDelegate(D);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event on the carousel");}if(r){this._setListHeightInCarouselCard(v,r);}this._setCarouselImageProperties(v);break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},_itemOnEventBuildStandard:function(v,c,C,r,I){var p;var l=v.byId("ovpLinkList");if(I&&this._oListRest===undefined){this._oListRest=new sap.m.List(v.getId()+"--RestOfData",{});}this._aLinkListIds=["ovpLinkList"];this._iAvailableItems=l.getItems().length;var a=c.getProperty("/cardLayout/items");if(a!==undefined){this._iNoOfItemsPerColumn=a;p=a;this._iVisibleColums=1;}else{var b=72;try{b=this._getLinkListItemHigh();}catch(e){jQuery.sap.log.info("Error: "+e);}var L=this._getListHeightInStandardCard(v,r);this._iNoOfItemsPerColumn=Math.floor(L/b);var n=Math.ceil(this._iAvailableItems/this._iNoOfItemsPerColumn);this._iVisibleColums=Math.min(n,C);p=this._iVisibleColums*this._iNoOfItemsPerColumn;}if(p>this._iAvailableItems){p=this._iAvailableItems;}else{for(var i=p;i<this._iAvailableItems;i++){this._oListRest.addItem(l.getItems()[p]);}}if(this._iVisibleColums>1){var o=v.byId("ovpListRow");var f=this._iNoOfItemsPerColumn;var g=0;for(var j=this._iNoOfItemsPerColumn;j<p;j++){if(f>=this._iNoOfItemsPerColumn){f=0;g++;var s="ovpLinkList"+g;var N=new sap.m.List(v.getId()+"--"+s,{showSeparators:l.getProperty("showSeparators")});this._aLinkListIds.push(s);if(l.hasStyleClass("_iNoOfItemsPerColumnPaddingCozy")){N.addStyleClass("sapOvpLinkListStandardPaddingCozy");}else{N.addStyleClass("sapOvpLinkListStandardPaddingCompact");}o.addItem(N);}N.addItem(l.getItems()[this._iNoOfItemsPerColumn]);f++;}var h=N.getItems();h[h.length-1].addEventDelegate(D,this);}else{if(I){this.itemOnAfterRendering(null);}else{var k=l.getItems();k[k.length-1].addEventDelegate(D,this);}}},resizeCard:function(n){var c=this.getCardPropertiesModel();switch(c.getProperty("/listFlavor")){case"standard":this._resizeStandard(n);break;case"carousel":this._resizeCarousel(n);break;case"grid":this._resizeGrid(n);break;}},_resizeStandard:function(n){var v=this.getView();var l=this.byId(this._aLinkListIds[0]);for(var i=1;i<this._aLinkListIds.length;i++){var L=v.byId(this._aLinkListIds[i]);var a=L.getItems().length;for(var j=0;j<a;j++){l.addItem(L.getItems()[0]);}L.destroy();}var r=this._oListRest.getItems().length;try{for(var k=0;k<r;k++){l.addItem(this._oListRest.getItems()[0]);}}catch(e){jQuery.sap.log.info("Error: "+e);}var c=this.getCardPropertiesModel();c.setProperty("/cardLayout/rowSpan",n.rowSpan);c.setProperty("/cardLayout/colSpan",n.colSpan);var b=l.getBindingInfo("items");var I=this._getLinkListItemHigh();var N=this._getListHeightInStandardCard(v,n.rowSpan);var f=Math.floor(N/I)*n.colSpan;this._bInitialLoad=false;if(b){if(f>this._iAvailableItems&&b.length<=this._iAvailableItems){b.length=f;l.bindItems(b);}else{this._itemOnEventBuildStandard(v,c,n.colSpan,n.rowSpan,false);}}else{this._itemOnEventBuildStandard(v,c,n.colSpan,n.rowSpan,false);}},_resizeCarousel:function(n){var v=this.getView();var c=v.byId("pictureCarousel");var C=this.getCardPropertiesModel();C.setProperty("/cardLayout/rowSpan",n.rowSpan);c.next();c.previous();this._setListHeightInCarouselCard(v,n.rowSpan);this._setCarouselImageProperties(v);},_resizeGrid:function(n){var g=this.getView().byId("ovpLinkListGrid");var o=parseInt(this.getView().byId("idColSpan").getValue(),10);var N=n.colSpan;if(n.colSpan>5){N=5;}this.getView().byId("idColSpan").setValue(N);if(N!==o){var s="sapOvpCardLinkListGridColSpan"+o;g.removeStyleClass(s);var S="sapOvpCardLinkListGridColSpan"+N;g.addStyleClass(S);}var a=n.rowSpan*n.colSpan*2;var b=g.getBindingInfo("items");var I=g.getItems();if(a>I.length){b.length=a;g.bindItems(b);}else if(a<I.length){var r=I.length-a;var l=I.length-1;for(var i=0;i<r;i++){var c=l-i;g.removeItem(c);}}},_setListHeightInCarouselCard:function(v,r){var c=0;if(r){var h=0;var H=v.byId("ovpCardHeader");if(H){h=H.$().height();}var C=this.getCardPropertiesModel();var R=C.getProperty("/cardLayout/iRowHeigthPx");c=(r*R)-(h+27+8);var o=v.byId("pictureCarousel");o.$().height(c);}},_setCarouselImageProperties:function(v){var c=this.getCardPropertiesModel();var r=c.getProperty("/cardLayout/rowSpan");var C=c.getProperty("/cardLayout/colSpan");if(r&&C){var o=v.byId("pictureCarousel"),a=v.byId("ovpCardHeader"),i=null,p=null,I,s;if(o.getPages().length===1&&a){p=sap.ui.getCore().byId(o.getActivePage());if(p&&p.getItems()[p.getItems().length-1]instanceof sap.m.Image){i=p.getItems()[p.getItems().length-1];if(p.getItems().length===1){I=o.$().height();}else{I=o.$().height()-p.getItems()[0].$().outerHeight();}if(I){I=I+"px";i.setHeight(I);}s=a.$().outerWidth();if(s){s=s+"px";i.setWidth(s);}i.setMode(sap.m.ImageMode.Background);i.setBackgroundPosition("center center");}}}},_setListHeightInStandardCard:function(v,r){var n=0;var l;var o;jQuery.sap.log.info("TEST: "+this._aLinkListIds.toString());for(var i=0;i<this._aLinkListIds.length;i++){l=v.byId(this._aLinkListIds[i]);jQuery.sap.log.info("TEST: "+i.toString());jQuery.sap.log.info("TEST: "+this._aLinkListIds[i].toString());o=l.$().parent();n=this._getListHeightInStandardCard(v,r);o.height(n);}},_getListHeightInStandardCard:function(v,r){var l=0;var c=this.getCardPropertiesModel();if(r){var h=0;var H=v.byId("ovpCardHeader");if(H){h=H.$().height();}var R=c.getProperty("/cardLayout/iRowHeigthPx");l=(r*R)-(8+h+8+8+8);}return l;},_setListColumnWidthInStandardCard:function(v,c){var l;var o;var C="100%";if(this._aLinkListIds.length>1){for(var j=0;j<this._aLinkListIds.length;j++){l=v.byId(this._aLinkListIds[j]);o=l.$().parent();C=(100/c)+"%";o.width(C);}}else{l=v.byId(this._aLinkListIds[0]);if(l){o=l.$().parent();o.width(C);}}},_getLinkListItemHigh:function(l){var L=(l)?l:"ovpLinkList";var c=this.getCardPropertiesModel(),v=this.getView(),o=v.byId(L),i=72,p="",t=false,s=false,n=1,a=c.getProperty("/densityStyle"),T=0,S=0;var b=o.getItems();for(var j=0;j<b.length;j++){try{var P=b[j].getAggregation("content")[0].getAggregation("items")[0].getAggregation("items")[0].getAggregation("items")[0].getProperty("src");if(P.length>0){if(P.toLowerCase().indexOf("icon")>0){p="icon";}else{p="image";}T=1;break;}}catch(e){jQuery.sap.log.info("Item:"+j+" doesn´t contain a image");}}if(p.length>0){n=2;}else{try{var f=o.getItems()[0].getAggregation("content")[0].getAggregation("items")[T].getAggregation("items")[0].getProperty("text");t=f.length>0;S=1;}catch(e){jQuery.sap.log.info("Item doesn´t contain a title");}try{var g=o.getItems()[0].getAggregation("content")[0].getAggregation("items")[T].getAggregation("items")[S].getProperty("text");s=g.length>0;}catch(e){jQuery.sap.log.info("Item doesn´t contain a subTitle");}if(t===true&&s===true){n=2;}}if(a==="cozy"){i=72;if(n===1){i=p!=="image"?40:56;}}else{i=60;if(n===1){i=48;}}return i;},onLinkListItemPressLocalData:function(e){var t=e.getSource().data("targetUri");var i=e.getSource().data("openInNewWindow");var b=this.getView().getModel("ovpCardProperties").getProperty("/baseUrl");t=this.buildUrl(b,t);if(i==="true"){window.open(t);}else{window.location.href=t;}},onLinkListActionPressLocalData:function(e){var a=e.getSource().data("dataAction");this.getView().getModel().callFunction(a,{method:"POST",urlParameters:{FunctionImport:a},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});},onFuImpSuccess:function(e){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Success"),{duration:3000});},onFuImpFailed:function(r){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Error"),{duration:3000});},onLinkListItemPress:function(e){var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0]);},onLinkPopover:function(e){var p;switch(this.getCardPropertiesModel().getProperty("/listFlavor")){case"grid":p=e.getSource().getParent().getParent().getParent().getParent().getParent().getAggregation("items")[1].getAggregation("items")[1];break;case"standard":p=this.getView().byId("ovpListRow").getParent().getAggregation("items")[2];if(!p){p=this.getView().byId("ovpListRow").getParent().getAggregation("items")[1];}break;case"carousel":if(e.getParameter("id").indexOf("link")>0){p=e.getSource().getParent().getParent().getParent().getParent().getAggregation("items")[1];}else{p=e.getSource().getParent().getParent().getParent().getAggregation("items")[1];}break;}p.bindElement(e.getSource().getBindingContext().getPath());p.openBy(e.getSource());},onLinkNavigationSingleTarget:function(e){var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),"com.sap.vocabularies.UI.v1.Identification");this.doNavigation(e.getSource().getBindingContext(),n[0]);},onLinkNavigation:function(e){if(sap.ushell.Container.getService("CrossApplicationNavigation")){var b=e.getSource().getBindingContext();if(b.getProperty("SemanticObject")){var n={target:{semanticObject:b.getProperty("SemanticObject"),action:b.getProperty("SemanticAction")}};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(n);}}},buildUrl:function(b,m){if(m.startsWith(b)||m.indexOf("://")>0){return m;}else if(m.startsWith("/")){return b+m;}else{return b+"/"+m;}},onLinkListActionPress:function(e){var a=e.getSource().data("dataAction");this.getView().getModel().callFunction(a,{method:"POST",urlParameters:{FunctionImport:a},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});},onLinkListSemanticObjectPressLocalData:function(e){var s=this.getCardPropertiesModel().getProperty("/staticContent");var r=parseInt(e.getSource().data("contentRowIndex"),10);var n={target:{semanticObject:s[r].semanticObject,action:s[r].action},params:s[r].params};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(n);}});})();
