// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.flp.ActionMode");var A=function(){this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe('launchpad','actionModeInactive',this.scrollToViewPoint,this);this.oEventBus.subscribe('launchpad','actionModeActive',this.scrollToViewPoint,this);this.viewPoint=undefined;this.init=function(m){this.oModel=m;};};A.prototype.activate=function(){var f,t;jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(sap.ushell.resources.i18n.getText("actionModeActivated"),{duration:4000});this.oModel.setProperty('/tileActionModeActive',true);this.aOrigHiddenGroupsIds=sap.ushell.utils.getCurrentHiddenGroupIds(this.oModel);f=sap.ui.getCore().byId("floatingActionBtn");if(f){f.addStyleClass("sapUshellActive");f.setTooltip(sap.ushell.resources.i18n.getText("deactivateActionMode"));}t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setText(sap.ushell.resources.i18n.getText("exitPersonalizationMode"));}this.oEventBus.publish('launchpad','actionModeActive');};A.prototype.scrollToViewPoint=function(){window.setTimeout(jQuery.proxy(this.oEventBus.publish,this.oEventBus,"launchpad","scrollToFirstVisibleGroup",this.viewPoint),0);};A.prototype.deactivate=function(){var t=sap.ui.getCore().byId("TileActions"),T,f;this.oModel.setProperty('/tileActionModeActive',false);this.oEventBus.publish("launchpad",'actionModeInactive',this.aOrigHiddenGroupsIds);if(t!==undefined){t.destroy();}f=sap.ui.getCore().byId("floatingActionBtn");if(f){f.removeStyleClass("sapUshellActive");f.setTooltip(sap.ushell.resources.i18n.getText("activateActionMode"));}T=sap.ui.getCore().byId("ActionModeBtn");if(T){T.setTooltip(sap.ushell.resources.i18n.getText("activateActionMode"));T.setText(sap.ushell.resources.i18n.getText("activateActionMode"));}};A.prototype.toggleActionMode=function(m,s,d){var t=m.getProperty('/tileActionModeActive');var c=m.getProperty('/topGroupInViewPortIndex');if(!d){d=[];}var v=d.filter(function(b){return b.getVisible();});var a=v[c];if(a){var e=t?-49:49;var g=document.getElementById("sapUshellDashboardPage-cont").scrollTop-a.getDomRef().offsetTop;this.viewPoint={group:v[c],fromTop:g+e};}else{this.viewPoint={fromTop:0};}if(t){this.deactivate();}else{this.activate();}};A.prototype.activateGroupEditMode=function(g){var j=jQuery(g.getDomRef()).find('.sapUshellTileContainerContent');j.addClass("sapUshellTileContainerEditMode");};A.prototype._openActionsMenu=function(e,t){var a=this,T=t||e.getSource(),l=sap.ushell.Container.getService("LaunchPage"),b=[],o=sap.ui.getCore().byId("TileActions"),i,n,B,c,d,h,f,g;if(T){d=T.getBindingContext().getObject().object;b=l.getTileActions(d);}a.oTileControl=T;jQuery(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");f=jQuery(e.getSource().getDomRef()).find(".sapUshellTileActionLayerDiv");f.addClass("sapUshellTileActionLayerDivSelected");if(o===undefined){o=new sap.m.ActionSheet("TileActions",{placement:sap.m.PlacementType.Auto,afterClose:function(){$(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var E=sap.ui.getCore().getEventBus();E.publish("dashboard","actionSheetClose",a.oTileControl);}});}else{o.destroyButtons();}if(b.length===0||T.oParent.getProperty("isGroupLocked")){n=new sap.m.Button({text:sap.ushell.resources.i18n.getText("tileHasNoActions"),enabled:false});o.addButton(n);}else{for(i=0;i<b.length;i++){c=b[i];h=function(c){return function(){a._handleActionPress(c);};}(c);B=new sap.m.Button({text:c.text,icon:c.icon,press:h});o.addButton(B);}}g=e.getSource().getActionSheetIcon();if(g){o.openBy(g);}else{o.openBy(e.getSource());}};A.prototype._handleActionPress=function(a){if(a.press){a.press.call();}else if(a.targetURL){if(a.targetURL.indexOf("#")===0){hasher.setHash(a.targetURL);}else{window.open(a.targetURL,'_blank');}}else{sap.m.MessageToast.show("No Action");}};sap.ushell.components.flp.ActionMode=new A();}());
