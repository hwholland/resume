/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
jQuery.sap.declare("sap.ushell.ui.footerbar.HideGroupsButton");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.ushell.ui.launchpad.ActionItem");sap.ushell.ui.launchpad.ActionItem.extend("sap.ushell.ui.footerbar.HideGroupsButton",{metadata:{library:"sap.ushell",events:{"save":{}}}});sap.ushell.ui.footerbar.HideGroupsButton.M_EVENTS={'save':'save'};(function(){"use strict";jQuery.sap.declare("sap.ushell.ui.footerbar.HideGroupsButton");jQuery.sap.require("sap.ushell.resources");jQuery.sap.require("sap.ushell.ui.launchpad.AccessibilityCustomData");sap.ushell.ui.footerbar.HideGroupsButton.prototype.init=function(){if(sap.ushell.ui.launchpad.ActionItem.prototype.init){sap.ushell.ui.launchpad.ActionItem.prototype.init.apply(this,arguments);}this.setIcon('sap-icon://group-2');this.setTooltip(sap.ushell.resources.i18n.getText("hideGroupsBtn_tooltip"));this.setText(sap.ushell.resources.i18n.getText("hideGroupsBtn_title"));this.attachPress(this.openHideGroupsDialog);};sap.ushell.ui.footerbar.HideGroupsButton.prototype.openHideGroupsDialog=function(){jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.m.Table");jQuery.sap.require("sap.m.Switch");var t=this;this.oModel=this.getModel();this.handleChange=function(a){var b=a.oSource.getParent(),g=b.getBindingContextPath(),c=this.oModel.getProperty(g);var d=jQuery.grep(this.aGroupsStates,function(G){return G.groupId===c.groupId;})[0];if(d){d.isGroupVisible=!d.isGroupVisible;}b.toggleStyleClass('sapUshellHideGroupsTableItem');b.getCells()[0].toggleStyleClass('sapUshellHideGroupsDisabledCell');}.bind(this);var s=function(a,l){return a&&!l;};this.groupsTableTemplate=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{title}"}),new sap.m.Switch({visible:{parts:[{path:"isEnabled"},{path:"isGroupLocked"}],formatter:s},change:t.handleChange,customTextOff:" ",customTextOn:" ",tooltip:sap.ushell.resources.i18n.getText("hideGroups_switchTooltip")})]});this.groupsTable=new sap.m.Table("sapUshellHideGroupsTable",{backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.Inner,columns:[new sap.m.Column({vAlign:"Middle"}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Right,vAlign:"Middle",width:"4.94rem"})]});this.groupsTable.addStyleClass('sapUshellHideGroupsTable');var o=this.groupsTable.onAfterRendering;this.groupsTable.onAfterRendering=function(a){o.apply(t.groupsTable,arguments);var b=a.srcControl.mAggregations.items;if(b){var m=b[0].getModel(),i,g;for(i=0;i<b.length;i++){g=m.getProperty(b[i].getBindingContextPath());b[i].getCells()[1].setState(g.isGroupVisible);if(g&&g.isGroupLocked&&(g.tiles.length===0||!sap.ushell.utils.groupHasVisibleTiles(g.tiles))){b[i].setVisible(false);}else if(!b[i].getCells()[1].getState()){b[i].addStyleClass('sapUshellHideGroupsTableItem');b[i].getCells()[0].addStyleClass('sapUshellHideGroupsDisabledCell');}}}setTimeout(function(){jQuery('.sapMListTblRow').first().focus();},200);};this.groupsTable.setModel(this.getModel());var p=this.getModel().getProperty("/personalization");var e=[];if(!p){e.push(new sap.ui.model.Filter("tiles/length",sap.ui.model.FilterOperator.GT,0));}this.groupsTable.bindItems({path:"/groups",template:this.groupsTableTemplate,filters:e});this.saveButton=new sap.m.Button("saveBtn",{text:sap.ushell.resources.i18n.getText("okBtn"),press:function(){setTimeout(function(){var m=this.getModel();var g=t.aGroupsStates;if(g){var l=sap.ushell.Container.getService("LaunchPage");var h=[],i,a;for(i=0;i<g.length;i++){if(!g[i].isGroupVisible){a=l.getGroupId(g[i].object);h.push(a);}}l.hideGroups(h).done(function(){m.setProperty("/groups",g);t.handleToastMessage(h.length);t.fireSave();}).fail(function(){var b=new sap.ushell.ui.launchpad.EmbeddedSupportErrorMessage("HideGroupsErrorMessage",{title:sap.ushell.resources.i18n.getText("error"),content:new sap.m.Text({text:sap.ushell.resources.i18n.getText("hideGroups_error")})});b.open();});}}.bind(this),100);this.oDialog.close();}.bind(this)});this.handleToastMessage=function(n){var m="";if(typeof n===undefined){return;}if(n===0){m=sap.ushell.resources.i18n.getText("hideGroups_none");}else if(n===1){m=sap.ushell.resources.i18n.getText("hideGroups_single");}else{m=sap.ushell.resources.i18n.getText("hideGroups_multiple",n);}sap.ushell.Container.getService("Message").show(sap.ushell.services.Message.Type.INFO,m);};this.cancelButton=new sap.m.Button("CancelBtn",{text:sap.ushell.resources.i18n.getText("cancelBtn"),press:function(){if(t.aGroupsOriginalStates){var g=this.getModel().getProperty('/groups'),i;for(i=0;i<t.aGroupsOriginalStates.length;i++){if(g[i].groupId===t.aGroupsOriginalStates[i].groupId){g[i].isGroupVisible=t.aGroupsOriginalStates[i].isVisible;}}}this.oDialog.close();}.bind(this)});this.oDialog=new sap.m.Dialog({id:"groupsVisibilityDialog",title:sap.ushell.resources.i18n.getText("hideGroups_title"),contentWidth:"29.6rem",contentHeight:"36.07rem",stretch:sap.ui.Device.system.phone,content:this.groupsTable,beginButton:this.saveButton,endButton:this.cancelButton,initialFocus:"groupsVisibilityDialog",afterClose:function(){this.oDialog.destroy();}.bind(this)}).addStyleClass("sapUshellGroupsVisibilityDialog");this.oDialog.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-label",value:sap.ushell.resources.i18n.getText("hideGroupsDialog_ariaLabel"),writeToDom:true}));this.getModelStates=function(g){if(!g){return;}var S=[],i;for(i=0;i<g.length;i++){S.push({groupId:g[i].groupId,isVisible:g[i].isGroupVisible});}return S;};this.aGroupsStates=this.oModel.getProperty('/groups');this.aGroupsOriginalStates=this.getModelStates(this.aGroupsStates);this.oDialog.open();};}());
