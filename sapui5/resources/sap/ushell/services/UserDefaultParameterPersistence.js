// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.UserDefaultParameterPersistence");var v=["value","extendedValue","noEdit","alwaysAskPlugin","_shellData","pluginData"];sap.ushell.services.UserDefaultParameterPersistence=function(a,c,p,C){this._oAdapter=a;this._oData={};};sap.ushell.services.UserDefaultParameterPersistence.prototype._cleanseValue=function(V){var r=jQuery.extend(true,{},V),a;for(a in r){if(r.hasOwnProperty(a)){if(v.indexOf(a)<0){delete r[a];}}}return r;};sap.ushell.services.UserDefaultParameterPersistence.prototype._testValue=function(V){return true;};sap.ushell.services.UserDefaultParameterPersistence.prototype.loadParameterValue=function(p){var d=new jQuery.Deferred(),t=this;if(this._oData[p]){d.resolve(this._oData[p]);}else{this._oAdapter.loadParameterValue(p).done(function(V){var c=t._cleanseValue(V);if(t._testValue(c)){d.resolve(c);}else{jQuery.sap.log.error("flawed value returned from persistence");d.reject("flawed value returned from persistence");}}).fail(d.reject.bind(this));}return d.promise();};sap.ushell.services.UserDefaultParameterPersistence.prototype.saveParameterValue=function(p,V){var d,c;if(!V){return this.deleteParameter(p);}c=this._cleanseValue(V);d=new jQuery.Deferred();if(!this._testValue(c)||(V&&V.noStore===true)){return d.resolve().promise();}this._oData[p]=c;return this._oAdapter.saveParameterValue(p,c);};sap.ushell.services.UserDefaultParameterPersistence.prototype.deleteParameter=function(p){delete this._oData[p];return this._oAdapter.deleteParameter(p);};sap.ushell.services.UserDefaultParameterPersistence.prototype.getStoredParameterNames=function(){var d=new jQuery.Deferred();this._oAdapter.getStoredParameterNames().done(function(r){r.sort();d.resolve(r);}).fail(d.reject.bind(d));return d.promise();};}());
