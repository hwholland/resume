// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";sap.ui.controller("sap.ushell.renderers.fiori2.theme_selector.ThemeSelector",{onInit:function(){try{this.userInfoService=sap.ushell.Container.getService("UserInfo");this.oUser=this.userInfoService.getUser();}catch(e){jQuery.sap.log.error("Getting UserInfo service failed.");this.oUser=sap.ushell.Container.getUser();}this.oModel=new sap.ui.model.json.JSONModel({options:[]});this.getView().setModel(this.oModel);this.translationBundle=sap.ushell.resources.i18n;this.currentThemeId=this.oUser.getTheme();this.origThemeId=this.currentThemeId;this.aThemeList=null;this.isContentLoaded=false;},_getIsChangeThemePermitted:function(){return this.oUser.isSetThemePermitted();},getContent:function(){var t=this;var d=jQuery.Deferred();if(this.isContentLoaded===true){d.resolve(this.getView());}else{var a=this._getThemeList();a.done(function(T){if(T.length>0){T.sort(function(b,c){var e=b.name,f=c.name;if(e<f){return-1;}if(e>f){return 1;}return 0;});for(var i=0;i<T.length;i++){if(T[i].id==t.currentThemeId){T[i].isSelected=true;}else{T[i].isSelected=false;}}t.getView().getModel().setProperty("/options",T);d.resolve(t.getView());}else{d.reject();}});a.fail(function(){d.reject();});}return d.promise();},getValue:function(){var d=jQuery.Deferred();var t=this._getThemeList();var a=this;var b;t.done(function(T){a.aThemeList=T;b=a._getThemeNameById(a.currentThemeId);d.resolve(b);});t.fail(function(e){d.reject(e);});return d.promise();},onCancel:function(){this.currentThemeId=this.oUser.getTheme();},onSave:function(){var d=jQuery.Deferred();var u;if(this.oUser.getTheme()!=this.currentThemeId){if(this.currentThemeId){this.oUser.setTheme(this.currentThemeId);u=this.userInfoService.updateUserPreferences(this.oUser);u.done(function(){this.origThemeId=this.currentThemeId;this.oUser.resetChangedProperties();d.resolve();}.bind(this));u.fail(function(e){this.oUser.setTheme(this.origThemeId);this.oUser.resetChangedProperties();this.currentThemeId=this.origThemeId;jQuery.sap.log.error(e);d.reject(e);}.bind(this));}else{d.reject("Could not find theme: "+this.currentThemeId);}}else{d.resolve();}return d.promise();},_getThemeList:function(){var d=jQuery.Deferred();if(this.aThemeList==null){if(this._getIsChangeThemePermitted()==true){var g=this.userInfoService.getThemeList();g.done(function(D){d.resolve(D.options);});g.fail(function(){d.reject("Failed to load theme list.");});}else{d.resolve([this.currentThemeId]);}}else{d.resolve(this.aThemeList);}return d.promise();},getCurrentThemeId:function(){return this.currentThemeId;},setCurrentThemeId:function(n){this.currentThemeId=n;},_getThemeNameById:function(t){if(this.aThemeList){for(var i=0;i<this.aThemeList.length;i++){if(this.aThemeList[i].id==t){return this.aThemeList[i].name;}}}return t;}});}());
