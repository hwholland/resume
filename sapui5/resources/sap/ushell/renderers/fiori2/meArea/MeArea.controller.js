// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";var m=new sap.ui.model.json.JSONModel({actions:[],userPreferences:{entries:[]},apps:{recentActivities:[]}});sap.ui.controller("sap.ushell.renderers.fiori2.meArea.MeArea",{onInit:function(){this.aControlsWithPressHandler=[];this.getView().setModel(m,"meAreaModel");this._addActionItemToOverflowSupport();},onBeforeRendering:function(){if(m.getProperty('/apps/recentActivities')&&m.getProperty('/apps/recentActivities').length){return;}this.refreshUserActivities();},refreshUserActivities:function(){var u=sap.ushell.Container.getService('UserRecents');u.getRecentActivity().done(function(a){a.forEach(function(i){i.timestamp=sap.ushell.utils.formatDate(i.timestamp);});m.setProperty('/apps/recentActivities',a);});},createViewByName:function(e,n,v){var V=v?sap.ui.getCore().byId(v):null;if(!V){var s=e.getSource(),c=s.getBindingContext(),p=c?c.getPath():"",a=n||c.getModel().getProperty(p+"/viewName");v=v||c.getModel().getProperty(p+"/id");V=sap.ui.view(v,{viewName:a,type:'JS',viewData:{}});}return V;},logout:function(){jQuery.sap.require('sap.m.MessageBox');var l=new sap.ushell.ui.launchpad.LoadingDialog({text:""}),s=true,i=false,L={};sap.ushell.Container.getGlobalDirty().done(function(d){s=false;if(i===true){l.exit();l=new sap.ushell.ui.launchpad.LoadingDialog({text:""});}var _=function(d){var L={},r=sap.ushell.resources.i18n;if(d===sap.ushell.Container.DirtyState.DIRTY){L.message=r.getText('unsaved_data_warning_popup_message');L.icon=sap.m.MessageBox.Icon.WARNING;L.messageTitle=r.getText("unsaved_data_warning_popup_title");}else{L.message=r.getText('logoutConfirmationMsg');L.icon=sap.m.MessageBox.Icon.QUESTION;L.messageTitle=r.getText("logoutMsgTitle");}return L;};L=_(d);sap.m.MessageBox.show(L.message,L.icon,L.messageTitle,[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(a){if(a===sap.m.MessageBox.Action.OK){l.openLoadingScreen();l.showAppInfo(sap.ushell.resources.i18n.getText('beforeLogoutMsg'),null);sap.ushell.Container.logout();}},sap.ui.core.ElementMetadata.uid("confirm"));});if(s===true){l.openLoadingScreen();i=true;}},_addPressHandlerToActions:function(c){if(this.aControlsWithPressHandler.indexOf(c.getId())===-1){this.aControlsWithPressHandler.push(c.getId());c.attachPress(function(){sap.ui.getCore().byId("viewPortContainer").switchState("Center");});}},_getControlsWithPressHandler:function(){return this.aControlsWithPressHandler;},_addActionItemToOverflowSupport:function(){if(sap.m._overflowToolbarHelpers&&sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopoverControls._mSupportedControls){var s=sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopoverControls._mSupportedControls;var p=sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopoverControls.prototype;var c=["sap.ushell.ui.launchpad.ActionItem","sap.ushell.ui.footerbar.AboutButton","sap.ushell.ui.footerbar.ContactSupportButton","sap.ushell.ui.footerbar.EndUserFeedback","sap.ushell.ui.footerbar.HideGroupsButton","sap.ushell.ui.footerbar.LogoutButton","sap.ushell.ui.footerbar.UserPreferencesButton","sap.m.Button"];var C=function(n){return n.substring(0,1).toUpperCase()+n.substring(1);};var S={canOverflow:true,listenForEvents:["press"],noInvalidationProps:["enabled","type"]};var P=function(o){o.setActionType('standard');var t=o.getType();if(t!==sap.m.ButtonType.Accept&&t!==sap.m.ButtonType.Reject){o.setType(sap.m.ButtonType.Transparent);}};var f=function(o){o.setActionType('action');};c.forEach(function(n){s[n]=S;var a=n.split(".").map(C).join("");var b='_preProcess';var d='_postProcess';p[b+a]=P;p[d+a]=f;});}}});}());
