// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchBar');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');sap.ui.jsview("sap.ushell.renderers.fiori2.search.container.App",{createContent:function(){var t=this;if(!this.oModel){this.oModel=sap.ushell.renderers.fiori2.search.getModelSingleton();}this.setModel(sap.ushell.resources.i18nModel,"i18n");this.oSearchResults=sap.ui.view({id:"searchContainerResultsView",tooltip:"{i18n>searchResultsView_tooltip}",viewName:"sap.ushell.renderers.fiori2.search.container.Search",type:sap.ui.core.mvc.ViewType.JS});this.oSearchResults.setModel(t.oModel);this.oSearchResults.setAppView(t);this.oModel.deserializeURL();this.oPage=this.pageFactory("searchPage",[this.oSearchResults]);return this.oPage;},beforeExit:function(){},pageFactory:function(i,c,d){var t=this;var s=new sap.ushell.renderers.fiori2.search.controls.SearchBar({oSearchLayout:t.oSearchResults.searchLayout,filterButtonPressed:t.oModel.getProperty('/facetVisibility'),filterButtonVisible:{parts:[{path:'/businessObjSearchEnabled'}],formatter:function(b){return!sap.ui.Device.system.phone&&b;}},contentMiddle:new sap.m.Label({text:{parts:[{path:'/count'}],formatter:function(a){if(typeof a!=='number'){return"";}var b=sap.ui.core.format.NumberFormat.getIntegerInstance({style:(Math.abs(a)>=99950?"short":"standard"),precision:3}).format(a);return sap.ushell.resources.i18n.getText("searchResults")+" ("+b+")";}},tooltip:{parts:[{path:'/count'}],formatter:function(a){if(typeof a!=="number"){return"";}return sap.ushell.resources.i18n.getText("searchResults")+" ("+a+")";}}})});s.setModel(t.oModel);var p=new sap.m.Page({id:i,customHeader:s,content:c,enableScrolling:true,showFooter:true});p.setModel(t.oModel);var e=["onAfterHide","onAfterShow","onBeforeFirstShow","onBeforeHide","onBeforeShow"];var D={};t.createFooter(p);jQuery.each(e,function(I,E){D[E]=jQuery.proxy(function(a){jQuery.each(this.getContent(),function(I,c){c._handleEvent(a);});},p);});p.addEventDelegate(D);if(!sap.ui.Device.system.desktop){p._bUseIScroll=true;}if(d){this.disableBouncing(p);}if(!sap.ui.Device.support.touch){var v=sap.ui.getCore().byId("searchContainerApp");v.addStyleClass('sapUiSizeCompact');}return p;},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.container.App";},createFooter:function(p){var t=this;if(jQuery.device.is.phone){return;}var m=new sap.m.ToggleButton({icon:"sap-icon://multi-select",tooltip:sap.ushell.resources.i18n.getText("toggleSelectionModeBtn"),press:function(){var c=t.oBar.getContent();var i,d;if(this.getPressed()){t.oSearchResults.resultList.enableSelectionMode();t.oModel.setProperty("/multiSelectionEnabled",true);for(i=0;i<c.length;i++){d=c[i];if(d.hasStyleClass("sapUshellSearchResultList-multiSelectionActionButton")){t.oBar.removeContent(d);}}var h=t.oModel.getDataSource();var j=t.oModel.config.getDataSourceConfig(h);var k=new j.searchResultListSelectionHandlerControl();var l=k.actionsForDataSource();t.oModel.setProperty("/multiSelectionActions",l);for(i=0;i<l.length;i++){var n=l[i];var q=new sap.m.Button({text:n.text,press:function(){var r=t.oModel.getProperty("/results");var u=[];for(var i=0;i<r.length;i++){var v=r[i];if(v.selected){u.push(v);}}n.action(u);},visible:{parts:[{path:'/multiSelectionEnabled'}],mode:sap.ui.model.BindingMode.OneWay}});q.setModel(t.oModel);q.addStyleClass("sapUshellSearchResultList-multiSelectionActionButton");t.oBar.insertContent(q,2);}}else{t.oSearchResults.resultList.disableSelectionMode();t.oModel.setProperty("/multiSelectionEnabled",false);t.oModel.setProperty("/multiSelectionActions",undefined);for(i=0;i<c.length;i++){d=c[i];if(d.hasStyleClass("sapUshellSearchResultList-multiSelectionActionButton")){t.oBar.removeContent(d);}}}},visible:{parts:[{path:'/multiSelectionAvailable'}],mode:sap.ui.model.BindingMode.OneWay},pressed:{parts:[{path:'/multiSelectionEnabled'}],mode:sap.ui.model.BindingMode.OneWay}});m.setModel(this.oModel);m.addStyleClass("sapUshellSearchResultList-toggleMultiSelectionButton");var b=new sap.ushell.ui.footerbar.AddBookmarkButton({beforePressHandler:function(){var A={url:document.URL,title:t.oModel.getDocumentTitle(),icon:sap.ui.core.IconPool.getIconURI("search")};b.setAppData(A);}});b.setWidth('auto');var e=new sap.m.Button();e.setIcon("sap-icon://email");e.setText(sap.ushell.resources.i18n.getText("eMailFld"));e.attachPress(function(){sap.m.URLHelper.triggerEmail(null,t.oModel.getDocumentTitle(),document.URL);});e.setWidth('auto');var a=new sap.m.ActionSheet({placement:'Top',buttons:[b,e]});var s=new sap.m.Button({icon:'sap-icon://action',tooltip:sap.ushell.resources.i18n.getText('shareBtn'),press:function(){a.openBy(s);}});var E=new sap.m.MessagePopover({placement:"Top"}).setModel(this.oModel);E.bindAggregation("items","/errors",function(i,C){var d=new sap.m.MessagePopoverItem({title:"{title}",description:"{description}"});switch(C.oModel.getProperty(C.sPath).type.toLowerCase()){case"error":d.setType(sap.ui.core.MessageType.Error);break;case"warning":d.setType(sap.ui.core.MessageType.Warning);break;default:d.setType(sap.ui.core.MessageType.Information);}return d;});var o=new sap.m.Button("searchErrorButton",{icon:sap.ui.core.IconPool.getIconURI("alert"),text:{parts:[{path:'/errors/length'}],formatter:function(l){return l;}},visible:{parts:[{path:'/errors/length'}],formatter:function(l){return l>0;},mode:sap.ui.model.BindingMode.OneWay},type:sap.m.ButtonType.Emphasized,tooltip:sap.ushell.resources.i18n.getText('errorBtn'),press:function(){E.openBy(o);}});o.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}));m.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}));s.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}));var c=[o,new sap.m.ToolbarSpacer(),m,s];t.oBar=new sap.m.OverflowToolbar({content:c}).addStyleClass("MyBar");var f=p.getFooter();if(f&&f.destroy){f.destroy();}p.setFooter(t.oBar);}});}(window));
