(function(){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');var S=sap.ushell.renderers.fiori2.search.SearchHelper;jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionProvider');var a=sap.ushell.renderers.fiori2.search.suggestions.SuggestionProvider;jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypeProps');var b=sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypeProps;sap.ushell.Container.getService("Search").getSina();var s=sap.bc.ina.api.sina.base;jQuery.sap.declare('sap.ushell.renderers.fiori2.search.suggestions.AppSuggestionProvider');var m=sap.ushell.renderers.fiori2.search.suggestions.AppSuggestionProvider=function(){this.init.apply(this,arguments);};m.prototype=jQuery.extend(new a(),{init:function(p){a.prototype.init.apply(this,arguments);this.suggestApplications=S.refuseOutdatedRequests(this.suggestApplications);},abortSuggestions:function(){this.suggestApplications.abort();},combineSuggestionsWithIdenticalTitle:function(c){function J(k,v){if(k==="sina"){return undefined;}return v;}var d;var e={};for(var i=0;i<c.length;i++){d=c[i];var f=e[d.title];if(f){if(!f.combinedSuggestionExists){var g={title:'tfergtrztuzt'+i,sortIndex:f.sortIndex,url:"#Action-search&/searchterm="+d.title+"&datasource="+JSON.stringify(this.model.appDataSource,J),label:sap.ushell.resources.i18n.getText("suggestion_in_apps",d.label),icon:f.icon};e[g.title]=g;f.combinedSuggestionExists=true;}}else{d.sortIndex=i;e[d.title]=d;}}c=[];for(var h in e){if(e.hasOwnProperty(h)){d=e[h];if(!d.combinedSuggestionExists){c.push(d);}}}c.sort(function(j,k){return j.sortIndex-k.sortIndex;});return c;},addAsterisk4ShowAllApps:function(c){var n=c;c=c.match(/\S+/g);if(c.length>0){var d;var e=[];for(var i=0;i<c.length;i++){d=c[i];if(d&&d.lastIndexOf('*')!==d.length-1){e.push(d+'*');}else{e.push(d);}}n=e.join(' ')}return n;},createShowMoreSuggestion:function(t){var c=sap.ushell.resources.i18n.getText("showAllNApps",t);c=c.replace(/"/g,"");var d=c;var l="<i>"+c+"</i>";return{title:c,tooltip:d,label:l,dataSource:this.model.appDataSource,labelRaw:this.model.getProperty("/uiFilter/searchTerms"),type:s.SuggestionType.OBJECTDATA};},getSuggestions:function(){var t=this;var d=t.model.getDataSource();if(!d.equals(t.model.allDataSource)&&!d.equals(t.model.appDataSource)){return jQuery.when([]);}var c=t.model.getProperty('/uiFilter/searchTerms');return t.suggestApplications(c).then(function(r){var e=r.getElements();e=t.combineSuggestionsWithIdenticalTitle(e);jQuery.each(e,function(i,g){g.type=s.SuggestionType.APPS;g.dataSource=t.model.appDataSource;g.position=b[s.SuggestionType.APPS].position;});var f;if(t.model.isAllCategory()){f=b[s.SuggestionType.APPS].limitDsAll;}else{f=b[s.SuggestionType.APPS].limitDsApps;}e=e.slice(0,f);if(r.totalResults>f&&d.equals(t.model.appDataSource)){e.push(t.createShowMoreSuggestion(r.totalResults));}return e;});},suggestApplications:function(c){return sap.ushell.Container.getService("Search").queryApplications({searchTerm:c,searchInKeywords:true,bSuggestion:true});}});})();
