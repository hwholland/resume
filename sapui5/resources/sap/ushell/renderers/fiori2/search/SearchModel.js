(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchResultListFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchFacetsFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchTabStripsFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.FacetItem');jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionHandler');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchIntentsResolver');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchConfiguration');var s=g.sap;var S=s.ushell.renderers.fiori2.search.SearchHelper;var c=s.ushell.renderers.fiori2.search.SearchResultListFormatter;var T=s.ushell.renderers.fiori2.search.SearchTabStripsFormatter.Formatter;var d=s.ushell.renderers.fiori2.search.suggestions.SuggestionHandler;var f=s.ushell.renderers.fiori2.search.SearchConfiguration;s.ushell.renderers.fiori2.search.getModelSingleton=function(){if(!s.ushell.renderers.fiori2.search.oModel){s.ushell.renderers.fiori2.search.oModel=new s.ushell.renderers.fiori2.search.SearchModel();}return s.ushell.renderers.fiori2.search.oModel;};s.ui.model.json.JSONModel.extend("sap.ushell.renderers.fiori2.search.SearchModel",{constructor:function(p){var t=this;p=p||{};s.ui.model.json.JSONModel.prototype.constructor.apply(t,[]);t.config=new f();t.setSizeLimit(200);t.sina=s.ushell.Container.getService("Search").getSina();this.suggestionQuery=this.sina.createSuggestionQuery();t.suggestionHandler=new d({model:this});t.query=t.sina.createPerspectiveQuery({templateFactsheet:true});if(t.config.multiSelect){t.query.setIncludeFacetsWithFilters(true);}t.setProperty('/uiFilter',t.sina.createFilter());t.resetFilterConditions(false);t.createAllAndAppDataSource();t.query.getResultSet=S.refuseOutdatedRequests(t.query.getResultSet,'search');t.searchApplications=S.refuseOutdatedRequests(t.searchApplications,'search');t.oFacetFormatter=new s.ushell.renderers.fiori2.search.SearchFacetsFormatter();t.tabStripFormatter=new T(t.allDataSource);t.dataSourceTree=t.tabStripFormatter.tree;t.pageSize=10;t.appTopDefault=20;t.boTopDefault=t.pageSize;t.setProperty('/isQueryInvalidated',true);t.setProperty('/isBusy',false);t.setProperty('/tableColumns',[]);t.setProperty('/tableSortItems',[]);t.setProperty('/results',[]);t.setProperty('/appResults',[]);t.setProperty('/boResults',[]);t.setProperty('/count',0);t.setProperty('/boCount',0);t.setProperty('/appCount',0);t.setProperty('/facets',[]);t.setProperty('/dataSources',[t.allDataSource,t.appDataSource]);t.setProperty('/persoServiceProviders',[]);t.setProperty('/businessObjSearchEnabled',true);t.setProperty("/initializingObjSearch",false);t.setProperty('/suggestions',[]);t.setProperty('/resultToDisplay',"searchResultList");t.setProperty('/displaySwitchVisibility',false);t.setProperty('/documentTitle','Search');t.setProperty('/top',t.boTopDefault);t.setProperty('/orderBy',{});t.setProperty('/facetVisibility',S.loadFilterButtonStatus());t.setProperty('/focusIndex',0);t.setProperty('/fuzzy',false);t.setProperty('/errors',[]);t.resetDataSource(false);t.setProperty('/multiSelectionAvailable',false);t.setProperty('/multiSelectionEnabled',false);t.setProperty('/multiSelection/actions',[]);t.initBusinessObjSearch();try{t.analytics=s.ushell.Container.getService("UsageAnalytics");}catch(e){}if(!t.analytics){t.analytics={logCustomEvent:function(){}};}},initBusinessObjSearch:function(){var t=this;if(t._initBusinessObjSearchProm){return t._initBusinessObjSearchProm;}t._initBusinessObjSearchProm=$.Deferred();if(!t.config.searchBusinessObjects){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);return t._initBusinessObjSearchProm.resolve();}t.setProperty("/initializingObjSearch",true);var a={labelPlural:s.ushell.resources.i18n.getText("genericLoading"),enabled:false,key:t.getProperty("/uiFilter/dataSource/key"),equals:function(){return true;}};t.setProperty("/dataSource",a);t.setProperty("/dataSources",[a]);t.sina.sinaSystem().getServerInfo().done(function(b){t.serverInfo=b;if(t._isBusinessObjSearchEnabledOnBackend(b)){t.loadDataSources().done(function(){t.setProperty("/initializingObjSearch",false);if(!s.ushell.renderers.fiori2.search.SearchShellHelper){jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchShellHelper");}t._initBusinessObjSearchProm.resolve();});}else{t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty('/defaultDataSource',t.appDataSource);t.setProperty("/initializingObjSearch",false);t.config.searchBusinessObjects=false;t._initBusinessObjSearchProm.resolve();}}).fail(function(){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty("/initializingObjSearch",false);t.config.searchBusinessObjects=false;t._initBusinessObjSearchProm.resolve();});return t._initBusinessObjSearchProm;},_isBusinessObjSearchEnabledOnBackend:function(a){a=a.rawServerInfo;for(var i=0;i<a.Services.length;++i){var b=a.Services[i];if(b.Service.toLowerCase()=='search'){return true;}}return false;},isBusinessObjSearchConfigured:function(){try{var a=window['sap-ushell-config'].renderers.fiori2.componentData.config;return a.searchBusinessObjects!=='hidden';}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty('/businessObjSearchEnabled');},setProperty:function(n,v,C,a){var t=this;var r=s.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(n){case'/boResults':case'/appResults':t.calculateResultList();break;case'/appCount':case'/boCount':r=t.setProperty('/count',t.getProperty('/appCount')+t.getProperty('/boCount'));break;default:break;}return r;},setFuzzy:function(a){var b='Fuzzy';var r=this.query.getRequestedEntities().slice(0);var i=r.indexOf(b);if(a===true){if(i===-1){r.push(b);}}else if(i>-1){r.splice(i,1);}this.query.setRequestedEntities(r);this.setProperty("/fuzzy",a);},getSearchBoxTerm:function(){return this.getProperty('/uiFilter/searchTerms');},setSearchBoxTerm:function(a,b){var t=this;var e=a.replace(/^\s+/,"");this.setProperty('/uiFilter/searchTerms',e);if(e.length===0){return;}if(b||b===undefined){t._firePerspectiveQuery();}},getLastSearchTerm:function(){return this.query.getSearchTerms();},setFacetVisibility:function(v,a){this.setProperty('/facetVisibility',v);S.saveFilterButtonStatus(v);if((a||a===undefined)&&v){this._firePerspectiveQuery();}},getFacetVisibility:function(){return this.getProperty('/facetVisibility');},getTop:function(){return this.getProperty('/top');},setTop:function(t,a){this.setProperty('/top',t);if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetTop:function(){this.setProperty('/focusIndex',0);if(this.isAppCategory()){this.setTop(this.appTopDefault,false);}else{this.setTop(this.boTopDefault,false);}},getOrderBy:function(){return this.getProperty('/orderBy');},setOrderBy:function(o,a){this.setProperty('/orderBy',o);if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetOrderBy:function(a){this.setProperty('/orderBy',{});if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},isEqualOrderBy:function(o,a){if(jQuery.isEmptyObject(o)&&jQuery.isEmptyObject(a)){return true;}else if(o.orderBy===a.orderBy&&o.sortOrder===a.sortOrder){return true;}else{return false;}},getDocumentTitle:function(){var a=this.getSearchBoxTerm();var b=this.getDataSource().label;var t;if(this.getDataSource().equals(this.allDataSource)){t=s.ushell.resources.i18n.getText('searchTileTitleProposalAll',[a]);}else{t=s.ushell.resources.i18n.getText('searchTileTitleProposal',[a,b]);}return t;},resetQuery:function(){S.hasher.reset();this.resetTop();this.setSearchBoxTerm('');this.resetDataSource(false);this.resetFilterConditions(false);this.query.resetFilterConditions();this.query.setSearchTerms('random-jgfhfdskjghrtekjhg');this.setProperty('/facets',[]);this.setProperty('/results',[]);this.setProperty('/appResults',[]);this.setProperty('/boResults',[]);this.setProperty('/count',0);this.setProperty('/boCount',0);this.setProperty('/appCount',0);},createAllAndAppDataSource:function(){this.allDataSource=this.sina.getRootDataSource();this.allDataSource.label=s.ushell.resources.i18n.getText("label_all");this.allDataSource.labelPlural=s.ushell.resources.i18n.getText("label_all");this.appDataSource=this.sina.createDataSource({objectName:"$$APPS$$",label:s.ushell.resources.i18n.getText("label_apps"),labelPlural:s.ushell.resources.i18n.getText("label_apps"),type:'Apps',name:'Apps',sina:this.sina});},loadDataSources:function(){var t=this;var p=$.Deferred();t.getServerDataSources().done(function(a){if(!jQuery.isArray(a)||a.length==0){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty('/defaultDataSource',t.appDataSource);t.config.searchBusinessObjects=false;p.resolve();return;}a=a.slice();a.splice(0,0,t.appDataSource);a.splice(0,0,t.allDataSource);a=t._concatenateLabelAndRemoteSystem(a);t.setProperty("/dataSources",a);t.updateDataSourceList(t.getDataSource());t.setProperty("/searchTermPlaceholder",t.calculatePlaceholder());var b=t.getProperty('/uiFilter/dataSource/key');t.setProperty('/uiFilter/dataSource/key','');t.setProperty('/uiFilter/dataSource/key',b);p.resolve();}).fail(function(){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty('/defaultDataSource',t.appDataSource);t.config.searchBusinessObjects=false;p.resolve();});return p;},resetDataSource:function(a){if(this.getProperty('/businessObjSearchEnabled')){this.setDataSource(this.allDataSource,a);}else{this.setDataSource(this.appDataSource,a);}},isAllCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a.equals(this.allDataSource);},isOtherCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a.getType().toLowerCase()==="category"&&!this.isAllCategory();},isAppCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a.equals(this.appDataSource);},getDataSource:function(){return this.getProperty("/uiFilter/dataSource");},setDataSource:function(a,b){this.updateDataSourceList(a);this.getProperty("/uiFilter").setDataSource(a);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.resetTop();if(b||b===undefined){this._firePerspectiveQuery();}},getServerDataSources:function(){var t=this;if(t.getDataSourcesDeffered){return t.getDataSourcesDeffered;}t.getDataSourcesDeffered=t.sina.getDataSources().then(function(a){return jQuery.grep(a,function(b){return b.getType()!=='Category';});});return t.getDataSourcesDeffered;},notifyFilterChanged:function(){jQuery.each(this.aBindings,function(i,b){if(b.sPath==='/uiFilter/defaultConditionGroup/conditions'){b.checkUpdate(true);}});},addFilterCondition:function(a,b){if(a.attribute||a.conditions){this.getProperty("/uiFilter").addFilterCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},removeFilterCondition:function(a,b){if(a.attribute||a.conditions){this.getProperty("/uiFilter").removeFilterCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},resetFilterConditions:function(a){this.getProperty("/uiFilter").resetFilterConditions();if(a||a===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},doSuggestion:function(){this.suggestionQuery.setFilter(this.getProperty('/uiFilter').clone());this.suggestionHandler.doSuggestion();},abortSuggestions:function(){this.suggestionHandler.abortSuggestions();},_firePerspectiveQuery:function(a,p){var t=this;this.setProperty('/isBusy',true);this.initBusinessObjSearch().then(function(){t._doFirePerspectiveQuery(a,p);});},_doFirePerspectiveQuery:function(a,p){var t=this;var b,e;if(jQuery.isPlainObject(a)){b=a.deserialization;e=a.preserveFormerResults;}else{b=a?a:undefined;e=p?p:undefined;}var u=this.getProperty('/uiFilter');if(u.equals(this.query.getFilter())&&this.getTop()===this.query.getTop()&&this.isEqualOrderBy(this.getOrderBy(),this.query.getOrderBy())&&this.calculateRequestsEntities().length===this.query.requestedEntities.length&&!this.getProperty('/isQueryInvalidated')){t.setProperty('/isBusy',false);return;}if((this.query.getFilter().getDataSource()&&!u.getDataSource().equals(this.query.getFilter().getDataSource()))||(this.query.getFilter().getSearchTerms()&&u.getSearchTerms()!==this.query.getFilter().getSearchTerms())){this.resetOrderBy(false);}if(!b){if(u.getSearchTerms()!==this.query.getFilter().getSearchTerms()||!u.defaultConditionGroup.equals(this.query.getFilter().defaultConditionGroup)||!u.getDataSource().equals(this.query.getFilter().getDataSource())){this.resetTop();}}if(u.getSearchTerms()!==this.query.getFilter().getSearchTerms()||!u.defaultConditionGroup.equals(this.query.getFilter().defaultConditionGroup)){this.tabStripFormatter.invalidate(this.getDataSource());}if(this.getProperty('/isQueryInvalidated')===true){this.query.resetResultSet();this.setProperty('/isQueryInvalidated',false);}this.query.setFilter(this.getProperty('/uiFilter').clone());this.query.setTop(this.getTop());this.query.setOrderBy(this.getOrderBy());this.query.setRequestedEntities(this.calculateRequestsEntities());this.cleanErrors();this.setProperty("/queryFilter",this.query.getFilter());s.ui.getCore().getEventBus().publish("allSearchStarted");this.abortSuggestions();S.abortRequests('search');this.calculateVisibility();this.updateSearchURLSilently();this.analytics.logCustomEvent('FLP: Search','Search',[this.getProperty('/uiFilter/searchTerms'),this.getProperty('/uiFilter/dataSource').key]);var h=this.getDataSource();this.setProperty('/isBusy',true);jQuery.when.apply(null,[this.normalSearch(e),this.appSearch()]).done(function(){t.setProperty('/tabStrips',t.tabStripFormatter.format(h,t.perspective,t));t.setProperty('/facets',t.oFacetFormatter.getFacets(h,t.perspective,t));}).always(function(){document.title=t.getDocumentTitle();t.setProperty('/isBusy',false);s.ui.getCore().getEventBus().publish("allSearchFinished");});},calculateRequestsEntities:function(){if(this.getDataSource().getType()==='Category'||this.getFacetVisibility()){return['SearchResults','Facets','TotalCount'];}else{return['SearchResults','TotalCount'];}},appSearch:function(){var t=this;this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(!this.isAllCategory()&&!this.isAppCategory()){return jQuery.when(true);}var a=this.query.getFilter().getDataSource().equals(this.allDataSource)?this.appTopDefault:this.query.getTop();return this.searchApplications(this.query.getFilter().getSearchTerms(),a,0).then(function(r){t.setProperty("/appCount",r.totalResults);t.setProperty("/appResults",r.getElements());},function(){return jQuery.when(true);});},searchApplications:function(a,t,b){return s.ushell.Container.getService("Search").queryApplications({searchTerm:a,searchInKeywords:true,top:t,skip:b});},normalSearch:function(p){var t=this;if(!p){t.resetAndDisableMultiSelection();}if(!t.isBusinessObjSearchEnabled()||t.isAppCategory()){this.setProperty("/boResults",[]);this.setProperty("/boCount",0);return jQuery.when(true);}t.setFuzzy(false);return this.query.getResultSet().then(function(a){if(a.getSearchResultSet().totalcount<1&&t.serverInfo.services.Search.capabilities['OptionFuzzy']){t.setProperty("/boResults",[]);t.setProperty("/boCount",0);t.setFuzzy(true);return t.query.getResultSet().then(function(b){t.perspective=b;return t._afterSearchPrepareResultList(t.perspective,p);},function(e){t.normalSearchErrorHandling(e);t.perspective=null;return jQuery.when(true);});}t.perspective=a;return t._afterSearchPrepareResultList(t.perspective,p);},function(e){t.normalSearchErrorHandling(e);t.perspective=null;return jQuery.when(true);});},_afterSearchPrepareResultList:function(p,a){var t=this;var i;var b=[];if(a){var _=t.getProperty("/boResults");for(i=0;i<_.length;i++){if(_[i].expanded||_[i].selected){b.push(_[i]);}}}t.setProperty("/boResults",[]);t.setProperty("/boCount",0);var e=new c();var n=e.format(p.getSearchResultSet(),this.query.filter.searchTerms);if(n[0]){var h=[];var k=[];var l=n[0].itemattributes;for(i=0;i<l.length;i++){if(l[i].key!==undefined){var m=escape(l[i].key).replace(/[^\w\s]/gi,'-');h.push({"name":l[i].name,"key":m,"index":i});if(i===0){k.push({"name":s.ushell.resources.i18n.getText("defaultRank"),"key":"ushellSearchDefaultSortItem","selected":jQuery.isEmptyObject(t.getProperty("/orderBy"))});}else{k.push({"name":l[i].name,"key":m,"selected":t.getProperty("/orderBy").orderBy===m});}}}t.setProperty("/tableColumns",h);t.setProperty("/tableSortItems",k);}var o=new s.ushell.renderers.fiori2.search.SearchIntentsResolver(t);var q=o.resolveIntents(n);q.done(function(r){if(b&&b.length>0){var R=t.sina.ResultElementKeyStatus;var u=[];for(i=0;i<n.length;i++){var v=n[i];if(v.keystatus===R.OK){for(var j=0;j<b.length;j++){var w=b[j];if(w.keystatus===R.OK&&w.key===v.key){v.selected=w.selected;v.expanded=w.expanded;b.splice(j,1);break;}}}else{u.push(v);}}if(u.length>0){var x=[];var y="";for(i=0;i<u.length;i++){var z=u[i].dataSource.key;if(jQuery.inArray(z,x)<0){x.push(z);y+=z+"\n";}}t.pushError({type:"warning",title:s.ushell.resources.i18n.getText("preserveFormerResultErrorTitle"),description:s.ushell.resources.i18n.getText("preserveFormerResultErrorDetails",y)});}}var A=t.getDataSource();if(A.getType().toLowerCase()==="businessobject"){var B=[];for(i=0;i<n.length;i++){var C=n[i];var D=C.semanticObjectType;if(!D){B=[];break;}if(jQuery.inArray(D,B)==-1){B.push(D);}}if(B.length==1){A.semanticObjectType=B[0];}else if(B.length>1){A.semanticObjectTypes=B;}}if(n.length<p.getSearchResultSet().totalcount){var E={};E.type="footer";n.push(E);}t.setProperty("/boCount",p.getSearchResultSet().totalcount);t.setProperty("/boResults",n);t.enableOrDisableMultiSelection();});return q;},resetAndDisableMultiSelection:function(){this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);},enableOrDisableMultiSelection:function(){var a=this.getDataSource();var b=this.config.getDataSourceConfig(a);var e=new b.searchResultListSelectionHandlerControl();if(e){this.setProperty("/multiSelectionAvailable",e.isMultiSelectionAvailable());}else{this.setProperty("/multiSelectionAvailable",false);}},_concatenateLabelAndRemoteSystem:function(a){var t=this;var b=a;for(var i=0;i<b.length-1;i++){if(b[i].remoteSystem!==undefined&&b[i].remoteSystem!==""&&!t._endWith(b[i].label,b[i].remoteSystem)){b[i].label=b[i].label+' '+s.ushell.resources.i18n.getText("textIn")+' '+b[i].remoteSystem;b[i].labelPlural=b[i].labelPlural+' '+s.ushell.resources.i18n.getText("textIn")+' '+b[i].remoteSystem;}}return b;},_endWith:function(a,b){return a.indexOf(b,a.length-b.length)!==-1;},calculatePlaceholder:function(){var t=this;if(t.isAllCategory()){return s.ushell.resources.i18n.getText("search");}else{return s.ushell.resources.i18n.getText("searchInPlaceholder",t.getDataSource().labelPlural);}},updateDataSourceList:function(n){var a=this.getProperty('/dataSources');while(a.length>0&&!a[0].equals(this.allDataSource)){a.shift();}if(n.equals(this.allDataSource)||n.equals(this.appDataSource)){return;}if(n&&n.key){if(n.key.indexOf('~')>=0){return;}}for(var i=0;i<a.length;++i){var b=a[i];if(b.equals(n)){return;}}a.unshift(n);this.setProperty('/dataSources',a);},invalidateQuery:function(){this.setProperty('/isQueryInvalidated',true);},autoStartApp:function(){var t=this;if(t.getProperty("/appCount")&&t.getProperty("/appCount")===1&&t.getProperty("/count")&&t.getProperty("/count")===1){var a=t.getProperty("/appResults");if(a&&a.length>0&&a[0]&&a[0].url&&t.getProperty('/uiFilter/searchTerms')&&a[0].tooltip&&t.getProperty('/uiFilter/searchTerms').toLowerCase().trim()===a[0].tooltip.toLowerCase().trim()){if(a[0].url[0]==='#'){window.location.href=a[0].url;}else{window.open(a[0].url,'_blank');}}}},getResultToDisplay:function(){return this.getProperty('/resultToDisplay');},setResultToDisplay:function(t){this.setProperty('/resultToDisplay',t);},calculateVisibility:function(){var t=this;if(t.isAppCategory()){t.setResultToDisplay("appSearchResult");t.setProperty('/displaySwitchVisibility',false);}else if(t.isAllCategory()||t.isOtherCategory()){t.setResultToDisplay("searchResultList");t.setProperty('/displaySwitchVisibility',false);}else{var r=t.getResultToDisplay();if(!(r==="searchResultList"||r==="searchResultTable")){t.setResultToDisplay("searchResultList");}t.setProperty('/displaySwitchVisibility',true);}},calculateResultList:function(){var t=this;var r=[];var b=t.getProperty('/boResults');if(b&&b.length){r.push.apply(r,b);}var a=t.getProperty('/appResults');if(a&&a.length>0){var e={type:'appcontainer',tiles:a};if(r.length>0){if(r.length>3){r.splice(3,0,e);}else{r.push(e);}}else{r=[e];}}s.ui.model.json.JSONModel.prototype.setProperty.apply(this,['/results',r]);},getDebugInfo:function(){var t=['\n'];if(this.serverInfo){t.push('Search Backend System:');t.push('System:'+this.serverInfo.systemid);t.push('Client:'+this.serverInfo.sapclient);t.push('');}t.push('See also Enterprise Search Setup Documentation:');t.push('http://help.sap.com/saphelp_uiaddon10/helpdata/en/57/7d77c891954c21a19c242694e83177/frameset.htm');return t.join('\n');},getErrors:function(){return this.getProperty('/errors');},cleanErrors:function(){this.setProperty('/errors',[]);},pushError:function(e){var t=this;var a=this.getProperty('/errors');a.push(e);t.setProperty('/errors',a);},normalSearchErrorHandling:function(e){var a=["ESH_FED_MSG016"];if(e){if(e.status===500){jQuery.sap.log.error(e.responseText);this.pushError({type:"error",title:e.statusText,description:e.responseText+this.getDebugInfo()});}if(e.responseText){var b=true;var h=jQuery.parseJSON(e.responseText);var j='';var k='';if(h.Error){if(h.Error.Message){j+=''+h.Error.Message;}if(h.Error.Code){j+=' (Code '+h.Error.Code+').';}}if(h.ErrorDetails){k+='';for(var i=0;i<h.ErrorDetails.length;i++){k+=h.ErrorDetails[i].Message+' (Code '+h.ErrorDetails[i].Code+')';if(a.indexOf(h.ErrorDetails[i].Code)!==-1){b=false;}}}jQuery.sap.log.error(j+' Details: '+k);if(b){this.pushError({type:"error",title:j,description:k+this.getDebugInfo()});}}else{this.pushError({type:"error",title:e.toString(),description:e.toString()+this.getDebugInfo()});}}},parseUrlParameters:function(u){var p={};var k=[{"name":"filter","pos":-1,"value":""},{"name":"top","pos":-1,"value":""},{"name":"datasource","pos":-1,"value":""},{"name":"searchterm","pos":-1,"value":""}];for(var i=0;i<k.length;i++){k[i].pos=u.toLowerCase().indexOf(k[i].name+"=");}k.sort(function(a,b){return a.pos-b.pos;});for(var j=0;j<k.length;j++){if(k[j].pos!==-1){if(k[j+1]&&k[j+1].pos!==-1){k[j].value=u.substring(k[j].pos,k[j+1].pos);}else{k[j].value=u.substring(k[j].pos);}k[j].value=k[j].value.substring(k[j].name.length+1);if(k[j].value.charAt(k[j].value.length-1)==="&"){k[j].value=k[j].value.substring(0,k[j].value.length-1);}k[j].value=decodeURIComponent(k[j].value);p[k[j].name]=k[j].value;}}return p;},createSearchURL:function(){var h="#Action-search";var u=this.getProperty('/uiFilter').getJson();h+="&/searchterm="+encodeURIComponent(u.searchTerms);h+="&datasource="+encodeURIComponent(JSON.stringify(u.dataSource));h+="&top="+this.getTop();h+="&filter="+encodeURIComponent(JSON.stringify(u.defaultConditionGroup));return h;},updateSearchURLSilently:function(){var h=this.createSearchURL();S.hasher.setHash(h);},deserializeURL:function(){if(S.getHashFromUrl().indexOf('#Action-search')!==0){return;}if(!S.hasher.hasChanged()){return;}var u=s.ushell.Container.getService("URLParsing");var a=u.splitHash(S.getHashFromUrl()).appSpecificRoute;if(!a){return;}var p=this.parseUrlParameters(a.substring(2));var b={};if(p.searchterm){b.searchTerms=p.searchterm;}if(p.datasource){b.dataSource=JSON.parse(p.datasource);}else{this.resetDataSource(false);}if(p.top){var t=parseInt(p.top,10);this.setTop(t,false);}this.resetFilterConditions(false);if(p.filter){b.defaultConditionGroup=JSON.parse(p.filter);}this.getProperty("/uiFilter").setJson(b);if(b.dataSource&&b.dataSource.name&&b.dataSource.name==='Apps'){this.setDataSource(this.appDataSource,false);}this._firePerspectiveQuery(true);},buildPersoServiceProvider:function(k){var a=k.substring(k.lastIndexOf('/')+1);var p={container:"PC-"+a,item:"PI-"+a};var b=s.ushell.Container.getService("Personalization").getPersonalizer(p);return{key:k,provider:b}},pushPersoServiceProvider:function(p){var a=this.getProperty("/persoServiceProviders");a.push(p);this.setProperty("/persoServiceProviders",a);},getPersoServiceProvider:function(k){var p=jQuery.grep(this.getProperty("/persoServiceProviders"),function(a){return a.key==k;});return p[0];}});})(window);
