(function(){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchFieldGroup');var S=sap.ushell.renderers.fiori2.search.controls.SearchFieldGroup;jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchModel");jQuery.sap.declare('sap.ushell.renderers.fiori2.search.SearchShellHelper');var m=sap.ushell.renderers.fiori2.search.SearchShellHelper={};jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');var s=sap.ushell.renderers.fiori2.search.SearchHelper;jQuery.extend(m,{init:function(){var t=this;t.oShell=sap.ui.getCore().byId('shell-header');t.oModel=sap.ushell.renderers.fiori2.search.getModelSingleton();t.oSearchFieldGroup=new S("searchFieldInShell");t.oSearchFieldGroup.setModel(t.oModel);t.oShell.setSearch(t.oSearchFieldGroup);t.oSearchInput=t.oSearchFieldGroup.getAggregation("input");t.oSearchSelect=t.oSearchFieldGroup.getAggregation("select");t.oSearchSelect.setTooltip(sap.ushell.resources.i18n.getText("searchInTooltip"));t.oSearchButton=t.oSearchFieldGroup.getAggregation("button");t.oSearchButton.setType(sap.m.ButtonType.Transparent);t.oSearchInput.setValue(t.oModel.getSearchBoxTerm());var i=false;t.oSearchSelect.addEventDelegate({onAfterRendering:function(e){if(!i){var a=jQuery('#shell-header-hdr-search').width()/parseFloat(jQuery("html").css("font-size"));if(a<=33){t.oSearchSelect.setDisplayMode('icon');t.oSearchSelect.setTooltip(sap.ushell.resources.i18n.getText("searchIn"));t.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupToShowSelectIcon");}i=true;}jQuery('#searchFieldInShell-select-icon').attr('title',sap.ushell.resources.i18n.getText("searchIn"));}},t.oSearchSelect);t.oSearchButton.attachPress(function(){t.handleClickSearchButton();});jQuery(document).on('keydown',function(e){if(e.keyCode===27){if(t.oSearchInput&&t.oSearchInput.getValue()===""&&!t.oSearchFieldGroup.hasStyleClass("sapUshellSearchFieldGroupInCenter")&&t.oSearchFieldGroup.hasStyleClass("sapUshellSearchFieldGroupMaximized")){t.closeSearch(true,false);}}});sap.ui.getCore().getEventBus().subscribe("allSearchFinished",t.onAllSearchFinished,t);sap.ui.getCore().byId('viewPortContainer').attachAfterNavigate(t.onAfterNavigate,t);},onShellSearchButtonPressed:function(e){var t=this;if(sap.ui.getCore().byId('searchFieldInShell')===undefined){t.init();t.oSearchButton.addEventDelegate({onAfterRendering:function(E){if(!t.afertFirstOpenSearch){t.openSearch(true,false);t.afertFirstOpenSearch=true;}}},t.oSearchButton);}else{t.openSearch(true,false);t.resetModel();t.afertFirstOpenSearch=true;}},openSearch:function(i,a){var t=this;t._openSearchFieldGroup(i);if(a){t._setSearchFieldGroupInCenter();}else{t._setSearchFieldGroupOnSide();}t.afertFirstOpenSearch=true;},closeSearch:function(i,a){var t=this;if(sap.ui.getCore().byId('searchFieldInShell')===undefined){return;}t._closeSearchFieldGroup(i);if(a){t._setSearchFieldGroupInCenter();}else{t._setSearchFieldGroupOnSide();}},getDefaultOpen:function(){return this.defaultOpen;},setDefaultOpen:function(d){this.defaultOpen=d;},onAfterNavigate:function(e){if(e.getParameter('toId')!=='shellPage-Action-search'&&e.getParameter('toId')!=='applicationShellPage-Action-search'){return;}var o=sap.ui.getCore().byId('searchContainerResultsView');if(o&&o.oFocusHandler){o.oFocusHandler.setFocus();}sap.ui.getCore().getEventBus().publish("searchLayoutChanged");},onAllSearchFinished:function(){this._setSearchFieldGroupInCenter();this.oSearchInput.setValue(this.oModel.getSearchBoxTerm());},_setOpenStyle:function(){this.oShell.setSearch(this.oSearchFieldGroup);sap.ui.getCore().byId('sf').setVisible(false);jQuery('#sf').removeClass("sapUshellSearchFieldElementDisplayInlineBlock");jQuery('#sf').addClass("sapUshellSearchFieldElementDisplayNone");this.oSearchButton.removeStyleClass("sapUshellSearchFieldElementDisplayNone");this.oSearchButton.addStyleClass("sapUshellSearchFieldElementDisplayBlock");this.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupMaximized");this.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupMinimized");this.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupNotVisible");},_setCloseStyle:function(){this._setSearchFieldGroupOnSide();this.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupMaximized");this.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupMinimized");this.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupNotVisible");jQuery('#sf').removeClass("sapUshellSearchFieldElementDisplayNone");jQuery('#sf').addClass("sapUshellSearchFieldElementDisplayInlineBlock");sap.ui.getCore().byId('sf').setVisible(true);this.oSearchButton.removeStyleClass("sapUshellSearchFieldElementDisplayBlock");this.oSearchButton.addStyleClass("sapUshellSearchFieldElementDisplayNone");this.oShell.setSearch(null);},_setSearchFieldGroupInCenter:function(){this.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupInCenter");this.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupOnSide");},_setSearchFieldGroupOnSide:function(){this.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupInCenter");this.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupOnSide");},resetModel:function(){this.oSearchInput.setValue('');this.oModel.resetQuery();},_openSearchFieldGroup:function(h){var t=this;sap.ushell.Container.getService("Search")._getCatalogTiles();if(h){t._setOpenStyle();if(jQuery('#searchFieldInShell-select').length>0){jQuery('#searchFieldInShell-select').css('max-width','0%').animate({'max-width':'15rem'},{duration:200,complete:function(){jQuery(this).css('max-width','');}});}jQuery('#searchFieldInShell-input').css('max-width','0%').animate({'max-width':'35rem'},{duration:300,complete:function(){t._setOpenStyle();if(!sap.ui.Device.system.phone){t.oSearchInput.focus();}jQuery(this).css('max-width','');}});}else{t._setOpenStyle();if(!sap.ui.Device.system.phone){t.oSearchInput.focus();}}t.isSearchFieldGroupOpen=true;},_closeSearchFieldGroup:function(h){var t=this;if(h){t.oSearchFieldGroup.addStyleClass("sapUshellSearchFieldGroupOnSide");t.oSearchFieldGroup.removeStyleClass("sapUshellSearchFieldGroupInCenter");var i=jQuery('#searchFieldInShell-input').width()+"px";jQuery('#searchFieldInShell-input').css('max-width',i).animate({'max-width':'0%'},{duration:400,complete:function(){t._setCloseStyle();}});}else{t._setCloseStyle();}t.isSearchFieldGroupOpen=false;},handleClickSearchButton:function(){var t=this;if(!s.isSearchAppActive()){if(t.isSearchFieldGroupOpen){if(t.oSearchInput.getValue()===""&&t.oModel.getDataSource()===t.oModel.allDataSource&&t.getDefaultOpen()!==true){t._closeSearchFieldGroup(true);setTimeout(function(){sap.ui.getCore().byId('sf').focus();},1000);}}}}});})();
