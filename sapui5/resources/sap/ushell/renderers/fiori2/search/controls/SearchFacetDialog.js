(function(){"use strict";jQuery.sap.require('sap.m.Dialog');jQuery.sap.require('sap.ushell.renderers.fiori2.search.FacetItem');sap.m.Dialog.extend('sap.ushell.renderers.fiori2.search.controls.SearchFacetDialog',{metadata:{properties:{"lastupdated":0,"currentSelectionCount":0}},constructor:function(o){var t=this;t.bShowCharts=true;t.facetListPosition=0;t.settingContainerPosition=0;t.settingSeparatorPosition=1;t.attributeListPosition=2;t.advancedPosition=4;t.sortingSelectPosition=0;t.showOnTopCheckBoxPosition=1;t.chartOnDisplayIndex=o.selectedTabBarIndex;t.facetOnDisplayIndex=0;t.chartOnDisplayIndexByFilterArray=[];t.aItemsForBarChart=[];t.tabBarItems=o.tabBarItems;if(!t.tabBarItems){t.setDummyTabBarItems();}o=jQuery.extend({},{showHeader:false,horizontalScrolling:false,verticalScrolling:false,contentHeight:'35rem',beginButton:new sap.m.Button({text:sap.ushell.resources.i18n.getText("okDialogBtn"),press:function(e){t.onOkClick(e);t.close();t.destroy();}}),endButton:new sap.m.Button({text:sap.ushell.resources.i18n.getText("cancelDialogBtn"),press:function(e){t.close();t.destroy();}}),content:[t.createContainer()]},o);t.selectedAttribute=o.selectedAttribute?o.selectedAttribute:"";delete o.selectedAttribute;delete o.selectedTabBarIndex;delete o.tabBarItems;sap.m.Dialog.prototype.constructor.apply(this,[o]);this.addStyleClass(sap.ui.Device.support.touch?"sapUiSizeCozy":"sapUiSizeCompact");this.addStyleClass('sapUshellSearchFacetDialog');},setChartOnDisplayIndexForFacetListItem:function(f){var t=this;var r=0;try{r=t.chartOnDisplayIndexByFilterArray[f];}catch(e){r=0;}if(r===undefined){r=0;}t.chartOnDisplayIndex=r;},setDummyTabBarItems:function(){var t=this;t.tabBarItems=[new sap.m.IconTabFilter({text:sap.ushell.resources.i18n.getText("facetList"),icon:"sap-icon://list",key:'list'+arguments[0]}),new sap.m.IconTabFilter({text:sap.ushell.resources.i18n.getText("facetBarChart"),icon:"sap-icon://horizontal-bar-chart",key:'barChart'+arguments[0]}),new sap.m.IconTabFilter({text:sap.ushell.resources.i18n.getText("facetPieChart"),icon:"sap-icon://pie-chart",key:'pieChart'+arguments[0]})];t.chartOnDisplayIndex=0;},renderer:'sap.m.DialogRenderer',createContainer:function(){var t=this;t.oSplitContainer=new sap.m.SplitContainer({masterPages:t.masterPagesFactory()});t.oSplitContainer.bindAggregation("detailPages","/facetDialog",function(i,c){return t.detailPagesFactory(i,c);});t.oSplitContainer.addStyleClass('sapUshellSearchFacetDialogContainer');return t.oSplitContainer;},masterPagesFactory:function(){var t=this;var f=new sap.m.List({mode:sap.m.ListMode.SingleSelectMaster,selectionChange:function(e){t.onMasterPageSelectionChange(e);}});f.addStyleClass('sapUshellSearchFacetDialogFacetList');f.bindAggregation("items","/facetDialog",function(i,c){var l=new sap.m.StandardListItem({title:"{title}",infoState:"Success"});var F=c.oModel.getProperty(c.sPath).facetType;var a=c.oModel.getProperty(c.sPath).count;if(F==="attribute"&&a>0){l.setCounter(a);}if(F==="search"){l.addStyleClass('sapUshellSearchFacetDialogListItemBold');}return l;});var m=new sap.m.Page({title:sap.ushell.resources.i18n.getText("filters"),content:[f]}).addStyleClass('sapUshellSearchFacetDialogMasterContainer');m.addEventDelegate({onAfterRendering:function(e){if(t.selectedAttribute){for(var i=0;i<f.getItems().length;i++){var l=f.getItems()[i];var b=l.getBindingContext().getObject();if(t.selectedAttribute===b.dimension){f.setSelectedItem(l);t.facetOnDisplayIndex=i;t.chartOnDisplayIndexByFilterArray.push(t.chartOnDisplayIndex);}else{t.chartOnDisplayIndexByFilterArray.push(0);}}}if(!f.getSelectedItem()){f.setSelectedItem(f.getItems()[0]);}var s=f.getSelectedItem();t.updateDetailPage(s);var a=document.createElement('style');a.type='text/css';a.innerHTML='.sapUshellSearchFacetDialogTabBarButton {} .sapUshellSearchFacetDialogTabBarHeader{} .red{ border-style:solid; border-width:1px;border-collapse: collapse; border-color:red;} .sapUshellSearchFacetBarChartLarge{padding:0 0.5rem  0 0.5rem;}';document.getElementsByTagName('head')[0].appendChild(a);$('.sapUshellSearchFacetDialog .sapMDialogScrollCont').height('100%');}});var M=[m];return M;},onMasterPageSelectionChange:function(e){var t=this;var l=e.mParameters.listItem;t.facetOnDisplayIndex=l.getParent().indexOfItem(l.getParent().getSelectedItem());t.setChartOnDisplayIndexForFacetListItem(t.facetOnDisplayIndex);t.updateDetailPage(l);},detailPagesFactory:function(i,c){var t=this;var f=c.oModel.getProperty(c.sPath).facetType;var d=t.getAttributeDataType(c.oModel.getProperty(c.sPath).dataType);var s=new sap.m.Select({items:[new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("notSorted"),key:"notSorted"}),new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("sortByCount"),key:"sortCount"}),new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("sortByName"),key:"sortName"})],selectedKey:"sortCount",change:function(E){t.onSelectChange(E);}}).addStyleClass('sapUshellSearchFacetDialogSettingsSelect');var C=new sap.m.CheckBox({text:"Show Selected on Top",enabled:false,select:function(E){t.onCheckBoxSelect(E);}});var S=new sap.ui.layout.VerticalLayout({content:[s,C]}).addStyleClass('sapUshellSearchFacetDialogSettingsContainer');S.setVisible(false);var l=new sap.m.List({includeItemInSelection:true,showNoData:false,showSeparators:sap.m.ListSeparators.None,selectionChange:function(E){t.onDetailPageSelectionChange(E);}});l.addStyleClass('sapUshellSearchFacetDialogDetailPageList');l.addStyleClass('largeChart0');if(f==="attribute"){l.setMode(sap.m.ListMode.MultiSelect);}var b={path:"items",factory:function(i,c){var u=c.oModel.getProperty(c.sPath);var v=new sap.m.StandardListItem({title:"{label}",tooltip:"{label}"+"  "+"{value}",info:"{valueLabel}",selected:u.selected});if(u.selected){c.oModel.addFilter(u);}return v;}};if(d==="number"){s.removeItem(2);}b.filters=new sap.ui.model.Filter("advanced",sap.ui.model.FilterOperator.NE,true);l.bindAggregation("items",b);l.setBusyIndicatorDelay(0);l.data('dataType',d);if(t.bShowCharts){l.addEventDelegate({onAfterRendering:function(E){t.hideSelectively(E,t,0);}});}var L,o,a;o=t.getBarChartPlaceholder();var B={path:"items",factory:function(i,c){var u=c.oModel.getProperty(c.sPath);var v=new sap.suite.ui.microchart.ComparisonMicroChartData({title:'{label}',value:'{value}',color:{path:'selected',formatter:function(w){var x=sap.m.ValueColor.Good;if(!w){x=sap.m.ValueColor.Neutral;}return x;}},displayValue:'{valueLabel}',customData:{key:"selected",value:"{selected}",writeToDom:true},press:function(E){t.onDetailPageSelectionChangeCharts(E);}});if(u.selected){c.oModel.addFilter(u);}return v;}};o.bindAggregation("data",B);o.setBusyIndicatorDelay(0);o.data('dataType',d);a=t.getPieChartPlaceholder();if(t.bShowCharts){L=new sap.m.ScrollContainer({height:'67.2%',horizontal:false,vertical:true,content:[l,o,a]});}else{L=new sap.m.ScrollContainer({height:'67.2%',horizontal:false,vertical:true,content:[l]});}L.addStyleClass('sapUshellSearchFacetDialogDetailPageListContainer');L.addStyleClass('searchFacetLargeChartContainer');var e=new sap.m.StandardListItem({});var g=new sap.m.List({items:[e],showSeparators:sap.m.ListSeparators.None}).addStyleClass('sapUshellSearchFacetDialogDetailPageSettingSeparator');g.addEventDelegate({onAfterRendering:function(E){$('.sapUshellSearchFacetDialogDetailPageSettingSeparator').attr("aria-hidden","true");}});var h=new sap.m.StandardListItem({});var j=new sap.m.List({items:[h],showSeparators:sap.m.ListSeparators.None}).addStyleClass('sapUshellSearchFacetDialogDetailPageSeparator');j.setShowSeparators(sap.m.ListSeparators.All);var A=t.advancedConditionFactory(d);var k=new sap.m.ScrollContainer({height:'30%',horizontal:false,vertical:true,content:[A]});k.addStyleClass('sapUshellSearchFacetDialogDetailPageAdvancedContainer');if(d==="string"||d==="text"){var p=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,press:function(E){t.onPlusButtonPress(E,d);}});k.addContent(p);}k.data('dataType',d);k.data('initial',true);var P;if(d==="string"||d==="text"){L.setHeight('98%');k.setHeight('100%');var m=t.getDropDownButton();var n=new sap.m.Toolbar({content:[new sap.m.SearchField({placeholder:sap.ushell.resources.i18n.getText("filterPlaceholder"),liveChange:function(E){t.onSearchFieldLiveChange(E);}}),new sap.m.ToggleButton({icon:"sap-icon://sort",press:function(E){t.onSettingButtonPress(E);}}).addStyleClass('sapUshellSearchFacetDialogSortButton')]}).addStyleClass('sapUshellSearchFacetDialogSubheaderToolbar');if(t.bShowCharts){n.addContent(m);}var T=new sap.m.Page({showHeader:false,subHeader:n,content:[S,g,L]}).addStyleClass('sapUshellSearchFacetDialogDetailPage');var I=new sap.m.IconTabBar({upperCase:true,expandable:false,stretchContentHeight:true,applyContentPadding:false,select:function(E){var u=$(".sapUshellSearchFacetDialogFacetList")[0];var F=sap.ui.getCore().byId(u.id);if(!F.getSelectedItem()){F.setSelectedItem(F.getItems()[0]);}F.fireSelectionChange({listItem:F.getSelectedItem()});t.controlChartVisibility(t,t.chartOnDisplayIndex);},items:[new sap.m.IconTabFilter({text:sap.ushell.resources.i18n.getText("selectFromList"),content:[T]}),new sap.m.IconTabFilter({text:sap.ushell.resources.i18n.getText("defineCondition"),content:[k]})]});I.addStyleClass('sapUshellSearchFacetDialogIconTabBar');P=new sap.m.Page({showHeader:true,title:c.oModel.getProperty(c.sPath).title,content:[I]});P.addStyleClass('sapUshellSearchFacetDialogDetailPageString');}else{if(t.bShowCharts){var q,r;r=c.oModel.getProperty(c.sPath).title;q=t.getHeaderWithDropDown(r);P=new sap.m.Page({showHeader:true,headerContent:q,content:[S,g,L,j,k]});}else{P=new sap.m.Page({showHeader:true,title:c.oModel.getProperty(c.sPath).title,content:[S,g,L,j,k]});}P.addStyleClass('sapUshellSearchFacetDialogDetailPage');}return P;},getHeaderWithDropDown:function(t){var a=this;var c=a.getDropDownButton();var l=new sap.m.Label({text:t});var h=new sap.m.Bar({translucent:true,design:sap.m.BarDesign.Header,contentMiddle:[l,c]});h.addStyleClass("sapUshellSearchFacetDialogTabBarHeader");return h;},getBarChartPlaceholder:function(){var t=this;var c;c=new sap.suite.ui.microchart.ComparisonMicroChart({width:"90%",tooltip:""});c.addStyleClass('largeChart1barchart');c.addEventDelegate({onAfterRendering:function(e){t.hideSelectively(e,t,1);}});return c;},getBarChartPlaceholder2:function(){var t=this;var c;var b={};c=new sap.ushell.renderers.fiori2.search.controls.SearchFacetBarChart(b);c.addStyleClass('largeChart1barchart');c.addEventDelegate({onAfterRendering:function(e){t.hideSelectively(e,t,1);}});return c;},getPieChartPlaceholder:function(){var t=this;var c;var p={};p.oSearchFacetDialog=t;c=new sap.ushell.renderers.fiori2.search.controls.SearchFacetPieChart(p);c.addStyleClass('largeChart2piechart');c.addEventDelegate({onAfterRendering:function(e){t.hideSelectively(e,t,2);}});sap.ui.core.ResizeHandler.register(c,function(e){var s=parseInt(window.getComputedStyle(e.target.firstChild,null).getPropertyValue("transform-origin").split(" ")[0],10);var m=(e.size.width/2)-s;e.target.firstChild.style.marginLeft=m+"px";});return c;},getDropDownButton:function(){var t=this;var b=[];var B;var d=new sap.m.Button({icon:t.tabBarItems[t.chartOnDisplayIndex].getIcon()});for(var i=0;i<t.tabBarItems.length;i++){B=new sap.m.Button({text:t.tabBarItems[i].getText(),icon:t.tabBarItems[i].getIcon(),press:function(E){var f,g;g=E.getSource().sId;f=document.getElementById(g).dataset.facetViewIndex;f=parseInt(f,10);t.chartOnDisplayIndex=f;t.chartOnDisplayIndexByFilterArray[t.facetOnDisplayIndex]=f;var h=t.tabBarItems[t.chartOnDisplayIndex].getIcon();d.setIcon(h);var c=t.tabBarItems[t.chartOnDisplayIndex].getText();var e=sap.ushell.resources.i18n.getText('displayAs',[c]);d.setTooltip(e);var j=$(".sapUshellSearchFacetDialogFacetList")[0];var F=sap.ui.getCore().byId(j.id);if(!F.getSelectedItem()){F.setSelectedItem(F.getItems()[0]);}F.fireSelectionChange({listItem:F.getSelectedItem()});t.controlChartVisibility(t,f);}});B.data("facet-view-index",""+i,true);b.push(B);}var a=new sap.m.ActionSheet({showCancelButton:true,buttons:b,placement:sap.m.PlacementType.Bottom,cancelButtonPress:function(){jQuery.sap.log.info("sap.m.ActionSheet: cancelButton is pressed");}});if($(".sapUiSizeCompact")[0]){a.addStyleClass("sapUiSizeCompact");}d.addStyleClass("sapUshellSearchFacetDialogTabBarButton");var c=t.tabBarItems[t.chartOnDisplayIndex].getText();var e=sap.ushell.resources.i18n.getText('displayAs',[c]);d.setTooltip(e);d.attachPress(function(E){a.openBy(this);});return d;},resetIcons:function(){var t=this;var i,a,d,b,c,e;b=t.tabBarItems[t.chartOnDisplayIndex].getIcon();c=t.tabBarItems[t.chartOnDisplayIndex].getText();e=sap.ushell.resources.i18n.getText('displayAs',[c]);a=$('.sapUshellSearchFacetDialogTabBarButton');for(var k=0;k<a.length;k++){i=a[k].id;d=sap.ui.getCore().byId(i);d.setIcon(b);d.setTooltip(e);}},advancedConditionFactory:function(t){var a=this;var A=new sap.m.CheckBox({select:function(e){if(t==="string"||t==="text"){a.updateCountInfo(e.getSource().getParent().getParent().getParent().getParent().getParent().getParent());}else{a.updateCountInfo(e.getSource().getParent().getParent().getParent());}}}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionCheckBox');var i,b,I,s;switch(t){case'date':i=new sap.m.DateRangeSelection({width:'90%',change:function(e){a.onDateRangeSelectionChange(e);}}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionInput');break;case'string':A.setVisible(false);I=new sap.m.Input({width:'57%',placeholder:sap.ushell.resources.i18n.getText("filterCondition")}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionInput');s=new sap.m.Select({width:'40%',items:[new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("equals"),key:'eq'}),new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("beginsWith"),key:'bw'}),new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("endsWith"),key:'ew'}),new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("contains"),key:'co'})]}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionSelect');i=new sap.ui.layout.HorizontalLayout({allowWrapping:true,content:[s,I]});b=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(e){a.onDeleteButtonPress(e);}});break;case'text':A.setVisible(false);I=new sap.m.Input({width:'57%',placeholder:sap.ushell.resources.i18n.getText("filterCondition")}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionInput');s=new sap.m.Select({width:'40%',items:[new sap.ui.core.Item({text:sap.ushell.resources.i18n.getText("containsWords"),key:'co'})]}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionSelect');i=new sap.ui.layout.HorizontalLayout({allowWrapping:true,content:[s,I]});b=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(e){a.onDeleteButtonPress(e);}});break;case'number':var o=new sap.m.Input({width:'46.5%',liveChange:function(e){a.onAdvancedNumberInputChange(e);},type:sap.m.InputType.Number}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionInput');var c=new sap.m.Input({width:'46.5%',liveChange:function(e){a.onAdvancedNumberInputChange(e);},type:sap.m.InputType.Number}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionInput');var l=new sap.m.Label({text:'...'}).addStyleClass('sapUshellSearchFacetDialogDetailPageConditionLabel');i=new sap.ui.layout.HorizontalLayout({allowWrapping:true,content:[o,l,c]});break;default:break;}var d=new sap.ui.layout.HorizontalLayout({allowWrapping:true,content:[A,i,b]}).addStyleClass('sapUshellSearchFacetDialogDetailPageCondition');return d;},onDetailPageSelectionChangeCharts:function(e){var t=this;var c=0;var a,m,d,b,f,s,S,B,p,M;var g,n,i,o;if(e.getSource){a=e.getSource().getBindingContext();m=a.getModel();d=a.getObject();b=d.selected;f=b?false:true;s=e.getSource();S=s.getBindingContext().sPath+"/selected";m.setProperty(S,f);B=s.getBindingContext().getObject();if(f){m.addFilter(B);}else{m.removeFilter(B);}p=S.replace(/\/items.+/,'');p+="/items";g=m.getProperty(p);c=0;for(i=0;i<g.length;i++){n=g[i];if(n.selected===true){c++;}}}else{d=e.dataObject;b=d.selected;f=b?false:true;c=e.cnt;m=e.model;if(b){m.addFilter(d);}else{m.removeFilter(d);}}M=t.getFacetList();o=M.getSelectedItem();if(!o){o=M.getItems()[0];}o.setCounter(c);},onDetailPageSelectionChange:function(e){var t=this;var s=e.mParameters.listItem;var S=s.getBindingContext().sPath+"/selected";s.getBindingContext().oModel.setProperty(S,s.getSelected());var b=s.getBindingContext().getObject();if(s.getSelected()){t.getModel().addFilter(b);}else{t.getModel().removeFilter(b);}var l=e.oSource;var d;if(l.data('dataType')==="string"){d=l.getParent().getParent().getParent().getParent().getParent().getParent();}else{d=l.getParent().getParent();}t.updateCountInfo(d);var o=l.getParent().getParent().getContent()[t.settingContainerPosition];var c=o.getContent()[t.showOnTopCheckBoxPosition];var a=o.getContent()[t.sortingSelectPosition];if(c.getSelected()){c.setSelected(false);a.setSelectedKey("notSorted");}if(l.getSelectedContexts().length>0){c.setEnabled(true);}else{c.setEnabled(false);}},onSearchFieldLiveChange:function(e){var t=this;var f=e.getSource().getValue();var s=t.getFacetList().getSelectedItem();t.updateDetailPage(s,f);},onSettingButtonPress:function(e){var t=this;var p=e.oSource.getPressed();var s=e.oSource.getParent().getParent().getContent()[t.settingContainerPosition];var S=e.oSource.getParent().getParent().getContent()[t.settingSeparatorPosition];var l=e.oSource.getParent().getParent().getContent()[t.attributeListPosition];if(p){s.setVisible(true);S.setShowSeparators(sap.m.ListSeparators.All);l.setHeight('83%');}else{s.setVisible(false);S.setShowSeparators(sap.m.ListSeparators.None);l.setHeight('98%');}},onSelectChange:function(e){var t=this;t.sortingAttributeList(e.oSource.getParent().getParent());},onCheckBoxSelect:function(e){var t=this;t.sortingAttributeList(e.oSource.getParent().getParent());},onDateRangeSelectionChange:function(e){var t=this;var d=e.getSource();var a=d.getParent();var A=a.getContent()[0];if(d.getDateValue()&&d.getSecondDateValue()){A.setSelected(true);t.insertNewAdvancedCondition(a,"date");t.updateCountInfo(a.getParent().getParent());}else{A.setSelected(false);}},onAdvancedInputChange:function(e){var t=this;var i=e.getSource();var a=i.getParent().getParent();var A=a.getContent()[0];if(i.getValue()){A.setSelected(true);t.insertNewAdvancedCondition(a,"string");t.updateCountInfo(a.getParent().getParent().getParent().getParent().getParent());}else{A.setSelected(false);}},onAdvancedNumberInputChange:function(e){var t=this;var i=e.getSource();var a=i.getParent().getParent();var A=a.getContent()[0];if(i.getParent().getContent()[0].getValue()&&i.getParent().getContent()[2].getValue()){A.setSelected(true);t.insertNewAdvancedCondition(a,"number");t.updateCountInfo(a.getParent().getParent());}else{A.setSelected(false);}},onDeleteButtonPress:function(e){var t=this;var a=e.getSource().getParent();t.deleteAdvancedCondition(a);},onPlusButtonPress:function(e,t){var a=this;var A=e.getSource().getParent();var n=a.advancedConditionFactory(t);var i=A.getAggregation("content").length-1;A.insertAggregation("content",n,i);},onOkClick:function(e){var t=this;var M=t.getModel();var s=t.getModel('searchModel');s.resetFilterConditions(false);var d=t.oSplitContainer.getDetailPages();for(var m=0;m<M.aFilters.length;m++){var a=M.aFilters[m];if(!a.advanced){s.addFilterCondition(a.filterCondition,false);}}for(var i=0;i<d.length;i++){if(t.getFacetList().getItems()[i]){t.applyAdvancedCondition(d[i],t.getFacetList().getItems()[i].getBindingContext().getObject(),s);}}s.filterChanged=true;s._firePerspectiveQuery();},getFacetList:function(){var t=this;return t.oSplitContainer.getMasterPages()[0].getContent()[this.facetListPosition];},updateCountInfo:function(d){var t=this;var m=t.getFacetList();var M=m.getSelectedItem();if(!M){M=m.getItems()[0];}var s=M.getBindingContext().sPath;var D=M.getBindingContext().oModel.getProperty(s).dimension;var f=t.getModel().aFilters;var c=0;for(var j=0;j<f.length;j++){if(!f[j].advanced&&f[j].facetAttribute===D){c++;}}var a=t.getAttributeDataType(M.getBindingContext().oModel.getProperty(s).dataType);var A,b;if(a==="string"||a==="text"){if(!d.getContent()[0].getItems){return;}A=d.getContent()[0].getItems()[1].getContent()[0];b=A.getContent().length-1;}else{A=d.getContent()[t.advancedPosition];b=A.getContent().length;}var e=0;for(var i=0;i<b;i++){var C=A.getContent()[i];var o=C.getContent()[0];if(o.getSelected()){e++;}}var F=M.getBindingContext().oModel.getProperty(s).facetType;if(F==="attribute"){var g=c+e;if(g>0){M.setCounter(g);}else{M.setCounter(null);}}},sortingAttributeList:function(d){var t=this;var s=d.getContent()[t.settingContainerPosition];var S=s.getContent()[t.sortingSelectPosition];var c=s.getContent()[t.showOnTopCheckBoxPosition];var l=d.getContent()[t.attributeListPosition].getContent()[0];var b=l.getBinding("items");var a=[];if(c.getSelected()){a.push(new sap.ui.model.Sorter("selected",true,false));}switch(S.getSelectedKey()){case"sortName":a.push(new sap.ui.model.Sorter("label",false,false));break;case"sortCount":a.push(new sap.ui.model.Sorter("value",true,false));a.push(new sap.ui.model.Sorter("label",false,false));break;default:break;}b.sort(a);},getAttributeDataType:function(d){switch(d){case"Double":return"number";case"Timestamp":return"date";case"String":return"string";case"Text":return"text";default:return"string";}},insertNewAdvancedCondition:function(a,t){var b=this;var A=a.getParent();var n=b.advancedConditionFactory(t);if(t==="string"||t==="text"){var i=A.getAggregation("content").length-1;A.insertAggregation("content",n,i);}else{var c=A.indexOfAggregation("content",a);if(c===(A.getAggregation("content").length-1)){A.addContent(n);}}},deleteAdvancedCondition:function(a){var t=this;var A=a.getParent();var d=a.getParent().getParent().getParent().getParent().getParent();A.removeAggregation("content",a);t.updateCountInfo(d);},initiateAdvancedConditions:function(a,I,t){var b=this;var c,C,o,d;for(var i=I.length;i>0;i--){var e=I[i-1];if(e.advanced){c=a.getContent();if(t==="string"||t==="text"){C=c[c.length-2];}else{C=c[c.length-1];}o=C.getContent()[0];o.setSelected(true);d=C.getContent()[1];if(t==="number"){var f=d.getContent()[0];var g=d.getContent()[2];if(e.filterCondition.conditions){for(var j=0;j<e.filterCondition.conditions.length;j++){var h=e.filterCondition.conditions[j];if(h.operator===">="){f.setValue(h.value);}if(h.operator==="<="){g.setValue(h.value);}}}}else if(t==="string"){var s=e.label;if((s.charAt(0)==="*")&&(s.charAt(s.length-1)==="*")){d.getContent()[0].setSelectedKey('co');s=s.substring(1,s.length-1);}else if((s.charAt(0)==="*")){d.getContent()[0].setSelectedKey('ew');s=s.substring(1);}else if((s.charAt(s.length-1)==="*")){d.getContent()[0].setSelectedKey('bw');s=s.substring(0,s.length-1);}d.getContent()[1].setValue(s);}else if(t==="text"){var k=e.label;if((k.charAt(0)==="*")&&(k.charAt(k.length-1)==="*")){d.getContent()[0].setSelectedKey('co');k=k.substring(1,k.length-1);}d.getContent()[1].setValue(k);}else{d.setValue(e.label);}b.insertNewAdvancedCondition(C,t);b.getModel().changeFilterAdvaced(e,true);}}a.data('initial',false);},applyChartQueryFilter:function(e){var t=this;t.getModel().resetChartQueryFilterConditions();var d=t.oSplitContainer.getDetailPages();for(var i=0;i<d.length;i++){if(i===e||d[i].getContent().length===0||!d[i].getContent()[0].getItems){continue;}var l;if(!d[i].getContent()[t.attributeListPosition]){l=d[i].getContent()[0].getItems()[0].getContent()[0].getContent()[t.attributeListPosition].getContent()[0];}else{l=d[i].getContent()[t.attributeListPosition].getContent()[0];}for(var j=0;j<l.getItems().length;j++){var L=l.getItems()[j];var o=L.getBindingContext().getObject();var f=o.filterCondition;if(f.attribute||f.conditions){if(L.getSelected()){if(!t.getModel().chartQuery.getFilter().hasFilterCondition(f)){t.getModel().chartQuery.addFilterCondition(f);}}}}t.applyAdvancedCondition(d[i],t.getFacetList().getItems()[i].getBindingContext().getObject(),t.getModel().chartQuery);}},applyAdvancedCondition:function(d,f,a){var t=this;var A,D,o,k,b,c,e,g,C;if(d.getContent()[t.advancedPosition]){A=d.getContent()[t.advancedPosition];D=A.data('dataType');o=d.getContent()[t.advancedPosition].getContent();switch(D){case'date':for(k=0;k<o.length;k++){b=o[k];c=b.getContent()[0];var h=b.getContent()[1];if(c.getSelected()&&h.getDateValue()&&h.getSecondDateValue()){var F={"pattern":"yyyy-MM-dd HH:mm:ss.SSSSSSS","UTC":true};var s={"pattern":"yyyy-MM-dd HH:mm:ss.SSSSSSS","UTC":true};var i=sap.ui.core.format.DateFormat.getDateTimeInstance(F).format(h.getDateValue());var j=sap.ui.core.format.DateFormat.getDateTimeInstance(s).format(new Date(h.getSecondDateValue().getTime()+86400000-1));e=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:">=",value:i,label:i});g=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:"<=",value:j,label:j});C=t.getModel().sina.createFilterConditionGroup();C.label=h.getValue();C.conditions[0]=e;C.conditions[1]=g;a.addFilterCondition(C,false);}}break;case'number':for(k=0;k<o.length;k++){b=o[k];c=b.getContent()[0];var l=b.getContent()[1].getContent()[0];var m=b.getContent()[1].getContent()[2];var n=b.getContent()[1].getContent()[1];if(c.getSelected()&&l.getValue()&&m.getValue()){e=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:">=",value:l.getValue(),label:l.getValue()});g=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:"<=",value:m.getValue(),label:m.getValue()});C=t.getModel().sina.createFilterConditionGroup();C.label=l.getValue()+n.getText()+m.getValue();C.conditions[0]=e;C.conditions[1]=g;a.addFilterCondition(C,false);}}break;default:break;}}else{A=d.getContent()[0].getItems()[1].getContent()[0];D=A.data('dataType');o=A.getContent();var p,q,r,u;switch(D){case'string':for(k=0;k<o.length-1;k++){b=o[k];p=b.getContent()[1].getContent()[0];q=b.getContent()[1].getContent()[1];switch(p.getSelectedKey()){case'eq':r=q.getValue();break;case'ew':r="*"+q.getValue();break;case'bw':r=q.getValue()+"*";break;case'co':r="*"+q.getValue()+"*";break;default:break;}if(q.getValue()){u=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:"=",value:r,label:r});a.addFilterCondition(u,false);}}break;case'text':for(k=0;k<o.length-1;k++){b=o[k];p=b.getContent()[1].getContent()[0];q=b.getContent()[1].getContent()[1];r=q.getValue();var O;switch(p.getSelectedKey()){case'co':O="=";break;case'nco':O="!=";break;default:break;}if(q.getValue()){u=t.getModel().sina.createFilterCondition({attribute:f.dimension,attributeLabel:f.title,operator:O,value:r,label:r});a.addFilterCondition(u,false);}}break;default:break;}}},updateDetailPageCharts:function(i,m){var t=this;if(t.bShowCharts===false){return;}t.aItemsForBarChart=i;var l=t.getListContainersForDetailPage();var L=l[1];var c=L.getContent();if(c&&t.chartOnDisplayIndex===1){}if(c&&t.chartOnDisplayIndex===2){var p=c[2];var e=l[5];var r=l[2];r=0.9*r;var a={};a.relevantContainerHeight=r;a.oSearchFacetDialog=t;var M=new sap.ui.model.json.JSONModel();M.setData(i);$("#"+e.id).empty();p.directUpdate(i,e,M,a);}var b,d;if(c&&t.chartOnDisplayIndex!==2){b=l[0].firstChild.children[2];d=$("#"+b.id);d.css("display","none");}if(c&&t.chartOnDisplayIndex!==1){b=l[0].firstChild.children[1];d=$("#"+b.id);d.css("display","none");}},controlChartVisibility:function(c,a){var t=this;var e,b;if(t.bShowCharts===false){return;}var l=c.getListContainersForDetailPage();var L=l[1];var d=L.getContent();for(var i=0;i<d.length;i++){e=l[0].firstChild.children[i];b=$("#"+e.id);if(i!==a){b.css("display","none");}else{b.css("display","block");}}if(a===2){var I=t.aItemsForBarChart;var m=t.getModel();t.updateDetailPageCharts(I,m);}if(a===2){L.setVertical(false);}else{L.setVertical(true);}var s=l[6];if(s){var f=$("#"+s.sId);if(a===0){f.css("display","block");}else{f.css("display","none");}}},hideSelectively:function(e,c,a){var b=$("#"+e.srcControl.sId);var d=c.chartOnDisplayIndex;var l=c.getListContainersForDetailPage();var L=l[1];if(d!==undefined){if(c.chartOnDisplayIndex!==a){b.css("display","none");}else{b.css("display","block");}}else{b.css("display","block");}if(d===2){L.setVertical(false);}else{L.setVertical(true);}var s=l[6];if(s){var f=$("#"+s.sId);if(d===0){f.css("display","block");}else{f.css("display","none");}}},getListContainersForDetailPage:function(){var r=0;var a=440;var s=$(".searchFacetLargeChartContainer");for(var i=0;i<s.length;i++){if(s[i].clientHeight>0){a=s[i].offsetParent.offsetParent.offsetParent.clientHeight;r=i;break;}}var c=$(".searchFacetLargeChartContainer")[r];var l=sap.ui.getCore().byId(c.id);var b,S,o;try{b=$(".sapUshellSearchFacetDialogSubheaderToolbar")[r];S=sap.ui.getCore().byId(b.id);o=S.getContent()[1];}catch(e){}return[c,l,a,c.firstChild.children[0],c.firstChild.children[1],c.firstChild.children[2],o];},updateDetailPage:function(l,f){var t=this;var m=t.getModel();var s=t.getModel('searchModel');var b=l.getBindingContext().sPath;var S=m.getProperty(b);var d=t.getAttributeDataType(S.dataType);var i=t.getFacetList().indexOfAggregation("items",l);var D=t.oSplitContainer.getDetailPages()[i];var o,a,c;if(d==="string"||d==="text"){o=D.getContent()[0].getItems()[0].getContent()[0].getContent()[t.attributeListPosition].getContent()[0];a=D.getContent()[0].getItems()[1].getContent()[0];c=D.getContent()[0].getItems()[0].getContent()[0].getContent()[t.settingContainerPosition];}else{o=D.getContent()[t.attributeListPosition].getContent()[0];a=D.getContent()[t.advancedPosition];c=D.getContent()[t.settingContainerPosition];}var n=D.getId();t.oSplitContainer.toDetail(n,"show");t.resetIcons();o.setBusy(true);var p={sAttribute:S.dimension,sBindingPath:b};t.applyChartQueryFilter(i);if(f){var e=m.sina.createFilterCondition({attribute:S.dimension,operator:"=",value:f+"*"});m.chartQuery.addFilterCondition(e);}else if(f===undefined){if(d==="string"||d==="text"){D.getContent()[0].getItems()[0].getContent()[0].getSubHeader().getContent()[0].setValue('');}}m.chartQuery.setSearchTerms(s.getSearchBoxTerm());m.facetDialogSingleCall(p).done(function(){var I=m.getProperty(D.getBindingContext().sPath).items;if(a.data('initial')){t.initiateAdvancedConditions(a,I,a.data('dataType'));}var C=c.getContent()[t.showOnTopCheckBoxPosition];if(o.getSelectedContexts().length>0){C.setEnabled(true);}t.updateDetailPageListItemsSelected(o,a);t.updateDetailPageCharts(I,m);});},updateDetailPageListItemsSelected:function(d,a){var t=this;t.updateDetailPageListItemsSelectedForListView(d,a);},updateDetailPageListItemsSelectedForListView:function(d,a){var t=this;var D=a.data('dataType');for(var j=0;j<d.getItems().length;j++){var l=d.getItems()[j];var L=l.getBindingContext().getObject();if(d.getModel().hasFilter(L)){l.setSelected(true);d.getModel().changeFilterAdvaced(L,false);t.removeAdvancedCondition(a,l,D);}else{l.setSelected(false);}var s=l.getBindingContext().sPath+"/selected";l.getBindingContext().oModel.setProperty(s,l.getSelected());}t.sortingAttributeList(d.getParent().getParent());d.setBusy(false);if(D==="date"){d.focus();}},removeAdvancedCondition:function(a,l,t){var c=a.getContent();var C,I,b;if(t==="string"||t==="text"){for(var i=0;i<c.length-1;i++){C=c[i];I=C.getContent()[1].getContent()[1];if(I.getProperty('value')){var v=I.getValue();var L=l.getBindingContext().getObject();if(v===L.filterCondition.value){b=i;break;}}}}a.removeContent(b);}});})();
