/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/m/DatePicker","sap/m/FlexItemData","sap/m/FlexJustifyContent","sap/m/HBox","sap/m/Input","sap/m/InputType","sap/m/Select","sap/m/Text","sap/ui/core/Renderer","sap/ui/core/TextAlign","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","./ODataTypes","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/ui/core/ValueState","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController"],function(q,T,L,C,a,D,F,b,H,I,c,S,d,R,e,f,g,h,O,i,j,k,l,m,V,o,p){"use strict";var r=g.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(M,P,n){g.apply(this,[M,P]);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=n;this._oHelper=new i(M,this._oBinding);this._oFieldControl=new h(P,this._oHelper);this._oTypes=new j(P);this._oSelector=new O(this._oMetaData,P,this._oTypes);this._bInitialized=false;this.bPending=false;}});r.prototype._init=function(M){this._oMetaData.model=M.model;this._oMetaData.path=M.path;this._oMetaData.entitySet=M.entitySetObject||this._oHelper.oMeta.getODataEntitySet(M.entitySet);this._oMetaData.entityType=M.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=M.navigationPath||null;if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);if(this._oMetaData.property&&this._oMetaData.property.property){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=this._oHelper.getAnalyzer().getSemanticObjectAnnotationFromProperty(this._oMetaData.property.property);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom);}this._oHelper.getUOMTextAnnotation(this._oMetaData);}else{q.sap.log.warning("SmartField: Property "+M.path+" does not exist","SmartField: Property "+M.path+" does not exist","sap.ui.comp.smartfield.ODataControlFactory");}}else{this._oMetaData.modelObject=M.modelObject;this._oMetaData.property=M.property;this._oMetaData.annotations.text=M.annotations.text;this._oMetaData.annotations.uom=M.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={};}this._oMetaData.annotations.valuelist=M.annotations.valuelist;this._oMetaData.annotations.valuelistType=M.annotations.valuelistType;this._oMetaData.annotations.lineitem=M.annotations.lineitem;this._oMetaData.annotations.semantic=M.annotations.semantic;this._oMetaData.annotations.valuelistuom=M.annotations.valuelistuom;}};r.prototype._createEdmDisplay=function(){var n,s,A,t,M,u,v,w,x=this,N={width:true,textAlign:true};n=this._oParent.data("configdata");var y=((n&&(n.isInnerControl!==true))||(this._oParent.getControlContext()==="table")||(this._oParent.getControlContext()==="responsiveTable"));var z=this._oSelector.checkComboBox(y);if(z&&z.combobox){return this._createComboBox({annotation:z.annotation,noDialog:true,noTypeAhead:true},true);}if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink();}A=this.createAttributes(null,this._oMetaData.property,N);u=this._oSelector.checkDatePicker();if(u){t=this.getFormatSettings("dateFormatSettings");A.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,t,{displayFormat:"Date"})};}else{A.text={model:this._oMetaData.model,path:this._oHelper.getEdmDisplayPath(this._oMetaData),type:this._oTypes.getType(this._oMetaData.property)};}if(this._oMetaData.property&&this._oMetaData.property.property){M=this._oHelper.oAnnotation.isMasked(this._oMetaData.property.property);if(M){A.text.formatter=function(G){if(G){return G.replace(new RegExp(".","igm"),"*");}return G;};}w=this._oHelper.oAnnotation.getText(this._oMetaData.property.property);if(w){v=this._oSelector.useObjectIdentifier(u,M);if(v){delete A.width;delete A.textAlign;A.text={path:this._oMetaData.path};A.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){A.titleActive=true;A.titlePress=function(G){x._oParent.firePress(G);};}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.semanticObject){var B;var E;p.getDistinctSemanticObjects().then(function(G){B=p.hasDistinctSemanticObject(x._oMetaData.annotations.semantic.semanticObject,G);if(B){var J=x._oParent.getBindingInfo("value");var P=J.parts[0].path;var K=x._oMetaData.property.property["sap:label"];if(x._oMetaData.annotations.lineitem&&x._oMetaData.annotations.lineitem.labels&&x._oMetaData.annotations.lineitem.labels[P]){K=x._oMetaData.annotations.lineitem.labels[P];}q.sap.require("sap.ui.comp.navpopover.NavigationPopoverHandler");E=new sap.ui.comp.navpopover.NavigationPopoverHandler({semanticObject:x._oMetaData.annotations.semantic.semanticObject,semanticObjectLabel:K,fieldName:P});}});A.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects/"+this._oMetaData.annotations.semantic.semanticObject,formatter:function(G){return!!G;}};A.titlePress=function(G){if(B&&E){E.setControl(G.getSource());E.openPopover();}};}}else{if(!(n&&(n.isInnerControl===true))){A.text={};A.text.parts=[];A.text.parts.push(this._oMetaData.path);A.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));A.text.formatter=function(G,J){return x._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",G,J);};}}}else if(this._oSelector.checkCheckBox()){A.text.formatter=function(G){return x._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",G);};}}if(v){s=new l(A);if(this._oMetaData.annotations.semantic){s.setModel(p.getJSONModel(),"$sapuicompsmartfield_distinctSO");}}else{if(A.text.type&&(A.text.type instanceof sap.ui.comp.smartfield.type.DateTime)&&A.text.type.oConstraints&&A.text.type.oConstraints.isDateOnly){A.wrapping=false;}if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){A.textDirection="LTR";}s=new d(A);}if(!v&&n&&n.configdata&&n.configdata.onText){n.configdata.onText(s);}return{control:s,onCreate:"_onCreate",params:{noValidations:true}};};r.prototype._createEdmTime=function(){var A,n,N={placeholder:true,valueState:true,valueStateText:true};A=this.createAttributes("value",this._oMetaData.property,N,{event:"change"});A.valueFormat="HH:mm:ss";n=new o(A);return{control:n,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._createObjectStatus=function(){var A,t,n;A=this.createAttributes(null,this._oMetaData.property,null);t=this._oHelper.oAnnotation.getText(this._oMetaData.property.property);if(t){A.text={parts:[]};A.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));}else{A.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}this._addObjectStatusAttributes(A);n=new m(A);return{control:n,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}};};r.prototype._addObjectStatusAttributes=function(A){var n,P,s,t,u;P=this._oParent.getControlProposal();u=P.getObjectStatus();if(u){n=u.getBindingInfo("criticality");}s=function(v){var w,x;x={0:V.None,1:V.Error,2:V.Warning,3:V.Success};w={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":V.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":V.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":V.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":V.Success};if(v){return w[v]||x[v]||V.None;}return V.None;};t=function(){var v,w={"Error":"sap-icon://status-negative","Warning":"sap-icon://status-critical","Success":"sap-icon://status-positive","None":"sap-icon://status-inactive"};if(n){if(n.formatter){v=n.formatter.apply(null,arguments);}else{v=arguments[0];}}else{v=u.getCriticality();}if(v){return w[s(v)];}return null;};if(n){A.state={formatter:function(){var v;if(n.formatter){v=n.formatter.apply(null,arguments);}else{v=arguments[0];}return s(v);},parts:n.parts};if(u.getCriticalityRepresentationType()!=sap.ui.comp.smartfield.CriticalityRepresentationType.WithoutIcon){A.icon={formatter:t,parts:n.parts};}}else{if(u){A.state=s(u.getCriticality());}A.icon=t();}};r.prototype._createEdmString=function(){var M,n,s,A,t,u,N={width:true,textAlign:true,placeholder:true,name:true,valueState:true,valueStateText:true};if(this._oSelector.checkCheckBox()){return this._createCheckBox();}t=this._oSelector.checkSelection();if(t.selection){return this._createSelect({annotation:t.annotation,noDialog:true,noTypeAhead:true});}t=this._oSelector.checkComboBox();if(t.combobox){return this._createComboBox({annotation:t.annotation,noDialog:true,noTypeAhead:true});}if(this._oMetaData.property&&this._oMetaData.property.property){n=this._oHelper.oAnnotation.isMultiLineText(this._oMetaData.property.property);if(n){delete N["width"];return this._createMultiLineText(N);}}A=this.createAttributes("value",this._oMetaData.property,N);this._addMaxLength(A,t.annotation);u=new I(A);if(this._oMetaData.property&&this._oMetaData.property.property){M=this._oHelper.oAnnotation.isMasked(this._oMetaData.property.property);if(M){u.setType(c.Password);}this._handleEventingForEdmString(u,this._oMetaData.property);}s=this._oParent.data("configdata");if(s&&s.configdata){if(s.configdata.onInput){s.configdata.onInput(u);}}return{control:u,onCreate:"_onCreate",params:{valuehelp:{annotation:t.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._addMaxLength=function(A,n){var B,M;B=this._oParent.getBindingInfo("value");M=this._oTypes.getMaxLength(this._oMetaData.property,B);if(M>0){if(!n||!this._oParent.getShowSuggestion()){A.maxLength=M;}}};r.prototype._addAriaLabelledBy=function(n){var s,t,u;if((this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.None)||(this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.Form)||(this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.SmartFormGrid)){g.prototype._addAriaLabelledBy.apply(this,arguments);u=this._oParent.data("configdata");if(u&&u.configdata.isInnerControl&&u.configdata.isUOM){if(n){t=n.control;if(t instanceof H){if(t.getItems().length>0){t=t.getItems()[0];}}}if(t&&t.getAriaLabelledBy&&t.getAriaLabelledBy().length===0){if(this._oHelper.oAnnotation.getLabel(this._oMetaData.property.property)){q.sap.require("sap.ui.core.InvisibleText");s=new sap.ui.core.InvisibleText({text:this._oHelper.oAnnotation.getLabel(this._oMetaData.property.property)});t.addAriaLabelledBy(s);this._oParent.addAggregation("_ariaLabelInvisibleText",s);}}}}};r.prototype._handleEventingForEdmString=function(n,P){var u,t=this;if(n){u=this._oHelper.oAnnotation.isUpperCase(P.property);n.attachChange(function(E){var N={};if(E&&E.mParameters){var v=E.mParameters.value;if(u&&v){v=v.toUpperCase();n.setValue(v);}N.value=v;N.newValue=v;if(E.mParameters.validated){N.validated=E.mParameters.validated;}if(n._oSuggestionPopup&&n._oSuggestionPopup.isOpen()){if(!E.mParameters.validated){if(n._iPopupListSelectedIndex>=0){return;}}}try{t._oParent.fireChange(N);}catch(s){q.sap.log.warning(s);}}});}};r.prototype._createComboBox=function(v,n){var s=null,t;var A,N={width:true,textAlign:true,placeholder:true,name:true};t=this._oParent.data("configdata");A=this.createAttributes("selectedKey",this._oMetaData.property,N);A.selectionChange=this._oHelper.getSelectionChangeHandler(this._oParent);if(A.width===""){A.width="100%";}if(n){s=this._createDisplayedComboBox(A);}else{s=new a(A);}if(t&&t.configdata&&t.configdata.onText){t.configdata.onText(s);}return{control:s,onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};r.prototype._createDisplayedComboBox=function(A){var n=a.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp"},renderer:function(s,t){var w=t.getWidth(),u=t.getValue(),v=t.getTextDirection(),x=t.getTextAlign();u.replace(/\r\n/g,"\n");s.write("<span");s.writeControlData(t);s.addClass("sapMText");s.addClass("sapUiSelectable");if(w){s.addStyle("width",w);}else{s.addClass("sapMTextMaxWidth");}if(v!==sap.ui.core.TextDirection.Inherit){s.writeAttribute("dir",v.toLowerCase());}if(x){x=R.getTextAlign(x,v);if(x){s.addStyle("text-align",x);}}s.writeClasses();s.writeStyles();s.write(">");s.writeEscaped(u);s.write("</span>");},updateDomValue:function(v){if(!this.isActive()){return this;}v=this._getInputValue(v);if(this.$().text()!==v){this.$().text(v);this._bCheckDomValue=true;}return this;}});return new n(A);};r.prototype._createSelect=function(v){var A,n={width:true,name:true};A=this.createAttributes("selectedKey",this._oMetaData.property,n);A.change=this._oHelper.getSelectionChangeHandler(this._oParent);A.forceSelection=false;if(A.width===""){A.width="100%";}return{control:new S(A),onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};r.prototype._createCheckBox=function(){var A=this.createAttributes("selected",null,{},{event:"select",parameter:"selected"});A.editable=(this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable());A.selected.type=this._oTypes.getAbapBoolean();return{control:new C(A),onCreate:"_onCreate",params:{getValue:"getSelected"}};};r.prototype._createEdmDateTime=function(){var A,n,N={width:true,textAlign:true,placeholder:true,name:true};A=this.createAttributes(null,this._oMetaData.property,N,{event:"change",parameter:"value"});n=this.getFormatSettings("dateFormatSettings");if(this._oSelector.checkDatePicker()){A.value={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n,{displayFormat:"Date"}),model:this._oMetaData.model};if(n&&n.style){A.displayFormat=n.style;}return{control:new D(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};}A.value={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,n)};return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._createEdmDateTimeOffset=function(){var n=this.getFormatSettings("dateFormatSettings");if(n){n.UTC=false;}var N={width:true,textAlign:true,placeholder:true,name:true};var A=this.createAttributes(null,this._oMetaData.property,N,{event:"change",parameter:"value"});A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n)};return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._createEdmNumeric=function(){var A,n={width:true,textAlign:true,placeholder:true,name:true};A=this.createAttributes("value",this._oMetaData.property,n,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){A.textDirection="LTR";}return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._createEdmUOM=function(){var P,n,t,A,s,u,B,v,w=this;A=this._createEdmUOMAttributes();s=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,s);var x=false;if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){x=true;}if(x){A.textDirection="LTR";}n=new I(A);if(this._oParent.data("suppressUnit")==="true"){u={getValue:"getValue"};if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){u.type={type:A.value.type,property:this._oMetaData.property};}return{control:n,onCreate:"_onCreate",params:u};}if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){v={type:A.value.type,property:this._oMetaData.property};}P=this._oHelper.getUOMPath(this._oMetaData);A={value:{model:this._oMetaData.model,path:P},change:this._oHelper.getUOMChangeHandler(this._oParent,true),textAlign:this._getEdmUOMTextAlignment()};this.addObjectBinding(A,s);this.mapBindings(A,{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory","contextEditable":"contextEditable"});if(this._oParent.getConfiguration()){A.configuration=new sap.ui.comp.smartfield.Configuration({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()});}t=new sap.ui.comp.smartfield.SmartField(A);t.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:P,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(y){n.setLayoutData(new F({growFactor:1}));t.setLayoutData(new F({shrinkFactor:0}));if(y){if(x&&y.setTextDirection){y.setTextDirection("LTR");}if((w._oParent.getControlContext()!=="table")&&(w._oParent.getControlContext()!=="responsiveTable")){y.addStyleClass("sapUiCompSmartFieldUnit");}}},onInput:function(y){n.setLayoutData(new F({growFactor:1}));t.setLayoutData(new F({growFactor:0}));if(y){if(x&&y.setTextDirection){y.setTextDirection("LTR");}if(w._oParent&&(w._oParent.getControlContext()!=="table")&&(w._oParent.getControlContext()!=="responsiveTable")){y.addStyleClass("sapUiCompSmartFieldUnit");}}}}});t.data("errorCheck","setComplexClientErrorSecondOperandNested");n.addStyleClass("smartFieldPaddingRight");n.addStyleClass("sapUiCompSmartFieldValue");B=new H({justifyContent:b.End,items:[n,t],fitContainer:true,width:this._oParent.getWidth()});B.addStyleClass("sapUiCompUOM");if(this._oParent.isContextTable()){if(x){B.addStyleClass("sapUiCompDirectionLTR");}B.addStyleClass("sapUiCompUOMInTable");}return{control:B,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:v}};};r.prototype._createEdmUOMAttributes=function(){var A={textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),change:this._oHelper.getUOMChangeHandler(this._oParent)};if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A.value={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],model:this._oMetaData.model,type:this._oTypes.getCurrencyType(this._oMetaData.property)};}else{A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}return A;};r.prototype._getEdmUOMTextAlignment=function(){var A=this.getAttribute("textAlign");if(!A){A=e.Initial;}if(A===e.Initial){if(this._oParent.isContextTable()){return e.End;}else{return e.Begin;}}return A;};r.prototype._createEdmUOMDisplay=function(){var v,P,n,A,s,B,t=null,u=this;s=this._getEdmUOMTextAlignment();var w=false;if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){w=true;}P=this._oHelper.getUOMPath(this._oMetaData);A={text:{parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:P}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter(this._oMetaData.property.property,this._oHelper.oAnnotation.isCurrency(this._oMetaData.property.property)),useRawValues:true},textAlign:s};if(w){A.textDirection="LTR";}n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);v=new d(A);P=this._oHelper.getUOMPath(this._oMetaData);A={value:{model:this._oMetaData.model,path:P},change:this._oHelper.getUOMChangeHandler(this._oParent,true),textAlign:this._getEdmUOMTextAlignment()};this.addObjectBinding(A,n);this.mapBindings(A,{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory","contextEditable":"contextEditable"});v.addStyleClass("smartFieldPaddingRight");v.addStyleClass("sapUiCompSmartFieldValue");if(!this._checkSuppressUnit()){t=new sap.ui.comp.smartfield.SmartField(A);t.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:P,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(x){if(x){if(x.setWrapping){x.setWrapping(false);}if(w&&x.setTextDirection){x.setTextDirection("LTR");}if(u._oParent&&(u._oParent.getControlContext()!=="table")&&(u._oParent.getControlContext()!=="responsiveTable")){x.addStyleClass("sapUiCompSmartFieldUnit");}}},onInput:function(x){v.setLayoutData(new F({growFactor:0}));t.setLayoutData(new F({growFactor:0}));if(x){if(w&&x.setTextDirection){x.setTextDirection("LTR");}if((u._oParent.getControlContext()!=="table")&&(u._oParent.getControlContext()!=="responsiveTable")){x.addStyleClass("sapUiCompSmartFieldUnit");}}},getContextEditable:function(){return u._oParent.getContextEditable();}}});t.data("errorCheck","setComplexClientErrorSecondOperandNested");B=new H({items:[v,t],fitContainer:true,width:this._oParent.getWidth()});if(this._oParent.isContextTable()){B.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(w){B.addStyleClass("sapUiCompDirectionLTR");}B.addStyleClass("sapUiCompUOMInTable");}return{control:B};}return{control:v};};r.prototype._checkSuppressUnit=function(){var n;if(this._oParent.data("suppressUnit")==="true"){return true;}n=this._oParent.getBindingInfo("uomVisible");if(!n&&!this._oParent.getUomVisible()){return true;}return false;};r.prototype._createEdmUOMObjectStatus=function(){var A,n,s,P,t;t=this._oTypes.getDisplayFormatter(this._oMetaData.property.property,this._oHelper.oAnnotation.isCurrency(this._oMetaData.property.property));P=this._oHelper.getUOMPath(this._oMetaData);A={text:{parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:P}],formatter:function(){var u=t.apply(this,arguments);return u+arguments[1];},useRawValues:true}};this._addObjectStatusAttributes(A);n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);s=new m(A);s.addStyleClass("sapUiCompUOM");return{control:s};};r.prototype._createEdmUOMObjectNumber=function(){var A,n,s,t;t=this._getEdmUOMTextAlignment();if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A={number:{parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],type:this._oTypes.getCurrencyType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},model:this._oMetaData.model,textAlign:t};}else{A={model:this._oMetaData.model,number:{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},textAlign:t};}n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);s=new k(A);s.addStyleClass("sapUiCompUOM");return{control:s};};r.prototype._createEdmSemantic=function(){var P,A,t,n=this,s=this._oParent.getBindingInfo("value");P=s.parts[0].path;var u=this._oMetaData.property.property["sap:label"];if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[P]){u=this._oMetaData.annotations.lineitem.labels[P];}A={semanticObject:this._oMetaData.annotations.semantic.semanticObject,semanticObjectLabel:u,fieldName:P,width:this.getAttribute("width"),createControlCallback:q.proxy(function(){var v=this.createControl(true);if(v){return v.control;}return null;},this)};t=this._oHelper.oAnnotation.getText(this._oMetaData.property.property);if(t){A.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(v,w){if(v&&w){return n._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",v,w);}return v?v:"";}};}else{A.text={path:P,model:this._oMetaData.model};}return{control:new f(A),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}};};r.prototype._createMultiLineText=function(n){var A=this.createAttributes("value",this._oMetaData.property,n);var s=this.getFormatSettings("multiLineSettings");A=q.extend(true,s,A);var t=new T(A);this._handleEventingForEdmString(t,this._oMetaData.property);return{control:t,onCreate:"_onCreate",getValue:"getValue",params:{type:{type:A.value.type,property:this._oMetaData.property}}};};r.prototype._checkLink=function(){var n=this._oParent.getBindingInfo("url");if(n){return true;}if(this._oParent.getUrl()){return true;}if(this._oParent.hasListeners("press")){return true;}return false;};r.prototype._createLink=function(){var t=this;var A={text:"",href:""};var n=this._oParent.getBindingInfo("url");if(this._oParent.hasListeners("press")){A["press"]=function(E){t._oParent.firePress(E);};}else if(n){A["href"]=this._oBinding.toBinding(n);}else{A["href"]=this._oParent.getUrl();}n=this._oParent.getBindingInfo("value");if(n){if(this._oMetaData.annotations.text&&this._oMetaData.property.property.type==="Edm.String"){A.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],formatter:function(s,u){if(s&&u){return t._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",s,u);}return s?s:"";}};}else{A["text"]=this._oBinding.toBinding(n);}}else{A["text"]=this._oParent.getValue();}return{control:new L(A),onCreate:"_onCreate",params:{noValidation:true}};};r.prototype._createEdmBoolean=function(){var A,n,s,t=this,u=null,E=false;E=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable();n=this._oSelector.checkComboBox();if(n.combobox){return this._createComboBox({annotation:n.annotation,noDialog:true,noTypeAhead:true},!E);}if(E){A=this.createAttributes("selected",this._oMetaData.property,{},{event:"select",parameter:"selected"});s=new C(A);u={getValue:"getSelected"};}else{A=this.createAttributes("text",this._oMetaData.property,{width:true,textAlign:true});A.text={model:this._oMetaData.model,path:this._oMetaData.path};A.text.formatter=function(v){return t._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",v);};s=new d(A);}return{control:s,onCreate:"_onCreate",params:u};};r.prototype._getCreator=function(B){return this._oSelector.getCreator(B);};r.prototype._onCreate=function(n,P){var G,s,v=true,t=this;if(P){if(P.noValidation){v=false;}if(P.valuehelp){this._getValueHelpDialogTitle(P.valuehelp);P.valuehelp["analyser"]=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.addValueHelp(n,this._oMetaData.property.property,P.valuehelp,this._oModel||this._oMetaData.modelObject,function(E){t._oParent.fireValueListChanged({"changes":E.mParameters.changes});});}if(P.getValue){G=P.getValue;P.getValue=function(){return n[G]();};}if(P.type){s=this._oFieldControl.getMandatoryCheck(P.type.property);if(s){P.type.type.oFieldControl=s;}}}if(v){this.addValidations(n,this._oParent.data("errorCheck")||"setSimpleClientError");}if(!this._checkUOM()){n.addStyleClass("sapUiCompSmartFieldValue");}};r.prototype._checkUOM=function(){var n=this._oParent.data("configdata");if(n&&n.configdata){if(n.configdata.onInput){return true;}if(n.configdata.onText){return true;}}return false;};r.prototype._getValueHelpDialogTitle=function(v){v.dialogtitle=this._oParent.getTextLabel();if(!v.dialogtitle){v.dialogtitle=this._oHelper.oAnnotation.getLabel(this._oMetaData.property.property)||this._oMetaData.property.property.name;}};r.prototype._onCreateUOM=function(n,P){var s,t;s=n.getItems();this.addValidations(s[0],"setComplexClientErrorFirstOperand");if(P&&P.getValue){P.getValue=function(){return s[0].getValue();};}P.uom=function(){var u=s[1].getAggregation("_content");return u.getValue();};P.uomset=function(v){var u=s[1].getAggregation("_content");u.setValue(v);};if(P.type){t=this._oFieldControl.getMandatoryCheck(P.type.property);if(t){P.type.type.oFieldControl=t;}}};r.prototype.bind=function(){var t=this,n,s,u=function(M,P){try{t._init(M);t._setUOMEditState();t._bind(P);}catch(v){q.sap.log.warning(v,null,"sap.ui.comp.smartfield.ODataControlFactory.bind.fInit");}};if(!this._bInitialized&&!this.bPending){this._bInitialized=true;n=this._oFieldControl.getBindableAttributes();s=this._oParent.data("configdata");if(s&&s.configdata){u(this._oMeta,n);}else if(this._oModel){this.bPending=true;this._oModel.getMetaModel().loaded().then(function(){t.bPending=false;u(t._oMeta,n);});}}};r.prototype._bind=function(B){var n,s,t;t=this._oFieldControl.getControlProperties(this._oMetaData,B);for(n in t){s=this._oBinding.fromFormatter(this._oMetaData.model,t[n]);this._oParent.bindProperty(n,s);}this._oParent.fireInitialise();};r.prototype.rebindOnCreated=function(){var n,B,s;s=this._oFieldControl.getControlProperties(this._oMetaData,["editable"]);for(n in s){B=this._oBinding.fromFormatter(this._oMetaData.model,s[n]);this._oParent.bindProperty(n,B);}};r.prototype._setUOMEditState=function(){var n,B;if(this._oFieldControl.hasUomEditState(this._oMetaData)){n=this._oFieldControl.getUOMEditState(this._oMetaData);if(n){B=this._oBinding.fromFormatter(this._oMetaData.model,n);this._oParent.bindProperty("uomEditState",B);}}};r.prototype.getDataProperty=function(){return this._oMetaData.property;};r.prototype.getMetaData=function(){return this._oMetaData;};r.prototype.destroy=function(){this._oFieldControl.destroy();this._oSelector.destroy();this._oTypes.destroy();this._oHelper.destroy();this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;g.prototype.destroy.apply(this,[]);};return r;},true);
