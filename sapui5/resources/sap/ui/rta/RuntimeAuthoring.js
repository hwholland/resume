/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/rta/ui/ToolsMenu','sap/ui/comp/smartform/flexibility/FormP13nHandler','sap/ui/dt/ElementUtil','sap/ui/dt/DesignTime','sap/ui/dt/OverlayRegistry','sap/ui/rta/command/Stack','sap/ui/rta/command/CommandFactory','sap/ui/rta/command/CompositeCommand','sap/ui/rta/plugin/Rename','sap/ui/rta/plugin/DragDrop','sap/ui/rta/plugin/RTAElementMover','sap/ui/dt/plugin/CutPaste','sap/ui/rta/plugin/Hide','sap/ui/rta/plugin/Selection','sap/ui/rta/plugin/MultiSelection','sap/ui/dt/plugin/ContextMenu','sap/ui/dt/plugin/TabHandling','sap/ui/fl/FlexControllerFactory','sap/ui/rta/ui/SettingsDialog','sap/ui/rta/ui/AddElementsDialog','./Utils','./ModelConverter','sap/ui/fl/transport/Transports','sap/ui/fl/transport/TransportSelection','sap/ui/fl/Utils','sap/ui/fl/registry/Settings','sap/m/MessageBox','sap/m/MessageToast','sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartform/SmartForm','sap/ui/comp/smarttable/SmartTable','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/uxap/ObjectPageLayout','sap/uxap/ObjectPageSection'],function(M,T,F,E,D,O,C,a,b,R,c,d,e,H,S,f,g,h,j,k,A,U,l,m,n,o,p,q,r,G,s,t,u,v,w,x){"use strict";var y=M.extend("sap.ui.rta.RuntimeAuthoring",{metadata:{library:"sap.ui.rta",associations:{"rootControl":{type:"sap.ui.core.Control"}},properties:{"customFieldUrl":"string","showCreateCustomField":"boolean","showToolbars":{type:"boolean",defaultValue:true},"showSettingsDialog":{type:"boolean",defaultValue:true},"showWindowUnloadDialog":{type:"boolean",defaultValue:true},"commandStack":{type:"sap.ui.rta.command.Stack"}},events:{"start":{},"stop":{},selectionChange:{parameters:{selection:{type:"sap.ui.dt.Overlay[]"}}},"undoRedoStackModified":{}}},_sAppTitle:null});y.prototype.init=function(){this._onCommandStackModified=this._adaptUndoRedoButtons.bind(this);};y.prototype.start=function(){var i=["sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement","sap.ui.table.Column","sap.uxap.ObjectPageSection"];var _=this;this._aPopups=[];this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._aSupportedControls=["sap.ui.comp.smartform.Group","sap.uxap.ObjectPageSection","sap.uxap.ObjectPageLayout"];if(!this._oDesignTime){this._oRootControl=sap.ui.getCore().byId(this.getRootControl());this._oRTAElementMover=new d({movableTypes:i});this._oRTADragDropPlugin=new c({draggableTypes:i,elementMover:this._oRTAElementMover});this._oRTADragDropPlugin.attachDragStarted(this._handleStopCutPaste,this);this._oCutPastePlugin=new e({movableTypes:i,elementMover:this._oRTAElementMover});if(E.sACTION_MOVE){this._oRTAElementMover.attachElementMoved(this._handleMoveElement,this);}else{this._oRTADragDropPlugin.attachElementMoved(this._handleMoveElement,this);this._oCutPastePlugin.attachElementMoved(this._handleMoveElement,this);}this._oHidePlugin=new H();this._oHidePlugin.attachHideElement(this._handleHideElement,this);this._oRenamePlugin=new R({commandStack:this.getCommandStack()});this._oRenamePlugin.attachEditable(this._handleStopCutPaste,this);this._oSelectionPlugin=new S();this._oMultiSelectionPlugin=new f({multiSelectionTypes:["sap.ui.comp.smartform.GroupElement"]});this._oContextMenuPlugin=new g();this._oTabHandlingPlugin=new h();this._buildContextMenu();jQuery.sap.measure.start("rta.dt.startup","Measurement of RTA: DesignTime start up");this._oDesignTime=new D({rootElements:[this._oRootControl],plugins:[this._oRTADragDropPlugin,this._oCutPastePlugin,this._oHidePlugin,this._oRenamePlugin,this._oSelectionPlugin,this._oMultiSelectionPlugin,this._oContextMenuPlugin,this._oTabHandlingPlugin]});this._oDesignTime.attachSelectionChange(function(b1){_.fireSelectionChange({selection:b1.getParameter("selection")});},this);this._oDesignTime.attachEventOnce("synced",function(){_.fireStart();jQuery.sap.measure.end("rta.dt.startup","Measurement of RTA: DesignTime start up");});}if(this.getShowToolbars()){this._createToolsMenu();var a1={"onAfterRendering":function(){this._oToolsMenuTop._oToolBarTop.focus();this._oToolsMenuTop._oToolBarTop.removeEventDelegate(a1,this);}};this._oToolsMenuTop._oToolBarTop.addEventDelegate(a1,this);this._oToolsMenuTop.show();this._oToolsMenuBottom.show();}this._oldUnloadHandler=window.onbeforeunload;window.onbeforeunload=this._onUnload.bind(this);};y.prototype.setCommandStack=function(i){var _=this.getProperty("commandStack");if(_){_.detachModified(this._onCommandStackModified);}if(this._oInternalCommandStack){this._oInternalCommandStack.destroy();delete this._oInternalCommandStack;}var a1=this.setProperty("commandStack",i);if(i){i.attachModified(this._onCommandStackModified);}if(this._oRenamePlugin){this._oRenamePlugin.setCommandStack(i);}return a1;};y.prototype.getCommandStack=function(){var i=this.getProperty("commandStack");if(!i){i=new C();this._oInternalCommandStack=i;}this.setCommandStack(i);return i;};y.prototype._adaptUndoRedoButtons=function(){var i=this.getCommandStack();this._oToolsMenuBottom.adaptUndoRedoEnablement(i.canUndo(),i.canRedo());this.fireUndoRedoStackModified();};y.prototype.closeToolBars=function(){this._oToolsMenuTop.hide();this._oToolsMenuBottom.hide();};y.prototype.getSelection=function(){if(this._oDesignTime){return this._oDesignTime.getSelection();}else{return[];}};y.prototype.stop=function(){var i=this;return this._serializeToLrep().then(function(){i.exit();i.fireStop();});};y.prototype.restore=function(){this._onRestore();};y.prototype.transport=function(){this._onTransport();};y.prototype.undo=function(){this._onUndo();};y.prototype.redo=function(){this._onRedo();};y.prototype.canUndo=function(){return this.getCommandStack().canUndo();};y.prototype.canRedo=function(){return this.getCommandStack().canRedo();};y.prototype._onUnload=function(){var i=this.getCommandStack();var _=i.canUndo()||i.canRedo();if(_&&this.getShowWindowUnloadDialog()){var a1=this._oTextResources.getText("MSG_UNSAVED_CHANGES");return a1;}else{window.onbeforeunload=this._oldUnloadHandler;}};y.prototype._serializeToLrep=function(){var _=this.getCommandStack();var a1=j.createForControl(this._oRootControl);var b1=_.serialize();var c1=_.getSerializableCommands();b1.forEach(function(e1,i){var f1=c1[i].getElement();a1.addChange(e1,f1);});var d1=this;return a1.saveAll().then(function(){jQuery.sap.log.info("Runtime adaptation successfully transfered changes to layered repository");d1.getCommandStack().removeAllCommands();},function(i){var e1=i.message||i.status||i;jQuery.sap.log.error("Failed to transfer runtime adaptation changes to layered repository",e1);jQuery.sap.require("sap.m.MessageBox");var f1=d1._oTextResources.getText("MSG_LREP_TRANSFER_ERROR")+"\n"+d1._oTextResources.getText("MSG_ERROR_REASON",e1);sap.m.MessageBox.error(f1);});};y.prototype._onUndo=function(){this._handleStopCutPaste();this.getCommandStack().undo();};y.prototype._onRedo=function(){this._handleStopCutPaste();this.getCommandStack().redo();};y.prototype._createToolsMenu=function(){if(!this._oToolsMenuTop){this._sAppTitle=this._getApplicationTitle();this._oToolsMenuTop=new T({toolbarType:"top"});this._oToolsMenuTop.createToolbar();this._oToolsMenuTop.setTitle(this._sAppTitle);this._oToolsMenuTop.setRootControl(this._oRootControl);this._oToolsMenuTop.adaptButtonsVisibility();this._oToolsMenuTop.attachToolbarClose(this.closeToolBars,this);this._oToolsMenuTop.attachClose(this.stop,this);this._oToolsMenuTop.attachTransport(this._onTransport,this);this._oToolsMenuTop.attachRestore(this._onRestore,this);}if(!this._oToolsMenuBottom){this._oToolsMenuBottom=new T({toolbarType:"bottom"});this._oToolsMenuBottom.createToolbar();this._oToolsMenuBottom.setRootControl(this._oRootControl);this._oToolsMenuBottom.attachUndo(this._onUndo,this);this._oToolsMenuBottom.attachRedo(this._onRedo,this);}};y.prototype.exit=function(){if(this._oToolsMenuTop){this._oToolsMenuTop.destroy();this._oToolsMenuTop=null;}if(this._oToolsMenuBottom){this._oToolsMenuBottom.destroy();this._oToolsMenuBottom=null;}if(this._oDesignTime){this._oDesignTime.destroy();this._oDesignTime=null;}if(this._handler){if(this._handler._oDialog){this._handler._oDialog.destroy();}this._handler=null;}this.setCommandStack(null);window.onbeforeunload=this._oldUnloadHandler;};y.prototype._onTransport=function(){var i=this;var _=j.createForControl(this._oRootControl);function a1(d1){o.log.error("Changes could not be applied or saved: "+d1);return i._showMessage(q.Icon.ERROR,"HEADER_TRANSPORT_APPLYSAVE_ERROR","MSG_TRANSPORT_APPLYSAVE_ERROR",d1).then(function(){throw new Error('createAndApply failed');});}function b1(d1){if(d1.message==='createAndApply failed'){return;}o.log.error("transport error"+d1);return i._showMessage(q.Icon.ERROR,"HEADER_TRANSPORT_ERROR","MSG_TRANSPORT_ERROR",d1);}this._handleStopCutPaste();var c1=new n();return this._serializeToLrep().then(function(){return _.getComponentChanges().then(function(d1){if(d1.length>0){return i._createAndApplyChanges(d1,_);}})['catch'](a1).then(function(){return _.getComponentChanges();}).then(function(d1){return!!d1.length;}).then(function(d1){if(d1){return c1.openTransportSelection(null,i._oRootControl);}else{i._showMessageToast("MSG_TRANSPORT_SUCCESS");}}).then(function(d1){if(d1&&d1.transport&&d1.packageName!=="$TMP"){return i._transportAllLocalChanges(d1,_);}})['catch'](b1);});};y.prototype._createAndApplyChanges=function(i,_){var a1=this;return Promise.resolve().then(function(){function b1(c1){return c1&&c1.selector&&c1.selector.id;}i.filter(b1).forEach(function(c1){var d1=sap.ui.getCore().byId(c1.selector.id);_.createAndApplyChange(c1,d1);});})['catch'](function(b1){o.log.error("Create and apply error: "+b1);return b1;}).then(function(b1){return _.saveAll().then(function(){if(b1){throw b1;}});})['catch'](function(b1){o.log.error("Create and apply and/or save error: "+b1);return a1._showMessage(q.Icon.ERROR,"HEADER_TRANSPORT_APPLYSAVE_ERROR","MSG_TRANSPORT_APPLYSAVE_ERROR",b1);});};y.prototype._deleteChanges=function(){var i=this;var _=new n();var a1=j.createForControl(this._oRootControl);a1.getComponentChanges().then(function(b1){return p.getInstance(o.getComponentClassName(i._oRootControl)).then(function(c1){if(!c1.isProductiveSystem()&&!c1.hasMergeErrorOccured()){return _.setTransports(b1,i._oRootControl);}}).then(function(){return a1.discardChanges(b1);}).then(function(){return window.location.reload();});})["catch"](function(b1){return i._showMessage(q.Icon.ERROR,"HEADER_RESTORE_FAILED","MSG_RESTORE_FAILED",b1);});};y.prototype._showMessage=function(i,_,a1,b1){if(b1){var c1=this._oTextResources.getText(a1,[b1.message||b1]);}else{var c1=this._oTextResources.getText(a1);}var d1=this._oTextResources.getText(_);return new Promise(function(e1){q.show(c1,{icon:i,title:d1,onClose:e1});});};y.prototype._showMessageToast=function(i){var _=this._oTextResources.getText(i);r.show(_);};y.prototype._ensureFormP13Handler=function(){if(!this._handler){this._handler=new F();this._handler._textResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}};y.prototype._onRestore=function(){var i=this;var _=this._oTextResources.getText("FORM_PERS_RESET_MESSAGE");var a1=this._oTextResources.getText("FORM_PERS_RESET_TITLE");this._handleStopCutPaste();function b1(c1){i._serializeToLrep().then(function(){if(c1==="OK"){i._deleteChanges();}});}q.confirm(_,{icon:q.Icon.WARNING,title:a1,onClose:b1});};y.prototype._transportAllLocalChanges=function(i,_){var a1=this;return _.getComponentChanges().then(function(b1){var c1=new m();var d1=c1._convertToChangeTransportData(b1);var e1={};e1.transportId=i.transport;e1.changeIds=d1;return c1.makeChangesTransportable(e1).then(function(){b1.forEach(function(f1){if(f1.getPackage()==='$TMP'){var g1=f1.getDefinition();g1.packageName='';f1.setResponse(g1);}});}).then(function(){a1._showMessageToast("MSG_TRANSPORT_SUCCESS");});});};y.prototype._isEqualParentInfo=function(i,_){var a1=!!i&&!!_;if(a1&&(i.parent&&_.parent)){a1=i.parent.getId()===_.parent.getId();}if(a1&&(i.index||_.index)){a1=i.index===_.index;}if(a1&&(i.aggregation||_.aggregation)){a1=i.aggregation===_.aggregation;}return a1;};y.prototype._handleMoveElement=function(_){var a1=_.getParameter("data");if(Array.isArray(a1)){for(var i=0;i<a1.length;i++){var b1=a1[i];this._handleAction(b1);}}else{this._handleAction(a1);}};y.prototype._handleAction=function(i){if(i&&!this._isEqualParentInfo(i.source,i.target)){var _=a.getCommandFor(i.source.parent,"Move");_.setMovedElements([{element:i.element,sourceIndex:i.source.index,targetIndex:i.target.index}]);_.setSource(i.source);_.setTarget(i.target);this.getCommandStack().pushAndExecute(_);}};y.prototype._handleHideElement=function(_){var a1=this;var b1=(_.mParameters)?_.getParameter("selectedOverlays"):_;var c1=new b();var d1=[];this._handleStopCutPaste();for(var i=0;i<b1.length;i++){var e1=b1[i].getElementInstance();if(B(e1)&&U.hasGroupElementUnBoundFields(e1)){return;}else if(J(e1)&&U.hasGroupUnBoundFields(e1)){return;}else if(J(e1)){d1=d1.concat(U.getGroupMandatoryElements(e1));}else if(!U.isElementHideable(e1)){d1.push(e1);}if(P(e1)&&e1.getStashed){var f1=a.getCommandFor(e1,"Stash");c1.addCommand(f1);}else{var g1=a.getCommandFor(e1,"Hide");c1.addCommand(g1);}}if(d1.length>0){U.openHideElementConfirmationDialog(e1,d1).then(function(h1){if(h1){a1.getCommandStack().pushAndExecute(c1);}});}else{this.getCommandStack().pushAndExecute(c1);}};y.prototype._openSettingsDialog=function(i){var _=(i.mParameters)?i.getParameter("selectedOverlays"):i;var a1=_[0].getElementInstance();this._handleStopCutPaste();if(!this._oSettingsDialog){this._oSettingsDialog=new k();}this._oSettingsDialog.setCommandStack(this.getCommandStack());this._oSettingsDialog.open(a1);};var z=function(i){var _=O.getOverlay(i);return v.getControlAnalyzerFor(i).hasParentStableId(_);};var I=function(i){var _=O.getOverlay(i);return _.getMovable();};var B=function(i){return i instanceof G;};var J=function(i){return i instanceof s;};var K=function(i){return B(i)||J(i);};var L=function(i){return i instanceof t;};var N=function(i){if(o.isVendorLayer()&&this.getShowSettingsDialog()){var _=["sap.ui.comp.smartfilterbar.SmartFilterBar","sap.ui.comp.smarttable.SmartTable","sap.ui.comp.smartform.SmartForm","sap.uxap.ObjectPageLayout","sap.uxap.ObjectPageSection","sap.uxap.ObjectPageHeaderActionButton","sap.uxap.ObjectPageHeader","sap.ui.table.Column"];return _.some(function(a1){return E.isInstanceOf(i,a1);});}};var P=function(i){return i instanceof x;};var Q=function(i){return i instanceof w;};var V=function(i){return J(i)||L(i);};var W=function(i){if(!o.isVendorLayer()){return K(i)||L(i);}return false;};var X=function(i){return this._oDesignTime.getSelection().length>1;};var Y=function(i){return P(i)||Q(i);};var Z=function(i){var _=this;return function(a1){return!i.call(_,a1);};};var $=function(i,_){var a1=this;return function(b1){return i.call(a1,b1)&&_.call(a1,b1);};};y.prototype._buildContextMenu=function(){var i=this;this._oContextMenuPlugin.addMenuItem({id:"CTX_RENAME_LABEL",text:i._oTextResources.getText("CTX_RENAME"),handler:this._handleRenameLabel.bind(this),available:B,enabled:Z.call(this,X)});this._oContextMenuPlugin.addMenuItem({id:"CTX_RENAME_GROUP",text:i._oTextResources.getText("CTX_RENAME"),handler:this._handleRenameLabel.bind(this),available:J,enabled:Z.call(this,X)});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_FIELD",text:i._oTextResources.getText("CTX_ADD_FIELD"),handler:this._handleAddElement.bind(this),available:K,enabled:$.call(this,Z.call(this,X),z)});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_GROUP",text:i._oTextResources.getText("CTX_ADD_GROUP"),handler:this._handleAddGroup.bind(this),available:V,enabled:Z.call(this,X)});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADD_SECTION",text:i._oTextResources.getText("CTX_ADD_SECTION"),handler:this._handleAddElement.bind(this),available:Y,enabled:U.hasObjectPageLayoutInvisibleSections.bind(U)});this._oContextMenuPlugin.addMenuItem({id:"CTX_HIDE_FIELD",text:i._oTextResources.getText("CTX_HIDE"),handler:this._handleHideElement.bind(this),available:B,enabled:Z(U.hasGroupElementUnBoundFields.bind(U))});this._oContextMenuPlugin.addMenuItem({id:"CTX_HIDE_GROUP",text:i._oTextResources.getText("CTX_HIDE"),handler:this._handleHideElement.bind(this),available:J,enabled:Z(U.hasGroupUnBoundFields.bind(U))});this._oContextMenuPlugin.addMenuItem({id:"CTX_HIDE_SECTION",text:i._oTextResources.getText("CTX_HIDE"),handler:this._handleHideElement.bind(this),available:P});this._oContextMenuPlugin.addMenuItem({id:"CTX_CUT",text:i._oTextResources.getText("CTX_CUT"),handler:this._handleCutElement.bind(this),available:I});this._oContextMenuPlugin.addMenuItem({id:"CTX_PASTE",text:i._oTextResources.getText("CTX_PASTE"),handler:this._handlePasteElement.bind(this),available:I,enabled:function(_){var a1=O.getOverlay(_.getId());return i._oCutPastePlugin.isElementPasteable(a1);}});this._oContextMenuPlugin.addMenuItem({id:"CTX_GROUP_FIELDS",text:i._oTextResources.getText("CTX_GROUP_FIELDS"),handler:this._handleGroupElements.bind(this),available:function(_){var a1=i._oDesignTime.getSelection();return(a1.length>1);},enabled:function(_){var a1=true;var b1=[];var c1=i._oDesignTime.getSelection();c1.forEach(function(d1){var _=d1.getElementInstance();b1=b1.concat(_.getFields());});if(c1.length>3||b1.length>3){return false;}c1.some(function(d1){var _=d1.getElementInstance();if(U.hasGroupElementUnBoundFields(_)){a1=false;return true;}});return a1;}});this._oContextMenuPlugin.addMenuItem({id:"CTX_UNGROUP_FIELDS",text:i._oTextResources.getText("CTX_UNGROUP_FIELDS"),handler:this._handleUngroupElements.bind(this),available:function(_){var a1=i._oDesignTime.getSelection();return B(_)&&_.getFields().length>1&&a1.length<2;},enabled:Z(U.hasGroupElementUnBoundFields.bind(U))});this._oContextMenuPlugin.addMenuItem({id:"CTX_SETTINGS",text:"Settings",handler:this._openSettingsDialog.bind(this),available:N.bind(this)});this._oContextMenuPlugin.addMenuItem({id:"CTX_ADAPT",text:i._oTextResources.getText("CTX_ADAPT"),startSection:Z(L),handler:this._handleAdaptElement.bind(this),available:W});};y.prototype._handleRenameLabel=function(i){var _=i[0];this._oRenamePlugin.startEdit(_);};y.prototype._handleAddElement=function(i){this._handleStopCutPaste();var _=i[0].getElementInstance();if(!this._oAddElementsDialog){this._oAddElementsDialog=new A({rootControl:this._oRootControl});}this._oAddElementsDialog.setCommandStack(this.getCommandStack());this._oAddElementsDialog.open(_);};y.prototype._handleCutElement=function(i){var _=i[0];this._oCutPastePlugin.cut(_);};y.prototype._handlePasteElement=function(i){var _=i[0];this._oCutPastePlugin.paste(_);};y.prototype._handleStopCutPaste=function(){this._oCutPastePlugin.stopCutAndPaste();};y.prototype._handleGroupElements=function(){this._handleStopCutPaste();var _=this._oDesignTime.getSelection();var a1=this._oContextMenuPlugin._oElement;var b1=U.getClosestTypeForControl(a1,"sap.ui.comp.smartform.Group");var c1=b1.getGroupElements().indexOf(a1);var d1=U.findSupportedBlock(a1,this._aSupportedControls);var e1=U.getClosestTypeForControl(a1,"sap.ui.comp.smartform.SmartForm");var f1=[];for(var i=0;i<_.length;i++){var g1=_[i].getElementInstance();f1.push(g1);}var h1=a.getCommandFor(d1,"Group");h1.setSource(a1);h1.setIndex(c1);h1.setGroupFields(f1);h1.setSmartForm(e1);this.getCommandStack().pushAndExecute(h1);};y.prototype._handleUngroupElements=function(){this._handleStopCutPaste();var i=this._oDesignTime.getSelection();var _=i[0].getElementInstance();var a1=U.getClosestTypeForControl(_,"sap.ui.comp.smartform.SmartForm");var b1=a.getCommandFor(_,"Ungroup");b1.setSmartForm(a1);this.getCommandStack().pushAndExecute(b1);};y.prototype._handleAddGroup=function(_){this._handleStopCutPaste();var a1=this;var b1=_[0].getElementInstance();var c1=U.getClosestViewFor(b1);var d1=U.getClosestTypeForControl(b1,"sap.ui.comp.smartform.SmartForm");var e1=a.getCommandFor(d1,"Add");e1.setNewControlId(c1.createId(jQuery.sap.uid()));e1.setLabels(["New Group"]);var f1=0;if(b1.getMetadata().getName()==="sap.ui.comp.smartform.Group"){var g1=b1.getParent().getAggregation("formContainers");for(var i=0;i<g1.length;i++){if(g1[i].getId()===b1.getId()){f1=i+1;break;}}}e1.setIndex(f1);this.getCommandStack().pushAndExecute(e1);var h1=O.getOverlay(e1.getNewControlId());h1.setSelected(true);var i1={"onAfterRendering":function(){setTimeout(function(){a1._oRenamePlugin.startEdit(h1);},0);h1.removeEventDelegate(i1);}};h1.addEventDelegate(i1);};y.prototype._getSmartFormForElement=function(i){while(i&&!E.isInstanceOf(i,"sap.ui.comp.smartform.SmartForm")){i=i.getParent();}return i;};y.prototype._handleAdaptElement=function(i,_){this._handleStopCutPaste();var a1=this;var b1=i[0].getElementInstance();return this._serializeToLrep().then(function(){a1._ensureFormP13Handler();var c1=a1._getSmartFormForElement(b1);a1._handler.init(c1);if(_){_(a1._handler);}a1._handler.show();});};y.prototype._getApplicationTitle=function(){var i="";var _=sap.ui.core.Component.getOwnerComponentFor(this._oRootControl);if(_){i=_.getMetadata().getManifestEntry("sap.app").title;}return i;};return y;},true);
