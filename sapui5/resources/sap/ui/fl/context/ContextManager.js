/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2014-2016 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/fl/LrepConnector","sap/ui/fl/Utils","sap/ui/fl/context/Context"],function(L,U,C){"use strict";var a;a={_oContext:new C({configuration:{"device":"sap/ui/fl/context/DeviceContextProvider"}}),_oLrepConnector:new L(),doesContextMatch:function(c,A){var s=c.context||"";if(!s){return true;}return jQuery.inArray(s,A)!==-1;},getActiveContexts:function(c){var d=this._getContextIdsFromUrl();if(d.length===0){return this._getContextParametersFromAPI(c).then(this._getActiveContextsByAPIParameters.bind(this,c));}else{return this._getActiveContextsByUrlParameters(c,d);}},_getContextParametersFromAPI:function(c){var r=[];c.forEach(function(o){o.parameters.forEach(function(b){var s=b.selector;if(r.indexOf(s)===-1){r.push(s);}});});return this._oContext.getValue(r);},_getActiveContextsByAPIParameters:function(c,r){var t=this;var A=[];c.forEach(function(o){if(t._isContextObjectActive(o,r)){A.push(o.id);}});return A;},_getActiveContextsByUrlParameters:function(c,d){var A=[];c.forEach(function(o){var b=jQuery.inArray(o.id,d)!==-1;if(b){A.push(o.id);}});return A;},_isContextObjectActive:function(c,r){var t=this;var b=true;var p=c.parameters;p.every(function(P){b=b&&t._checkContextParameter(P,r);return b;});return b;},_getContextIdsFromUrl:function(){var c=U.getUrlParameter("sap-ui-flexDesignTimeContext");if(!c){return[];}return c.split(",");},_checkContextParameter:function(p,r){var s=p.selector;var o=p.operator;var v=p.value;switch(o){case"EQ":return this._checkEquals(s,v,r);default:jQuery.sap.log.info("A context within a flexibility change with the operator '"+o+"' could not be verified");return false;}},_checkEquals:function(s,v,r){return r[s]===v;},createOrUpdateContextObject:function(p){if(!p.appVariantId){throw new Error("no app variant id passed for the context object");}var n={"componentName":p.componentName||p.appVariantId.replace('.Component',''),"reference":p.appVariantId};var i=p.id||U.createDefaultFileName();p={id:i,fileName:i,componentName:p.componentName,fileType:"context",appVariantId:p.appVariantId,reference:p.reference||"",packageName:p.packageName||"",layer:p.layer||U.getCurrentLayer(false),namespace:p.namespace||U.createNamespace(n,"contexts"),creation:p.creation||"",originalLanguage:p.originalLanguage||U.getCurrentLanguage(),support:p.support||{generator:"",service:"",user:""}};var u="/sap/bc/lrep/content/"+p.namespace+p.fileName+".context";u+="?layer="+p.layer;var m="PUT";this._oLrepConnector.send(u,m,p,{});}};return a;},true);
