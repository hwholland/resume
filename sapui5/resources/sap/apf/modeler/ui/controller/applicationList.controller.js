/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.require('sap.apf.modeler.ui.utils.helper');jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");(function(){"use strict";var c,a;var n=new sap.apf.modeler.ui.utils.NullObjectChecker();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();function _(C){var t=c.getText;C.byId("idAppPage").setTitle(t("configModelerTitle"));C.byId("idAppTitle").setText(t("applicationOverview"));C.byId("idAppNumberTitle").setText(t("applications"));C.byId("idDescriptionLabel").setText(t("description"));C.byId("idSemanticObjectLabel").setText(t("semanticObject"));C.byId("idEditButton").setText(t("edit"));C.byId("idSaveButton").setText(t("save"));C.byId("idCancelButton").setText(t("cancel"));C.byId("idTextCleanupButton").setText(t("textCleanUp"));C.byId("idImportButton").setText(t("import"));C.byId("idNewButton").setTooltip(t("newApplication"));C.byId("idDeleteIcon").setTooltip(t("deleteButton"));}function b(){var t=c.getText;sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").setTitle(t("confirmation"));sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteButton").setText(t("deleteButton"));sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idCancelButtonDialog").setText(t("cancel"));}function d(){var t=c.getText;sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").setTitle(t("confirmation"));sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idYesButton").setText(t("yes"));sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idNoButton").setText(t("no"));sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idCancelButton").setText(t("cancel"));}function e(C){var j=a.getList();C.byId("idAppCount").setText("("+j.length+")");var A=[];j.forEach(function(q){var r={};r.id=q.Application;r.description=q.ApplicationName;r.semanticObject=q.SemanticObject;A.push(r);});var M=o.prepareModel(A,A.length);C.byId("idApplicationTable").setModel(M);}function f(j){sap.m.MessageToast.show(c.getText(j));}function g(C){C.byId("idAppDescription").attachBrowserEvent("click",C.handleNavigationToConfigurationList.bind(C));C.byId("idSemanticObject").attachBrowserEvent("click",C.handleNavigationToConfigurationList.bind(C));C.byId("idApplicationTable").attachEvent("addNewAppEvent",C.handleAdditionOfNewApp.bind(C));C.byId("idApplicationTable").attachEvent("updateAppListEvent",C.handleAppListUpdateAfterImport.bind(C));}function h(C,v){var V,j;V={oParentControl:C.byId("idApplicationTable"),oCoreApi:c};j=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+v,type:sap.ui.core.mvc.ViewType.XML,viewData:V});C.getView().addDependent(j);}function i(C,D,j,q){C.getView().addDependent(D);var M=new sap.m.Label({text:c.getText(j)}).addStyleClass("dialogText");D.removeAllContent();D.addContent(M);if(q){D.removeAllCustomData();D.addCustomData(q);}D.open();}function k(C){var s=C.byId("idAppListScrollContainer");var A=C.byId("idApplicationTable");var v=C.getView();A.addEventDelegate({onAfterRendering:function(){var j=jQuery(window).height();var q=jQuery(v.byId("idAppTitle").getDomRef()).height();var r=jQuery(v.byId("idApplicationToolbar").getDomRef()).height();var t=jQuery(v.byId("idAppPage").getDomRef()).find("header").height();var u=jQuery(v.byId("idAppPage").getDomRef()).find("footer").height();var w;if(q>0){q=q+80;w=q+r+t+u+25;}else{w=232;}s.setHeight(j-w+"px");s.setWidth("100%");sap.apf.modeler.ui.utils.helper.onResize(function(){if(jQuery(v.getDomRef()).css("display")==="block"){j=jQuery(v.byId("idAppPage").getDomRef()).height();s.setHeight(j-w+"px");s.setWidth("100%");}});sap.ui.core.UIComponent.getRouterFor(C).attachRoutePatternMatched(function(E){if(E.getParameter("name")==="applicationList"){j=jQuery(v.getDomRef()).height();s.setHeight(j-w+"px");s.setWidth("100%");}});}});}function l(C,E){var j=new sap.m.StandardListItem({title:c.getText("importDeliveredContent"),type:sap.m.ListType.Active,press:function(){h(C,"importDeliveredContent");}});var q=new sap.m.StandardListItem({title:c.getText("importFiles"),type:sap.m.ListType.Active,press:function(){h(C,"importFiles");}});var P=new sap.m.Popover({placement:sap.m.PlacementType.Top,showHeader:false});var A=new sap.m.List({items:[j,q]});P.addContent(A);P.openBy(E.getSource());}function m(M,s){var j=c.createMessageObject({code:s});j.setPrevious(M);c.putMessage(j);}function p(C){C.byId("idNewButton").setEnabled(true);C.byId("idEditButton").setVisible(true);C.byId("idSaveButton").setVisible(false);C.byId("idSaveButton").setEnabled(false);C.byId("idTextCleanupButton").setEnabled(false);C.byId("idCancelButton").setVisible(false);C.byId("idTextCleanupButton").setVisible(false);C.byId("idApplicationTable").setMode("None");C.byId("idImportButton").setVisible(true);var j=C.byId("idApplicationTable").getItems();j.forEach(function(q){q.setType("Navigation");q.getCells()[0].setEditable(false);q.getCells()[1].setEditable(false);q.getCells()[2].setVisible(false);});e(C);}sap.ui.controller("sap.apf.modeler.ui.controller.applicationList",{onInit:function(){var C=this;var j=C.getOwnerComponent();if(n.checkIsNotUndefined(j)){c=j.oCoreApi;_(C);c.getApplicationHandler(function(q){a=q;e(C);});}g(C);k(C);},handleAddNewAppPress:function(){var C=this;h(C,"newApplication");},handleListItemSelect:function(){var C=this;C.byId("idTextCleanupButton").setEnabled(true);},handleListItemPress:function(j){var C=this,q;q=j.getParameter("listItem").getBindingContext().getPath().split("/")[2];sap.ui.core.UIComponent.getRouterFor(C).navTo("configurationList",{appId:C.byId("idApplicationTable").getModel().getData().Objects[q].id});},handleOnLiveChange:function(){var C=this;C.byId("idSaveButton").setEnabled(true);},handleEditPress:function(){var C=this;C.byId("idNewButton").setEnabled(false);C.byId("idEditButton").setVisible(false);C.byId("idSaveButton").setVisible(true);C.byId("idCancelButton").setVisible(true);C.byId("idTextCleanupButton").setVisible(true);C.byId("idImportButton").setVisible(false);C.byId("idApplicationTable").setMode("SingleSelectMaster");var j=C.byId("idApplicationTable").getItems();if(j.length){j.forEach(function(q){q.getCells()[0].setEditable(true);q.getCells()[1].setEditable(true);q.getCells()[2].setVisible(true);q.setType("Inactive");});}},handleDeletePress:function(j){var C=this,D;var P=j.getSource().getBindingContext().getPath().split("/")[2];var q=new sap.ui.core.CustomData({value:{removeId:C.byId("idApplicationTable").getModel().getData().Objects[P].id,sPath:P}});D=sap.ui.xmlfragment("idDeleteConfirmationFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",C);b();i(C,D,"deleteApp",q);},handleConfirmDeletion:function(){var C=this;var r=sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").getCustomData()[0].getValue().removeId;if(n.checkIsNotUndefined(r)){a.removeApplication(r,function(R,M,j){if(!n.checkIsNotUndefined(j)&&(typeof R==="string")){e(C);f("successMsgForAppDelete");C.byId("idEditButton").firePress();}else{m(j,"11501");}C.closeDialog();});}},closeDialog:function(){sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").destroy();},handleCancelPress:function(){var C=this,u=[],q,t,j,U;q=a.getList();t=C.byId("idApplicationTable").getModel().getData().Objects;for(j=0;j<q.length;j++){if(t[j].description!==q[j].ApplicationName||t[j].semanticObject!==q[j].SemanticObject){u.push(t[j]);}}if(u.length){U=sap.ui.xmlfragment("idUnsavedDataConfirmationFragment","sap.apf.modeler.ui.fragment.unsavedDataConfirmationDialog",C);d();i(C,U,"unsavedConfiguration");}else{p(C);}},handleNavigationWithSave:function(){var C=this;C.handleSavePress();sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy();},handleNavigationWithoutSave:function(){var C=this;sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy();p(C);},handlePreventNavigation:function(){sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy();},handleImportPress:function(E){var C=this;var j=c.getStartParameterFacade().isLrepActive();if(j){l(C,E);}else{h(C,"importFiles");}},handleSavePress:function(){var C=this,u=[],q,t,j;q=a.getList();t=C.byId("idApplicationTable").getModel().getData().Objects;for(j=0;j<q.length;j++){if(t[j].description!==q[j].ApplicationName||t[j].semanticObject!==q[j].SemanticObject){u.push(t[j]);}}u.forEach(function(r){var s={ApplicationName:r.description,SemanticObject:r.semanticObject};a.setAndSave(s,function(R,M,v){if(!n.checkIsNotUndefined(v)&&(typeof R==="string")){p(C);}else{m(v,"11500");}},r.id);});},handleTextpoolCleanUpPress:function(){var C=this,t,j,q;j=C.byId("idApplicationTable").getSelectedContextPaths()[0].split("/")[2];q=C.byId("idApplicationTable").getModel().getData().Objects[j].id;c.getConfigurationHandler(q,function(r){t=r.getTextPool();c.getUnusedTextKeys(q,function(u,s){if(!n.checkIsNotUndefined(s)){t.removeTexts(u,q,function(s){if(!n.checkIsNotUndefined(s)){f("successtextCleanup");}else{m(s,"11507");}});}else{m(s,"11506");}});});},handleNavigationToConfigurationList:function(E){var C=this;if(C.byId("idEditButton").getVisible()){var P={listItem:sap.ui.getCore().byId(E.currentTarget.id).getParent(),srcControl:C.byId("idApplicationTable")};C.byId("idApplicationTable").fireItemPress(P);}},handleAdditionOfNewApp:function(){var C=this;e(C);f("successsMsgForAppSave");C.byId('idApplicationTable').rerender();var I=C.byId('idApplicationTable').getItems();if(I.length){var j=I[I.length-1].getDomRef();if(j){j.scrollIntoView();}}},handleAppListUpdateAfterImport:function(){var C=this;e(C);},handleNavBack:function(){window.history.go(-1);}});}());
