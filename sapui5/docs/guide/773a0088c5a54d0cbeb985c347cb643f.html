<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="abstract" content="In this step, you will be adding an sap.ui.vk.SceneTree control to your 3D Viewer application."/>
<meta name="description" content="In this step, you will be adding an sap.ui.vk.SceneTree control to your 3D Viewer application."/>

<link rel="stylesheet" type="text/css" href="css/prettify.css?x=5752935675233513"/>
<link rel="stylesheet" type="text/css" href="css/documentation.css?x=5752935675233513"/>
<title>Step 4: Adding a Scene Tree</title>
  <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/themes/base/highlight-query-terms.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/js/google-code-prettify/prettify.css" />
    <script src="../../resources/sap/ui/demokit/js/sdk-pagehelper.js"></script>
  </head>
<body class="" id="loio773a0088c5a54d0cbeb985c347cb643f">
<div id="wrapper"><div id="container">

	<h1 class="title topictitle1">Step 4: Adding a Scene Tree</h1>

	
	<div class="body conbody"><p class="shortdesc">In this step, you will be adding an <samp class="ph codeph">sap.ui.vk.SceneTree</samp> control to your
        3D Viewer application.</p>

        <div class="note caution"><span class="cautiontitle">Caution</span> The controls in the <samp class="ph codeph">sap.ui.vk</samp> library are currently
            flagged as experimental. For more information, see <a class="xref" href="91f087396f4d1014b6dd926db0e91070.html" title="The following sections describe what SAP can change in major, minor, and patch releases. Always consider these rules when developing apps, features, or controls with or for SAPUI5.">Compatibility Rules</a>.</div>

		<div class="p">The following <samp class="ph codeph">sap.ui.vk</samp> controls are introduced in this step:<ul class="ul" id="loio773a0088c5a54d0cbeb985c347cb643f__ul_n2m_yfs_yt">
                <li class="li"><samp class="ph codeph">SceneTree</samp> control</li>

                <li class="li"><samp class="ph codeph">ViewStateManager</samp> control</li>

            </ul>
</div>

		<p class="p">We will use the <samp class="ph codeph">SceneTree</samp> control to create a tree structure that
			displays the hierarchy of the nodes for the loaded model. We will then use the
				<samp class="ph codeph">ViewStateManager</samp> control to link the Scene Tree with the model
			loaded into the Viewport, so that we can visually associate a selection in the scene
			with its corresponding node as displayed in the Scene Tree.</p>

        <p class="p">The content in this step builds on the code from <a class="xref" href="112d7b417e914a5a951abc6411d6f6c4.html" title="In this step, you will be creating a 3D Viewer application using the sap.ui.vk.Viewport control.">Step 3: 3D Viewer Using the Viewport Control</a>, and code changes performed in this
            step of the tutorial are done in relation to the files in <a class="xref" href="112d7b417e914a5a951abc6411d6f6c4.html" title="In this step, you will be creating a 3D Viewer application using the sap.ui.vk.Viewport control.">Step 3: 3D Viewer Using the Viewport Control</a>.</p>

		<div class="section"><div class="section_title">Preview</div><div type="Preview">
            
            <div class="fig fignone" id="loio773a0088c5a54d0cbeb985c347cb643f__fig_fg1_sqw_15"><div class="figcontainer">
                
                <img class="image" id="loio773a0088c5a54d0cbeb985c347cb643f__image_vn1_rrq_15" src="loioa0d2e26783dd440cbe0d8a6320d12ad1_LowRes.png"/>
            <div class="figcap">Viewer application with a Viewport and a Scene Tree</div></div></div>

        </div></div>

		<div class="section"><div class="section_title">Coding</div><div type="Coding"><p class="p">You can view and download all files <span class="ph">at <a class="xref" target="_blank" href="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.04/preview" alt="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.04/preview" title="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.04/preview">3D Viewer - Step 4 - Viewport with Scene
                    Tree</a></span>.</p>
<div class="sectiondiv subsection">
                <p class="p subsectiontitle">index.html</p>

                <p class="p">Update the <samp class="ph codeph">index.html</samp> file to reference the
                        <samp class="ph codeph">viewportScenetree</samp> namespace, which will be the namespace
                    we'll use for the sample application in this step.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
        &lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/&gt;
    &lt;script id="sap-ui-bootstrap"
        src="../../../../../../../../../resources/sap-ui-core.js"
        data-sap-ui-libs="sap.ui.vk, sap.m"
        data-sap-ui-theme="sap_belize"
        data-sap-ui-bindingSyntax="complex"
        data-sap-ui-resourceroots='{
            <span class="ph emphasis emphasis">"viewportScenetree": "./"</span>
        }'&gt;
    &lt;/script&gt;
    &lt;script&gt;
    sap.ui.getCore().attachInit(function(){
        new sap.m.Shell({
            app: new sap.ui.core.ComponentContainer({
                <span class="ph emphasis emphasis">name : "viewportScenetree"</span>
            })
        }).placeAt("content");
    });
    &lt;/script&gt;
    &lt;/head&gt;
    &lt;body id="content" class="sapUiBody"&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">Component.js</p>

                <p class="p">Update the <samp class="ph codeph">Component.js</samp> file to reference the namespace
                    specified for this application.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
    "sap/ui/core/UIComponent"
], function (UIComponent) {
    "use strict";

    <span class="ph emphasis emphasis">return UIComponent.extend("viewportScenetree.Component",</span> {
        metadata: {
            manifest: "json"
        },
        init: function () {
            // call the init function of the parent
            UIComponent.prototype.init.apply(this, arguments);
        }
    });
});</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">i18n.properties</p>

                <p class="p">Update the page title to say "Viewport with Scene Tree".</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-prefs"># Page Descriptor
<span class="ph emphasis emphasis">pageTitle=Viewport with Scene Tree</span></pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">manifest.json</p>

                <p class="p">Update the <samp class="ph codeph">manifest.json</samp> file so that it references the correct
                    files.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">{
    "_version": "1.8.0",
    "sap.app": {
        <span class="ph emphasis emphasis">"id": "viewportScenetree",</span>
        "type": "application",
        "i18n": "i18n/i18n.properties",
        "title": "{{appTitle}}",
        "description": "{{appDescription}}",
        "applicationVersion": {
            "version": "1.0.0"
        }
    },
    "sap.ui": {
        "technology": "UI5",
        "deviceTypes": {
            "desktop": true,
            "tablet": true,
            "phone": true
        }
    },
    "sap.ui5": {
        <span class="ph emphasis emphasis">"rootView": "viewportScenetree.view.App",</span>
        "dependencies": {
            "minUI5Version": "1.30",
            "libs": {
                "sap.m": {}
            }
        },
        "models": {
            "i18n": {
                "type": "sap.ui.model.resource.ResourceModel",
                "settings": {
                    <span class="ph emphasis emphasis">"bundleName": "viewportScenetree.i18n.i18n"</span>
                }
            }
        }
    }
}</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">App.view.xml</p>

                <p class="p">To display the Scene Tree in your application, add the
                        <samp class="ph codeph">&lt;vk:SceneTree&gt;</samp> element. In the element's attribute's,
                    specify the Scene Tree control's width and height on the screen, and give it an
                    arbitrary identifier value.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-xml">&lt;mvc:View
        <span class="ph emphasis emphasis">controllerName="viewportScenetree.controller.App"</span>
        xmlns="sap.m"
        xmlns:mvc="sap.ui.core.mvc"
        xmlns:vk="sap.ui.vk"
        xmlns:l="sap.ui.layout"
        xmlns:f="sap.ui.layout.form"
        xmlns:u="sap.ui.unified"
        displayBlock="true"&gt;
    <span class="ph emphasis emphasis">&lt;App id="viewportScenetree"&gt;</span>
        &lt;Page
                title="{i18n&gt;pageTitle}"&gt;
            &lt;vk:Viewport
                    id="viewport"
                    width="100%"
                    height="25%"/&gt;
<span class="ph emphasis emphasis">            &lt;vk:SceneTree
                    id="scenetree"
                    width="100%"
                    height="25%"/&gt;</span>
        &lt;/Page&gt;
    &lt;/App&gt;
&lt;/mvc:View&gt;</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">App.controller.js</p>

                <p class="p">For the most part, the code in the <samp class="ph codeph">App.controller.js</samp> file will
                    be the same as the content of the <samp class="ph codeph">App.controller.js</samp> file for
                    the application in <a class="xref" href="112d7b417e914a5a951abc6411d6f6c4.html" title="In this step, you will be creating a 3D Viewer application using the sap.ui.vk.Viewport control.">Step 3: 3D Viewer Using the Viewport Control</a>. The
                    highlighted sections in the following code block indicate the additions and
                    changes made in the code to incorporate a Scene Tree in the 3D Viewer
                    application.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/vk/ContentResource",
], function (Controller, JSONModel, ContentResource) {
    "use strict";

    var contentResource = new sap.ui.vk.ContentResource({
        source: "/models/boxTestModel.vds",
        sourceType: "vds",
        id: "abc123"
    });
    <span class="ph emphasis emphasis">return Controller.extend("viewportScenetree.controller.App",</span>{
        onInit: function() {
            var mainScene;
            jQuery.sap.require("sap.ui.vk.GraphicsCore");
            var graphicsCore = new sap.ui.vk.GraphicsCore({},{
                antialias: true,
                alpha: true,
                premultipliedAlpha: false
            });
            var view = this.getView();
            var viewport = view.byId("viewport");
            <span class="ph emphasis emphasis">var sceneTree = view.byId("scenetree");</span>
            viewport.setGraphicsCore(graphicsCore);
            graphicsCore.loadContentResourcesAsync([contentResource], function(sourcesFailedToLoad){
                if (sourcesFailedToLoad){
                    jQuery.sap.log.error("Some of content resources cannot be loaded.");
                } else {
                    var scene = graphicsCore.buildSceneTree([contentResource]);
                    if (scene){
                        mainScene = scene;
                        viewport.setScene(mainScene);
<span class="ph emphasis emphasis">                        var viewStateManager = graphicsCore.createViewStateManager(mainScene.getDefaultNodeHierarchy());
                        viewport.setViewStateManager(viewStateManager);
                        sceneTree.setScene(mainScene, viewStateManager);</span>
                    } else {
                        <span class="ph emphasis emphasis">jQuery.sap.log.error("Failed to build the scene tree.");</span>
                    }
                }
            });
        }
    });
});</pre></div>

                <p class="p">Let us look at the changes in more detail.</p>

                <p class="p">The following code line adds a new Scene Tree object.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">var sceneTree = view.byId("scenetree");</pre></div>

                <p class="p">We create a new object called <samp class="ph codeph">viewStateManager</samp> that gets the
                    node hierarchy of the resource that's loaded into the scene. Then, we associate
                    the created <samp class="ph codeph">viewStateManager</samp> object with our viewport. We also
                    associate the nodes in the <samp class="ph codeph">viewStateManager</samp> object, as well as
                    the resource loaded into the main scene with the Scene Tree.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">var viewStateManager = graphicsCore.createViewStateManager(mainScene.getDefaultNodeHierarchy());
viewport.setViewStateManager(viewStateManager);
sceneTree.setScene(mainScene, viewStateManager);</pre></div>

                <p class="p">Finally, we changed the message for the condition that determines whether the
                    viewport and the scene tree loaded successfully or not.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">jQuery.sap.log.error("Failed to build the scene tree.");</pre></div>

            </div></div></div>

	    <div class="section"><div class="section_title">API Reference</div><div type="API Reference">
            
            <ul class="ul" id="loio773a0088c5a54d0cbeb985c347cb643f__ul_nsm_s1c_f5">
                <li class="li"><a class="xref" href="../../docs/api/symbols/sap.ui.vk.SceneTree.html" alt="../../docs/api/symbols/sap.ui.vk.SceneTree.html" title="../../docs/api/symbols/sap.ui.vk.SceneTree.html">sap.ui.vk.SceneTree</a></li>

            </ul>

        </div></div>

	</div>

    <div class="related-links"> 
<div class="relinfo"><div class="relinfotitle ">Related Information</div>
<div><a class="link" href="ab7021546c72409d84eb97c6b1434e72.html">Scene Tree</a></div>
</div>
</div>
</div></div>

</body>
</html>