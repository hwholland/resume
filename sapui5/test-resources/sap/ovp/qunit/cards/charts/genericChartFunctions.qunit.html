<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>QUnit test for cards.charts.genericChartFunctions - sap.ovp</title>
    <script>
        this.JsUnit = this.JsUnit || {}; // disable LESS support by faking JsUnit test runner
        window["sap-ushell-config"] = {
            defaultRenderer: "fiori2",
            renderers: {
                fiori2: {
                    componentData: {
                        config: {}
                    }
                }
            },
            services: {}
        };
    </script>
    <script src="../../../../../sap/ushell/bootstrap/sandbox.js"></script>
    <script id="sap-ui-bootstrap"
            type="text/javascript"
            src="../../../../../../resources/sap-ui-core.js"
            data-sap-ui-resourceroots='{
        "sap.ovp.test": "../../../../../sap/ovp/"
        }'>
    </script>
    <link rel="stylesheet" href="../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
    <script src="../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
    <script src="../../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
    <script>
        jQuery.sap.registerModulePath("sap.ushell", "../../../../../../resources/sap/ushell");
    </script>
   <script>
       (function(){
           "use strict";
           jQuery.sap.require("sap.ovp.cards.charts.Utils");
           jQuery.sap.require("sap.ovp.cards.charts.VizAnnotationManager");
           jQuery.sap.require("sap.ovp.test.qunit.cards.utils");
           jQuery.sap.require("sap.ovp.test.qunit.cards.charts.utils");
           var chartUtils = sap.ovp.cards.charts.Utils;
           var VizAnnotationManager = sap.ovp.cards.charts.VizAnnotationManager;
           var chartTestUtils = sap.ovp.test.qunit.cards.charts.utils;
           var cardTestUtils = sap.ovp.test.qunit.cards.utils;
           


           module("sap.ovp.cards.charts", {
               /**
                * This method is called before each test
                */
               beforeEach: function (test) {
            	   jQuery.sap.require("sap.ovp.test.mockservers");
                   var baseURL = chartTestUtils.odataBaseUrl;
                   var rootURL = chartTestUtils.odataRootUrl;
                   sap.ovp.test.mockservers.loadMockServer(baseURL, rootURL); 
               },
               /**
                * This method is called after each test. Add every restoration code here
                *
                */
               afterEach: function () {
            	   sap.ovp.test.mockservers.close();
               }
           });



           test("Test Generic Chart Functions",function(){
               var testData1 = [
                   {
                       "Measure": {
                           "PropertyPath": "SalesShare"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "TotalSales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "Sales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   }
               ];
               var testData2 = [
                   {
                       "Measure": {
                           "PropertyPath": "SalesShare"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "TotalSales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "Sales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   }
               ];
               var testData3 = [
                   {
                       "Measure": {
                           "PropertyPath": "SalesShare"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "TotalSales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   },
                   {
                       "Measure": {
                           "PropertyPath": "Sales"
                       },
                       "Role": {
                           "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3"
                       },
                       "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                   }
               ];

               var simulatedEntityTypeData = {
                    "name": "SalesShareType",
                    "namespace": "sap.smartbusinessdemo.services",
                    "$path": "/dataServices/schema/0/entityType/0",
                    "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country": [{
                        "Label": {
                            "String": ""
                        },
                        "Criticality": {
                            "EnumMember": "com.sap.vocabularies.UI.v1.CriticalityType/Positive"
                        },
                        "SemanticObject": {
                            "String": "OVP"
                        },
                        "Action": {
                            "String": "Procurement"
                        },
                        "RecordType": "com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"
                    }, {
                        "Label": {
                            "String": "Evaluation"
                        },
                        "Value": {
                            "String": "evaluation2"
                        },
                        "RecordType": "com.sap.vocabularies.UI.v1.DataField"
                    }],
                    "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country": {
                        "Title": {
                            "String": "Sales India"
                        },
                        "Value": {
                            "Path": "Sales",
                            "EdmType": "Edm.Decimal"
                        },
                        "NumberFormat": {
                            "ScaleFactor": {
                                "Int": "0"
                            },
                            "NumberOfFractionalDigits": {
                                "Int": "3"
                            }
                        },
                        "CriticalityCalculation": {
                            "ImprovementDirection": {
                                "EnumMember": "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Minimizing"
                            },
                            "DeviationRangeHighValue": {
                                "String": "7300"
                            },
                            "ToleranceRangeHighValue": {
                                "String": "7200"
                            }
                        },
                        "TargetValue": {
                            "String": "2.000 "
                        },
                        "TrendCalculation": {
                            "ReferenceValue": {
                                "String": "5201680"
                            },
                            "DownDifference": {
                                "Int": "10000000.0"
                            }
                        },
                        "RecordType": "com.sap.vocabularies.UI.v1.DataPointType"
                    },
                    "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country": {
                        "SelectOptions": [{
                            "PropertyName": {
                                "PropertyPath": "Country"
                            },
                            "Ranges": [{
                                "Sign": {
                                    "EnumMember": "com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"
                                },
                                "Option": {
                                    "EnumMember": "com.sap.vocabularies.UI.v1.SelectionRangeOptionType/EQ"
                                },
                                "Low": {
                                    "String": "IN"
                                }
                            }]
                        }, {
                            "PropertyName": {
                                "PropertyPath": "Currency"
                            },
                            "Ranges": [{
                                "Sign": {
                                    "EnumMember": "com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"
                                },
                                "Option": {
                                    "EnumMember": "com.sap.vocabularies.UI.v1.SelectionRangeOptionType/EQ"
                                },
                                "Low": {
                                    "String": "EUR"
                                }
                            }]
                        }]
                    },
                    "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country": {
                        "GroupBy": [{
                            "PropertyPath": "Country"
                        }],
                        "SortOrder": [{
                            "Property": {
                                "PropertyPath": "Year"
                            },
                            "Descending": {
                                "Boolean": "true"
                            }
                        }],
                        "Visualizations": [{
                            "AnnotationPath": "@com.sap.vocabularies.UI.v1.Chart#Eval_by_Country"
                        }]
                    },
                    "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country": {
                        "Title": {
                            "String": "View1"
                        },
                        "MeasureAttributes": [{
                            "Measure": {
                                "PropertyPath": "SalesShare"
                            },
                            "Role": {
                                "EnumMember": "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"
                            },
                            "RecordType": "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType"
                        }],
                        "DimensionAttributes": [{
                            "Dimension": {
                                "PropertyPath": "ProductID"
                            },
                            "Role": {
                                "EnumMember": "com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category"
                            },
                            "RecordType": "com.sap.vocabularies.UI.v1.ChartDimensionAttributeType"
                        }, {
                            "Dimension": {
                                "PropertyPath": "Region"
                            },
                            "Role": {
                                "EnumMember": "com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"
                            },
                            "RecordType": "com.sap.vocabularies.UI.v1.ChartDimensionAttributeType"
                        }],
                        "RecordType": "com.sap.vocabularies.UI.v1.ChartDefinitionType"
                    },
                    "property": [{
                        "name": "Country",
                        "type": "Edm.String",
                        "maxLength": "3",
                        "extensions": [{
                            "name": "label",
                            "value": "Country",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "dimension",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:label": "Country",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Country"
                        },
                        "sap:aggregation-role": "dimension"
                    }, {
                        "name": "Region",
                        "type": "Edm.String",
                        "maxLength": "4",
                        "extensions": [{
                            "name": "label",
                            "value": "Region",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "dimension",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:label": "Region",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Region"
                        },
                        "sap:aggregation-role": "dimension"
                    }, {
                      "name": "Date",
                      "type": "Edm.DateTime",
                      "extensions": [{
                        "name": "display-format",
                        "value": "Date",
                        "namespace": "http://www.sap.com/Protocols/SAPData"
                      }, {
                        "name": "label",
                        "value": "Date",
                        "namespace": "http://www.sap.com/Protocols/SAPData"
                      }, {
                        "name": "aggregation-role",
                        "value": "dimension",
                        "namespace": "http://www.sap.com/Protocols/SAPData"
                      }],
                      "sap:display-format": "Date",
                      "sap:label": "Date",
                      "com.sap.vocabularies.Common.v1.Label": {
                        "String": "Date"
                      },
                      "sap:aggregation-role": "dimension"
                    }, {
                        "name": "ProductID",
                        "type": "Edm.String",
                        "maxLength": "10",
                        "extensions": [{
                            "name": "label",
                            "value": "Product ID",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "dimension",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "text",
                            "value": "Product",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:label": "Product ID",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Product ID"
                        },
                        "sap:aggregation-role": "dimension",
                        "sap:text": "Product",
                        "com.sap.vocabularies.Common.v1.Text": {
                            "Path": "Product"
                        }
                    }, {
                        "name": "Currency",
                        "type": "Edm.String",
                        "maxLength": "5",
                        "extensions": [{
                            "name": "label",
                            "value": "Currency",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "dimension",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:label": "Currency",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Currency"
                        },
                        "sap:aggregation-role": "dimension"
                    }, {
                        "name": "Sales",
                        "type": "Edm.Decimal",
                        "precision": "15",
                        "scale": "2",
                        "extensions": [{
                            "name": "filterable",
                            "value": "false",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "label",
                            "value": "Sales",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "measure",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "unit",
                            "value": "Sales_CURRENCY",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:filterable": "false",
                        "sap:label": "Sales",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Sales"
                        },
                        "sap:aggregation-role": "measure",
                        "sap:unit": "Sales_CURRENCY",
                        "Org.OData.Measures.V1.ISOCurrency": {
                            "Path": "Sales_CURRENCY"
                        }
                    }, {
                        "name": "TotalSales",
                        "type": "Edm.Decimal",
                        "precision": "15",
                        "scale": "2",
                        "extensions": [{
                            "name": "filterable",
                            "value": "false",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "label",
                            "value": "Total Sales",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "measure",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "unit",
                            "value": "TotalSales_CURRENCY",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:filterable": "false",
                        "sap:label": "Total Sales",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Total Sales"
                        },
                        "sap:aggregation-role": "measure",
                        "sap:unit": "TotalSales_CURRENCY",
                        "Org.OData.Measures.V1.ISOCurrency": {
                            "Path": "TotalSales_CURRENCY"
                        }
                    },{
                        "name": "SalesShare",
                        "type": "Edm.Decimal",
                        "precision": "12",
                        "scale": "5",
                        "extensions": [{
                            "name": "filterable",
                            "value": "false",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "label",
                            "value": "Sales Share",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }, {
                            "name": "aggregation-role",
                            "value": "measure",
                            "namespace": "http://www.sap.com/Protocols/SAPData"
                        }],
                        "sap:filterable": "false",
                        "sap:label": "Sales Share",
                        "com.sap.vocabularies.Common.v1.Label": {
                            "String": "Sales Share"
                        },
                        "sap:aggregation-role": "measure"
                    }]
                };

               var simulatedOvpModel = {
                   getProperty: function (path) {
                       if (path == "/entityType") {
                           return simulatedEntityTypeData;
                       }
                   }
               };

               var entityTypeDataContext = {
                   getModel: function (model) {
                       if (model == "ovpCardProperties") {
                           return simulatedOvpModel;
                       }
                   }
               };

               var simulatedIContext = {
                   getSetting: function (model) {
                       if (model == "ovpCardProperties") {
                           return simulatedOvpModel;
                       }
                   }
               };
               
               var bubbleCheck = {"EnumMember":"com.sap.vocabularies.UI.v1.ChartType/Bubble"}
               assert.equal(VizAnnotationManager.getChartType(bubbleCheck), "bubble", "Bubble Check done");

               var lineCheck = {"EnumMember":"com.sap.vocabularies.UI.v1.ChartType/Line"}
               assert.equal(VizAnnotationManager.getChartType(lineCheck), "line", "Line Check done");
               
               var donutCheck = {"EnumMember":"com.sap.vocabularies.UI.v1.ChartType/Donut"}
               assert.equal(VizAnnotationManager.getChartType(donutCheck), "donut", "Donut Check done");

               var checkConfig = VizAnnotationManager.getConfig();
               ok(checkConfig && (typeof checkConfig === 'object'),"presence of config");
               jQuery.each(checkConfig, function(i, checkConfigType) {
                    var flag=true;
            	    jQuery.each(checkConfigType, function(j, propt) {
            	    	    if((j== "type" && typeof j!== 'string')||
            	    	    		(j=="dimensions" && typeof j !== 'object')||
            	    	    			(j=="measures" && typeof j !== 'object')){
            	    	    	flag=false;
            	    	    	return false;
            	    	    }
            	            if ((j == "feeds") && (j instanceof Array) && (j.length > 0)) {
            	                jQuery.each(propt, function(k, f){
            	                  if(!f.uid || typeof f.uid !== 'string' || !f.type || typeof f.type !== 'string')
            	                	  {
            	                	  flag=false;
            	                      return false;
            	                	  }
            	                })
            	               
            	            }
            	            ok(flag,i+" config check");
            	    })
            	})
            	
               var selVar = "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country";
               var chartAnno = "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country";
               var preVar =  "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country";
               var idAnno = "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country";
               var dPAnno = "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country";

               assert.deepEqual(chartUtils.BubbleChart.getMeasurePriorityList(simulatedIContext, testData1),
                       ["Sales Share", "Total Sales", "Sales"], "Axis 1 Test");
               assert.deepEqual(chartUtils.BubbleChart.getMeasurePriorityList(simulatedIContext, testData2),
                       ["Sales Share", "Total Sales", "Sales"], "Axis 2 Test");
               assert.deepEqual(chartUtils.BubbleChart.getMeasurePriorityList(simulatedIContext, testData3),
                       ["Sales Share", "Total Sales", "Sales"], "Axis 3 Test");

               var fCheckExists = VizAnnotationManager.checkExists;
               ok(chartTestUtils.isValidBoolean(
                       fCheckExists(selVar, simulatedEntityTypeData, "Selection Variant")),
                       "Annotation checker Test - Selection Variant");
               ok(chartTestUtils.isValidBoolean(
                       fCheckExists(chartAnno, simulatedEntityTypeData, "Chart Annotation")),
                       "Annotation checker Test - Chart Annotation", true);
               ok(chartTestUtils.isValidBoolean(
                       fCheckExists(preVar, simulatedEntityTypeData, "Presentation Variant")),
                       "Annotation checker Test - Presentation Variant");
               ok(chartTestUtils.isValidBoolean(
                       fCheckExists(idAnno, simulatedEntityTypeData, "Identification Annotation")),
                       "Annotation checker Test - Identification Annotation");
               ok(chartTestUtils.isValidBoolean(
                       fCheckExists(dPAnno, simulatedEntityTypeData, "Data Point")),
                       "Annotation checker Test - Data Point");
               ok(chartTestUtils.isValidString(
                       VizAnnotationManager.returnDateFormat(new Date())),
                       "Date Formatter test");
               ok(chartTestUtils.isValidString(
                        VizAnnotationManager.returnDateFormat(undefined)),
                       "Date Formatter test");
               ok(jQuery.proxy(chartUtils.formDimensionPath, entityTypeDataContext)("ProductID") === "{Product}",
                       "Test if DimensionDefinition names consider sap:text");
               ok(jQuery.proxy(chartUtils.formDimensionPath, entityTypeDataContext)("Region") === "{Region}",
                       "Test if DimensionDefinition names fall back to dimension name when no sap:text available");
               ok(jQuery.proxy(chartUtils.formDimensionPath, entityTypeDataContext)("Date") === "{path:'Date', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}",
                        "Test if DimensionDefinition names check for DateTime type and pass on to the Date formatter.");
               //ok(chartTestUtils.testNoDataSection(), "Test 'No Data available' section");
           });
           
			test("Analytical Chart - With less Dimensions",function(){
        	   
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_LessDim.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   
                   
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CHART_ANNO_ERROR + "in " + VizAnnotationManager.errorMessages.CHART_ANNO + " " +
                				   VizAnnotationManager.errorMessages.DIMENSIONS_MANDATORY), "Check if less/no dimensions given in the annotations");
                   errorSpy.restore();
               });
           });
           
           
           
           test("Analytical Chart - With less Measures",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_LessMeas.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CHART_ANNO_ERROR + "in " + VizAnnotationManager.errorMessages.CHART_ANNO + " " +
                				   VizAnnotationManager.errorMessages.MEASURES_MANDATORY),"Check if less/no measures given in the annotations");
                   errorSpy.restore();
               });
           });
           
           test("Analytical Chart - With Less Dimensions(Considering the role)",function(){
        	   
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_LessDimConsideringRole.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CARD_ERROR + VizAnnotationManager.errorMessages.MIN_FEEDS + "line" +
						" " + VizAnnotationManager.errorMessages.FEEDS_OBTAINED + "0" + " " + VizAnnotationManager.errorMessages.FEEDS_REQUIRED + "1" +
						" " + VizAnnotationManager.errorMessages.FEEDS), "Check if less/no dimensions given in the annotations, considering the role");
                   errorSpy.restore();
               });
           });
           
           test("Analytical Chart - Default Role to be considered(Mix Case)",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_DefaultRole.xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                   {
                                       uid : "valueAxis",
                                       type : "Measure",
                                       values : "Sales Share"
                                   },
                                   {
                                       uid : "valueAxis2",
                                       type : "Measure",
                                       values : "Total Sales"
                                   },
                                   {
                                       uid : "bubbleWidth",
                                       type : "Measure",
                                       values :"Sales"
                                   },
                                   {
                                       uid : "color",
                                       type : "Dimension",
                                       values :"Region"
                                   }
                               ]
                           }
 
                       }
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   
                   var expectedListRes = cardTestData.expectedResult.Body;
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz,expectedListRes.VizFrame.feeds), "See that if the role given in config is not present in the annotations, default role is considered");
               });
           });
           
           test("Analytical Chart - Default Role to be considered(No roles defined)",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_DefaultRole(No Roles Defined).xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                        {
                                            uid : "valueAxis",
                                            type : "Measure",
                                            values : "Sales Share"
                                        },
                                        {
                                            uid : "valueAxis2",
                                            type : "Measure",
                                            values :"Total Sales"
                                        },
                                        {
                                            uid : "bubbleWidth",
                                            type : "Measure",
                                            values :"Sales"
                                        },
                                        {
                                            uid : "shape",
                                            type : "Dimension",
                                            values :"Product"
                                        }
                                    ]
                           }
                       }
                   }
               };
               
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   
                   var expectedListRes = cardTestData.expectedResult.Body;
                   
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz,expectedListRes.VizFrame.feeds), "See that if the role given in config is not present in the annotations, default role is considered");
                   
               });
           });
           
           test("Analytical Chart - Exceeding Max Dimensions",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_ExceedMaxDim.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CARD_ERROR + "in " + "bubble" +VizAnnotationManager.errorMessages.CARD_MOST + "2" + " " + "dimension(s)"),
                		   "Check if number of dimensions configured exceed max limit");
                   errorSpy.restore();
               });
           });
           
           test("Analytical Chart - With More Dimensions(Considering the role)",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_ExceedMaxDimConsideringRole.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   
                   
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CARD_ERROR + VizAnnotationManager.errorMessages.INVALID_REDUNDANT  +
						"dimension(s) Region. " + VizAnnotationManager.errorMessages.ALLOWED_ROLES + "bubble" + VizAnnotationManager.errorMessages.CHART_IS + "Category, Series"),
						"Check if the number of dimensions configured exceed the max limit(considering the role) ");
                   errorSpy.restore();
               });
           });
           
           test("Analytical Chart - Exceeding Max Measures",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_ExceedMaxMeas.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                  
                   
                   ok(errorSpy.calledWith(VizAnnotationManager.errorMessages.CARD_ERROR + "in " + "bubble" +
						VizAnnotationManager.errorMessages.CARD_MOST + "3" + " " + "measure(s)"), "Check if number of measures exceed max limit");
                   errorSpy.restore();
               });
           });
           
           test("Analytical Chart - Role to Feed Mapping",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_RoleToFeedMapping.xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                   {
                                       uid : "categoryAxis",
                                       type : "Dimension",
                                       values : "Product"
                                   },
                                   {
                                       uid : "color",
                                       type : "Dimension",
                                       values : "Region"
                                   },
                                   {
                                       uid : "valueAxis",
                                       type : "Measure",
                                       values :"Sales Share"
                                   }
                               ]
                           }
 
                       }
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   var feeds= cardViz.getFeeds();
                   
                   var cardCfg = cardTestData.card.settings;
                   var expectedListRes = cardTestData.expectedResult.Body;
 
                   // basic list XML structure tests
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz, expectedListRes.VizFrame.feeds), "See that the role to feed mapping is being done in the right way");
                   
               });
           });
           
           
           test("Analytical Chart - Feeds Without Roles",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Currency",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Currency",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Currency",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Currency",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Currency"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_FeedsWithNoRoles.xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                   {
                                       uid : "color",
                                       type : "Dimension",
                                       values : "Product"
                                   },
                                   {
                                       uid : "size",
                                       type : "Measure",
                                       values :"Sales Share"
                                   }
                               ]
                           }
 
                       }
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   var feeds= cardViz.getFeeds();
                   
                   var cardCfg = cardTestData.card.settings;
                   var expectedListRes = cardTestData.expectedResult.Body;
 
                   // basic list XML structure tests
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz, expectedListRes.VizFrame.feeds), "See that feeds without roles are being assigned correctly");
                   
               });
           });
           
           test("Analytical Chart - For a feed with undefined role, all Dim/Meas must be considered",function(){
 
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Currency",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Currency",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Currency",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Currency",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Currency"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_UndefinedRoles.xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                   {
                                       uid : "color",
                                       type : "Dimension",
                                       values : "Product,Region"
                                   },
                                   {
                                       uid : "size",
                                       type : "Measure",
                                       values :"Sales Share"
                                   }
                               ]
                           }
 
                       }
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   var feeds= cardViz.getFeeds();
                   
                   var cardCfg = cardTestData.card.settings;
                   var expectedListRes = cardTestData.expectedResult.Body;
 
                   // basic list XML structure tests
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz, expectedListRes.VizFrame.feeds), "If feed does not require a role, all dimensions are being considered for that feed.");
                   
               });
           });
           
           test("Analytical Chart - Check for '|' operator functionality",function(){
        	   
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_CtryCurr",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_PipeOperator.xml"
                   },
                   expectedResult: {
                       Body: {
                           VizFrame: {
                               feeds : [
                                        {
                                            uid : "valueAxis",
                                            type : "Measure",
                                            values : "Sales Share"
                                        },
                                        {
                                            uid : "valueAxis2",
                                            type : "Measure",
                                            values :"Total Sales"
                                        },
                                        {
                                            uid : "bubbleWidth",
                                            type : "Measure",
                                            values :"Sales"
                                        },
                                        {
                                            uid : "color",
                                            type : "Dimension",
                                            values :"Product"
                                        }
                                    ]
                           }
                       }
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                   var feeds= cardViz.getFeeds();
                   
                   var cardCfg = cardTestData.card.settings;
                   var expectedListRes = cardTestData.expectedResult.Body;
 
                   // basic list XML structure tests
                   ok(chartTestUtils.genericFeedBinding(cardXml,cardViz, expectedListRes.VizFrame.feeds), "See that the '|' operator works right.");
                   
               });
           });

           test("Analytical Chart - Test for MaxItems=0", function(){
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Zero_MaxItems",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
 
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   ok(cardViz.getDataset() &&
                      cardViz.getDataset().getBinding("data") &&
                      cardViz.getDataset().getBinding("data").getPath() === "",
                      "Check correct data binding");
               });
           });

           test("Analytical Chart - Test for MaxItems=0", function(){
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Zero_MaxItems",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   ok(cardViz.getDataset() &&
                      cardViz.getDataset().getBinding("data") &&
                      cardViz.getDataset().getBinding("data").getPath() === "",
                      "Check correct data binding");
                   var expectedLog = "OVP-AC: Analytic card Error: maxItems is configured as 0";
                   ok(errorSpy.calledWith(expectedLog), "Check correct error message is logged.");
                   errorSpy.restore();
               });
           });

           test("Analytical Chart - Test for MaxItems=abcd", function(){
               var cardTestData = {
                   card: {
                       "id": "chart_15",
                       "model": "salesShare",
                       "template": "sap.ovp.cards.charts.analytical",
                       "settings": {
                           "entitySet": "SalesShare",
                           "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_CtryCurr",
                           "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_CtryCurr",
                           "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#abcd_MaxItems",
                           "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_CtryCurr",
                           "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_CtryCurr"
                       }
                   },
                   dataSource: {
                       baseUrl: chartTestUtils.odataBaseUrl,
                       rootUri: chartTestUtils.odataRootUrl,
                       annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations.xml"
                   }
               };
 
               var oModel = cardTestUtils.createCardModel(cardTestData);
               stop();
               oModel.getMetaModel().loaded().then(function () {
                   var errorSpy = sinon.spy(jQuery.sap.log, "error");
                   var oView = cardTestUtils.createCardView(cardTestData, oModel);
 
                   //start the async test
                   start();
                   var cardViz=oView.byId("analyticalChart");
                   var cardXml = oView._xContent;
                   ok(cardViz !== undefined,"Existence check to VizFrame");
                   ok(cardXml !== undefined,"Existence check to XML parsing");
                   ok(cardViz.getDataset() &&
                      cardViz.getDataset().getBinding("data") &&
                      cardViz.getDataset().getBinding("data").getPath() === "",
                      "Check correct data binding");
                   var expectedLog = "OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.";
                   ok(errorSpy.calledWith(expectedLog), "Check correct error message is logged.");
                   errorSpy.restore();
               });
           });

           test("Analytical Chart - Test for Hiding Axis Title on header", function(){
        	   var cardTestData = {
                       card: {
                           "id": "chart_15",
                           "model": "salesShare",
                           "template": "sap.ovp.cards.charts.analytical",
                           "settings": {
                               "entitySet": "SalesShare",
                               "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                               "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                               "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                               "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                               "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                           }
                       },
                       dataSource: {
                           baseUrl: chartTestUtils.odataBaseUrl,
                           rootUri: chartTestUtils.odataRootUrl,
                           annoUri: chartTestUtils.testBaseUrl + "data/salesshare/annotations_RoleToFeedMapping.xml"
                       },
                       expectedResult: {
                           Body: {
                               VizFrame: {
                                   feeds : [
                                       {
                                           uid : "categoryAxis",
                                           type : "Dimension",
                                           values : "Product"
                                       },
                                       {
                                           uid : "color",
                                           type : "Dimension",
                                           values : "Region"
                                       },
                                       {
                                           uid : "valueAxis",
                                           type : "Measure",
                                           values :"Sales Share"
                                       }
                                   ]
                               }
     
                           }
                       }
                   };
     
                   var oModel = cardTestUtils.createCardModel(cardTestData);
                   stop();
                   oModel.getMetaModel().loaded().then(function () {
     
                       var oView = cardTestUtils.createCardView(cardTestData, oModel);
     
                       //start the async test
                       start();
                       var cardViz=oView.byId("analyticalChart");
                       var cardXml = oView._xContent;
                       ok(cardViz !== undefined,"Existence check to VizFrame");
                       ok(cardXml !== undefined,"Existence check to XML parsing");
                       sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(cardViz);
                       var vizProperties = cardViz.getVizProperties();
                       ok(vizProperties.categoryAxis.title.visible == false &&
                    		vizProperties.valueAxis.title.visible == false, "Test Axis title visibility");
                   });
               });
       }());
   </script>
</head>
<body>
<h1 id="qunit-header"></h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
</body>
</html>
