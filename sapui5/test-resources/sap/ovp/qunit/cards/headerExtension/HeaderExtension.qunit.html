<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>QUnit test for headerExtension.HeaderExtension - sap.ovp</title>

    <script id="sap-ui-bootstrap"
            type="text/javascript"
            src="../../../../../../resources/sap-ui-core.js"
            data-sap-ui-resourceroots='{
				"sap.ovp.test": "../../../../../sap/ovp/"
			}'>
    </script>

    <link rel="stylesheet" href="../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
    <script src="../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

    <script>
        (function () {
            "use strict";
            /* jQuery, sap */

            jQuery.sap.require("sap.ui.model.odata.AnnotationHelper");
            jQuery.sap.require("sap.ovp.test.qunit.cards.utils");

            var utils = sap.ovp.test.qunit.cards.utils;

            module("sap.ovp.cards.HeaderExtension", {
                /**
                 * This method is called before each test
                 */
                setup: function () {
                    jQuery.sap.require("sap.ovp.test.mockservers");
                    sap.ovp.test.mockservers.loadMockServer(utils.odataBaseUrl_salesOrder, utils.odataRootUrl_salesOrder);
                },
                /**
                 * This method is called after each test. Add every restoration code here
                 *
                 */
                teardown: function () {
                    sap.ovp.test.mockservers.close();
                }
            });

            asyncTest("Header - Screen reader accessability test", function () {
                var cardTestData = {
                    card: {
                        "id": "card_11",
                        "model": "salesOrder",
                        "template": "sap.ovp.test.qunit.cards.headerExtension",
                        "settings": {
                            "entitySet": "SalesOrderSet",
                            "description": "Static Description"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                            subTitle: "Static Description",
                            headerExtension: "OVP Extension Header Feature Simplest example ever"
                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);
                    var testContainer = jQuery('<div id="testContainer" style="display: none;">').appendTo('body');
                    oView.placeAt('testContainer');
                    oView.rerender();
                    oView.onAfterRendering = function () {
                        //start the async test
                        start();

                        var cardHtml = oView.getDomRef();
                        var headerRole = testContainer.find('.sapOvpCardHeader').attr('role');
                        ok(headerRole == "button", "header role is set for accessability");
                        oView.destroy();

                    };
                });
            });

            test("Card Test - Header Extension test - Load header extension fragment according to custom Component", function () {
                var cardTestData = {
                    card: {
                        "id": "card_11",
                        "model": "salesOrder",
                        "template": "sap.ovp.test.qunit.cards.headerExtension",
                        "settings": {
                            "entitySet": "SalesOrderSet",
                            "description": "Static Description"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                            subTitle: "Static Description",
                            headerExtension: "OVP Extension Header Feature Simplest example ever"
                        }
                    }
                };


                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {


                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined, "Existence check to XML parsing");

                    // validate the card's header XML
                    ok(utils.isValidCategory(cardTestData, cardXml), "Header's Category property Value");
                    ok(utils.isValidTitle(cardTestData, cardXml), "Header's Title property Value");
                    ok(utils.isValidSub(cardTestData, cardXml), "Header's Description property Value");

                    ok(utils.isValidHeaderExtension(cardTestData, cardXml), "Header Extension Custom Fragment - validate text injected");
                });
            });
        }());
    </script>
</head>
<body>
<h1 id="qunit-header"></h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
</body>
</html>
