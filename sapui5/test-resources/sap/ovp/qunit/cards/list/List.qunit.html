<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>QUnit test for cards.list.List - sap.ovp</title>

    <script id="sap-ui-bootstrap"
            data-sap-ui-language="en_US"
            type="text/javascript"
            src="../../../../../../resources/sap-ui-core.js"
            data-sap-ui-resourceroots='{
				"sap.ovp.test": "../../../../../sap/ovp/"
			}'
            data-sap-ui-xx-bindingSyntax="complex">
    </script>

    <link rel="stylesheet" href="../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
    <script src="../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
    <script src="../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

    <script>
        // @copyright@
        /**
         * @fileOverview QUnit tests for sap.ovp.Card
         */
        (function () {
            "use strict";
            /* jQuery, sap */

            /**
             * This is a hack, as the namespace 'sap.ovp.demo' when run in the qunit results in wrong resource prefix
             * so i change now manually - to continue work. consult Aviad what causes this so we could remove this.
             */
            jQuery.sap.require("sap.ui.model.odata.AnnotationHelper");
            jQuery.sap.require("sap.ovp.test.qunit.cards.utils");
            jQuery.sap.require("sap.ui.core.format.NumberFormat");

            var utils = sap.ovp.test.qunit.cards.utils;
            var testContainer;

            module("sap.ovp.cards.List", {
                /**
                 * This method is called before each test
                 */
                setup: function () {
                    jQuery.sap.require("sap.ovp.test.mockservers");
                    sap.ovp.test.mockservers.loadMockServer(utils.odataBaseUrl_salesOrder, utils.odataRootUrl_salesOrder);
                    sap.ovp.test.mockservers.loadMockServer(utils.odataBaseUrl_salesShare, utils.odataRootUrl_salesShare);
                    testContainer = jQuery('<div id="testContainer" style="display: none;">').appendTo('body');
                },
                /**
                 * This method is called after each test. Add every restoration code here
                 *
                 */
                teardown: function () {
                    sap.ovp.test.mockservers.close();
                    jQuery(testContainer).remove();
                }
            });


            test("Card Test - testing Parameterized EntitySet - Valid Parameterized configuration (annotations & card settings)- formatItems should parse it correctly", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant",
                            "entitySet": "SalesShare"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesShare,
                        rootUri: utils.odataRootUrl_salesShare,
                        annoUri: utils.testBaseUrl + "data/salesshare/annotations_parameterized_ES_Valid.xml"
                    },
                    expectedResult: {
                        Body: {
                            List: {
                                itemsAggregationBinding : "{path: '/SalesShareParameters(P_Currency=%27EUR%27,P_Country=%27IN%27)/Results', length: 5}"
                            }
                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var listNodeXml = sap.ovp.test.qunit.cards.utils.getListItemsNode(cardXml);
                    ok(listNodeXml !== undefined,"Existence check to XML Node of List");

                    var itemsAggregationValue = listNodeXml.getAttribute('items');
                    ok(itemsAggregationValue == cardTestData.expectedResult.Body.List.itemsAggregationBinding,"List XML items-aggregation's value Includes the Parameterized-Entity-Set");
                });
            });


            test("Card Test - testing Parameterized EntitySet - Invalid Parameterized configuration - No Selection Variant in card settings, Valid Selection Variant in Annotations", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "entitySet": "SalesShare"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesShare,
                        rootUri: utils.odataRootUrl_salesShare,
                        annoUri: utils.testBaseUrl + "data/salesshare/annotations_parameterized_ES_Valid.xml"
                    },
                    expectedResult: {
                        Body: {
                            List: {
                                itemsAggregationBinding : "{path: '/SalesShare', length: 5}"
                            }
                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var listNodeXml = sap.ovp.test.qunit.cards.utils.getListItemsNode(cardXml);
                    ok(listNodeXml !== undefined,"Existence check to XML Node of List");

                    var itemsAggregationValue = listNodeXml.getAttribute('items');
                    ok(itemsAggregationValue == cardTestData.expectedResult.Body.List.itemsAggregationBinding,"List XML items-aggregation's value Includes the Parameterized-Entity-Set");
                });
            });


            test("Card Test - testing Parameterized EntitySet - Invalid Parameterized configuration - Invalid Selection Variant value in card settings, Valid Selection Variant annotations", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariantInvalidValue",
                            "entitySet": "SalesShare"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesShare,
                        rootUri: utils.odataRootUrl_salesShare,
                        annoUri: utils.testBaseUrl + "data/salesshare/annotations_parameterized_ES_Valid.xml"
                    },
                    expectedResult: {
                        Body: {
                            List: {
                                itemsAggregationBinding : "{path: '/SalesShare', length: 5}"
                            }
                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var listNodeXml = sap.ovp.test.qunit.cards.utils.getListItemsNode(cardXml);
                    ok(listNodeXml !== undefined,"Existence check to XML Node of List");

                    var itemsAggregationValue = listNodeXml.getAttribute('items');
                    ok(itemsAggregationValue == cardTestData.expectedResult.Body.List.itemsAggregationBinding,"List XML items-aggregation's value Includes the Parameterized-Entity-Set");
                });
            });

            test("Card Test - Full annotations - With Entity Path - Header Config No Properties - with listType=extended", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "SalesOrderLineItemSet",
                            "type": "sap.ovp.cards.list.List"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\} *\/ *\{path: *'ItemPosition'.*\}/,
                                    number: /\{path: *'Quantity'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: "None"
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'ProductID'.*\}/
                                        },
                                        {
                                            text: /\{path: *'DeliveryDate'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full annotations - With Entity Path - Header Config No Properties - NO listType (check default is ObjectListItem)", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "entitySet": "SalesOrderLineItemSet",
                            "type": "sap.ovp.cards.list.List"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\} *\/ *\{path: *'ItemPosition'.*\}/,
                                    description: /\{path: *'ProductID'.*\}/,
                                    info: /\{path: *'Quantity'.*\}/,
                                    infoState: "None"
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });


            test("Card Test - Full annotations - With Entity Path - Header Config No Properties - listType=condensed", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType": "condensed",
                            "entitySet": "SalesOrderLineItemSet",
                            "type": "sap.ovp.cards.list.List"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\} *\/ *\{path: *'ItemPosition'.*\}/,
                                    description: /\{path: *'ProductID'.*\}/,
                                    info: /\{path: *'Quantity'.*\}/,
                                    infoState: "None"
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });



            test("Card Test - Full Annotations - No Entity Path - Header Config No Properties - listType=extended", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "ProductSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: { // e.g. no header properties in the XML
                            title: undefined,
                            subTitle: undefined,
                            category: undefined
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'ProductID'.*\}/,
                                    number: /\{path: *'MeasureUnit'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [{
                                        text: /\{path: *'Name'.*\}/,
                                        state: "None"
                                    }],
                                    ObjectAttribute: [{
                                        text: /\{path: *'Category'.*\}/
                                    }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");


                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full Annotations - No Entity Path - Header Config No Properties - listType=extended", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "ProductSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: { // e.g. no header properties in the XML
                            title: undefined,
                            subTitle: undefined,
                            category: undefined
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'ProductID'.*\}/,
                                    number: /\{path: *'MeasureUnit'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'Name'.*\}/,
                                            state: "None"
                                        },
                                        {
                                            text: /\{path: *'Price'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'Category'.*\}/
                                        },
                                        {
                                            text: /\{path: *'SupplierName'.*\}/
                                        }
                                    ]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");


                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Sort By Importance - listType=extended", function () {
                var cardTestData = {
                    card: {
                        "id": "card_15",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "BusinessPartnerSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: { // e.g. no header properties in the XML
                            title: undefined,
                            subTitle: undefined,
                            category: undefined
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'BusinessPartnerID'.*\}/,
                                    number: /\{path: *'CurrencyCode'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'PhoneNumber'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'CompanyName'.*\}.*\{path: *'LegalForm'.*\}/
                                        },
                                        {
                                            text: /\{path: *'BusinessPartnerRole'.*\}/
                                        }
                                    ]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");


                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            /*
             test("Card Test - 3 DataPoints - listType=extended", function () {
             var cardTestData = {
             card: {
             "id": "card_15",
             "model": "salesOrder",
             "template": "sap.ovp.cards.list",
             "settings": {
             "listType" : "extended",
             "entitySet": "ContactSet"
             }
             },
             dataSource: {
             baseUrl: utils.odataBaseUrl,
             rootUri: utils.odataRootUrl,
             annoUri: utils.testBaseUrl + "data/annotations.xml"
             },
             expectedResult: {
             Header: { // e.g. no header properties in the XML
             title: undefined,
             description: undefined,
             category: undefined
             },
             Body: {
             List: {
             ListItem: {
             title: /\{path: *'FirstName'.*\}.*\{path: *'LastName'.*\}/,
             number: /\{path: *'Sex'.*\}/,
             numberState: "None",
             ObjectStatus: [
             {
             text: /\{path: *'FaxNumber'.*\}/,
             state: "None"
             },
             {
             text: /\{path: *'PhoneNumber'.*\}/,
             state: "None"
             }
             ],
             ObjectAttribute: [
             {
             text: /\{ToBusinessPartner\/CompanyName\}/
             },
             {
             text: /\{path: *'EmailAddress'.*\}/
             }
             ]
             }
             }

             }
             }
             };

             var oModel = utils.createCardModel(cardTestData);
             stop();
             oModel.getMetaModel().loaded().then(function () {

             var oView = utils.createCardView(cardTestData, oModel);

             //start the async test
             start();

             var cardXml = oView._xContent;
             ok(cardXml !== undefined,"Existence check to XML parsing");


             var cardCfg = cardTestData.card.settings;
             var expectedListRes = cardTestData.expectedResult.Body.List;

             // basic list XML structure tests
             ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
             ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

             // specific XML property binding value test
             ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
             });
             });
             */

            test("Card Test - Full Annotations - No Entity Path - Header Config No Properties - listType=condensed, listFlavor=bar", function () {
                var cardTestData = {
                    card: {
                        "id": "card9",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Sales Orders - listType = Condensed Bar List",
                            "title" : "Bar List Card",
                            "description" : "",
                            "listType" : "condensed",
                            "listFlavor": "bar",
                            "entitySet": "ProductSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations_barListCard.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                CustomListItem: {
                                    title: /\{path: *'ProductID'.*\}/,
                                    progressIndicator:/\{path: *'Price'.*\}/,
                                    firstDataPoint: /\{path: *'Price'.*\}/,
                                    SecondDataPoint: /\{path: *'MeasureUnit'.*\}/
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full Annotations - No Entity Path - Header Config No Properties - listType=extended, listFlavor=bar", function () {
                var cardTestData = {
                    card: {
                        "id": "card10",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Sales Orders - listType = Extended Bar List",
                            "title": "Bar List Card",
                            "description": "",
                            "listType": "extended",
                            "listFlavor": "bar",
                            "entitySet": "ProductSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations_barListCard.xml"
                    },
                    expectedResult: {
                        Header: { // e.g. no header properties in the XML
                        },
                        Body: {
                            List: {
                                CustomListItem: {
                                    firstDataFiled: /\{path: *'ProductID'.*\}/,
                                    secondDataFiled: /\{path: *'Category'.*\}/,
                                    progressIndicator: /\{path: *'Price'.*\}/,
                                    firstDataPoint: /\{path: *'Price'.*\}/,
                                    secondDataPoint: /\{path: *'MeasureUnit'.*\}/,
                                    thirdDataPoint: /\{path: *'Depth'.*\}/
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");


                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Without third data point annotations - No Entity Path - Header Config No Properties - listType=extended, listFlavor=bar", function () {
                var cardTestData = {
                    card: {
                        "id": "card10",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Sales Orders - listType = Extended Bar List",
                            "title": "Bar List Card",
                            "description": "",
                            "listType": "extended",
                            "listFlavor": "bar",
                            "entitySet": "SalesOrderSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations_barListCard.xml"
                    },
                    expectedResult: {
                        Header: { // e.g. no header properties in the XML
                        },
                        Body: {
                            List: {
                                CustomListItem: {
                                    firstDataFiled: /\{path: *'SalesOrderID'.*\}/,
                                    secondDataFiled: /\{path: *'CustomerName'.*\}/,
                                    progressIndicator: /\{path: *'GrossAmount'.*\}/,
                                    firstDataPoint: /\{path: *'GrossAmount'.*\}/,
                                    secondDataPoint: /\{path: *'LifecycleStatus'.*\}/
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");


                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml,cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card List Controller Test- normalizeValueToPercentage First Data Point does not have Percentage Unit", function () {
                var oView, oController, oSavePromise,
                        cardTestData = {
                            card: {
                                "id": "card9",
                                "model": "salesOrder",
                                "template": "sap.ovp.cards.list",
                                "settings": {
                                    "category": "Sales Orders - listType = Condensed Bar List",
                                    "title" : "Bar List Card",
                                    "description" : "",
                                    "listType" : "condensed",
                                    "listFlavor": "bar",
                                    "entitySet": "ProductSet"
                                }
                            },
                            dataSource: {
                                baseUrl: utils.odataBaseUrl_salesOrder,
                                rootUri: utils.odataRootUrl_salesOrder,
                                annoUri: utils.testBaseUrl + "data/annotations_barListCard.xml"
                            },
                            expectedResult: {
                                Header: { // e.g. no header properties in the XML
                                },
                                Body: {
                                    List: {
                                        CustomListItem: {
                                            title: /\{path: *'ProductID'.*\}/,
                                            progressIndicator:/\{path: *'Price'.*\}/,
                                            firstDataPoint: /\{path: *'Price'.*\}/,
                                            SecondDataPoint: /\{path: *'WeightMeasure'.*\}/
                                        }
                                    }

                                }
                            }
                        };

                var oModel = utils.createCardModel(cardTestData);
                stop();

                oModel.getMetaModel().loaded().then(function () {
                    oView = utils.createCardView(cardTestData, oModel);
                    oController = oView.getController();
                    oController.getOwnerComponent = function () {
                        return new sap.ui.core.UIComponent()
                    };
                    oController.maxValue = 1000;
                    start();

                    ok(oController.normalizeValueToPercentage(700) == '70', "Percentage calculation is correct");
                    ok(oController.normalizeValueToPercentage(2000) == '100', "When value is grater then maxValue the result is 100%");
                    ok(oController.normalizeValueToPercentage(0) == '0.5', "When value is 0 result is 0.5%");

                });
            });

            test("Card List Controller Test- normalizeValueToPercentage First Data Point has Percentage Unit", function () {
                var oView, oController, oSavePromise,
                        cardTestData = {
                            card: {
                                "id": "card9",
                                "model": "salesOrder",
                                "template": "sap.ovp.cards.list",
                                "settings": {
                                    "category": "Sales Orders - listType = Condensed Bar List",
                                    "title" : "Bar List Card",
                                    "description" : "",
                                    "listType" : "condensed",
                                    "listFlavor": "bar",
                                    "entitySet": "ProductSetWithPercentage"
                                }
                            },
                            dataSource: {
                                baseUrl: utils.odataBaseUrl_salesOrder,
                                rootUri: utils.odataRootUrl_salesOrder,
                                annoUri: utils.testBaseUrl + "data/annotations.xml"
                            },
                            expectedResult: {
                            }
                        };

                var oModel = utils.createCardModel(cardTestData);
                stop();

                oModel.getMetaModel().loaded().then(function () {
                    oView = utils.createCardView(cardTestData, oModel);
                    oController = oView.getController();
                    oController.getOwnerComponent = function () {
                        return new sap.ui.core.UIComponent()
                    };
                    start();

                    ok(oController.normalizeValueToPercentage(70) == '70', "value is returned with no change");


                });
            });

            test("List Card Test - use annotationPath with FieldGroup", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "SalesOrderLineItemSet",
                            "type": "sap.ovp.cards.list.List",
                            "annotationPath": "com.sap.vocabularies.UI.v1.FieldGroup#ForCard/Data"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\}/,
                                    number: /\{path: *'GrossAmount'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'Quantity'.*\}/,
                                            state: "None"
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'DeliveryDate'.*\}/
                                        },
                                        {
                                            text: /\{path: *'ProductID'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("List Card Test - Count Footer exists", function(){
                var cardTestData = {
                    card: {
                        "id": "card_16",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType": "extended",
                            "entitySet": "SalesOrderLineItemSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    //start the async test
                    start();

                    var oView = utils.createCardView(cardTestData, oModel);
                    var oController = oView.getController();
                    var oItemsBinding = oController.getCardItemsBinding();
                    oItemsBinding.getLength = function () {
                        return 6;
                    };
                    oItemsBinding.getCurrentContexts = function () {
                        return [1, 2, 3];
                    };

                    oController.onAfterRendering();
                    //CreateData Change event
                    oItemsBinding.fireDataReceived();

                    var footerString = oView.byId("ovpCountFooter").getText();
                    ok(footerString.match(/3{1} .* 6{1}$/));
                });
            });

            test("List Card Test - navigation from line item", function(){
                var cardTestData = {
                    card: {
                        "id": "card_16",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "entitySet": "SalesOrderLineItemSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    //start the async test
                    start();

                    var oView = utils.createCardView(cardTestData, oModel);
                    var oController = oView.getController();
                    var doIntentBasedNavigationStub = sinon.stub(oController, "doNavigation");
                    var oBindingContext = {id: "bindingcontext"};
                    var oEvent = {
                        getSource: function(){return {getBindingContext: function(){return oBindingContext;}}}
                    };
                    oController.onListItemPress(oEvent);
                    equal(doIntentBasedNavigationStub.callCount, 1, "doIntentBasedNavigationStub call count");
                    deepEqual(doIntentBasedNavigationStub.args[0][0], oBindingContext, "doIntentBasedNavigationStub conetxt parameter");
                    equal(doIntentBasedNavigationStub.args[0][1].label, "Navigation from line item", "doIntentBasedNavigationStub intent parameter");
                });
            });

            test("List Card Test - navigation to url from line item", function(){
                var cardTestData = {
                    card: {
                        "id": "card_16",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "entitySet": "BusinessPartnerSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations_for_url_navigation.xml"
                    }
                };
                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function(){
                            oModel.read("/BusinessPartnerSet");
                        }
                );
                var functionWasAlreadyCalled;
                oModel.attachBatchRequestCompleted(function () {
                    if(functionWasAlreadyCalled){
                        return;
                    }
                    functionWasAlreadyCalled = true;

                    start();
                    var oView = utils.createCardView(cardTestData, oModel);
                    var oController = oView.getController();
                    var doNavigationStub = sinon.stub(oController, "doNavigation");
                    var oBindingContext = oModel.createBindingContext("/BusinessPartnerSet('0100000000')");
                    var oEvent = {
                        getSource: function(){return {getBindingContext: function(){return oBindingContext;}}}
                    };
                    oController.onListItemPress(oEvent);
                    equal(doNavigationStub.callCount, 1, "doNavigationStub call count");
                    deepEqual(doNavigationStub.args[0][0], oBindingContext, "doNavigationStub conetxt parameter");
                    equal(doNavigationStub.args[0][1].label, "Link to", "doNavigationStub parameter");
                    equal(doNavigationStub.args[0][1].url, "https://www.google.de/maps/place/%27Dietmar-Hopp-Allee%27,%27Walldorf%27", "doNavigationStub parameter");

                });

            });

            test("List Card Screen reader attribute test", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "extended",
                            "entitySet": "SalesOrderLineItemSet",
                            "type": "sap.ovp.cards.list.List"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\} *\/ *\{path: *'ItemPosition'.*\}/,
                                    number: /\{path: *'Quantity'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: "None"
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'ProductID'.*\}/
                                        },
                                        {
                                            text: /\{path: *'DeliveryDate'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };


                var oModel = utils.createCardModel(cardTestData);
                stop();

                oModel.getMetaModel().loaded().then(function () {
                    var oView = utils.createCardView(cardTestData, oModel);
                    oView.placeAt('testContainer');
                    oView.onAfterRendering = function () {
                        var cardHtml = oView.getDomRef();
                        var cardListContent = testContainer.find(".sapMList");
                        var cardListFooter = testContainer.find(".sapOvpCardFooter ");

                        //start the async test
                        start();

                        //Check list
                        ok(cardListContent.attr("aria-label") == sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("listCard"), "List Card type is accessble");
                        ok(cardListContent.attr("role") == "heading", "card role is define");

                        //Check footer
                        ok(cardListFooter.attr("role") == "toolbar", "footer role is define");
                        oView.destroy();
                    };
                });
            });

            test ("Bar Chart Card Screen Reader attribute test", function () {
                var cardTestData = {
                    card: {
                        "id": "card9",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Sales Orders - listType = Condensed Bar List",
                            "title" : "Bar List Card",
                            "description" : "",
                            "listType" : "condensed",
                            "listFlavor": "bar",
                            "entitySet": "ProductSet"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations_barListCard.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                CustomListItem: {
                                    title: /\{path: *'ProductID'.*\}/,
                                    progressIndicator:/\{path: *'Price'.*\}/,
                                    firstDataPoint: /\{path: *'Price'.*\}/,
                                    SecondDataPoint: /\{path: *'WeightMeasure'.*\}/
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();

                oModel.getMetaModel().loaded().then(function () {
                    var oView = utils.createCardView(cardTestData, oModel);
                    oView.placeAt('testContainer');

                    oView.onAfterRendering = function () {
                        //start the async test
                        start();

                        var cardHtml = oView.getDomRef();
                        var jqView = testContainer.find("#" + oView.sId);
                        var cardListContent = jqView.find(".sapMList");

                        ok(cardListContent.attr("aria-label") == sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("barChartCard"), "Bar Chart Card type is accessble");
                        ok(cardListContent.attr("role") == "heading", "card role is define");
                        oView.destroy();
                    };
                });
            });

            test("List Card Test - annotation with expand", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "listType" : "condensed",
                            "entitySet": "SalesOrderSet",
                            "type": "sap.ovp.cards.list.List",
                            "annotationPath" : "com.sap.vocabularies.UI.v1.LineItem#ToTestExpand"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'ToBusinessPartner\/EmailAddress'.*\}/,
                                    description: /\{path: *'SalesOrderID'.*\}/,
                                    info: /\{path: *'CustomerName'.*\}/,
                                    infoState: "None"
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;

                    // basic list XML structure tests
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full annotations - With KPI Header with DP, Filter And Selection", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Contract Monitoring",
                            "title": "Contract Expiry, Consumption and Target Value",
                            "description": "",
                            "listType": "extended",
                            "entitySet": "SalesOrderSet",
                            "selectionAnnotationPath": "com.sap.vocabularies.UI.v1.SelectionVariant#line",
                            "chartAnnotationPath": "com.sap.vocabularies.UI.v1.Chart#line",
                            "presentationAnnotationPath": "com.sap.vocabularies.UI.v1.PresentationVariant#line",
                            "dataPointAnnotationPath": "com.sap.vocabularies.UI.v1.DataPoint#line",
                            "identificationAnnotationPath": "com.sap.vocabularies.UI.v1.Identification"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotationsKPI.xml"
                    },
                    expectedResult: {
                        Header: {
                            KPI : {
                                number: true,
                                headerTitleContent : "Sales Orders Amounts by Status",
                                numberAggregateNumberContent: {
                                    filters : [
                                        [
                                            '"path":"GrossAmount"',
                                            '"operator":"BT"',
                                            '"value1":"0"',
                                            '"value2":"800000"'
                                        ]
                                    ]
                                },
                                numberNumericContentValue : /\{path:'GrossAmount'.*\,/,
                                numberUOM : /\{path: *'CurrencyCode'.*\}/,
                                sortBy: true,
                                sortByContent: "By Lifecycle Descript., Delivery Description",
                                filterBy: true
                            }
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\}/,
                                    number: /\{path: *'LifecycleStatus'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: /\{path: *'GrossAmount'.*\}/
                                        },
                                        {
                                            text: /\{path: *'LifecycleStatus'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'CustomerName'.*\}/
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;
                    var expectedHeaderRes = cardTestData.expectedResult.Header;


                    // basic list XML structure tests and KPI
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");
                    ok(utils.validateOvpKPIHeader(cardXml, expectedHeaderRes), "Header KPI Check");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full annotations - With KPI Header with DP and Filter-By Values (No SortBy)", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Contract Monitoring",
                            "title": "Contract Expiry, Consumption and Target Value",
                            "description": "",
                            "listType": "extended",
                            "entitySet": "SalesOrderSet",
                            "selectionAnnotationPath": "com.sap.vocabularies.UI.v1.SelectionVariant#line",
                            "chartAnnotationPath": "com.sap.vocabularies.UI.v1.Chart#line",
                            "dataPointAnnotationPath": "com.sap.vocabularies.UI.v1.DataPoint#line",
                            "identificationAnnotationPath": "com.sap.vocabularies.UI.v1.Identification"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotationsKPI.xml"
                    },
                    expectedResult: {
                        Header: {
                            KPI : {
                                number: true,
                                headerTitleContent : "Sales Orders Amounts by Status",
                                numberAggregateNumberContent: {
                                    filters : [
                                        [
                                            '"path":"GrossAmount"',
                                            '"operator":"BT"',
                                            '"value1":"0"',
                                            '"value2":"800000"'
                                        ]
                                    ]
                                },
                                numberNumericContentValue : /\{path:'GrossAmount'.*\,/,
                                numberUOM : /\{path: *'CurrencyCode'.*\}/,
                                sortBy: false,
                                filterBy: true
                            }
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\}/,
                                    number: /\{path: *'LifecycleStatus'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: /\{path: *'GrossAmount'.*\}/
                                        },
                                        {
                                            text: /\{path: *'LifecycleStatus'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'CustomerName'.*\}/
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;
                    var expectedHeaderRes = cardTestData.expectedResult.Header;

                    // basic list XML structure tests and KPI
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");
                    ok(utils.validateOvpKPIHeader(cardXml, expectedHeaderRes), "Header KPI Check");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full annotations - With KPI Header with DP And Sort (No Filter-By-values)", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Contract Monitoring",
                            "title": "Contract Expiry, Consumption and Target Value",
                            "description": "",
                            "listType": "extended",
                            "entitySet": "SalesOrderSet",
                            "chartAnnotationPath": "com.sap.vocabularies.UI.v1.Chart#line",
                            "presentationAnnotationPath": "com.sap.vocabularies.UI.v1.PresentationVariant#line",
                            "dataPointAnnotationPath": "com.sap.vocabularies.UI.v1.DataPoint#line",
                            "identificationAnnotationPath": "com.sap.vocabularies.UI.v1.Identification"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotationsKPI.xml"
                    },
                    expectedResult: {
                        Header: {
                            KPI : {
                                number: true,
                                headerTitleContent : "Sales Orders Amounts by Status",
                                numberAggregateNumberContent: {
                                    filters : []
                                },
                                numberNumericContentValue : /\{path:'GrossAmount'.*\,/,
                                numberUOM : /\{path: *'CurrencyCode'.*\}/,
                                sortBy: true,
                                sortByContent: "By Lifecycle Descript., Delivery Description",
                                filterBy: false
                            }
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\}/,
                                    number: /\{path: *'LifecycleStatus'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: /\{path: *'GrossAmount'.*\}/
                                        },
                                        {
                                            text: /\{path: *'LifecycleStatus'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'CustomerName'.*\}/
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;
                    var expectedHeaderRes = cardTestData.expectedResult.Header;

                    // basic list XML structure tests and KPI
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");
                    ok(utils.validateOvpKPIHeader(cardXml, expectedHeaderRes), "Header KPI Check");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });

            test("Card Test - Full annotations - With KPI Header with NO DP but with Filter And Selection", function () {
                var cardTestData = {
                    card: {
                        "id": "card_14",
                        "model": "salesOrder",
                        "template": "sap.ovp.cards.list",
                        "settings": {
                            "category": "Contract Monitoring",
                            "title": "Contract Expiry, Consumption and Target Value",
                            "description": "",
                            "listType": "extended",
                            "entitySet": "SalesOrderSet",
                            "selectionAnnotationPath": "com.sap.vocabularies.UI.v1.SelectionVariant#line",
                            "chartAnnotationPath": "com.sap.vocabularies.UI.v1.Chart#line",
                            "presentationAnnotationPath": "com.sap.vocabularies.UI.v1.PresentationVariant#line",
                            "identificationAnnotationPath": "com.sap.vocabularies.UI.v1.Identification"
                        }
                    },
                    dataSource: {
                        baseUrl: utils.odataBaseUrl_salesOrder,
                        rootUri: utils.odataRootUrl_salesOrder,
                        annoUri: utils.testBaseUrl + "data/annotationsKPI.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            List: {
                                ListItem: {
                                    title: /\{path: *'SalesOrderID'.*\}/,
                                    number: /\{path: *'LifecycleStatus'.*\}/,
                                    numberState: "None",
                                    ObjectStatus: [
                                        {
                                            text: /\{path: *'GrossAmount'.*\}/,
                                            state: /\{path: *'GrossAmount'.*\}/
                                        },
                                        {
                                            text: /\{path: *'LifecycleStatus'.*\}/,
                                            state: "None"
                                        }
                                    ],
                                    ObjectAttribute: [
                                        {
                                            text: /\{path: *'CustomerName'.*\}/
                                        },
                                        {
                                            text: /\{path: *'NetAmount'.*\}/
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = utils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = utils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body.List;
                    var expectedHeaderRes = cardTestData.expectedResult.Header;


                    // basic list XML structure tests and KPI
                    ok(utils.listNodeExists(cardXml), "Basic XML check - see that there is a List node");
                    ok(utils.listItemsNodeExists(cardXml, cardCfg), "Basic XML check - see that there is a items node");
                    ok(utils.validateOvpKPIHeader(cardXml, expectedHeaderRes), "Header KPI Check");

                    // specific XML property binding value test
                    ok(utils.validateListXmlValues(cardXml, cardCfg, expectedListRes), "List XML Values");
                });
            });
        }());

    </script>
</head>
<body>
<h1 id="qunit-header"></h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
</body>
</html>
