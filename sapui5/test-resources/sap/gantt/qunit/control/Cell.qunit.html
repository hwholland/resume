<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta charset="UTF-8">
		<title>QUnit: sap.gantt.control.Cell</title>
		<script id="sap-ui-bootstrap"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.gantt">
		</script>
		<link rel="stylesheet" type="text/css" href="../../../../../resources/sap/ui/thirdparty/qunit.css"/>
		<script src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script>
		if(!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
			jQuery.sap.require("sap.ui.qunit.qunit-coverage");
		}
			sap.ui.require([
				"sap/gantt/control/Cell",
				"sap/gantt/config/HierarchyColumn",
				"sap/gantt/config/ColumnAttribute",
				"sap/ui/thirdparty/sinon",
				"sap/ui/thirdparty/sinon-qunit"
			], function (Cell, HierarchyColumn, ColumnAttribute) {
				"use strict";

				QUnit.module("Test cell", {
					setup: function () {
						//create cell callback
						var cellCallback = function () {};
						cellCallback.prototype.createCellContent = function () {
							return new sap.m.Label({});
						};
						cellCallback.prototype.updateCellContent = function (oCellContent, oContext, sAttributeName, sObjectType) {
							if (sAttributeName !== undefined) {
								oCellContent.setText(oContext.getProperty(sAttributeName) + "_updated");
							}
						};
						//create model
						var oData = {
									root:{
										id: "NN",
										type: "root",
										plate: "NN",
										0: {
											id: "00",
											type: "che",
											plate: "ABC",
											0: {
												id: "00_0",
												type: "gua",
												plate: "GUA_ABC",
											},
											1: {
												id: "00_1",
												type: "gua",
												plate: "GUA_ABC2",
											}
										},
										1:{
											id: "01",
											type: "che",
											plate: "DEF",
										}
									}
							};
						var oModel = new sap.ui.model.json.JSONModel();
						oModel.setData(oData);
						//create table
						this.oTreeTable = new sap.ui.table.TreeTable().placeAt("UIArea0");
						var oCol = new sap.ui.table.Column({
							"label": "ID",
							"template": new Cell({
								columnConfig: new HierarchyColumn({
									key: "h1",
									title: "Id",
									contentType: "1",
									attribute: "id"
								}),
								"cellCallback": new cellCallback()
							})
						});
						this.oTreeTable.addColumn(oCol);
						oCol = new sap.ui.table.Column({
							"label": "Plate No.",
							"template": new Cell({
								columnConfig: new HierarchyColumn({
									key: "h2",
									title: "Name / Plate",
									contentType: "1",
									attributes: [new ColumnAttribute ({
										objectTypeKey: "che",
										attribute: "plate"
									}), new ColumnAttribute ({
										objectTypeKey: "gua",
										attribute: "serial"
									})]
								}),
								"cellCallback": new cellCallback()
							})
						});
						this.oTreeTable.addColumn(oCol);
						this.oTreeTable._bCallUpdateTableCell = true;
						this.oTreeTable.setModel(oModel);
						this.oTreeTable.bindRows("/root");
						this.fnGetCellTexts = function() {
							this.cellTexts = [[this.oTreeTable.getRows()[0].getCells()[0].getContentToRender().getText()]];
							this.cellTexts[0][1] = this.oTreeTable.getRows()[0].getCells()[1].getContentToRender().getText();
							return this.cellTexts;
						};
					},

					teardown: function () {
						this.oTreeTable.destroy();
					}
				});

				QUnit.test("Test cell", function (assert) {
					var done = assert.async();
					var that = this;
					setTimeout(function() {
						assert.deepEqual(that.fnGetCellTexts(), [["00_updated","ABC_updated"]], "Cell content updated");
						done();
					}, 2000);
				});
			});
		</script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="UIArea0"></div>
	</body>
</html>
