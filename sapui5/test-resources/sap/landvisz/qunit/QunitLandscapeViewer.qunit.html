<!DOCTYPE HTML>
<!-- 
  Tested control/class: sap.landvisz.LandscapeEntity
  Author: SAP
-->

<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Qunit for Landscape Entity Control</title>
	<script id="sap-ui-bootstrap" 
		type="text/javascript"
		src="../../../../resources/sap-ui-core.js"
		data-sap-ui-theme="sap_goldreflection"
		data-sap-ui-language="en-US"
		data-sap-ui-noConflict="true"
		data-sap-ui-libs="sap.ui.commons,sap.ui.ux3,sap.landvisz"
		data-sap-ui-preload="false">
	</script>
	
	<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
	<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
	<script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
	
	<!-- Control initialization -->

<script type="text/javascript" src="js/html2canvas.js">	</script>

<script language="javascript">
var that = this;
var oModel = null;

var subActions = [ 
    		      { text :"PMD1",tooltip:"pmd1", subAction:[
         	                                 {text :"PMD11",tooltip:"pmd11"},{text :"PMD12",tooltip:"pmd12"}]
        		  },
        	
            		{ text :"PMD2",tooltip:"pmd2", subAction:[
                   	                                 
    													{text :"PMD21",tooltip:"pmd21"},{text :"PMD22",tooltip:"pmd22"}]
    				},
    				{ text :"PMD3",tooltip:"pmd3"},
    				{ text :"PMD4",tooltip:"pmd4", subAction:[
    											{text :"PMD41",tooltip:"pmd41"}]
    				},
    			];
    	



var oViewer = new sap.landvisz.LandscapeViewer("viewer",{
    navigationPath : "Product Maintenance Dependency",
    viewType : sap.landvisz.ViewType.DEPENDENCY_VIEW,
    defaultDependencyView : sap.landvisz.DependencyType.BOX_VIEW,
    networkDependencyLabel : "Network View",
    boxDependencyLabel : "Box View",
    showDependencyNavigator : true,
    visibleDependency : sap.landvisz.DependencyVisibility.BOTH,
    boxDependencyLevels : ["Systems","Shared Systems"]

});


oViewer.setViewType(sap.landvisz.ViewType.DEPENDENCY_VIEW);
oViewer.setHasParent(false);


	  var oLandEntity = new sap.landvisz.LandscapeEntity({

				systemName : "{@name}",
				systemId : "{@id}",
				tooltip : "{@tooltip}",
				type : sap.landvisz.LandscapeObject.TechnicalSystem,
				qualifierType : "{@type_name}",
				id : "aminId",
				qualifierText : "{@type_name}",
				systemStatus: sap.landvisz.ModelingStatus.ERROR,
				renderingSize : sap.landvisz.EntityCSSSize.Medium,
				stateIconTooltip: "{update_tooltip}",
				stateIconSrc:{
				path:"@update_type",
				formatter: function(fValue) {
					if(fValue == "update"){
						return "res/img/status/24x24/update.png";
					}
					else if(fValue == "new")
						return "res/img/status/24x24/new.png";
				return "";
				}}
					//containers: "{/headers}"

		 });
// 		oLandEntity.attachSelect(function(oControlEvent) {
//             oViewer.appendNavigationPath("Some path");
//     });

				var oModel = new sap.ui.model.xml.XMLModel();
				oModel.loadData("res/PMD.xml", null, false);
				//oModel.setXML(xmlModel);
				oViewer.setModel(oModel);
				oViewer.bindAggregation("systems","/lsp:entities/lsp:entity",oLandEntity);
				
				var oActionBar;
				var oActionBar1;
				var systems = oViewer.getSystems();
				
				for(var i = 0; i<systems.length;i++ ) {
				
				var oDataContainer = new sap.landvisz.internal.DataContainer({ header : "{@name}",selected : true });
				var oRowField = new sap.landvisz.internal.LinearRowField({ label:"{@label}",value:"{@value}",iconType:"{@type}",linkSource:"{@ps_id}",iconTitle:"{@type}",iconTitle:"{@left_tooltip}", tooltip:"{@tooltip}"});
				oDataContainer.bindAggregation("properties","lsp:entity",oRowField);
				systems[i].bindAggregation("dataContainers","lsp:tabs/lsp:entity",oDataContainer);
				oActionBar =  new sap.landvisz.internal.ActionBar({actionLabel: "Update Options"});
				systems[i].addAggregation("actionBar",oActionBar,false);
				
				oActionBar1 =  new sap.landvisz.internal.ActionBar({actionLabel: "Dependency"});
				oActionBar1.setActionType(sap.landvisz.ActionType.MENU);
				oActionBar1.setMenuData(subActions);
				
				
            oActionBar1.attachSelect(function(oControlEvent) {
            	oControlEvent.oSource.setRenderingSize(sap.landvisz.EntityCSSSize.Large);
					oControlEvent.oSource.setActionTitle("Called");
				});
				systems[i].addAggregation("actionBar",oActionBar1,false);
				
				}
				
				
				var oConnectionEntity = new sap.landvisz.ConnectionEntity({
					
				 connectionId:"{@id}",
				 type : {
						path : "@type",
						formatter : function(fValue) {
							if (fValue == "ps") {
								return sap.landvisz.ConnectionType.ProductSystem;
							} else if (fValue == "ts")
								return sap.landvisz.ConnectionType.TechnicalSystem;
							else if (fValue == "component")
								return sap.landvisz.ConnectionType.MobileSolution;
							else if (fValue == "systems")
								return sap.landvisz.ConnectionType.MobileSolution;
							else if (fValue == "MOB")
								return sap.landvisz.ConnectionType.MobileSolution;
							return "";
						}
					},
					linkId:"{@id}",id : "connection",
				});
				oViewer.bindAggregation("connectionEntities","/lsp:relation/lsp:relationentity",oConnectionEntity);
				
				
				var connectionEntities = oViewer.getConnectionEntities();
				for(var i = 0; i<connectionEntities.length;i++ ) {
  					
  					
  					var oRowFieldConnection = new sap.landvisz.internal.LinearRowField({ label:"{@name}",value:"{@value}",iconType:"{@type}",iconTitle:"{@left_tooltip}",tooltip:"{@tooltip}"});
  				connectionEntities[i].bindAggregation("connectionData","lsp:data/lsp:entity",oRowFieldConnection);
  					}

				var oConnector= new sap.landvisz.Connector({
					
					source:"{@from}",target:"{@to}"
					});
				oViewer.bindAggregation("connectors","/lsp:relation/lsp:entity",oConnector);
				
				oViewer.attachClose(function(oControlEvent) {
				
  					//oControlEvent.oSource.setRenderingSize(sap.landvisz.EntityCSSSize.Medium);
  					
  					alert("close event called");
  				});
                           
                           //oViewer.addAggregation("systems",oLandEntity, false);

       oViewer.placeAt("content");
		    
		  //Tests Starts
		  
		  if(oViewer.getDefaultDependencyView() == sap.landvisz.DependencyType.NETWORK_VIEW)
			  {
		  
		  
			module("InitialTestForNetworkView");
		  
			var oLandViewer = sap.ui.getCore().byId("viewer");			

			test("LandscapeViewerCreationOk", 2, function() {
				sap.ui.getCore().applyChanges(); 
				equals(false, (jQuery.sap.byId("viewer") === undefined), "Checking if the Landscape Viewer Control is created and is not undefined.");
				equals(false, (jQuery.sap.byId("viewer") === null), "Checking if the Landscape Viewer Control is created and is not null.");
				
			});	
			
			module("View Type");
			
			test("LandscapeViewerTypeOk", function() {
				sap.ui.getCore().applyChanges(); 
				equals(false, (jQuery.sap.byId("viewer") === undefined), "Checking if the Landscape Viewer Control is created and is not undefined.");
				equals(true, (oViewer.getViewType() === sap.landvisz.ViewType.DEPENDENCY_VIEW), "Dependency View exists");
				equals(false, (oViewer.getViewType() == sap.landvisz.ViewType.SELECTION_VIEW), "Selection View does not exist");
								
			});
			
			module("ToolBar Test");
			test("ToolBarCreationOk", function() {
				var oDomRef = jQuery.sap.domById("viewer-viewHeaderContainer");
	    		ok(oDomRef, "toolbar exists in the page");
			});
			
			module("Title Test");
			test("ToolBarTitleCreationOk", function() {
				var oDomRef = jQuery.sap.domById("viewer-viewTitle");
	    		ok(oDomRef, "Title exists");
			});
			
			module("Dependency Button Test");
			test("DependencyButtonCreationOk", function() {
			
	    		var oDomRef = jQuery.sap.domById("viewer-viewLables");
	    		ok(oDomRef, "Network View and Box View Labels exist in the page");
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-viewNetworkBtn");
	    		ok(oDomRef, "Network View button exists");
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-netwrokViewLable");
	    		ok(oDomRef, "Network View Label exists");
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-viewNetworkBtn-icon");
	    		ok(oDomRef, "Network View button image exists");	
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-viewBoxBtn");
	    		ok(oDomRef, "Box View button exists");
    		
	    		var oDomRef = jQuery.sap.domById("viewer-boxViewLable");
	    		ok(oDomRef, "Box View Label exists");
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-viewBoxBtn-icon");
	    		ok(oDomRef, "Box View button image exists");
	    		
			});
			
			module("Close Button Test");
			test("CloseButtonCreationOk", function() {
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-closeBtn");
	    		ok(oDomRef, "Close Button exists");	
			});
				
			
			  }
		  else if(oViewer.getDefaultDependencyView() == sap.landvisz.DependencyType.BOX_VIEW)
			  {
			  module("InitialTestForBoxView");
			  
				var oLandViewer = sap.ui.getCore().byId("viewer");			

				test("LandscapeViewerCreationOk", 2, function() {
					sap.ui.getCore().applyChanges(); 
					equals(false, (jQuery.sap.byId("viewer") === undefined), "Checking if the Landscape Viewer Control is created and is not undefined.");
					equals(false, (jQuery.sap.byId("viewer") === null), "Checking if the Landscape Viewer Control is created and is not null.");
					
				});	
				
				module("View Type");
				
				test("LandscapeViewerTypeOk", function() {
					sap.ui.getCore().applyChanges(); 
					equals(false, (jQuery.sap.byId("viewer") === undefined), "Checking if the Landscape Viewer Control is created and is not undefined.");
					equals(true, (oViewer.getViewType() === sap.landvisz.ViewType.DEPENDENCY_VIEW), "Dependency View exists");
					equals(false, (oViewer.getViewType() == sap.landvisz.ViewType.SELECTION_VIEW), "Selection View does not exist");
									
				});
				
				module("ToolBar Test");
				test("ToolBarCreationOk", function() {
					var oDomRef = jQuery.sap.domById("viewer-viewHeaderContainer");
		    		ok(oDomRef, "toolbar exists in the page");
				});
				
				module("Title Test");
				test("ToolBarTitleCreationOk", function() {
					var oDomRef = jQuery.sap.domById("viewer-viewHeaderContainer");
		    		ok(oDomRef, "Title exists");
				});
				
				module("Dependency Button Test");
				test("DependencyButtonCreationOk", function() {
				
		    		var oDomRef = jQuery.sap.domById("viewer-viewLables");
		    		ok(oDomRef, "Network View and Box View Labels exist in the page");
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-viewNetworkBtn");
		    		ok(oDomRef, "Network View button exists");
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-netwrokViewLable");
		    		ok(oDomRef, "Network View Label exists");
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-viewNetworkBtn-icon");
		    		ok(oDomRef, "Network View button image exists");	
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-viewBoxBtn");
		    		ok(oDomRef, "Box View button exists");
	    		
		    		var oDomRef = jQuery.sap.domById("viewer-boxViewLable");
		    		ok(oDomRef, "Box View Label exists");
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-viewBoxBtn-icon");
		    		ok(oDomRef, "Box View button image exists");
		    		
				});
				
				module("Close Button Test");
				test("CloseButtonCreationOk", function() {
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-closeBtn");
		    		ok(oDomRef, "Close Button exists");	
				});
				
				module("Box View Container Test");
				test("BoxViewContainerCreationOk", function() {
		    		
		    		var oDomRef = jQuery.sap.domById("viewer-viewContainer");
		    		ok(oDomRef, "Box View Container exists");	
				});
				
				module("ConnectionEntityTest");
				test("ConnectionEntityCreationOk", function() {
					    		
				var oDomRef = jQuery.sap.domById("connection-viewer-0connectionRow");
	    		ok(oDomRef, "Connection Entity 1 exists");
	    		
	    		var oDomRef = jQuery.sap.domById("connection-viewer-0connectionRow");
	    		ok(oDomRef, "Connection Entity 2 exists");
				});
				
				    		
				module("BoxViewLabelsTest");
				test("BoxViewLabelsCreationOk", function() {
					    		
				var oDomRef = jQuery.sap.domById("viewer-boxViewLabel0");
	    		ok(oDomRef, "Level 1 label exists");
	    		
	    		var oDomRef = jQuery.sap.domById("viewer-boxViewLabel1");
	    		ok(oDomRef, "Level 2 label exists");
				});
				
				module("SystemsTest");
				test("SystemsCreationOk", function() {
					    		
				var oDomRef = jQuery.sap.domById("aminId-viewer-0");
	    		ok(oDomRef, "Shared system exists");
	    		
	    		var oDomRef = jQuery.sap.domById("aminId-viewer-1");
	    		ok(oDomRef, "System 2 exists");
	    		
// 	    		var oDomRef = jQuery.sap.domById("aminId-viewer-2");
// 	    		ok(oDomRef, "System 3 exists");
				});
				
								  
			  
			  }
			
			
			
			
			
		    
</script>

</head>
 <body class="sapUiBody">
        
       	<h1 id="qunit-header" style = "margin-top: 900px">QUnit Page for CLV UI5 Control</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">test markup, will be hidden</div>
		
		<div id="content" style="height: 786px">
		
       </div>
       </body>
</html>