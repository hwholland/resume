<!DOCTYPE HTML>

<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<script id="sap-ui-bootstrap" 
		type="text/javascript"
		src="../../../../../resources/sap-ui-core.js"
		data-sap-ui-theme="sap_bluecrystal"
		data-sap-ui-language="en-US"
		data-sap-ui-noConflict="true"
		data-sap-ui-libs="sap.ui.commons,sap.uiext.inbox">
	</script>
		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
	
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script>
			// redirect any resource loading for "sap.uiext.inbox.qunit.mockServer" to the local folder "mockServer/" 
			jQuery.sap.registerModulePath("sap.uiext.inbox.qunit.mockServer", "mockServer/");
			
			// now load and activate the mock server
			jQuery.sap.require("sap.uiext.inbox.qunit.mockServer.InboxMockServerQUnit");

			module("Load");

			test("InboxCreationOk",function() {
				sap.ui.getCore().applyChanges(); 
				var oInbox = sap.ui.getCore().byId("inbox");
				equals(false, (oInbox === undefined), "Checking if the Inbox Control is created and is not undefined.");
				equals(false, (oInbox === null), "Checking if the Inbox Control is created and is not null.");
			
			 
			});
			
			asyncTest("SwitchToStreamView", function() {
				qutils.triggerMouseEvent("inbox--rrViewSelectionButton", "click");
				sap.ui.getCore().applyChanges(); 
				ok(jQuery.sap.byId("inbox--tasksRowRepeater").get(0), "RowRepeater displayed in Stream View");
				ok(jQuery.sap.byId("inbox--tasksRowRepeater").find(".sapUiRrRow"), "Rows displayed in RowRepeater displayed in Stream View");
				var delayedCall = function() {
					sap.ui.getCore().applyChanges(); 
					equal(jQuery.sap.byId("inbox--tasksRowRepeater").find(".sapUiRrRow").size(),"5", "5 Rows displayed in RowRepeater displayed in Stream View");
					start();
				};
				setTimeout(delayedCall, 500); 
			});
			
			module("Check Expand Task Description Link visibility ");
			
			asyncTest("Checking if the Show More Link is  visible if the task has HTML task description", function() {
				
				var oShowMoreTaskDescriptionControl = sap.ui.getCore().byId("__view7-inbox--tasksRowRepeater-0");
				var oShowMoreLink = oShowMoreTaskDescriptionControl.getAggregation("taskDescriptionLink");
				var _oBundle = sap.ui.getCore().getLibraryResourceBundle("sap.uiext.inbox");
					
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					if (oShowMoreLink) {
						equals(true, oShowMoreLink.getVisible(), "Check if Link to expand Task Description for the task is visible");
						equal(oShowMoreLink.getTooltip(), _oBundle.getText("INBOX_SHOW_MORE_LINK_TOOLTIP"), "Checking If the Tooltip for link is correct");
						
					}
					start();
				};
				setTimeout(delayedCall, 0); 
			});
			
		module("On Click of Show More Link ")
		
		asyncTest("Check if complete Task Descritpion for the task is displayed", function() {
			    var _oBundle = sap.ui.getCore().getLibraryResourceBundle("sap.uiext.inbox");
			   
			    var oShowMoreTaskDescriptnControl = sap.ui.getCore().byId("__view7-inbox--tasksRowRepeater-0");
			    var oShowMoreLink = oShowMoreTaskDescriptnControl.getAggregation("taskDescriptionLink");
			    var oTaskDescriptionContent = oShowMoreTaskDescriptnControl.getAggregation("fTV");
				
				
				equals(1,oTaskDescriptionContent.getMaxLines(),  "Check if only 1 line of description is displayed");
				equals(oShowMoreLink.getTooltip(), _oBundle.getText("INBOX_SHOW_MORE_LINK_TOOLTIP"), "Check Tooltip of Show More Task Description Link");
				equals(oShowMoreLink.getText(), _oBundle.getText("INBOX_SHOW_MORE_TEXT"), "Check Tooltip of Show More Task Description Link");
				
				qutils.triggerMouseEvent(oShowMoreLink.getId(), "click");
				sap.ui.getCore().applyChanges();
				equals(true, oShowMoreLink.getEnabled(), "Checking if the Show More Task Description link is clicked");
				
				
				var delayedCall = function() {
				
				var oTaskDescriptionContent = oShowMoreTaskDescriptnControl.getAggregation("fTV");
				var oShowLessLink = oShowMoreTaskDescriptnControl.getAggregation("taskDescriptionLink");
				
				
				equals("<h2>Purchase Order for the following items</h2><ul><li>Purchase 20 laptops</li><li>Purchase 50 desk phones</li></ul>",oTaskDescriptionContent.getHtmlText(), "Checking if correct Html text is rendered");
				equals(true, oShowLessLink.getVisible(), "Show less Task Description Button should be visible");
				equals(oShowLessLink.getTooltip(), _oBundle.getText("INBOX_SHOW_LESS_LINK_TOOLTIP"), "Check Tooltip of Show less Task Description Link");
				equals(oShowLessLink.getText(), _oBundle.getText("INBOX_SHOW_LESS_TEXT"), "Check Text of Show less Task Description Link");
				
				start();
				};
				setTimeout(delayedCall, 0); 
			});
		
		module("On click of the Show Less Task Description Link")
		
		asyncTest("Hide the Formatted HTML Task Description for a task", function() {
			    var oShowMoreTaskDescriptnControl = sap.ui.getCore().byId("__view7-inbox--tasksRowRepeater-0");
			    var oShowLessLink = oShowMoreTaskDescriptnControl.getAggregation("taskDescriptionLink");
			    var oTaskDescriptionContent =  oShowMoreTaskDescriptnControl.getAggregation("fTV");
				qutils.triggerMouseEvent(oShowLessLink.getId(), "click");
				sap.ui.getCore().applyChanges();
				var delayedCall = function() {
				var formattedTaskDescriptionDiv = jQuery.sap.byId('inbox--FormattedTaskDescription-0');
				
				equals(true, oShowLessLink.getVisible(), "Show More Task Description Link should not be visible");
				equals(oTaskDescriptionContent.getHtmlText(), "Purchase Order for the following itemsPurchase 20 laptopsPurchase 50 desk phones", "Check if correct task description is rendered");
				
				start();
				};
				setTimeout(delayedCall, 0); 
			});
		
		QUnit.done(function() {
			qutils.triggerMouseEvent("inbox" + "--tableViewSelectionButton", "click");
		});
			
			</script>
	</head>
	<body>
		<h1 id="qunit-header"><title>Qunit for testing rendering of Task Description as HTML </title></h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">test markup, will be hidden</div>
		<div id="canvas" style="height:300px; width:300px"></div>
		<br>
		<div id="uiArea1" style="width: 80%;"></div>
	</body>
</html>
