<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="UTF-8">

<title>Testpage - sap.ui.vk.Viewer</title>

<base href="../../../../">

<style>
.sapVizKitViewer {
	width: 100% !important;
}
</style>
<!--[if lte IE 9]><script type="text/javascript">
		(function() {
		var baseTag = document.getElementsByTagName('base')[0];
		baseTag.href = baseTag.href;
		})();
		</script><![endif]-->

<script id="sap-ui-bootstrap"
	data-sap-ui-libs="sap.ui.vk, sap.m, sap.ui.unified, sap.ui.layout"
	data-sap-ui-theme="sap_bluecrystal" src="resources/sap-ui-core.js">

</script>

<script>
	function isDesktop() {
		return sap.ui.Device.os.windows || sap.ui.Device.os.macintosh || sap.ui.Device.os.linux;
	}

	var viewer = new sap.ui.vk.Viewer({
		enableOverlay: true,
		overlay: new sap.ui.vk.Overlay({
			//	 			click: onClick,
			//	 			contextMenu: onContextMenu,
			areas: {
				path: "/Areas",
				template: new sap.ui.vk.OverlayArea({
					position: '{pos}',
					tooltip: '{tooltip}',
					changeable: '{edit}'
				})
			}
		})
	});
	// 			return viewer;
	viewer.setWidth("1000px");
	viewer.setHeight("600px");

	var sourceData = {
		localFile: undefined,
		remoteUrl: "test-resources/sap/ui/vk/media/pumps.jpg"
	};
	var model = new sap.ui.model.json.JSONModel();
	model.setData(sourceData);
	sap.ui.getCore().setModel(model, "source");

	var layout = new sap.ui.layout.form.GridLayout({
		singleColumn: true
	});
	var container1 = sap.ui.layout.form.FormElement({
		fields: [
			new sap.m.Input({
				layoutData: new sap.ui.layout.form.GridElementData({
					hCells: "auto"
				}),
				placeholder: "Remote model URL",
				value: "{source>/remoteUrl}"
			}), new sap.m.Button({
				layoutData: new sap.ui.layout.form.GridElementData({
					hCells: "1"
				}),
				text: "Load Image",
				press: function(event) {
					if (sourceData.remoteUrl) {
						viewer.destroyContentResources();
						var contentResource = new sap.ui.vk.ContentResource({
							source: sourceData.remoteUrl,
							sourceType: "jpg",
							sourceId: "abc"
						});
						viewer.addContentResource(contentResource);

					}
				}
			}), new sap.m.ToggleButton({
				layoutData: new sap.ui.layout.form.GridElementData({
					hCells: "1"
				}),
				pressed: viewer.getEnableOverlay(),
				text: "Toggle Overlay",
				press: function(event) {
					viewer.setEnableOverlay(event.getSource().getPressed());
				}
			})
		]
	});

	var container2 = new sap.ui.layout.form.FormElement({
		fields: [
			new sap.ui.unified.FileUploader({
				layoutData: new sap.ui.layout.form.GridElementData({
					hCells: "auto"
				}),
				width: "100%",
				placeholder: "Local filename",
				fileType: [
					"vds", "png", "jpg", "jpeg", "gif"
				],
				change: function(event) {
					sourceData.localFile = event.getParameter("files")[0];

					if (sourceData.localFile) {
						viewer.destroyContentResources();

						var filename = sourceData.localFile.name;
						var index = filename.lastIndexOf(".");
						var sourceType;
						if (index >= 0 && index < filename.length - 1) {
							sourceType = filename.substr(index + 1);
						}

						var contentResource = new sap.ui.vk.ContentResource({
							source: sourceData.localFile,
							sourceType: sourceType,
							sourceId: "abc"
						});

						viewer.addContentResource(contentResource);
					}
				}
			})
		]
	});

	var oData = {
		Areas: [
			{
				"key": "1",
				"pos": "0.4;0.6;0;0.6;0.6;0;0.6;0.4;0;0.4;0.4;0",
				"tooltip": "Area 1",
				"edit": true
			}
		]
	};

	// create model and set the data
	var oModel = new sap.ui.model.json.JSONModel();
	oModel.setData(oData);
	sap.ui.getCore().setModel(oModel);

	// create control and bind to model

	var page = new sap.m.Page({
		title: "Sample viewer",
		content: [
			viewer, new sap.ui.layout.form.Form({
				editable: true,
				layout: layout,
				formContainers: new sap.ui.layout.form.FormContainer({
					formElements: sap.ui.Device.browser.mobile ? [
						container1
					] : [
						container1, container2
					]
				})
			})
		]
	});

	var app = new sap.m.App();
	app.addPage(page);
	app.placeAt("body");
</script>
</head>
<body id="body" class="sapUiBody">
</body>
</html>
