<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>qUnit Page for sap.ui.comp.smartform.Group</title>

<script id="sap-ui-bootstrap" type="text/javascript"
	src="../../../../../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.ui.comp">
	
</script>

<link rel="stylesheet"
	href="../../../../../resources/sap/ui/thirdparty/qunit.css"
	type="text/css" media="screen" />
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

<script type="text/javascript">
	/*globals QUnit, sinon*/

	if (!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
	}

	(function(QUnit, sinon) {

		jQuery.sap.require("sap.ui.comp.smartform.Group");
		jQuery.sap.require("sap.ui.comp.smartform.GroupElement");
		jQuery.sap.require("sap.ui.comp.smartform.SmartForm");
		jQuery.sap.require("sap.ui.core.CustomData");

		QUnit.module("sap.ui.comp.smartform.Group", {
			beforeEach: function(assert) {
				this.oGroup = new sap.ui.comp.smartform.Group();
			},
			afterEach: function(assert) {
			}
		});

		QUnit.test("Shall be instantiable", function(assert) {
			assert.ok(this.oGroup);
		});

		QUnit.test("method addGroupElement", function(assert) {
			sinon.spy(this.oGroup, "addAggregation");
			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);
			assert.ok(this.oGroup.addAggregation.called);
		});

		QUnit.test("method getGroupElements", function(assert) {
			sinon.spy(this.oGroup, "getFormElements");

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);

			var aElements = this.oGroup.getGroupElements();
			assert.ok(aElements);
			assert.equal(aElements.length, 1);

			assert.ok(this.oGroup.getFormElements.called);
		});

		QUnit.test("method setUseHorizontalLayout", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);

			this.oGroup.setUseHorizontalLayout(true);
			assert.ok(oGroupElement.getUseHorizontalLayout());

			this.oGroup.setUseHorizontalLayout(false);
			assert.ok(!oGroupElement.getUseHorizontalLayout());
		});

		QUnit.test("method setHorizontalLayoutGroupElementMinWidth", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);

			this.oGroup.setHorizontalLayoutGroupElementMinWidth(123);
			assert.equal(oGroupElement.getHorizontalLayoutGroupElementMinWidth(), 123);
		});

		QUnit.test("method setEditMode", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			sinon.spy(oGroupElement, "setEditMode");

			this.oGroup.addGroupElement(oGroupElement);

			this.oGroup.setEditMode(true);

			assert.ok(oGroupElement.setEditMode.called);

		});

		QUnit.test("method addCustomData", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);

			var oCustomdata = new sap.ui.core.CustomData({
				key: "KEY",
				value: "VALUE"
			});
			this.oGroup.addCustomData(oCustomdata);

			var aCustomdata = oGroupElement.getCustomData();
			assert.ok(aCustomdata);
			assert.equal(aCustomdata.length, 1);
			assert.equal(aCustomdata[0].key, oCustomdata.key);
			assert.equal(aCustomdata[0].value, oCustomdata.value);

		});

		QUnit.test("method removeGroupElement as GroupElement", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);
			var aGroupElements = this.oGroup.getGroupElements();
			assert.ok(aGroupElements);
			assert.equal(aGroupElements.length, 1);

			this.oGroup.removeGroupElement(oGroupElement);
			aGroupElements = this.oGroup.getGroupElements();
			assert.ok(aGroupElements);
			assert.equal(aGroupElements.length, 0);
		});

		QUnit.test("method removeGroupElement as string", function(assert) {

			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			this.oGroup.addGroupElement(oGroupElement);
			var aGroupElements = this.oGroup.getGroupElements();
			assert.ok(aGroupElements);
			assert.equal(aGroupElements.length, 1);

			this.oGroup.removeGroupElement(oGroupElement.getId());
			aGroupElements = this.oGroup.getGroupElements();
			assert.ok(aGroupElements);
			assert.equal(aGroupElements.length, 0);
		});

		QUnit.test("method removeAllGroupElements", function(assert) {
			sinon.spy(this.oGroup, "removeAllFormElements");

			this.oGroup.removeAllGroupElements()

			assert.ok(this.oGroup.removeAllFormElements.called);

		});

		QUnit.test("method destroyGroupElements", function(assert) {
			sinon.spy(this.oGroup, "destroyFormElements");

			this.oGroup.destroyGroupElements()

			assert.ok(this.oGroup.destroyFormElements.called);

		});

		QUnit.test("method _updateLineBreaks", function(assert) {

			sinon.stub(sap.ui.comp.smartform.SmartForm.prototype, "getDomRef").returns({
				clientWidth: 1200
			});

			var oSmartForm = new sap.ui.comp.smartform.SmartForm({
				useHorizontalLayout: true,
				layout: new sap.ui.comp.smartform.Layout({
					gridDataSpan: "L2M3S4"
				}),
				groups: [
					this.oGroup
				]
			});
			sinon.stub(sap.ui.layout.form.Form.prototype, "getParent").returns(oSmartForm);
			oSmartForm._oForm.setLayout(new sap.ui.layout.form.ResponsiveGridLayout());

			var oSmartField = new sap.ui.comp.smartfield.SmartField();
			var oSmartField2 = new sap.ui.comp.smartfield.SmartField();

			for (var i = 0; i < 6; i++) {
				this.oGroup.addGroupElement(new sap.ui.comp.smartform.GroupElement({
					elements: [
						new sap.ui.comp.smartfield.SmartField()
					]
				}));
			}

			this.oGroup.addGroupElement(new sap.ui.comp.smartform.GroupElement({
				elements: [
					oSmartField
				]
			}));
			this.oGroup.addGroupElement(new sap.ui.comp.smartform.GroupElement({
				elements: [
					oSmartField2
				]
			}));

			oSmartForm._propagateGridDataSpan();
			oSmartField.setVisible(false);

			assert.equal(oSmartField2.getParent().getLayoutData().getLinebreak(), true, "Linebreak set to 7th visible field");

		});

		QUnit.test("Hide group when all group elements hidden", function(assert) {
			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			var oGroupElement2 = new sap.ui.comp.smartform.GroupElement();

			this.oGroup.addGroupElement(oGroupElement);
			this.oGroup.addGroupElement(oGroupElement2);

			oGroupElement.setVisible(false);
			assert.equal(this.oGroup.getVisible(), true, "still visible")
			oGroupElement2.setProperty("visible", false);
			assert.equal(this.oGroup.getVisible(), true, "hidden")
		});

		QUnit.test("check that additional added GroupElements get edit mode inherited from Group", function(assert) {
			var oGroupElement = new sap.ui.comp.smartform.GroupElement();
			sinon.stub(oGroupElement, "setEditMode");

			//CUT -> group without a parent 
			this.oGroup.addGroupElement(oGroupElement);
			assert.equal(oGroupElement.setEditMode.called, false, "Current group does not have a parent and shall not delegate anything");

			//CUT -> group without a parent 
			var oSmartForm = new sap.ui.comp.smartform.SmartForm("SmartForm");
			var oGroup = new sap.ui.comp.smartform.Group();
			oSmartForm.addGroup(oGroup);

			oGroup.addGroupElement(oGroupElement);
			assert.equal(oGroupElement.setEditMode.called, true, "For newly added group element the edit mode shall be inherited from Parent");
		});

	}(QUnit, sinon));
</script>
</head>

<body id="body" class="sapUiBody">
	<h1 id="qunit-header">qUnit Page for sap.ui.comp.smartform.Group</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>

	<div id="content"></div>
</body>
</html>
