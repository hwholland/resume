<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>qUnit Page for sap.ui.comp.smartfield.SmartLabel</title>

		<script id="sap-ui-bootstrap" 
			type="text/javascript"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.ui.comp">
		</script>

		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css"	type="text/css" media="screen" />
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

		<script type="text/javascript">
			
		/*globals QUnit, sinon*/

		if(!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
    		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
		}	

		jQuery.sap.require("sap.ui.comp.smartfield.SmartLabel");
		jQuery.sap.require("sap.ui.comp.smartfield.SmartField");
		
		(function(QUnit, sinon) {
			'use strict';
		
			var oProperty = {
			                 "property": {
			                	    "sap:label": "Document Number",
			                	    "sap:quickinfo": "Accounting Document Number",
			                 }
			};
			
			var oProperty2 = {
			                 "property": {
			                	    "sap:label": "Document Number"
			                 }
			};		
			
			QUnit.module("sap.ui.comp.smartfield.SmartLabel", {
				beforeEach: function() {
					this.oSmartLabel = new sap.ui.comp.smartfield.SmartLabel();					
	
				},
				afterEach: function() {
					this.oSmartLabel.destroy();
				}
			});

			QUnit.test("Shall be instantiable", function(assert) {
				assert.ok(this.oSmartLabel);
			});

			QUnit.test("createSmartLabelControl", function(assert) {

				var oField = {
					  getVisible : function() { return true; },    
					  getMandatory: function() { return true; },
					  getTextLabel: function() { return null; },
				      getTooltipLabel: function() { return null; },
				      getDataProperty: function() { return oProperty; },
				      getBindingInfo: function() { return null; },
				      getEditable: function() { return true; },
				      getContextEditable: function() { return true; },
				      getId: function() { return "me"; }
				};
				sinon.stub(this.oSmartLabel, "_getField").returns(oField);
				
				this.oSmartLabel.setLabelFor(oField);
								
				assert.equal(this.oSmartLabel.getText(), "Document Number");
				assert.equal(this.oSmartLabel.getTooltip(), "Accounting Document Number");						
			});			
			

			QUnit.test("bind SmartLabel required property against SmartField mandatory", function(assert) {	
				assert.ok(this.oSmartLabel.bindRequiredPropertyToSmartField, "Method bindRequiredPropertyToSmartField does not exist");
				
				var oBindingInfo = { parts: [{"path":"BindingInfoTestpath","mode":"OneWay"}] };

				var oField = {
				      getVisible : function() { return true; },    
				      getMandatory: sinon.stub().returns(true),				      
				      getTextLabel: function() { return null; },
				      getTooltipLabel: function() { return null; },
				      getDataProperty: function() { return oProperty2; },
				      getBindingInfo: function() { return oBindingInfo },
				      getEditable: sinon.stub().returns(true),
				      getContextEditable: function() { return true; },
				      getId: function() { return "me"; }				      
				};
				sinon.stub(this.oSmartLabel, "_getField").returns(oField);
				
				sinon.stub(this.oSmartLabel, "bindProperty");
				
				this.oSmartLabel.bindRequiredPropertyToSmartField();				
								
				assert.equal(this.oSmartLabel.bindProperty.calledWith("required", oBindingInfo), true, "SmartLabel was not bound against SmartField Mandatory property");
			});

			
			QUnit.test("set SmartLabel required property from SmartField mandatory", function(assert) {	
				
				var oField = {
				      getVisible : function() { return true; },    
				      getMandatory: sinon.stub().returns(true),				      
				      getTextLabel: function() { return null; },
				      getTooltipLabel: function() { return null; },
				      getDataProperty: function() { return oProperty2; },
				      getBindingInfo: function() { return null },
				      getEditable: sinon.stub().returns(true),
				      getContextEditable: function() { return true; },
				      getId: function() { return "me"; }						      
				};

				sinon.stub(this.oSmartLabel, "_getField").returns(oField);
				
				sinon.stub(this.oSmartLabel, "setRequired");
				
				this.oSmartLabel.bindRequiredPropertyToSmartField();				
								
				assert.equal(this.oSmartLabel.setRequired.calledWith(true), true, "Setter for required property was not called");
			});
			
			QUnit.test("Unbind/Remove required property from SmartLabel", function(assert) {	
				
				this.oSmartLabel._oSmartField = null;					
				sinon.stub(this.oSmartLabel, "unbindProperty");
				sinon.stub(this.oSmartLabel, "setRequired");
				
				this.oSmartLabel.bindRequiredPropertyToSmartField();				
								
				assert.equal(this.oSmartLabel.unbindProperty.called, true, "Getter for Mandatory property was not called at SmartField");
				assert.equal(this.oSmartLabel.setRequired.called, true, "Setter for required property was not called");
			});
			
			QUnit.test("getSmartLabel with binding", function(assert) {
				
				
				var oSmartField = new sap.ui.comp.smartfield.SmartField(
				              { textLabel: "{/textLabel}", 
				                tooltipLabel : "{/tooltipLabel}"
				});
				
				oSmartField.setMandatory(true);
				
				jQuery.sap.require("sap.ui.model.json.JSONModel");
				var oModel = new sap.ui.model.json.JSONModel({
					textLabel: "A",
					tooltipLabel: "B"
				});
				oModel.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);
				oSmartField.setModel(oModel);
							
			
				this.oSmartLabel.setLabelFor(oSmartField);
				this.oSmartLabel.setModel(oModel);
				
				assert.ok(this.oSmartLabel.setRequired());
						
				oSmartField.fireInitialise();
				
				oModel.getData().textLabel = "LABEL";
				oModel.getData().tooltipLabel = "TOOLTIP";
				oModel.updateBindings(true);				
				
				assert.equal(oSmartField.getTextLabel(), "LABEL");
				assert.equal(oSmartField.getTooltipLabel(), "TOOLTIP");
					
				assert.equal(this.oSmartLabel.getText(), oSmartField.getTextLabel());
				assert.equal(this.oSmartLabel.getTooltip(), oSmartField.getTooltipLabel()); 		
				
				this.oSmartLabel.setText("TEST");

			});				
			
			QUnit.test("method setLabelFor as object", function(assert) {
				
				var oSmartField = new sap.ui.comp.smartfield.SmartField();
				
				sinon.stub(this.oSmartLabel, "_setLabelFor");
							
				this.oSmartLabel.setLabelFor(oSmartField);
				assert.ok(this.oSmartLabel._sSmartFieldId === oSmartField.getId());	
				assert.ok(this.oSmartLabel._setLabelFor.called);
			});			
			
			QUnit.test("method setLabelFor as string", function(assert) {
							
				sinon.stub(this.oSmartLabel, "_setLabelFor");
				
				this.oSmartLabel.setLabelFor("SOME ID");
				assert.ok(this.oSmartLabel._sSmartFieldId);
				assert.ok(this.oSmartLabel._setLabelFor.called);			
			});			
			
			QUnit.test("method onBeforeRendering", function(assert) {
				
				var oSmartField = new sap.ui.comp.smartfield.SmartField();
				
				sinon.stub(this.oSmartLabel, "_setLabelFor");
				
				this.oSmartLabel._sSmartFieldId = oSmartField.getId();
				
					
				this.oSmartLabel.onBeforeRendering();
											
				assert.ok(this.oSmartLabel._getField() === oSmartField);
				assert.ok(this.oSmartLabel._setLabelFor.called);			
			});			
			
			QUnit.test("method updateLabelFor", function(assert) {
				
				jQuery.sap.require("sap.m.Input");
				var oField0 = new sap.m.Input();
				var oField1 = new sap.m.Input();
				var oField2 = new sap.m.Input();
				
				var aControls = [oField0, oField1, oField2];
				
				this.oSmartLabel.updateLabelFor(aControls);
				
				assert.equal(this.oSmartLabel.getLabelFor(), oField0.getId());
			});
			
		}(QUnit, sinon));
		
		</script>
	</head>
	<body id="body" class="sapUiBody">
		<h1 id="qunit-header">qUnit Page for sap.ui.comp.smartfield.SmartLabel</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
	</body>
</html>
