<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>sap.ui.comp.variants.VariantManagement</title>
		<script src="../../../../../resources/sap-ui-core.js"
			type="text/javascript" 
			id="sap-ui-bootstrap"
			data-sap-ui-libs="sap.m,sap.ui.layout,sap.ui.comp"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-compatVersion="1.20">
		</script>
		<script>
			jQuery.sap.require("sap.ui.comp.transport.TransportSelection");

			//global noshow flag
			var _noShow = true;
			// create and add app
			var app = new sap.m.App("myApp", {initialPage:"variantPage"});
			app.placeAt("body");
			
			var fOriginalGetTransport = sap.ui.comp.transport.TransportSelection.prototype.selectTransport;
			var fMockGetTransport = function(o,s,e,b) {
				var oEvent = {
					mParameters: {
						selectedPackage: "/UIF/LREP_HOME_CONTENT",
						selectedTransport: "U31K000001"
					},
					getParameters: function() { return this.mParameters; }
				}
				s(oEvent);
			};
			var bBackendEnabled = false;
			sap.ui.comp.transport.TransportSelection.prototype.selectTransport = fMockGetTransport;
			// variantManangement Data
			var variantData = {
				variant : [ 
				{				
					text : "Accounts by Name",
					key: "ABN",
					exe: false,
					readOnly: true,
					global: true,
					trans: "",
					pack: "/SAP/WHATEVER",
					namespace: "com.sap.lrep",
					accessOptions: "R",
					labelReadOnly: true
				}, {
					text : "My Accounts last Week",
					key: "MALW",
					exe: true,
					readOnly: false,
					global: false,
					trans: "",
					pack: "$TMP",
					namespace: "com.sap.lrep",
					accessOptions: "RWD",
					labelReadOnly: false
				}, {
					text : "Line Items by Contact",
					key: "005056AB1D001ED49686ADC6098EE24E",
					exe: false,
					readOnly: false,
					global: true,
					trans: "",
					pack: "/UIF/LREP_HOME_CONTENT",
					namespace: "com.sap.lrep",
					accessOptions: "RWD",
					labelReadOnly: false
				}, {
					text : "Line Items by Rep",
					key: "LIBR",
					exe: false,
					readOnly: false,
					global: true,
					trans: "",
					pack: "$TMP",
					namespace: "com.sap.lrep",
					accessOptions: "RWD",
					labelReadOnly: false
				}, {
					text : "Line Items by Res",
					key: "LIBRS",
					exe: false,
					readOnly: false,
					global: true,
					trans: "",
					pack2: "/UIF/LREP_HOME_CONTENT",
					pack: "/UIF/LREP_PROVIDER",
					namespace: "com.sap.lrep",
					accessOptions: "RWD",
					labelReadOnly: false
				}, {
					text : "Line Items by Ref",
					key: "LIBRSA",
					exe: false,
					readOnly: false,
					global: true,
					trans: "",
					pack: "/UIF/LREP_HOME_CONTENT",
					namespace: "com.sap.lrep",
					accessOptions: "RD",
					labelReadOnly: true
				}, {
					text : "My Variant",
					key: "MV",
					exe: true,
					readOnly: false,
					global: false,
					trans: "",
					pack: "$TMP",
					namespace: "com.sap.lrep",
					accessOptions: "RWD",
					labelReadOnly: false
				}]
			};

			var itemVariantTemplate = new sap.ui.comp.variants.VariantItem({
				text : "{text}",
				key: "{key}",
				executeOnSelection: "{exe}",
				readOnly: "{readOnly}",
				global: "{global}",
				lifecycleTransportId: "{trans}",
				lifecyclePackage: "{pack}",
				namespace: "{namespace}",
				accessOptions: "{accessOptions}",
				labelReadOnly: "{labelReadOnly}"
			});

			function bindVariantData(data, itemTemplate, variantManagement)
			{
				var oModel = new sap.ui.model.json.JSONModel();
				// set the data for the model
				oModel.setData(data);
				// set the model to the list
				variantManagement.setModel(oModel);

				// bind Aggregation
				variantManagement.bindAggregation("variantItems", "/variant", itemTemplate);
			}
			

			// variantManangement control
			//jQuery.sap.require("sap.ui.comp.variants.VariantManagement");
			var vm = new sap.ui.comp.variants.VariantManagement({ 
				save: function(event) {
					var params = event.getParameters();
					var sMessage = "New Name: " + params.name + "\n Default: " + params.def +"\n Overwrite: " + params.overwrite + "\n Selected Item Key: " + params.key + 
									"\n Execute: " + params.exe + "\n Create Tile: " + params.tile + "\n Global: " + params.global + "\n Package: " + params.lifecyclePackage + "\n Transport: " + params.lifecycleTransportId;
					sap.m.MessageToast.show(sMessage, {
					    duration: 3000,                  // default
					    width: "15em",                   // default
					    my: "center bottom",             // default
					    at: "center bottom",             // default
					    of: window,                      // default
					    offset: "0 0",                   // default
					    collision: "fit fit",            // default
					    onClose: null,                   // default
					    autoClose: true,                 // default
					    animationTimingFunction: "ease", // default
					    animationDuration: 1000,         // default
					    closeOnBrowserNavigation: true   // default
					});
				},
				manage: function(event) {
					var params = event.getParameters();
					var renamed = params.renamed;
					var deleted = params.deleted;
					var defaultKey = params.def;
					var exed = params.exe;

					var sMessage = "renamed: \n";
					for(var h = 0; h < renamed.length; h++) {
						sMessage+=renamed[h].key + "=" + renamed[h].name + "\n";
					}
					sMessage += "\n\ndeleted: ";
					for(var f = 0; f < deleted.length; f++) {
						sMessage+=deleted[f] + ",";
					}
					sMessage += "\n\nexed: ";
					for(var e = 0; e < exed.length; e++) {
						sMessage+=exed[e].key + "=" + exed[e].exe + "\n";
					}
					sMessage += "\ndefault: " + defaultKey;
					aItems = vm.getVariantItems();
					for(var ii=0; ii < aItems.length; ii++) {
						alert(aItems[ii].getKey() + ":" + aItems[ii].getLifecyclePackage() + ":" + aItems[ii].getLifecycleTransportId());
					}
					sap.m.MessageToast.show(sMessage, {
					    duration: 3000,                  // default
					    width: "15em",                   // default
					    my: "center bottom",             // default
					    at: "center bottom",             // default
					    of: window,                      // default
					    offset: "0 0",                   // default
					    collision: "fit fit",            // default
					    onClose: null,                   // default
					    autoClose: true,                 // default
					    animationTimingFunction: "ease", // default
					    animationDuration: 1000,         // default
					    closeOnBrowserNavigation: true   // default
					});
					
				},
				select: function(event) {
					var params = event.getParameters();
					var sMessage = "New Variant Selected: " + params.key;
					if(_noShow == false) {
						sap.m.MessageToast.show(sMessage, {
						    duration: 3000,                  // default
						    width: "15em",                   // default
						    my: "center top",             // default
						    at: "center top",             // default
						    of: window,                      // default
						    offset: "0 0",                   // default
						    collision: "fit fit",            // default
						    onClose: null,                   // default
						    autoClose: true,                 // default
						    animationTimingFunction: "ease", // default
						    animationDuration: 1000,         // default
						    closeOnBrowserNavigation: true   // default
						});
					}
				},
				enabled: false,
				showExecuteOnSelection: true,
				showCreateTile: true,
				showShare: true,
				lifecycleSupport: true
			});

			//vm.createDefaultVariantEntry();
			
			//init VariantManagement
			bindVariantData(variantData, itemVariantTemplate, vm);
			//vm.setInitialSelectionKey("MV");
			//vm.setInitialSelectionKey("ABN");
			vm.setDefaultVariantKey("MALW")
			vm.setEnabled(true);
			vm.setVisible(true);
			//create empty Variant Management Control
			var oEmptyVM = new sap.ui.comp.variants.VariantManagement({ 
				save: function(event) {
					var params = event.getParameters();
					var sMessage = "New Name: " + params.name + "\nDefault: " + params.def +"\nOverwrite:" + params.overwrite + "\nSelected Item Key: " + params.key;
					sap.m.MessageToast.show(sMessage, {
					    duration: 3000,                  // default
					    width: "15em",                   // default
					    my: "center bottom",             // default
					    at: "center bottom",             // default
					    of: window,                      // default
					    offset: "0 0",                   // default
					    collision: "fit fit",            // default
					    onClose: null,                   // default
					    autoClose: true,                 // default
					    animationTimingFunction: "ease", // default
					    animationDuration: 1000,         // default
					    closeOnBrowserNavigation: true   // default
					});
				},
				manage: function(event) {
					var params = event.getParameters();
					var renamed = params.renamed;
					var deleted = params.deleted;
					var defaultKey = params.defaultKey;
					var sMessage = "renamed: \n";
					for(var h = 0; h < renamed.length; h++) {
						sMessage+=renamed[h].key + "=" + renamed[h].name + "\n";
					}
					sMessage += "\n\ndeleted: ";
					for(var f = 0; f < deleted.length; f++) {
						sMessage+=deleted[f] + ",";
					}
					sMessage += "\ndefault: " + defaultKey;

					sap.m.MessageToast.show(sMessage, {
					    duration: 3000,                  // default
					    width: "15em",                   // default
					    my: "center bottom",             // default
					    at: "center bottom",             // default
					    of: window,                      // default
					    offset: "0 0",                   // default
					    collision: "fit fit",            // default
					    onClose: null,                   // default
					    autoClose: true,                 // default
					    animationTimingFunction: "ease", // default
					    animationDuration: 1000,         // default
					    closeOnBrowserNavigation: true   // default
					});
				},
				select: function(event) {
					var params = event.getParameters();
					var sMessage = "New Variant Selected: " + params.key;
					if(_noShow == false) {
						sap.m.MessageToast.show(sMessage, {
						    duration: 3000,                  // default
						    width: "15em",                   // default
						    my: "center top",             // default
						    at: "center top",             // default
						    of: window,                      // default
						    offset: "0 0",                   // default
						    collision: "fit fit",            // default
						    onClose: null,                   // default
						    autoClose: true,                 // default
						    animationTimingFunction: "ease", // default
						    animationDuration: 1000,         // default
						    closeOnBrowserNavigation: true   // default
						});
					}
				}
			});
		
			var oEmptyVM2 = new sap.ui.comp.variants.VariantManagement({				
				showExecuteOnSelection: true,
				showCreateTile: true,
				showShare: true,
				lifecycleSupport: true
			});
			oEmptyVM2._setBackwardCompatibility(false);
			// create and add a page with texts 
			var page = new sap.m.Page("variantPage", {

				showNavButton: true,
				title:"Account Line Items",
				headerContent: [
//				                vm
				],
				content : [ 
				    new sap.ui.layout.VerticalLayout({
				    	content: [
								    new sap.m.Text({
								    	text: "Lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum",
								    }),
								    new sap.m.Toolbar( {
								    	content:[
								    	         vm
								    	]
								    })
				    	          	,
				    	          	new sap.m.Text({
				    	          		text: "xxx(12rem)xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
				    	          		width: "12rem",
				    	          		wrapping: false
				    	          	}),
									new sap.m.Button(
											{
												text: "ClearVariantSelection",
												press: function(oEvent) {
													vm.clearVariantSelection();
												}
											}),
									new sap.m.Button(
											{
												text: "SetInitialSelection",
												press: function(oEvent) {
													vm.setInitialSelectionKey("ABN");
												}
											}),
									new sap.m.Button(
											{
												text: "DestroyallItemsandRepopulate",
												press: function(oEvent) {
													bindVariantData(variantData, itemVariantTemplate, vm);
												}
											}),
									new sap.m.Button(
											{
												text: "GetVariantSelection",
												press: function(oEvent) {
													var sMessage = "Variant Selection key: " + vm.getSelectionKey();
													sap.m.MessageToast.show(sMessage, {
													    duration: 3000,                  // default
													    width: "15em",                   // default
													    my: "center center",             // default
													    at: "center center",             // default
													    of: window,                      // default
													    offset: "0 0",                   // default
													    collision: "fit fit",            // default
													    onClose: null,                   // default
													    autoClose: true,                 // default
													    animationTimingFunction: "ease", // default
													    animationDuration: 1000,         // default
													    closeOnBrowserNavigation: true   // default
													});
												}
											}),
									new sap.m.Button(
											{
												text: "Toggle Visible",
												press: function(oEvent) {
													var bVisible = vm.getVisible()
													vm.setVisible(!bVisible);
												}
											}),
									new sap.m.Button(
											{
												text: "Toggle enabled",
												press: function(oEvent) {
													var bEnabled = vm.getEnabled()
													vm.setEnabled(!bEnabled);
												}
											}),
									new sap.m.Button(
											{
												text: "Set Modified",
												press: function(oEvent) {
													vm.currentVariantSetModified(true);
												}
											}),
									new sap.m.Button(
											{
												text: "Toggle Compact Mode",
												press: function(oEvent) {
													if(page.hasStyleClass("sapUiSizeCompact")) {
														page.removeStyleClass("sapUiSizeCompact");
													}
													else {
														page.addStyleClass("sapUiSizeCompact");
													}
												}
											}),
									new sap.m.Button(
											{
												text: "Enable Transport Backend",
												press: function(oEvent) {
													if(!bBackendEnabled) {
														this.setText("Enable Transport Mock");
														sap.ui.comp.transport.TransportSelection.prototype.selectTransport = fOriginalGetTransport;
													}
													else {
														this.setText("Enable Transport Backend");
														sap.ui.comp.transport.TransportSelection.prototype.selectTransport = fMockGetTransport;
													}
													bBackendEnabled = !bBackendEnabled;
												}
											}),
									new sap.m.Button(
											{
												text: "ToggleErrorState",
												press: function(oEvent) {
													if(vm.getValueState()==sap.ui.core.ValueState.Error) {
														vm.setValueState(sap.ui.core.ValueState.None);
													}
													else {
														vm.setValueState(sap.ui.core.ValueState.Error);
														vm.setValueStateText("VM not configured correctly" + new Date().toString());
													}
												}
											}),
									new sap.m.Button(
														{
															text: "Enable Manual Key Entry",
															press: function(oEvent) {
																if(vm.bManualVariantKey) {
																	vm._enableManualVariantKey(false);
																	this.setText("Enable Manual Key Entry");
																}
																else {
																	vm._enableManualVariantKey(true);
																	this.setText("Disable Manual Key Entry");
																}
															}
														}),
									new sap.m.Button(
														{
															text: "Enable Execute on Select for Standard Entry",
															press: function(oEvent) {
																if(vm.bExecuteOnSelectForStandard) {
																	vm._executeOnSelectForStandardVariant(false);
																	this.setText("Enable Execute on Select for Standard Entry");
																}
																else {
																	vm._executeOnSelectForStandardVariant(true);
																	this.setText("Disable Execute on Select for Standard Entry");
																}
															}
														}),
									new sap.m.Button(
														{
															text: "Replace text for Standard Entry",
															press: function(oEvent) {
																if(vm.getStandardItemText() == "") {
																	vm.setStandardItemText("SuperStandardVariant");
																	this.setText("SetStandard Entry Text");
																}
																else {
																	vm.setStandardItemText("");
																	this.setText("Replace text for Standard Entry");
																}
															}
														}),


									oEmptyVM,
									oEmptyVM2
						]
				    })
	            ]
			});
			page.addStyleClass("sapUiSizeCompact");

			app.addPage(page);
		
			_noShow = false;
		
		</script>
	</head>
	<body id="body" class="sapUiBody">
	</body>
</html>