<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Calendar - sap.me</title>

    <!-- UI5 Bootstrap -->
    <script id="sap-ui-bootstrap"
            type="text/javascript"
            src="../../../../resources/sap-ui-core.js"
            data-sap-ui-theme="sap_bluecrystal"
            data-sap-ui-libs="sap.m,sap.me"></script>

    <!-- QUnit libraries -->
    <link rel="stylesheet"
          href="../../../../resources/sap/ui/thirdparty/qunit.css"
          type="text/css" media="screen"/>
    <script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>

    <script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

    <script type="text/javascript">
        QUnit.config.autostart = false;
        jQuery(document).ready(function () {
            QUnit.start();
        });

        jQuery.sap.require("sap.ui.core.LocaleData");
        jQuery.sap.require("sap.me.Calendar");
        jQuery.sap.require("sap.me.CalendarRenderer");

        /**
         * Returns the interval format with the given Id (see CLDR documentation for valid Ids)
         * or the fallback format if no interval format with that Id is known.
         * Note: This is done using a <B>private</B> method of LocaleData.
         *
         * The empty Id ("") might be used to retrieve the interval format fallback.
         *
         * TODO: in 1.17: delete this method and replace this call:
         *      this._getIntervalPattern(oLocaleData, sPatternId);
         * by this:
         *      oLocaleData.getIntervalPattern(sPatternId);
         *
         * @see Git change #308949
         *
         * @param {sap.ui.core.LocaleData} oLocaleData
         * @param {string} sPatternId Id of the interval format, e.g. "d-d"
         *
         * @returns {string} interval format string with placeholders {0} and {1}
         *
         * @private
         * @experimental Since 1.16.4
         */
        formerSapMeCalendarRenderer_getIntervalPattern = function (oLocaleData, sPatternId) {
            var sPattern = "";

            if (oLocaleData !== undefined && oLocaleData !== null) {
                sPattern = oLocaleData.getIntervalPattern(sPatternId);
            }

            // Since intervalFormatFallback returns a value, the !sPattern clause is impossible to reach and thus, to test.
            if (!sPattern) {
                if (sap.ui.getCore().getConfiguration().getRTL()) {
                    sPattern = "{1} - {0}";
                } else {
                    sPattern = "{0} - {1}";
                }
            }

            return sPattern;
        };

        test("LocalData GetIntervalPattern test - Calendar renderer LocaleData private function call removal", function () {
            // see git changes #313758 and #308949
            var oLocale = sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();
            var oLocaleData = sap.ui.core.LocaleData.getInstance(oLocale);
            var pattern;

//            var currentRTL = sap.ui.getCore().getConfiguration().getRTL();
            pattern = "d-d";
            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 1st test pattern");

            pattern = "yMMM-y";
            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 2nd test pattern");

            pattern = "crashPattern";
            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 3rd test pattern");

//            sap.ui.getCore().getConfiguration().setRTL(!currentRTL);
//            pattern = "d-d";
//            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 4th test pattern");
//
//            pattern = "yMMM-y";
//            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 5th test pattern");
//
//            pattern = "crashPattern";
//            equal(formerSapMeCalendarRenderer_getIntervalPattern(oLocaleData, pattern), oLocaleData.getIntervalPattern(pattern), "Check: 6th test pattern");
//
//            // check if required.
//            sap.ui.getCore().getConfiguration().setRTL(currentRTL);
        });

        test("CSS 0120061532 0001225837 2014 - en", function () {
            var oCalendar = new sap.me.Calendar();
            oCalendar._oLocale = new sap.ui.core.Locale("en");
            oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

            var sIntervalPattern = oCalendar._getIntervalPattern("yMMM-y");
            equal(sIntervalPattern, "MMM y – MMM y", "CLDR Check: EN Interval pattern changed");

            var sIntervalSeparator = sap.me.CalendarRenderer._getIntervalSeparator(sIntervalPattern, oCalendar);
            equal(sIntervalSeparator, "–", "CLDR Check: EN Interval separator changed");
        });

        /**
         * For cnZH, the intervalFormatFallback pattern is "{0} - {1}",
         * while the "yMMM-y" pattern has a character instead of the hyphen.
         */
        test("CSS 0120061532 0001225837 2014 - zh-CN", function () {
            var oCalendar = new sap.me.Calendar();
            oCalendar._oLocale = new sap.ui.core.Locale("zh-CN");
            oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

            var cssFixPattern = oCalendar._getIntervalPattern("MMM-M");
            equal(encodeURI(cssFixPattern), "LLL%E8%87%B3LLL", "CLDR Check: zh-CN CSS FIX - Interval pattern changed");

            var sIntervalPattern = oCalendar._getIntervalPattern("yMMM-y");
            // Cannot compare the raw strings because of unicode characters
            // The pattern looks like: "y1M23y1M2", where 1 is the character for 'year', 2 for 'month' and 3 for 'to'.
            equal(encodeURI(sIntervalPattern), "y%E5%B9%B4M%E6%9C%88%E8%87%B3y%E5%B9%B4M%E6%9C%88", "CLDR Check: zh-CN Interval pattern changed");

            var sIntervalSeparator = sap.me.CalendarRenderer._getIntervalSeparator(sIntervalPattern, oCalendar);
            equal(encodeURI(sIntervalSeparator), "%E8%87%B3", "CLDR Check: zh-CN Interval separator changed");
        });

        /**
         * For cnTW, the intervalFormatFallback and the "yMMM-y" interval patterns
         * have the same character for "to".
         */
        test("CSS 0120061532 0001225837 2014 - zh-TW", function () {
            var oCalendar = new sap.me.Calendar();
            oCalendar._oLocale = new sap.ui.core.Locale("zh-TW");
            oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

            var sIntervalPattern = oCalendar._getIntervalPattern("yMMM-y");
            // Cannot compare the raw strings because of unicode characters
            // The pattern looks like: "y1M23y1M2", where 1 is the character for 'year', 2 for 'month' and 3 for 'to'.
            equal(encodeURI(sIntervalPattern), "y%E5%B9%B4M%E6%9C%88%E8%87%B3y%E5%B9%B4M%E6%9C%88", "CLDR Check: zh-TW Interval pattern changed");

            var sIntervalSeparator = sap.me.CalendarRenderer._getIntervalSeparator(sIntervalPattern, oCalendar);
            equal(encodeURI(sIntervalSeparator), "%E8%87%B3", "CLDR Check: zh-TW Interval separator changed");
        });

        var DAY_TO_GETDAY = {
            SUNDAY: 0,
            MONDAY: 1,
            TUESDAY: 2,
            WEDNESDAY: 3,
            THURSDAY: 4,
            FRIDAY: 5,
            SATURDAY: 6
        };

        test('BCP 0120025231 0000180047 2016 - EN', function () {
            var oCalendar = new sap.me.Calendar();
            oCalendar._oLocale = new sap.ui.core.Locale("en");
            oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);
            // EN weekends are saturday and sunday
            ok(oCalendar.isWeekend(DAY_TO_GETDAY.SATURDAY), "saturday should be weekend");
            ok(oCalendar.isWeekend(DAY_TO_GETDAY.SUNDAY), "sunday should be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.MONDAY), "monday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.TUESDAY), "tuesday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.WEDNESDAY), "wednesday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.THURSDAY), "thursday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.FRIDAY), "friday should not be weekend");

            oCalendar.destroy();
        });

        test('BCP 0120025231 0000180047 2016 - ar_SA', function () {
            var oCalendar = new sap.me.Calendar();
            oCalendar._oLocale = new sap.ui.core.Locale("ar_SA");
            oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);
            // ar_SA weekends are friday and saturday
            ok(oCalendar.isWeekend(DAY_TO_GETDAY.FRIDAY), "friday should be weekend");
            ok(oCalendar.isWeekend(DAY_TO_GETDAY.SATURDAY), "saturday should be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.SUNDAY), "sunday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.MONDAY), "monday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.TUESDAY), "tuesday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.WEDNESDAY), "wednesday should not be weekend");
            ok(!oCalendar.isWeekend(DAY_TO_GETDAY.THURSDAY), "thursday should not be weekend");

            oCalendar.destroy();
        });

		test("BCP 0020751294 0000022458 2017 - unsupported locale", function () {
			var oCalendar = new sap.me.Calendar();
			oCalendar._oLocale = new sap.ui.core.Locale("zzz");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);
			notEqual(sap.me.CalendarRenderer._getMonthAndYear(new Date(2017, 3, 13), oCalendar), "{0}", "Fix for getIntervalPattern returning {0} instead of an actual pattern");
		});

		test("BCP 554404 2017 - getMonthAndYear unsupported dutch locale (nl)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("nl");
			oCalendar._oLocale = new sap.ui.core.Locale("nl");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getMonthAndYear(new Date(2017, 9, 13), oCalendar);
			equal(sFormattedDate, "okt. 2017", "Fix for getMonthAndYear returning an interval instead of a formatted single date");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

		test("BCP 554404 2017 - _getDateIntervalText unsupported dutch locale (nl)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("nl");
			oCalendar._oLocale = new sap.ui.core.Locale("nl");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getDateIntervalText(new Date(2017, 9, 25), new Date(2017, 10, 2), oCalendar);
			equal(sFormattedDate, "okt. 2017 \u2013 nov. 2017", "Fix for getDateIntervalText throwing an error");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

		test("BCP 4664 2018 - getMonthAndYear unsupported dutch locale (pt)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("pt");
			oCalendar._oLocale = new sap.ui.core.Locale("pt");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getMonthAndYear(new Date(2017, 9, 13), oCalendar);
			equal(sFormattedDate, "out 2017", "Fix for getMonthAndYear returning an interval instead of a formatted single date");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

		test("BCP 4664 2018 - _getDateIntervalText unsupported dutch locale (pt)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("pt");
			oCalendar._oLocale = new sap.ui.core.Locale("pt");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getDateIntervalText(new Date(2017, 9, 25), new Date(2017, 10, 2), oCalendar);
			equal(sFormattedDate, "out 2017 \u2013 nov 2017", "Fix for getDateIntervalText throwing an error");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

		test("BCP 4664 2018 - getMonthAndYear unsupported dutch locale (it)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("it");
			oCalendar._oLocale = new sap.ui.core.Locale("it");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getMonthAndYear(new Date(2017, 9, 13), oCalendar);
			equal(sFormattedDate, "ott 2017", "Fix for getMonthAndYear returning an interval instead of a formatted single date");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

		test("BCP 4664 2018 - _getDateIntervalText unsupported dutch locale (it)", function () {
			var oCalendar = new sap.me.Calendar();
			sap.ui.getCore().getConfiguration().setLanguage("it");
			oCalendar._oLocale = new sap.ui.core.Locale("it");
			oCalendar._oLocaleData = sap.ui.core.LocaleData.getInstance(oCalendar._oLocale);

			var sFormattedDate = sap.me.CalendarRenderer._getDateIntervalText(new Date(2017, 9, 25), new Date(2017, 10, 2), oCalendar);
			equal(sFormattedDate, "ott 2017 \u2013 nov 2017", "Fix for getDateIntervalText throwing an error");
			// reset to en
			sap.ui.getCore().getConfiguration().setLanguage("en");
		});

    </script>
</head>

<body class="sapUiBody">
<h1 id="qunit-header">QUnit tests: Calendar</h1>

<h2 id="qunit-banner"></h2>

<h2 id="qunit-userAgent"></h2>

<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
<br>

<div id="target1"></div>
<div id="target2"></div>
</body>
</html>
