<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>OverlapCalendar - sap.me</title>

	<!-- UI5 Bootstrap -->
	<script id="sap-ui-bootstrap"
			type="text/javascript"
			src="../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-libs="sap.m,sap.me"></script>

	<!-- QUnit libraries -->
	<link rel="stylesheet"
		  href="../../../../resources/sap/ui/thirdparty/qunit.css"
		  type="text/css" media="screen" />
	<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
	<script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>

	<script type="text/javascript">
		QUnit.config.autostart = false;
		jQuery(document).ready(function() {
			QUnit.start();
			// 10 seconds timeout for all the tests below
			QUnit.config.testTimeout  = 10000;
		});

		jQuery.sap.require("sap.ui.core.LocaleData");
		jQuery.sap.require("sap.ui.core.date.UniversalDate");
		jQuery.sap.require("sap.me.OverlapCalendar");

		function clickNext(oCalendar) {
			// Accessing private API (_oNextBtn) for testing purposes ONLY.
			oCalendar.getCalendar()._oNextBtn.firePress();
		}

		test("BCP 0120025231 0000738147 2015", function () {
			var oCalendar = new sap.me.OverlapCalendar(),
					date1 = new Date("Mon Oct 05 2015 00:00:00 GMT+1100 (AUS Eastern Daylight Time)"),
					date2 = new Date("Tue Sep 29 2015 00:00:00 GMT+1000 (AUS Eastern Standard Time)"),
					expectedResult = 6;
			equal(oCalendar._getRawDaysDifference(date1, date2), expectedResult, "Should be 6 days difference");
			oCalendar.destroy();
		});

		test("BCP 0120025231 0000919744 2015", function () {
			var oCalendar = new sap.me.OverlapCalendar(),
					data = [
						{input: new Date("Mon Oct 05 2015 06:00:00 GMT-0100"), expectedDay: 5, expectedHour:12},
						{input: new Date(Date.UTC(2015, 9, 5, 3, 0, 0)), expectedDay: 5, expectedHour:12},
						{input: new Date("Tue Sep 29 2015 08:00:00 GMT-0100"), expectedDay: 29, expectedHour:12},
						{input: new Date(Date.UTC(2015, 8, 29, 3, 0, 0)), expectedDay: 29, expectedHour:12}],
					date, k;
			for (k = 0; k < data.length; ++k) {
				date = oCalendar._createDateInDays(data[k].input);
				equal(date.getDate(), data[k].expectedDay, "Date #" + k + " should match.");
				equal(date.getHours(), data[k].expectedHour, "Hour #" + k + " should match.");
			}
			oCalendar.destroy();
		});

		test("BCP 0120025231 0000114166 2016", function () {
			var oCalendar = new sap.me.OverlapCalendar();
			var _changeDatesForCalendars = function (event) {
				oCalendar.setStartDate(event.getParameter("firstDate"));
				// the line above was throwing an exception, whose message was:
				// "NaN" is of type number, expected int for property "firstDayOffset" of Element sap.me.Calendar#__calendar5
				ok(true);
			};
			oCalendar.attachChangeDate(_changeDatesForCalendars, oCalendar);
			clickNext(oCalendar);
			oCalendar.destroy();
		});

		test("OverlapCalendar should emit events with Date objects, not UniversalDate", function () {
			expect(2);
			var oCalendar = new sap.me.OverlapCalendar();
			var onChangeStartDate = function (oEvent) {
				equal(oEvent.getParameter("firstDate") instanceof Date, true, "firstDate should be a Date");
				equal(oEvent.getParameter("endDate") instanceof Date, true, "endDate should be a Date");
			};
			oCalendar.attachChangeDate(onChangeStartDate, oCalendar);
			clickNext(oCalendar);
			oCalendar.destroy();
		});

		test("Month Titles - BCP 002075129500003097872016", function () {
			var oCalendar = new sap.me.OverlapCalendar({
				id: "monthTitleCalendar",
				startDate: '2016-08-29',
				firstDayOffset: 3,
				singleRow: true,
				weeksPerRow: 2
			});
			var getMonthTitleDivText = function () {
				sap.ui.getCore().applyChanges();
				var monthTitleDiv = jQuery("#monthTitleCalendar").find(".sapMeCalendarMonthName")[0];
				return monthTitleDiv.innerText;
			};
			oCalendar.placeAt("overlapCalendarMonthTitles");
			equal(getMonthTitleDivText(), "Aug 2016 – Sep 2016", "There should be an interval displayed spanning from August to September 2016");
			oCalendar.setStartDate("2016-12-28");
			equal(getMonthTitleDivText(), "Dec 2016 – Jan 2017", "There should be an interval displayed spanning from December 2016 to January 2017");
		});

		jQuery.sap.require("sap.ui.core.date.UniversalDate");
		jQuery.sap.require("sap.ui.core.CalendarType");
		module("Islamic Date in OverlapCalendar", {
			setup: function() {
				// switch the calendar type to Islamic so that UniversalDate use the IslamicDate
				sap.ui.getCore().getConfiguration().setCalendarType(sap.ui.core.CalendarType.Islamic);
			},
			teardown: function() {
				sap.ui.getCore().getConfiguration().setCalendarType(null);
			}
		});
		// Events were not shown in the OverlapCalendar because the toDateString function is not implemented on
		// IslamicDate. This call to toDateString was replaced by a call to getTime instead.
		test("toDateString is not implemented in Islamic Calendar in 1.28", function () {
			var date = new sap.ui.core.date.UniversalDate();
			// Accessing private API (_ctorSafeDate) for testing purposes ONLY.
			var safeDate = sap.me.OverlapCalendar._ctorSafeDate(date);

			notEqual(date.toDateString(), undefined, "toDateString of an IslamicDate is no more undefined after and including 1.34");
			notEqual(safeDate, undefined, "ctorSafeDate of an Islamic Date should not be undefined");
			equal(typeof safeDate, "number", "ctorSafeDate of an Islamic Date should be a number");
		});
	</script>
</head>

<body class="sapUiBody">
<h1 id="qunit-header">QUnit tests: OverlapCalendar</h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
<br>
<div id="target1"></div>
<div id="target2"></div>
<div id="overlapCalendarMonthTitles"></div>
</body>
</html>
