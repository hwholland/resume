<html>
<head>
    <title>Acceptance Api Test for UxAP-77 (Create ObjectPageLayout with API) </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>

    <script id="sap-ui-bootstrap"
            src="../../../../resources/sap-ui-core.js"
            data-sap-ui-theme="sap_bluecrystal"
            data-sap-ui-libs="sap.m, sap.uxap">
    </script>

    <link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen"/>
    <script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
    <script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-coverage.js"></script>
    <script type="text/javascript" src="./js/js-coverage-filter.js"></script>

    <script type="text/javascript">

        module("aat_UxAP-77");
        jQuery.sap.registerModulePath("view", "view");
        sap.ui.controller("viewController",{
            nameFormatter : function(sTitle, sName){
                return sTitle + " - " + sName;
            }
        });

        var viewController = new sap.ui.controller("viewController");
        var appControl = new sap.m.App();
        appControl.placeAt("content");
        var oView = sap.ui.xmlview("objectPageView",{viewName : "view.UxAP-77_ObjectPage", controller : viewController });
        appControl.addPage(oView);

        jQuery.sap.delayedCall(100, window, function () {
            //start();

            test("create instance ObjectPageLayout via javascript", function () {
                var oObjectPage= new sap.uxap.ObjectPageLayout("myObjectPage1");
                equal(oObjectPage.getId(),"myObjectPage1");
            });
            test("add ObjectPageLayout in XMLView via API", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage2"));
                oView.addContent(oObjectPage);
                var referenceObjectPage = oView.byId("myObjectPage2");
                ok(referenceObjectPage != undefined, "ObjectPageLayout created in View");

            });
            test("test default value of ShowAnchorBar", function () {
                oView.removeAllContent();
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage3"));
                equal(oObjectPage.getShowAnchorBar(), true);
            });
            test("test ShowAnchorBar via Control settings", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage4"),{showAnchorBar: false});
                equal(oObjectPage.getShowAnchorBar(), false);
            });
            test("test ShowAnchorBar APIs", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage5"));
                oObjectPage.setShowAnchorBar(false);
                equal(oObjectPage.getShowAnchorBar(), false);
                oObjectPage.setShowAnchorBar(true);
                equal(oObjectPage.getShowAnchorBar(), true);
            });
            test("test Section APIs", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage7"));
                var oSection1 = new sap.uxap.ObjectPageSection({title:"Recognition"});
                var oSection2 = new sap.uxap.ObjectPageSection({title:"Employee"});
                oObjectPage.addSection(oSection1);
                oObjectPage.addSection(oSection2);
                var aSections = oObjectPage.getSections();
                equal(aSections.length, 2);

                equal(oObjectPage.indexOfSection(oSection1),0);
                equal(oObjectPage.indexOfSection(oSection2),1);

                equal(aSections[0].getTitle(), "Recognition");
                equal(aSections[1].getTitle(), "Employee");
                var oSection3 = new sap.uxap.ObjectPageSection({title:"Goal"});
                oObjectPage.insertSection(oSection3, 1);
                equal(oObjectPage.getSections().length, 3);
                equal(oObjectPage.indexOfSection(oSection1),0);
                equal(oObjectPage.indexOfSection(oSection3),1);
                equal(oObjectPage.indexOfSection(oSection2),2);
                equal(oObjectPage.getSections()[0].getTitle(), "Recognition");
                equal(oObjectPage.getSections()[1].getTitle(), "Goal");
                equal(oObjectPage.getSections()[2].getTitle(), "Employee");
                oObjectPage.removeSection(oSection1);
                equal(oObjectPage.getSections().length, 2);
                equal(oObjectPage.indexOfSection(oSection3),0);
                equal(oObjectPage.indexOfSection(oSection2),1);

                oObjectPage.removeAllSections();
                equal(oObjectPage.getSections().length, 0);
                oObjectPage.addSection(oSection1);
                equal(oObjectPage.getSections().length, 1);
                oObjectPage.destroySections();
                equal(oObjectPage.getSections().length, 0);
            });

            test("test Height APIs", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage10"));
                equal(oObjectPage.getHeight(), '100%');
                oObjectPage.setHeight('50%');
                equal(oObjectPage.getHeight(), '50%');
            });
            test("test Header APIs", function () {
                var oObjectPage = new sap.uxap.ObjectPageLayout(oView.createId("myObjectPage11"));
                var oHeader = new sap.uxap.ObjectPageHeader("header");
                oObjectPage.addHeaderContent(new sap.m.Text({text:"test"}));
                oObjectPage.setHeaderTitle(oHeader);
                var oHeader2 = oObjectPage.getHeaderTitle();
                var aContent = oObjectPage.getHeaderContent();
                equal(aContent[0].getText(), "test");
            });

            var oSampleView = sap.ui.xmlview("objectPageViewSample",{viewName : "view.UxAP-77_ObjectPageSample", controller : viewController });
            appControl.removeAllPages();
            appControl.addPage(oSampleView);

            test("test Section for ObjectPageLayout defined into XMLView", function () {
                var oObjectPage = oSampleView.byId("objectPage13");
                equal(oObjectPage.getSections().length, 3);
                equal(oObjectPage.getSections()[0].getTitle(), "Payroll");
                equal(oObjectPage.getSections()[1].getTitle(), "Status");
                equal(oObjectPage.getSections()[2].getTitle(), "Wage Type");

                var oSection1 = new sap.uxap.ObjectPageSection(oSampleView.createId("sectionGoal"), {title:"Goal"});
                oObjectPage.insertSection(oSection1, 1);
                equal(oObjectPage.getSections().length, 4);
                equal(oObjectPage.indexOfSection(oSection1),1);
                equal(oObjectPage.getSections()[0].getTitle(), "Payroll");
                equal(oObjectPage.getSections()[1].getTitle(), "Goal");
                equal(oObjectPage.getSections()[2].getTitle(), "Status");
                equal(oObjectPage.getSections()[3].getTitle(), "Wage Type");
                oObjectPage.removeSection(oObjectPage.getSections()[0]);
                equal(oObjectPage.getSections().length, 3);
                equal(oObjectPage.indexOfSection(oSection1),0);
                equal(oObjectPage.getSections()[0].getTitle(), "Goal");
                equal(oObjectPage.getSections()[1].getTitle(), "Status");
                equal(oObjectPage.getSections()[2].getTitle(), "Wage Type");
                var oSection2 = new sap.uxap.ObjectPageSection(oSampleView.createId("sectionRecognition"),{title:"Recognition"});
                oObjectPage.addSection(oSection2);
                equal(oObjectPage.getSections().length, 4);
                equal(oObjectPage.indexOfSection(oSection2),3);
                equal(oObjectPage.getSections()[3].getTitle(), "Recognition");
                oSection2.addDelegate({ onAfterRendering : function(){
                    test("Sections Rendering", function () {
                        //check sections
                        strictEqual(checkObjectExists("#objectPageViewSample--sectionGoal"), true);
                        strictEqual(checkObjectExists("#objectPageViewSample--sectionStatus"), true);
                        strictEqual(checkObjectExists("#objectPageViewSample--sectionWageType"), true);
                        strictEqual(checkObjectExists("#objectPageViewSample--sectionRecognition"), true);
                    });
                }});
            });

            test("test ObjectPageHeader for ObjectPageLayout defined into XMLView", function () {
                var oObjectPage = oSampleView.byId("objectPage13");
                var oHeader =  oObjectPage.getHeaderTitle();
                ok(oHeader != undefined);
                equal(oObjectPage.getHeaderContent()[0].getText(),"Personal description");
                oObjectPage.destroyHeaderTitle();
                oObjectPage.destroyHeaderContent();
                ok(oObjectPage.getHeaderTitle() == undefined);
                var oNewHeader = new sap.uxap.ObjectPageHeader(oSampleView.createId("newHeader"));
                oObjectPage.addHeaderContent(new sap.m.Text(oSampleView.createId("newHeaderText"), {text:"test"}));
                oObjectPage.setHeaderTitle(oNewHeader);
                ok(oObjectPage.getHeaderTitle() != undefined);
                equal(oObjectPage.getHeaderContent()[0].getText(), "test");
                oNewHeader.addDelegate({ onAfterRendering : function(){
                    test("ObjectPageHeader Rendering", function () {
                        strictEqual(checkObjectExists("#objectPageViewSample--newHeader"), true);
                        equal(jQuery("#objectPageViewSample--newHeaderText").text(), "test");
                    });
                }});
            });
        });



       function checkObjectExists(sSelector) {
            var oObject = jQuery( sSelector );
            return oObject.length !== 0;
        };
    </script>

</head>

<body id="body" class="sapUiBody">
<h1 id="qunit-header">qUnit Page for UxAP-77 AAT</h1>
<div id="qunit"></div>
<div id="content"></div>
</body>
</html>
