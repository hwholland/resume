<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<title>Qunit - HeaderFooter</title>

	<script src="../../../../../../resources/sap-ui-core.js"
			id="sap-ui-bootstrap"
			data-sap-ui-libs="sap.m"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-xx-bindingSyntax="complex"
			data-sap-ui-noConflict="true">
	</script>

	<link rel="stylesheet" href="../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
	<script src="../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script src="../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
	<script src="../../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
	<script src="../../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

	<script>
		(function () {
			"use strict"
			jQuery.sap.require("sap.m.Page");

			var DetailHeaderFooterHelper,
			    sDefaultLanguage = sap.ui.getCore().getConfiguration().getLanguage();

			module("Detail header footer helper", {
				setup: function () {
					sap.ui.getCore().getConfiguration().setLanguage("en-US");
					//
					jQuery.sap.require("sap.ca.scfld.md.app.ApplicationImplementation");
					DetailHeaderFooterHelper = sap.ca.scfld.md.app.DetailHeaderFooterHelper;
				},
				teardown: function () {
					sap.ui.getCore().getConfiguration().setLanguage(sDefaultLanguage);
				}
			});


			var DetailHeaderFooterHelper,
				sDefaultLanguage = sap.ui.getCore().getConfiguration().getLanguage();

			module("Detail header footer helper", {
				setup: function () {
					sap.ui.getCore().getConfiguration().setLanguage("en-US");
					//
					jQuery.sap.require("sap.ca.scfld.md.app.ApplicationImplementation");
					DetailHeaderFooterHelper = sap.ca.scfld.md.app.DetailHeaderFooterHelper;
				},
				teardown: function () {
					sap.ui.getCore().getConfiguration().setLanguage(sDefaultLanguage);
				}
			});

			function stubUI (oOptions) {
				if(!oOptions) {
					oOptions = {};
				}

				var oPage = new sap.m.Page();
				var oView = stubView(oPage);

				sap.ui.controller("myView", {
					getHeaderFooterOptions : function () {
						return oOptions;
					},
					getPage : function () {
						return oPage
					},
					isMainScreen : function () {
						return true;
					}

				});

				return {
					controller : oView.getController(),
					view : oView,
					page : oPage
				};
			}

			function stubView (oPage) {
				sap.ui.jsview("myView", {
					createContent : function() {
						return oPage;
					},
					getController : function() {
						return sap.ui.controller("myView");
					}
				});

				return sap.ui.jsview("viewId", "myView");
			}

			function stubApplicationImpl () {
				var oResourceBundle = {
						getText : function () { return "foo"; }
					},
					oUilibI18nModel = {
						getResourceBundle : function () {
							return oResourceBundle;
						}
					};

				return {
					UilibI18nModel: oUilibI18nModel,
					oCurController : {},
					registerExitModule : this.stub(),
					getResourceBundle : function () {
						return oResourceBundle;
					}
				}
			}

			test("Should create the share button in the footer if no options are passed", function() {
				// Arrange
				var oUI = stubUI({});

				// System under Test
				var oHeaderFooterHelper = new DetailHeaderFooterHelper(stubApplicationImpl.call(this));

				// Act
				oHeaderFooterHelper.defineDetailHeaderFooter(oUI.controller);

				// Assert
				strictEqual(oUI.page.getFooter().getContentRight().length, 2, "Did create two buttons");
				strictEqual(oUI.page.getFooter().getContentRight()[0].getIcon(), "sap-icon://overflow", "Did set the overflow icon");
				strictEqual(oUI.page.getFooter().getContentRight()[1].getIcon(), "sap-icon://action", "Did set the share icon");
				strictEqual(oUI.controller._oControlStore.oShareSheet.getButtons().length, 1, "did add the save button to the action sheet");
				strictEqual(oUI.controller._oControlStore.oShareSheet.getButtons()[0].getText(), "Save as Tile", "did add the save button to the action sheet");

				// Cleanup
				oUI.view.destroy();
			});

			test("Should add some text buttons", function() {
				// Arrange
				var oUI = stubUI({
					buttonList : [{
						sBtnTxt : "ADDITIONAL_BTN1"
					},
					{
						sBtnTxt : "ADDITIONAL_BTN2"
					}],
				});

				// System under Test
				var oHeaderFooterHelper = new DetailHeaderFooterHelper(stubApplicationImpl.call(this));

				// Act
				oHeaderFooterHelper.defineDetailHeaderFooter(oUI.controller);

				// Assert
				strictEqual(oUI.page.getFooter().getContentRight().length, 4, "Did create the buttons");
				strictEqual(oUI.page.getFooter().getContentRight()[0].getText(), "ADDITIONAL_BTN1", "Did add the first button");
				strictEqual(oUI.page.getFooter().getContentRight()[1].getText(), "ADDITIONAL_BTN2", "Did add the second button");
				strictEqual(oUI.page.getFooter().getContentRight()[2].getIcon(), "sap-icon://overflow", "Did set the overflow icon");
				strictEqual(oUI.page.getFooter().getContentRight()[3].getIcon(), "sap-icon://action", "Did set the share icon");

				// Cleanup
				oUI.view.destroy();
			});

			test("Should change a button text", function() {
				// Arrange
				var oUI = stubUI({
					buttonList : [{
						sId : "foo",
						sBtnTxt : "ADDITIONAL_BTN1"
					},
					{
						sBtnTxt : "ADDITIONAL_BTN2"
					}]
				});

				// System under Test
				var oHeaderFooterHelper = new DetailHeaderFooterHelper(stubApplicationImpl.call(this));
				oHeaderFooterHelper.defineDetailHeaderFooter(oUI.controller);

				// Act
				oUI.controller._oControlStore.oButtonListHelper.setBtnText("foo", "bar");

				// Assert
				strictEqual(oUI.page.getFooter().getContentRight().length, 4, "Did create all buttons");
				strictEqual(oUI.page.getFooter().getContentRight()[0].getText(), "bar", "Did change the button text");
				strictEqual(oUI.page.getFooter().getContentRight()[1].getText(), "ADDITIONAL_BTN2", "Did add the second button");
				strictEqual(oUI.page.getFooter().getContentRight()[2].getIcon(), "sap-icon://overflow", "Did set the overflow icon");
				strictEqual(oUI.page.getFooter().getContentRight()[3].getIcon(), "sap-icon://action", "Did set the share icon");

				// Cleanup
				oUI.view.destroy();
			});
		})();
	</script>
</head>
<body id="body" class="sapUiBody">
<h1 id="qunit-header">qUnit Page for sap.m.Bar</h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<div id="qunit-fixture"></div>
</body>
</html>
