<!DOCTYPE HTML>
<html>
<head>

	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

	<title>QUnit - sap.ui.fl.changeHandler.AddGroup</title>

	<script id="sap-ui-bootstrap" type="text/javascript"
			src="../../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal" data-sap-ui-noconflict="true"
			data-sap-ui-libs="sap.ui.comp">
	</script>


	<link rel="stylesheet" href="../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen"/>
	<script type="text/javascript" src="../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
	<script type="text/javascript" src="../../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
	<script type="text/javascript" src="../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
	<script type="text/javascript" src="../../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
	<script type="text/javascript" src="../../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

<script type="text/javascript">
	jQuery.sap.require("sap.ui.fl.changeHandler.AddGroup");
	jQuery.sap.require("sap.ui.comp.smartform.SmartForm");
	jQuery.sap.require("sap.ui.comp.smartform.Group");
	jQuery.sap.require("sap.ui.fl.Change");

	(function (AddGroupChangeHandler, SmartForm, SmartFormGroup, ChangeWrapper) {

		module("sap.ui.fl.changeHandler.AddGroup", {
			setup: function () {
				this.stubs = [];
				this.oChangeHandler = new AddGroupChangeHandler();
			},
			teardown: function () {
				this.stubs.forEach(function (stub) {
					stub.restore();
				});
			}
		});


		test('applyChange - positive test', function () {

			var oChange = {
				"selector": {
					"id": "formkey1"
				},
				"content": {
					"group": {
						"id": "groupId1",
						"index": 0
					}
				},
				"texts": {
					"groupLabel": {
						"value": "the group label",
						"type": "XFLD"
					}
				}
			};
			var oChangeWrapper = new ChangeWrapper(oChange);

			var oForm = new SmartForm();
			var oAddGroupSpy = this.spy(oForm, "insertGroup");

			this.oChangeHandler.applyChange(oChangeWrapper, oForm);

			ok(oAddGroupSpy.calledOnce);
			equal(oForm.getGroups().length, 1);

		});

		test('applyChange - negative test', function () {

			var oChange = {
				"selector": {
					"id": "formkey2"
				},
				"content": {
					"group": {
						"id": "groupId2",
						"index": 0
					}
				},
				"texts": {
					"groupLabel": {
						"value": "the group label",
						"type": "XFLD"
					}
				}
			};
			var oChangeWrapper = new ChangeWrapper(oChange);

			var oForm = new SmartForm();

			var sError;
			try {
				this.oChangeHandler.applyChange(oChangeWrapper, {});
			} catch (error) {
				sError = error.message;
			}

			equal(sError, "no parent form provided for adding the group");

		});

		test('completeChangeContent', function () {
			var oChange = {
				"selector": {
					"id": "formkey"
				}
			};
			var oChangeWrapper = new ChangeWrapper(oChange);
			var oSpecificChangeInfo = { "groupLabel": "the group label", "index": 1, "newControlId": "new--group--control--id" };
			
			this.oChangeHandler.completeChangeContent(oChangeWrapper, oSpecificChangeInfo);
			
			equal(oChange.content.group.id, "new--group--control--id");
			equal(oChange.content.group.index, 1);			
			equal(oChange.texts.groupLabel.value, "the group label");
		});

	}(sap.ui.fl.changeHandler.AddGroup, sap.ui.comp.smartform.SmartForm, sap.ui.comp.smartform.Group, sap.ui.fl.Change));
	</script>
</head>
<body id="body" class="sapUiBody">
<h1 id="qunit-header">qUnit Page for sap.ui.fl.changeHandler.AddGroup</h1>

<h2 id="qunit-banner"></h2>

<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<div id="content"></div>
</body>
</html>
