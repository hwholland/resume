<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<link href="style/sapvbistyle.css" type="text/css" rel="stylesheet" />


	<script src="../../../../resources/sap-ui-core.js"
		id="Script1"
		data-sap-ui-libs="sap.ui.commons,sap.ui.table,sap.ui.vbm"
		data-sap-ui-theme="sap_bluecrystal"
		data-sap-ui-xx-bindingSyntax="complex" >
	</script>

	<script>
	
	// have some data
	var oData = 
		{
			Spots :
				[ { "key": "1", "pos": "-100; 0; 0"},
				  { "key": "2", "pos": "-50; 0; 0"},
				  { "key": "3", "pos": "0; 0; 0"},
				  { "key": "4", "pos": "50; 0; 0"},
				  { "key": "5", "pos": "100; 0; 0"},
				]	
		};
	var activeSpot = 0;
	
	// create model and set the data
	var oModel = new sap.ui.model.json.JSONModel();
	oModel.setData( oData );
		
	// sample event handlers	
	function onClick( evt )
	{
		detailSpot = this.getText();
		this.openDetailWindow( "Spot " + detailSpot );
	};

	function onContextMenu( evt )
	{
		var activeSpot = this.getText();
		var oMenu = evt.mParameters.menu;
		oMenu.addItem( new sap.ui.unified.MenuItem( { text : "Spot " + activeSpot } ) );
		oMenu.addItem( new sap.ui.unified.MenuItem( { text : "Remove", select : removeSpot.bind(undefined, activeSpot) } ) );
		this.openContextMenu( oMenu );
	};
	
	// create map and bind to model
	var oVBI = new sap.ui.vbm.GeoMap('vbi', {
	   width : "100%",
    	height: "100%",
    	vos: [
    	  	new sap.ui.vbm.Spots( {
    	  		items: {
    	  			path: "/Spots",
    	  			template: new sap.ui.vbm.Spot( { key:      "{key}",
    	  				                              type:     "Default", 
    	  				                              text:     "{key}",
    	  				                              position: "{pos}",
    	  				                              click:    onClick,
    	  				                              contextMenu: onContextMenu
    	  				                             })
    	  		}
    	  	}
    	  	)
    	]
	});

	oVBI.setModel( oModel );
	oVBI.placeAt("content");
	
	
	// modification of the context
	function onAddDT() {
		oVBI.openDetailWindow( "8.5;49.5;0", { caption : "Unrelated Detail Window"});
		activeSpot = 0;
	};
	function onDTClose() {
       oVBI.closeAnyDetailWindow();
	};	
	function onRemoveSpot() {
		removeSpot(detailSpot);
		detailSpot = 0;
	};
	function onRemoveSpots() {
		var aVO = oVBI.getVos();
		oVBI.removeVo(aVO[0]);
	};	
	function onRemoveVOs() {
		oVBI.removeAllVos();
	};
	
	function removeSpot(key) {
		oData = oModel.getData();
		for (var nI = 0; nI < oData.Spots.length; ++nI) {
			if (oData.Spots[nI].key === key) {
				oData.Spots.splice(nI, 1); 
			}
		}
		oModel.setData(oData);
	};	
	
	
	</script>

	<body class="sapUiBody" >
		  <h1>Visual Business GeoMap Interaction Sample</h1>
			<ul>
				<li>Testing the Visual Business GeoMap Control with Detail Windows cand Context Menus</li>
				<li>You can click a spot to open a Detail Window for it. Only one Detail Window can be open.</li>
				<li>You can close a Detail Window with the cross in its right upper corner or via button <i>Close any open Detail Window</i></li>
				<li>If you remove the Spot its Detail Window should be closed as well.</li>	
				<li>If you remove all Spots any open Detail Window should be closed as well.</li>
				<li>You can open a Detail Window at a given position without a relation to a Visual Object.</li>
				<li>With a right click on a Spot you get a Context Menu. It can be visible in addition to a Detail Window.</li>			
			</ul>
		 <div class="ratio_box">
		 	<div class="content" id="content"></div>
		 </div>
		 <br />
		 <button id="addDetailWindow" onClick="onAddDT()">Add a Detail Window at a fixed position</button>
		 <button id="CloseDetailWindow" onClick="onDTClose()">Close any open Detail Window</button>
		 <button id="RemoveSpot" onClick="onRemoveSpot()">Remove the Spot with open Detail Window</button>
		 <button id="RemoveSpots" onClick="onRemoveSpots()">Remove all Spots</button>
		 <button id="RemoveVos" onClick="onRemoveVOs()">Remove all VOs</button>	 
	</body>
</html>
