<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<link href="../style/sapvbistyle.css" type="text/css" rel="stylesheet" />


	<script src="../../../../../resources/sap-ui-core.js"
		id="Script1"
		data-sap-ui-libs="sap.ui.commons, sap.m, sap.ui.table,sap.ui.vbm"
		data-sap-ui-theme="sap_bluecrystal"
		data-sap-ui-xx-bindingSyntax="complex" >
	</script>
	
  <style type="text/css">
  .vbi-map-active, .vbi-map-inactive {
-webkit-filter: grayscale(70%);
-moz-filter: grayscale(70%);
-ms-filter: grayscale(70%);
-o-filter: grayscale(70%);
filter: grayscale(70%);
}
</style>

	<script>

	
	// have some data
	var oData = 
		{
				Spots :
				[
					{ "key" : "1", "pos": "13.407965;52.517906;0",  "tooltip": "Berlin", "type":sap.ui.vbm.SemanticType.Success, "select": true },  
					{ "key":  "2", "pos": "-3.704257;40.418071;0", "tooltip": "Madrid", "type":sap.ui.vbm.SemanticType.Success, "select": false },  
					{ "key":  "3", "pos": "37.613250;55.747928;0", "tooltip": "Moscow", "type":sap.ui.vbm.SemanticType.Success, "select": false },  
					{ "key":  "4", "pos": "2.347899;48.855675;0", "tooltip": "Paris", "type":sap.ui.vbm.SemanticType.Success, "select": false }  ,
					{ "key" : "5", "pos": "-0.127697;51.509331;0",  "tooltip": "London", "type":sap.ui.vbm.SemanticType.Success, "select": false },  
					{ "key":  "6", "pos": "14.266513;40.851627;0", "tooltip": "Napoli", "type":sap.ui.vbm.SemanticType.Success, "select": false },  
					{ "key":  "7", "pos": "16.370441;48.206873;0", "tooltip": "Wien", "type":sap.ui.vbm.SemanticType.Success, "select": false },
					{ "key":  "8", "pos": "10.751470;59.914495;0", "tooltip": "Oslo", "type":sap.ui.vbm.SemanticType.Success, "select": false }  
					
					 
				]		
		};
	
	// create model and set the data
	var oModel = new sap.ui.model.json.JSONModel();
	oModel.setData( oData );
	
	// create a table and bind to model
	var otable = new sap.m.Table( 'vbitable', {
		mode: sap.m.ListMode.MultiSelect,
	    width : "400px",
	    selectionChange: onSelectionChanged,
       	columns: [
       	          new sap.m.Column({ header: new sap.m.Text({text: 'Select/Deselect all Locations'}) })
       	          ],
		items: { path : "/Spots",
		         template: new sap.m.ColumnListItem({ 
		         selected: '{select}',
		         cells:[
				 			new sap.m.Text({text: '{tooltip}'})
		               ]
		         })
		}	          
	});
	
	otable.setModel( oModel );
	otable.placeAt("content_left");
	
	
	function onSelectionChanged(e) {
		if (e.getSource().getId() == "vbitable") {
				var spots = oModel.getData().Spots;
				var lons = [];
				var lats = [];
				for (var nJ = 0; nJ < spots.length; ++nJ) {
					if (spots[nJ].select) {
						var pos = spots[nJ].pos;
						for (var nK = 0, start = 0; nK < pos.length; nK++) {
							if (pos[nK] === ";") {
								if (!start) {
									lons.push(pos.substring(start, nK));
									start = nK + 1;
								} else {
									lats.push(pos.substring(start, nK));
									break;
								}
							}
						}
					}
				}
				if (lons.length && lats.length) {
					if (lons.length == 1 && lats.length == 1) {
						oVBI.zoomToGeoPosition(lons, lats, 5);
					} else {
						oVBI.zoomToGeoPosition(lons, lats);
					}
				}
			}

		};

		// create geo map and bind to model
		var oVBI = new sap.ui.vbm.GeoMap('vbi', {
			width: "1024px",
			height: "600px",
			initialPosition: "30.512982;50.445636;0.0",
			initialZoom: "4",

			vos: [
				new sap.ui.vbm.Spots("spots1", {
					select: onSelectionChanged,
					deselect: onSelectionChanged,
					items: {
						path: "/Spots",
						template: new sap.ui.vbm.Spot({
							key: '{key}',
							position: '{pos}',
							tooltip: '{tooltip}',
							type: '{type}',
							select: '{select}',
							selectColor: 'RHLSA(0;1.0;3.0;1.0)'
						})
					}
				})
			]
		});

		oVBI.setModel(oModel);
		oVBI.placeAt("content_right");
	</script>

	<body class="sapUiBody" >
		  <h1>Visual Business GeoMap Control: Selection of objects</h1>
		  <br></br>
		  <p style="font-size:large">Select / Deselect Spots on Map or on Table</p>
	        <table>
	            <tr>
					<td><div style="width: 400px; height: 600px;" >
 						<div id="content_left"></div>
					</div></td>	            
	                <td><div id="content_right"></div></td>
	            </tr>
	        </table>
		 <br />
	</body>
</html>
