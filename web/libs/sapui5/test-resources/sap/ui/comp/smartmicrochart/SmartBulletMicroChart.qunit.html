<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>qUnit Page for sap.ui.comp.smartmicrochart.SmartBulletMicroChart</title>

<script id="sap-ui-bootstrap" type="text/javascript"
	src="../../../../../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.ui.comp, sap.suite.ui.microchart, sap.m">
</script>

<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript">
(function() {
	jQuery.sap.initMobile();
	if (!(sap.ui.Device.browser.msie && sap.ui.Device.browser.version <= 8)) {
		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
	}

	jQuery.sap.require("sap.ui.core.util.MockServer");
	jQuery.sap.require("sap.ui.comp.smartmicrochart.SmartBulletMicroChart");
	jQuery.sap.require("sap.ui.model.Model");

	QUnit.module("SmartBulletMicroChart", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Check default values", function(assert) {
		assert.equal(this.oSmartBulletMicroChart.getChartType(), "Bullet", "ChartType default value is correct.");
		assert.equal(this.oSmartBulletMicroChart.getEntitySet(), "", "EntitySet default value is correct.");
		assert.equal(this.oSmartBulletMicroChart.getEnableAutoBinding(), false, "EnableAutoBinding default value is correct.");
		assert.equal(this.oSmartBulletMicroChart.getChartBindingPath(), "", "ChartBindingPath default value is correct.");
		assert.notOk(this.oSmartBulletMicroChart.getIsResponsive(), "isResponsive default value is correct.");
		assert.equal(sap.ui.comp.smartmicrochart.SmartBulletMicroChart.getMetadata()._sDefaultAggregation, "_chart", "The default aggregation is correctly set to _chart");
	});

	QUnit.test("Check setter for 'entitySet' Property", function(assert) {
		var oSpy = sinon.spy(this.oSmartBulletMicroChart, "_initializeMetadata");
		this.oSmartBulletMicroChart.setEntitySet("MySet");
		assert.strictEqual(oSpy.callCount, 1, "Method _initializeMetadata is called when entitySet has changed.");
		assert.strictEqual(this.oSmartBulletMicroChart.getEntitySet(), "MySet", "EntitySet has been correctly set.");

		this.oSmartBulletMicroChart.setEntitySet("MySet");
		assert.strictEqual(oSpy.callCount, 1, "Method _initializeMetadata is not called when entitySet has not changed.");
	});

	QUnit.test("Test for showLabel property with default value", function(assert) {
		assert.ok(this.oSmartBulletMicroChart.getShowLabel(), "The property showLabel by default is true.");
		assert.ok(this.oSmartBulletMicroChart.getAggregation("_chart").getShowActualValue(), "ActualValue is showed.");
		assert.ok(this.oSmartBulletMicroChart.getAggregation("_chart").getShowTargetValue(), "TargetValue is showed.");
		assert.ok(this.oSmartBulletMicroChart.getAggregation("_chart").getShowDeltaValue(), "DeltaValue is showed.");
		assert.ok(this.oSmartBulletMicroChart.getAggregation("_chart").getShowValueMarker(), "ValueMarker is showed.");
	});

	QUnit.test("Test for showLabel property with true", function(assert) {
		var oReturn = this.oSmartBulletMicroChart.setShowLabel(true);
		assert.ok(this.oSmartBulletMicroChart.getShowLabel(), "The property showLabel by default is true.");
		assert.ok(oReturn.getAggregation("_chart").getProperty("showActualValue"), "ActualValue is showed.");
		assert.ok(oReturn.getAggregation("_chart").getProperty("showTargetValue"), "TargetValue is showed.");
		assert.ok(oReturn.getAggregation("_chart").getProperty("showDeltaValue"), "DeltaValue is showed.");
		assert.ok(oReturn.getAggregation("_chart").getProperty("showValueMarker"), "ValueMarker is showed.");
		assert.ok(oReturn instanceof sap.ui.comp.smartmicrochart.SmartBulletMicroChart, "Check if return value is correct to allow method chaninging.");
	});

	QUnit.test("Test for showLabel property with false", function(assert) {
		var oReturn = this.oSmartBulletMicroChart.setShowLabel(false);
		assert.ok(!oReturn.getAggregation("_chart").getProperty("showActualValue"), "ActualValue is not showed.");
		assert.ok(!oReturn.getAggregation("_chart").getProperty("showTargetValue"), "TargetValue is not showed.");
		assert.ok(!oReturn.getAggregation("_chart").getProperty("showDeltaValue"), "DeltaValue is not showed.");
		assert.ok(!oReturn.getAggregation("_chart").getProperty("showValueMarker"), "ValueMarker is not showed.");
		assert.ok(oReturn instanceof sap.ui.comp.smartmicrochart.SmartBulletMicroChart, "Check if return value is correct to allow method chaninging.");
	});

	QUnit.test("Should pass the entity set to the ChartProvider", function(assert) {
		var sEntitySet = "MySet";
		this.oSmartBulletMicroChart.setEntitySet(sEntitySet);

		sinon.stub(this.oSmartBulletMicroChart, "getModel").returns(new sap.ui.model.Model());

		this.oSmartBulletMicroChart._createChartProvider();

		assert.ok(this.oSmartBulletMicroChart._oChartProvider, "ChartProvider was created successfully");
		assert.strictEqual(this.oSmartBulletMicroChart._oChartProvider.sEntitySet, sEntitySet, "EntitySet was set in ChartProvider successfully");
	});

	QUnit.test("Should trigger initialiseMetadata and call _createChartProvider when entitySet and model are both set", function(assert) {
		var sEntitySet = "MySet", oModel = new sap.ui.model.Model();

		sinon.stub(sap.ui.comp.providers.ChartProvider.prototype, "getChartViewMetadata").returns({fields: []});
		sinon.stub(this.oSmartBulletMicroChart, "_createAndBindInnerChart");

		sinon.spy(this.oSmartBulletMicroChart, "_initializeMetadata");
		sinon.spy(this.oSmartBulletMicroChart, "_createChartProvider");
		sinon.spy(this.oSmartBulletMicroChart, "fireInitialize");

		this.oSmartBulletMicroChart.setEntitySet(sEntitySet);
		this.oSmartBulletMicroChart.setModel(oModel);

		assert.strictEqual(this.oSmartBulletMicroChart._oChartProvider.sEntitySet, sEntitySet, "EntitySet was set in ChartProvider successfully");
		assert.strictEqual(this.oSmartBulletMicroChart._oChartProvider._oParentODataModel, this.oSmartBulletMicroChart.getModel(), "Data model was set in ChartProvider successfully");

		assert.ok(this.oSmartBulletMicroChart._initializeMetadata.called, "Function initializeMetadata was called");
		assert.ok(this.oSmartBulletMicroChart._createChartProvider.called, "Function createChartProvider was called");
		assert.ok(this.oSmartBulletMicroChart.fireInitialize.calledOnce, "Function fireInitialize was called once");
		assert.ok(this.oSmartBulletMicroChart._bIsInitialized, "SmartBulletMicroChart was initialized");

		sap.ui.comp.providers.ChartProvider.prototype.getChartViewMetadata.restore();
	});

	QUnit.test("GetDatapointQualifier method test", function(assert) {
		this.oSmartBulletMicroChart._oChartViewMetadata = {
			annotation: {
				ChartType: {EnumMember: "com.sap.vocabularies.UI.v1.ChartType/Bullet"},
				Measures: [{PropertyPath: "Revenue"}],
				MeasureAttributes: [{
					DataPoint: {AnnotationPath: "@com.sap.vocabularies.UI.v1.DataPoint#BulletChartDataPoint"},
					Measure: {PropertyPath: "Revenue"},
					RecordType: "com.sap.vocabularies.UI.v1.ChartMeasureAttributeType",
					Role: {EnumMember: "com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1"}
				}]
			}
		};
		var sQualifier = this.oSmartBulletMicroChart._getDatapointQualifier();

		assert.equal(sQualifier, "BulletChartDataPoint", "The qualifier of datapoint in annotations was extracted successfully");
	});

	QUnit.test("Properties binding test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			ForecastValue: {
				Path: "ForecastRevenue"
			},
			MaximumValue: {
				Path: "MaxValue"
			},
			MinimumValue: {
				Path: "MinValue"
			},
			TargetValue: {
				Path: "TargetRevenue"
			},
			Value: {
				Path: "Revenue"
			}
		};
		this.oSmartBulletMicroChart._bindValueProperties();

		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getBindingPath("targetValue"), "TargetRevenue", "The property path TargetRevenue in annotations was bound to the property in control successfully");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getBindingPath("forecastValue"), "ForecastRevenue", "The property path ForecastRevenue in annotations was bound to the property in control successfully");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getBindingPath("maxValue"), "MaxValue", "The property path MaxValue in annotations was bound to the property in control successfully");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getBindingPath("minValue"), "MinValue", "The property path MinValue in annotations was bound to the property in control successfully");
	});

	QUnit.test("MinValue and MaxValue test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
				MaximumValue: {
					Decimal: "100"
				},
				MinimumValue: {
					Decimal: "1"
				}
			};
			this.oSmartBulletMicroChart._bindValueProperties();

			assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getMinValue(), 1, "MinValue was set correctly");
			assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getMaxValue(), 100, "MaxValue was set correctly");
	});

	QUnit.test("Thresholds aggregation binding test - target direction", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			CriticalityCalculation: {
				ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},
				DeviationRangeLowValue: {Path: "DeviationRangeLow"},
				ToleranceRangeLowValue: {Path: "ToleranceRangeLow"},
				ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
				DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
			}
		};

		this.oSmartBulletMicroChart._bindChartThresholds();
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds").length, 4, "The number of thresholds are right");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getBindingPath("value"), "DeviationRangeLow", "The first threshold (DeviationLow) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getProperty("color"), "Error", "The first threshold (DeviationLow) color was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getBindingPath("value"), "ToleranceRangeLow", "The second threshold (ToleranceLow) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getProperty("color"), "Critical", "The second threshold (ToleranceLow) color was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[2].getBindingPath("value"), "ToleranceRangeHigh", "The third threshold (ToleranceHigh) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[2].getProperty("color"), "Critical", "The third threshold (ToleranceHigh) color was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[3].getBindingPath("value"), "DeviationRangeHigh", "The forth threshold (DeviationHigh) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[3].getProperty("color"), "Error", "The forth threshold (DeviationHigh) color was bound correctly");
	});

	QUnit.test("Thresholds aggregation binding test - minimize direction", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			CriticalityCalculation: {
				ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Minimize"},
				ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
				DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
			}
		};

		this.oSmartBulletMicroChart._bindChartThresholds();
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds").length, 2, "The number of thresholds are right");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getBindingPath("value"), "ToleranceRangeHigh", "The first threshold (ToleranceHigh) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getProperty("color"), "Critical", "The first threshold (ToleranceHigh) color was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getBindingPath("value"), "DeviationRangeHigh", "The second threshold (DeviationHigh) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getProperty("color"), "Error", "The second threshold (DeviationHigh) color was bound correctly");
	});

	QUnit.test("Thresholds aggregation binding test - Maximize direction", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			CriticalityCalculation: {
				ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Maximize"},
				DeviationRangeLowValue: {Path: "DeviationRangeLow"},
				ToleranceRangeLowValue: {Path: "ToleranceRangeLow"}
			}
		};

		this.oSmartBulletMicroChart._bindChartThresholds();
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds").length, 2, "The number of thresholds are right");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getBindingPath("value"), "DeviationRangeLow", "The first threshold (DeviationLow) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[0].getProperty("color"), "Error", "The first threshold (DeviationLow) color was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getBindingPath("value"), "ToleranceRangeLow", "The second threshold (ToleranceLow) aggregation was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("thresholds")[1].getProperty("color"), "Critical", "The second threshold (ToleranceLow) color was bound correctly");
	});

	QUnit.test("Actual aggregation binding test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			CriticalityCalculation: {
				ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},
				DeviationRangeLowValue: {Path: "DeviationRangeLow"},
				ToleranceRangeLowValue: {Path: "ToleranceRangeLow"},
				ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
				DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
			},
			Value: {Path: "Revenue"},
			Criticality: {Path: "Error"}
		};

		this.oSmartBulletMicroChart._bindAggregationActual();
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getBindingPath("value"), "Revenue", "The actual value was bound successfully");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getBindingPath("color"), "Error", "The actual color was bound successfully");
	});

	QUnit.test("CriticalityThresholds aggregation binding test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			CriticalityCalculation: {
				ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},
				DeviationRangeLowValue: {Path: "DeviationRangeLow"},
				ToleranceRangeLowValue: {Path: "ToleranceRangeLow"},
				ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
				DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
			}
		};

		this.oSmartBulletMicroChart._bindValuesForCriticalityCalculation();
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds").length, 4, "The number of criticality thresholds are right");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[0].getBindingPath("value"), "DeviationRangeLow", "The deviationLow threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[0].getProperty("key"), "deviationLow", "The deviationLow threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[1].getBindingPath("value"), "DeviationRangeHigh", "The deviationHigh threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[1].getProperty("key"), "deviationHigh", "The deviationHigh threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[2].getBindingPath("value"), "ToleranceRangeLow", "The toleranceLow threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[2].getProperty("key"), "toleranceLow", "The toleranceLow threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[3].getBindingPath("value"), "ToleranceRangeHigh", "The toleranceHigh threshold was bound correctly");
		assert.strictEqual(this.oSmartBulletMicroChart.getAggregation("_criticalityThresholds")[3].getProperty("key"), "toleranceHigh", "The toleranceHigh threshold was bound correctly");
	});

	QUnit.module("SmartBulletMicroChart - check color calculation (target)", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			this.oSmartBulletMicroChart._oDataPointAnnotations = {
				CriticalityCalculation: {
					ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"}
				}
			};
			this.oActualValue = new sap.suite.ui.microchart.BulletMicroChartData();
			this.oDeviationRangeLow = new sap.ui.core.CustomData({
				key: "deviationLow",
				value : "10"
			});
			this.oToleranceRangeLow = new sap.ui.core.CustomData({
				key: "toleranceLow",
				value : "50"
			});
			this.oToleranceRangeHigh = new sap.ui.core.CustomData({
				key: "toleranceHigh",
				value : "150"
			});
			this.oDeviationRangeHigh = new sap.ui.core.CustomData({
				key: "deviationHigh",
				value : "190"
			});
			this.aThresholds = [this.oDeviationRangeLow, this.oToleranceRangeLow, this.oToleranceRangeHigh, this.oDeviationRangeHigh];
			this.oSmartBulletMicroChart.getAggregation("_chart").setAggregation("actual", this.oActualValue);
			for (var i = 0; i < this.aThresholds.length; i++) {
				this.oSmartBulletMicroChart.addAggregation("_criticalityThresholds", this.aThresholds[i], true);
			}
			sap.ui.getCore().applyChanges();
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});
	QUnit.test("Color calculation tests of the bar - target direction", function(assert) {
		this.oActualValue.setValue(20.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Critical", "The color calculation test for critical range was successful");
	});

	QUnit.test("Color calculation tests of the bar - target direction", function(assert) {
		this.oActualValue.setValue(100);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Good", "The color calculation test for good range was successful");
	});

	QUnit.test("Bar color set directly via path in criticality annotation", function(assert) {
		var oModel = new sap.ui.model.json.JSONModel({
			Criticality: "Neutral",
			Revenue: 100
		});
		this.oSmartBulletMicroChart.setModel(oModel);

		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			Criticality: {
				Path: "/Criticality"
			},
			Value: {
				Path: "/Revenue"
			}
		};

		this.oSmartBulletMicroChart._bindAggregationActual();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Neutral", "The color calculation test for neutral status was correct");

		this.oSmartBulletMicroChart.getModel().setProperty("/Criticality", "Negative", null, false);
		sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Error", "The color calculation test for negative status was correct");
	});

	QUnit.test("Check method _createAndBindInnerChart", function(assert) {
		var oModel = new sap.ui.model.json.JSONModel({
			Criticality: "Positive",
			Revenue: 100
		});
		this.oSmartBulletMicroChart.setModel(oModel);

		sinon.stub(this.oSmartBulletMicroChart, "_getDatapointQualifier").returns("BulletChartDataPoint");
		this.oSmartBulletMicroChart._oDataPointMetadata = {
			additionalAnnotations: {
				BulletChartDataPoint: {
					Criticality: {
						Path: "/Criticality"
					},
					Value: {
						Path: "/Revenue"
					}
				}
			}
		};
		sinon.stub(this.oSmartBulletMicroChart, "_getUnitOfMeasureAnnotation").returns({
			String : "Euro"
		});
		sinon.stub(this.oSmartBulletMicroChart, "_checkChartMetadata").returns(true);
		this.oSmartBulletMicroChart._createAndBindInnerChart();

		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Good", "The color for neutral status was correct");

		var oActualValue = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual");
		var iValue = oActualValue.getValue();
		assert.strictEqual(iValue, 100, "The value bound to the chart was correct");
	});

	QUnit.test("Check overwritten method bindObject", function(assert) {
		var oModel = new sap.ui.model.json.JSONModel({
			Criticality: "Critical",
			Revenue: 100
		});
		this.oSmartBulletMicroChart.setModel(oModel);

		this.oSmartBulletMicroChart._oDataPointAnnotations = {
			Criticality: {
				Path: "Criticality"
			},
			Value: {
				Path: "Revenue"
			}
		};

		this.oSmartBulletMicroChart.bindObject("/");
		this.oSmartBulletMicroChart._bindAggregationActual();

		var oActualValue = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual");
		var iValue = oActualValue.getValue();
		assert.strictEqual(iValue, 100, "The value using relative paths provided by bindObject was correct");

		var sColor = oActualValue.getColor();
		assert.strictEqual(sColor, "Critical", "The color using relative paths provided by bindObject for critical status was correct");
	});

	QUnit.module("SmartBulletMicroChart - check color calculation (minimize)", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			this.oSmartBulletMicroChart._oDataPointAnnotations = {
				CriticalityCalculation: {
					ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Minimize"}
				}
			};
			this.oActualValue = new sap.suite.ui.microchart.BulletMicroChartData();
			this.oToleranceRangeHigh = new sap.ui.core.CustomData({
				key: "toleranceHigh",
				value : "100"
			});
			this.oDeviationRangeHigh = new sap.ui.core.CustomData({
				key: "deviationHigh",
				value : "200"
			});
			this.aThresholds = [this.oDeviationRangeLow, this.oToleranceRangeLow, this.oToleranceRangeHigh, this.oDeviationRangeHigh];
			this.oSmartBulletMicroChart.getAggregation("_chart").setAggregation("actual", this.oActualValue);
			for (var i = 0; i < this.aThresholds.length; i++) {
				this.oSmartBulletMicroChart.addAggregation("_criticalityThresholds", this.aThresholds[i], true);
			}
			sap.ui.getCore().applyChanges();
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Color calculation tests of the bar - minimize direction", function(assert) {
		this.oActualValue.setValue(20.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Good", "The color calculation test for good range was successful");
	});

	QUnit.test("Color calculation tests of the bar - minimize direction", function(assert) {
		this.oActualValue.setValue(120.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Critical", "The color calculation test for critical range was successful");
	});

	QUnit.test("Color calculation tests of the bar - minimize direction", function(assert) {
		this.oActualValue.setValue(250.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Error", "The color calculation test for error range was successful");
	});

	QUnit.module("SmartBulletMicroChart - check color calculation (maximize)", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			this.oSmartBulletMicroChart._oDataPointAnnotations = {
				CriticalityCalculation: {
					ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Maximize"}
				}
			};
			this.oActualValue = new sap.suite.ui.microchart.BulletMicroChartData();
			this.oDeviationRangeLow = new sap.ui.core.CustomData({
				key: "deviationLow",
				value : "100"
			});
			this.oToleranceRangeLow = new sap.ui.core.CustomData({
				key: "toleranceLow",
				value : "200"
			});
			this.aThresholds = [this.oDeviationRangeLow, this.oToleranceRangeLow, this.oToleranceRangeHigh, this.oDeviationRangeHigh];
			this.oSmartBulletMicroChart.getAggregation("_chart").setAggregation("actual", this.oActualValue);
			for (var i = 0; i < this.aThresholds.length; i++) {
				this.oSmartBulletMicroChart.addAggregation("_criticalityThresholds", this.aThresholds[i], true);
			}
			sap.ui.getCore().applyChanges();
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Color calculation tests of the bar - maximize direction", function(assert) {
		this.oActualValue.setValue(20.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Error", "The color calculation test for error range was successful");
	});
	QUnit.test("Color calculation tests of the bar - maximize direction", function(assert) {
		this.oActualValue.setValue(120.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Critical", "The color calculation test for critical range was successful");
	});
	QUnit.test("Color calculation tests of the bar - maximize direction", function(assert) {
		this.oActualValue.setValue(250.00);
		this.oSmartBulletMicroChart._calculateBarColor();
		var sColor = this.oSmartBulletMicroChart.getAggregation("_chart").getAggregation("actual").getColor();
		assert.strictEqual(sColor, "Good", "The color calculation test for good range was successful");
	});

	QUnit.module("SmartBulletMicroChart - check chart metadata", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			this.oSmartBulletMicroChart._oChartViewMetadata = {
					annotation: {
						ChartType: {EnumMember: "com.sap.vocabularies.UI.v1.ChartType/Bullet"},
						MeasureAttributes: [{
							DataPoint: {
								AnnotationPath: "@com.sap.vocabularies.UI.v1.DataPoint#BulletChartDataPoint"
							}
						}]
					}
			};
			this.oSmartBulletMicroChart._oDataPointMetadata = {
				additionalAnnotations: {
					BulletChartDataPoint: {
						Value: {
							Path: "Revenue"
						},
						CriticalityCalculation: {
							ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},
							DeviationRangeLowValue: {Path: "DeviationRangeLow"},
							ToleranceRangeLowValue: {Path: "ToleranceRangeLow"},
							ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
							DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
						}
					}
				}
			};
			sinon.spy(jQuery.sap.log, "error");
			sinon.spy(jQuery.sap.log, "warning");
		},
		afterEach: function() {
			jQuery.sap.log.warning.restore();
			jQuery.sap.log.error.restore();
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Metadata validation test", function(assert) {
		assert.ok(this.oSmartBulletMicroChart._checkChartMetadata(), "The Metadata is valid");
	});

	QUnit.test("Chart type test", function(assert) {
		this.oSmartBulletMicroChart._oChartViewMetadata.annotation.ChartType.EnumMember = "area";
		assert.ok(!this.oSmartBulletMicroChart._checkChartMetadata(), "Chart type test is passed");
		assert.ok(jQuery.sap.log.error.calledWith("The ChartType property in the Chart annotation is not bullet."), "ERROR: The ChartType property in the Chart annotation is not bullet.");
	});

	QUnit.module("SmartBulletMicroChart - check DataPoint annotation", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			this.oSmartBulletMicroChart._oDataPointAnnotations = {
				Value: {
					Path: "Revenue"
				},
				CriticalityCalculation: {
					ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"},
					DeviationRangeLowValue: {Path: "DeviationRangeLow"},
					ToleranceRangeLowValue: {Path: "ToleranceRangeLow"},
					ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"},
					DeviationRangeHighValue: {Path: "DeviationRangeHigh"}
				}
			};
			sinon.spy(jQuery.sap.log, "error");
			sinon.spy(jQuery.sap.log, "warning");
		},
		afterEach: function() {
			jQuery.sap.log.warning.restore();
			jQuery.sap.log.error.restore();
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Actual value test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations.Value = {};
		assert.ok(!this.oSmartBulletMicroChart._checkDataPointAnnotation(), "Actual value test is passed");
		assert.ok(jQuery.sap.log.error.calledWith("The Value property does not exist in the DataPoint annotation. This property is mandentory to generate the SmartBulletChart."), "ERROR: The Value property does not exist in the DataPoint annotation. This property is mandentory to generate the SmartBulletChart.");
	});

	QUnit.test("CriticalityCalculation Test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations.CriticalityCalculation = {};
		assert.ok(this.oSmartBulletMicroChart._checkDataPointAnnotation(), "CriticalityCalculation test is passed");
		assert.ok(jQuery.sap.log.warning.calledWith("The CriticalityCalculation property in DataPoint annotation is not provided."), "WARNING: The CriticalityCalculation property in DataPoint annotation is not provided.");
	});

	QUnit.test("CriticalityCalculation For Target Test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations.CriticalityCalculation = {
			ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Target"}
		};
		assert.ok(this.oSmartBulletMicroChart._checkDataPointAnnotation(), "CriticalityCalculation for minimize direction test is passed");
		assert.ok(jQuery.sap.log.warning.calledWith("The DeviationRangeLowValue property in DataPoint annotation is missing for Target improvement direction."), "WARNING: The DeviationRangeLowValue property in DataPoint annotation is missing for 'Target' improvement direction.");
		assert.ok(jQuery.sap.log.warning.calledWith("The ToleranceRangeLowValue property in DataPoint annotation is missing for Target improvement direction."), "WARNING: The ToleranceRangeLowValue property in DataPoint annotation is missing for 'Target' improvement direction.");
		assert.ok(jQuery.sap.log.warning.calledWith("The ToleranceRangeHighValue property in DataPoint annotation is missing for Target improvement direction."), "WARNING: The ToleranceRangeHighValue property in DataPoint annotation is missing for 'Target' improvement direction.");
		assert.ok(jQuery.sap.log.warning.calledWith("The DeviationRangeHighValue property in DataPoint annotation is missing for Target improvement direction."), "WARNING: The DeviationRangeHighValue property in DataPoint annotation is missing for 'Target' improvement direction.");
	});

	QUnit.test("CriticalityCalculation For Minimize Test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations.CriticalityCalculation = {
			ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Minimize"},
			DeviationRangeLowValue: {Path: "DeviationRangeLow"},
			ToleranceRangeLowValue: {Path: "ToleranceRangeLow"}
		};
		assert.ok(this.oSmartBulletMicroChart._checkDataPointAnnotation(), "CriticalityCalculation for minimize direction test is passed");
		assert.ok(jQuery.sap.log.warning.calledWith("The ToleranceRangeHighValue property in DataPoint annotation is missing for Minimize improvement direction."), "WARNING: The ToleranceRangeHighValue property in DataPoint annotation is missing for 'Minimize' improvement direction.");
		assert.ok(jQuery.sap.log.warning.calledWith("The DeviationRangeHighValue property in DataPoint annotation is missing for Minimize improvement direction."), "WARNING: The DeviationRangeHighValue property in DataPoint annotation is missing for 'Minimize' improvement direction.");
	});

	QUnit.test("CriticalityCalculation For Maximize Test", function(assert) {
		this.oSmartBulletMicroChart._oDataPointAnnotations.CriticalityCalculation = {
			ImprovementDirection: {EnumMember: "com.sap.vocabularies.UI.v1.ImprovementDirectionType/Maximize"},
			DeviationRangeHighValue: {Path: "DeviationRangeHigh"},
			ToleranceRangeHighValue: {Path: "ToleranceRangeHigh"}
		};
		assert.ok(this.oSmartBulletMicroChart._checkDataPointAnnotation(), "CriticalityCalculation for maximize direction test is passed");
		assert.ok(jQuery.sap.log.warning.calledWith("The DeviationRangeLowValue property in DataPoint annotation is missing for Maximize improvement direction."), "WARNING: The DeviationRangeLowValue property in DataPoint annotation is missing for 'Maximize' improvement direction.");
		assert.ok(jQuery.sap.log.warning.calledWith("The ToleranceRangeLowValue property in DataPoint annotation is missing for Maximize improvement direction."), "WARNING: The ToleranceRangeLowValue property in DataPoint annotation is missing for 'Maximize' improvement direction.");
	});

	QUnit.module("SmartBulletMicroChart: ChartTitle association", {
		beforeEach: function() {
			this.sDataPointTitle = "DataPoint";
			this.sChartTitle = "Chart";
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			this.oSmartBulletMicroChart._oChartViewMetadata = {
					annotation : {
						Title: {
							String : this.sChartTitle
						}
					}
			};
			sinon.stub(this.oSmartBulletMicroChart, "_checkChartMetadata").returns(true);
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Test for wrong type of associated control", function(assert) {
		var oControl = new sap.ui.core.Control();
		sinon.spy(jQuery.sap.log, "error");
		this.oSmartBulletMicroChart.setChartTitle(oControl);
		sap.ui.getCore().applyChanges();
		ok(jQuery.sap.log.error.calledOnce, "Associated control is not of type sap.m.Label, error should have been logged");
		jQuery.sap.log.error.restore();
	});

	QUnit.test("Chart annotation is set", function(assert) {
		var oLabel = new sap.m.Label();
		this.oSmartBulletMicroChart.setChartTitle(oLabel);
		assert.equal(sap.ui.getCore().byId(this.oSmartBulletMicroChart.getChartTitle()).getProperty("text"), this.sChartTitle, "Title property of the Chart annotion should be set to the ChartTitle if there is no DataPoint Title property");
	});

	QUnit.module("SmartBulletMicroChart: ChartDescription association", {
		beforeEach: function() {
			this.sDataPointDescription = "DataPoint description";
			this.sChartDescription = "Chart description";
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			this.oSmartBulletMicroChart._oChartViewMetadata = {
					annotation : {
						Description: {
							String : this.sChartDescription
						}
					}
			};
			sinon.stub(this.oSmartBulletMicroChart, "_checkChartMetadata").returns(true);
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Test for wrong type of associated control", function(assert) {
		var oControl = new sap.ui.core.Control();
		sinon.spy(jQuery.sap.log, "error");
		this.oSmartBulletMicroChart.setChartDescription(oControl);
		sap.ui.getCore().applyChanges();
		ok(jQuery.sap.log.error.calledOnce, "Associated control is not of type sap.m.Label, error should have been logged");
		jQuery.sap.log.error.restore();
	});

	QUnit.test("Chart annotation is set", function(assert) {
		var oLabel = new sap.m.Label();
		this.oSmartBulletMicroChart.setChartDescription(oLabel);
		assert.equal(sap.ui.getCore().byId(this.oSmartBulletMicroChart.getChartDescription()).getProperty("text"), this.sChartDescription, "Description property of the Chart annotion should be set to the ChartDescription if there is no DataPoint Description property");
	});

	QUnit.module("SmartBulletMicroChart: UnitOfMeasure association", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart",
				entitySet: "Products"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			this.oSmartBulletMicroChart._oDataPointAnnotations = {
				Value: {
					Path : "Revenue"
				}
			};
			sinon.stub(this.oSmartBulletMicroChart, "_checkChartMetadata").returns(true);
		},
		afterEach: function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Test for wrong type of associated control", function(assert) {
		var oControl = new sap.ui.core.Control();
		sinon.spy(jQuery.sap.log, "error");
		this.oSmartBulletMicroChart.setUnitOfMeasure(oControl);
		ok(jQuery.sap.log.error.calledOnce, "Associated control is not of type sap.m.Label, error should have been logged");
		jQuery.sap.log.error.restore();
	});

	QUnit.test("Test for set property in _getUnitOfMeasureAnnotation", function(assert) {
		var sUnitOfMeasure = "UnitOfMeasure";
		sinon.stub(this.oSmartBulletMicroChart, "_getUnitOfMeasureAnnotation").returns({String : sUnitOfMeasure});
		this.oSmartBulletMicroChart.setUnitOfMeasure(new sap.m.Label());
		assert.equal(sap.ui.getCore().byId(this.oSmartBulletMicroChart.getUnitOfMeasure()).getProperty("text"), sUnitOfMeasure, "Text property of the UnitOfMeasure association is set correctly");
	});

	QUnit.test("Test for _getUnitOfMeasureAnnotation with ISOCurrency", function(assert) {
		var oMetaModel, sEntityTypeName;
		var oPath = {Path : "Currency"};
		var oDataProperty = { "NAMESPACE.ISOCurrency": oPath,
							name: "Revenue",
							precision: "16",
							somethingDifferent: "others",
							type: "Edm.Decimal"
		};

		sinon.stub(this.oSmartBulletMicroChart, "getModel").returns(this.oSmartBulletMicroChart.oMetaModel = new sap.ui.model.Model());
		this.oSmartBulletMicroChart._createChartProvider();
		sinon.stub(this.oSmartBulletMicroChart._oChartProvider._oMetadataAnalyser, "getEntityTypeNameFromEntitySetName").returns(sEntityTypeName = "BmcNamespace.ProductType");
		sinon.stub(this.oSmartBulletMicroChart, "_getPropertyAnnotation").returns(oDataProperty);
		this.oSmartBulletMicroChart.setUnitOfMeasure(new sap.m.Label());
		var oReturnedPath = this.oSmartBulletMicroChart._getUnitOfMeasureAnnotation();
		assert.deepEqual(oReturnedPath, oPath, "The correct path is returned");
	});

	QUnit.test("Test for _getUnitOfMeasureAnnotation with Unit", function(assert) {
		var oMetaModel, sEntityTypeName;
		var oPath = {Path : "Currency"};
		var oDataProperty = { "NAMESPACE.Unit": oPath,
							name: "Revenue",
							precision: "16",
							somethingDifferent: "others",
							type: "Edm.Decimal"
		};

		sinon.stub(this.oSmartBulletMicroChart, "getModel").returns(this.oSmartBulletMicroChart.oMetaModel = new sap.ui.model.Model());
		this.oSmartBulletMicroChart._createChartProvider();
		sinon.stub(this.oSmartBulletMicroChart._oChartProvider._oMetadataAnalyser, "getEntityTypeNameFromEntitySetName").returns(sEntityTypeName = "BmcNamespace.ProductType");
		sinon.stub(this.oSmartBulletMicroChart, "_getPropertyAnnotation").returns(oDataProperty);
		this.oSmartBulletMicroChart.setUnitOfMeasure(new sap.m.Label());
		var oReturnedPath = this.oSmartBulletMicroChart._getUnitOfMeasureAnnotation();
		assert.deepEqual(oReturnedPath, oPath, "The correct path is returned");
	});

	QUnit.module("SmartBulletMicroChart: localizable associations", {
		beforeEach: function() {
			this.oSBMC = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				id: "smart-bullet-microchart",
				entitySet: "Products"
			}).placeAt("qunit-fixture");
			sap.ui.getCore().applyChanges();
			//simulate i18n model
			this.oSBMC.setModel(new sap.ui.model.Model());
			this.oSBMC.setModel(new sap.ui.model.json.JSONModel({
				MY_TITLE_KEY: "This is a title",
				MY_DESP_KEY: "This is a description",
				MY_UNIT_KEY: "Yen"
			}), "i18n");
			this.oSBMC._oDataPointAnnotations = {
				Value: {
					Path: "Product"
				}
			};
			this.oSBMC._oChartViewMetadata = {
				annotation : {
					Title: {
						String : "{i18n>MY_TITLE_KEY}"
					},
					Description: {
						String : "{i18n>MY_DESP_KEY}"
					}
				}
			};
			sinon.stub(this.oSBMC, "_checkChartMetadata").returns(true);
		},
		afterEach: function() {
			this.oSBMC.destroy();
			this.oSBMC = null;
		}
	});

	QUnit.test("ChartTitle Association", function(assert) {
		//Arrange
		var oLabel = new sap.m.Label({ text: "DefaultText" });
		sinon.spy(oLabel, "invalidate");
		oLabel.setModel(this.oSBMC.getModel("i18n"), "i18n");
		oLabel.bindElement("i18n>/");

		//Act
		this.oSBMC.setChartTitle(oLabel);

		//Assert
		assert.equal(oLabel.getBinding("text").getPath(), "MY_TITLE_KEY", "Correct binding path.");
		assert.equal(oLabel.getText(), "This is a title", "Correct text.");
		assert.ok(oLabel.invalidate.calledOnce, "In case of non OData Model it is needed to call invalidate on the label instance");
	});

	QUnit.test("ChartDescription Association", function(assert) {
		//Arrange
		var oLabel = new sap.m.Label({ text: "DefaultText" });
		sinon.spy(oLabel, "invalidate");
		oLabel.setModel(this.oSBMC.getModel("i18n"), "i18n");
		oLabel.bindElement("i18n>/");

		//Act
		this.oSBMC.setChartDescription(oLabel);

		//Assert
		assert.equal(oLabel.getBinding("text").getPath(), "MY_DESP_KEY", "Correct binding path.");
		assert.equal(oLabel.getText(), "This is a description", "Correct text.");
		assert.ok(oLabel.invalidate.calledOnce, "In case of non OData Model it is needed to call invalidate on the label instance");
	});
	QUnit.test("UnitOfMeasure Association", function(assert) {
		//Arrange
		var oMetaModel, sEntityTypeName;
		var oDataProperty = {
			"NAMESPACE.ISOCurrency": {
				String: "{i18n>MY_UNIT_KEY}"
			},
			name: "Revenue",
			precision: "16",
			somethingDifferent: "others",
			type: "Edm.Decimal"
		};
		var oLabel = new sap.m.Label({ text: "DefaultText" });
		sinon.spy(oLabel, "invalidate");
		oLabel.setModel(this.oSBMC.getModel("i18n"), "i18n");
		oLabel.bindElement("i18n>/");

		sinon.stub(this.oSBMC, "getModel").returns(this.oSBMC.oMetaModel = new sap.ui.model.Model());
		this.oSBMC._createChartProvider();
		sinon.stub(this.oSBMC._oChartProvider._oMetadataAnalyser, "getEntityTypeNameFromEntitySetName").returns(sEntityTypeName = "BmcNamespace.ProductType");
		sinon.stub(this.oSBMC, "_getPropertyAnnotation").returns(oDataProperty);

		//Act
		this.oSBMC.setUnitOfMeasure(oLabel);

		//Assert
		assert.equal(oLabel.getBinding("text").getPath(), "MY_UNIT_KEY", "Correct binding path.");
		assert.equal(oLabel.getText(), "Yen", "Correct text.");
		assert.ok(oLabel.invalidate.calledOnce, "In case of non OData Model it is needed to call invalidate on the label instance");
	});

	QUnit.module("Passing parent context to the child in case of using responsiveness for annotated charts", {
		beforeEach : function() {
			this.oSmartBulletMicroChart = new sap.ui.comp.smartmicrochart.SmartBulletMicroChart({
				isResponsive: true
			});
		},
		afterEach : function() {
			this.oSmartBulletMicroChart.destroy();
		}
	});

	QUnit.test("Passing parent context from SmartBulletMicroChart", function(assert) {
		//Arrange
		sinon.spy(sap.suite.ui.microchart, "_passParentContextToChild");
		//Act
		this.oSmartBulletMicroChart.onBeforeRendering();
		//Assert
		assert.ok(sap.suite.ui.microchart._passParentContextToChild.calledOnce, "The function that passes parent rendering context to the child has been called.");
	});

	QUnit.module("Criticallity mapping", {
		beforeEach: function() {
			this.oSmartBulletMicroChart = sap.ui.comp.smartmicrochart.SmartBulletMicroChart;
		}
	});

	QUnit.test("Criticallity as direct String like 'Positive'", function (assert) {
		var sResult;
		sResult = this.oSmartBulletMicroChart._mapCriticalityTypeWithColor("Positive");
		assert.deepEqual(sResult, "Good", "Positive mapped correctly to 'Good'");
	});

	QUnit.test("Criticallity as String like 'com.sap.vocabularies.UI.v1.CriticalityType/Positive'", function (assert) {
		var sResult;
		sResult = this.oSmartBulletMicroChart._mapCriticalityTypeWithColor("com.sap.vocabularies.UI.v1.CriticalityType/Positive");
		assert.deepEqual(sResult, "Good", "'com.sap.vocabularies.UI.v1.CriticalityType/Positive' mapped correctly to 'Good'");
	});

	QUnit.test("Criticallity as int value passed as String like '3' for Positive", function (assert) {
		var sResult;
		sResult = this.oSmartBulletMicroChart._mapCriticalityTypeWithColor("3");
		assert.deepEqual(sResult, "Good", "'3' mapped correctly to 'Good'");
	});

	QUnit.test("Criticallity as int value like 3 for Positive", function (assert) {
		var sResult;
		sResult = this.oSmartBulletMicroChart._mapCriticalityTypeWithColor(3);
		assert.deepEqual(sResult, "Good", "'3' mapped correctly to 'Good'");
	});
}());
</script>
</head>
<body id="body" class="sapUiBody">
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
</body>
</html>
