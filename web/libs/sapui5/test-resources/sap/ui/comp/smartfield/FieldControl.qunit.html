
<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>qUnit Page for sap.ui.comp.smartfield.MetaData</title>

		<script id="sap-ui-bootstrap"
			type="text/javascript"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.ui.comp">
		</script>

		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css"	type="text/css" media="screen" />
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

		<script type="text/javascript" src="data/ComplexTestModel.data.js"></script>
		<script type="text/javascript" src="data/TestModel.data.js"></script>

		<script type="text/javascript">
		if (!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
			jQuery.sap.require("sap.ui.qunit.qunit-coverage");
		}

		(function() {
			jQuery.sap.require("sap.ui.comp.smartfield.AnnotationHelper");
			jQuery.sap.require("sap.ui.comp.smartfield.FieldControl");
			jQuery.sap.require("sap.ui.comp.smartfield.ODataHelper");
			jQuery.sap.require("sap.ui.model.odata.ODataModel");
			jQuery.sap.require("sap.ui.comp.smartfield.ODataControlFactory");


			QUnit.module("sap.ui.comp.smartfield.FieldControl", {
				beforeEach: function() {
					var oParent = {
						getEditable : function() {
							return true;
						},
						getUomEditable : function() {
							return true;
						},
						getVisible : function() {
							return true;
						},
						getMandatory : function() {
							return true;
						},
						getBindingInfo : function() {
							return null;
						},
						getBindingContext : function() {
							return {
								getObject : function() {
									return null;
								}
							};
						},
						unbindProperty: function() {

						},
						isBound: function() {
							return true;
						},
						bindProperty: function() {

						},
						data : function() {
							return null;
						},
						getControlProposal : function() {
							return null;
						},
						getClientSideMandatoryCheck: function() {
							return true;
						}
					};
					function getObject1(oModel, sArrayName, sQualifiedName, bAsPath) {
						var vResult = bAsPath ? undefined : null,
							iSeparatorPos,
							sNamespace,
							sName;

						sQualifiedName = sQualifiedName || "";
						iSeparatorPos = sQualifiedName.lastIndexOf(".");
						sNamespace = sQualifiedName.slice(0, iSeparatorPos);
						sName = sQualifiedName.slice(iSeparatorPos + 1);
						jQuery.each(oModel.getObject("/dataServices/schema") || [], function (i, oSchema) {
							if (oSchema.namespace === sNamespace) {
								jQuery.each(oSchema[sArrayName] || [], function (j, oThing) {
									if (oThing.name === sName) {
										vResult = bAsPath ? oThing.$path : oThing;
										return false; // break
									}
								});
								return false; // break
							}
						});

						return vResult;
					};
					function findIndex(aArray, vExpectedPropertyValue, sPropertyName) {
						var iIndex = -1;

						sPropertyName = sPropertyName || "name";
						jQuery.each(aArray || [], function (i, oObject) {
							if (oObject[sPropertyName] === vExpectedPropertyValue) {
								iIndex = i;
								return false; // break
							}
						});

						return iIndex;
					};
					this.oModel = sinon.createStubInstance(sap.ui.model.odata.ODataModel);
					this.oModel.getServiceMetadata = function() {
						return oTestModel;
					};
					this.oModel.getMetaModel = function() {
						var oStub = sinon.createStubInstance(sap.ui.model.odata.ODataMetaModel);
						oStub.oModel = new sap.ui.model.json.JSONModel(oTestModel);
						oStub.oData = oTestModel;
						oStub.getObject = function(sPath) {
							var oNode, aParts = sPath.split("/"), iIndex = 0;
							if (!aParts[0]) {
								// absolute path starting with slash
								oNode = this.oData;
								iIndex++;
							}
							while (oNode && aParts[iIndex]) {
								oNode = oNode[aParts[iIndex]];
								iIndex++;
							}
							return oNode;
						};
						oStub.getODataEntityContainer = function(bAsPath) {
							var vResult = bAsPath ? undefined : null;

							jQuery.each(this.oModel.getObject("/dataServices/schema") || [], function (i, oSchema) {
								var j = findIndex(oSchema.entityContainer, "true", "isDefaultEntityContainer");

								if (j >= 0) {
									vResult = bAsPath
										? "/dataServices/schema/" + i + "/entityContainer/" + j
										: oSchema.entityContainer[j];
									return false; //break
								}
							});

							return vResult;
					    };
					    oStub.getODataEntitySet = function(sName, bAsPath) {
							var k,
							oEntityContainer = this.getODataEntityContainer(),
							vResult = bAsPath ? undefined : null;

							if (oEntityContainer) {
								k = findIndex(oEntityContainer.entitySet, sName);
								if (k >= 0) {
									vResult = bAsPath
										? oEntityContainer.$path + "/entitySet/" + k
										: oEntityContainer.entitySet[k];
								}
							}

							return vResult;
					    };
					    oStub.getODataEntityType = function (sQualifiedName, bAsPath) {
							return getObject1(this.oModel, "entityType", sQualifiedName, bAsPath);
						    };
						oStub.getODataProperty = function (oType, vName, bAsPath) {
							var i,
							aParts = jQuery.isArray(vName) ? vName : [vName],
							oProperty = null,
							sPropertyPath;

							while (oType && aParts.length) {
								i = findIndex(oType.property, aParts[0]);
								if (i < 0) {
									break;
								}

								aParts.shift();
								oProperty = oType.property[i];
								sPropertyPath = oType.$path + "/property/" + i;

								if (aParts.length) {
									// go to complex type in order to allow drill-down
									oType = this.getODataComplexType(oProperty.type);
								}
							}

							return bAsPath ? sPropertyPath : oProperty;
						};
						oStub.getODataComplexType = function (sQualifiedName, bAsPath) {
							return getObject1(this.oModel, "complexType", sQualifiedName, bAsPath);
						};
						return oStub;
					};

					this.oHelper = new sap.ui.comp.smartfield.ODataHelper(this.oModel);
					this.oMetaData = new sap.ui.comp.smartfield.FieldControl(oParent, this.oHelper);
				},
				afterEach: function() {
					this.oMetaData.destroy();
				}
			});

			QUnit.test("Shall be instantiable", function() {
				assert.ok(this.oMetaData);
			});

			QUnit.test("getControlProperties", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
					entitySet: oSet,
					entityType: oType,
					path: "StartDateTime"
				};
				this.oHelper.getProperty(oMeta);
				oResult = this.oMetaData.getControlProperties(oMeta, [ "editable" ]);

				assert.equal(!oResult.editable, false);
			});

			QUnit.test("getControlAttributes - invalid input", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				oResult = this.oMetaData.getControlProperties(oMeta);

				assert.equal(!oResult, false);
			});

			QUnit.test("getControlAttributes - invalid attribute", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				oResult = this.oMetaData.getControlProperties(oMeta, [ "invalid" ]);

				assert.equal(!oResult, false);
			});

			QUnit.test("_getMandatory - no meta data", function() {
				var oResult = this.oMetaData._getMandatory({});
				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter("fieldContent"), true);
			});

			QUnit.test("_getMandatory - static prop (default false)", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				this.oMetaData._oParent.getMandatory = function() {
					return false;
				};

				oResult = this.oMetaData._getMandatory(oMeta);
				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter('fieldContent'), false);
			});

			QUnit.test("_getMandatory - field-control prop without binding info", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getMandatory(oMeta);
				assert.equal(oResult.path()[0], "Description_FC");
				assert.equal(oResult.formatter('fieldContent', 7), true);
			});

			QUnit.test("_getMandatory - field-control prop with binding info", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getMandatory(oMeta, {
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});
				assert.equal(oResult.path()[0], "Description_FC");
				assert.equal(oResult.formatter('fieldContent', 7), true);
			});

			QUnit.test("_getMandatory - field-control prop with binding info and formatter", function() {
				var oSet, oType, oProperty, oResult, bFormat = false, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};

				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getMandatory(oMeta, {
					parts : [{
						model : "json",
						path : "/Description"
					}],
					formatter : function() {
						bFormat = true;
						return true;
					}
				});

				assert.equal(oResult.path()[0], "Description_FC");
				assert.equal(oResult.formatter('fieldContent', 7), true);
				assert.ok(bFormat);
			});

			QUnit.test("_getMandatory - nullable false", function() {
				var oProperty, oResult;

				oProperty = {
				         	"property": {
				        		"name": "Description",
				        		"type": "Edm.String",
				        		"nullable": "false",
				        		"maxLength": "80",
				        		"extensions": [	{
				        			"name": "sortable",
				        			"value": "false",
				        			"namespace": "http://www.sap.com/Protocols/SAPData"
				        		},
				        		{
				        			"name": "filterable",
				        			"value": "false",
				        			"namespace": "http://www.sap.com/Protocols/SAPData"
				        		}]
				        	},
				        	"typePath": "Description"
				        };

				oResult = this.oMetaData._getMandatory({ property : oProperty });

				assert.equal(oResult.formatter("fieldContent"), true);
				assert.equal(oResult.path()[0], "");
			});

			QUnit.test("_getVisible - returns default, which is true", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};

				this.oHelper.getProperty(oMeta);
				oResult = this.oMetaData._getVisible(oMeta);

				assert.equal(oResult.path()[0], "Description_FC");
				assert.equal(oResult.formatter("fieldContent"), true);
			});

			QUnit.test("_getVisible - no meta data", function() {
				var oResult = this.oMetaData._getVisible({});

				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter("fieldContent"), true);
			});

			QUnit.test("_getVisible - binding info with formatter", function() {
				var oSet, oType, oProperty, oResult, oBindingInfo, bFormat = false, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};

				this.oHelper.getProperty(oMeta);
				oBindingInfo = {
					formatter : function() {
						bFormat = true;
						return true;
					},
					parts : [ {
						path: "mockPath"
					} ]
				};

				oResult = this.oMetaData._getVisible(oMeta, oBindingInfo);

				assert.equal(oResult.path()[1], "mockPath");
				assert.equal(oResult.formatter("fieldContent"), true);
				assert.ok(bFormat);
			});

			QUnit.test("_getVisible - field-control prop", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};
				oProperty = this.oHelper.getProperty(oMeta);
				oResult = this.oMetaData._getVisible(oMeta);

				assert.equal(oResult.path()[0], "Description_FC");
				assert.equal(oResult.formatter("fieldContent"), true);
			});

			QUnit.test("_getVisible - returns static prop and visible from parent", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Released"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:visible"] = "false";

				oResult = this.oMetaData._getVisible(oMeta);
				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter("fieldContent"), false);
			});

			QUnit.test("_getVisible - static true overwritten by smart field", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Released"
						};

				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:visible"] = "true";
				this.oMetaData._oParent.getVisible = function() {
					return false;
				};

				oResult = this.oMetaData._getVisible(oMeta);
				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter("fieldContent"), false);
			});

			QUnit.test("_getVisible - static true overwritten by smart field", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Released"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:visible"] = "true";
				this.oMetaData._oParent.getVisible = function() {
					return false;
				};

				oResult = this.oMetaData._getVisible(oMeta);
				assert.equal(oResult.path()[0], "");
				assert.equal(oResult.formatter("fieldContent"), false);
			});

			QUnit.test("_getVisible - returns static prop and visible from binding", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Released"
						};

				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:visible"] = "false";
				oResult = this.oMetaData._getVisible(oMeta, {
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});
				assert.equal(oResult.path()[0], "json>/Description");
				assert.equal(oResult.formatter("fieldContent"), false);
			});

			QUnit.test("_getEditable - without meta data", function() {
				var oResult = this.oMetaData._getEditable({});

				assert.equal(oResult.path()[0] === "", true);
				assert.equal(oResult.formatter("fieldContent"), true);
			});

			// BCP: 1770393565
			QUnit.test("the formatter function of the editable property should return the default property value", function(assert) {

				// arrange
				var oSmartField = new sap.ui.comp.smartfield.SmartField({
					editable: true // default
				});

				// notice that the binding context is undefined
				this.stub(oSmartField, "getBindingContext").withArgs().returns(undefined);
				var oFieldControl = new sap.ui.comp.smartfield.FieldControl(oSmartField, this.oHelper);
				var oResult = oFieldControl._getEditable({}, undefined, undefined);

				// act
				var vEditable = oResult.formatter.call(oSmartField, null);

				// assert
				assert.strictEqual(vEditable, null);
			});

			QUnit.test("_getEditable - from /Project(id1='71' id2='abcd')/EntityUpdatable_FC", function() {
				var oSet, oType, oProperty, oResult, oMetaData, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};

				this.oHelper.getProperty(oMeta);
				oMetaData = {
					entity : oType,
					entitySet : oSet,
					property : oMeta.property
				};

				oResult = this.oMetaData._getEditable(oMetaData);

				assert.equal(oResult.path().length === 2, true);
				assert.equal(oResult.formatter('fieldContent', true), true);
			});

			QUnit.test("_getEditable - static value from updatable attribute on property", function() {
				var oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "EntityUpdatable_FC"
						};

				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:updatable"] = "false";
				oResult = this.oMetaData._getEditable(oMeta);

				assert.equal(oResult.path()[0], "EntityUpdatable_FC");
				assert.equal(oResult.formatter('fieldContent', 7, false), false);
			});

			QUnit.test("_getEditable - 'field-control' and 'updatable-path' attributes (without binding info)", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getEditable(oMeta);

				aPaths = oResult.path();
				assert.equal(oResult.formatter(1, true), false);
				assert.equal(aPaths[0], "Description_FC");
				assert.equal(aPaths[1], "EntityUpdatable_FC");
			});

			QUnit.test("_getEditable - 'field-control' and 'updatable-path' attributes (with binding info)", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};

				oProperty = this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getEditable(oMeta, {
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});

				aPaths = oResult.path();
				assert.equal(oResult.formatter(1, true, ""), false);
				assert.equal(aPaths[0], "Description_FC");
				assert.equal(aPaths[1], "EntityUpdatable_FC");
				assert.equal(aPaths[2], "json>/Description");
			});

			QUnit.test("_getEditable - 'field-control', but no 'updatable-path' attributes (without binding info)", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    	"extensions": [{
				    		"name": "pageable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "addressable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "content-version",
				    		"value": "1",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	}]
				    };
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};
				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";

				oResult = this.oMetaData._getEditable(oMeta);
				aPaths = oResult.path();
				assert.equal(oResult.formatter(), true);
				assert.equal(aPaths[0], "Description_FC");
				assert.equal(aPaths.length, 1);
			});

			QUnit.test("_getEditable - 'field-control', but no 'updatable-path' attributes (with binding info)", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    	"extensions": [{
				    		"name": "pageable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "addressable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "content-version",
				    		"value": "1",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	}]
				    };
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Description"
						};

				this.oHelper.getProperty(oMeta);
				oMeta.property.property["sap:field-control"] = "Description_FC";
				oResult = this.oMetaData._getEditable(oMeta, {
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});

				aPaths = oResult.path();
				assert.equal(oResult.formatter( 1, ""), false);
				assert.equal(aPaths[0], "Description_FC");
				assert.equal(aPaths[1], "json>/Description");
				assert.equal(aPaths.length, 2);
			});

			QUnit.test("_getEditable - 'updatable-path' from entity set attribute", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Amount"
						};
				this.oHelper.getProperty(oMeta);

				oResult = this.oMetaData._getEditable(oMeta);

				aPaths = oResult.path();
				assert.equal(oResult.formatter(true), true);
				assert.equal(aPaths[0], "EntityUpdatable_FC");
				assert.equal(aPaths.length, 1);
			});

			QUnit.test("_getEditable - with/out additional binding expression", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Amount"
						};
				this.oHelper.getProperty(oMeta);

				oResult = this.oMetaData._getEditable(oMeta,
				{
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});

				aPaths = oResult.path();
				assert.equal(oResult.formatter(7, false), false);
				assert.equal(aPaths[0], "EntityUpdatable_FC");
				assert.equal(aPaths[1], "json>/Description");
				assert.equal(aPaths.length, 2);

				//same function without binding info
				oResult = this.oMetaData._getEditable({ entitySet : oSet, property : oProperty });
				aPaths = oResult.path();
				assert.equal(oResult.formatter(7, false), true);
			});

			QUnit.test("_getEditable - static false from entity set", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    	"extensions": [{
				    		"name": "pageable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "addressable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "content-version",
				    		"value": "1",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "updatable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	}]
				    };
				oSet["sap:updatable"] = "false";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Amount"
						};
				this.oHelper.getProperty(oMeta);

				oResult = this.oMetaData._getEditable(oMeta,
				{
					parts : [{
						model : "json",
						path : "/Description"
					}]
				});

				aPaths = oResult.path();
				assert.equal(oResult.formatter(7, false), false);
				assert.equal(aPaths[0], "json>/Description");
			});

			QUnit.test("_getEditable - false taken create property at entity set based on v2 notation", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    	"extensions": [{
				    		"name": "pageable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "addressable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "content-version",
				    		"value": "1",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "updatable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	}]
				    };

				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Amount"
						};
				this.oHelper.getProperty(oMeta);

				oResult = this.oMetaData._getEditable(oMeta);

				this.oMetaData._oParent.getBindingContext = function() {
					return {
						getObject : function() {
							return { __metadata : {
								created: true
								}
							};
						}
					};
				};

				aPaths = oResult.path();
				assert.equal(oResult.formatter(), true);
				assert.equal(aPaths[0], "");
			});
/*
			QUnit.test("_getEnabled - false taken from create property based on v4 notation", function() {
				var aPaths, oSet, oType, oProperty, oResult;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    };
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oProperty = this.oHelper.getProperty("Amount", oType);
				oProperty.property['Org.OData.Core.V1.Computed'] = {
					'Bool' : true
				};
				oMetaData = {
								entity : oType,
								entitySet : oSet,
								property : oProperty
							};

				oResult = this.oMetaData._getEnabled(oMetaData);

				this.oMetaData._oParent.getBindingContext = function() {
					getObject = function() {
						return { __metadata : {
							created: true
							}
						};
					};
				};

				aPaths = oResult.path();
				assert.equal(oResult.formatter('fieldContent'), false);
				assert.equal(aPaths[0], "");
			});
*/
			QUnit.test("_getEditable - true taken from parent ", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta;

				oSet = {
				    	"name": "Project",
				    	"entityType": "ZMEY_SRV.Project_Type",
				    	"extensions": [{
				    		"name": "pageable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "addressable",
				    		"value": "false",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "content-version",
				    		"value": "1",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	},
				    	{
				    		"name": "updatable",
				    		"value": "true",
				    		"namespace": "http://www.sap.com/Protocols/SAPData"
				    	}]
				    };
				oSet["sap:updatable"] = "true";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "Amount"
						};
				this.oHelper.getProperty(oMeta);

				oResult = this.oMetaData._getEditable(oMeta);
				aPaths = oResult.path();
				assert.equal(oResult.formatter('fieldContent'), true);
				assert.equal(aPaths.length, 1);
			});

			QUnit.test("_getEditable - only binding info", function() {
				var oSet, oType, oProperty, oResult, oMetaData, aPaths, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};

				this.oHelper.getProperty(oMeta);
				oMetaData = {
					entity : oType,
					entitySet : oSet,
					property : oMeta.property
				};

				oResult = this.oMetaData._getEditable(oMetaData, {});
				aPaths = oResult.path();
				assert.equal(!oResult.formatter('fieldContent'), true);
			});

			QUnit.test("_getEditable - binding info with formatter", function() {
				var oSet, oType, oProperty, oResult, oMetaData, aPaths, oBindingInfo, bFormat = false, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				oMetaData = {
					entity : oType,
					entitySet : oSet,
					property : oMeta.property
				};
				oBindingInfo = {
				    formatter : function() {
				    	bFormat = true;
				    	return true;
				    }
				};

				oResult = this.oMetaData._getEditable(oMetaData, oBindingInfo);
				aPaths = oResult.path();
				assert.equal(!oResult.formatter(), true);
				assert.ok(bFormat);
			});

			QUnit.test("_getEditable - default return value is true", function() {
				var oSet, oType, oProperty, oResult, oMetaData, oMeta;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta = {
							entitySet: oSet,
							entityType: oType,
							path: "StartDateTime"
						};
				this.oHelper.getProperty(oMeta);
				oMetaData = {
					entity : oType,
					entitySet : oSet,
					property : oMeta.property
				};

				oResult = this.oMetaData._getEditable(oMetaData);
				assert.equal(oResult.formatter('fieldContent'), true);
			});

			QUnit.test("field control with complex type (Unit of Measure)", function() {
				var oFactory, oControl, oParent, oModel, oFieldControl, aPaths;
				function findIndex(aArray, vExpectedPropertyValue, sPropertyName) {
					var iIndex = -1;

					sPropertyName = sPropertyName || "name";
					jQuery.each(aArray || [], function (i, oObject) {
						if (oObject[sPropertyName] === vExpectedPropertyValue) {
							iIndex = i;
							return false; // break
						}
					});

					return iIndex;
				};
				function getObject1(oModel, sArrayName, sQualifiedName, bAsPath) {
					var vResult = bAsPath ? undefined : null,
						iSeparatorPos,
						sNamespace,
						sName;

					sQualifiedName = sQualifiedName || "";
					iSeparatorPos = sQualifiedName.lastIndexOf(".");
					sNamespace = sQualifiedName.slice(0, iSeparatorPos);
					sName = sQualifiedName.slice(iSeparatorPos + 1);
					jQuery.each(oModel.getObject("/dataServices/schema") || [], function (i, oSchema) {
						if (oSchema.namespace === sNamespace) {
							jQuery.each(oSchema[sArrayName] || [], function (j, oThing) {
								if (oThing.name === sName) {
									vResult = bAsPath ? oThing.$path : oThing;
									return false; // break
								}
							});
							return false; // break
						}
					});

					return vResult;
				};
				oParent = {
							getBindingContext : function() {
								return {
									sPath : "/FinsPostingPaymentHeaders(TmpId='3HLDC27520',TmpIdType='T')"
								};
							},
							getModel : function() {
								return this.oModel;
							},
							getBindingInfo : function() {
								return {
									"parts" : [{
										model : undefined,
										path : "ID"
									}]
								};
							},
							bindProperty : function() {

							},
							unbindProperty : function() {

							},
							getEditable : function() {
								return true;
							},
							getEnabled : function() {
								return true;
							},
							getVisible : function() {
								return true;
							},
							getMandatory : function() {
								return true;
							},
							getWidth : function() {
								return "100%";
							},
							getTextAlign : function() {
								return null;
							},
							getPlaceholder : function() {
								return null;
							},
							getName : function() {
								return null;
							},
							data : function() {
								return null;
							},
							getObjectBinding: function() {
								return null;
							},
							fireInitialise: function() {}
						};
				oModel = sinon.createStubInstance(sap.ui.model.odata.ODataModel);
				oModel.getServiceMetadata = function() {
					return oComplexTestModel;
				};
				oModel.getMetaModel = function() {
					var oStub = sinon.createStubInstance(sap.ui.model.odata.ODataMetaModel);
					oStub.oModel = new sap.ui.model.json.JSONModel(oComplexTestModel);
					oStub.oData = oComplexTestModel;
					oStub.getObject = function(sPath) {
						var oNode, aParts = sPath.split("/"), iIndex = 0;
						if (!aParts[0]) {
							// absolute path starting with slash
							oNode = this.oData;
							iIndex++;
						}
						while (oNode && aParts[iIndex]) {
							oNode = oNode[aParts[iIndex]];
							iIndex++;
						}
						return oNode;
					};
					oStub.getODataEntityContainer = function(bAsPath) {
						var vResult = bAsPath ? undefined : null;

						jQuery.each(this.oModel.getObject("/dataServices/schema") || [], function (i, oSchema) {
							var j = findIndex(oSchema.entityContainer, "true", "isDefaultEntityContainer");

							if (j >= 0) {
								vResult = bAsPath
									? "/dataServices/schema/" + i + "/entityContainer/" + j
									: oSchema.entityContainer[j];
								return false; //break
							}
						});

						return vResult;
				    };
				    oStub.getODataEntitySet = function(sName, bAsPath) {
						var k,
						oEntityContainer = this.getODataEntityContainer(),
						vResult = bAsPath ? undefined : null;

						if (oEntityContainer) {
							k = findIndex(oEntityContainer.entitySet, sName);
							if (k >= 0) {
								vResult = bAsPath
									? oEntityContainer.$path + "/entitySet/" + k
									: oEntityContainer.entitySet[k];
							}
						}

						return vResult;
				    };
				    oStub.getODataEntityType = function (sQualifiedName, bAsPath) {
						return getObject1(this.oModel, "entityType", sQualifiedName, bAsPath);
					    };
					oStub.getODataProperty = function (oType, vName, bAsPath) {
						var i,
						aParts = jQuery.isArray(vName) ? vName : [vName],
						oProperty = null,
						sPropertyPath;

						while (oType && aParts.length) {
							i = findIndex(oType.property, aParts[0]);
							if (i < 0) {
								break;
							}

							aParts.shift();
							oProperty = oType.property[i];
							sPropertyPath = oType.$path + "/property/" + i;

							if (aParts.length) {
								// go to complex type in order to allow drill-down
								oType = this.getODataComplexType(oProperty.type);
							}
						}

						return bAsPath ? sPropertyPath : oProperty;
					};
					oStub.getODataComplexType = function (sQualifiedName, bAsPath) {
						return getObject1(this.oModel, "complexType", sQualifiedName, bAsPath);
					};
					oStub.loaded = function() {
						return {
							then: function(fFunc) {
								fFunc();
							}
						}
					};
					return oStub;
				};

				oFactory = new sap.ui.comp.smartfield.ODataControlFactory(oModel, oParent, {
					entitySet : "FinsPostingPaymentHeaders",
					path: "Payment/AmountInCoCodeCrcy"
				});

				oFactory._oModel.oMetadata = {
					          					bLoaded : true
					          				};
				oFactory.bind();
				oFactory._oMetaData.property.property["sap:field-control"] = "UxFcAmountInCoCodeCrcy";

				oFieldControl = oFactory._oFieldControl._getEditable(oFactory._oMetaData);
				aPaths = oFieldControl.path();
				assert.equal(aPaths[0], "Payment/UxFcAmountInCoCodeCrcy");

				oFieldControl = oFactory._oFieldControl._getMandatory(oFactory._oMetaData);
				aPaths = oFieldControl.path();
				assert.equal(aPaths[0], "Payment/UxFcAmountInCoCodeCrcy");

				oFieldControl = oFactory._oFieldControl._getVisible(oFactory._oMetaData);
				aPaths = oFieldControl.path();
				assert.equal(aPaths[0], "Payment/UxFcAmountInCoCodeCrcy");

				oFactory.destroy();
			});

			QUnit.test("_toPath", function() {
				var sPath, oMetaData =  {
					path: "Payment/AmountInCoCodeCrcy",
				    property: {
				    	complex: true,
				        property: {
				        	name: "AmountInCoCodeCrcy"
				         }
				    }
				};

				sPath = this.oMetaData._toPath(oMetaData, "UxFcAmountInCoCodeCrcy");
				assert.equal(sPath, "Payment/UxFcAmountInCoCodeCrcy");

				oMetaData.property.complex = false;
				sPath = this.oMetaData._toPath(oMetaData, "UxFcAmountInCoCodeCrcy");
				assert.equal(sPath, "UxFcAmountInCoCodeCrcy");
			});

			QUnit.test("getMandatoryCheck - invalid input", function() {
				var oResult;

				oResult = this.oMetaData.getMandatoryCheck();
				assert.equal(!oResult, true);
			});


			QUnit.test("getMandatoryCheck - mandatory for Edm.String, client check", function() {
				var oProp, oResult, bExc = false;
				oProp = JSON.parse("{\"property\":{\"name\":\"Description\",\"type\":\"Edm.String\",\"nullable\":\"false\",\"maxLength\":\"80\",\"extensions\":[{\"name\":\"field-control\",\"value\":\"Description_FC\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"sortable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"filterable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"}]},\"typePath\":\"Description\",\"extensions\":{\"sap:filterable\":\"false\",\"sap:sortable\":\"false\",\"sap:field-control\":\"Description_FC\"}}");

				oResult = this.oMetaData.getMandatoryCheck(oProp);
				assert.equal(!!oResult, true);

				try {
					oResult();
				} catch(ex) {
					bExc = true;
				}
				assert.equal(bExc, true);
			});

			QUnit.test("getMandatoryCheck - mandatory for Edm.String, server check", function() {
				var oProp, oResult, bExc = false;
				oProp = JSON.parse("{\"property\":{\"name\":\"Description\",\"type\":\"Edm.String\",\"nullable\":\"false\",\"maxLength\":\"80\",\"extensions\":[{\"name\":\"field-control\",\"value\":\"Description_FC\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"sortable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"filterable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"}]},\"typePath\":\"Description\",\"extensions\":{\"sap:filterable\":\"false\",\"sap:sortable\":\"false\",\"sap:field-control\":\"Description_FC\"}}");

				sinon.stub(this.oMetaData._oParent, "getClientSideMandatoryCheck").returns(false);

				oResult = this.oMetaData.getMandatoryCheck(oProp);
				assert.equal(!!oResult, true);

				try {
					oResult();
				} catch(ex) {
					bExc = true;
				}
				assert.equal(bExc, false);
			});


			QUnit.test("getMandatoryCheck - mandatory for Edm.Decimal, client side check", function() {
				var oProp, oResult, bExc = false;
				oProp = JSON.parse("{\"property\":{\"name\":\"Amount\",\"type\":\"Edm.Decimal\",\"nullable\":\"false\",\"precision\":\"11\",\"scale\":\"2\",\"documentation\":[{\"text\":null,\"extensions\":[{\"name\":\"Summary\",\"value\":\"Preis fÃ¼r externe Verarbeitung.\",\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"},{\"name\":\"LongDescription\",\"value\":null,\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"}]}],\"extensions\":[{\"name\":\"unit\",\"value\":\"AmountCurrency\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"label\",\"value\":\"Preis\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"sortable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"filterable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"}]},\"typePath\":\"Amount\",\"extensions\":{\"sap:filterable\":\"false\",\"sap:sortable\":\"false\",\"sap:label\":\"Preis\",\"sap:unit\":\"AmountCurrency\"}}");

				oResult = this.oMetaData.getMandatoryCheck(oProp);
				assert.equal(!!oResult, true);
				try {
					oResult();
				} catch(ex) {
					bExc = true;
				}
				assert.equal(bExc, true);
			});


			QUnit.test("getMandatoryCheck - mandatory for Edm.Decimal, server side check", function() {
				var oProp, oResult, bExc = false;
				oProp = JSON.parse("{\"property\":{\"name\":\"Amount\",\"type\":\"Edm.Decimal\",\"nullable\":\"false\",\"precision\":\"11\",\"scale\":\"2\",\"documentation\":[{\"text\":null,\"extensions\":[{\"name\":\"Summary\",\"value\":\"Preis fÃ¼r externe Verarbeitung.\",\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"},{\"name\":\"LongDescription\",\"value\":null,\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"}]}],\"extensions\":[{\"name\":\"unit\",\"value\":\"AmountCurrency\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"label\",\"value\":\"Preis\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"sortable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"filterable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"}]},\"typePath\":\"Amount\",\"extensions\":{\"sap:filterable\":\"false\",\"sap:sortable\":\"false\",\"sap:label\":\"Preis\",\"sap:unit\":\"AmountCurrency\"}}");

				sinon.stub(this.oMetaData._oParent, "getClientSideMandatoryCheck").returns(false);

				oResult = this.oMetaData.getMandatoryCheck(oProp);
				assert.equal(!!oResult, true);
				try {
					oResult();
				} catch(ex) {
					bExc = true;
				}
				assert.equal(bExc, false);
			});


			QUnit.test("checkMandatory - mandatory for Edm.Boolean", function() {
				var oProp, oResult;
				oProp = JSON.parse("{\"property\":{\"name\":\"Amount\",\"type\":\"Edm.Boolean\",\"nullable\":\"false\",\"precision\":\"11\",\"scale\":\"2\",\"documentation\":[{\"text\":null,\"extensions\":[{\"name\":\"Summary\",\"value\":\"Preis fÃ¼r externe Verarbeitung.\",\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"},{\"name\":\"LongDescription\",\"value\":null,\"attributes\":[],\"children\":[],\"namespace\":\"http://schemas.microsoft.com/ado/2008/09/edm\"}]}],\"extensions\":[{\"name\":\"unit\",\"value\":\"AmountCurrency\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"label\",\"value\":\"Preis\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"sortable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"},{\"name\":\"filterable\",\"value\":\"false\",\"namespace\":\"http://www.sap.com/Protocols/SAPData\"}]},\"typePath\":\"Amount\",\"extensions\":{\"sap:filterable\":\"false\",\"sap:sortable\":\"false\",\"sap:label\":\"Preis\",\"sap:unit\":\"AmountCurrency\"}}");

				oResult = this.oMetaData.getMandatoryCheck(oProp);
				assert.equal(!oResult, true);
			});

			QUnit.test("getBindableAttributes", function() {
				var aResult;

				aResult = this.oMetaData.getBindableAttributes();
				assert.equal(aResult.length, 3);

				aResult = this.oMetaData.getBindableAttributes(true);
				assert.equal(aResult.length, 2);

				this.oMetaData._oParent.data = function() {
					return {};
				};
				aResult = this.oMetaData.getBindableAttributes();
				assert.equal(aResult.length, 1);
			});

			QUnit.test("getUOMEditState", function() {
				var aPaths, oSet, oType, oProperty, oResult, oMeta, oUOM, oMeta1;

				oSet = this.oHelper.oMeta.getODataEntitySet("Project");
				oSet["sap:updatable-path"] = "EntityUpdatable_FC";
				oType = this.oHelper.oMeta.getODataEntityType(oSet.entityType);
				oMeta1 = {
						    path: "Amount",
							entitySet : oSet,
							entityType: oType,
						};

				this.oHelper.getProperty(oMeta1);
				oUOM = this.oHelper.getUnitOfMeasure2(oMeta1);
				oMeta = {
				    path: "Amount",
					entitySet : oSet,
					entityType: oType,
					property : oMeta1.property,
					annotations: {
						uom: oUOM
					}
				};

				oResult = this.oMetaData.getUOMEditState(oMeta);
				aPaths = oResult.path();

				//respect duplicate paths => the same paths for each formatter.
				assert.equal(aPaths[0], "EntityUpdatable_FC");
				assert.equal(aPaths[1], "EntityUpdatable_FC");

				assert.equal(oResult.formatter(true, true), 1);
				assert.equal(oResult.formatter(true, false), 1);
				assert.equal(oResult.formatter(false, true), 1);
				assert.equal(oResult.formatter(false, false), 0);
			});

			QUnit.test("hasUomEditState shall return true", function() {
				var bResult;

				this.oMetaData._oParent.getProposedControl = function() {
					return "ObjectNumber";
				};

				bResult = this.oMetaData.hasUomEditState({
					annotations: {
						uom: true
					}
				});
				assert.ok(bResult);
			});

			QUnit.test("hasUomEditState shall return true", function() {
				var bResult;

				this.oMetaData._oParent.getProposedControl = function() {
					return null;
				};
				this.oMetaData._oParent.getControlProposal = function() {
					return {
						getControlType: function() {
							return null;
						},
						getObjectStatus: function() {
							return {
								getObjectStatus: function() {
									return {};
								}
							}
						}
					};
				}

				bResult = this.oMetaData.hasUomEditState({
					annotations: {
						uom: true
					}
				});
				assert.ok(bResult);
			});

			QUnit.test("hasUomEditState shall return false", function() {
				var bResult;

				this.oMetaData._oParent.getProposedControl = function() {
					return null;
				};

				bResult = this.oMetaData.hasUomEditState();
				assert.ok(!bResult);
			});

			QUnit.test("Shall be destructible", function() {
				this.oMetaData.destroy();
				assert.ok(this.oMetaData);
				assert.equal(this.oMetaData._oModel, null);
			});

		}());
		</script>
	</head>
	<body id="body" class="sapUiBody">
		<h1 id="qunit-header">qUnit Page for qUnit Page for sap.ui.comp.smartfield.FieldControl</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
	</body>
</html>
