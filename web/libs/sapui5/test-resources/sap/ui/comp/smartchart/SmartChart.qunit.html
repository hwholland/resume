<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>qUnit Page for sap.ui.comp.smartchart.SmartChart</title>

<script id="sap-ui-bootstrap" type="text/javascript"
	src="../../../../../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.ui.comp">
	
</script>

<link rel="stylesheet"
	href="../../../../../resources/sap/ui/thirdparty/qunit.css"
	type="text/css" media="screen" />
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript">
	if (!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
	}

	(function() {

		jQuery.sap.require("sap.ui.comp.smartchart.SmartChart");
		jQuery.sap.require("sap.ui.comp.providers.ChartProvider");
		jQuery.sap.require("sap.ui.comp.smartvariants.SmartVariantManagement");
		jQuery.sap.require("sap.ui.model.Model");
		jQuery.sap.require("sap.chart.Chart");
		jQuery.sap.require("sap.m.OverflowToolbar");

		module("sap.ui.comp.smartchart.SmartChart", {
			setup: function() {
				this.oSmartChart = new sap.ui.comp.smartchart.SmartChart();
				this.oSmartChart.setUseVariantManagement(false);
				this.oSmartChart.setUseChartPersonalisation(false);
			},
			teardown: function() {
				this.oSmartChart.destroy();
			}
		});

		test("Shall be instantiable", function() {
			ok(this.oSmartChart);
		});

		test("Shall have entitySet property", function() {
			this.oSmartChart.setEntitySet("foo");
			strictEqual(this.oSmartChart.getEntitySet(), "foo");
		});

		test("Shall have useVariantManagement property", function() {
			this.oSmartChart._createVariantManagementControl = function() {
			};
			this.oSmartChart.setUseVariantManagement(true);
			ok(this.oSmartChart.getUseVariantManagement());

			this.oSmartChart.setUseVariantManagement(false);
			ok(!this.oSmartChart.getUseVariantManagement());
		});

		test("Shall pass the entity set to the ChartProvider", function() {
			var sEntitySet = "COMPANYSet";
			this.oSmartChart.setEntitySet(sEntitySet);

			sinon.stub(this.oSmartChart, "getModel").returns(new sap.ui.model.Model());

			sinon.stub(sap.ui.comp.providers.ChartProvider.prototype, "_intialiseMetadata");

			this.oSmartChart._createChartProvider();

			ok(this.oSmartChart._oChartProvider);
			strictEqual(this.oSmartChart._oChartProvider.sEntitySet, sEntitySet);
			sap.ui.comp.providers.ChartProvider.prototype._intialiseMetadata.restore();
		});

		test("Shall trigger initialiseMetadata and call _createChartProvider when entitySet and model are both set", function() {
			var sEntitySet = "COMPANYSet", oModel = new sap.ui.model.Model();

			sinon.stub(this.oSmartChart, "getModel").returns(oModel);

			sinon.stub(sap.ui.comp.providers.ChartProvider.prototype, "getChartViewMetadata").returns({
				fields: []
			});

			sinon.spy(this.oSmartChart, "_initialiseMetadata");
			sinon.spy(this.oSmartChart, "_createChartProvider");
			sinon.spy(this.oSmartChart, "_listenToSmartFilter");
			sinon.spy(this.oSmartChart, "_createChart");
			sinon.spy(this.oSmartChart, "fireInitialise");

			this.oSmartChart.setEntitySet(sEntitySet);
			this.oSmartChart.setModel(oModel);

			strictEqual(this.oSmartChart._oChartProvider.sEntitySet, sEntitySet);
			strictEqual(this.oSmartChart._oChartProvider._oParentODataModel, oModel);

			ok(this.oSmartChart._initialiseMetadata.called);
			ok(this.oSmartChart._createChartProvider.called);
			ok(this.oSmartChart._listenToSmartFilter.calledOnce);
			ok(this.oSmartChart._createChart.calledOnce);
			ok(this.oSmartChart.fireInitialise.calledOnce);
			strictEqual(this.oSmartChart.bIsInitialised, true);

			sap.ui.comp.providers.ChartProvider.prototype.getChartViewMetadata.restore();
		});

		//TODO: Needs to be re-written for new details handling, which affects the toolbar content
		/*test("_createToolbar and _createToolbarContent shall create toolbars", function() {	
			
			this.oSmartChart._createToolbar();
			this.oSmartChart.setUseChartPersonalisation(false);
			this.oSmartChart.setUseVariantManagement(false);
			this.oSmartChart.setShowDrillButtons(false);
			this.oSmartChart.setShowZoomButtons(false);
			this.oSmartChart.setShowLegendButton(false);
			this.oSmartChart.setShowSemanticNavigationButton(false);			
			this.oSmartChart.bIsInitialised = true;
			
			this.oSmartChart._oChart = {
			      getChartType: function(sType) {},
			      attachSelectData: function(oEvent) {},
			      attachDeselectData: function(oEvent) {}			      
			};
				
			this.oSmartChart._createToolbarContent();			
			// Space Open ChartType Droll+ Drill- Legend Zoom+ Zoom- Perso Max/Min
			//   X         X         X      X      X      X    X            X
			equal(this.oSmartChart._oToolbar.getContent().length, 8); 
			ok(!this.oSmartChart._oDrillUpButton.getVisible());
			ok(!this.oSmartChart._oDrillDownButton.getVisible());
			ok(!this.oSmartChart._oZoomInButton.getVisible());
			ok(!this.oSmartChart._oZoomOutButton.getVisible());			
			ok(!this.oSmartChart._oLegendButton.getVisible());			
			
			
			this.oSmartChart._oToolbar.destroy();
			this.oSmartChart._oToolbar = null;
			
			this.oSmartChart._oButtonChart1.destroy();
			this.oSmartChart._oButtonChart2.destroy();
			this.oSmartChart._oButtonChart3.destroy();
			this.oSmartChart._oButtonChart4.destroy();
			this.oSmartChart._oButtonChart5.destroy();			
			
			this.oSmartChart._createToolbar();
					
			this.oSmartChart.setHeader("Test Chart");		
			this.oSmartChart.setUseChartPersonalisation(true);
			this.oSmartChart.setUseVariantManagement(true);
			this.oSmartChart.setShowDrillButtons(true);
			this.oSmartChart.setShowZoomButtons(true);
			this.oSmartChart.setShowLegendButton(true);
			this.oSmartChart.setShowSemanticNavigationButton(true);
			this.oSmartChart.setShowFullScreenButton(true);
			

			// Header Separator Open Spacer ChartType Droll+ Drill- Legend Zoom+  Zoom- Perso  Max/Min
			//   X              X     X        X       X      X      X      X      X     X    	 X	   
			this.oSmartChart._createToolbarContent();			
			equal(this.oSmartChart._oToolbar.getContent().length, 11);
			ok(this.oSmartChart._oDrillUpButton.getVisible());
			ok(this.oSmartChart._oDrillDownButton.getVisible());
			ok(this.oSmartChart._oZoomInButton.getVisible());
			ok(this.oSmartChart._oZoomOutButton.getVisible());		
			ok(this.oSmartChart._oLegendButton.getVisible());		
			ok(this.oSmartChart.oFullScreenButton.getVisible());
			
		});*/

		//NEW
		test("test _getVariantManagementControl with id", function() {

			//Arrange
			var oSmartVariantId = "oSmartVariantManagement";
			var oSmartVariantManagement = new sap.ui.comp.smartvariants.SmartVariantManagement(oSmartVariantId, {});

			//Act
			var testVariantManagement = this.oSmartChart._getVariantManagementControl(oSmartVariantId);

			//Assert
			strictEqual(testVariantManagement, oSmartVariantManagement, "Variant Management correctly retreived by id");
			oSmartVariantManagement.destroy();

		});

		test("test _getVariantManagementControl with variant management control", function() {

			//Arrange
			var oSmartVariantId = "oSmartVariantManagement";
			var oSmartVariantManagement = new sap.ui.comp.smartvariants.SmartVariantManagement(oSmartVariantId, {});

			//Act
			var testVariantManagement = this.oSmartChart._getVariantManagementControl(oSmartVariantManagement);

			//Assert
			strictEqual(testVariantManagement, oSmartVariantManagement, "Variant Management correctly retreived by with control itself");
			oSmartVariantManagement.destroy();
		});

		test("test _getVariantManagementControl with wrong instance type", function() {

			//Arrange	
			var oWrongInstance = {};

			//Act
			var testVariantManagement = this.oSmartChart._getVariantManagementControl(oWrongInstance);

			//Assert
			strictEqual(testVariantManagement, null, "Wrong instance type correctly returns null");

		});

		test("Shall attach orientation and resize handler if device is no desktop", function() {

			//Arrange
			sinon.spy(sap.ui.Device.orientation, "attachHandler");
			sinon.spy(sap.ui.Device.resize, "attachHandler");
			sap.ui.Device.system.desktop = false;

			//Re-run the setup to reflect the changes above
			//TODO: Is there a cleaner solution available?
			QUnit.config.modules[0].testEnvironment.beforeEach();

			//Assert
			ok(sap.ui.Device.orientation.attachHandler.calledOnce, "Orientation handler called once");
			ok(sap.ui.Device.resize.attachHandler.calledOnce, "Resize handler called once");

			//Clean
			sap.ui.Device.system.desktop = true;
			sap.ui.Device.orientation.attachHandler.restore();
			sap.ui.Device.resize.attachHandler.restore();

		});

		//Test new Details functionality

		test("_addDetailsButton", function() {
			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oToolbar = new sap.m.OverflowToolbar();

			var oSpyAttachDrillDown = sinon.spy(this.oSmartChart._oChart, "attachDrilledUp");
			var oSpyAttachDrillUp = sinon.spy(this.oSmartChart._oChart, "attachDrilledDown");
			var oSpyAttachSelectData = sinon.spy(this.oSmartChart._oChart, "attachSelectData");
			var oSpyAttachDeselectData = sinon.spy(this.oSmartChart._oChart, "attachDeselectData");
			var oSpyAttachRenderComplete = sinon.spy(this.oSmartChart._oChart, "attachRenderComplete");

			var oStubOpenDetails = sinon.stub(this.oSmartChart, "_openDetailsPopover");
			var oStubUpdateDetailsModel = sinon.stub(this.oSmartChart, "_updateDetailsModel");
			var oStubUpdateDetailsText = sinon.stub(this.oSmartChart, "_updateDetailsText");

			//Act
			this.oSmartChart._addDetailsButton();

			this.oSmartChart._oDetailsButton.firePress();
			this.oSmartChart._oChart.fireSelectData();
			//this.oSmartChart._oChart.fireDeselectData();

			this.oSmartChart._oChart.fireDrilledUp();
			this.oSmartChart._oChart.fireDrilledDown();

			this.oSmartChart._oChart.fireRenderComplete();

			//Assert
			//ok(this.oSmartChart.getShowDetailsButton(), "showDetailsButton was initially set to true");
			ok(!this.oSmartChart.getShowDetailsButton(), "showDetailsButton was initially set to false");
			
			ok(this.oSmartChart._oDetailsButton, typeof sap.m.Button, "Details button was created");
			
			//ok(this.oSmartChart._oDetailsButton.getVisible(), "Details button was created");
			ok(!this.oSmartChart._oDetailsButton.getVisible(), "Details button initially was not visible");

			ok(oStubOpenDetails.calledOnce, "Pressing details button fired _openDetailsPopover");
			equal(oStubUpdateDetailsModel.callCount, 3, "updateDetailsModel was called three times from fireSelectData, fireDrilledDown and fireDrilledUp callbacks");
			equal(oStubUpdateDetailsText.callCount, 4, "updateDetailsText was called four times from fireSelectData, fireDrilledDown and fireDrilledUp callbacks");

			ok(oSpyAttachDrillDown.calledOnce, "attachDrillDown of chart called once");
			ok(oSpyAttachDrillUp.calledOnce, "attachDrillUp of chart called once");
			ok(oSpyAttachSelectData.calledOnce, "attachSelectdata of chart called once");
			ok(oSpyAttachDeselectData.calledOnce, "attachDeselectData of chart called once");
			ok(oSpyAttachRenderComplete.calledOnce, "attachRenderComplete of chart called once");

			//Clean
			this.oSmartChart._oChart.attachDrilledUp.restore();
			this.oSmartChart._oChart.attachDrilledDown.restore();
			this.oSmartChart._oChart.attachSelectData.restore();
			this.oSmartChart._oChart.attachDeselectData.restore();
			this.oSmartChart._oChart.attachRenderComplete.restore();
			this.oSmartChart._openDetailsPopover.restore();
			this.oSmartChart._updateDetailsModel.restore();
			this.oSmartChart._updateDetailsText.restore();

			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oToolbar.destroy();
		});

		test("_openDetailsPopover", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oDetailsDrillInPage = new sap.m.Page();
			this.oSmartChart._oDetailsMasterPage = new sap.m.Page();
			this.oSmartChart._oDetailsNavContainer = new sap.m.NavContainer();
			this.oSmartChart._oDetailsButton = new sap.m.Button();
			var oTestListItem = new sap.m.ListItemBase();
			this.oSmartChart._oDrillInMasterList = new sap.m.List({
				items: [
					oTestListItem
				]
			});

			var oSpyTestListItemFirePress = sinon.spy(oTestListItem, "firePress");

			var stub = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					count: 0
				}
			});
			var oStubCreateDetailsPopoverStructure = sinon.stub(this.oSmartChart, "_createDetailsPopoverStructure");
			var oFakeEvent = {
				getSource: function() {
					return new sap.m.Button();
				}
			}

			var oStubBindDetailsListAggregation = sinon.stub(this.oSmartChart, "_bindDetailsListAggregation");

			//Act
			this.oSmartChart._openDetailsPopover(oFakeEvent);

			//Assert
			ok(oSpyTestListItemFirePress.calledOnce, "Press handler of DrillMasterList item was pressed once");
			ok(oStubBindDetailsListAggregation.calledOnce, "Binding function for details items was called once");
			equal(this.oSmartChart._oDetailsDrillInPage.getShowNavButton(), false, "Navigation button of detailsDrillInPage was invisible");

			//Arrange
			var oSpyOpenBy = sinon.spy(this.oSmartChart._oDetailsPopover, "openBy");

			//Act
			this.oSmartChart._openDetailsPopover(oFakeEvent);

			//Assert
			ok(oSpyOpenBy.calledOnce, "openBy of popover has been called");

			//Arrange
			this.oSmartChart._oDetailsNavContainer.setInitialPage(this.oSmartChart._oDetailsDrillInPage);
			var oSpyTo = sinon.spy(this.oSmartChart._oDetailsNavContainer, "to");

			//Act
			this.oSmartChart._oDetailsPopover.fireAfterClose();

			//Assert
			ok(oSpyTo.calledOnce, "Navigation to master Page was called on oDetailsNavContainer");
			ok(this.oSmartChart._oDetailsDrillInPage.getShowNavButton(), "NavButton of DetailsDrillInPage was set to visible");
			ok(this.oSmartChart._oDrillInMasterList.getItems()[0].getVisible(), "DrillInMasterList item was set to visible");

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oDetailsDrillInPage.destroy();
			this.oSmartChart._oDetailsMasterPage.destroy();
			this.oSmartChart._oDetailsNavContainer.destroy();
			this.oSmartChart._oDetailsButton.destroy();
			oTestListItem.destroy();
			this.oSmartChart._oDrillInMasterList.destroy();

			this.oSmartChart._createDetailsPopoverStructure.restore();
			this.oSmartChart._bindDetailsListAggregation.restore();
			this.oSmartChart._oDetailsPopover.openBy.restore();

		});

		test("_updateDetailsText with selected datapoint count", function() {
			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oDetailsButton = new sap.m.Button();
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");

			var oStubGetSelectedDatapoints = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					count: 5
				}
			});

			//Act
			this.oSmartChart._updateDetailsText();

			//Assert
			var sButtonText = this.oSmartChart._oRb.getText("CHART_DETAILSBTN_LABEL", [
				this.oSmartChart._oChart.getSelectedDataPoints().count
			]);
			equal(this.oSmartChart._oDetailsButton.getText(), sButtonText, "Details button text was set correctly with a count of " + this.oSmartChart._oChart.getSelectedDataPoints().count);

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oDetailsButton.destroy();

		});

		test("_updateDetailsText without selected datapoint count", function() {
			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oDetailsButton = new sap.m.Button();
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");

			var oStubGetSelectedDatapoints = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					count: 0
				}
			});

			//Act
			this.oSmartChart._updateDetailsText();

			//Assert
			equal(this.oSmartChart._oDetailsButton.getText(), this.oSmartChart._oRb.getText("CHART_DRILLDOWNDETAILSPAGE_TITLE"), "Details button text was set correctly without a count");

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oDetailsButton.destroy();
		});

		test("_updateDetailsModel", function() {

			//Arrange

			var oContext = new sap.ui.model.Context();
			var oContextObject = {
				id: "oTestContextObject"
			};

			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");
			this.oSmartChart._aDetailsEntries = [];
			this.oSmartChart._oDetailsModel = new sap.ui.model.json.JSONModel({
				items: this.oSmartChart._aDetailsEntries
			});

			sinon.stub(oContext, "getObject", function() {
				return oContextObject;
			});

			sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					dataPoints: [
						{
							context: oContext,
							measures:["oneMeasure","anotherMeasure"]
						}
					]
				}
			});
			
			var oResultObject = {
			                     context: oContext,
			                     measures:["oneMeasure"]
			}

			//Act
			this.oSmartChart._updateDetailsModel();

			//Assert
			equal(this.oSmartChart._aDetailsEntries[0].measures[0], this.oSmartChart._oChart.getSelectedDataPoints().dataPoints[0].measures[0], "First details object context was successfully pushed to model array");
			equal(this.oSmartChart._aDetailsEntries[1].measures[0], this.oSmartChart._oChart.getSelectedDataPoints().dataPoints[0].measures[1], "Second details object context was successfully pushed to model array");
			equal(this.oSmartChart._oDetailsModel.getData("items").items, this.oSmartChart._aDetailsEntries, "Details array was correctly set into details model");

			//Clean
			this.oSmartChart._oChart.destroy();
			oContext.destroy();
			this.oSmartChart._oDetailsModel.destroy();

		});

		test("_bindDetailsListAggregation", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oDetailsMasterListScrollContainer = new sap.m.ScrollContainer({
				visible: false
			});
			this.oSmartChart._oDetailsMasterList = new sap.m.List();
			this.oSmartChart._aDetailsEntries = [
				1, 2, 3
			];

			var oStubBindAggregation = sinon.stub(this.oSmartChart._oDetailsMasterList, "bindAggregation");

			//Act
			this.oSmartChart._bindDetailsListAggregation();

			//Arrange
			equal(this.oSmartChart._oDetailsMasterListScrollContainer.getVisible(), true, "ScrollContainer successfully set to true");
			ok(oStubBindAggregation.calledOnce, "Aggregation binding was successfully called");

		});

		test("_createDetailsPopoverStructure", function() {

			//Arrange
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");

			//Act
			jQuery.device.is.phone = true; //check if header is set correctly on mobile
			var navContainer = this.oSmartChart._createDetailsPopoverStructure();

			//Assert
			ok(this.oSmartChart._oDetailsNavContainer, "Nav Container created");
			ok(this.oSmartChart._oDetailsMasterListScrollContainer, "Nav Container created");
			ok(this.oSmartChart._oDetailsVBox, "Nav Container created");

			ok(this.oSmartChart._oDetailsMasterPage, "Nav Container created");
			//equal(this.oSmartChart._oDetailsMasterPage.getTitle(), this.oSmartChart._oRb.getText("CHART_DETAILSBTN_LABEL"), "Title of DetailsMasterPage was set correctly for mobile devices")

			ok(this.oSmartChart._oDetailsDrillInPage, "Nav Container created");
			ok(this.oSmartChart._oDetailsSemanticPage, "Nav Container created");
			ok(this.oSmartChart._oDetailsSemanticPageMulti, "Nav Container created");
			ok(this.oSmartChart._oDetailsMasterList, "Nav Container created");
			ok(this.oSmartChart._oDrillInMasterList, "Nav Container created");
			ok(this.oSmartChart._oRelatedAppsMasterList, "Nav Container created");
			equal(navContainer, this.oSmartChart._oDetailsNavContainer, "createDetailsPopoverStructure successfully returned the navigation container");

			//Arrange
			var oStubBack = sinon.stub(this.oSmartChart._oDetailsNavContainer, "back");
			var oStubNavigateToDrillDetailsList = sinon.stub(this.oSmartChart, "_navigateToDrillDetailsList");

			//Act
			this.oSmartChart._oDetailsDrillInPage.fireNavButtonPress();
			//Assert
			ok(oStubBack.calledOnce, "Nav back press event on DetailsDrillInPage was fired correctly");
			oStubBack.reset();

			//Act
			this.oSmartChart._oDetailsSemanticPage.fireNavButtonPress();
			//Assert
			ok(oStubBack.calledOnce, "Nav back press event on DetailSemanticPage was fired correctly");
			oStubBack.reset();

			//Act
			this.oSmartChart._oDetailsSemanticPageMulti.fireNavButtonPress();
			//Assert
			ok(oStubBack.calledOnce, "Nav back press event on DetailSemanticPageMulti was fired correctly");
			oStubBack.reset();

			//Act
			this.oSmartChart._oDrillInMasterList.getItems()[0].firePress();
			//Assert
			ok(oStubNavigateToDrillDetailsList.calledOnce, "Press event on DrillInMasterList was fired correctly");
			oStubNavigateToDrillDetailsList.reset();

			//Clean
			jQuery.device.is.phone = false;
			this.oSmartChart._oDetailsNavContainer.back.restore();
			this.oSmartChart._navigateToDrillDetailsList.restore()

		});

		test("_semanticObjectListForDetails", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();

			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();
			var oSpySetSemanticObject = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObject");
			var oSpySetSemanticObjectLabel = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObjectLabel");

			var aSemanticObjects = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}, {
					name: "semObj2",
					fieldLabel: "semObj2"
				}, {
					name: "semObj3",
					fieldLabel: "semObj3"
				}
			];

			//Act
			var oSemanticObjectList = this.oSmartChart._semanticObjectListForDetails(aSemanticObjects, this.oSmartChart._oSemanticNavHandler);

			//Assert
			equal(oSemanticObjectList.getItems().length, 3, "SemanticObjectList contains the right amount of itmens based on the availbe semantic objects.");

			//Arrange
			var oEvent = {
				listItem: oSemanticObjectList.getItems()[0]
			};
			this.oSmartChart._oDetailsSemanticPage = new sap.m.Page();
			this.oSmartChart._oDetailsNavContainer = new sap.m.NavContainer();
			this.oSmartChart._oDetailsPopover = new sap.m.ResponsivePopover();

			var oSpyDestroyContent = sinon.spy(this.oSmartChart._oDetailsSemanticPage, "destroyContent");
			var oSpyAddContent = sinon.spy(this.oSmartChart._oDetailsSemanticPage, "addContent");
			var oSpyTo = sinon.spy(this.oSmartChart._oDetailsNavContainer, "to");
			var oSpyFocus = sinon.spy(this.oSmartChart._oDetailsPopover, "focus");
			var done = assert.async();

			//Act
			oSemanticObjectList.fireSelectionChange(oEvent);

			//Assert
			ok(oSpySetSemanticObject.calledWith(aSemanticObjects[0].name), "semanticObject was set with the correct params");
			ok(oSpySetSemanticObjectLabel.calledWith(aSemanticObjects[0].fieldLabel), "semanticObject label was set with the correct params");

			window.setTimeout(function() {
				ok(oSpyDestroyContent.calledOnce, "destroyContent of detailsSemanticPage was successfully called");
				ok(oSpyAddContent.calledOnce, "addContent of detailsSemanticPage was successfully called");
				ok(oSpyTo.calledOnce, "Navigation to detailsSemanticPage has been triggered correctly");
				ok(oSpyFocus.calledOnce, "Focus on oDetailsPopover was called correctly");

				//Clean
				this.oSmartChart._oChart.destroy();
				this.oSmartChart._oSemanticNavHandler.destroy();
				this.oSmartChart._oSemanticNavHandler.setSemanticObject.restore();
				this.oSmartChart._oSemanticNavHandler.setSemanticObjectLabel.restore();

				this.oSmartChart._oDetailsSemanticPage.destroy();
				this.oSmartChart._oDetailsNavContainer.destroy();
				this.oSmartChart._oDetailsPopover.destroy();
				this.oSmartChart._oDetailsSemanticPage.destroyContent.restore();
				this.oSmartChart._oDetailsSemanticPage.addContent.restore();
				this.oSmartChart._oDetailsNavContainer.to.restore();
				this.oSmartChart._oDetailsPopover.focus.restore();

				done();
			}.bind(this));
		});

		test("_navigateToDrillDetailsList", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oDetailsDrillInPage = new sap.m.Page()
			this.oSmartChart._oDetailsNavContainer = new sap.m.NavContainer();
			this.oSmartChart._oDetailsPopover = new sap.m.ResponsivePopover();
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");

			var oDim1 = new sap.chart.data.Dimension({
				name: "FirstDim",
				label: "FirstDim"
			});
			var oDim2 = new sap.chart.data.Dimension({
				name: "SecondDim",
				label: "SecondDim"
			});
			var oDim3 = new sap.chart.data.Dimension({
				name: "ThirdDim",
				label: "ThirdDim"
			});
			var aDimensions = [
				oDim1, oDim2, oDim3
			];

			var oStubGetSortedDimensions = sinon.stub(this.oSmartChart, "_getSortedDimensions", function() {
				return aDimensions;
			});
			var oSpyGetFieldToolTip = sinon.spy(this.oSmartChart, "_getFieldTooltip");
			var oSpyTo = sinon.spy(this.oSmartChart._oDetailsNavContainer, "to");

			//Act
			this.oSmartChart._navigateToDrillDetailsList();

			//Assert
			equal(this.oSmartChart._oDetailsDrillInPage.getSubHeader().getMetadata().getName(), "sap.m.Bar", "Sub header bar was set correctly");
			equal(this.oSmartChart._oDetailsDrillInPage.getContent()[0].getMetadata().getName(), "sap.m.List", "Drill details list was set correctly");
			ok(oSpyTo.calledOnce, "The navigation to another page on the navContainer was called");
			ok(oSpyTo.calledWithExactly(this.oSmartChart._oDetailsDrillInPage), "The navigation to DetailsDrillInPage on nacContainer was called correctly");

			equal(this.oSmartChart._oDetailsDrillInPage.getContent()[0].getItems().length, aDimensions.length, aDimensions.length + " items correctly added to drill list");
			ok(oStubGetSortedDimensions.calledOnce, "_getSortedDimensions has been called once");
			equal(oSpyGetFieldToolTip.callCount, 3, "_getFieldTooltip has been called " + aDimensions.length + " times");

			//Arrange
			var oSearchField = this.oSmartChart._oDetailsDrillInPage.getSubHeader().getContentRight()[0];
			var oSpyTriggerSearchInPopover = sinon.spy(this.oSmartChart, "_triggerSearchInPopover");

			//Act
			oSearchField.fireLiveChange();

			//Assert
			ok(oSpyTriggerSearchInPopover.calledOnce, "liveChange of searchField correctly fires _triggerSearchInPopover");

			//Arrange
			var oList = this.oSmartChart._oDetailsDrillInPage.getContent()[0];
			var oSpyBack = sinon.spy(this.oSmartChart._oDetailsNavContainer, "back");
			var oSpyClose = sinon.spy(this.oSmartChart._oDetailsPopover, "close");
			var oSpyDrillDown = sinon.spy(this.oSmartChart._oChart, "drillDown");

			//Act
			oList.fireSelectionChange();

			//Assert
			ok(oSpyBack.calledOnce, "Back navigation was correctly called on nav container");
			ok(oSpyClose.calledOnce, "Details popover close was correctly called");

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oDetailsDrillInPage.destroy();
			this.oSmartChart._oDetailsNavContainer.destroy();
			this.oSmartChart._oDetailsPopover.destroy();

			this.oSmartChart._getSortedDimensions.restore();
			this.oSmartChart._getFieldTooltip.restore();
			this.oSmartChart._oDetailsNavContainer.to.restore();
			this.oSmartChart._triggerSearchInPopover.restore();
			this.oSmartChart._oDetailsNavContainer.back.restore();
			this.oSmartChart._oDetailsPopover.close.restore();
			this.oSmartChart._oChart.drillDown.restore();

		});

		test("_navigateToSemanticObjectDetails", function(assert) {

			assert.expect(9);

			var done = assert.async();

			//Arrange
			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();
			var oSpySetSemanticObject = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObject");
			var oSpySetSemanticObjectLabel = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObjectLabel");

			var aSemanticObjects = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}
			];

			var oStubSetSemanticObjectsContext = sinon.stub(this.oSmartChart, "_setSemanticObjectsContext", function() {
				return aSemanticObjects;
			});

			this.oSmartChart._oDetailsSemanticPage = new sap.m.Page();
			var oSpyDestroyContent = sinon.spy(this.oSmartChart._oDetailsSemanticPage, "destroyContent");
			var oSpyAddContent = sinon.spy(this.oSmartChart._oDetailsSemanticPage, "addContent");

			this.oSmartChart._oDetailsPopover = new sap.m.ResponsivePopover();
			var oSpyFocus = sinon.spy(this.oSmartChart._oDetailsPopover, "focus");

			//Act
			this.oSmartChart._navigateToSemanticObjectDetails();

			//Assert
			ok(oSpySetSemanticObject.calledWith(aSemanticObjects[0].name), "semanticObject was set with the correct params");
			ok(oSpySetSemanticObjectLabel.calledWith(aSemanticObjects[0].fieldLabel), "semanticObject label was set with the correct params");

			window.setTimeout(function() {
				assert.ok(oSpyDestroyContent.calledOnce, "Content of detailsSemanticPage was successfully destroyed");
				assert.ok(oSpyAddContent.calledOnce, "Content was successfully added to detailsSemanticPage");
				assert.ok(oSpyFocus.calledOnce, "Focus was successfully set on detailsPopover");

				//Clean
				this.oSmartChart._oSemanticNavHandler.destroy();
				this.oSmartChart._oSemanticNavHandler.setSemanticObject.restore();
				this.oSmartChart._oSemanticNavHandler.setSemanticObjectLabel.restore();
				this.oSmartChart._setSemanticObjectsContext.restore()

				this.oSmartChart._oDetailsSemanticPage.destroy()
				this.oSmartChart._oDetailsSemanticPage.destroyContent.restore();
				this.oSmartChart._oDetailsSemanticPage.addContent.restore();

				this.oSmartChart._oDetailsPopover.destroy();
				this.oSmartChart._oDetailsPopover.focus.restore();

				this.oSmartChart._oDetailsSemanticPageMulti.destroy();
				this.oSmartChart._oDetailsNavContainer.destroy();

				this.oSmartChart._oDetailsSemanticPageMulti.destroyContent.restore();
				this.oSmartChart._oDetailsSemanticPageMulti.addContent.restore();
				this.oSmartChart._oDetailsNavContainer.to.restore();
				this.oSmartChart._semanticObjectListForDetails.restore();

				done();
			}.bind(this));

			//Arrange
			aSemanticObjects = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}, {
					name: "semObj2",
					label: "semObj2"
				}, {
					name: "semObj3",
					label: "semObj3"
				}
			];

			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");
			this.oSmartChart._oDetailsSemanticPageMulti = new sap.m.Page();
			this.oSmartChart._oDetailsNavContainer = new sap.m.NavContainer();

			var oSpyDestroyContent = sinon.spy(this.oSmartChart._oDetailsSemanticPageMulti, "destroyContent");
			var oSpyAddContent = sinon.spy(this.oSmartChart._oDetailsSemanticPageMulti, "addContent");
			var oSpyTo = sinon.spy(this.oSmartChart._oDetailsNavContainer, "to");
			var oSpySemanticObjectListForDetails = sinon.spy(this.oSmartChart, "_semanticObjectListForDetails");

			//Act
			this.oSmartChart._navigateToSemanticObjectDetails();

			//Assert
			ok(oSpySemanticObjectListForDetails.calledWith(this.oSmartChart._setSemanticObjectsContext(), this.oSmartChart._oSemanticNavHandler), "semanticObjectListForDetails was called with the correct params");
			ok(oSpyDestroyContent.calledOnce, "Old Content of detailsSemanticPageMulti was destroyed successfully");
			ok(oSpyAddContent.calledOnce, "New Content of detailsSemanticPageMulti was set successfully");
			equal(this.oSmartChart._oDetailsSemanticPageMulti.getTitle(), this.oSmartChart._oRb.getText("CHART_SEMNAVBTN"), "The correct title was set to detailsSemanticPageMulti");

		});

		test("_initSemanticNavigationHandling", function() {

			//Arrange
			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();

			var oSemanticObjectController = new sap.ui.comp.navpopover.SemanticObjectController();

			var oStubGetSemanticObjectController = sinon.stub(this.oSmartChart, "getSemanticObjectController", function() {
				return oSemanticObjectController
			});
			var oSpySetSemanticObjectController = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObjectController");

			//Act
			this.oSmartChart._initSemanticNavigationHandling();

			//Assert
			ok(oStubGetSemanticObjectController.calledOnce, "getSemanticObjectController was called successfully");
			ok(oSpySetSemanticObjectController.calledWith(oSemanticObjectController), "SetSemanticObjectController of navHandler was successfully called");
		});

		test("_updateDrillBreadcrumbs", function() {

			//Arrange
			var oDim1 = new sap.chart.data.Dimension({
				name: "FirstDim",
				label: "FirstDim"
			});
			var oDim2 = new sap.chart.data.Dimension({
				name: "SecondDim",
				label: "SecondDim"
			});
			var oDim3 = new sap.chart.data.Dimension({
				name: "ThirdDim",
				label: "ThirdDim"
			});
			var aDimensions = [
				oDim1, oDim2, oDim3
			];

			var aVisibleDimensions = [
				"FirstDim", "SecondDim", "ThirdDim"
			];

			this.oSmartChart._oChart = new sap.chart.Chart({
				visibleDimensions: aVisibleDimensions,
				dimensions: aDimensions
			});
			this.oSmartChart._oDrillBreadcrumbs = new sap.m.Breadcrumbs();

			var oSpyGetDimensionsByName = sinon.spy(this.oSmartChart._oChart, "getDimensionByName");
			var oSpyInsertLink = sinon.spy(this.oSmartChart._oDrillBreadcrumbs, "insertLink");

			//Act
			this.oSmartChart._updateDrillBreadcrumbs();

			//Assert
			equal(oSpyGetDimensionsByName.callCount, 3, "");
			equal(oSpyInsertLink.callCount, 2, "");
			equal(this.oSmartChart._oDrillBreadcrumbs.getCurrentLocationText(), aVisibleDimensions[2], "First dimension was correclty set as currentLocationText in Breadcrumbs control");

			//Arrange
			var oSpyFireDeselectData = sinon.spy(this.oSmartChart._oChart, "fireDeselectData");
			var aNewResult = [
				"FirstDim", "SecondDim"
			];

			//Act
			this.oSmartChart._oDrillBreadcrumbs.getLinks()[1].firePress();

			//Assert
			ok(jQuery(aNewResult).not(this.oSmartChart._oChart.getVisibleDimensions()).length === 0 && jQuery(this.oSmartChart._oChart.getVisibleDimensions()).not(aNewResult).length === 0, "Pressing the Breadcrumbs link successfully updated the visible dimenions of the inner chart");
			equal(this.oSmartChart._oDrillBreadcrumbs.getCurrentLocationText(), aVisibleDimensions[1], "Next dimension was correclty set as currentLocationText in Breadcrumbs control after pressing a breadcrumb link");

			//Clean
			oDim1.destroy();
			oDim2.destroy();
			oDim3.destroy();
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oDrillBreadcrumbs.destroy();
			this.oSmartChart._oChart.getDimensionByName.restore();
			this.oSmartChart._oDrillBreadcrumbs.insertLink.restore();
			this.oSmartChart._oChart.fireDeselectData.restore();
		});

		test("_addDrillBreadcrumbs", function() {

			//Arrange
			this.oSmartChart._oToolbar = new sap.m.OverflowToolbar();
			this.oSmartChart._oChart = new sap.chart.Chart();

			var oStubUpdateDrillBreadcrumbs = sinon.stub(this.oSmartChart, "_updateDrillBreadcrumbs");

			//Act
			this.oSmartChart._addDrillBreadcrumbs();

			//Assert
			equal(this.oSmartChart._oDrillBreadcrumbs.getMetadata().getName(), "sap.m.Breadcrumbs", "Breadcrumbs instance was successfully created");
			equal(this.oSmartChart._oToolbar.getContent()[0], this.oSmartChart._oDrillBreadcrumbs, "Breadcrumbs control was successfully set to toolbar content aggregation");
			ok(oStubUpdateDrillBreadcrumbs.calledOnce, "_updateDrillBreadcrumbs was successfully called ");

			//Arrange
			oStubUpdateDrillBreadcrumbs.reset();

			//Act
			this.oSmartChart._oChart.fireDrilledUp();
			this.oSmartChart._oChart.fireDrilledDown();

			//Assert
			equal(oStubUpdateDrillBreadcrumbs.callCount, 2, "Event handlers for drilling up and down of the inner chart instance successfully fired the _updateDrillBreadcrumbs function");

			//Clean
			this.oSmartChart._oToolbar.destroy();
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._updateDrillBreadcrumbs.restore();
		});

		test("_createPopover", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();

			jQuery.sap.require("sap.viz.ui5.controls.Popover");
			var oStubConnect = sinon.stub(sap.viz.ui5.controls.Popover.prototype, "connect");

			//Act
			this.oSmartChart._createPopover();

			//Assert
			equals(this.oSmartChart._oPopover.getMetadata().getName(), "sap.viz.ui5.controls.Popover", "Popover was successfully created");
			ok(oStubConnect.calledWith(this.oSmartChart._oChart.getVizUid()), "Connection of oPopover was successfully called");

			//Clean
			this.oSmartChart._oChart.destroy();
			sap.viz.ui5.controls.Popover.prototype.connect.restore();
		});

		test("_variantSaved", function() {

			//Arrange
			jQuery.sap.require("sap.ui.comp.personalization.Controller");
			this.oSmartChart._oPersController = new sap.ui.comp.personalization.Controller({
				table: new sap.m.Table()
			});
			this.oSmartChart._oCurrentVariant = {};

			var oStubSetPersoData = sinon.stub(sap.ui.comp.personalization.Controller.prototype, "setPersonalizationData");

			//Act
			this.oSmartChart._variantSaved();

			//Assert
			ok(oStubSetPersoData.calledWith(this.oSmartChart._oCurrentVariant), "setPersonalizationData was called with correct variant");

			//Clean
			sap.ui.comp.personalization.Controller.prototype.setPersonalizationData.restore();
			this.oSmartChart._oPersController.destroy();
			this.oSmartChart._oCurrentVariant = null;
		});

		test("_variantAfterSave", function() {

			//Arrange
			var oStubFireAfterVariantSave = sinon.stub(this.oSmartChart, "fireAfterVariantSave");
			var oStubGetCurrentVariantId = sinon.stub(this.oSmartChart, "getCurrentVariantId", function() {
				return "testVariantId";
			})
			//Act
			this.oSmartChart._variantAfterSave();

			//Assert
			ok(oStubFireAfterVariantSave.calledWith({
				currentVariantId: "testVariantId"
			}), "fireVaraintAfterSave was called with the correct variantId");

			//Clean
			this.oSmartChart.fireAfterVariantSave.restore();
			this.oSmartChart.getCurrentVariantId.restore();
		});

		test("setToolbar", function() {

			//Arrange	
			var oSpyRemoveItem = sinon.spy(this.oSmartChart, "removeItem");

			var oInitialToolbar = new sap.m.OverflowToolbar("initialToolbar");
			var oAnotherToolbar = new sap.m.OverflowToolbar("anotherToolbar");
			this.oSmartChart._oToolbar = oInitialToolbar;

			//Act
			this.oSmartChart.setToolbar(oAnotherToolbar);

			//Assert
			ok(oSpyRemoveItem.calledWith(oInitialToolbar), "Already set toolbar was successfully removed");
			equal(this.oSmartChart._oToolbar, oAnotherToolbar, "The new toolbar was successfully set to the smartChart instance");
			equal(this.oSmartChart._bUpdateToolbar, true, "Flag for updated toolbar was successfully set to true");

			//Clean
			this.oSmartChart.removeItem.restore();
			oInitialToolbar.destroy();
			oAnotherToolbar.destroy();
			this.oSmartChart._oToolbar.destroy();
		});

		test("getToolbar", function() {

			//Arrange
			this.oSmartChart._oToolbar = new sap.m.OverflowToolbar("oToolbar");

			//Act
			var oToolbar = this.oSmartChart.getToolbar();

			//Assert
			strictEqual(oToolbar, this.oSmartChart._oToolbar, "Getter successfully returned the toolbar instance");

			//Clean
			this.oSmartChart._oToolbar.destroy();

		});

		test("_refreshHeaderText", function() {

			//Arrange
			this.oSmartChart._bUpdateToolbar = false;

			//Act
			this.oSmartChart._refreshHeaderText();

			//Assert
			equal(this.oSmartChart._bUpdateToolbar, true, "Flag for updated toolbar was successfully changed to true");

			//Arrange
			this.oSmartChart._bUpdateToolbar = false;
			this.oSmartChart._headerText = new sap.m.Text();
			this.oSmartChart.setHeader("ThisIsAHeaderText");

			//Act
			this.oSmartChart._refreshHeaderText();

			//Assert
			equal(this.oSmartChart._headerText.getText(), this.oSmartChart.getHeader(), "The header text was successfully set into the header instance");
			equal(this.oSmartChart._bUpdateToolbar, false, "Flag was not changed in this case, which is correct");

			//Clean
			this.oSmartChart._headerText.destroy();
			this.oSmartChart.setHeader("");

		});

		test("setShowDetailsButton", function() {

			//Arrange
			var bFlag = true;
			this.oSmartChart._oDetailsButton = new sap.m.Button({
				visible: !bFlag
			});
			this.oSmartChart._oDrillDownButton = new sap.m.Button({
				visible: !bFlag
			});
			//var oStubToggleChartTooltipVisibility = sinon.stub(this.oSmartChart, "_toggleChartTooltipVisibility");

			//Act
			this.oSmartChart.setShowDetailsButton(bFlag);

			//Assert
			equal(this.oSmartChart.getProperty("showDetailsButton"), bFlag, "Property showDetailsButton was successfully set.");
			equal(this.oSmartChart._oDetailsButton.getVisible(), bFlag, "oDetailsButton was successfully set visible");
			//ok(oStubToggleChartTooltipVisibility.calledWith(!bFlag), "toggleChartTooltipVisibility was successfully called with false");
			equal(this.oSmartChart._oDrillDownButton.getVisible(), !bFlag, "oDetailsButton was successfully set invisible");

			//Clean
			this.oSmartChart._oDetailsButton.destroy();
			this.oSmartChart._oDrillDownButton.destroy();
			//this.oSmartChart._toggleChartTooltipVisibility.restore();
		});

		test("setShowDrillBreadcrumbs", function() {
			//Arrange
			var bFlag = true;
			this.oSmartChart._oDrillBreadcrumbs = new sap.m.Breadcrumbs({
				visible: !bFlag
			});
			this.oSmartChart._headerText = new sap.m.Text({
				visible: bFlag
			});
			this.oSmartChart._oDrillUpButton = new sap.m.Button({
				visible: bFlag
			});
			this.oSmartChart._oSeparator = new sap.m.ToolbarSeparator({
				visible: bFlag
			});
			var oStubAddHeaderToolbar = sinon.stub(this.oSmartChart, "_addHeaderToToolbar");

			//Act
			this.oSmartChart.setShowDrillBreadcrumbs(bFlag);

			//Assert
			equal(this.oSmartChart._oDrillBreadcrumbs.getVisible(), bFlag, "Breadcrumbs controll successfully set to visible");
			equal(this.oSmartChart._headerText.getVisible(), !bFlag, "headerText successfully set to invisible");
			equal(this.oSmartChart._oDrillUpButton.getVisible(), !bFlag, "DrillUpButton successfully set to invisible");
			equal(this.oSmartChart._oSeparator.getVisible(), !bFlag, "Separator successfully set to invisible");

			//Clean
			this.oSmartChart._oDrillBreadcrumbs.destroy();
			this.oSmartChart._headerText.destroy();
			this.oSmartChart._oDrillUpButton.destroy();
			this.oSmartChart._oSeparator.destroy();
			this.oSmartChart._addHeaderToToolbar.restore();

		});

		test("setShowZoomButtons", function() {

			//Arrange
			var bFlag = true;
			this.oSmartChart._oZoomInButton = new sap.m.Button({
				visible: !bFlag
			});
			this.oSmartChart._oZoomOutButton = new sap.m.Button({
				visible: !bFlag
			});
			this.oSmartChart.setProperty("showZoomButtons", !bFlag);

			//Act
			this.oSmartChart.setShowZoomButtons(bFlag);

			//Assert
			equal(this.oSmartChart._oZoomInButton.getVisible(), bFlag, "zoomInButton successfully set to true")
			equal(this.oSmartChart._oZoomOutButton.getVisible(), bFlag, "zoomOutButton successfully set to true")
			equal(this.oSmartChart.getProperty("showZoomButtons"), bFlag, "Property for zoom buttons successfully set to true");

			//Clean
			this.oSmartChart._oZoomInButton.destroy();
			this.oSmartChart._oZoomOutButton.destroy();
		});

		test("setLegendVisible", function() {

			//Arrange
			var bFlag = true;
			var oStubSetLegendVisible = sinon.stub(this.oSmartChart, "_setLegendVisible");
			this.oSmartChart.setProperty("legendVisible", !bFlag);

			//Act
			this.oSmartChart.setLegendVisible(bFlag);

			//Assert
			equal(this.oSmartChart.getProperty("legendVisible"), bFlag, "Property for legend visiblity was successfully set tot true");
			ok(oStubSetLegendVisible.calledWith(bFlag), "setLegendVisible was successfully called with true");

			//Clean
			this.oSmartChart._setLegendVisible.restore();

		});

		test("_setLegendVisible", function() {

			//Arrange
			var bFlag = true;
			this.oSmartChart._oChart = new sap.chart.Chart();
			var vizFrame = this.oSmartChart._oChart.getAggregation("_vizFrame");
			vizFrame.setLegendVisible(!bFlag);

			//Act
			this.oSmartChart._setLegendVisible(bFlag);

			equal(vizFrame.getVizProperties().legend.visible, bFlag, "Visiblity of legend successfully changed in viz frame of inner chart control");

			//Clean
			this.oSmartChart._oChart.destroy();
		});

		test("_getVizFrame", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();

			//Act
			var vizFrame = this.oSmartChart._getVizFrame();

			//Assert
			equal(vizFrame, this.oSmartChart._oChart.getAggregation("_vizFrame"), "Successfully returned the inner charts viz frame");

			//Clean
			this.oSmartChart._oChart.destroy();
		});

		test("showLegendButton", function() {

			//Arrange
			var bFlag = true;
			this.oSmartChart._oLegendButton = new sap.m.Button({
				visible: !bFlag
			});
			this.oSmartChart.setProperty("showLegendButton", !bFlag);

			//Act
			this.oSmartChart.setShowLegendButton(bFlag);

			//Assert
			equal(this.oSmartChart.getProperty("showLegendButton"), bFlag, "showLegendButton property successfully set to true");
			equal(this.oSmartChart._oLegendButton.getVisible(), bFlag, "Visibility of legendButton successfully set to true");

			//Clean
			this.oSmartChart._oLegendButton.destroy();
		});

		test("setShowSemanticNavigationButton", function() {

			//Arrange
			var bFlag = true;
			this.oSmartChart.setProperty("showSemanticNavigationButton", !bFlag);
			this.oSmartChart._oSemanticalNavButton = new sap.m.Button({
				visibility: !bFlag
			});

			//Act
			this.oSmartChart.setShowSemanticNavigationButton(bFlag);

			//Assert
			ok(this.oSmartChart.getProperty("showSemanticNavigationButton"), bFlag, "Property showSemanticNavigationButton successfully set to true");
			equal(this.oSmartChart._oSemanticalNavButton.getVisible(), bFlag, "Visibility of semanticalNavButton successfully set to true");

			//Clean
			this.oSmartChart._oSemanticalNavButton.destroy();
			this.oSmartChart._oSemanticalNavButton = null;

			//Arrange
			var oStubAddSemanticNavigationButton = sinon.stub(this.oSmartChart, "_addSemanticNavigationButton");

			//Act
			this.oSmartChart.setShowSemanticNavigationButton(bFlag);

			//Assert
			ok(oStubAddSemanticNavigationButton.calledOnce, "Private _addSemanticNavigationButton successfully called");

			//Clean
			this.oSmartChart._addSemanticNavigationButton.restore();

		});

		test("_addSemanticNavigationButton", function() {

			//Arrange
			this.oSmartChart.setProperty("showSemanticNavigationButton", true);

			jQuery.sap.require("sap.ui.comp.navpopover.SemanticObjectController");
			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();

			this.oSmartChart._oToolbar = new sap.m.OverflowToolbar();
			this.oSmartChart._oChart = new sap.chart.Chart();

			var oSemanticObjectController = new sap.ui.comp.navpopover.SemanticObjectController();

			var oStubGetSemanticObjectController = sinon.stub(this.oSmartChart, "getSemanticObjectController", function() {

				return oSemanticObjectController;
			});

			var oStubIndexOfSpaceOnToolbar = sinon.stub(this.oSmartChart, "_indexOfSpacerOnToolbar", function() {
				return 1;
			});
			var oStubInsertContent = sinon.stub(this.oSmartChart._oToolbar, "insertContent");

			var oStubSetSemanticObjectController = sinon.stub(sap.ui.comp.navpopover.NavigationPopoverHandler.prototype, "setSemanticObjectController");

			//Act
			this.oSmartChart._addSemanticNavigationButton();

			//Assert
			equal(this.oSmartChart._oSemanticalNavButton.getMetadata().getName(), "sap.m.Button", "semanticalNavigationButton was successfully created");
			ok(oStubGetSemanticObjectController.calledOnce, "Getter for semantic object controller was successfully called");
			ok(oStubSetSemanticObjectController.calledWith(oSemanticObjectController), "setSemanticObjectController of navigation handler successfully called with the correct semantic object cotroller instance");
			ok(oStubIndexOfSpaceOnToolbar.calledOnce, "Index of spacer on toolbar was successfully retreived");
			ok(oStubInsertContent.calledWith(this.oSmartChart._oSemanticalNavButton, this.oSmartChart._indexOfSpacerOnToolbar() + 1), "Content was successfully inserted into toolbar of smartChart");

			//Arrange
			var aSemanticObjects = [
				{
					id: "semanticObject1"
				}
			];
			var oStubSetSelectionDataPointHandling = sinon.stub(this.oSmartChart, "_setSelectionDataPointHandling", function() {
				return aSemanticObjects;
			});
			var oStubSetSemanticObject = sinon.stub(sap.ui.comp.navpopover.NavigationPopoverHandler.prototype, "setSemanticObject");
			var oStubSetSemanticObjectLabel = sinon.stub(sap.ui.comp.navpopover.NavigationPopoverHandler.prototype, "setSemanticObjectLabel");
			var oStubOpenPopover = sinon.stub(sap.ui.comp.navpopover.NavigationPopoverHandler.prototype, "openPopover");

			//Act
			this.oSmartChart._oChart.fireDeselectData();
			this.oSmartChart._oChart.fireSelectData();
			this.oSmartChart._oSemanticalNavButton.firePress();

			//Assert
			equal(oStubSetSelectionDataPointHandling.callCount, 2, "setSelectionDataPointHandling was correctly called during select and deselct of data");
			ok(oStubSetSemanticObject.calledOnce, "setSemanticObject was correctly called")
			ok(oStubSetSemanticObjectLabel.calledOnce, "setSemanticObjectLabel was correctly called")
			ok(oStubOpenPopover.calledOnce, "openPopover of nav handler was correctly called");

			//Arrange

			aSemanticObjects.push({
				id: "semanticObject2"
			});
			oStubSetSemanticObject.reset();
			oStubSetSemanticObjectLabel.reset();
			oStubOpenPopover.reset();

			var oStubSemanticObjectList = sinon.stub(this.oSmartChart, "_semanticObjectList");

			//Act
			this.oSmartChart._oChart.fireDeselectData();
			this.oSmartChart._oChart.fireSelectData();
			this.oSmartChart._oSemanticalNavButton.firePress();

			//Assert
			ok(oStubSemanticObjectList.calledOnce);
			equal(oStubSetSemanticObject.callCount, 0);
			equal(oStubSetSemanticObjectLabel.callCount, 0);
			equal(oStubOpenPopover.callCount, 0);

			//Clean
			this.oSmartChart._oSemanticNavHandler.destroy();
			this.oSmartChart._oToolbar.destroy();
			this.oSmartChart._oChart.destroy();
			oSemanticObjectController.destroy();
			this.oSmartChart.getSemanticObjectController.restore();
			this.oSmartChart._indexOfSpacerOnToolbar.restore();
			this.oSmartChart._oToolbar.insertContent.restore();
			sap.ui.comp.navpopover.NavigationPopoverHandler.prototype.setSemanticObjectController.restore();
			this.oSmartChart._setSelectionDataPointHandling.restore();
			sap.ui.comp.navpopover.NavigationPopoverHandler.prototype.setSemanticObject.restore();
			sap.ui.comp.navpopover.NavigationPopoverHandler.prototype.setSemanticObjectLabel.restore();
			sap.ui.comp.navpopover.NavigationPopoverHandler.prototype.openPopover.restore();
			this.oSmartChart._semanticObjectList.restore();
		});

		test("_setSelectionDataPointHandling", function() {

			//Arrange
			var oNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();
			var aSemanticObjects = [
				{
					id: "oSemObject"
				}
			];

			this.oSmartChart._oSemanticalNavButton = new sap.m.Button({
				enabled: false
			});

			var oStubSetSelectionDataPoint = sinon.stub(this.oSmartChart, "_setSelectionDataPoint", function() {
				return aSemanticObjects;
			});
			//Act
			var aSemanticObjectsResult = this.oSmartChart._setSelectionDataPointHandling(oNavHandler);

			//Assert
			equal(this.oSmartChart._oSemanticalNavButton.getEnabled(), true, "semantical navigation button successfully enabled");
			equal(aSemanticObjectsResult, aSemanticObjects, "Correct semantic object array returned");

			//Arrange
			aSemanticObjects = null;

			//Act
			var aSemanticObjectsResult = this.oSmartChart._setSelectionDataPointHandling(oNavHandler);

			//Assert
			equal(this.oSmartChart._oSemanticalNavButton.getEnabled(), false, "semantical navigation button successfully disabled");

			//Clean
			oNavHandler.destroy();
			this.oSmartChart._oSemanticalNavButton.destroy();
			this.oSmartChart._setSelectionDataPoint.restore();

		});

		test("_setSemanticObjectsContext", function() {

			//Arrange
			var oButton = new sap.m.Button();

			var oBindingContext = {
				id: "aBindingContext",
				getObject: function() {
					return {
						name: "testName",
						id: "testId"
					}
				}
			};

			var oStubGetBindingContext = sinon.stub(oButton, "getBindingContext", function() {
				return oBindingContext;
			});

			var oEvent = {
				getSource: function() {
					return oButton;
				}
			};

			var aSemanticObjects = [
				{
					id: "oSemObject"
				}
			];

			var oStubDetermineSemanticObjects = sinon.stub(this.oSmartChart, "_determineSemanticObjects", function() {
				return aSemanticObjects;
			});

			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();

			var oStubSetBindingContext = sinon.stub(this.oSmartChart._oSemanticNavHandler, "setBindingContext");

			//Act
			var sSemanticObjectsResult = this.oSmartChart._setSemanticObjectsContext(oEvent);

			//Assert
			ok(oStubDetermineSemanticObjects.calledWith(oBindingContext.getObject(), oBindingContext), "determineSemanticObjects called with correct odata context and data object");
			ok(oStubSetBindingContext.calledWith(oBindingContext), "Binding context of nav handler set with correct data context");
			equal(sSemanticObjectsResult, aSemanticObjects, "Correct semantic objects array returned");

			//Clean
			oButton.destroy();
			oButton.getBindingContext.restore();
			this.oSmartChart._determineSemanticObjects.restore();
			this.oSmartChart._oSemanticNavHandler.destroy();
			this.oSmartChart._oSemanticNavHandler.setBindingContext.restore();
		});

		test("_setSelectionDataPoint", function() {

			//Arrange
			var oContext = new sap.ui.model.Context();
			var oContextObject = {
				id: "oTestContextObject"
			};

			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");
			this.oSmartChart._aDetailsEntries = [];
			this.oSmartChart._oDetailsModel = new sap.ui.model.json.JSONModel({
				items: this.oSmartChart._aDetailsEntries
			});

			var oStubGetObject = sinon.stub(oContext, "getObject", function() {
				return oContextObject;
			});

			var oStubGetSelectedDataPoints = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					dataPoints: [
						{
							context: oContext
						}
					]
				}
			});

			var oStubSetBindingContext = sinon.stub(this.oSmartChart._oSemanticNavHandler, "setBindingContext");

			var aSemanticObjects = [
				{
					id: "oSemObject"
				}
			];

			var oStubDetermineSemanticObjects = sinon.stub(this.oSmartChart, "_determineSemanticObjects", function() {
				return aSemanticObjects;
			});

			//Act
			var aSemanticObjectsResult = this.oSmartChart._setSelectionDataPoint(this.oSmartChart._oSemanticNavHandler);

			//Assert
			ok(oStubGetSelectedDataPoints.calledOnce, "getSelectedDatapoints correctly called once");
			ok(oStubDetermineSemanticObjects.calledWith(oContext.getObject(), oContext), "determineSemanticObjects called with correct odata context and data object");
			ok(oStubSetBindingContext.calledWith(oContext), "Binding context of nav handler set with correct data context");
			equal(aSemanticObjectsResult, aSemanticObjects, "semantic object array correctly returned");

			//Clean
			this.oSmartChart._oChart.getSelectedDataPoints.restore();
			oStubGetObject.reset();

			//Arrange
			oStubGetSelectedDataPoints = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					dataPoints: [
						{
							context: oContext
						}, {
							context: oContext
						}
					]
				}
			});

			var aDataContext = [
				oContextObject, oContextObject
			];

			var oStubCondensBansedOnSameValue = sinon.stub(this.oSmartChart, "_condensBasedOnSameValue");

			//Act
			var aSemanticObjectsResult = this.oSmartChart._setSelectionDataPoint(this.oSmartChart._oSemanticNavHandler);

			//Assert
			equal(oStubGetObject.callCount, 2, "getObject of data context is called twice, which is correct");
			ok(oStubCondensBansedOnSameValue.calledWith(aDataContext), "condensBasedOnSameValue called with correct params");
			ok(oStubSetBindingContext.calledWith(this.oSmartChart._oChart.getSelectedDataPoints().dataPoints[1].context), "");

			//Clean

			this.oSmartChart._oChart.getSelectedDataPoints.restore();

			//Arrange
			oStubGetSelectedDataPoints = sinon.stub(this.oSmartChart._oChart, "getSelectedDataPoints", function() {
				return {
					dataPoints: []
				}
			});

			//Act
			var aSemanticObjectsResult = this.oSmartChart._setSelectionDataPoint(this.oSmartChart._oSemanticNavHandler);

			//Assert
			equals(aSemanticObjectsResult, null, "Correctly returned null when no semantic objects are found");

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oSemanticNavHandler.destroy();
			oContext.destroy();
			this.oSmartChart._oDetailsModel.destroy();
			oContext.getObject.restore();
			this.oSmartChart._oChart.getSelectedDataPoints.restore();
			this.oSmartChart._oSemanticNavHandler.setBindingContext.restore();
			this.oSmartChart._determineSemanticObjects.restore();
		});

		test("_condensBasedOnSameValue", function() {

			//Arrange
			var aSemanticObjects = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}, {
					name: "semObj2",
					fieldLabel: "semObj2"
				}, {
					name: "semObj3",
					fieldLabel: "semObj3"
				}
			];

			var aData = [
				{}, {}
			];

			var oStubDetermineSemanticObjects = sinon.stub(this.oSmartChart, "_determineSemanticObjects", function() {
				return aSemanticObjects;
			});

			var oStubBAllValuesAreEqual = sinon.stub(this.oSmartChart, "_bAllValuesAreEqual", function() {
				return true;
			});

			//Act
			var aSemObj = this.oSmartChart._condensBasedOnSameValue(aData);

			//Assert
			ok(jQuery(aSemObj).not(aSemanticObjects).length === 0 && jQuery(aSemanticObjects).not(aSemObj).length === 0, "Returned corred arra of semantic objects");

			//Clean
			this.oSmartChart._determineSemanticObjects.restore();
			this.oSmartChart._bAllValuesAreEqual.restore();
		});

		test("_bAllValuesAreEqual", function() {

			//Arrange
			var aData = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}, {
					name: "semObj1",
					fieldLabel: "semObj2"
				}
			];

			var sFieldName = "name";

			//Act
			var bIsEqual = this.oSmartChart._bAllValuesAreEqual(aData, sFieldName);

			//Assert
			equal(bIsEqual, true, "Correctly returned true when all values are equal");

			//Arrange
			sFieldName = "fieldLabel";

			//Act
			var bIsEqual = this.oSmartChart._bAllValuesAreEqual(aData, sFieldName);

			//Assert
			equal(bIsEqual, false, "Correctly returned false when not all values are equal");

		});

		test("_semanticObjectList", function() {

			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oSemanticalNavButton = new sap.m.Button();

			this.oSmartChart._oSemanticNavHandler = new sap.ui.comp.navpopover.NavigationPopoverHandler();
			var oSpySetSemanticObject = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObject");
			var oSpySetSemanticObjectLabel = sinon.spy(this.oSmartChart._oSemanticNavHandler, "setSemanticObjectLabel");

			var aSemanticObjects = [
				{
					name: "semObj1",
					fieldLabel: "semObj1"
				}, {
					name: "semObj2",
					fieldLabel: "semObj2"
				}, {
					name: "semObj3",
					fieldLabel: "semObj3"
				}
			];

			var oStubAddItem = sinon.stub(sap.m.List.prototype, "addItem");
			var oStubData = sinon.stub(sap.m.StandardListItem.prototype, "data");

			var oStubAddContent = sinon.stub(sap.m.ResponsivePopover.prototype, "addContent");
			var oStubOpenBy = sinon.stub(sap.m.ResponsivePopover.prototype, "openBy");

			//Act
			this.oSmartChart._semanticObjectList(aSemanticObjects, this.oSmartChart._oSemanticNavHandler);

			//Assert
			equal(oStubAddItem.callCount, 3, "");
			equal(oStubData.callCount, 3, "");
			ok(oStubAddContent.calledOnce, "");
			ok(oStubOpenBy.calledWith(this.oSmartChart._oSemanticalNavButton));

			//Clean
			this.oSmartChart._oChart.destroy();
			this.oSmartChart._oSemanticalNavButton.destroy();
			this.oSmartChart._oSemanticNavHandler.destroy();
			this.oSmartChart._oSemanticNavHandler.setSemanticObject.restore();
			this.oSmartChart._oSemanticNavHandler.setSemanticObjectLabel.restore();
			sap.m.List.prototype.addItem.restore()
			sap.m.StandardListItem.prototype.data.restore();
			sap.m.ResponsivePopover.prototype.addContent.restore();
			sap.m.ResponsivePopover.prototype.openBy.restore();

		});

		test("_determineSemanticObjects", function() {

			//Arrange
			var mData = {
				id: "one",
				name: "two",
				count: "three",

			}
			var oDataContext = {

			};

			var oField = {
				isDimension: true,
				isSemanticObject: true,
				fieldLabel: "testFieldLabel"
			}

			var oStubGetField = sinon.stub(this.oSmartChart, "_getField", function() {

				return oField;
			});

			//Act		
			var aSemanticObjects = this.oSmartChart._determineSemanticObjects(mData, oDataContext);
			var aSemObjectResult = [
				oField, oField, oField
			];

			//Assert
			ok(jQuery(aSemanticObjects).not(aSemObjectResult).length === 0 && jQuery(aSemObjectResult).not(aSemanticObjects).length === 0, "Returned corred array of semantic objects");

		});

		test("_drillDown", function() {

			//Arrange
			var oSpyAttachLiveChange = sinon.spy(sap.m.SearchField.prototype, "attachLiveChange");
			var oSpyAddContentRight = sinon.spy(sap.m.Bar.prototype, "addContentRight");
			var oSpyAddContent = sinon.spy(sap.m.ResponsivePopover.prototype, "addContent");
			
			var oStubGetFieldTooltip = sinon.stub (this.oSmartChart,"_getFieldTooltip",function(){
				return "testToolTip";
			});
			
			var oDim1 = new sap.chart.data.Dimension({
				name: "FirstDim",
				label: "FirstDim"
			});
			var oDim2 = new sap.chart.data.Dimension({
				name: "SecondDim",
				label: "SecondDim"
			});
			var oDim3 = new sap.chart.data.Dimension({
				name: "ThirdDim",
				label: "ThirdDim"
			});
			var aDimensions = [
				oDim1, oDim2, oDim3
			];

			var oStubGetSortedDimensions = sinon.stub(this.oSmartChart, "_getSortedDimensions", function() {
				return aDimensions;
			});

			var aVisibleDimensions = [
				"FirstDim", "SecondDim", "ThirdDim"
			];
			
			this.oSmartChart._oChart = new sap.chart.Chart({
				dimensions: aDimensions
			});
			
			var oStubOpenBy = sinon.stub(sap.m.ResponsivePopover.prototype, "openBy");
			
			var oEvent = {
			              getSource:function(){
			            	  return new sap.m.Button();
			              }
			};
			
			//Act
			this.oSmartChart._drillDown(oEvent);
			
			//Assert
			ok(oSpyAttachLiveChange.calledOnce,"AttachLiveChange of searchField correctyl called");
			ok(oSpyAddContentRight.calledOnce,"AddContentRight of bar correctly called");
			ok(oSpyAddContent.calledOnce,"addContent of popover correctly called");
			equal(oStubGetFieldTooltip.callCount,3,"getTooltip was corretly called "+ aDimensions.length + " times");
			ok(oStubGetSortedDimensions.calledOnce,"_getSortedDimensions was correctly called");
			ok(oStubOpenBy.calledOnce,"openBy of popover was correctly called");
			
			//Clean
			sap.m.SearchField.prototype.attachLiveChange.restore();
			sap.m.Bar.prototype.addContentRight.restore();
			sap.m.ResponsivePopover.prototype.addContent.restore();
			this.oSmartChart._getFieldTooltip.restore();
			this.oSmartChart._getSortedDimensions.restore();
			sap.m.ResponsivePopover.prototype.openBy.restore()
			this.oSmartChart._oChart.destroy();	
		});
		
		test("_displayChartTypes",function(){
			
			//Arrange
			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._bAvailableChartListIsOpen = false;
			
			var oEvent = {
			              getSource:function(){
			            	  return new sap.m.Button();
			              }
			};
			
			var oSpyAttachLiveChange = sinon.spy(sap.m.SearchField.prototype, "attachLiveChange");
			var oSpyAddContentRight = sinon.spy(sap.m.Bar.prototype, "addContentRight");
			var oSpyAddContent = sinon.spy(sap.m.ResponsivePopover.prototype, "addContent");
			var oSpyAttachAfterClose = sinon.spy(sap.m.ResponsivePopover.prototype, "attachAfterClose");
			var oSpySetModel = sinon.spy(sap.m.ResponsivePopover.prototype, "setModel");
			var oStubOpenBy = sinon.stub(sap.m.ResponsivePopover.prototype, "openBy");
			
			var oModel = new sap.ui.model.json.JSONModel();
			var oStubGetModel = sinon.stub(this.oSmartChart,"getModel",function(){
				return oModel;
			})
				
			//Act
			this.oSmartChart._displayChartTypes(oEvent);
			
			//Assert
			equal(this.oSmartChart._bAvailableChartListIsOpen,true,"");
			ok(oSpyAttachLiveChange.calledOnce,"");
			ok(oSpyAddContentRight.calledOnce,"");
			ok(oSpyAddContent.calledOnce,"");
			ok(oSpyAttachAfterClose.calledOnce,"");
			ok(oSpySetModel.calledOnce,"");
			ok(oSpySetModel.calledWith(oModel,"$smartChartTypes"));
			ok(oStubOpenBy.calledOnce);
			
			//Clean
			this.oSmartChart._oChart.destroy();
			sap.m.SearchField.prototype.attachLiveChange.restore();
			sap.m.Bar.prototype.addContentRight.restore();
			sap.m.ResponsivePopover.prototype.addContent.restore();
			sap.m.ResponsivePopover.prototype.attachAfterClose.restore();
			sap.m.ResponsivePopover.prototype.setModel.restore();
			sap.m.ResponsivePopover.prototype.openBy.restore();
		});
		
		test("_toggleFullScreen",function(){
			
			//Arrange
			var bFlag = true;
			this.oSmartChart._oRb = sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");
			this.oSmartChart.bFullScreen = null;
			this.oSmartChart._oFullScreenUtil = null;
			this.oSmartChart.oFullScreenButton = new sap.m.Button();
			
			var oStubToggleFullScreen = sinon.stub(sap.ui.comp.util.FullScreenUtil,"toggleFullScreen");
			
			//Act
			this.oSmartChart._toggleFullScreen(bFlag);
				
			//Assert
			equal(this.oSmartChart.bFullScreen,bFlag,"Boolean successfully set into instance");
			ok(this.oSmartChart._oFullScreenUtil,"FullScreenUtil was successfully created");
			ok(oStubToggleFullScreen.calledWith(this.oSmartChart,this.oSmartChart.bFullScreen),"toggleFullScreen of FullScreenUtil successfully called with correct params");
			equal(this.oSmartChart.oFullScreenButton.getTooltip(),this.oSmartChart._oRb.getText("CHART_MINIMIZEBTN_TOOLTIP"),"Correct Minimize tooltip set in full screen button");
			equal(this.oSmartChart.oFullScreenButton.getText(),this.oSmartChart._oRb.getText("CHART_MINIMIZEBTN_TEXT"),"Correct Minimize text set in full screen button");
			equal(this.oSmartChart.oFullScreenButton.getIcon(),"sap-icon://exit-full-screen","Correct icon set in full screen button");
			
			//Clean
			oStubToggleFullScreen.reset();
			
			//Arrange
			bFlag = false;
			
			//Act
			this.oSmartChart._toggleFullScreen(bFlag);
			
			//Arrange
			equal(this.oSmartChart.bFullScreen,bFlag,"Boolean successfully set into instance");
			ok(oStubToggleFullScreen.calledWith(this.oSmartChart,this.oSmartChart.bFullScreen),"toggleFullScreen of FullScreenUtil successfully called with correct params");
			equal(this.oSmartChart.oFullScreenButton.getTooltip(),this.oSmartChart._oRb.getText("CHART_MAXIMIZEBTN_TOOLTIP"),"Correct Maximize tooltip set in full screen button");
			equal(this.oSmartChart.oFullScreenButton.getText(),this.oSmartChart._oRb.getText("CHART_MAXIMIZEBTN_TEXT"),"Correct Maximize text set in full screen button");
			equal(this.oSmartChart.oFullScreenButton.getIcon(),"sap-icon://full-screen","Correct icon set in full screen button");
			
			//Clean
			this.oSmartChart.oFullScreenButton.destroy();
			this.oSmartChart.oFullScreenButton = null;
			oStubToggleFullScreen.reset();
		
			//Act
			this.oSmartChart._toggleFullScreen(bFlag);
			
			//Assert
			equal(oStubToggleFullScreen.callCount,0,"Correctly returned from function when no fullscreen button inscance existed");
			
			//Clean
			sap.ui.comp.util.FullScreenUtil.toggleFullScreen.restore();
			this.oSmartChart._oFullScreenUtil = null;
			this.oSmartChart.bFullScreen = null;
		});
		
		/*	test("_personalisationModelDataChange",function(){
			
			
		});
			test("_createTooltipOrPopover",function(){
			
		});
		
		test("setUserVariantMangement", function(){
			
		});
		
		 */

		//END NEW
		test("test header text features", function() {
			this.oSmartChart.setUseChartPersonalisation(false);
			this.oSmartChart.setUseVariantManagement(false);
			this.oSmartChart.bIsInitialised = true;

			var sHeaderText = "myTestHeader";
			this.oSmartChart.setHeader(sHeaderText);
			equal(this.oSmartChart.getHeader(), sHeaderText, "header text has to be equal");
		});

		test("test apply and fetch variant", function() {
			var oTestVariant = {};
			this.oSmartChart._oSmartFilter = {
				detachSearch: function() {
				},
				detachFilterChange: function() {
				},
				detachCancel: function() {
				}
			};
			this.oSmartChart._oChart = {
				setShowOverlay: function() {
				},
				setBusy: function() {
				}
			};

			this.oSmartChart._oPersController = {
				resetPersonalization: function() {
					bChartReseted = true;
				},
				setPersonalizationData: function() {
					//foo
				}
			};

			sinon.stub(this.oSmartChart, "_renderOverlay");

			this.oSmartChart.applyVariant(oTestVariant);
			var oResultVariant = this.oSmartChart.fetchVariant();
			equal(oResultVariant, oTestVariant, "applied variant has to equal fetched variant");

			this.oSmartChart.applyVariant("STANDARD");
			var oResultVariant = this.oSmartChart.fetchVariant();
			deepEqual(oResultVariant, {}, "applied STANDARD variant should return empty variant");
			ok(bChartReseted, "applying STANDARD variant should reset chart");
		});

		test("test add Spacer", function() {
			this.oSmartChart._createToolbar();
			this.oSmartChart._addSpacerToToolbar();

			equal(this.oSmartChart._oToolbar.getContent().length, 1, "one item has to be added to the toolbar");
			ok(this.oSmartChart._oToolbar.getContent()[0] instanceof sap.m.ToolbarSpacer, "ToolbarSpacer has to be added to toolbar");
		});

		test("test _getChangeStatus", function() {
			jQuery.sap.require("sap.ui.comp.personalization.Controller");

			var returnedChangeStatus = this.oSmartChart._getChangeStatus();
			equal(returnedChangeStatus, sap.ui.comp.personalization.ChangeType.ModelChanged, "change status has to be correct");

			returnedChangeStatus = this.oSmartChart._getChangeStatus({
				sort: sap.ui.comp.personalization.ChangeType.Unchanged,
				filter: sap.ui.comp.personalization.ChangeType.Unchanged,
				columns: sap.ui.comp.personalization.ChangeType.Unchanged,
				group: sap.ui.comp.personalization.ChangeType.Unchanged
			});
			equal(returnedChangeStatus, sap.ui.comp.personalization.ChangeType.Unchanged, "change status has to be correct");

			returnedChangeStatus = this.oSmartChart._getChangeStatus({
				sort: sap.ui.comp.personalization.ChangeType.Unchanged,
				filter: sap.ui.comp.personalization.ChangeType.Unchanged,
				dimeasure: sap.ui.comp.personalization.ChangeType.TableChanged,
				group: sap.ui.comp.personalization.ChangeType.Unchanged
			});
			equal(returnedChangeStatus, sap.ui.comp.personalization.ChangeType.TableChanged, "change status has to be correct");

			returnedChangeStatus = this.oSmartChart._getChangeStatus({
				sort: sap.ui.comp.personalization.ChangeType.Unchanged,
				filter: sap.ui.comp.personalization.ChangeType.Unchanged,
				dimeasure: sap.ui.comp.personalization.ChangeType.TableChanged,
				group: sap.ui.comp.personalization.ChangeType.ModelChanged
			});
			equal(returnedChangeStatus, sap.ui.comp.personalization.ChangeType.ModelChanged, "change status has to be correct");

		});

		test("test _persistPersonalization", function() {
			var fCallBack;
			var oFinalParams;
			this.oSmartChart._oVariantManagement = {
				getVariantsInfo: function(callBack) {
					fCallBack = callBack;
				},
				fireSave: function(oParams) {
					oFinalParams = oParams;
				},
				detachInitialise: function() {
				},
				detachAfterSave: function() {
				},
				detachSave: function() {
				},
				isPageVariant: function() {
				}
			};

			this.oSmartChart._persistPersonalisation();
			equal(typeof fCallBack, "function", "callback function has to be provided");

			fCallBack([]);
			deepEqual(oFinalParams, {
				name: "Personalisation",
				global: false,
				overwrite: false,
				key: null,
				def: true
			}, "fire save has to be called with correct parameters");

			fCallBack([
				{
					key: "123"
				}
			]);
			deepEqual(oFinalParams, {
				name: "Personalisation",
				global: false,
				overwrite: true,
				key: "123",
				def: true
			}, "fire save has to be called with correct parameters");
		});

		test("test _createVariantManagementControl", function() {
			this.oSmartChart.setUseVariantManagement(true);
			this.oSmartChart.setPersistencyKey("foo");

			sinon.spy(sap.ui.comp.smartvariants, "PersonalizableInfo");

			this.oSmartChart._createVariantManagementControl();

			var oControl = sap.ui.comp.smartvariants.PersonalizableInfo.thisValues[0].getControl();

			equal(this.oSmartChart._oVariantManagement.getPersonalizableControls()[0].getType(), "chart", "PersonalizableInfo.type has to be set correctly");
			equal(this.oSmartChart._oVariantManagement.getPersonalizableControls()[0].getKeyName(), "persistencyKey", "PersonalizableInfo.keyName has to be set correctly");
			ok(oControl === this.oSmartChart.getId(), "PersonalizableInfo Control has to be set to SmartChart");

			equal(this.oSmartChart._oVariantManagement.getShowShare(), true, "SmartVariantManagement has to be instantiated correctly - showShare");
			ok(this.oSmartChart._oVariantManagement.getPersonalizableControls()[0] === sap.ui.comp.smartvariants.PersonalizableInfo.thisValues[0], "SmartVariantManagement has to be instantiated correctly - personalizableControls");

			this.oSmartChart._oVariantManagement._initialize({}, this.oSmartChart._oVariantManagement._getControlWrapper(sap.ui.getCore().byId(oControl)));
			equal(this.oSmartChart._oCurrentVariant, "STANDARD", "current variant has to be initialized");
		});

		test("test getChart function", function() {
			var oDummy = {};
			this.oSmartChart._oChart = oDummy;

			equal(this.oSmartChart.getChart(), oDummy);
		});

		test("test _addSeparatorToToolbar function", function() {
			var oInsertedObject = null;
			var iInsertIndex = -1;
			var sExistingHeight, sHeight;
			this.oSmartChart.setHeader("Dummy");
			this.oSmartChart.setUseVariantManagement(true);
			this.oSmartChart._oToolbar = {
				getHeight: function() {
					return sExistingHeight;
				},
				setHeight: function(sSetHeight) {
					sHeight = sSetHeight;
				},
				insertContent: function(oObject, iIndex) {
					iInsertIndex = iIndex;
					oInsertedObject = oObject;
				}
			};

			this.oSmartChart._oVariantManagement = {
				isPageVariant: function() {
					return false;
				}
			};

			this.oSmartChart._addSeparatorToToolbar();
			ok(oInsertedObject instanceof sap.m.ToolbarSeparator, "object instanceof ToolbarSeparator should have been added");
			equal(iInsertIndex, 0, "separator should be inserted at index 0");

			equal(sHeight, "3rem", "default height shall be 3rem, if nothing is set");

			this.oSmartChart._oVariantManagement = null;
		});

		test("test _addVariantManagementToToolbar  function", function() {
			var oDummyVariantManagement = {
				isPageVariant: function() {
					return false;
				},
				detachInitialise: function() {
				},
				detachAfterSave: function() {
				},
				detachSave: function() {
				}
			};
			var oInsertedObject = null;
			var iInsertIndex = -1;
			this.oSmartChart._oVariantManagement = oDummyVariantManagement;

			this.oSmartChart.setUseVariantManagement(true);
			this.oSmartChart._oToolbar = {
				insertContent: function(oObject, iIndex) {
					iInsertIndex = iIndex;
					oInsertedObject = oObject;
				}
			};

			this.oSmartChart._addVariantManagementToToolbar(true);
			equal(oInsertedObject, oDummyVariantManagement, "variant management object should have been inserted");
			equal(iInsertIndex, 0, "variant management should be inserted at index 0");
		});

		test("test _addPersonalisationToToolbar function", function() {
			var bDialogOpen = false;

			this.oSmartChart._oPersController = {
				openDialog: function() {
					bDialogOpen = true;
				}
			};

			var oAddedToToolbar = null;

			this.oSmartChart.setUseChartPersonalisation(true);
			this.oSmartChart._oToolbar = {
				addContent: function(oObject) {
					oAddedToToolbar = oObject;
				}
			};

			this.oSmartChart._addPersonalisationToToolbar();
			ok(oAddedToToolbar instanceof sap.m.Button);

			oAddedToToolbar.firePress();
			ok(bDialogOpen);
		});

		test("test reBindChart function", function() {
			var oBindingParameters = null;
			var bBeforeRebindCalled = false;
			var bPreventBinding;

			this.oSmartChart._oChart = new sap.chart.Chart();

			var fBindStub = sinon.stub(this.oSmartChart._oChart, "bindData");

			this.oSmartChart.attachBeforeRebindChart(function(oParams) {
				bBeforeRebindCalled = true;
				oParams.getParameter("bindingParams").preventChartBind = bPreventBinding;
				oParams.getParameter("bindingParams").parameters["select"] = [
					"foo"
				];
			});

			bPreventBinding = true;
			this.oSmartChart.rebindChart();

			ok(bBeforeRebindCalled, "before rebind has to be called");
			ok(!this.oSmartChart._bIsChartBound, "chart has to be unbound because of prevent binding");
			ok(!this.oSmartChart._oChart.getBusy(), "internal chart has to set busy flag to false because of prevent binding");

			bPreventBinding = false;
			this.oSmartChart.rebindChart();

			ok(this.oSmartChart._bIsChartBound, "chart has to be bound");
			ok(this.oSmartChart._oChart.getBusy(), "internal chart has to set busy flag");

			ok(fBindStub.calledOnce, "binding triggered on the internal chart");

			oBindingParameters = fBindStub.args[0][0];

			ok(oBindingParameters, "binding parameters are set");

			oBindingParameters.events.dataReceived();

			ok(!this.oSmartChart._oChart.getBusy(), "internal chart busy flag reseted");

		});

		test("test CurrentVariantId property", function() {
			sinon.stub(jQuery.sap.log, "error");
			this.oSmartChart.setCurrentVariantId("dummy");

			ok(jQuery.sap.log.error.calledOnce, "variantManagement not in place, error should have been logged");

			var bGetterCalled = false;
			var bSetterCalled = false;
			var sSetVariantId = null;

			var sVariantId = "MyVariantId";

			this.oSmartChart._oVariantManagement = {
				getCurrentVariantId: function() {
					bGetterCalled = true;
					return sSetVariantId;
				},
				setCurrentVariantId: function(sId) {
					bSetterCalled = true;
					sSetVariantId = sId;
				},
				detachInitialise: function() {
				},
				detachAfterSave: function() {
				},
				detachSave: function() {
				},
				isPageVariant: function() {
				}
			};

			this.oSmartChart.setCurrentVariantId(sVariantId);

			ok(bSetterCalled, "setter has to be called on internal variantmanagement");
			equal(sSetVariantId, sVariantId, "set variant id has to be correct");

			var sReturnedId = this.oSmartChart.getCurrentVariantId();
			ok(bGetterCalled, "Getter has to be called on internal variantmanagement");
			equal(sReturnedId, sVariantId, "get variant id has to be correct");
		});

		test("test _createContent function with perso data", function() {

			this.oSmartChart._oChart = new sap.chart.Chart();
			this.oSmartChart._oChartViewMetadata = {
				fields: [
					{
						name: "A_DIMENSION",
						isDimension: true,
						isMeasure: false,
						additionalProperty: {},
						sortable: true,
						filterable: true,
						filterType: "",
						maxLength: 1,
						precision: 1,
						scale: 1,
						role: "",
						aggregationRole: ""
					}, {
						name: "A_MEASURE",
						isDimension: false,
						isMeasure: true,
						additionalProperty: {},
						sortable: true,
						filterable: true,
						filterType: "",
						maxLength: 1,
						precision: 1,
						scale: 1,
						role: "",
						aggregationRole: ""
					}, {
						name: "A_FILTER",
						isDimension: false,
						isMeasure: false,
						additionalProperty: {},
						sortable: false,
						filterable: true,
						filterType: "",
						maxLength: 1,
						precision: 1,
						scale: 1,
						role: "",
						aggregationRole: ""
					}, {
						name: "B_FILTER",
						isDimension: false,
						isMeasure: false,
						additionalProperty: {},
						sortable: true,
						filterable: false,
						filterType: "",
						maxLength: 1,
						precision: 1,
						scale: 1,
						role: "",
						aggregationRole: ""
					}
				]
			};

			this.oSmartChart._createContent();

			var aDimensions = this.oSmartChart._oChart.getDimensions();
			ok(aDimensions);
			ok(aDimensions.length, 1);
			ok(aDimensions[0].data("p13nData"));

			var aMeasures = this.oSmartChart._oChart.getMeasures();
			ok(aMeasures);
			ok(aMeasures.length, 1);
			ok(aMeasures[0].data("p13nData"));

			var aData = this.oSmartChart._oChart.data("p13nData");
			ok(aData);
			ok(aData.length, 2);

		});

		/*
		 test("test _showChartFilterDialog function", function(){
		 var bOpenDialogWasCalled = false;									
		 this.oSmartChart._oPersController = {
		 openDialog: function(){
		 bOpenDialogWasCalled = true;
		 }
		 }
		 this.oSmartChart._createChart();
		
		 this.oSmartChart._oChart.fireCustomFilter();
		
		 ok(bOpenDialogWasCalled, "attachCustomFilter has to be registered correctly");
		 });
		 */

		test("test _setIgnoreFromPersonalisationToSettings function", function() {

			this.oSmartChart.setIgnoreFromPersonalisation("a,b,c,d");

			var oResult = this.oSmartChart._setIgnoreFromPersonalisationToSettings(null);
			var oExpected = {
				dimeasure: {
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				},
				filter: {
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				},
				sort: {
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				}
			}

			deepEqual(oResult, oExpected, "settings have to be correct with empty settings");

			oResult = this.oSmartChart._setIgnoreFromPersonalisationToSettings({
				filter: {
					dummy: "Test"
				},
				dimeasure: {
					dummy: "Test"
				}
			});
			oExpected = {
				dimeasure: {
					dummy: "Test",
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				},
				filter: {
					dummy: "Test",
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				},
				sort: {
					ignoreColumnKeys: [
						"a", "b", "c", "d"
					]
				}
			}

			deepEqual(oResult, oExpected, "settings have to be correct with prefilled settings");
		});

		test("test _getAvailableChartTypes function", function() {
			var oReturn, aChartTypes;
			var oReturnNull = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}, {
						chart: 'column'
					}
				]
			};
			var oReturnOne = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}, {
						chart: 'column'
					}, {
						chart: 'dual_bar'
					}
				]
			};

			var oChart = {
				getAvailableChartTypes: function() {
					return (oReturn);
				}
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar",
				bubble: "Bubble",
				bullet: "Bullet",
				column: "Column",
				dual_bar: "Dual Bar"
			});

			this.oSmartChart.setIgnoredChartTypes("bar, bubble, bullet, column");

			this.oSmartChart._oChart = oChart;

			oReturn = oReturnNull;
			aChartTypes = this.oSmartChart._getAvailableChartTypes();
			ok(aChartTypes);
			deepEqual(aChartTypes.length, 0);

			oReturn = oReturnOne;
			aChartTypes = this.oSmartChart._getAvailableChartTypes();
			ok(aChartTypes);
			deepEqual(aChartTypes.length, 1);
			deepEqual(aChartTypes[0].key, "dual_bar");

			this.oSmartChart.setIgnoredChartTypes("");
			aChartTypes = this.oSmartChart._getAvailableChartTypes();
			ok(aChartTypes);
			deepEqual(aChartTypes.length, 5);

		});

		test("test _getAllChartTypes function", function() {
			var oReturn, aChartTypes;
			var oIgnore = {
				bar: "Bar",
				bubble: "Bubble",
				bullet: "Bullet",
				column: "Column"
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar",
				bubble: "Bubble",
				bullet: "Bullet",
				column: "Column",
				dual_bar: "Dual Bar"
			});

			aChartTypes = this.oSmartChart._getAllChartTypes();
			ok(aChartTypes);

			var maxLength = aChartTypes.length;

			this.oSmartChart.setIgnoredChartTypes("bar, bubble, bullet, column");
			aChartTypes = this.oSmartChart._getAllChartTypes();
			ok(aChartTypes);
			deepEqual(aChartTypes.length, maxLength - 4);

			this.oSmartChart.setIgnoredChartTypes("bar");
			aChartTypes = this.oSmartChart._getAllChartTypes();
			ok(aChartTypes);
			deepEqual(aChartTypes.length, maxLength - 1);

		});

		test("Destroy", function() {
			var bChartProviderDestroyed = false;
			var bPersControllerDestroyed = false;
			var bVariantManagementDestroyed = false;
			this.oSmartChart._oChartProvider = {
				destroy: function() {
					bChartProviderDestroyed = true;
				}
			}

			this.oSmartChart._oPersController = {
				destroy: function() {
					bPersControllerDestroyed = true;
				}
			}

			this.oSmartChart._oVariantManagement = {
				destroy: function() {
					bVariantManagementDestroyed = true;
				},
				isPageVariant: function() {
					return false;
				},
				detachInitialise: function() {
				},
				detachAfterSave: function() {
				},
				detachSave: function() {
				}
			}

			equal(this.oSmartChart.bIsDestroyed, undefined);
			this.oSmartChart.destroy();
			equal(this.oSmartChart._oChartProvider, null);
			equal(this.oSmartChart._aChartViewMetadata, null);
			strictEqual(this.oSmartChart.bIsDestroyed, true);
			ok(bChartProviderDestroyed, "chart provider has to be destroyed");
			ok(bPersControllerDestroyed, "pers controller has to be destroyed");
			ok(bVariantManagementDestroyed, "variant management has to be destroyed");
		});

		test("test _getSortedDimensions function", function() {

			function Dim(sLabel) {
				this._sLabel = sLabel;
			}
			;
			Dim.prototype.getLabel = function() {
				return this._sLabel;
			}

			var aLabels = [
				new Dim("Gamma"), new Dim("Beta"), new Dim("Omega"), new Dim("Alpha")
			];

			var oChart = {
				getDimensions: function() {
					return (aLabels);
				}
			};

			this.oSmartChart._oChart = oChart;
			var aSortedDim = this.oSmartChart._getSortedDimensions();
			ok(aSortedDim);
			strictEqual(aSortedDim[0].getLabel(), "Alpha");
			strictEqual(aSortedDim[1].getLabel(), "Beta");
			strictEqual(aSortedDim[2].getLabel(), "Gamma");
			strictEqual(aSortedDim[3].getLabel(), "Omega");

		});

		test("test _createChartTypeSegmentedButton", function() {
			var oReturn, aChartTypes;
			oReturn = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}, {
						chart: 'column'
					}
				]
			};

			var oChart = {
				getAvailableChartTypes: function() {
					return ({});
				},
				getChartType: function() {
					return {};
				}
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar"
			});
			sinon.stub(this.oSmartChart, "_updateVisibilityOfChartTypes");

			this.oSmartChart._oChart = oChart;
			var oSegmentedButton = this.oSmartChart._createChartTypeSegmentedButton();

			ok(oSegmentedButton);

			var aButtons = oSegmentedButton.getButtons();
			ok(aButtons);
			equal(aButtons.length, 0);
		});

		test("test _createChartTypeSegmentedButton with list", function() {
			var oReturn, aChartTypes;
			oReturn = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}
				]
			};

			var oChart = {
				getAvailableChartTypes: function() {
					return ({});
				},
				getChartType: function() {
					return {};
				}
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar"
			}, {
				bubble: "Bubble"
			}, {
				bullet: "Bullet"
			}, {
				donut: "Donut"
			});

			this.oSmartChart._oChart = oChart;
			var oSegmentedButton = this.oSmartChart._createChartTypeSegmentedButton();

			ok(oSegmentedButton);

			var aButtons = oSegmentedButton.getButtons();
			ok(aButtons);
			equal(aButtons.length, 2);

			equal(aButtons[0], this.oSmartChart._oButtonChart4);
			equal(aButtons[1], this.oSmartChart._oButtonChart5);
		});

		test("test _createChartTypeSegmentedButton with three buttons", function() {
			var oReturn, aChartTypes;
			oReturn = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}
				]
			};

			var oChart = {
				getAvailableChartTypes: function() {
					return (oReturn);
				},
				getChartType: function() {
					return {};
				}
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar",
				bubble: "Bubble",
				bullet: "Bullet",
				donut: "Donut"
			});

			this.oSmartChart._oChart = oChart;

			this.oSmartChart.setUseListForChartTypeSelection(false);
			var oSegmentedButton = this.oSmartChart._createChartTypeSegmentedButton();

			ok(oSegmentedButton);

			var aButtons = oSegmentedButton.getButtons();
			ok(aButtons);
			equal(aButtons.length, 3);

			equal(aButtons[0], this.oSmartChart._oButtonChart3);
			equal(aButtons[1], this.oSmartChart._oButtonChart2);
			equal(aButtons[2], this.oSmartChart._oButtonChart1);
		});

		test("test _createChartTypeSegmentedButton with one buttons", function() {
			var oReturn, aChartTypes;
			oReturn = {
				available: [
					{
						chart: 'bar'
					}, {
						chart: 'bubble'
					}, {
						chart: 'bullet'
					}
				]
			};

			var oChart = {
				getAvailableChartTypes: function() {
					return (oReturn);
				},
				getChartType: function() {
					return {};
				}
			};

			sinon.stub(this.oSmartChart, "_getChartTypes").returns({
				bar: "Bar",
				bubble: "Bubble",
				bullet: "Bullet",
				donut: "Donut"
			});

			this.oSmartChart._oChart = oChart;

			this.oSmartChart.setUseListForChartTypeSelection(false);
			this.oSmartChart.setIgnoredChartTypes("bar,bullet");
			var oSegmentedButton = this.oSmartChart._createChartTypeSegmentedButton();

			ok(oSegmentedButton);

			var aButtons = oSegmentedButton.getButtons();
			ok(aButtons);
			equal(aButtons.length, 1);

			equal(aButtons[0], this.oSmartChart._oButtonChart1);
		});

	}());
</script>
</head>
<body id="body" class="sapUiBody">
	<h1 id="qunit-header">qUnit Page for
		sap.ui.comp.smartchart.SmartChart</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>

	<div id="content"></div>
</body>
</html>