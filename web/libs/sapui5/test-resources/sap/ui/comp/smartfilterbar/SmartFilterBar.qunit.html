<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>qUnit Page for sap.ui.comp.smartfilterbar.SmartFilterBar</title>

<script id="sap-ui-bootstrap" type="text/javascript"
	src="../../../../../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.ui.comp">	
</script>

<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript">

	if(!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
		jQuery.sap.require("sap.ui.qunit.qunit-coverage");
	} 		
	
	(function() {

		jQuery.sap.require("sap.ui.comp.smartfilterbar.SmartFilterBar");
		jQuery.sap.require("sap.ui.comp.smartfilterbar.ControlConfiguration");
		jQuery.sap.require("sap.ui.comp.smartfilterbar.GroupConfiguration");
		jQuery.sap.require("sap.ui.comp.smartfilterbar.SelectOption");	
		jQuery.sap.require("sap.m.Input");
		
		module("sap.ui.comp.smartfilterbar.SmartFilterBar", {
			setup: function() {
				this.oSmartFilter = new sap.ui.comp.smartfilterbar.SmartFilterBar();
			},
			teardown: function() {
				this.oSmartFilter.destroy();
			}
		});

		test("Shall be instantiable", function() {
			ok(this.oSmartFilter);
		});
		
		test("Shall have entityType property", function() {
			this.oSmartFilter.setEntityType("foo");
			strictEqual(this.oSmartFilter.getEntityType(),"foo");
		});
		
		test("Shall have resourceUri property", function() {
			this.oSmartFilter.setResourceUri("foo");
			strictEqual(this.oSmartFilter.getResourceUri(),"foo");
		});
		
		test("Shall have getFilters method", function() {
			var aFilters = this.oSmartFilter.getFilters();
			strictEqual(aFilters.length,0);
		});
		
		test("Shall delegate getFilters call to FilterProvider", function() {
			var aVisibleFields = ["Company","foo","bar"];
			var aRequestedFields = ["foo", "Ledger"];
			var fVisibleFieldStub = sinon.stub(this.oSmartFilter,"_getVisibleFieldNames");
			fVisibleFieldStub.returns(aVisibleFields);
			this.oSmartFilter._oFilterProvider= {getFilters : sinon.stub()};
			
			this.oSmartFilter.getFilters();			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilters.calledOnce,true);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilters.calledWithExactly(aVisibleFields), true);
			
			this.oSmartFilter._oFilterProvider.getFilters.reset();
			
			this.oSmartFilter.getFilters(aRequestedFields);			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilters.calledOnce,true);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilters.calledWithExactly(aRequestedFields), true);
			
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate getFilledFilterData method to FilterProvider by default", function() {
			this.oSmartFilter._oFilterProvider= {getFilterData : sinon.stub(),getFilledFilterData:sinon.stub()};
			this.oSmartFilter.getFilterData();			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilterData.calledOnce,false);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilledFilterData.calledOnce,true);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate getFilterDataAsString method to FilterProvider by default", function() {
			this.oSmartFilter._oFilterProvider= {getFilterDataAsString : sinon.stub(),getFilledFilterDataAsString:sinon.stub()};			
			this.oSmartFilter.getFilterDataAsString();			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilterDataAsString.calledOnce,false);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilledFilterDataAsString.calledOnce,true);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate getFilterData method to FilterProvider if true is passed", function() {
			this.oSmartFilter._oFilterProvider= {getFilterData : sinon.stub(),getFilledFilterData:sinon.stub()};
			this.oSmartFilter.getFilterData(true);			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilterData.calledOnce,true);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilledFilterData.calledOnce,false);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate getFilterDataAsString method to FilterProvider if true is passed", function() {
			this.oSmartFilter._oFilterProvider= {getFilterDataAsString : sinon.stub(),getFilledFilterDataAsString:sinon.stub()};			
			this.oSmartFilter.getFilterDataAsString(true);			
			strictEqual(this.oSmartFilter._oFilterProvider.getFilterDataAsString.calledOnce,true);
			strictEqual(this.oSmartFilter._oFilterProvider.getFilledFilterDataAsString.calledOnce,false);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate setFilterData method to FilterProvider", function() {
			var oObj = {foo: "bar"};
			this.oSmartFilter._oFilterProvider= {setFilterData : sinon.stub()};
			this.oSmartFilter.setFilterData(oObj);			
			strictEqual(this.oSmartFilter._oFilterProvider.setFilterData.calledOnce,true);
			strictEqual(this.oSmartFilter._oFilterProvider.setFilterData.calledWith(oObj),true);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Shall delegate setFilterDataAsString method to FilterProvider", function() {
			var sObj = "{\"foo\":\"bar\"}";			
			this.oSmartFilter._oFilterProvider= {setFilterData : sinon.stub()};
			this.oSmartFilter.setFilterDataAsString(sObj);			
			strictEqual(this.oSmartFilter._oFilterProvider.setFilterData.calledOnce,true);
			strictEqual(JSON.stringify(this.oSmartFilter._oFilterProvider.setFilterData.args[0][0]),sObj);
			this.oSmartFilter._oFilterProvider = null;
		});
		
		test("Destroy", function() {
			equal(this.oSmartFilter.bIsDestroyed, undefined);
			this.oSmartFilter.destroy();
			equal(this.oSmartFilter._oFilterProvider, null);
			equal(this.oSmartFilter._aFilterBarViewMetadata,null);
			strictEqual(this.oSmartFilter.bIsDestroyed, true);
		});	
		
// 		test("Shall clear all fields and fire an event when the user clicks on the reset button", function() {
// 			var fEventHandler;
			
// 			fEventHandler = sinon.stub();
// 			this.oSmartFilter.attachReset(fEventHandler)
// 			sinon.spy(this.oSmartFilter,"_resetFilterFields")			
// 			this.oSmartFilter._oFilterProvider = {reset:sinon.stub()};
			
// 			//Call CUT
// 			this.oSmartFilter.reset();
			
// 			ok(this.oSmartFilter._resetFilterFields.calledOnce);
// 			ok(this.oSmartFilter._oFilterProvider.reset.calledOnce);
// 			ok(fEventHandler.calledOnce);
// 		});	
		



		test("Shall pass the BasicSearchFieldName to the FilterProvider", function() {

			sinon.stub(this.oSmartFilter, "_initializeVariantManagement");
			sinon.stub(this.oSmartFilter, "getModel");
			
			this.oSmartFilter.getModel.returns(sinon.createStubInstance(sap.ui.model.odata.ODataModel));
			
			this.oSmartFilter.setBasicSearchFieldName("CompanyCode");
			this.oSmartFilter.setEntityType("COMPANY");
			sinon.stub(sap.ui.comp.smartfilterbar, "FilterProvider").returns({ attachPendingChange: function() {}});
			
			//Call CUT
			this.oSmartFilter._createFilterProvider();
			
			ok(sap.ui.comp.smartfilterbar.FilterProvider.calledOnce);
			strictEqual(sap.ui.comp.smartfilterbar.FilterProvider.args[0][0].basicSearchFieldName, "CompanyCode");
			sap.ui.comp.smartfilterbar.FilterProvider.restore();
		});
		
		
		test("_handleControlConfigurationChanged shall set the visible property of the FilterItem", function() {
			var oControlConfiguration, oFilterItem;
			oControlConfiguration = {getVisible:sinon.stub().returns(true), getKey:sinon.stub()};
			oFilterItem = {setVisible: sinon.stub()};
			this.oSmartFilter._getFilterItemByName = sinon.stub().returns(oFilterItem);
			
			//Call CUT
			this.oSmartFilter._handleControlConfigurationChanged({getParameter: sinon.stub().returns("visible"), oSource: oControlConfiguration});
			
			ok(oFilterItem.setVisible.calledOnce);
			strictEqual(oFilterItem.setVisible.args[0][0], true);
		});
		
		test("_handleControlConfigurationChanged shall set the label property of the FilterItem", function() {
			var oControlConfiguration, oFilterItem;
			oControlConfiguration = {getLabel:sinon.stub().returns("HelloWorld"), getKey:sinon.stub()};
			oFilterItem = {setLabel: sinon.stub()};
			this.oSmartFilter._getFilterItemByName = sinon.stub().returns(oFilterItem);
			
			//Call CUT
			this.oSmartFilter._handleControlConfigurationChanged({getParameter: sinon.stub().returns("label"), oSource: oControlConfiguration});
			
			ok(oFilterItem.setLabel.calledOnce);
			strictEqual(oFilterItem.setLabel.args[0][0], "HelloWorld");
		});
		
		
		
		test("_handleControlConfigurationChanged shall set the visibleInAdvancedArea property of the FilterItem", function() {
			var oControlConfiguration, oFilterItem;
			oControlConfiguration = {getVisibleInAdvancedArea:sinon.stub().returns(true), getKey:sinon.stub()};
			oFilterItem = {setVisibleInAdvancedArea: sinon.stub()};
			this.oSmartFilter._getFilterItemByName = sinon.stub().returns(oFilterItem);
			
			//Call CUT
			this.oSmartFilter._handleControlConfigurationChanged({getParameter: sinon.stub().returns("visibleInAdvancedArea"), oSource: oControlConfiguration});
			
			ok(oFilterItem.setVisibleInAdvancedArea.calledOnce);
			strictEqual(oFilterItem.setVisibleInAdvancedArea.args[0][0], true);
		});
		
		test("fireSearch shall call _validateMandatoryFields and show an error message if empty fields exist", function() {
			this.oSmartFilter._validateMandatoryFields = sinon.stub().returns(false);
			sap.m.MessageBox.show = sinon.stub();
			this.oSmartFilter.fireEvent = sinon.stub();
			
			this.oSmartFilter.search();			
			
			strictEqual(this.oSmartFilter._validateMandatoryFields.called, true);
			strictEqual(this.oSmartFilter.fireEvent.called, false);
			strictEqual(sap.m.MessageBox.show.calledOnce, true);
			
			this.oSmartFilter._validateMandatoryFields.returns(true);
			sap.m.MessageBox.show.reset();
			this.oSmartFilter.fireEvent.reset();
			
			this.oSmartFilter.search();	
			
			strictEqual(this.oSmartFilter._validateMandatoryFields.called, true);
			strictEqual(this.oSmartFilter.fireEvent.calledOnce, true);
			strictEqual(sap.m.MessageBox.show.called, false);
		});
		
		test("_validateMandatoryFields shall return true if no empty mandatory fields exist/default", function() {
			var bContinue = this.oSmartFilter._validateMandatoryFields();
			
			strictEqual(bContinue, true);
		});
		
		test("_validateMandatoryFields shall return true if no empty mandatory fields (modelled) exist", function() {
			var oData, aFilterItems, bContinue = false;
			oData = {foo:"bar"};
			aFilterItems = [{getName:sinon.stub().returns("foo"), getKey:sinon.stub(), data: sinon.stub().returns(false)}];
			this.oSmartFilter.getFilterData = sinon.stub().returns(oData);
			this.oSmartFilter.determineMandatoryFilterItems = sinon.stub().returns(aFilterItems);
			this.oSmartFilter.determineControlByFilterItem = sinon.stub().returns(new sap.m.Input());
			
			bContinue = this.oSmartFilter._validateMandatoryFields();
			strictEqual(bContinue, true);			
		});
		
		test("_validateMandatoryFields shall return true if no empty mandatory fields (custom) exist", function() {
			var oData={}, aFilterItems, bContinue = false;
			aFilterItems = [{getName:sinon.stub().returns("foo"), getKey:sinon.stub(), data: sinon.stub().returns(true)}];
			this.oSmartFilter.getFilterData = sinon.stub().returns(oData);
			this.oSmartFilter.determineMandatoryFilterItems = sinon.stub().returns(aFilterItems);
			this.oSmartFilter.determineControlByFilterItem = sinon.stub().returns(new sap.m.Input({value:"bar"}));
			
			bContinue = this.oSmartFilter._validateMandatoryFields();
			strictEqual(bContinue, true);			
		});
		
		test("_validateMandatoryFields shall return false if an empty mandatory field (modelled) exist", function() {
			var oData, aFilterItems, bContinue = false;			
			oData = {foo:""};
			aFilterItems = [{getName:sinon.stub().returns("foo"), getKey:sinon.stub(), data: sinon.stub().returns(false)}];
			this.oSmartFilter.getFilterData = sinon.stub().returns(oData);
			this.oSmartFilter.determineMandatoryFilterItems = sinon.stub().returns(aFilterItems);
			this.oSmartFilter.determineControlByFilterItem = sinon.stub().returns(new sap.m.Input());
			
			bContinue = this.oSmartFilter._validateMandatoryFields();
			strictEqual(bContinue, false);			
		});
		
		test("_validateMandatoryFields shall return false if an empty mandatory field (Custom) exist", function() {
			var oData={}, aFilterItems, bContinue = false;
			aFilterItems = [{getName:sinon.stub().returns("foo"), getKey:sinon.stub(), data: sinon.stub().returns(true)}];
			this.oSmartFilter.getFilterData = sinon.stub().returns(oData);
			this.oSmartFilter.determineMandatoryFilterItems = sinon.stub().returns(aFilterItems);
			this.oSmartFilter.determineControlByFilterItem = sinon.stub().returns(new sap.m.Input());
			
			bContinue = this.oSmartFilter._validateMandatoryFields();
			strictEqual(bContinue, false);			
		});
								
		test("check getFiltersWithValues", function() {
			
			var Control = function() {
				Control.prototype.getValue = function() {return "X"; };
				Control.prototype.data = function(s) { return true;};
			};
			
			var FilterItem = function(sName) {
				this.sName = sName;
				FilterItem.prototype.data = function(s) { return {}; };
				FilterItem.prototype.getName = function() { return this.sName; };
			};
			
			var aFilterItems = [new FilterItem("A"), new FilterItem("B"), new FilterItem("C"), new FilterItem("D")];	
			
			var oData = [];
			oData["B"] = "X";
			
			aFilterItems[2].data = sinon.stub().returns(null);
			aFilterItems[1].data = sinon.stub().returns(null);			
			
			
			this.oSmartFilter.getAllFilterItems = sinon.stub().returns(aFilterItems);
			this.oSmartFilter.getFilterData = sinon.stub().returns(oData);
			this.oSmartFilter.determineControlByFilterItem = sinon.stub();
			this.oSmartFilter.determineControlByFilterItem.withArgs(aFilterItems[0]).returns(new Control()); // getValue
			this.oSmartFilter.determineControlByFilterItem.withArgs(aFilterItems[1]).returns(new Control()); // odata value
			this.oSmartFilter.determineControlByFilterItem.withArgs(aFilterItems[2]).returns(new Control()); // odata no value
			this.oSmartFilter.determineControlByFilterItem.withArgs(aFilterItems[3]).returns(null);		     // no control			
			
			var aFiltersWithValues = this.oSmartFilter.getFiltersWithValues();
			ok(aFiltersWithValues);
			equal(aFiltersWithValues.length, 2);			
		});		
		
		test("check _checkForValues", function() {		
			var FilterItem = function(sName) {
				this.sName = sName;
				FilterItem.prototype.data = function(s) { return {}; };
				FilterItem.prototype.getName = function() { return this.sName; };
			};
			
			var oFilterItem = new FilterItem("A");
			var oControl = new sap.m.Input();
			sinon.spy(oControl, 'getValue');
			
			oControl.data("hasValue", true);
			var bHasValue = this.oSmartFilter._checkForValues({}, oFilterItem, oControl);
			equal(bHasValue, true);
			
			oControl.data("hasValue", false);
			var bHasValue = this.oSmartFilter._checkForValues({}, oFilterItem, oControl);
			equal(bHasValue, false);			
			
			oControl.data("hasValue", null);
			var bHasValue = this.oSmartFilter._checkForValues({}, oFilterItem, oControl);
			equal(bHasValue, false);  // via getValue		
			ok(oControl.getValue.calledOnce);
			
			
			oControl.data("hasValue", "false");
			var bHasValue = this.oSmartFilter._checkForValues({}, oFilterItem, oControl);
			equal(bHasValue, false);		
			
			oControl.data("hasValue", "true");
			var bHasValue = this.oSmartFilter._checkForValues({}, oFilterItem, oControl);
			equal(bHasValue, true);							
		});		
		
		test("check initialise event with variant management", function() {		
			
			var oInitialized = 0;
			ok(this.oSmartFilter._oSmartVariantManagement);
						
			this.oSmartFilter._oSmartVariantManagement.initialise = function() { oInitialized++; };
			sinon.stub(this.oSmartFilter._oSmartVariantManagement,"addPersonalizableControl");
				
			this.oSmartFilter.setPersistencyKey("DUMMY");
		
			this.oSmartFilter._initializeVariantManagement();
			
			equal(oInitialized, 1);			
			
		});
		
		test("check initialise with custom data executeStandardVariantOnSelect", function() {		
			
			if (this.oSmartFilter._oSmartVariantManagement) {
				this.oSmartFilter._oSmartVariantManagement.destroy();
				this.oSmartFilter._oSmartVariantManagement = null;
				this.oSmartFilter._oVariantManagement = null;						
			}			
			
			this.oSmartFilter.attachInitialise(function() { });
			
			this.oSmartFilter.data("executeStandardVariantOnSelect", true);
			this.oSmartFilter._createVariantManagement();
			ok(this.oSmartFilter._oSmartVariantManagement);
			
			var that = this;
			this.oSmartFilter._oSmartVariantManagement.initialise = function() {that.oSmartFilter.fireInitialise();};
			sinon.stub(this.oSmartFilter._oSmartVariantManagement,"addPersonalizableControl");
			this.oSmartFilter.setPersistencyKey("DUMMY");
			
			ok(!this.oSmartFilter._oSmartVariantManagement.bExecuteOnSelectForStandardViaXML);			
		
			this.oSmartFilter._initializeVariantManagement();
			
			ok(this.oSmartFilter._oSmartVariantManagement.bExecuteOnSelectForStandardViaXML);					
			
		});		

		test("check initialise event without persistency key", function() {		
			
			var oInitialized = 0;
				
			this.oSmartFilter.attachInitialise(function() {oInitialized++;});
			
			ok(this.oSmartFilter._oSmartVariantManagement);
			
			sinon.stub(this.oSmartFilter._oSmartVariantManagement,"initialise");					
		
			this.oSmartFilter._initializeVariantManagement();
			
			ok(!this.oSmartFilter._oSmartVariantManagement.initialise.called);
			
			equal(oInitialized, 1);	
		});		
		
		
		test("check initialise event without smart variant control", function() {		
			
			var oInitialized = 0;
			this.oSmartFilter.attachInitialise(function() {oInitialized++;});			
			
			this.oSmartFilter.setPersistencyKey("DUMMY");			
			sinon.stub(this.oSmartFilter._oSmartVariantManagement,"initialise");		
			this.oSmartFilter._oSmartVariantManagement = null;			
		
			this.oSmartFilter._initializeVariantManagement();
						
			equal(oInitialized, 1);
			
		});		
		
		test("check _getFilterInformation", function() {

			
			this.oSmartFilter._aFilterBarViewMetadata = [
				{
                   "groupName": "_BASIC",
                   "fields": [{
                       "fieldName": "BLDAT",
                       "type": "Edm.DateTime",
                       "filterRestriction": "multiple",
                       "isCustomFilterField": false,
                       "groupId": "_BASIC",
                       "control": {}                	   
                   }]
				},
                {
					"groupName": "GROUP1",
                     "fields": [{
                         "fieldName": "BLDAT2",
                         "type": "Edm.DateTime",
                         "filterRestriction": "multiple",
                         "isCustomFilterField": false,
                         "groupId": "GROUP1",
                         "control": {}                    	 
                     }]
				}];		
			                                               
			
			sinon.stub(this.oSmartFilter, "_handleEnter");
			sinon.stub(this.oSmartFilter, "_handleChange");			

			var aFields = this.oSmartFilter._getFilterInformation();
			ok(aFields);
			equal(aFields.length, 2);
			
			equal(aFields[0].fieldName, "BLDAT");
			equal(aFields[0].groupName, "__$INTERNAL$");
			ok(aFields[0].factory);

			equal(aFields[1].fieldName, "BLDAT2");
			equal(aFields[1].groupName, "GROUP1");
			ok(aFields[1].factory);
			
		});
		
		test("check addFieldToAdvancedArea ", function() {			
			var bVisibleInAdvancedArea = false;
			var oFilterItem = {
				setVisibleInAdvancedArea: function(bFlag) { bVisibleInAdvancedArea = bFlag }      
			} 
				
			sinon.stub(this.oSmartFilter, "_getFilterItemByName").returns(oFilterItem);
			ok(!bVisibleInAdvancedArea);
			this.oSmartFilter.addFieldToAdvancedArea("");
			ok(bVisibleInAdvancedArea);						
		});
		
		test("check getConditionTypeByKey", function() {			

			var oFilterProvider = {
			    _mConditionTypeFields : {			
			   			dummy : {			
							conditionType: "conditionType"
			   			}
			     }
			};
			this.oSmartFilter._oFilterProvider = oFilterProvider;
				
			var conditionType = this.oSmartFilter.getConditionTypeByKey("dummy");
			strictEqual(conditionType, "conditionType");		
						
		});		
		
		test("check setSmartVariant", function() {
			
			var oControl = new sap.m.Input({id:"dummy"});
			
			var aAssoc = this.oSmartFilter.getAssociation("smartVariant");
			ok(!aAssoc);
			
			this.oSmartFilter.setSmartVariant(oControl.getId());
			
			var aAssoc = this.oSmartFilter.getAssociation("smartVariant");			
			ok(aAssoc);	
			
			oControl.destroy();			
		});	
		
		test("check getSmartVariant", function() {
			
			var oControl = new sap.m.Input({id:"dummy"});
			
			sinon.stub(this.oSmartFilter, "getAssociation").returns(oControl.getId());
			var oSV = this.oSmartFilter.getSmartVariant();
			ok(oSV);
			strictEqual(oSV, oControl);
			
			sinon.stub(this.oSmartFilter, "getAdvancedMode").returns(true);
			oSV = this.oSmartFilter.getSmartVariant();
			ok(!oSV);
			
			oControl.destroy();			
						
		});	
		
		test("check fireReset", function() {		
			sinon.spy(this.oSmartFilter, "fireEvent");
			this.oSmartFilter.fireReset();
			
			ok(this.oSmartFilter.fireEvent.called);
		});			
		
		test("check fireClear", function() {		
			sinon.spy(this.oSmartFilter, "fireEvent");
			this.oSmartFilter.fireClear();
			
			ok(this.oSmartFilter.fireEvent.called);
		});		
		
		test("check _handleGroupConfigurationChanged", function() {	
			
			var sLabel = null;
			var oFilterGroupItem = {
				setGroupTitle: function(s) { sLabel = s; }               
			};
			
			var oEvent = {
			    oSource: {
			    	getLabel: function() {return "mylabel"; },
			    	getKey:  function() { return "";}
			    },          
			    getParameter: function(sName) { return "label"; }          
			};
			
			sinon.stub(this.oSmartFilter, "_getFilterGroupItemByGroupName").returns(oFilterGroupItem);
			
			ok(!sLabel);
			this.oSmartFilter._handleGroupConfigurationChanged(oEvent);			
			strictEqual(sLabel, "mylabel");
		});		
		
		test("check _createFieldInBasicArea", function() {		
			
			var oControl = new sap.m.Input({id:"dummy"});
			
			var oField =  {
				quickInfo : "quickinfo",
				label: "label",
				fieldName: "name",
				isMandatory: false,
				isVisible: true
			};
			sinon.spy(this.oSmartFilter, "addFilterItem");
			sinon.stub(this.oSmartFilter, "_createFilterFieldControl").withArgs(oField).returns(oField.control = oControl);
			
			sinon.stub(this.oSmartFilter, "getConditionTypeByKey").returns(false);
		
			var oFilter = this.oSmartFilter._createFieldInBasicArea(oField);
			ok(oFilter.factory);
			ok(!this.oSmartFilter.addFilterItem.called);
			
			oFilter.factory();
			ok(this.oSmartFilter.addFilterItem.called);		
			
			oControl.destroy();				
			
		});		
		
		test("check _onChange", function() {
			
			jQuery.sap.require("sap.ui.core.ValueState");
			var oControl = new sap.m.Input({id:"dummy"});
			
			oControl.setValueState(sap.ui.core.ValueState.Error);
			oControl.data("__mandatoryEmpty", true);
			
			var oEvent = {
			      getSource: function() { return oControl; },  
				  getParameter: function(s) { return "";}
			};
			
			this.oSmartFilter._oFilterProvider = {
				_updateConditionTypeFields: sinon.stub()                                 
			};
			
			this.oSmartFilter._onChange(oEvent);			
			strictEqual(oControl.getValueState(), sap.ui.core.ValueState.None);			
			
			oControl.data("__mandatoryEmpty", null);
			oControl.data("__validationError", true);			
			oControl.setValueState(sap.ui.core.ValueState.Error);			

			this.oSmartFilter._onChange(oEvent);			
			strictEqual(oControl.getValueState(), sap.ui.core.ValueState.None);	
			
			oControl.destroy();				
		});		
		
		test("check _getFilterItemByName", function() {		
			
			
			var FilterItem = function(sName) {
				this.sName = sName;				
				FilterItem.prototype.getName = function() { return this.sName; };
			};
		
			var aFilters = [new FilterItem("f0"), new FilterItem("f1")];
			var aGroupFilters = [new FilterItem("g0"), new FilterItem("g1")];
			
			sinon.stub(this.oSmartFilter, "getFilterItems").returns(aFilters);
			sinon.stub(this.oSmartFilter, "getFilterGroupItems").returns(aGroupFilters);			
			
			var oFilter = this.oSmartFilter._getFilterItemByName("f1");
			strictEqual(oFilter, aFilters[1]);
			
		});				
		
		test("check _getFilterGroupItemByGroupName", function() {		
			
			
			var FilterItem = function(sName) {
				this.sName = sName;				
				FilterItem.prototype.getGroupName = function() { return this.sName; };				
			};
		
			var aGroupFilters = [new FilterItem("g0"), new FilterItem("g1")];
			
			sinon.stub(this.oSmartFilter, "getFilterGroupItems").returns(aGroupFilters);			
			
			var oFilter = this.oSmartFilter._getFilterGroupItemByGroupName("g1");
			strictEqual(oFilter, aGroupFilters[1]);
			
		});			

		test("check _createFilterFieldControl", function() {		

			var oControl = new sap.m.Input({id:"dummy"});
			
			var oField = {
			  conditionType : {
				  initializeFilterItem: function() {}
			  },
			  fCreateControl : function (oField) { return oControl; }
			};

			this.oSmartFilter._createFilterFieldControl(oField);	
			ok(oField.control);			
			oField.control.destroy();
			
			delete oField.conditionType;
			this.oSmartFilter._createFilterFieldControl(oField);	
			ok(oField.control);			
			oField.control.destroy();			
		});			
		
		test("check triggerSearch", function() {		
			sinon.stub(this.oSmartFilter, "search");
			
			var sinonClock = sinon.useFakeTimers();			
			this.oSmartFilter.triggerSearch();
			ok(this.oSmartFilter.search.notCalled);
			sinonClock.tick(sap.ui.comp.smartfilterbar.SmartFilterBar.LIVE_MODE_INTERVAL);
			sinonClock.restore();

			ok(this.oSmartFilter.search.calledOnce);			
		});		
	}());
</script>
</head>
<body id="body" class="sapUiBody">
	<h1 id="qunit-header">qUnit Page for
		sap.ui.comp.smartfilterbar.SmartFilterBar</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>

	<div id="content"></div>
</body>
</html>
