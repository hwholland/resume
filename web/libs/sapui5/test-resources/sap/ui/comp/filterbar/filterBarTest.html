<!DOCTYPE HTML>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">


<script id="sap-ui-bootstrap" type="text/javascript"
	data-sap-ui-libs="sap.ui.comp,sap.m"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-preload="sync"
	data-sap-ui-compatVersion="edge"
	src="../../../../../resources/sap-ui-core.js">
</script>


<script type="text/javascript">

var that = this;
this.oFilterBar = new sap.ui.comp.filterbar.FilterBar({id: "theFilterBar", showClearButton:true});

var sCurrentVariantId = null;

var fsetNonVisibleOnFBFilters = function() {
	fCleanUp();
	this.oFilterBar.setFilterBarExpanded(false);	
	
	fSetTestData2(false);
	
};

var fsetNoFilters = function() {
	fCleanUp();
	this.oFilterBar.setFilterBarExpanded(false);
	this.oFilterBar._filterBarExpandedState();
};

var fConsiderGroupTitle = function() {
	var bFlag = this.oFilterBar.getConsiderGroupTitle();
	
	this.oFilterBar.setConsiderGroupTitle(!bFlag);
};

var fgetCurrentVariantId = function() {
	var sKey = this.oFilterBar.getCurrentVariantId();
	//alert("current variant id:" + sKey);
	
	sCurrentVariantId = sKey;
};

var fsetCurrentVariantId = function() {

	//alert("set current variant id:" + sCurrentVariantId);
	
	this.oFilterBar.setCurrentVariantId(sCurrentVariantId);
};

var fsetCollectiveSearch = function() {

	if (this.oFilterBar.getAdvancedMode()) {
		var oCollectiveSearch = new sap.ui.comp.variants.VariantManagement();
		this.oFilterBar._setCollectiveSearch(oCollectiveSearch);
	}
};

var fDetermineMandatory = function() {
	jQuery.sap.log.info("count of mandatory fields: <" + that.oFilterBar.determineMandatoryFilterItems().length + ">");	
};


var toggleMandBA = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myMandBA");
		this.oModel.setProperty("/myMandBA", !bValue);
	}
};


var toggleMandAA = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myMandAA");
		this.oModel.setProperty("/myMandAA", !bValue);
	}
};

var toggleBA = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myVisible");
		this.oModel.setProperty("/myVisible", !bValue);
	}
};

var toggleAA = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myAAVisible");
		this.oModel.setProperty("/myAAVisible", !bValue);
	}
};


var toggleFBA = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myVisibleFBA");
		this.oModel.setProperty("/myVisibleFBA", !bValue);
	}
};

var toggleFBB = function() {
	if (this.oModel) {
		var bValue = this.oModel.getProperty("/myVisibleFBB");
		this.oModel.setProperty("/myVisibleFBB", !bValue);
	}
};


var toggleTitleRenameA = function() {
	if (this.oModel) {
		var sLongTitle = "GROUP1 with a long long long long long lang long title";
		var sShortTitle = "GROUP1 short title";
		
		var sValue = this.oModel.getProperty("/myGroupTitle");
		if (sValue === sLongTitle) {
			this.oModel.setProperty("/myGroupTitle", sShortTitle);
		} else {
			this.oModel.setProperty("/myGroupTitle", sLongTitle);			
		}
	}
};

var toggleLabelRenameB = function() {
	if (this.oModel) {
		var sLabel = "My New Label B";
		if (sLabel === this.oModel.getProperty("/myLabel")) {
			this.oModel.setProperty("/myLabel", "another label");
		} else {
			this.oModel.setProperty("/myLabel", sLabel);			
		}
	}
};

var toggleLabelRenameA = function() {
	if (this.oModel) {
		var sLabel = "My New Label A";
		if (sLabel === this.oModel.getProperty("/myGroupLabel")) {
			this.oModel.setProperty("/myGroupLabel", "another label");
		} else {
			this.oModel.setProperty("/myGroupLabel", sLabel);			
		}
	}
};


var fCleanUp = function() {
	oFilterBar.removeAllFilterItems();
	oFilterBar.removeAllFilterGroupItems();
	oFilterBar.removeBasicSearch();
};


var toggleAdvancedMode = function() {

	fCleanUp();
		
	var bFlag = !this.oFilterBar.getAdvancedMode();
	
	if (bFlag) {		
		this.oFilterBar.setAdvancedMode(true);
		fSetTestData2();
		fAddSearchField();
	} else {
		this.oFilterBar.setAdvancedMode(false);		
		fSetTestData();
	}
};	

var toggleExpandAdvancedArea = function() {
				
	if (this.oFilterBar.getAdvancedMode()) {
		var bFlag = this.oFilterBar.getExpandAdvancedArea();
		this.oFilterBar.setExpandAdvancedArea(!bFlag);
	}
};	


var toggleAdvancedMode1 = function() {
	
	fCleanUp();
		
	var bFlag = !this.oFilterBar.getAdvancedMode();
	
	if (bFlag) {	
		this.oFilterBar.setAdvancedMode(true);
	
		//fCreateSearchItem();
		fSetTestData2();
	} else {
		this.oFilterBar.setAdvancedMode(false);		
		fSetTestData();
	}
};

var fTriggerButtonState = function() {
	this.oFilterBar.setSearchEnabled(!this.oFilterBar.getSearchEnabled());
};


var fGetFiltersWithValues = function() {
	var i;
	var oControl;
	var aFilters = that.oFilterBar.getFilterGroupItems();
	
	
	var aFiltersWithValue = [];
	
	for (i=0; i < aFilters.length; i++) {
		oControl = that.oFilterBar.determineControlByFilterItem(aFilters[i]);
		if (oControl && oControl.getValue && oControl.getValue()) {
			aFiltersWithValue.push(aFilters[i]);
		}
	}
	
	return aFiltersWithValue;
};

var fFetchData = function() {
	
	var sGropuName;
	var oJsonParam;
	var oJsonData = [];
	
	var oItems = that.oFilterBar.getAllFilterItems(true);
	for (var i=0; i < oItems.length; i++) {
		oJsonParam = {};
		sGroupName = null;
		if (oItems[i].getGroupName) {
			sGroupName = oItems[i].getGroupName();
			oJsonParam.group_name = sGroupName;
		} 
		
		oJsonParam.name = oItems[i].getName();						
	
		var oControl = that.oFilterBar.determineControlByFilterItem(oItems[i]);
		if (oControl) {
			oJsonParam.value = oControl.getValue();
			oJsonData.push(oJsonParam);
		}
	}
	
	return oJsonData;
};

var fApplyData = function(oJsonData) {
	
	var sGroupName;
	
	for (var i=0; i < oJsonData.length; i++) {
		
		sGroupName = null; 
		
		if (oJsonData[i].group_name) {
			sGroupName = oJsonData[i].group_name;	
		}
		
		var oControl = that.oFilterBar.determineControlByName(oJsonData[i].name, sGroupName);
		if (oControl) {
			oControl.setValue(oJsonData[i].value);
		}
	}
	
};

// Basic area
var fCreateItem = function(sName, sLabel, bRequire, sWidth, bInvisible, sTooltip) {
	var oCtrl = null;
	var oFilterItem = new sap.ui.comp.filterbar.FilterItem();
	oFilterItem.setLabel(sLabel?sLabel:("Control" + sName));
	oCtrl = new sap.m.Input();
	if (oCtrl.attachChange) {
		oCtrl.attachChange(function(oEvent) {
			that.oFilterBar.fireFilterChange(oEvent);
		});
	}
	
	if (sWidth) {
		//oCtrl.setWidth(sWidth);
	} 
	
	oFilterItem.setControl(oCtrl);
	oFilterItem.setName(sName);
	
	if (bRequire) {
		oFilterItem.setMandatory(bRequire);	
	}
	
	if (bInvisible) {
		oFilterItem.setVisible(false);
	}
	
	if (sName === "B") {
		oFilterItem.bindProperty("visibleInFilterBar", "/myVisibleFBB");  // has to be done befor added to the aggregation
		oFilterItem.bindProperty("visible", "/myVisible");  // has to be done befor added to the aggregation
		oCtrl.bindProperty("value", "/myValue");  // has to be done befor added to the aggregation
		oCtrl.attachChange(this._change);
	} else if (sName === "A") {
		oCtrl.bindProperty("value", "/valueOfA");  // has to be done befor added to the aggregation
		oCtrl.attachChange(this._change);				
	} else if (sName === "D") {
		oFilterItem.bindProperty("mandatory", "/myMandBA");  // has to be done befor added to the aggregation
		oCtrl.attachChange(this._change);		
	}
	
	if (sTooltip) {
		oFilterItem.setLabelTooltip(sTooltip);
	}	
	
	oFilterBar.addFilterItem(oFilterItem);
	return oFilterItem;
};	


var fAddSearchField = function() {

	var oBasicSearch = new sap.m.SearchField({
		//maxLength: "28rem",
		showSearchButton: false
	});

	oFilterBar.setBasicSearch(oBasicSearch);		
};


var _change = function(oEvent) {
	
	var params = oEvent.getParameters();
	if (params.newValue === "VISB") {
		toggleBA();		
	} else if (params.newValue === "VISA") {
		toggleAA();
	} else if (params.newValue === "LABB") {
		toggleLabelRenameB();
	} else if (params.newValue === "LABA") {
		toggleLabelRenameA();
	} else if (params.newValue === "TITA") {
		toggleTitleRenameA();
	} else if (params.newValue === "VISFBA") {
		toggleFBA();
	} else if (params.newValue === "VISFBB") {
		toggleFBB();		
	} else if (params.newValue === "MANDBA") {
		toggleMandBA();
	} else if (params.newValue === "MANDAA") {
		toggleMandAA();		
	}

};

// Advanced area
var fCreateGroupItem = function(sGroupTitle, sGroupName, sName, sLabel, bInvisible, sTooltip) {
	var oFilterGroupItem = new sap.ui.comp.filterbar.FilterGroupItem();
	oFilterGroupItem.setGroupName(sGroupName);	
	oFilterGroupItem.setGroupTitle(sGroupTitle);			

	oFilterGroupItem.setLabel(sLabel?sLabel:("oCtrl" + sName));
	
	var oCtrl = new sap.m.Input();
	if (oCtrl.attachChange) {
		oCtrl.attachChange(function(oEvent) {
			that.oFilterBar.fireFilterChange(oEvent);
		});
	}
		
	if (bInvisible) {
		oFilterGroupItem.setVisible(false);
	}

	//oFilterGroupItem.setVisible(false);
	
	
	oFilterGroupItem.setControl(oCtrl);
	oFilterGroupItem.setName(sName);	
	
	if ((sName === "G15")) {
		oFilterGroupItem.bindProperty("visible", "/myAAVisible");  //has to be done befor fireInitialise
		oFilterGroupItem.bindProperty("visibleInFilterBar", "/myVisibleFBA");  //has to be done befor fireInitialise
		oCtrl.bindProperty("value", "/myAAValue");  //has to be done befor fireInitialise					
	}				
					
	if (sTooltip) {
		oFilterGroupItem.setLabelTooltip(sTooltip);
	}
	
	oFilterBar.addFilterGroupItem(oFilterGroupItem);	
	
	return oFilterGroupItem;
};


	var singleSelection = function() {

		fCleanUp();
		fCreateItem("A");
	};

	var singleGroup = function() {

		if (this.oFilterBar.getAdvancedMode()) {

			this.oFilterBar.removeAllFilterGroupItems();

			var sGroupTitle = "Open Item Management";
			var sGroupName = "G1";

			fCreateGroupItem(sGroupTitle, sGroupName, "G01", "Open Item Management", false, "Test with Tooltip");
			fCreateGroupItem(sGroupTitle, sGroupName, "G02");
		}
	};

	var fSetTestData2 = function(bFlag) {
		
		if (bFlag === undefined) {
			bFlag = true;
		}
		this.oFilterBar.removeAllFilterGroupItems();

		var oFilterItem = null;
		var sGroupTitle = "Test";
		var sGroupName = "TEST";

		fCreateGroupItem(sGroupTitle, sGroupName, "G01 FRANZ", "Open Item Management").setVisibleInFilterBar(bFlag);

		fCreateGroupItem(sGroupTitle, sGroupName, "G02_FRANZ").setVisibleInFilterBar(bFlag);

		fCreateGroupItem(sGroupTitle, sGroupName, "G03\FRANZ", "oInputField").setVisibleInFilterBar(bFlag);

		fCreateGroupItem(sGroupTitle, sGroupName, "0G04").setVisibleInFilterBar(bFlag);

		fCreateGroupItem(sGroupTitle, sGroupName, "G05").setVisibleInFilterBar(bFlag);

		fCreateGroupItem(sGroupTitle, sGroupName, "G06").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G07").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G08").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G09").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G10").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G11").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G12").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G13").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G14").setVisibleInFilterBar(bFlag);

		var sGroupTitle = "Test2";
		var sGroupName = "TEST2";

		fCreateGroupItem(sGroupTitle, sGroupName, "G021", "Open Item Management2").setVisibleInFilterBar(bFlag);
		fCreateGroupItem(sGroupTitle, sGroupName, "G022").setVisibleInFilterBar(bFlag);
	};

	var fCreateSearchItem = function() {
		var oCtrl = null;
		var oFilterItem = new sap.ui.comp.filterbar.FilterItem();
		oFilterItem.setLabel("");
		oCtrl = new sap.m.SearchField({
			width: "28rem",
			showSearchButton: false
		});

		oFilterItem.setControl(oCtrl);
		oFilterItem.setName("SEARCH");

		oFilterBar.addFilterItem(oFilterItem);
		return oFilterItem;
	};

	var fSetTestData = function() {

		var f = fCreateMCBItem("MCB");
		f.setVisibleInFilterBar(false);

		fCreateCBItem("CB CB");

		fCreateItem("A A A A");
		fCreateItem("B\\C", "ChangeMyVisDynamic", true); //dynamicaly hidden/visible						

		fCreateItem("0C", "Test.123456789.123456789.123456789");
		fCreateItem("D/D");
		fCreateItem("E");
		fCreateItem("F", "ControlFASDEDEERRabadadadsassassasasa", false, "30px");

		fCreateItem("G", "ControlG", false, "370px", false, "This is a Tooltip"); // default hidden
		var oItem = fCreateItem("H", null, true, null, false, "Sein Blick ist vom Vorübergehn der Stäbe so müd geworden, dass er nichts mehr hält. Ihm ist, als ob es tausend Stäbe gäbe  und hinter tausend Stäben keine Welt.");
		if (oItem) {
			oItem.bindProperty("label", "/myLabel");
		}

		sGroupTitle = "Invisible Group";
		sGroupName = "G8";
		fCreateGroupItem(sGroupTitle, sGroupName, "G82", "first", true);
		var oFilterItem = fCreateGroupItem(sGroupTitle, sGroupName, "G83", "invisible");
		oFilterItem.bindProperty("visible", "/myAAVisible"); //has to be done befor fireInitialise
		oFilterItem.setPartOfCurrentVariant(true);

		fCreateGroupItem(sGroupTitle, sGroupName, "G84", "last", true);

		var sGroupTitle = "Open Item Management";
		var sGroupName = "G1";

		var oFirstGroupElement = fCreateGroupItem(sGroupTitle, sGroupName, "G11", "oCtrlG11", false, "Tooltip"); // default visible hidden
		if (oFirstGroupElement) {
			oFirstGroupElement.bindProperty("groupTitle", "/myGroupTitle");
			oFirstGroupElement.bindProperty("label", "/myGroupLabel");

			oFirstGroupElement.setVisibleInFilterBar(true);
		}

		fCreateGroupItem(sGroupTitle, sGroupName, "G12", "oCtrlG12", true); // default hidden				
		fCreateGroupItem(sGroupTitle, sGroupName, "G13", "Open Item Management");
		fCreateGroupItem(sGroupTitle, sGroupName, "G14");
		fCreateGroupItem(sGroupTitle, sGroupName, "G15", "ChangeMyVisDynamic", false, "Sein Blick ist vom Vorübergehn der Stäbe so müd geworden, dass er nichts mehr hält. Ihm ist, als ob es tausend Stäbe gäbe  und hinter tausend Stäben keine Welt."); //dynamic hidden/visible						
		fCreateGroupItem(sGroupTitle, sGroupName, "G16");
		fCreateGroupItem(sGroupTitle, sGroupName, "G17");

		sGroupTitle = "Group 2";
		sGroupName = "G2";
		fCreateGroupItem(sGroupTitle, sGroupName, "G21");

		sGroupTitle = "Group3";
		sGroupName = "G3";
		fCreateGroupItem(sGroupTitle, sGroupName, "G31");
		fCreateGroupItem(sGroupTitle, sGroupName, "G32");
		fCreateGroupItem(sGroupTitle, sGroupName, "G33");

		sGroupTitle = "Group4";
		sGroupName = "G4";
		fCreateGroupItem(sGroupTitle, sGroupName, "G41");
		fCreateGroupItem(sGroupTitle, sGroupName, "G42");
		fCreateGroupItem(sGroupTitle, sGroupName, "G43");

		sGroupTitle = "Group5";
		sGroupName = "G5";
		fCreateGroupItem(sGroupTitle, sGroupName, "G51");
		fCreateGroupItem(sGroupTitle, sGroupName, "G52");

		sGroupTitle = "";
		sGroupName = "G6";
		fCreateGroupItem(sGroupTitle, sGroupName, "G61");
		fCreateGroupItem(sGroupTitle, sGroupName, "G62");

		sGroupTitle = "Group7";
		sGroupName = "G7";
		fCreateGroupItem(sGroupTitle, sGroupName, "G71", "Sehr sehr sehr sehr sehr sehr langes Label");
		fCreateGroupItem(sGroupTitle, sGroupName, "G72");
		fCreateGroupItem(sGroupTitle, sGroupName, "G73");
		fCreateGroupItem(sGroupTitle, sGroupName, "G74");
	};

	//Basic area
	var fCreateMCBItem = function(sName, sLabel, bRequire, sWidth, bInvisible) {
		var oCtrl = null;
		var oFilterItem = new sap.ui.comp.filterbar.FilterItem();
		oFilterItem.setLabel(sLabel ? sLabel : ("Control" + sName));
		oCtrl = new sap.m.MultiComboBox();

		if (sWidth) {
			oCtrl.setWidth(sWidth);
		} else {
			//oCtrl.setWidth("300px");
		}

		oFilterItem.setControl(oCtrl);
		oFilterItem.setName(sName);

		if (bRequire) {
			oFilterItem.setMandatory(bRequire);
		}

		if (bInvisible) {
			oFilterItem.setVisible(false);
		}

		oFilterBar.addFilterItem(oFilterItem);
		return oFilterItem;
	};

	var fCreateCBItem = function(sName, sLabel, bRequire, sWidth, bInvisible) {
		var oCtrl = null;
		var oFilterItem = new sap.ui.comp.filterbar.FilterItem();
		oFilterItem.setLabel(sLabel ? sLabel : ("Control" + sName));
		oCtrl = new sap.m.ComboBox();

		if (sWidth) {
			oCtrl.setWidth(sWidth);
		} else {
			//oCtrl.setWidth("300px");
		}

		oFilterItem.setControl(oCtrl);
		oFilterItem.setName(sName);

		if (bRequire) {
			oFilterItem.setMandatory(bRequire);
		}

		if (bInvisible) {
			oFilterItem.setVisible(false);
		}

		oFilterBar.addFilterItem(oFilterItem);
		return oFilterItem;
	};

	this.bEmphFlag = false;

	//required if used in the sandbox environment
	window.sap.ushell = window.top.sap.ushell;

	oFilterBar = that.oFilterBar;

	oFilterBar.setPersistencyKey("PersonalizationTest");

	oFilterBar.setShowClearButton(true);

	oFilterBar.registerFetchData(fFetchData);
	oFilterBar.registerApplyData(fApplyData);
	oFilterBar.registerGetFiltersWithValues(fGetFiltersWithValues);

	var oModel = new sap.ui.model.json.JSONModel({
		myVisible: false,
		myValue: "",
		myAAVisible: true,
		myAAValue: "",
		myGroupTitle: "Open Item Management",
		myGroupLabel: "Label",
		myLabel: "BALabel",
		valueOfA: "value of A",
		myVisibleFBA: true,
		myVisibleFBB: true,
		myMandBA: true,
		myMandAA: true
	});
	oFilterBar.setModel(oModel);

	this.oModel = oModel;

	oFilterBar.addStyleClass("sapUiSizeCompact");

	oFilterBar.attachClear(function() {
		oFilterBar.reset();
		//alert("Clear pressed");			
	});

	oFilterBar.attachBeforeVariantSave(function() {
		//alert("BVA");			
	});

	oFilterBar.attachAfterVariantLoad(function() {
		//alert("AVL");			
	});

	oFilterBar.attachReset(function() {
		//alert("Reset pressed");			
		//oFilterBar.clearVariantSelection();
		oFilterBar.setSearchButtonEmphType(true);
	});

	oFilterBar.attachSearch(function(oEvent) {

		var s = "" + oEvent;
		if (oEvent && oEvent.mParameters && oEvent.mParameters.selectionSet) {
			s = "" + oEvent.mParameters.selectionSet.length + " selection parameters determined";
		}

		//alert("Search pressed:<" + s + ">"); 
	});

	oFilterBar.setConsiderGroupTitle(true);

	fSetTestData();

	fAddSearchField();
	oFilterBar.setShowClearOnFB(true);

	oFilterBar.placeAt("content");

	oFilterBar.fireInitialise();
</script>
</head>
<body class="sapUiBody" role="application">
	<h1 id="header">
		Test Page for
		<code>sap.ui.comp.filterbar.FilterBar</code>
	</h1>
	<p>
		<input type="button" value="Toggle Basic Field visibility"
			onclick="toggleBA()">
		<input type="button"
			value="Toggle Advanced Field visibility" onclick="toggleAA()">
		<input type="button" value="Basic Label"
			onclick="toggleLabelRenameB()">
		<input type="button"
			value="Advanced Label" onclick="toggleLabelRenameA()">
		<input type="button" value="Group Title" onclick="toggleTitleRenameA()">
		<input type="button" value="toggle Advanced Mode" onclick="toggleAdvancedMode()">
		<input type="button"
			value="toggle expandAdvancedArea"
			onclick="toggleExpandAdvancedArea()">
		<input type="button"
			value="toggle Advanced Mode without Basic Search"
			onclick="toggleAdvancedMode1()">
		<input type="button"
			value="Single Selection" onclick="singleSelection()">
		<input type="button" value="Single Group" onclick="singleGroup()">
		<input type="button" value="Disable/Enable Button"
			onclick="fTriggerButtonState()">
		<input type="button" value="Determine Mandatory"
			onclick="fDetermineMandatory()">
		<input type="button"
			value="toggle ConsiderGroupTitle" onclick="fConsiderGroupTitle()">
		<input type="button" value="getCurrentVariantId"
			onclick="fgetCurrentVariantId()">
		<input type="button"
			value="setCurrentVariantId" onclick="fsetCurrentVariantId()">
		<input type="button" value="setCollectiveSearch"
			onclick="fsetCollectiveSearch()">
		<input type="button" value="noFilters"
			onclick="fsetNoFilters()">	
		<input type="button" value="onlyNonVisibleOnFBFilters"
			onclick="fsetNonVisibleOnFBFilters()">	
	</p>

	<div id="content"></div>
	<p>
</body>
</html>
</html>