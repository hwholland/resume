<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>Test Page for sap.ui.rta.ui.AddElementsDialog</title>

		<style>
			html, body, #qunit-tests {
				height : 100%;
			}
			.sapUiView {
				height: 100%;	
			}

			#test-view {
				border: 1px solid grey;
				position: fixed;
				bottom: 0;
				right: 0;
				width : 50%;
				height: 50%;
			}
		</style>

		<script id="sap-ui-bootstrap" data-sap-ui-theme="sap_bluecrystal"
			type="text/javascript" data-sap-ui-noConflict="true"
			data-sap-ui-resourceroots='{"sap.ui.rta.test": "../testdata/rta/"}'
			data-sap-ui-libs="sap.ui.rta,sap.ui.commons,sap.m,sap.ui.layout,sap.ui.dt"
			src="../../../../../resources/sap-ui-core.js">
		</script>
		<link rel="stylesheet" href="../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
		<script type="text/javascript" src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script type="text/javascript" src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script type="text/javascript">

			jQuery.sap.require("sap.ui.rta.ui.AddElementsDialog");
			
			var oAddElementsDialog;
			var oView;
			
			QUnit.module("Given that RuntimeAuthoring is available with a view as rootControl...", {
				beforeEach : function(assert) {
					var done = assert.async();
					oView = sap.ui.xmlview("idMain1", "sap.ui.rta.test.ComplexTest");
					var oEventDelegate = {
						onAfterRendering : function() {
							oAddElementsDialog = new sap.ui.rta.ui.AddElementsDialog();
							oView.removeEventDelegate(oEventDelegate);
							waitForBinding().then(function() {
								done();
							});
						}
					};
					oView.addEventDelegate(oEventDelegate);
					oView.placeAt("test-view");
					sap.ui.getCore().applyChanges();
				},
				afterEach : function(assert) {
					oAddElementsDialog.destroy();
					oView.destroy();
				}
			});
			
			QUnit.test("when AddElementsDialog gets initialized and open is called,", function(assert) {
				var done = assert.async();

				oAddElementsDialog.attachOpened(function() {
					assert.ok(true, "then dialog pops up,");
					done();
				});
				oAddElementsDialog.open(sap.ui.getCore().byId("idMain1--GeneralLedgerDocument"));
			});
			
			function waitForBinding() {
				var oBindingReady = new Promise(function(resolve) {
					var oView = sap.ui.getCore().byId("idMain1");
					oView.getModel().attachRequestCompleted(function() {
						resolve();
					});
				});
				return oBindingReady.then(function() {
					var oView = sap.ui.getCore().byId("idMain1");
					return oView.getModel().getMetaModel().loaded();
				});
			}
		</script>
	</head>
	<body>
		<h1 id="qunit-header">QUnit page for sap.ui.rta.ui.AddElementsDialog</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<ol id="qunit-tests"></ol>
		<div id="test-view"></div>
	</body>
</html>