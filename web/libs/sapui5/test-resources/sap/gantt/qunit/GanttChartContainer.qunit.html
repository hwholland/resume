<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta charset="UTF-8">
		<title>QUnit: sap.gantt.GanttChartContainer</title>
		<script id="sap-ui-bootstrap"
			src="../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-libs="sap.gantt">
		</script>
		<link rel="stylesheet" type="text/css" href="../../../../resources/sap/ui/thirdparty/qunit.css"/>
		<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script>
			if (!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
				jQuery.sap.require("sap.ui.qunit.qunit-coverage");
			}
			qutils.delayTestStart();
			//use dummy ganttchart object to replace the real ganttchart. Because this qunit only needs to cover the ganttchartcontainer
			var GanttChart = sap.ui.core.Control.extend("sap.gantt.dummyGanttChart" , {
				metadata: {
					properties: {
						enableCursorLine: {type: "boolean"},
						enableNowLine: {type: "boolean"},
						enableVerticalLine: {type: "boolean"},
					}
				}
			});
			GanttChart.prototype.attachHorizontalScroll = function (){};
			GanttChart.prototype.detachHorizontalScroll = function (){};
			GanttChart.prototype.detachVerticalScroll = function (){};
			GanttChart.prototype.attachVerticalScroll = function (){};
			GanttChart.prototype.setSelectionPanelSize = function (){};
			GanttChart.prototype.attachSplitterResize = function (){};
			GanttChart.prototype.detachSplitterResize = function (){};
			GanttChart.prototype.attachGanttChartSwitchRequested = function (){};
			GanttChart.prototype.detachGanttChartSwitchRequested = function (){};
			GanttChart.prototype.attachChartDragEnter = function (){};
			GanttChart.prototype.detachChartDragEnter = function (){};
			GanttChart.prototype.attachChartDragLeave = function (){};
			GanttChart.prototype.detachChartDragLeave = function (){};
			GanttChart.prototype.attachShapeDragEnd = function (){};
			GanttChart.prototype.detachShapeDragEnd = function (){};
			GanttChart.prototype.attachTreeTableToggleEvent = function (){};
			GanttChart.prototype.detachTreeTableToggleEvent = function (){};
			GanttChart.prototype.selectShapes = function(){return true;};
			GanttChart.prototype.deselectShapes = function(){return true;};
			GanttChart.prototype.selectRelationships = function(){return true;};
			GanttChart.prototype.deselectRelationships = function(){return true;};
			GanttChart.prototype.selectRows = function(){return true;};
			GanttChart.prototype.deselectRows = function(){return true;};
			GanttChart.prototype.selectRowsAndShapes = function() {return true;};
			GanttChart.prototype.getSelectedShapes = function() {return ["shape0"];};
			GanttChart.prototype.getSelectedRows = function() {return ["row0"];};
			GanttChart.prototype.getSelectedRelationships = function() {return ["r0"];};
			GanttChart.prototype.getAllSelections = function() {
				return {rows: ["row0"], shapes: ["shape0"], relationships: ["r0"]};
			};
			GanttChart.prototype.setTimeZoomRate = function() {};
			GanttChart.prototype.getTimeZoomRate = function() {};
			GanttChart.prototype.jumpToPosition = function() {};
			GanttChart.prototype.setDraggingData = function() {};
			GanttChart.prototype.handleExpandChartChange = function (){};
			GanttChart.prototype.notifySourceChange = function(){};
			GanttChart.prototype.getHierarchyKey = function (){};

			module("Test GanttChartContainer toolbar and legend", {
				setup: function () {
					this.oGanttChartContainer = new sap.gantt.GanttChartContainer();
					this.oLegendContainer = new sap.gantt.legend.LegendContainer({
						width: "300px",
						height: "250px",
						legendSections: [new sap.m.Page({
							title : "Message",
							content:[new sap.m.FlexBox({
								direction: sap.m.FlexDirection.Row,
								alignItems: sap.m.FlexAlignItems.Center,
								items: [new sap.m.CheckBox({
									selected: true
								}), new sap.ui.core.Icon({
									src: "sap-icon://message-error",
									size: "15px",
									color: "red",
									width: "25px"
								}), new sap.m.Label({
									text: "Error"
								})]
							})]
						})
					]});
					this.oGanttChart0 = new sap.gantt.dummyGanttChart();
					this.oGanttChart1 = new sap.gantt.dummyGanttChart();
				},
				teardown: function () {
					this.oLegendContainer.destroy();
					this.oGanttChart0.destroy();
					this.oGanttChart1.destroy();
					this.oGanttChartContainer.destroy();
				}
			});
			test("Test GanttChartContainer toolbar" , function () {
				this.oCustomToolbarItem0 = new sap.m.Button({
					icon: "sap-icon://share",
					text: "Share"
				});
				this.oCustomToolbarItem1 = new sap.m.Button({
					icon: "sap-icon://print",
					text: "Print"
				});
				this.oGanttChartContainer.insertCustomToolbarItem(this.oCustomToolbarItem0);
				strictEqual(this.oGanttChartContainer._oToolbar.getAllToolbarItems()[0].getText(), "Share", "Insert custom toolbar item");
				this.oGanttChartContainer.addCustomToolbarItem(this.oCustomToolbarItem1);
				strictEqual(this.oGanttChartContainer._oToolbar.getAllToolbarItems()[1].getText(), "Print", "Add custom toolbar item");
				this.oGanttChartContainer.removeCustomToolbarItem(this.oCustomToolbarItem0);
				strictEqual(this.oGanttChartContainer._oToolbar.getAllToolbarItems()[0].getText(), "Print", "Remove custom toolbar item");
				this.oGanttChartContainer.removeAllCustomToolbarItems();
				strictEqual(this.oGanttChartContainer._oToolbar._aCustomItems.length, 0, "remove all custom toolbar item");

				this.oGanttChartContainer.insertGanttChart(this.oGanttChart0, 0);
				this.oGanttChartContainer.addGanttChart(this.oGanttChart1);

				this.oEvent = new sap.ui.base.Event(sap.gantt.config.SETTING_ITEM_ENABLE_NOW_LINE_KEY, this.oGanttChartContainer._oToolbar, [{id: sap.gantt.config.SETTING_ITEM_ENABLE_NOW_LINE_KEY, value: false}]);
				this.oGanttChartContainer._onToolbarSettingsChange(this.oEvent);
				strictEqual(this.oGanttChartContainer.getEnableNowLine(), false, "Enable now line");
				this.oEvent = new sap.ui.base.Event(sap.gantt.config.SETTING_ITEM_ENABLE_CURSOR_LINE_KEY, this.oGanttChartContainer._oToolbar, [{id: sap.gantt.config.SETTING_ITEM_ENABLE_CURSOR_LINE_KEY, value: false}]);
				this.oGanttChartContainer._onToolbarSettingsChange(this.oEvent);
				strictEqual(this.oGanttChartContainer.getEnableCursorLine(), false, "Enable cursor line");
				this.oEvent = new sap.ui.base.Event(sap.gantt.config.SETTING_ITEM_ENABLE_VERTICAL_LINE_KEY, this.oGanttChartContainer._oToolbar, [{id: sap.gantt.config.SETTING_ITEM_ENABLE_VERTICAL_LINE_KEY, value: false}]);
				this.oGanttChartContainer._onToolbarSettingsChange(this.oEvent);
				strictEqual(this.oGanttChartContainer.getEnableVerticalLine(), false, "Enable vertical line");
				this.oEvent = new sap.ui.base.Event(sap.gantt.config.SETTING_ITEM_ENABLE_TIME_SCROLL_SYNC_KEY, this.oGanttChartContainer._oToolbar, [{id: sap.gantt.config.SETTING_ITEM_ENABLE_TIME_SCROLL_SYNC_KEY, value: false}]);
				this.oGanttChartContainer._onToolbarSettingsChange(this.oEvent);
				strictEqual(this.oGanttChartContainer.getEnableTimeScrollSync(), false, "Enable time scroll sync");
			});
			test("Test GanttChartContainer legend" , function () {
				this.oGanttChartContainer.setLegendContainer(this.oLegendContainer);
				deepEqual(this.oGanttChartContainer.getAggregation("legendContainer"), this.oLegendContainer, "Set legend container");
			});

			module("Test GanttChartContainer set get and events", {
				setup: function () {
					this.oGanttChart0 = new sap.gantt.dummyGanttChart();
					this.oGanttChart0._oSplitter = new sap.ui.layout.Splitter({
						width: "100%",
						height: "100%",
						orientation: sap.ui.core.Orientation.Horizontal
					});
					this.oGanttChart1 = new sap.gantt.dummyGanttChart();
					this.oGanttChart1._oSplitter = new sap.ui.layout.Splitter({
						width: "100%",
						height: "100%",
						orientation: sap.ui.core.Orientation.Vertical
					});
					this.oGanttChartContainer = new sap.gantt.GanttChartContainer({ganttCharts: [this.oGanttChart0, this.oGanttChart1]});
				},
				teardown: function () {
					this.oGanttChartContainer.destroy();
				}
			});
			test("Test GanttChartContainer set and get" , function () {
				this.oModes = [new sap.gantt.config.Mode({key: "A", text: "Activity"}),
				new sap.gantt.config.Mode({key: "D", text: "Document"})];
				this.oGanttChartContainer.setModes(this.oModes);
				deepEqual(this.oGanttChartContainer.getModes(this.oModes), this.oModes, "Set modes");
				this.oGanttChartContainer.setSliderStep(12);
				strictEqual(this.oGanttChartContainer.getSliderStep(), 12, "Set slider step");
				this.aToolbarSchemesConfig = [
										new sap.gantt.config.ToolbarScheme({
											key: "LOCAL_TOOLBAR",
											sourceSelect: new sap.gantt.config.ToolbarGroup({
												position: "L1",
												overflowPriority: sap.m.OverflowToolbarPriority.High
											}),
											customToolbarItems: new sap.gantt.config.ToolbarGroup({
												position: "L3",
												overflowPriority: sap.m.OverflowToolbarPriority.High
											}),
											expandTree: new sap.gantt.config.ToolbarGroup({
												position: "L2",
												overflowPriority: sap.m.OverflowToolbarPriority.Low
											}),
											mode: new sap.gantt.config.ModeGroup({
												position: "R1",
												overflowPriority: sap.m.OverflowToolbarPriority.Low,
												modeKeys: ["A", "D"]
											})
										})];
				this.oGanttChartContainer.setToolbarSchemes(this.aToolbarSchemesConfig);
				deepEqual(this.oGanttChartContainer._oToolbarSchemeConfigMap["LOCAL_TOOLBAR"], this.aToolbarSchemesConfig[0], "Set toolbar schemes");
				this.aHierarchiesConfig = [];
				this.aHierarchiesConfig.push(new sap.gantt.config.Hierarchy({
					key: "TOL",
					text: "Freight Order",
					toolbarSchemeKey: "LOCAL_TOOLBAR",
					activeModeKey: "D"
				}));
				this.aHierarchiesConfig.push(new sap.gantt.config.Hierarchy({
					key: "TRUCK",
					text: "Truck",
					toolbarSchemeKey: "LOCAL_TOOLBAR",
					activeModeKey: "A",
				}));
				this.oGanttChartContainer.setHierarchies(this.aHierarchiesConfig);
				deepEqual(this.oGanttChartContainer._oHierarchyConfigMap["TRUCK"], this.aHierarchiesConfig[1], "Set hierarchies");
				this.aContainerLayouts = [
					new sap.gantt.config.ContainerLayout({
						key: "d1",
						text: "Single: Resources",
						toolbarSchemeKey: "GLOBAL_TOOLBAR",
						ganttChartLayouts: [new sap.gantt.config.GanttChartLayout({
											activeModeKey: "D",
								hierarchyKey: "RESOURCES"
							})]
						}), 
					new sap.gantt.config.ContainerLayout({
						key: "d2",
						text: "Dual: Resources & Orders",
						toolbarSchemeKey: "GLOBAL_TOOLBAR",
						ganttChartLayouts: [new sap.gantt.config.GanttChartLayout({
							activeModeKey: "A",
							hierarchyKey: "RESOURCES"
						}), new sap.gantt.config.GanttChartLayout({
							activeModeKey: "D",
							hierarchyKey: "TOL"
						})]
					}),
					new sap.gantt.config.ContainerLayout({
						key: "d3",
						text: "Single: Freight Order",
						toolbarSchemeKey: "GLOBAL_TOOLBAR",
						ganttChartLayouts: [new sap.gantt.config.GanttChartLayout({
						activeModeKey: "D",
						hierarchyKey: "TOL"
						})]
					})
				];
				this.oGanttChartContainer.setContainerLayouts(this.aContainerLayouts);
				deepEqual(this.oGanttChartContainer._oContainerLayoutConfigMap["d2"], this.aContainerLayouts[1], "Set container layouts");
				this.oGanttChartContainer.setContainerLayoutKey("d2");
				strictEqual(this.oGanttChartContainer.getContainerLayoutKey(), "d2", "Set container layout key");
				
				strictEqual(this.oGanttChartContainer.selectShapes(0), true, "Select shapes");
				strictEqual(this.oGanttChartContainer.selectShapes(3), true, "Select shapes");
				strictEqual(this.oGanttChartContainer.deselectShapes(0), true, "Deselect shapes");
				strictEqual(this.oGanttChartContainer.deselectShapes(3), true, "Deselect shapes");
				strictEqual(this.oGanttChartContainer.selectRows(0), true, "Select rows");
				strictEqual(this.oGanttChartContainer.selectRows(3), true, "Select rows");
				strictEqual(this.oGanttChartContainer.deselectRows(0), true, "Deselect rows");
				strictEqual(this.oGanttChartContainer.deselectRows(3), true, "Deselect rows");
				strictEqual(this.oGanttChartContainer.selectRelationships(0), true, "Select relationships");
				strictEqual(this.oGanttChartContainer.selectRelationships(3), true, "Select relationships");
				strictEqual(this.oGanttChartContainer.deselectRelationships(0), true, "Deselect relationships");
				strictEqual(this.oGanttChartContainer.deselectRelationships(3), true, "Deselect relationships");
				strictEqual(this.oGanttChartContainer.selectRowsAndShapes(0), true, "Select rows and shapes");
				strictEqual(this.oGanttChartContainer.selectRowsAndShapes(3), true, "Select rows and shapes");
				deepEqual(this.oGanttChartContainer.getSelectedShapes(0), [{"ganttChartIndex": 0, "selectedShapes": ["shape0"]}], "Get selected shapes");
				deepEqual(this.oGanttChartContainer.getSelectedShapes(3), [{"ganttChartIndex": 0, "selectedShapes": ["shape0"]},{"ganttChartIndex": 1, "selectedShapes": ["shape0"]}], "Get selected shapes");
				deepEqual(this.oGanttChartContainer.getSelectedRows(0), [{"ganttChartIndex": 0, "selectedRows": ["row0"]}], "Get selected rows");
				deepEqual(this.oGanttChartContainer.getSelectedRows(3), [{"ganttChartIndex": 0, "selectedRows": ["row0"]}, {"ganttChartIndex": 1, "selectedRows": ["row0"]}], "Get selected rows");
				deepEqual(this.oGanttChartContainer.getSelectedRelationships(0), [{"ganttChartIndex": 0, "selectedRelationships": ["r0"]}], "Get selected relationships");
				deepEqual(this.oGanttChartContainer.getSelectedRelationships(3), [{"ganttChartIndex": 0, "selectedRelationships": ["r0"]}, {"ganttChartIndex": 1, "selectedRelationships": ["r0"]}], "Get selected relationships");
				deepEqual(this.oGanttChartContainer.getAllSelections(0),
						[{"ganttChartIndex": 0, "allSelection": {rows: ["row0"], shapes: ["shape0"], relationships: ["r0"]}}],
						"Get all selections");
				deepEqual(this.oGanttChartContainer.getAllSelections(3),
						[{"ganttChartIndex": 0, "allSelection": {rows: ["row0"], shapes: ["shape0"], relationships: ["r0"]}},
						 {"ganttChartIndex": 1, "allSelection": {rows: ["row0"], shapes: ["shape0"], relationships: ["r0"]}}],
						"Get all selections");

				this.oGanttChartContainer.onBeforeRendering();
				ok(true, "on before rendering");
				this.oGanttChartContainer._detachToolbarEvents();
				ok(true, "detach toolbar events");
				this.oEvent = new sap.ui.base.Event("zoomRate", this.oGanttChartContainer._oToolbar, {zoomRate: 1});
				this.oGanttChartContainer._onToolbarZoomRateChange(this.oEvent);
				ok(true, "zoom rate change");
				this.oGanttChartContainer._onToolbarExpandChartChange(this.oEvent);
				ok(true, "expand chart change");
				this.oEvent = new sap.ui.base.Event("sourceChange", this.oGanttChartContainer._oToolbar, {id: "d3"});
				this.oGanttChartContainer._onToolbarSourceChange(this.oEvent);
				strictEqual(this.oGanttChartContainer.getContainerLayoutKey(), "d3", "source change");
				this.oEvent = new sap.ui.base.Event("layoutChange", this.oGanttChartContainer._oToolbar, {id: "orientation", value: sap.ui.core.Orientation.Horizontal});
				this.oGanttChartContainer._onToolbarLayoutChange(this.oEvent);
				strictEqual(this.oGanttChartContainer._oSplitter.getOrientation(), sap.ui.core.Orientation.Horizontal, "Switch orientation");
				this.oEvent = new sap.ui.base.Event("addGanttChart", this.oGanttChartContainer._oToolbar, {id: "add", value: {hierarchyKey: "TOL"}});
				this.oGanttChartContainer._onToolbarLayoutChange(this.oEvent);
				ok(true, "add gantt chart");
				this.oEvent = new sap.ui.base.Event("lessGanttChart", this.oGanttChartContainer._oToolbar, {id: "less", value: {hierarchyKey: "TOL", ganttChartIndex: 0}});
				this.oGanttChartContainer._onToolbarLayoutChange(this.oEvent);
				ok(true, "less gantt chart");
				this.oEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {draggingSource: "shape"});
				this.oGanttChartContainer._onChartDragLeave(this.oEvent);
				strictEqual(this.oGanttChartContainer._oDraggingSource, "shape", "drage leave");
				this.oEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {draggingSource: undefined});
				this.oGanttChartContainer._onChartDragLeave(this.oEvent);
				strictEqual(this.oGanttChartContainer._oDraggingSource, undefined, "drage leave");
				this.oOriginEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {button: 0, buttons: 1});
				this.oEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {originEvent: this.oOriginEvent});
				this.oGanttChartContainer._onChartDragEnter(this.oEvent);
				strictEqual(this.oGanttChartContainer._oDraggingSource, undefined, "drage enter");
				this.oGanttChartContainer._oDraggingSource = "shape";
				this.oOriginEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {button: 0, buttons: 1});
				this.oOriginEvent.button = 0;
				this.oOriginEvent.buttons = 1;
				this.oEvent = new sap.ui.base.Event("dnd", this.oGanttChartContainer.getGanttCharts()[0], {originEvent: this.oOriginEvent, button: 0, buttons: 1});
				this.oGanttChartContainer._onChartDragEnter(this.oEvent);
				strictEqual(this.oGanttChartContainer._oDraggingSource, undefined, "drage enter");
				
				this.oGanttChartContainer.removeGanttChart(0);
				strictEqual(this.oGanttChartContainer.getGanttCharts().length, 1, "Remove gantt chart");
				this.oGanttChartContainer.removeAllGanttCharts();
				strictEqual(this.oGanttChartContainer.getGanttCharts().length, 0, "Remove all gantt charts");
				strictEqual(this.oGanttChartContainer.getToolbarSchemeKey(), "GLOBAL_TOOLBAR", "Get toolbar scheme key");
			});
		</script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="UIArea0"></div>
	</body>
</html>