<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta charset="UTF-8">

		<title>QUnit: CalendarPattern QUnit Test page</title>

		<script id="sap-ui-bootstrap"
			src="../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.gantt">
		</script>

		<link rel="stylesheet" type="text/css" href="../../../../../resources/sap/ui/thirdparty/qunit.css"/>
		<script src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
		<script src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script type="application/javascript">
		if(!(sap.ui.Device.browser.internet_explorer && sap.ui.Device.browser.version <= 8)) {
		      jQuery.sap.require("sap.ui.qunit.qunit-coverage");
		}			
		
			sap.ui.require(["sap/gantt/drawer/CalendarPattern",
			                "sap/gantt/def/cal/CalendarDefs",
			                "sap/gantt/def/cal/Calendar",
							"sap/gantt/def/cal/TimeInterval"
							], 
			function(CalendarPattern, CalendarDefs, Calendar, TimeInterval){
				"use strict";
				
				QUnit.module("CalendarPattern Module",{
					setup: function() {
						this.aTimeIntervalData = [{"startTime":"20150919000000", "endTime": "20150920000000"},
							                         {"startTime":"20150926000000", "endTime": "20150927000000"},
							                         {"startTime":"20151003000000", "endTime": "20151004000000"},
							                         {"startTime":"20151010000000", "endTime": "20151011000000"}];
						this.aTimeIntervals = [];
						for (var i=0;i<this.aTimeIntervalData.length; i++) {
							var oTimeInterval = new TimeInterval({
								"startTime":this.aTimeIntervalData[i].startTime, 
							    "endTime": this.aTimeIntervalData[i].endTime
							});
							this.aTimeIntervals.push(oTimeInterval);
						}
						this.aCalendar = new Calendar({
							  "key": "goodHoliday",
							  "color": "grey",
							  "timeIntervals": this.aTimeIntervals
						});
						this.oCalendarDefs = new CalendarDefs({
							defs: [this.aCalendar]
						});
						
						var sParentId = "sapGanttChart";
						var oStatusSet = {
								aViewBoundary: [0,1500] 
						};
						var iBaseRowHeight = 32;
						var aSvgBodyNode = d3.selectAll("." + sParentId + "Svg");
							
						this.oCalendarPattern = new CalendarPattern();
						this.oCalendarPattern.drawSvg(aSvgBodyNode, sParentId, this.oCalendarDefs, oStatusSet, iBaseRowHeight);
					},
					teardown: function(){
						this.oCalendarPattern = undefined;
						this.aTimeIntervalData = undefined;
						this.aTimeIntervals = undefined;
						this.aCalendar = undefined;
					}
				});
				QUnit.test("CalendarPattern should be drawn correctly", function(assert){
					var $defs = jQuery('.sapGanttChartSvg').find('defs');
					assert.ok($defs.length === 1, "Defs created");
					
					var $pattern = jQuery('.sapGanttChartSvg').find('defs').find('pattern');
					assert.ok($pattern.length === 1, "pattern created");
					
					var $rect = jQuery('.sapGanttChartSvg').find('defs').find('pattern').find('rect');
					assert.ok($rect.length === 4, "Rect created");
				});
				
			});

		</script>
	</head>
	<body>
		<div id="qunit"></div>
		
		<svg class="sapGanttChartHeaderSvg" width="1000" height="100"></svg>
		<svg class="sapGanttChartSvg" width="1000" height="500">
		  <defs id="sapGanttChart-calendardefs"/>
		</svg>
	</body>
</html>
