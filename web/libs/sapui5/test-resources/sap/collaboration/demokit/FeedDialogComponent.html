<!DOCTYPE HTML>
<html data-sap-ui-dk-category="Components/Collaboration" data-sap-ui-dk-controls="sap.collaboration.components.fiori.feed.component">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta charset="UTF-8"/>
		<title>Discuss Dialog Component - SAPUI5 Demo Kit</title>
		<script id="sap-ui-bootstrap"
				src="../../../../resources/sap-ui-core.js"
				data-sap-ui-theme="sap_bluecrystal"
				data-sap-ui-libs="sap.m,sap.ui.commons,sap.ui.demokit,sap.collaboration"
				>
		</script>
		
		<script>
		jQuery.sap.require("sap.collaboration.library");
		jQuery.sap.require("sap.ui.core.util.MockServer");
		jQuery.sap.getObject("sap.ui.demokit", 0)._supportedThemes = ["sap_bluecrystal"];
			
					
		// SMI OData MockServer
		this.oMockServer = new sap.ui.core.util.MockServer({
			rootUri : "/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV/"
		});	
		
		this.oMockServer.simulate("mockserver/smiodata/SMIV2_metadata.xml");
		
		var aRequests = this.oMockServer.getRequests();
		
		aRequests.push({
 			method: "GET",
 			path: new RegExp("GetCollaborationHostURL"),
 			response: function(oXhr){
 				oXhr.respondJSON(200, {}, '{ "d": { "GetCollaborationHostURL": { "__metadata": { "type": "SM_INTEGRATION_V2_SRV.CollaborationHostURL" }, "URL": "https://integration3.sapjam.com" } } }');
 			}
 		});
		// mocked server response for the parameter 'id'
		aRequests.push({
 			method: "GET",
 			path: new RegExp("GetExternalODataURL.*"),
 			response: function(oXhr){
 				oXhr.respondJSON(200, {}, '{"d":{"GetExternalODataURL":{"__metadata":{"type":"SM_INTEGRATION_V2_SRV.ExternalODataURL"},"URL":"https://www.example.com/sap/opu/odata/sap/TEST_SRV/TestCollection()"}}}');
 			}
 		});
		
		// mocked server response for the parameter 'type'
		aRequests.push({
 			method: "GET",
 			path: new RegExp("GetExternalODataURL.*metadata.*"),
 			response: function(oXhr){
 				oXhr.respondJSON(200, {}, '{"d":{"GetExternalODataURL":{"__metadata":{"type":"SM_INTEGRATION_V2_SRV.ExternalODataURL"},"URL":"https://www.example.com/sap/opu/odata/sap/TEST_SRV/$metadata#TestCollection"}}}');
 			}
 		});
		
		this.oMockServer.setRequests(aRequests);
		this.oMockServer.start();
		
		// Jam MockServer
		this.oJamMockServer = new sap.ui.core.util.MockServer({
			rootUri : "/sap/bc/ui2/smi/rest_tunnel/Jam//v1/"
		});	
		
		aRequests = oJamMockServer.getRequests();
		
		aRequests.push({
 			method: "POST",
 			path: new RegExp("single_use_tokens"),
 			response: function(oXhr){
 				oXhr.respondXML(201, null, '<?xml version="1.0" encoding="utf-8"?><single_use_token id="12345"><created_at>2014-10-06T18:39:33Z</created_at><expires_by>2014-10-06T19:39:33Z</expires_by></single_use_token>');
 			}
 		});
		
		this.oJamMockServer.setRequests(aRequests);
		this.oJamMockServer.start();
		
		// Feed Widget MockServer - currently not working as expected
		/* var oJamMockServer = new sap.ui.core.util.MockServer({
			rootUri : "http://integration3.sapjam.com",
			requests : [{
				method : "GET",
				path : "\\/assets\\/.+",
				response : function(oXhr) {
					oXhr.respondFile(200, { "Content-Type" : "application/javascript", "Accept-Ranges" : "bytes", "Connection": "Keep-Alive", "Content-Encoding" : "gzip", "Content-Length" : 41436 }, "./mockserver/responses/feed_widget_v1.js");
				}
			},{
				method : "GET",
				path : "\\/widget\\/v1\\/feed\.+",
				response : function(oXhr) {
					oXhr.respondFile(200, null, "./mockserver/responses/testFile.txt");
				}
			}]
		});
		
		oJamMockServer.start(); */
		</script>
		
		<script id='DiscussDialogComponent'>
			var externalObject = {
				  id: "http://www.example.com/TEST_SERVICE/TestCollection('1')", 
				  name: "Test Object",
				  type: "http://www.example.com/TEST_SERVICE/$metadata#TestCollection",
				  ui_url: "http://www.example.com/TestApplication"
					};
			
			var oDiscussDialogComponent = sap.ui.getCore().createComponent({
				name: "sap.collaboration.components.fiori.feed.dialog",
				id: "discussDialogComponent",
				settings: {	
			        		object: externalObject
				}
			});
			
			var openDiscussDialogButton = new sap.m.Button({
				text: "Open Discuss Dialog",
				press : function() {
					oDiscussDialogComponent.open();
				}
			});
			
		</script>
		
	</head>
	
	<body class="sapUiDemokitBody" role="application">
		<h1 color="Blue" icon="images/comps/feed-dialog.png">Discuss Dialog Component</h1>
		
		<h2>Introduction</h2>
		
		<p>
			The <b>Discuss Dialog</b> component is an SAPUI5 component that wraps the SAP Jam Feed Widget in a dialog, allowing users to start a discussion about a business object in SAP Jam. 
		</p>
		
		<!-- a invisible dummy heading to avoid automatic insertion of a 'settings' section -->
		<h2 id="settings" style="display:none">Settings</h2>
		
		<h2>Example</h2>
		
		<img src="images/discuss_dialog_screenshot.png">
		<p>
		
		<div code-sample="example1" script="DiscussDialogComponent"></div>
		
		<br/>
		
		<p>See <a class="sapUiDemokitSrcLink" href="../../../../docs/api/symbols/sap.collaboration.components.fiori.feed.dialog.Component.html">API documentation</a></p>  
						
	</body>
</html>