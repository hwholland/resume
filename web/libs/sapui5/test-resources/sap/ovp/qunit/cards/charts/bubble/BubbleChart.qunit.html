<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>QUnit test for cards.charts.bubble.BubbleChart - sap.ovp</title>
    <script>
        this.JsUnit = this.JsUnit || {}; // disable LESS support by faking JsUnit test runner
        window["sap-ushell-config"] = {
            defaultRenderer: "fiori2",
            renderers: {
                fiori2: {
                    componentData: {
                        config: {}
                    }
                }
            },
            services: {}
        };
    </script>
    <script src="../../../../../../sap/ushell/bootstrap/sandbox.js"></script>
    <script id="sap-ui-bootstrap"
            type="text/javascript"
            src="../../../../../../../resources/sap-ui-core.js"
            data-sap-ui-resourceroots='{
				"sap.ovp.test": "../../../../../../sap/ovp/"
			}'>
    </script>
    <link rel="stylesheet" href="../../../../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
    <script src="../../../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
    <script src="../../../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
    <script src="../../../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
    <script src="../../../../../../../resources/sap/ui/thirdparty/sinon.js"></script>
    <script>
        jQuery.sap.registerModulePath("sap.ushell", "../../../../../../../resources/sap/ushell");
    </script>
    <script>
        (function(){
            "use strict";

            jQuery.sap.require("sap.ui.model.odata.AnnotationHelper");
            jQuery.sap.require("sap.ovp.test.qunit.cards.utils");
            jQuery.sap.require("sap.ovp.test.qunit.cards.charts.utils");


            // Preloading the VIZ library before executing the tests to prevent the time out issue during the execution of tests.
            jQuery.sap.require("sap.viz.ui5.controls.VizFrame");
            jQuery.sap.require("sap.viz.ui5.data.FlattenedDataset");
            jQuery.sap.require("sap.m.Button");

            var cardUtils = sap.ovp.test.qunit.cards.utils;
            var chartUtils = sap.ovp.test.qunit.cards.charts.utils;

            var parameterTestCase = "Bubble chart - With Input Parameters";

            module("sap.ovp.cards.charts.Bubble", {
                /**
                 * This method is called before each test
                 */
                 beforeEach: function (test) {
               	  jQuery.sap.require("sap.ovp.test.mockservers");
               	  var baseURL = chartUtils.odataBaseUrl;
               	  var rootURL = chartUtils.odataRootUrl;
               	  if ( test.test.testName == parameterTestCase) {
                   	  baseURL = chartUtils.odataBaseUrl2;
                   	  rootURL = chartUtils.odataRootUrl_InputParameters;
               	  }
                   sap.ovp.test.mockservers.loadMockServer(baseURL, rootURL);
               },
                /**
                 * This method is called after each test. Add every restoration code here
                 *
                 */
                afterEach: function () {
                    sap.ovp.test.mockservers.close();
                }
            });

            test("Bubble chart - Without Filters",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_nofilter.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare" , "sorter": [{"path": "Sales","descending": true}]},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }

                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml, false), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });

            test("Bubble chart - With Filters",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country_Product",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"}]},
                                    dimensions: [
                                        {
                                            name: "Product ID",
                                            value: "{Product}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });
            
            test("Bubble chart - With Reference Value as Path",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_path.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"}]},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            },
                            referenceValue : {
                            	
                            	path : "SalesShare"
                            
                            }
                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.referenceValuePathExists(cardXml, expectedListRes.referenceValue.path), "KPI Number Value - see that there is a path for reference value");
                });
            });

            test("Bubble chart - With Filters Without Sorter",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_nosorter.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Currency","operator":"EQ","value1":"EUR"}]},
                                    dimensions: [
                                        {
                                            name: "Supplier Company",
                                            value: "{SupplierCompany}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });

            test("Bubble chart - With Input Parameters",function(){
                var cardTestData = {
                    card: {
                        "id": "chart_15",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                        "entitySet": "SalesOrder",
                        "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                        "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                        "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                        "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                        "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country"
                      }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl2,
                        rootUri: chartUtils.odataRootUrl_InputParameters,
                        annoUri: chartUtils.odataBaseUrl2 + "annotations_InputParamets.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesOrderParameters(P_Currency=%27EUR%27,P_CountryCode=%27IN%27)/Results" , "filters": [],
                                            "sorter": [], "parameters": {"select":"Country,NetAmount"}, length: 4},
                                    dimensions: [
                                        {
                                            name:"Product",
                                            value:"{Product}"
                                        },
                                        {
                                            name:"Country",
                                            value:"{Country}"
                                        },
                                        {
                                            name:"Region",
                                            value:"{Region}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Net Amount",
                                            value: "{NetAmount}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });

			test("Bubble chart - With faulty filter configuration",function(){
                var cardTestData = {
                    card: {
                        "id": "chart_152",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#NON_EXISTENT",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare"},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml, false), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });

			test("Bubble chart - Without DataPoint Annotation",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_153",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_NoDataPoint.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"}]},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml, true, false), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                    
                    
                    var iContext = chartUtils.getSimulatedIContext(oView);
                    var devUtils = sap.ovp.cards.charts.Utils;
                    var dimensionsObject = chartUtils.getDimensionsArgument(expectedListRes.VizFrame.dataSet.dimensions);
                    ok(chartUtils.isValidBoolean(devUtils.BubbleChart.testColorFeed(iContext, dimensionsObject)), "Bubble Color Feed Tester Test");
                    ok(chartUtils.isValidString(devUtils.BubbleChart.getColorFeed(iContext, dimensionsObject)), "Bubble Color Feed Test");
                    ok(chartUtils.isValidBoolean(devUtils.BubbleChart.testShapeFeed(iContext, dimensionsObject)), "Bubble Shape Feed Tester Test");
                    ok(chartUtils.isValidString(devUtils.BubbleChart.getShapeFeed(iContext, dimensionsObject)), "Bubble Shape Feed Test");
                });
            });

			test("Bubble chart - With DataPoint, Without Title and Value",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_153",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_NoDataPoint.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"}]},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml, true, false), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                    
                    
                    var iContext = chartUtils.getSimulatedIContext(oView);
                    var devUtils = sap.ovp.cards.charts.Utils;
                    var dimensionsObject = chartUtils.getDimensionsArgument(expectedListRes.VizFrame.dataSet.dimensions);
                    ok(chartUtils.isValidBoolean(devUtils.BubbleChart.testColorFeed(iContext, dimensionsObject)), "Bubble Color Feed Tester Test");
                    ok(chartUtils.isValidString(devUtils.BubbleChart.getColorFeed(iContext, dimensionsObject)), "Bubble Color Feed Test");
                    ok(chartUtils.isValidBoolean(devUtils.BubbleChart.testShapeFeed(iContext, dimensionsObject)), "Bubble Shape Feed Tester Test");
                    ok(chartUtils.isValidString(devUtils.BubbleChart.getShapeFeed(iContext, dimensionsObject)), "Bubble Shape Feed Test");
                });
            });

            test("Bubble chart - With ObjectStream Filters",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_159",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "filters": [{
                                "path" : "Region",
                                "operator" : "EQ",
                                "value1" : "APJ"
                            }],
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"},{"path" : "Region","operator" : "EQ","value1" : "APJ"}]},
                                    dimensions: [
                                        {
                                            name: "Date",
                                            value: "{Date}"
                                        }
                                    ],
                                    measures: [
                                        {
                                            name: "Sales Share",
                                            value: "{SalesShare}"
                                        }]
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeExists(cardXml,"bubble"), "VIZ Frame - see that there is a VIZFrame for bubble chart");
                    ok(chartUtils.vizSkeletonExists(cardXml), "VIZ Frame - see that the VIZFrame required format is maintained(Skeleton). ");
                    ok(chartUtils.dimensionItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.dimensions), "VIZ Frame - see that there is dimensions binding");
                    ok(chartUtils.measureItemsNodeExists(cardXml, expectedListRes.VizFrame.dataSet.measures), "VIZ Frame - see that there is measures binding");
                    ok(chartUtils.dataBinding(cardXml, expectedListRes.VizFrame.dataSet.data), "VIZ Frame - see that there is data binding");
                });
            });


            
            
            test("Bubble chart - With MeasureAttributes and DimensionAttributes missing",function(){

                var cardTestData = {
                    card: {
                        "id": "chart_159",
                        "model": "salesShare",
                        "template": "sap.ovp.cards.charts.bubble",
                        "settings": {
                            "entitySet": "SalesShare",
                            "filters": [{
                                "path" : "Region",
                                "operator" : "EQ",
                                "value1" : "APJ"
                            }],
                            "selectionAnnotationPath" : "com.sap.vocabularies.UI.v1.SelectionVariant#Eval_by_Country",
                            "chartAnnotationPath" : "com.sap.vocabularies.UI.v1.Chart#Eval_by_Country",
                            "presentationAnnotationPath" : "com.sap.vocabularies.UI.v1.PresentationVariant#Eval_by_Country",
                            "dataPointAnnotationPath" : "com.sap.vocabularies.UI.v1.DataPoint#Eval_by_Country",
                            "identificationAnnotationPath" : "com.sap.vocabularies.UI.v1.Identification#Eval_by_Country",
                            "type": "sap.ovp.cards.charts.bubble.BubbleChart"
                        }
                    },
                    dataSource: {
                        baseUrl: chartUtils.odataBaseUrl,
                        rootUri: chartUtils.odataRootUrl,
                        annoUri: chartUtils.testBaseUrl + "data/salesshare/annotations_NoDimMeas.xml"
                    },
                    expectedResult: {
                        Header: {
                        },
                        Body: {
                            VizFrame: {
                                vizType : "bubble",
                                dataSet : {
                                    data: { "path": "/SalesShare", "sorter": [{"path": "Sales","descending": true}] , "filters": [{"path":"Country","operator":"EQ","value1":"IN"},{"path":"Country","operator":"EQ","value1":"US"},{"path":"Currency","operator":"EQ","value1":"EUR"},{"path" : "Region","operator" : "EQ","value1" : "APJ"}]},
                                    dimensions: [],
                                    measures: []
                                }
                            }

                        }
                    }
                };

                var oModel = cardUtils.createCardModel(cardTestData);
                stop();
                oModel.getMetaModel().loaded().then(function () {

                    var oView = cardUtils.createCardView(cardTestData, oModel);

                    //start the async test
                    start();

                    var cardXml = oView._xContent;
                    ok(cardXml !== undefined,"Existence check to XML parsing");

                    var cardCfg = cardTestData.card.settings;
                    var expectedListRes = cardTestData.expectedResult.Body;

                    // basic list XML structure tests
                    ok(chartUtils.ovpNodeExists(cardXml), "OVP Card - see that there is a OVP Card Format");
                    ok(chartUtils.vizNodeNotExists(cardXml, "bubble"), "VIZ Frame - see that there is no VIZFrame rendered for bubble chart");
                });
            });
   
        }());
    </script>
</head>
<body>
<h1 id="qunit-header"></h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<div id="qunit-testrunner-toolbar"></div>
<ol id="qunit-tests"></ol>
</body>
</html>