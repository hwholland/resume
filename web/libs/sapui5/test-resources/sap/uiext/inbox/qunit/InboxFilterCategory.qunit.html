<!DOCTYPE HTML>

<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script id="sap-ui-bootstrap" type="text/javascript"
	src="../../../../../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal" data-sap-ui-language="en-US"
	data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.ui.commons,sap.uiext.inbox">
	</script>
<link rel="stylesheet"
	href="../../../../../resources/sap/ui/thirdparty/qunit.css"
	type="text/css" media="screen" />
<script type="text/javascript"
	src="../../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript"
	src="../../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script>
			// redirect any resource loading for "sap.uiext.inbox.qunit.mockServer" to the local folder "mockServer/" 
			jQuery.sap.registerModulePath("sap.uiext.inbox.qunit.mockServer", "mockServer/");
			
			// now load and activate the mock server
			jQuery.sap.require("sap.uiext.inbox.qunit.mockServer.InboxMockServerQUnitCategoryFilter");
			jQuery.sap.require("sap.ui.core.IconPool");
			
			module("Load");

			test("InboxCreationOk",function() {
				sap.ui.getCore().applyChanges(); 
				var oInbox = jQuery.sap.byId("inbox");
				equals(false, (oInbox === undefined), "Checking if the Inbox Control is created and is not undefined.");
				equals(false, (oInbox === null), "Checking if the Inbox Control is created and is not null.");
				qutils.triggerMouseEvent("inbox" + "--tableViewSelectionButton", "click");
			});
			
			
			module("CategoryFilter");
			
			asyncTest("Checking facet filter, table columns and toolbar container on initial load", function() {
				qutils.triggerMouseEvent("inbox--filterViewButton", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oToolbar = sap.ui.getCore().byId('inbox--actionButtonsToolbarContainer');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var oDataOfSecondRow = oTable.getRows()[1].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.taskData.d.results[0].TaskTitle;
					var sTaskTitleOfSecondRow  = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.taskData.d.results[1].TaskTitle;
					var sIsTaskSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[0]
					
					equals( oFacetFilter.getLists()[0].getSelectedKeys()[0], sIsTaskSelectedInCategoryFilter, "Tasks is selected on initial load in category filter");
					equals( oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals(oDataOfFirstRow.getAggregation('titleLink').getText(), sTaskTitleOfFirstRow , "Correct data is bound to task table");
					equals( oDataOfSecondRow.getAggregation('titleLink').getText(), sTaskTitleOfSecondRow, "Correct data is bound to task table");
					equals( oToolbar.getItems()[4].getEnabled(), true, "Substitution Action button is enabled");
					
					
					equals( oFacetFilter.getLists().length, 6, "Number of Lists in facet filter is correct");
					equals( oFacetFilter.getLists()[0].getId(), "inbox--INBOX_FILTER_CATEGORY", "category filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[1].getId(), "inbox--INBOX_FILTER_TASK_TYPE", "task type filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[2].getId(), "inbox--INBOX_FILTER_PRIORITY", "priority filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[3].getId(), "inbox--INBOX_FILTER_STATUS", "status filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[4].getId(), "inbox--INBOX_FILTER_CREATION_DATE", "creation date filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[5].getId(), "inbox--INBOX_FILTER_DUE_DATETIME", "due date filter exists in facet filter at index 0");
					
					
					
					equals( oTable.getColumns().length, 6, "Number of columns in task table on initial load is correct");
					equals( oTable.getColumns()[0].getId(), "inbox--TaskTitle", "column at index 0 is task title");
					equals( oTable.getColumns()[1].getId(), "inbox--CreatedOn", "column at index 1 is created on");
					equals( oTable.getColumns()[2].getId(), "inbox--CreatedByName", "column at index 2 is created by");
					equals( oTable.getColumns()[3].getId(), "inbox--CompletionDeadLine", "column at index 3 is due date");
					equals( oTable.getColumns()[4].getId(), "inbox--Status", "column at index 4 is status");
					equals( oTable.getColumns()[5].getId(), "inbox--Priority", "column at index 5 is task priority");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Checking facet filter, table columns and toolbar tontainer on selecting Todo in Category filter", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_TODO", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oToolbar = sap.ui.getCore().byId('inbox--actionButtonsToolbarContainer');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.todoData.d.results[0].TaskTitle;
					var sTodoSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[1];
					
					equals( oToolbar.getItems()[4].getEnabled(), false, "Substitution Action button is disabled");
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sTodoSelectedInCategoryFilter, "Todo is selected in category filter ");
					equals( oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals( oDataOfFirstRow.getTitleLink().getProperty("text"), sTaskTitleOfFirstRow, "Correct data is bound to task table");
					
					
					equals( oFacetFilter.getLists().length, 4, "Number of Lists in facet filter is correct");
					equals( oFacetFilter.getLists()[0].getId(), "inbox--INBOX_FILTER_CATEGORY", "category filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[1].getId(), "inbox--INBOX_FILTER_TASK_TYPE", "task type filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[2].getId(), "inbox--INBOX_FILTER_STATUS", "status filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[3].getId(), "inbox--INBOX_FILTER_CREATION_DATE", "creation date filter exists in facet filter at index 0");
					
					equals( oTable.getColumns().length, 5, "Number of columns in task table on initial load is correct");
					equals( oTable.getColumns()[0].getId(), "inbox--TaskTitle", "column at index 0 is task title");
					equals( oTable.getColumns()[1].getId(), "inbox--CreatedOn", "column at index 1 is created on");
					equals( oTable.getColumns()[2].getId(), "inbox--CreatedByName", "column at index 2 is created by");
					equals( oTable.getColumns()[3].getId(), "inbox--Status", "column at index 4 is status");
					equals( oTable.getColumns()[4].getId(), "inbox--Priority", "column at index 5 is task priority");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Checking facet filter, table columns and toolbar tontainer on selecting Alert in Category filter", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_ALERT", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oToolbar = sap.ui.getCore().byId('inbox--actionButtonsToolbarContainer');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.alertData.d.results[0].TaskTitle;
					var sAlertSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[2];
					
					equals( oToolbar.getItems()[4].getEnabled(), false, "Substitution Action button is disabled");
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sAlertSelectedInCategoryFilter, "Alert is selected in category filter ");
					equals( oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals( oDataOfFirstRow.getTitleLink().getProperty("text"), sTaskTitleOfFirstRow, "Correct data is bound to task table");
					
					equals( oFacetFilter.getLists().length, 5, "Number of Lists in facet filter is correct");
					equals( oFacetFilter.getLists()[0].getId(), "inbox--INBOX_FILTER_CATEGORY", "category filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[1].getId(), "inbox--INBOX_FILTER_TASK_TYPE", "task type filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[2].getId(), "inbox--INBOX_FILTER_PRIORITY", "priority filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[3].getId(), "inbox--INBOX_FILTER_STATUS", "status filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[4].getId(), "inbox--INBOX_FILTER_CREATION_DATE", "creation date filter exists in facet filter at index 0");
					
					equals( oTable.getColumns().length, 5, "Number of columns in task table on initial load is correct");
					equals( oTable.getColumns()[0].getId(), "inbox--TaskTitle", "column at index 0 is task title");
					equals( oTable.getColumns()[1].getId(), "inbox--CreatedOn", "column at index 1 is created on");
					equals( oTable.getColumns()[2].getId(), "inbox--CreatedByName", "column at index 2 is created by");
					equals( oTable.getColumns()[3].getId(), "inbox--Status", "column at index 4 is status");
					equals( oTable.getColumns()[4].getId(), "inbox--Priority", "column at index 5 is task priority");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Checking facet filter, table columns and toolbar tontainer on selecting Task in Category filter", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_TASKS", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oToolbar = sap.ui.getCore().byId('inbox--actionButtonsToolbarContainer');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.taskData.d.results[0].TaskTitle;
					var sTasksSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[0];
					equals( oToolbar.getItems()[4].getEnabled(), true, "Substitution Action button is enabled");
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sTasksSelectedInCategoryFilter, "Tasks is selected in category filter ");
					equals( oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals( oDataOfFirstRow.getTitleLink().getProperty("text"), sTaskTitleOfFirstRow, "Correct data is bound to task table");
					
					equals( oFacetFilter.getLists().length, 6, "Number of Lists in facet filter is correct");
					equals( oFacetFilter.getLists()[0].getId(), "inbox--INBOX_FILTER_CATEGORY", "category filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[1].getId(), "inbox--INBOX_FILTER_TASK_TYPE", "task type filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[2].getId(), "inbox--INBOX_FILTER_PRIORITY", "priority filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[3].getId(), "inbox--INBOX_FILTER_STATUS", "status filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[4].getId(), "inbox--INBOX_FILTER_CREATION_DATE", "creation date filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[5].getId(), "inbox--INBOX_FILTER_DUE_DATETIME", "due date filter exists in facet filter at index 0");
					
					equals( oTable.getColumns().length, 6, "Number of columns in task table on initial load is correct");
					equals( oTable.getColumns()[0].getId(), "inbox--TaskTitle", "column at index 0 is task title");
					equals( oTable.getColumns()[1].getId(), "inbox--CreatedOn", "column at index 1 is created on");
					equals( oTable.getColumns()[2].getId(), "inbox--CreatedByName", "column at index 2 is created by");
					equals( oTable.getColumns()[3].getId(), "inbox--CompletionDeadLine", "column at index 3 is due date");
					equals( oTable.getColumns()[4].getId(), "inbox--Status", "column at index 4 is status");
					equals( oTable.getColumns()[5].getId(), "inbox--Priority", "column at index 5 is task priority");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Checking facet filter, table columns and toolbar tontainer on selecting Notification in Category filter", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_NOTIFICATION", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oToolbar = sap.ui.getCore().byId('inbox--actionButtonsToolbarContainer');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.notificationData.d.results[0].TaskTitle;
					var sNotificationSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[3];
					
					equals( oToolbar.getItems()[4].getEnabled(), false, "Substitution Action button is disabled");
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sNotificationSelectedInCategoryFilter, "Notification is selected in category filter ");
					equals(  oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals( oDataOfFirstRow.getTitleLink().getProperty("text"), sTaskTitleOfFirstRow, "Correct data is bound to task table");
					
					
					equals( oFacetFilter.getLists().length, 5, "Number of Lists in facet filter is correct");
					equals( oFacetFilter.getLists()[0].getId(), "inbox--INBOX_FILTER_CATEGORY", "category filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[1].getId(), "inbox--INBOX_FILTER_TASK_TYPE", "task type filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[2].getId(), "inbox--INBOX_FILTER_PRIORITY", "priority filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[3].getId(), "inbox--INBOX_FILTER_STATUS", "status filter exists in facet filter at index 0");
					equals( oFacetFilter.getLists()[4].getId(), "inbox--INBOX_FILTER_CREATION_DATE", "creation date filter exists in facet filter at index 0");
					
					equals( oTable.getColumns().length, 5, "Number of columns in task table on initial load is correct");
					equals( oTable.getColumns()[0].getId(), "inbox--TaskTitle", "column at index 0 is task title");
					equals( oTable.getColumns()[1].getId(), "inbox--CreatedOn", "column at index 1 is created on");
					equals( oTable.getColumns()[2].getId(), "inbox--CreatedByName", "column at index 2 is created by");
					equals( oTable.getColumns()[3].getId(), "inbox--Status", "column at index 4 is status");
					equals( oTable.getColumns()[4].getId(), "inbox--Priority", "column at index 5 is task priority");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			module("Filter preservation in categoty filter");
			asyncTest("Selecting priority filter - Low if notification is selected in category filter", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_PRIORITY_LOW", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var sLowSelectedInPriorityFilter = sap.uiext.inbox.InboxConstants.aFilterMetaData[1].attributes[0];
					var sNotificationSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[3];
					
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sNotificationSelectedInCategoryFilter, "Notification is selected in category filter ");
					equals( oFacetFilter.getLists()[2].getSelectedKeys(), sLowSelectedInPriorityFilter, "Low is selected in Priority filter ");
					equals( oTable.getRows()[0].getCells()[4].getText(), "Low", "Correct data is bound to task table");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Selecting Category Todo", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_TODO", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var oDataOfFirstRow  = oTable.getRows()[0].getCells()[0];
					var sTaskTitleOfFirstRow = sap.uiext.inbox.qunit.mockServer.InboxMockServerData.todoData.d.results[0].TaskTitle;
					var sTodoSelectedInCategoryFilter = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[1];
					
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sTodoSelectedInCategoryFilter, "Notification is selected in category filter ");
					equals(oDataOfFirstRow.getCategoryIconURI(), "sap-icon://task", "Task image is present in the content of first cell of the row");
					equals( oDataOfFirstRow.getTitleLink().getProperty("text"), sTaskTitleOfFirstRow, "Correct data is bound to task table");
					equals( oFacetFilter.getLists().length, 4, "Number of Lists in facet filter is correct");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			asyncTest("Selecting category notification and check if priority filter is still applied", function() {
				qutils.triggerMouseEvent("inbox--INBOX_FILTER_CATEGORY_NOTIFICATION", "click");
				sap.ui.getCore().applyChanges();
				
				var delayedCall = function() {
					var oTable = sap.ui.getCore().byId('inbox--listViewTable');
					var oFacetFilter = sap.ui.getCore().byId('inbox--filterFacet');
					var sLowSelectedInPriorityFilter = sap.uiext.inbox.InboxConstants.aFilterMetaData[1].attributes[0];
					var sNotificationSelectedInCategory = sap.uiext.inbox.InboxConstants.aDrillDownFilterMetadata[0].attributes[3];
					
					equals( oFacetFilter.getLists()[0].getSelectedKeys(), sNotificationSelectedInCategory, "Notification is selected in category filter ");
					equals( oFacetFilter.getLists()[2].getSelectedKeys(), sLowSelectedInPriorityFilter, "Low is selected in Priority filter ");
					equals( oTable.getRows()[0].getCells()[4].getText(), "Low", "Correct data is bound to task table");
					
					start();
				};
				setTimeout(delayedCall, 500);
			});
			
			QUnit.done(function() {
				qutils.triggerMouseEvent("inbox" + "--tableViewSelectionButton", "click");
			});
			
			</script>
</head>
<body>
	<h1 id="qunit-header">
		<title>qUnit Page for Inbox Task Category</title>
	</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
	<div id="canvas" style="height: 300px; width: 300px"></div>
	<br>
	<div id="uiArea1" style="width: 80%;"></div>
</body>
</html>