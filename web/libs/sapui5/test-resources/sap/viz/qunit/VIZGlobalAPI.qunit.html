<!DOCTYPE HTML>

<html lang='en'>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script id="sap-ui-bootstrap" type="text/javascript"
  src="../../../../resources/sap-ui-core.js"
  data-sap-ui-theme="sap_bluecrystal" data-sap-ui-language='en' data-sap-ui-libs="sap.ui.core,sap.ui.commons,sap.viz">
  
</script>
<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>

<script type="text/javascript" src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript" src="./js/data.js"></script>

<!-- Control initialization -->
<script language="javascript"> 
  var oChart, oVizFrame;
  module("Check Chart Language.");
  
  test("a1a2m1m1 Viz Bar", function(){
    ok(true, "a1a2m1m1 Viz Bar chart.");
    var oDataset = new sap.viz.ui5.data.FlattenedDataset(a1a2m1m1Data);
    var oModel = new sap.ui.model.json.JSONModel(a1a2m1m1Model);
    oDataset.setModel(oModel);
    oChart = new sap.viz.ui5.Bar('vizChart', {
      width : "800px",
      height : "600px",
      plotArea : {
        animation : {
          dataLoading : false,
          dataUpdating : false,
          resizing : false
        }
      },
      title : {
      	visible : true
      },
      legend : {
      	title : {
      		visible : true
      	}
      },
      dataset: oDataset
    });
    oChart.placeAt("content");
  });
  
  asyncTest("a1a2m1m1 VizFrame Bar", function(){
	    ok(true, "a1a2m1m1 VizFrame Bar chart.");
	    var oDataset = new sap.viz.ui5.data.FlattenedDataset(a1a2m1m1Data);
	    var oModel = new sap.ui.model.json.JSONModel(a1a2m1m1Model);
	    oDataset.setModel(oModel);
	    oVizFrame = new sap.viz.ui5.controls.VizFrame("vizframeChart", {
	      'width': '800px',
	      'height': '600px',
	        'uiConfig' : {
	          'applicationSet': 'fiori'
	        },
	        'vizType' : 'bar'
	     });
	    oVizFrame.setDataset(oDataset);
	    var feedPrimaryValues = new sap.viz.ui5.controls.common.feeds.FeedItem({
	        'uid' : "primaryValues",
	        'type' : "Measure",
	        'values' : ["REVENUE1", "REVENUE2"]
	      }), feedAxisLabels = new sap.viz.ui5.controls.common.feeds.FeedItem({
	        'uid' : "axisLabels",
	        'type' : "Dimension",
	        'values' : [ "COUNTRY"]
	      }), feedRegionColor = new sap.viz.ui5.controls.common.feeds.FeedItem({
	        'uid' : "regionColor",
	        'type' : "Dimension",
	        'values' : [ "YEAR"]
	      });
	    oVizFrame.addFeed(feedPrimaryValues);
	    oVizFrame.addFeed(feedAxisLabels);
	    oVizFrame.addFeed(feedRegionColor);
	    oVizFrame.placeAt('content');
	    oVizFrame.setVizProperties({
	        legend : {
	          	title : {
	          		visible : true
	          	}
	          }
	    });
	    
	    oVizFrame.attachEventOnce('renderComplete', function(){
	        equal($('#vizChart .v-m-title text').text(), "Title of Chart", 'Title Default language is en.');
	    	//Legend title turn off in fiori template
	    	//equal($('#vizChart .v-m-legend .v-title').text(), "All Measures - YEAR", 'All Measures Default language is en.');
	        equal($('#vizframeChart .v-m-title text').text(), "Title of Chart", 'Title Default language is en.');
	    	equal($('#vizframeChart .v-m-legend .v-title').text(), "YEAR / All Measures", 'All measures Default language is en.');
	        start();
	    });
  });
  
  asyncTest("Change language to de", function(){
      sap.ui.getCore().getConfiguration().setLanguage("de_DE");
      ok(true, "a1a2m1m1 Bar chart.");
      
      var count = 0;
      var checkLanguage = function() {
          if(count < 1) {
              count++;
              return;
          }
          equal($('#vizChart .v-m-title text').text(), "Diagrammtitel", 'Title Default language is de.');
            equal($('#vizChart .v-m-legend .v-title').text(), "Alle Kennzahlen - YEAR", 'All Measures Default language is de.');
            
            //TODO Chart's default title can't be customized. Vizframe needs to fix it.
            //SAP Jira BITSDC2-1603
            //equal($('#vizframeChart .v-m-title text').text(), "Diagrammtitel", 'Title Default language is de.');
           equal($('#vizframeChart .v-m-legend .v-title').text(), "YEAR / Alle Kennzahlen", 'All Measures Default language is de.');
           oVizFrame.detachEvent('renderComplete', checkLanguage);
            start();
      }
      
      oVizFrame.attachEvent('renderComplete', checkLanguage);
	});

  //disable on mar chrome due to fail in mac chrome 45 and viz chart is deprecated now.
  if (!(sap.ui.Device.os.macintosh && sap.ui.Device.browser.chrome)){
     asyncTest("Change language to en", function(){
        sap.ui.getCore().getConfiguration().setLanguage("en_US");
        ok(true, "a1a2m1m1 Bar chart.");
        
        var count = 0;
        var checkLanguage = function() {
            if(count < 1) {
                count++;
                return;
            }
            equal($('#vizChart .v-m-title text').text(), "Title of Chart", 'Title Default language is en.');
            equal($('#vizChart .v-m-legend .v-title').text(), "All Measures - YEAR", 'All Measures Default language is en.');
            
             equal($('#vizframeChart .v-m-title text').text(), "Title of Chart", 'Title Default language is en.');
             equal($('#vizframeChart .v-m-legend .v-title').text(), "YEAR / All Measures", 'All measures Default language is en.');
             oVizFrame.detachEvent('renderComplete', checkLanguage);
              start();
        }
        
        oVizFrame.attachEvent('renderComplete', checkLanguage);
     });
  }
	

  if (!(sap.ui.Device.os.macintosh && sap.ui.Device.browser.chrome)){
      asyncTest("Change language to de", function(){
      sap.ui.getCore().getConfiguration().setLanguage("de_DE");
      ok(true, "a1a2m1m1 Bar chart.");
    
      var count = 0;
      var checkLanguage = function() {
          if(count < 1) {
              count++;
              return;
          }
            equal($('#vizChart .v-m-title text').text(), "Diagrammtitel", 'Title Default language is de.');
          equal($('#vizChart .v-m-legend .v-title').text(), "Alle Kennzahlen - YEAR", 'All Measures Default language is de.');
          
          //TODO Chart's default title can't be customized. Vizframe needs to fix it.
          //SAP Jira BITSDC2-1603
          //equal($('#vizframeChart .v-m-title text').text(), "Diagrammtitel", 'Title Default language is de.');
        equal($('#vizframeChart .v-m-legend .v-title').text(), "YEAR / Alle Kennzahlen", 'All Measures Default language is de.');
        oVizFrame.detachEvent('renderComplete', checkLanguage);
          start();
      }
    
      oVizFrame.attachEvent('renderComplete', checkLanguage);

      });
  }

  asyncTest("Set numericformatter", function(){
    sap.viz.api.env.Format.numericFormatter({
    format : function(value, pattern) {
      var result = value;
      switch(pattern){
        case 'u1' : 
          result = result + "-" + pattern;
          break;
      }
      return result;
    }
  });  
    oChart.getXAxis().getLabel().setFormatString('u1');
    oVizFrame.setVizProperties({"xAxis":{"label":{"formatString":"u1"}}});
    
    ok(true, "Apply Customer Format.");
    
    oVizFrame.attachEventOnce('renderComplete', function() {
          equal($('#vizChart .v-m-xAxis .v-label text')[0].textContent, "0-u1", 'viz format should work.');     
        equal($('#vizframeChart .v-m-valueAxis .v-label text')[0].textContent, "0-u1", 'vizframe format should work.');
        cleanChart();
          start();
      });
  });
  
  var cleanChart = function() {
    if (oChart) {
      oChart.destroy();
    }
  };
</script>

<title>qunit Test for Display Charts</title>

</head>
<body class="sapUiBody">
  <h1 id="qunit-header">QUnit tests: display charts</h1>
  <h2 id="qunit-banner"></h2>
  <h2 id="qunit-userAgent"></h2>
  <div id='content' style="width: 100%; height: 600px; display: inline;"></div>
  <div id="qunit-testrunner-toolbar"></div>
  <ol id="qunit-tests"></ol>

</body>
</html>