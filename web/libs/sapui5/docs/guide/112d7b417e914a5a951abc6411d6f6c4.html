<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="abstract" content="In this step, you will be creating a 3D Viewer application using the sap.ui.vk.Viewport control."/>
<meta name="description" content="In this step, you will be creating a 3D Viewer application using the sap.ui.vk.Viewport control."/>

<link rel="stylesheet" type="text/css" href="css/prettify.css?x=8503671802345809"/>
<link rel="stylesheet" type="text/css" href="css/documentation.css?x=8503671802345809"/>
<title>Step 3: 3D Viewer Using the Viewport Control</title>
  <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/themes/base/highlight-query-terms.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/js/google-code-prettify/prettify.css" />
    <script src="../../resources/sap/ui/demokit/js/sdk-pagehelper.js"></script>
  </head>
<body class="" id="loio112d7b417e914a5a951abc6411d6f6c4">
<div id="wrapper"><div id="container">

	<h1 class="title topictitle1">Step 3: 3D Viewer Using the Viewport Control</h1>

	
	<div class="body conbody"><p class="shortdesc">In this step, you will be creating a 3D Viewer application using the
            <samp class="ph codeph">sap.ui.vk.Viewport</samp> control.</p>

        <div class="note caution"><span class="cautiontitle">Caution</span> The controls in the <samp class="ph codeph">sap.ui.vk</samp> library are currently
            flagged as experimental. For more information, see <a class="xref" href="91f087396f4d1014b6dd926db0e91070.html" title="The following sections describe what SAP can change in major, minor, and patch releases. Always consider these rules when developing apps, features, or controls with or for SAPUI5.">Compatibility Rules</a>.</div>

        <div class="p">In previous steps, we utilized the <samp class="ph codeph">sap.ui.vk.Viewer</samp> composite control to
            create a Viewer application capable of loading a 2D or 3D resource. Now, we will create
            a Viewer application with a pre-loaded resource without using the composite
                <samp class="ph codeph">sap.ui.vk.Viewer</samp> control. Instead, we will use the following
            controls and library in <samp class="ph codeph">sap.ui.vk</samp>, which are what you'll need at a
            minimum to display a 3D model in your application. <ul class="ul" id="loio112d7b417e914a5a951abc6411d6f6c4__ul_kxm_nkq_yt">
                <li class="li"><samp class="ph codeph">Viewport</samp> control</li>

                <li class="li"><samp class="ph codeph">ContentResource</samp> control</li>

                <li class="li"><samp class="ph codeph">GraphicsCore</samp> library</li>

            </ul>
</div>

        <p class="p">We will build on this sample application in later steps of the 3D Viewer tutorial by
            introducing the other non-composite <samp class="ph codeph">sap.ui.vk</samp> controls to create more
            complex Viewer applications.</p>

        <div class="section"><div class="section_title">Preview</div><div type="Preview">
            
            <div class="fig fignone" id="loio112d7b417e914a5a951abc6411d6f6c4__fig_mpz_5pw_15"><div class="figcontainer">
                
                <img class="image" id="loio112d7b417e914a5a951abc6411d6f6c4__image_mlf_vqq_15" src="loio2864ebcea6924cdb9813434157f6b3f6_LowRes.png"/>
            <div class="figcap">Viewer application that consists solely of a Viewport</div></div></div>

        </div></div>

        <div class="section"><div class="section_title">Coding</div><div type="Coding"><p class="p">You can view and download all files <span class="ph">at <a class="xref" target="_blank" href="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.03/preview" alt="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.03/preview" title="../../explored.html#/sample/sap.ui.vk.tutorial.VIT.03/preview">3D Viewer - Step 3 - Standalone Viewport</a></span>.</p>
<div class="sectiondiv subsection">
                <p class="p subsectiontitle">index.html</p>

                <p class="p">Update the <samp class="ph codeph">index.html</samp> file to reference the
                        <samp class="ph codeph">standaloneViewport</samp> namespace, which will be the namespace
                    we'll use for the sample application in this step.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
        &lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/&gt;
        &lt;script id="sap-ui-bootstrap"
            src="../../../../../../../../../resources/sap-ui-core.js"
            data-sap-ui-libs="sap.ui.vk"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-resourceroots='{
                <span class="ph emphasis emphasis">"standaloneViewport": "./"</span>
            }'&gt;
        &lt;/script&gt;
        &lt;script&gt;
        sap.ui.getCore().attachInit(function(){
            new sap.m.Shell({
                app: new sap.ui.core.ComponentContainer({
                    <span class="ph emphasis emphasis">name : "standaloneViewport"</span>
                })
            }).placeAt("content");
        });
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body id="content" class="sapUiBody"&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">Component.js</p>

                <p class="p">Update the <samp class="ph codeph">Component.js</samp> file to reference the namespace
                    specified for this application.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
        "sap/ui/core/UIComponent"
], function (UIComponent) {
        "use strict";
        <span class="ph emphasis emphasis">return UIComponent.extend("standaloneViewport.Component",</span> {
        metadata: {
            manifest: "json"
        },
        init: function () {
            // call the init function of the parent
            UIComponent.prototype.init.apply(this, arguments);
        }
    });
});</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">i18n.properties</p>

                <p class="p">Because we are not creating any fields that a user can interact with, we only
                    have one line of code which specifies what the label for the page title is.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-prefs"># Page Descriptor
<span class="ph emphasis emphasis">pageTitle=Standalone Viewport</span></pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">manifest.json</p>

                <p class="p">Update the <samp class="ph codeph">manifest.json</samp> file so that it references the correct
                    files.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">{
    "_version": "1.8.0",
    "sap.app": {
        <span class="ph emphasis emphasis">"id": "standaloneViewport",</span>
        "type": "application",
        "i18n": "i18n/i18n.properties",
        "title": "{{appTitle}}",
        "description": "{{appDescription}}",
        "applicationVersion": {
            "version": "1.0.0"
        }
    },
    "sap.ui": {
        "technology": "UI5",
        "deviceTypes": {
            "desktop": true,
            "tablet": true,
            "phone": true
        }
    },
    "sap.ui5": {
        <span class="ph emphasis emphasis">"rootView": "standaloneViewport.view.App",</span>
        "dependencies": {
            "minUI5Version": "1.30",
            "libs": {
                "sap.m": {}
            }
        },
        "models": {
            "i18n": {
                "type": "sap.ui.model.resource.ResourceModel",
                "settings": {
                    <span class="ph emphasis emphasis">"bundleName": "standaloneViewport.i18n.i18n"</span>
                }
            }
        }
    }
}</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">App.view.xml</p>

                <p class="p">Because the Viewport is the only item that we need to display on the application
                    screen, we only need to have the <samp class="ph codeph">&lt;vk:Viewport&gt;</samp> element
                    added to this file. In the element's attributes, we specify the Viewport's width
                    and height on the screen, and also give it an arbitrary identifier value.</p>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-xml">&lt;mvc:View
        <span class="ph emphasis emphasis">controllerName="standaloneViewport.controller.App"</span>
        xmlns="sap.m"
        xmlns:mvc="sap.ui.core.mvc"
        xmlns:vk="sap.ui.vk"
        xmlns:l="sap.ui.layout"
        xmlns:f="sap.ui.layout.form"
        xmlns:u="sap.ui.unified"
        displayBlock="true"&gt;
<span class="ph emphasis emphasis">    &lt;App id="standaloneViewport"&gt;
        &lt;Page
            title="{i18n&gt;pageTitle}"&gt;
            &lt;vk:Viewport
                    id="viewport"
                    width="100%"
                    height="50%"/&gt;
        &lt;/Page&gt;
    &lt;/App&gt;</span>
&lt;/mvc:View&gt;</pre></div>

            </div><div class="sectiondiv subsection">
                <p class="p subsectiontitle">App.controller.js</p>

                <div class="p">The logic in this <samp class="ph codeph">App.controller.js</samp> file can be summarized as
                        follows:<ol class="ol" id="loio112d7b417e914a5a951abc6411d6f6c4__ol_mvg_llq_yt">
                        <li class="li">Create a Content Resource that stores a pre-specified model</li>

                        <li class="li">Initiate a scene in our application in the following order:<ol class="ol" type="a" id="loio112d7b417e914a5a951abc6411d6f6c4__ol_rnt_nlq_yt">
                                <li class="li">Create a Graphics Core instance</li>

                                <li class="li">Create a Viewport that is bound to the Graphics Core
                                    instance</li>

                                <li class="li">Load the Content Resource to the Graphics Core for rendering on
                                    the Viewport</li>

                            </ol>
</li>

                    </ol>
</div>

                <div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/vk/ContentResource",
], <span class="ph emphasis emphasis">function (Controller, JSONModel, ContentResource) {
    "use strict";

    var contentResource = new sap.ui.vk.ContentResource({
        source: "/models/boxTestModel.vds",
        sourceType: "vds",
        id: "abc123"
    });

    return Controller.extend("standaloneViewport.controller.App",{
        onInit: function() {

            var mainScene;

            jQuery.sap.require("sap.ui.vk.GraphicsCore");
            var graphicsCore = new sap.ui.vk.GraphicsCore({},{
                antialias: true,
                alpha: true,
                premultipliedAlpha: false
            });

            var view = this.getView();
            var viewport = view.byId("viewport");
            
            viewport.setGraphicsCore(graphicsCore);
            graphicsCore.loadContentResourcesAsync([contentResource], function(sourcesFailedToLoad){
                if (sourcesFailedToLoad){
                    jQuery.sap.log.error("Some of content resources cannot be loaded.");
                } else {
                    var scene = graphicsCore.buildSceneTree([contentResource]);
                    if (scene){
                        mainScene = scene;
                        viewport.setScene(mainScene);
                    } else {
                        jQuery.sap.log.error("Failed to load viewport");
                    }
                }
            });
        }
    });</span>
});</pre></div>

                <p class="p">We'll now break the code down to look at each part in more detail.</p>

                <span class="ph emphasis emphasis">Create a New Content Resource</span>
                <div class="p">Create a <samp class="ph codeph">contentResource</samp> object that specifies the resource to
                    load. In this case, we're pre-loading the <samp class="ph codeph">boxTestModel.vds</samp>
                    model into the application. This occurs before the scene in our Viewer
                    application is
                    initiated.<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/vk/ContentResource",
], function (Controller, JSONModel, ContentResource) {
    "use strict";

    var contentResource = new sap.ui.vk.ContentResource({
        source: "/models/boxTestModel.vds",
        sourceType: "vds",
        id: "abc123"
</pre></div>
</div>

                <span class="ph emphasis emphasis">Create a New Graphics Core Instance</span>
                <div class="p">Create a new Graphics Core instance. We're only specifying one input parameter,
                    which is for the WebGL context attributes. We then get the current viewport, and
                    attach it to the Graphics Core instance so the model we've loaded can be
                    rendered.<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">return Controller.extend("standaloneViewport.controller.App",{
    onInit: function() {
 
    var mainScene;
        jQuery.sap.require("sap.ui.vk.GraphicsCore");
        var graphicsCore = new sap.ui.vk.GraphicsCore({},{
            antialias: true,
            alpha: true,
            premultipliedAlpha: false
        });

        var view = this.getView();
        var viewport = view.byId("viewport");
         
        viewport.setGraphicsCore(graphicsCore);</pre></div>
</div>

                <span class="ph emphasis emphasis">Load the Content Resource for Rendering</span>
                <div class="p">Now that we've associated the viewport with the Graphics Core, we can load our
                    model to be displayed on the Viewport. In the following code block, we have
                    specified some checks to make sure that the model loads correctly. If no
                    resource is loaded, or if there is an error loading the resource, we throw the
                    following error on the screen "Some of content resources cannot be loaded".
                    Otherwise, we build a scene with the loaded resource, and then display this
                    scene on the viewport. If the scene itself does not load into the Viewport, we
                    throw an error saying the scene could not be built "Failed to build the
                    scene."<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">graphicsCore.loadContentResourcesAsync([contentResource], function(sourcesFailedToLoad){
    if (sourcesFailedToLoad){
        jQuery.sap.log.error("Some of content resources cannot be loaded.");
    } else {
        var scene = graphicsCore.buildSceneTree([contentResource]);
            if (scene){
                mainScene = scene;
                viewport.setScene(mainScene);
            } else {
                jQuery.sap.log.error("Failed to load viewport");
            }
    }
});
}
});</pre></div>
</div>

            </div></div></div>

	    <div class="section"><div class="section_title">API Reference</div><div type="API Reference">
            
            <ul class="ul" id="loio112d7b417e914a5a951abc6411d6f6c4__ul_ctp_1bc_f5">
                <li class="li"><a class="xref" href="../../docs/api/symbols/sap.ui.vk.Viewport.html" alt="../../docs/api/symbols/sap.ui.vk.Viewport.html" title="../../docs/api/symbols/sap.ui.vk.Viewport.html">sap.ui.vk.Viewport</a></li>

            </ul>

        </div></div>

    </div>

    <div class="related-links"> 
<div class="relinfo"><div class="relinfotitle ">Related Information</div>
<div><a class="link" href="acd34672ef33429e99a0247486e37c78.html">Viewport</a></div>
</div>
</div>
</div></div>

</body>
</html>