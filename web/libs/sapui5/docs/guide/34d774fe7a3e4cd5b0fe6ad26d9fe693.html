<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="abstract" content=""/>
<meta name="description" content=""/>

<link rel="stylesheet" type="text/css" href="css/prettify.css?x=5493149253482421"/>
<link rel="stylesheet" type="text/css" href="css/documentation.css?x=5493149253482421"/>
<title>Step 2: Associating the Rule Expression Language</title>
  <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/themes/base/highlight-query-terms.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/js/google-code-prettify/prettify.css" />
    <script src="../../resources/sap/ui/demokit/js/sdk-pagehelper.js"></script>
  </head>
<body class="" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693">
<div id="wrapper"><div id="container">

	<h1 class="title topictitle1">Step 2: Associating the Rule Expression Language</h1>

	
	<div class="body conbody"><p class="shortdesc"/>

		<div class="section" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693__section_f5q_rp3_rz"><div class="section_title">Preview</div><div type="Preview">
            
            <div class="fig fignone" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693__fig_hsk_ssz_qbb"><div class="figcontainer">
                <img class="image" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693__image_q3d_dd1_rbb" src="loio807586f578a04d889cad2b32d9dfb578_LowRes.png"/>
            </div></div>

        </div></div>

		<div class="section" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693__section_mjx_fn3_rz"><div class="section_title">Coding</div><div type="Coding">
			
			<p class="p">You can view and download all files <span class="ph">at <a class="xref" target="_blank" href="../../explored.html#/sample/sap.rules.ui.sample.TextRule/preview" alt="../../explored.html#/sample/sap.rules.ui.sample.TextRule/preview" title="../../explored.html#/sample/sap.rules.ui.sample.TextRule/preview">Rule Builder - Text Rule</a></span>.</p>

		</div></div>

		<div class="section" id="loio34d774fe7a3e4cd5b0fe6ad26d9fe693__section_fmw_sp3_rz"><div class="section_title">Page.controller.js</div><div type="Page.controller.js">
			
            <p class="p">This code adds an <samp class="ph codeph">ExpressionLanguage</samp> object to the view controller,
                and connects it to the <samp class="ph codeph">RuleBuilder</samp>. For the
                    <samp class="ph codeph">ExpressionLanguage</samp>, this code sets the model and then does all
                the necessary data binding internally (unlike other <span class="ph"><span class="ph pname">SAPUI5</span></span> controls where
                the developer defines the data binding). The data for
                    <samp class="ph codeph">ExpressionLanguage</samp> is loaded via the vocabulary OData
                service.</p>

            <p class="p">The code also sets a binding context path on <samp class="ph codeph">RuleBuilder</samp> to the
                specific rule you are currently working on.</p>

		</div></div>

		<div class="section">
			<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js"> sap.ui.define([
    'jquery.sap.global',
    'sap/ui/core/mvc/Controller',
    'sap/ui/model/odata/v2/ODataModel',
    'sap/rules/ui/services/ExpressionLanguage',
    'sap/ui/core/util/MockServer',
    'sap/m/MessageToast'
], function (jQuery, Controller, ODataModel, ExpressionLanguage, MockServer, MessageToast) {
    "use strict";

    return Controller.extend("sap.rules.ui.sample.TextRule.Page", {

        /**
         * This sample uses the sap.ui.core.uti.MockServer. The RuleBuilder control is meant to be used
         * with the Vocabulary OData service and the Rules OData service.
         * Hence, when using th eproper OData services the mockServer code should be removed.
         */
        onInit: function () {

            sap.ui.getCore().applyTheme("sap_belize");

            // apply compact density for desktop, the cozy design otherwise
            this.getView().addStyleClass(sap.ui.Device.system.desktop ? "sapUiSizeCompact" : "sapUiSizeCozy");

            var mPath = jQuery.sap.getModulePath("sap.rules.ui.sample.TextRule", "/");

            // Initialiaze Expression Language services
            this.oVocabularyMockServer = new MockServer({rootUri: "/rule-service/vocabulary_srv/"});
            this.oVocabularyMockServer.simulate(
                mPath + "localService/vocabulary/mockdata/metadata.xml",
                {'sMockdataBaseUrl': mPath + "localService/vocabulary/mockdata/"}
            );
            this.oVocabularyMockServer.start();
            this.oVocabularyModel = new ODataModel("/rule-service/vocabulary_srv/");
            this.oExpressionLanguage = new ExpressionLanguage();
            this.oExpressionLanguage.setModel(this.oVocabularyModel);
            this.oExpressionLanguage.setBindingContextPath("/Vocabularies('&lt;project-id&gt;')");

            // Initialiaze the Rule Builder
           

            this.oRuleMockServer = new MockServer({rootUri: "/rule-service/rule_srv/"});
            this.oRuleMockServer.simulate(
                mPath + "localService/rule/mockdata/metadata.xml",
                {'sMockdataBaseUrl': mPath + "localService/rule/mockdata/"}
            );
            var aRequests = this.loadRequests(mPath);
            this.oRuleMockServer.setRequests(aRequests);


            this.oRuleMockServer.start();
            this.oRuleModel = new ODataModel({
                serviceUrl: "/rule-service/rule_srv/",
                defaultBindingMode: sap.ui.model.BindingMode.TwoWay
            });

            var oRuleBuilder = this.byId("ruleBuilder");
            oRuleBuilder.setModel(this.oRuleModel);
            oRuleBuilder.setExpressionLanguage(this.oExpressionLanguage);
            oRuleBuilder.setBindingContextPath("/Projects(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;')/Rules(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;')");
        },

        handleEditButton: function () {
            var oEditButton = this.byId("editButton");
            var oRuleBuilder = this.byId("ruleBuilder");
            var bEdit = (oEditButton.getText() === "Edit");
            oRuleBuilder.setEditable(bEdit);
            oEditButton.setText(bEdit ? "Display" : "Edit");
        },

        onAfterRendering: function () {

            /**
             * Line actions are not supported in this demo as they require a functioning Rules oData service
             * This function overwites the line actions event handlers.
             * Please do not use this code when using proper OData services.
             */
            var oRuleBuilder = this.byId("ruleBuilder");
            var oDecisionTable = oRuleBuilder.getAggregation("_rule");



        },
        loadRequests: function (mPath) {
            // The mock server does not support 1 to 1 navigation.
            // Hence we provide the responses directly by adding custom requests to the MockServer
            var oRresponses = jQuery.sap.sjax({
                type: "GET",
                url: mPath + "localService/rule/mockdata/responses.json",
                dataType: "json"
            }).data;
	        var aRequests = this.oRuleMockServer.getRequests();
	        var sMethod = "GET";
	        var sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\/\$count/;
	        var fnResponse1 = function (xhr) {
	            xhr.respond(200, {
	                "Content-Type": "text/plain;charset=utf-8"
	            }, "3");
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse1});
	
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\?\$expand=TextRule/;
	        var fnResponse2 = function (xhr) {
	            xhr.respondJSON(200, {
	                "Content-Type": "application/json;charset=utf-8"
	            }, oRresponses.response_7);
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse2});
	        
	        var sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleResults\/\$count/;
	        var fnResponse3 = function (xhr) {
	            xhr.respond(200, {
	                "Content-Type": "text/plain;charset=utf-8"
	            }, "2");
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse3});
	
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleResults/;
	        var fnResponse4 = function (xhr) {
	            xhr.respondJSON(200, {
	                "Content-Type": "application/json;charset=utf-8"
	            }, oRresponses.response_3);
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse4});
	
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\?\$skip=0&amp;\$top=\d+&amp;\$expand=TextRuleResultExpressions/;
	        var fnResponse5 = function (xhr) {
	            xhr.respondJSON(200, {
	                "Content-Type": "application/json;charset=utf-8"
	            }, oRresponses.response_2);
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse5});
	        
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\(RuleId='&lt;rule-id&gt;',RuleVersion='&lt;rule-version&gt;',Id='1'\)\/TextRuleResultExpressions\$count/;
	        var fnResponse6 = function (xhr) {
	            xhr.respond(200, {
	                "Content-Type": "text/plain;charset=utf-8"
	            }, "2");
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse6});
	        
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\(RuleId='&lt;rule-id&gt;',RuleVersion='&lt;rule-version&gt;',Id='1'\)\/TextRuleResultExpressions\?\$skip=0&amp;\$top=100/;
	        var fnResponse7 = function (xhr) {
	             xhr.respondJSON(200, {
	                "Content-Type": "application/json;charset=utf-8"
	            }, oRresponses.response_8);
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse7});
	        
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\(RuleId='&lt;rule-id&gt;',RuleVersion='&lt;rule-version&gt;',Id='2'\)\/TextRuleResultExpressions\$count/;
	        var fnResponse8 = function (xhr) {
	            xhr.respond(200, {
	                "Content-Type": "text/plain;charset=utf-8"
	            }, "2");
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse8});
	        
	        sPath = /Projects\(Id='&lt;project-id&gt;',Version='&lt;project-version&gt;'\)\/Rules\(Id='&lt;rule-id&gt;',Version='&lt;rule-version&gt;'\)\/TextRule\/TextRuleConditions\(RuleId='&lt;rule-id&gt;',RuleVersion='&lt;rule-version&gt;',Id='2'\)\/TextRuleResultExpressions\?\$skip=0&amp;\$top=100/;
	        var fnResponse9 = function (xhr) {
	             xhr.respondJSON(200, {
	                "Content-Type": "application/json;charset=utf-8"
	            }, oRresponses.response_9);
	        };
	        aRequests.push({method: sMethod, path: sPath, response: fnResponse9});
	
	        return aRequests;


        }


    });
});</pre></div>

		</div>

	</div>

</div></div>

</body>
</html>