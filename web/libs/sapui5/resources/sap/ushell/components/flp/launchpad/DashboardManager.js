// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.flp.launchpad.DashboardManager");jQuery.sap.require("sap.ushell.services.Message");var g=function(m,p){return p?sap.ushell.resources.i18n.getText(m,p):sap.ushell.resources.i18n.getText(m);},c=function(C){var a=this.oModel.getProperty('/catalogTiles'),b=a.filter(function(t){return t.catalog===C.title&&t.isTileIntentSupported===true;});return b.length;};sap.ui.base.EventProvider.extend("sap.ushell.components.flp.launchpad.DashboardManager",{metadata:{publicMethods:["getModel","getDashboardView","loadPersonalizedGroups","attachEvent","detachEvent","attachEventOnce","createTile","deleteCatalogTileFromGroup","resetGroupsOnFailure","createGroupAndSaveTile"]},analyticsConstants:{PERSONALIZATION:"FLP: Personalization",RENAME_GROUP:"FLP: Rename Group",MOVE_GROUP:"FLP: Move Group",DELETE_GROUP:"FLP: Delete Group",RESET_GROUP:"FLP: Reset Group",DELETE_TILE:"FLP: Delete Tile",ADD_TILE:"FLP: Add Tile",MOVE_TILE:"FLP: Move Tile"},constructor:function(i,s){if(sap.ushell.components.flp.launchpad.getDashboardManager&&sap.ushell.components.flp.launchpad.getDashboardManager()){return sap.ushell.components.flp.launchpad.getDashboardManager();}sap.ushell.components.flp.launchpad.getDashboardManager=jQuery.sap.getter(this.getInterface());this.oPageBuilderService=sap.ushell.Container.getService("LaunchPage");this.oModel=s.model;this.oConfig=s.config;this.oRouter=s.router;this.oSortableDeferred=$.Deferred();this.oSortableDeferred.resolve();this.aRequestQueue=[];this.bRequestRunning=false;this.tagsPool=[];this.registerEvents();this.oTileCatalogToGroupsMap={};this.tileViewUpdateQueue=[];this.tileViewUpdateTimeoutID=0;this.oPopover=null;this.tileUuid=null;this.oGroupCreatedDeferred=undefined;this.aMoveTileCallsData=undefined;this.segmentsStore=[];this.oGroupNotLockedFilter=new sap.ui.model.Filter("isGroupLocked",sap.ui.model.FilterOperator.EQ,false);if(this.oRouter){var t=this.oRouter.getTarget('home');t.attachDisplay(function(e){this.oDashboardView=e.getParameter('view');}.bind(this));}},createMoveActionDialog:function(){var G=this.oGroupNotLockedFilter;this.moveDialog=new sap.m.SelectDialog("moveDialog",{title:sap.ushell.resources.i18n.getText('moveTileDialog_title'),rememberSelections:false,search:function(e){var v=e.getParameter("value"),f=new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,v),b=e.getSource().getBinding("items");b.filter([f,G]);},contentWidth:'400px',confirm:function(e){var C=e.getParameter("selectedContexts"),E=sap.ui.getCore().getEventBus();if(C.length){E.publish("launchpad","moveTile",{sTileId:this.tileUuid,toGroupId:C[0].getObject().groupId,toIndex:C[0].getObject().tiles.length,source:this.moveDialog.getId()});E.publish("launchpad","scrollToGroup",{groupId:C[0].getObject().groupId,groupChanged:false,focus:false});}}.bind(this),cancel:function(){var C=jQuery('.sapUshellTile[tabindex="0"]')[0];if(C){C.focus();}},items:{path:"/groups",filters:[G],template:new sap.m.StandardListItem({title:"{title}"})}});this.moveDialog.setModel(this.oModel);},registerEvents:function(){var e=sap.ui.getCore().getEventBus(),t=this;e.subscribe("launchpad","addBookmarkTile",this._createBookmark,this);e.subscribe("sap.ushell.services.Bookmark","bookmarkTileAdded",this._addBookmarkToModel,this);e.subscribe("sap.ushell.services.Bookmark","catalogTileAdded",this._refreshGroupInModel,this);e.subscribe("sap.ushell.services.Bookmark","bookmarkTileDeleted",this.loadPersonalizedGroups,this);e.subscribe("launchpad","loadDashboardGroups",this.loadPersonalizedGroups,this);e.subscribe("launchpad","createGroupAt",this._createGroupAt,this);e.subscribe("launchpad","createGroup",this._createGroup,this);e.subscribe("launchpad","deleteGroup",this._deleteGroup,this);e.subscribe("launchpad","resetGroup",this._resetGroup,this);e.subscribe("launchpad","changeGroupTitle",this._changeGroupTitle,this);e.subscribe("launchpad","moveGroup",this._moveGroup,this);e.subscribe("launchpad","deleteTile",this._deleteTile,this);e.subscribe("launchpad","moveTile",this._moveTile,this);e.subscribe("launchpad","sortableStart",this._sortableStart,this);e.subscribe("launchpad","sortableStop",this._sortableStop,this);e.subscribe("renderCatalog",this.loadAllCatalogs,this);e.subscribe("showCatalog",this.updateTilesAssociation,this);e.subscribe("launchpad","dashboardModelContentLoaded",this._modelLoaded,this);this.oPageBuilderService.registerTileActionsProvider(function(T){jQuery.sap.require("sap.m.MessageBox");return[{text:sap.ushell.resources.i18n.getText('moveTileDialog_action'),press:function(E){t.tileUuid=t.getModelTileById(t.oPageBuilderService.getTileId(T)).uuid;if(!t.moveDialog){t.createMoveActionDialog();}t.moveDialog.getBinding("items").filter([t.oGroupNotLockedFilter]);t.moveDialog.open();}}];});},destroy:function(){var e=sap.ui.getCore().getEventBus();e.unsubscribe("launchpad","addBookmarkTile",this._createBookmark,this);e.unsubscribe("launchpad","loadDashboardGroups",this.loadPersonalizedGroups,this);e.unsubscribe("launchpad","createGroupAt",this._createGroupAt,this);e.unsubscribe("launchpad","createGroup",this._createGroup,this);e.unsubscribe("launchpad","deleteGroup",this._deleteGroup,this);e.unsubscribe("launchpad","resetGroup",this._resetGroup,this);e.unsubscribe("launchpad","changeGroupTitle",this._changeGroupTitle,this);e.unsubscribe("launchpad","moveGroup",this._moveGroup,this);e.unsubscribe("launchpad","deleteTile",this._deleteTile,this);e.unsubscribe("launchpad","moveTile",this._moveTile,this);e.unsubscribe("launchpad","sortableStart",this._sortableStart,this);e.unsubscribe("launchpad","sortableStop",this._sortableStop,this);e.unsubscribe("renderCatalog",this.loadAllCatalogs,this);e.unsubscribe("showCatalog",this.updateTilesAssociation,this);e.unsubscribe("launchpad","dashboardModelContentLoaded",this._modelLoaded,this);sap.ushell.components.flp.launchpad.getDashboardManager=undefined;},_refreshTiles:function(){var t=this,G=this.oModel.getProperty("/groups");jQuery.each(G,function(n,o){jQuery.each(o.tiles,function(n,T){t.oPageBuilderService.refreshTile(T.object);});});},_sortableStart:function(){this.oSortableDeferred=$.Deferred();},_createBookmark:function(C,e,d){var t=d.group?d.group.object:"";delete d.group;this._addRequest($.proxy(function(){var r=sap.ushell.Container.getService("Bookmark").addBookmark(d,t),R=sap.ushell.resources.i18n;r.always($.proxy(this._checkRequestQueue,this));r.done(function(){if(sap.ushell.Container){sap.ushell.Container.getService('Message').info(R.getText('tile_created_msg'));}});r.fail(function(m){jQuery.sap.log.error("Failed to add bookmark",m,"sap.ushell.ui.footerbar.AddBookmarkButton");if(sap.ushell.Container){sap.ushell.Container.getService('Message').error(R.getText('fail_to_add_tile_msg'));}});},this));},_addBookmarkToModel:function(C,e,d){var t=d.tile,G,o=d.group,s,T,n,i,a,N,I;if(!d||!t){this.bIsGroupsModelDirty=true;if(!this.bGroupsModelLoadingInProcess){this._handleBookmarkModelUpdate();}return;}if(!o){G=this.getModel().getProperty("/groups");for(I=0;I<G.length;I++){if(G[I].isDefaultGroup===true){o=G[I].object;break;}}}s=this.oPageBuilderService;T=s.getTileType(t);n=this._getTileModel(t,s.isGroupLocked(o),T,this._addModelToTileViewUpdateQueue);i=this._getIndexOfGroupByObject(o);a=this.oModel.getProperty("/groups/"+i);a.tiles.push(n);a.visibilityModes=sap.ushell.utils.calcVisibilityModes(a,true);N=a.tiles.length;this._updateModelWithTileView(i,N);this.oModel.setProperty("/groups/"+i,a);},_refreshGroupInModel:function(C,e,G){var l=sap.ushell.Container.getService("LaunchPage"),E='Failed to refresh group with id:'+G+' in the model',t=this;l.getGroups().fail(jQuery.sap.log.error(E,null,"sap.ushell.components.flp.launchpad.DashboardManager")).done(function(a){a.some(function(o){if(l.getGroupId(o)===G){l.getDefaultGroup().done(function(d){var i=G===d.getId()?true:false,b=t._getGroupModel(o,i),f=t._getIndexOfGroupByObject(b.object);t.oModel.setProperty("/groups/"+f,b);});return true;}});});},_sortableStop:function(){this.oSortableDeferred.resolve();},_handleAfterSortable:function(f){return $.proxy(function(){var o=Array.prototype.slice.call(arguments);this.oSortableDeferred.done(function(){f.apply(null,o);});},this);},_addRequest:function(r){this.aRequestQueue.push(r);if(!this.bRequestRunning){this.bRequestRunning=true;this.aRequestQueue.shift()();}},_checkRequestQueue:function(){if(this.aRequestQueue.length===0){this.bRequestRunning=false;}else{this.aRequestQueue.shift()();}},_requestFailed:function(){this.aRequestQueue=[];this.bRequestRunning=false;},_createGroup:function(C,e,d){var G=this._getGroupModel(null),a=this.oModel.getProperty("/groups"),m=this.oModel;m.setProperty("/groupList-skipScrollToGroup",true);window.setTimeout(function(){m.setProperty("/groups/"+a.length,G);},500);window.setTimeout(function(){m.setProperty("/groupList-skipScrollToGroup",false);},1000);},_createGroupAt:function(C,e,d){var n=parseInt(d.location,10),G=this.oModel.getProperty("/groups"),o=this._getGroupModel(null,false,n===G.length,d),m=this.oModel,i;o.index=n;G.splice(n,0,o);for(i=0;i<G.length-1;i++){G[i].isLastGroup=false;}for(i=n+1;i<G.length;i++){G[i].index++;}m.setProperty("/groups",G);},_getIndexOfGroup:function(G){var n=null,a=this.oModel.getProperty("/groups");jQuery.each(a,function(b,o){if(o.groupId===G){n=b;return false;}});return n;},_getIndexOfGroupByObject:function(G){var n=null,a=this.oModel.getProperty("/groups"),s=this.oPageBuilderService.getGroupId(G);a.forEach(function(m,b){var C=this.oPageBuilderService.getGroupId(m.object);if(C===s){n=b;return false;}}.bind(this));return n;},_getPathOfGroup:function(G){return"/groups/"+this._getIndexOfGroup(G);},_getPathOfTile:function(t){var G=this.oModel.getProperty("/groups"),n=null,a=null;jQuery.each(G,function(b,o){jQuery.each(o.tiles,function(d,T){if(T.uuid===t){n=b;a=d;return false;}});if(n!==null){return false;}});return n!==null?"/groups/"+n+"/tiles/"+a:null;},_moveInArray:function(a,n,b){if(b>=a.length){var k=b-a.length;while((k--)+1){a.push(undefined);}}a.splice(b,0,a.splice(n,1)[0]);},_updateGroupIndices:function(a){var k;for(k=0;k<a.length;k++){a[k].index=k;}},_deleteGroup:function(C,e,d){var t=this,G=d.groupId,s,a=this.oModel.getProperty("/groups"),n=this._getIndexOfGroup(G),i=a.length-1===n,o=null,r,m,b,B;b=i?n-1:n;this._destroyGroupModel("/groups/"+n);o=a.splice(n,1)[0].object;if(i){this.oModel.setProperty("/groups/"+b+"/isLastGroup",i);}s=sap.ushell.Container.getService("LaunchPage").getGroupId(o);m=this.oModel;m.setProperty("/groupList-skipScrollToGroup",true);m.setProperty("/groups",a);this._updateGroupIndices(a);if(b>=0){B=sap.ui.getCore().getEventBus();window.setTimeout($.proxy(B.publish,B,"launchpad","scrollToGroup",{groupId:this.oModel.getProperty("/groups")[b].groupId}),200);}window.setTimeout(function(){m.setProperty("/groupList-skipScrollToGroup",false);},1000);this._addRequest($.proxy(function(){var f=sap.ushell.Container.getService("LaunchPage").getGroupTitle(o);try{r=this.oPageBuilderService.removeGroup(o);}catch(h){this._resetGroupsOnFailure("fail_to_delete_group_msg");return;}r.done(function(){sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(this.analyticsConstants.PERSONALIZATION,this.analyticsConstants.DELETE_GROUP,[f,s]);this._showLocalizedMessage("group_deleted_msg",[f]);}.bind(this));r.fail(this._handleAfterSortable(t._resetGroupsOnFailureHelper("fail_to_delete_group_msg")));r.always($.proxy(this._checkRequestQueue,this));},this));},_resetGroup:function(C,e,d){var t=this,G=d.groupId,n=this._getIndexOfGroup(G),o=this.oModel.getProperty("/groups/"+n),s,a,r,b;this.oModel.setProperty("/groups/"+n+"/sortable",false);a=sap.ushell.Container.getService("LaunchPage").getGroupId(o.object);s=sap.ushell.Container.getService("LaunchPage").getGroupTitle(o.object);this._addRequest($.proxy(function(){try{r=this.oPageBuilderService.resetGroup(o.object);}catch(f){this._resetGroupsOnFailure("fail_to_reset_group_msg");return;}r.done(this._handleAfterSortable($.proxy(function(G,o,R){sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(this.analyticsConstants.PERSONALIZATION,this.analyticsConstants.RESET_GROUP,[s,a]);var n=t._getIndexOfGroup(G);this._loadGroup(n,R||o.object,this._addAndUpdateModelWithTileView);this._showLocalizedMessage("group_reset_msg",[o.title]);this.oModel.setProperty("/groups/"+n+"/sortable",true);b=sap.ui.getCore().byId('dashboardGroups').getGroupControlByGroupId(G);if(b){b.rerender();}},this,G,o)));r.fail(this._handleAfterSortable(t._resetGroupsOnFailureHelper("fail_to_reset_group_msg")));r.always($.proxy(this._checkRequestQueue,this));},this));},_moveGroup:function(C,e,d){var f=d.fromIndex,t=d.toIndex,G=this.oModel.getProperty("/groups"),m=this.oModel,a=this.oModel.getProperty("/tileActionModeActive"),r,o,s,b=this,i,D;if(!a){f=this._adjustFromGroupIndex(f,G);}o=G[f];s=o.groupId;if(!a){t=this._adjustToGroupIndex(t,G,s);}D=G[t].object;this._moveInArray(G,f,t);this._updateGroupIndices(G);m.setProperty("/groupList-skipScrollToGroup",true);for(i=0;i<G.length-1;i++){G[i].isLastGroup=false;}G[G.length-1].isLastGroup=true;m.setProperty("/groups",G);window.setTimeout(function(){m.setProperty("/groupList-skipScrollToGroup",false);},1000);this._addRequest($.proxy(function(){var o=this.oModel.getProperty(this._getPathOfGroup(s));try{this._getOriginalGroupIndex(D).done(function(n){r=this.oPageBuilderService.moveGroup(o.object,n);r.done(function(){sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(b.analyticsConstants.PERSONALIZATION,b.analyticsConstants.MOVE_GROUP,[o.title,f,t,s]);});r.fail(this._handleAfterSortable(this._resetGroupsOnFailureHelper("fail_to_move_group_msg")));r.always($.proxy(this._checkRequestQueue,this));}.bind(this));}catch(h){this._resetGroupsOnFailure("fail_to_move_group_msg");return;}},this));},_adjustToGroupIndex:function(t,a,b){var v=0,I=false,i=0;for(i=0;i<a.length&&v<t;i++){if(a[i].isGroupVisible){if(a[i].groupId===b){I=true;}else{v++;}}}if(I){return i-1;}return i;},_adjustFromGroupIndex:function(a,b){var v=0,i;for(i=0;i<b.length;i++){if(b[i].isGroupVisible){v++;}if(v===a+1){return i;}}return a;},_getOriginalGroupIndexByIndex:function(n){var G=this.oModel.getProperty("/groups"),s=G[n].object;return this._getOriginalGroupIndex(s);},_getOriginalGroupIndex:function(s){var a=this.oPageBuilderService,t=this,G=this.oPageBuilderService.getGroups(),d=new jQuery.Deferred();G.done(function(b){var n=null;jQuery.each(b,function(e,o){if(a.getGroupId(o)===a.getGroupId(s)){n=e;return false;}});d.resolve(n);});G.fail(function(){t._showLocalizedErrorHelper("fail_to_load_groups_msg")();d.reject();});return d;},_changeGroupTitle:function(C,e,d){var n=d.newTitle,G=this.oModel.getProperty("/groups"),s=d.groupId,a=d.groupId,b=this._getIndexOfGroup(s),o=this.oModel.getProperty("/groups/"+b),O=o.title,r,t=this;this.oModel.setProperty("/groups/"+b+"/title",n);if(!o.object){this._addRequest($.proxy(function(){try{this.oGroupCreatedDeferred=new jQuery.Deferred();if(b===G.length-1){r=this.oPageBuilderService.addGroup(n,b);r.done(this._handleAfterSortable($.proxy(function(s,N){b=this._getIndexOfGroup(s);this._createGroupUpdate(s,b,N);sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(t.analyticsConstants.PERSONALIZATION,t.analyticsConstants.RENAME_GROUP,[O,n,s]);},this,s)));r.fail(this._handleAfterSortable(this._resetGroupsOnFailureHelper("fail_to_create_group_msg")));r.always($.proxy(this._checkRequestQueue,this));}else{this._getOriginalGroupIndexByIndex(b+1).done(function(h){r=this.oPageBuilderService.addGroupAt(n,h);r.done(this._handleAfterSortable($.proxy(function(s,N){b=this._getIndexOfGroup(s);this._createGroupUpdate(s,b,N);sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(t.analyticsConstants.PERSONALIZATION,t.analyticsConstants.RENAME_GROUP,[O,n,s]);},this,s)));r.fail(this._handleAfterSortable(this._resetGroupsOnFailureHelper("fail_to_create_group_msg")));r.always($.proxy(this._checkRequestQueue,this));}.bind(this));}}catch(f){this._resetGroupsOnFailure("fail_to_create_group_msg");return;}},this));}else{this._addRequest($.proxy(function(){try{r=this.oPageBuilderService.setGroupTitle(o.object,n);}catch(f){this._resetGroupsOnFailure("fail_to_rename_group_msg");return;}r.done(function(){a=sap.ushell.Container.getService("LaunchPage").getGroupId(o.object);sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(t.analyticsConstants.PERSONALIZATION,t.analyticsConstants.RENAME_GROUP,[O,n,a]);});r.fail(this._handleAfterSortable($.proxy(function(s,O){var h=this._getPathOfGroup(s);this._showLocalizedError("fail_to__msg");this.oModel.setProperty(h+"/title",O);this._requestFailed();},this,s)));},this));if(r){r.always($.proxy(this._checkRequestQueue,this));}}},_createGroupUpdate:function(G,n,N){n=this._getIndexOfGroup(G);this._loadGroup(n,N);this.oGroupCreatedDeferred.resolve();},createTile:function(d){var C=d.catalogTileContext,o=d.groupContext,G=this.oModel.getProperty(o.getPath()),s=G.groupId,r,a=jQuery.Deferred(),R={},b;b=sap.ui.getCore().getEventBus();b=sap.ui.getCore().getEventBus();$.proxy(b.publish,b,"launchpad","addTile",{catalogTileContext:C,groupContext:o});if(!C){jQuery.sap.log.warning("DashboardManager: Did not receive catalog tile object. Abort.",this);return;}this._addRequest($.proxy(function(){try{r=this.oPageBuilderService.addTile(C.getProperty("src"),o.getProperty("object"));}catch(e){this._resetGroupsOnFailure("fail_to_add_tile_msg");return;}var t=this;r.done(function(T){var f=t._getPathOfGroup(s),h=sap.ushell.Container.getService("LaunchPage").getTileTitle(T);t._addTileToGroup(f,T);R={group:G,status:1,action:'add'};sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(t.analyticsConstants.PERSONALIZATION,t.analyticsConstants.ADD_TILE,[G.title,h]);a.resolve(R);}).fail(function(){R={group:G,status:0,action:'add'};a.resolve(R);}).always(function(){t._checkRequestQueue();});},this));return a.promise();},createGroup:function(t){var d=jQuery.Deferred(),G,a,s,i,r,n,C,R;if(!sap.ushell.utils.validHash(t)){return d.reject({status:0,action:'createNewGroup'});}G=this._getGroupModel(null,false,true);a=this.oModel.getProperty("/groups");s=G.groupId;i=a.length;if(i>0){a[i-1].isLastGroup=false;}G.title=t;G.index=i;G.editMode=false;a.push(G);this.oModel.setProperty("/groups/",a);this._addRequest(function(t){try{r=this.oPageBuilderService.addGroup(t);}catch(e){this._resetGroupsOnFailure("fail_to_create_group_msg");return;}r.done(this._handleAfterSortable(function(s,N){n=this._getIndexOfGroup(s);this._loadGroup(n,N);C=new sap.ui.model.Context(this.oModel,"/groups/"+n);d.resolve(C);}.bind(this,s)));r.fail(function(b){this._handleAfterSortable(this._resetGroupsOnFailureHelper("fail_to_create_group_msg"));R={group:b.group,status:0,action:'createNewGroup'};d.resolve(R);}.bind(this));r.always($.proxy(this._checkRequestQueue,this));}.bind(this,t));return d.promise();},createGroupAndSaveTile:function(d){var C=d.catalogTileContext,n=d.newGroupName,a=jQuery.Deferred(),r={};if(sap.ushell.utils.validHash(n)&&C){this.createGroup(n).then(function(o){var p=this.createTile({catalogTileContext:C,groupContext:o});p.done(function(b){r={group:b.group,status:1,action:'addTileToNewGroup'};a.resolve(r);}).fail(function(b){r={group:b.group,status:0,action:'addTileToNewGroup'};a.resolve(r);});}.bind(this));}return a.promise();},_deleteTile:function(C,e,d){var t=this,T=d.tileId||d.originalTileId,G=this.oModel.getProperty("/groups");jQuery.each(G,function(n,o){var f=false;jQuery.each(o.tiles,function(a,b){if(b.uuid===T||b.originalTileId===T){t._destroyTileModel("/groups/"+n+"/tiles/"+a);var h=o.tiles.splice(a,1)[0],r,s=sap.ushell.Container.getService("LaunchPage").getTileTitle(h.object),i=sap.ushell.Container.getService("LaunchPage").getCatalogTileId(h.object),j=sap.ushell.Container.getService("LaunchPage").getCatalogTileTitle(h.object),k=sap.ushell.Container.getService("LaunchPage").getTileId(h.object),p=t.oModel.getProperty("/personalization");o.visibilityModes=sap.ushell.utils.calcVisibilityModes(o,p);t.oModel.setProperty("/groups/"+n,o);t._addRequest(function(){try{r=t.oPageBuilderService.removeTile(o.object,h.object);}catch(l){this._resetGroupsOnFailure("fail_to_remove_tile_msg");return;}r.done(t._handleAfterSortable(function(){if(s){t._showLocalizedMessage("tile_deleted_msg",[s,o.title]);}else{t._showLocalizedMessage("tile_deleted_msg",[s,o.title]);}sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(t.analyticsConstants.PERSONALIZATION,t.analyticsConstants.DELETE_TILE,[s||k,i,j,o.title]);}));r.fail(t._handleAfterSortable(t._resetGroupsOnFailureHelper("fail_to_remove_tile_msg")));r.always($.proxy(t._checkRequestQueue,t));});sap.ushell.utils.handleTilesVisibility();f=true;return false;}});if(f){return false;}});},_sendDeleteTileRequest:function(G,t){var r,a=sap.ushell.Container.getService('LaunchPage');try{r=a.removeTile(G,t.object);}catch(e){jQuery.sap.log.error("deleteCatalogTileFromGroup ; removeTile ; Exception occurred: "+e);}return r;},deleteCatalogTileFromGroup:function(d){var t=this,D=decodeURIComponent(d.tileId),G=d.groupIndex,o=this.oModel.getProperty("/groups/"+G),s=sap.ushell.Container.getService("LaunchPage"),a=jQuery.Deferred(),b=[],f,p,e;f=o.tiles.filter(function(T){var h=s.getCatalogTileId(T.object);if(h!==D){return true;}else{p=jQuery.Deferred();e=t._sendDeleteTileRequest(o.object,T);e.done((function(a){return function(){a.resolve({status:true});};})(p));e.fail((function(a){return function(){a.resolve({status:false});};})(p));b.push(p);return false;}});o.tiles=f;o.visibilityModes=sap.ushell.utils.calcVisibilityModes(o,true);jQuery.when.apply(jQuery,b).done(function(r){var S=true,i=0,h=b.length;for(i;i<h;i++){if(!r.status){S=false;break;}}if(S){t.oModel.setProperty("/groups/"+G,o);}a.resolve({group:o,status:S,action:'remove'});});return a.promise();},_moveTile:function(C,e,d){var n=d.toIndex,N=d.toGroupId,t=d.sTileId,s=d.source,T,a,o,b,f,h,G=this.oModel.getProperty("/groups"),S,i,p,j,m;jQuery.each(G,function(k,l){var F=false;jQuery.each(l.tiles,function(q,r){if(r.uuid===t){T=r;a=q;o=l;b=k;F=true;return false;}});if(F){return false;}});jQuery.each(G,function(k,l){if(l.groupId===N){f=l;h=k;}});if(o.groupId==f.groupId&&(s==="moveDialog"||n===null)){return;}if(n&&n>f.tiles.length){n=f.tiles.length;}if(o.groupId===N){if(n===null||n===undefined){o.tiles.splice(a,1);n=o.tiles.length;o.tiles.push(T);}else{n=this._adjustTileIndex(n,T,o);this._moveInArray(o.tiles,a,n);}this.oModel.setProperty("/groups/"+b+"/tiles",o.tiles);}else{p=this.oModel.getProperty("/personalization");o.tiles.splice(a,1);o.visibilityModes=sap.ushell.utils.calcVisibilityModes(o,p);this.oModel.setProperty("/groups/"+b+"/tiles",o.tiles);if(n===null||n===undefined){n=f.tiles.length;f.tiles.push(T);}else{n=this._adjustTileIndex(n,T,f);f.tiles.splice(n,0,T);}f.visibilityModes=sap.ushell.utils.calcVisibilityModes(f,p);this.oModel.setProperty("/groups/"+h+"/tiles",f.tiles);}sap.ushell.utils.handleTilesVisibility();S=this.oModel.getProperty("/groups/"+b).object;i=this.oModel.getProperty("/groups/"+h).object;if(!i&&this.oGroupCreatedDeferred&&this.oGroupCreatedDeferred.state()==="pending"){if(this.aMoveTileCallsData===undefined){this.aMoveTileCallsData=[];}this.aMoveTileCallsData.push({sTileId:t,oTile:T,nTileIndex:a,nNNewIndex:n,oSourceGroup:S,nNewGroupIndex:h});if(this.aMoveTileCallsData.length>1){return;}this.oGroupCreatedDeferred.promise().done(function(){if(this.aMoveTileCallsData!==undefined&&this.aMoveTileCallsData.length>0){i=this.oModel.getProperty("/groups/"+h).object;for(j=0;j<this.aMoveTileCallsData.length;j++){m=this.aMoveTileCallsData[j];this._moveTileRequest(m.sTileId,m.oTile,m.nTileIndex,m.nNewIndex,m.oSourceGroup,m.nNewGroupIndex,i,true);}this.aMoveTileCallsData=undefined;this.oGroupCreatedDeferred=undefined;}}.bind(this));}else{this._moveTileRequest(t,T,a,n,S,h,i,false);}},_moveTileRequest:function(t,T,n,a,s,b,o,i){var r,d,e,f=sap.ushell.Container.getService("LaunchPage"),u;this._addRequest($.proxy(function(){try{r=this.oPageBuilderService.moveTile(T.object,n,a,s,o);}catch(h){this._resetGroupsOnFailure("fail_to_move_tile_msg");return;}T.tileIsBeingMoved=true;r.done(this._handleAfterSortable($.proxy(function(t,j){u=[f.getTileTitle(T.object),f.getGroupTitle(s),f.getGroupTitle(o),t];sap.ushell.Container.getService("UsageAnalytics").logCustomEvent(this.analyticsConstants.PERSONALIZATION,this.analyticsConstants.MOVE_TILE,u);d=this._getPathOfTile(t);if(d){this.oModel.setProperty(d+"/object",j);this.oModel.setProperty(d+"/originalTileId",this.oPageBuilderService.getTileId(j));this.oPageBuilderService.getTileView(j).done(function(v){e=this.oModel.getProperty(d+"/content");this.oModel.setProperty(d+"/content",[v]);if(e&&e[0]){e[0].destroy();}this.oModel.setProperty(d+"/tileIsBeingMoved",false);}.bind(this));}if(i){this._loadGroup(b,o);}this.updateTilesAssociation();},this,t)));r.fail(this._handleAfterSortable(this._resetGroupsOnFailureHelper("fail_to_move_tile_msg")));r.always($.proxy(this._checkRequestQueue,this));},this));},_adjustTileIndex:function(n,t,a){var v=0,I=false,i=0;for(i=0;i<a.tiles.length&&v<n;i++){if(a.tiles[i].isTileIntentSupported){if(a.tiles[i]===t){I=true;}else{v++;}}}if(I){return i-1;}return i;},getModel:function(){return this.oModel;},getDashboardView:function(){return this.oDashboardView;},updateTilesAssociation:function(){this.mapCatalogTilesToGroups();this.updateCatalogTilesToGroupsMap();},loadAllCatalogs:function(C,e,d){var G=new jQuery.Deferred(),t=this,s;G.resolve();s=function(){G.done(function(){var a=t.getModel().getProperty("/groups");if(a&&a.length!==0){t.updateTilesAssociation();}});};if(!this.oModel.getProperty("/catalogs")){if(!this.oModel.getProperty("/groups")||this.oModel.getProperty("/groups").length===0){G=this.loadPersonalizedGroups();}this._destroyAllGroupModels("/catalogs");this._destroyAllTileModels("/catalogTiles");this.oModel.setProperty("/catalogs",[]);this.oModel.setProperty("/catalogTiles",[]);this.aPromises=[];sap.ushell.Container.getService("LaunchPage").getCatalogs().done(function(a){jQuery.when.apply(jQuery,this.aPromises).then(this.onDoneLoadingCatalogs(a));s();}.bind(this)).fail(t._showLocalizedErrorHelper("fail_to_load_catalog_msg")).progress(this.addCatalogToModel.bind(this));}else{s();}},updateCatalogTilesToGroupsMap:function(){var a=this.getModel().getProperty("/catalogTiles"),t,i,b,d,G,s=sap.ushell.Container.getService("LaunchPage");if(a){for(i=0;i<a.length;i++){t=a[i];b=encodeURIComponent(s.getCatalogTileId(t.src));d=this.getModel().getProperty("/catalogTiles/"+i+"/associatedGroups");G=this.oTileCatalogToGroupsMap[b];d=G?G:[];a[i].associatedGroups=d;}}this.getModel().setProperty("/catalogTiles",a);},addCatalogToModel:function(C){var a=this.oModel.getProperty('/catalogs'),s=sap.ushell.Container.getService("LaunchPage"),b=s.getCatalogId(C),d=false,o,p;a.forEach(function(e){if(e.id===b){d=true;}});if(!d){o={title:s.getCatalogTitle(C),id:s.getCatalogId(C),"static":false,tiles:[],numberOfTiles:0};p=s.getCatalogTiles(C);this.aPromises.push(p);p.done(function(t){if(!t.length){return;}var e={catalog:o.title,id:o.id,index:a.length,numberOfExistingTiles:0},u;u=function(){if(!this.oModel.getProperty('/isCatalogInUpdate')){this.oModel.setProperty('/isCatalogInUpdate',true);var E=this.searchModelCatalogByTitle(o.title),f;if(E.result){e.index=E.indexOfPreviousInstanceInModel;e.numberOfExistingTiles=E.numOfTilesInCatalog;this.setCatalogTiles("/catalogTiles",true,e,t);f=this.oModel.getProperty('/catalogs');C=f[E.indexOfPreviousInstanceInModel];C.numIntentSupportedTiles=c.call(this,o);C.numberOfTiles=E.numOfTilesInCatalog+t.length;a[E.indexOfPreviousInstanceInModel]=C;}else{this.setCatalogTiles("/catalogTiles",true,e,t);o.numIntentSupportedTiles=c.call(this,o);o.numberOfTiles=t.length;a.push(o);}this.oModel.setProperty('/catalogs',a);this.oModel.setProperty('/isCatalogInUpdate',false);return;}setTimeout(u,50);}.bind(this);u();}.bind(this)).fail(this._showLocalizedErrorHelper("fail_to_load_catalog_tiles_msg"));}},searchModelCatalogByTitle:function(a){var b=this.oModel.getProperty('/catalogs'),d=false,i,n=0,G=false;$.each(b,function(e,t){if(t.title===sap.ushell.resources.i18n.getText('catalogsLoading')){G=true;}else if(a==t.title){i=e;n=t.numberOfTiles;d=true;return false;}});return{result:d,indexOfPreviousInstanceInModel:i,indexOfPreviousInstanceInPage:G?i-1:i,numOfTilesInCatalog:n};},getTagList:function(m){var i={},d=0,t=[],e,T,s;for(d=0;d<this.tagsPool.length;d++){T=this.tagsPool[d];if(i[T]){i[T]++;}else{i[T]=1;}}for(e in i){t.push({tag:e,occ:i[e]});}s=t.sort(function(a,b){return b.occ-a.occ;});if(s.length===0){this.oModel.setProperty("/tagFiltering",false);}if(m){this.oModel.setProperty("/tagList",s.slice(0,m));}else{this.oModel.setProperty("/tagList",s);}},onDoneLoadingCatalogs:function(C){if(!C.length){this.oModel.setProperty("/catalogsNoDataText",sap.ushell.resources.i18n.getText('noCatalogs'));}var s=sap.ushell.Container.getService("LaunchPage"),l=C.filter(function(o){return!s.getCatalogError(o);}),a;if(l.length!==C.length){this._showLocalizedError("partialCatalogFail");}if(this.oModel.getProperty("/tagFiltering")===true){this.getTagList();}a=this.oModel.getProperty('/catalogs');if(a[0]&&a[0].title===sap.ushell.resources.i18n.getText('catalogsLoading')){a.splice(0,1);}a.splice(0,0,{title:g("catalogSelect_initial_selection"),"static":true,tiles:[],numIntentSupportedTiles:-1});this.oModel.setProperty('/catalogs',a);sap.ushell.utils.handleTilesVisibility();},setCatalogTiles:function(p,a,d,C){var s=sap.ushell.Container.getService("LaunchPage"),u=$.map(C,function(o,t){var b,e=encodeURIComponent(s.getCatalogTileId(o)),f=this.oTileCatalogToGroupsMap[e]||[],h=s.getCatalogTileTags(o)||[];if(h.length>0){this.tagsPool=this.tagsPool.concat(h);}b=s.getCatalogTileView(o);return{associatedGroups:f,src:o,catalog:d.catalog,catalogIndex:this.calculateCatalogTileIndex(d.index,d.numberOfExistingTiles,t),catalogId:d.id,title:s.getCatalogTileTitle(o),tags:h,keywords:(s.getCatalogTileKeywords(o)||[]).join(','),id:e,size:s.getCatalogTileSize(o),content:[b],isTileIntentSupported:s.isTileIntentSupported(o)};}.bind(this));this.oModel.setProperty(p,$.merge((a&&this.oModel.getProperty(p))||[],u));},calculateCatalogTileIndex:function(a,n,t){var r=parseInt(a*100000,10);r+=(n!==undefined?n:0)+t;return r;},mapCatalogTilesToGroups:function(){this.oTileCatalogToGroupsMap={};var G=this.oModel.getProperty("/groups"),s=sap.ushell.Container.getService("LaunchPage"),i=0,o,t,T,a,b,d;for(i=0;i<G.length;i++){o=G[i];T=o.tiles;if(T){for(t=0;t<T.length;++t){a=encodeURIComponent(s.getCatalogTileId(T[t].object));b=this.oTileCatalogToGroupsMap[a]||[];d=s.getGroupId(o.object);if(b.indexOf(d)===-1&&(typeof(o.isGroupVisible)==='undefined'||o.isGroupVisible)&&!o.isGroupLocked){b.push(d);}this.oTileCatalogToGroupsMap[a]=b;}}}},_showLocalizedMessage:function(m,p,t){sap.ushell.Container.getService("Message").show(t||sap.ushell.services.Message.Type.INFO,g(m,p),p);},_showLocalizedError:function(m,p){this._showLocalizedMessage(m,p,sap.ushell.services.Message.Type.ERROR);},_showLocalizedErrorHelper:function(m,p){var t=this;return function(){t._showLocalizedError(m,p);};},_resetGroupsOnFailureHelper:function(m){var t=this;return function(G){t._showLocalizedError(m);t._requestFailed();setTimeout(function(){t.loadGroupsFromArray(G);});};},_resetGroupsOnFailure:function(m,p){this._requestFailed();this._showLocalizedError(m,p);this.loadPersonalizedGroups();this.oModel.updateBindings(true);},resetGroupsOnFailure:function(){this._resetGroupsOnFailure.apply(this,arguments);},_bindSegment:function(G,s){var a,o,S,b;for(a=0;a<s.length;a++){S=s[a];b=S.index;o=G[b];o.isRendered=true;o.tiles=o.tiles.concat(S.tiles);o.links=o.links.concat(S.links);}return G;},createGroupsModelFrame:function(G,p){var a,C=[],o,f;f=function(b){var d=jQuery.extend({},b);d.tiles=[];d.links=[];return d;};for(a=0;a<G.length;a++){o=G[a];C[a]=f(o);C[a].isRendered=false;C[a].visibilityModes=sap.ushell.utils.calcVisibilityModes(o,p);}return C;},_splitGroups:function(s,G,f){var a,t,b=s,p=f,d=[],e,h,i,j=["tiles","links"],o=1,C,k;C=function(l){var m=jQuery.extend({},l);m.tiles=[];m.links=[];return m;};for(a=0;a<G.length;a++){k=G[a];e=C(k);d.push(e);for(h=0;h<j.length;h++){i=j[h];o=this.PagingManager.getSizeofSupportedElementInUnits(i==='links'?'link':'tile');for(t=0;t<k[i].length;t++){if(p<=0){p=b;if(d){this.segmentsStore.push(d);}e=C(k);d=[];d.push(e);}e[i].push(k[i][t]);p-=o;}}}if(d){this.segmentsStore.push(d);}},_processSegment:function(m){var e=sap.ui.getCore().getEventBus(),a,b,t;if(this.segmentsStore.length>0){a=this.segmentsStore.shift();b=a[0].index;t=m[b].tiles.length+m[b].links.length;m=this._bindSegment(m,a);this.oModel.setProperty('/groups',m);this._updateModelWithTileView(b,t);this._handleSegment();}else{this._updateModelWithTileView(0,0);sap.ushell.utils.handleTilesVisibility();e.publish("launchpad","dashboardModelContentLoaded");}},_handleBookmarkModelUpdate:function(){this.bIsGroupsModelDirty=false;this.bGroupsModelLoadingInProcess=true;this.loadPersonalizedGroups();},_modelLoaded:function(){this.bGroupsModelLoadingInProcess=false;if(this.bIsGroupsModelDirty){this._handleBookmarkModelUpdate();}},_handleSegment:function(){clearTimeout(this.oSegmentTimer);this.oSegmentTimer=setTimeout(function(){this._processSegment(this.oModel.getProperty('/groups'));}.bind(this),100);},loadGroupsFromArray:function(G){var t=this;this.oPageBuilderService.getDefaultGroup().done(function(d){if(G.length==0&&d==undefined){return;}var i=0,l=[],b,a=G.indexOf(d),n,N,e=[],o,f,h,m,s,j,k,p={desktop:5,tablet:10,phone:15},q=0,r=0,u,v=0;G.splice(a,1);while(i<G.length){o=G[i];f=t.oPageBuilderService.isGroupLocked(o);if(f){l.push(o);G.splice(i,1);}else{i++;}}n=l.length;if(!t.oModel.getProperty('/disableSortedLockedGroups')){l.sort(function(x,y){var w=t.oPageBuilderService.getGroupTitle(x).toLowerCase(),z=t.oPageBuilderService.getGroupTitle(y).toLowerCase();return w<z?-1:1;});}b=l;b.push(d);b.push.apply(b,G);G=b;h=G.length;m=t.oModel.getProperty("/groups/length");t.oModel.setProperty("/groups/indexOfDefaultGroup",n);for(i=h;i<m;++i){t._destroyGroupModel("/groups/"+i);}if(!t.PagingManager){jQuery.sap.require("sap.ushell.components.flp.launchpad.PagingManager");t.PagingManager=new sap.ushell.components.flp.launchpad.PagingManager('dashboardPaging',{supportedElements:{tile:{className:'sapUshellTile'},link:{className:'sapUshellLinkTile'}},containerHeight:window.innerHeight,containerWidth:window.innerWidth});if(t.PagingManager.currentPageIndex===0){t.PagingManager.moveToNextPage();q=t.PagingManager._calcElementsPerPage();}}j=t.PagingManager.getSizeofSupportedElementInUnits('link');k=t.PagingManager.getSizeofSupportedElementInUnits('tile');for(i=0;i<h;++i){N=t._getGroupModel(G[i],i===n,i===h-1);N.index=i;v+=N.tiles.length*k+N.links.length*j;e.push(N);}if(sap.ui.Device.system.desktop){r=p.desktop;}else if(sap.ui.Device.system.tablet){r=p.tablet;}else{r=p.phone;}s=(v-q)/r;if(s<14){s=14;}u=t.createGroupsModelFrame(e,t.oModel.getProperty("/personalization"));t._splitGroups(s,e,q);t._processSegment(u);t.oModel.setProperty("/groups/length",u.length);if(t.oModel.getProperty('/currentState/stateName')==="catalog"){t.mapCatalogTilesToGroups();t.updateCatalogTilesToGroupsMap();}}).fail(t._resetGroupsOnFailureHelper("fail_to_get_default_group_msg"));},_loadGroup:function(n,G,h){var t=this,s="/groups/"+n,d=t.oModel.getProperty("/groups/indexOfDefaultGroup"),i=t.oModel.getProperty(s).isLastGroup,o,N;this._destroyGroupModel(s);o=this.oModel.getProperty(s+"/groupId");N=this._getGroupModel(G,n===d,i,undefined,h);if(o){N.groupId=o;}N.index=n;N.isRendered=true;this.oModel.setProperty(s,N);},_getGroupModel:function(G,d,l,D,h){var s=this.oPageBuilderService,a=(G&&s.getGroupTiles(G))||[],m=[],M=[],i,b,o=this.getModel();b=o.getProperty("/personalization");var e=G&&s.isGroupLocked(G)?true:false;for(i=0;i<a.length;++i){var t=a[i],T=s.getTileType(t).toLowerCase();if(T==="tile"){m.push(this._getTileModel(a[i],e,T,h));}else if(T==="link"){M.push(this._getTileModel(a[i],e,T,h));}else{jQuery.sap.log.error("Unknown tile type: '"+T+"'",undefined,"sap.ushell.components.flp.launchpad.DashboardManager");}}return{title:(d&&g("my_group"))||(G&&s.getGroupTitle(G))||(D&&D.title)||"",object:G,groupId:jQuery.sap.uid(),links:M,tiles:m,isDefaultGroup:d||false,editMode:!G,isGroupLocked:e,visibilityModes:[true,true],removable:!G||s.isGroupRemovable(G),sortable:b,isGroupVisible:!G||s.isGroupVisible(G),isEnabled:!d,isLastGroup:l||false,isRendered:D?!!D.isRendered:false};},_addTileToGroup:function(G,t){var T=G+"/tiles",o=this.oModel.getProperty(G),n=this.oModel.getProperty(T).length,s=this.oPageBuilderService,a=s.getTileType(t);var i=this.oModel.getProperty(G+"/isGroupLocked"),p=this.oModel.getProperty("/personalization");o.tiles[n]=this._getTileModel(t,i,a,this._addModelToTileViewUpdateQueue);o.visibilityModes=sap.ushell.utils.calcVisibilityModes(o,p);this._updateModelWithTileView(o.index,n);this.oModel.setProperty(G,o);},_addAndUpdateModelWithTileView:function(t,T){this._addModelToTileViewUpdateQueue(t,T);this._updateModelWithTileView(0,0);},_addModelToTileViewUpdateQueue:function(t,T){this.tileViewUpdateQueue.push({uuid:t,view:T});},_updateModelWithTileView:function(s,a){var t=this;if(this.tileViewUpdateTimeoutID){clearTimeout(this.tileViewUpdateTimeoutID);}this.tileViewUpdateTimeoutID=setTimeout(function(){t.tileViewUpdateTimeoutID=undefined;t.oSortableDeferred.done(function(){t._updateModelWithTilesViews(s,a);});},50);},_updateModelWithTilesViews:function(s,a){var G=this.oModel.getProperty("/groups"),t,l,T,u,S,L,b=s||0,d=a||0,h=[];if(!G||this.tileViewUpdateQueue.length===0){return;}for(var i=b;i<G.length;i=i+1){t=G[i].tiles;l=G[i].links;t=t.concat(l);for(var j=d;j<t.length;j=j+1){T=t[j];for(var q=0;q<this.tileViewUpdateQueue.length;q++){u=this.tileViewUpdateQueue[q];if(T.uuid==u.uuid){h.push(q);if(u.view){T.content[0].destroy();T.content=[u.view];S=this.oPageBuilderService.getTileSize(T.object);L=((S!==null)&&(S==="1x2"))||false;if(T['long']!==L){T['long']=L;}}else{T.content[0].setState("Failed");}break;}}}}var e=[],f;for(f=0;f<this.tileViewUpdateQueue.length;f++){if(h.indexOf(f)===-1){e.push(this.tileViewUpdateQueue[f]);}}this.tileViewUpdateQueue=e;this.oModel.setProperty("/groups",G);},getModelTileById:function(i){var G=this.oModel.getProperty('/groups'),m;G.forEach(function(o){o.tiles.forEach(function(t){if(t.uuid===i||t.originalTileId===i){m=t;return;}});});return m;},_getTileModel:function(t,i,T,u){var s=this.oPageBuilderService,a=jQuery.sap.uid(),o,b=this,d,e,U;this.sTileType=T;s.setTileVisible(t,false);d=s.getTileView(t);d.done(function(v){o=v;if(U){U.apply(b,[a,o]);b._handleSegment();}});d.fail(function(){if(U){U.apply(b,[a]);b._handleSegment();}else{jQuery.sap.require('sap.ushell.ui.launchpad.TileState');if(b.sTileType==="link"){o=new sap.m.Link({text:sap.ushell.resources.i18n.getText('cannotLoadTile')});}else{o=new sap.ushell.ui.launchpad.TileState({state:"Failed"});}}});if(!o){U=u?u:this._addModelToTileViewUpdateQueue;jQuery.sap.require('sap.ushell.ui.launchpad.TileState');o=new sap.ushell.ui.launchpad.TileState({state:"Loading"});}if(T==="link"){e={"object":t,"originalTileId":s.getTileId(t),"uuid":a,"tileCatalogId":encodeURIComponent(s.getCatalogTileId(t)),"content":[o],"target":s.getTileTarget(t)||"","debugInfo":s.getTileDebugInfo(t),"isTileIntentSupported":s.isTileIntentSupported(t),"isLocked":i};}else if(T==="tile"){var S=s.getTileSize(t);e={"object":t,"originalTileId":s.getTileId(t),"uuid":a,"tileCatalogId":encodeURIComponent(s.getCatalogTileId(t)),"content":[o],"long":((S!==null)&&(S==="1x2"))||false,"target":s.getTileTarget(t)||"","debugInfo":s.getTileDebugInfo(t),"isTileIntentSupported":s.isTileIntentSupported(t),"rgba":"","isLocked":i,"showActionsIcon":this.oModel.getProperty("/tileActionsIconEnabled")||false};}return e;},_destroyAllGroupModels:function(t){var G=(typeof t==="string")?this.oModel.getProperty(t):t,i;if(G){for(i=0;i<G.length;i=i+1){this._destroyGroupModel(G[i]);}}},_destroyGroupModel:function(t){var G=(typeof t==="string")?this.oModel.getProperty(t):t;if(G){this._destroyAllTileModels(G.tiles);}},_destroyAllTileModels:function(t){var T=(typeof t==="string")?this.oModel.getProperty(t):t,i;if(T){for(i=0;i<T.length;i=i+1){this._destroyTileModel(T[i]);}}},_destroyTileModel:function(t){var T=(typeof t==="string")?this.oModel.getProperty(t):t,i;if(T&&T.content){for(i=0;i<T.content.length;i=i+1){T.content[i].destroy();}}},loadPersonalizedGroups:function(){var t=this,G=this.oPageBuilderService.getGroups(),d=new jQuery.Deferred();G.done(function(a){t.loadGroupsFromArray(a);d.resolve();});G.fail(function(){t._showLocalizedErrorHelper("fail_to_load_groups_msg")();d.reject();});return d;}});}());
