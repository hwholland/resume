// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.GroupListPopover",{bPopoverCreated:false,oPopover:undefined,oGroupList:undefined,createContent:function(c){this.iPopoverDataSectionHeight=192;this.oGroupsContainer=this._createPopoverContainer(this.iPopoverDataSectionHeight);if(!this.bPopoverCreated){this.oPopover=new sap.m.ResponsivePopover({id:"groupsPopover",placement:sap.m.PlacementType.Auto,enableScrolling:true,title:sap.ushell.resources.i18n.getText("addTileToGroups_popoverTitle"),contentWidth:'20rem',beginButton:this._createOkButton(),endButton:this._createCancelButton(),content:this.oGroupsContainer,afterClose:this.getController()._afterCloseHandler.bind(this.getController())});this.bPopoverCreated=true;this.oPopover.setInitialFocus('newGroupItem');}},setGroupsData:function(g){this.getController().oPopoverModel.setData({userGroupList:g});},setGroupListSingleSelection:function(g){this.oGroupList.setMode(g);if(g===sap.m.ListMode.SingleSelectMaster){this.oGroupList.attachSelect(this.getController().okButtonHandler.bind(this.getController()));}else{this.oGroupList.detachSelect(this.getController().okButtonHandler,this.getController());}},open:function(o){if(document.body.clientHeight-o.getDomRef().getBoundingClientRect().bottom>=310){this.oPopover.setPlacement(sap.m.PlacementType.Bottom);}else{this.oPopover.setPlacement(sap.m.PlacementType.Auto);}this.oPopover.openBy(o);if(this.newGroupInput!==undefined){this.newGroupInput.setValue('');}if(this.oGroupList.getMode()===sap.m.ListMode.SingleSelectMaster){this.getController()._setFooterVisibility(false);}else{this.getController()._setFooterVisibility(true);}this.deferred=jQuery.Deferred();return this.deferred.promise();},_createPopoverContainer:function(p){var P,t,n=this._createNewGroupUiElements();t=this._createPopoverGroupList();P=new sap.m.ScrollContainer({horizontal:false,vertical:true,content:[n,t]});if(!sap.ui.Device.system.phone){P.setHeight((p-2)+"px");}else{P.setHeight("100%");}return P;},_createNewGroupUiElements:function(){var n=new sap.m.StandardListItem({id:"newGroupItem",title:sap.ushell.resources.i18n.getText("newGroup_listItemText"),type:"Navigation",press:this.getController()._navigateToCreateNewGroupPane.bind(this.getController())}),N=new sap.m.List({});if(this.getViewData().enableHelp){n.addStyleClass('help-id-newGroupItem');}N.addItem(n);return N;},_createNewGroupInput:function(){var n=new sap.m.Input({id:"newGroupNameInput",type:"Text",placeholder:sap.ushell.resources.i18n.getText("new_group_name")});n.setValueState(sap.ui.core.ValueState.None);n.setPlaceholder(sap.ushell.resources.i18n.getText("new_group_name"));n.enabled=true;n.addStyleClass("sapUshellCatalogNewGroupInput");return n;},_createHeadBarForNewGroup:function(){var b=new sap.m.Button({icon:sap.ui.core.IconPool.getIconURI("nav-back"),press:this.getController()._backButtonHandler.bind(this.getController()),tooltip:sap.ushell.resources.i18n.getText("newGroupGoBackBtn_tooltip")}),h;b.addStyleClass("sapUshellCatalogNewGroupBackButton");h=new sap.m.Bar({contentLeft:[b],contentMiddle:[new sap.m.Label({text:sap.ushell.resources.i18n.getText("newGroup_popoverTitle")})]});return h;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.GroupListPopover";},_createPopoverGroupList:function(){var l=new sap.m.DisplayListItem({label:"{oGroup/title}",selected:"{selected}",tooltip:"{oGroup/title}",type:sap.m.ListType.Active}),t=this,u=[];u.push(new sap.ui.model.Filter("oGroup/isGroupLocked",sap.ui.model.FilterOperator.EQ,false));if(this.getViewData().enableHideGroups){u.push(new sap.ui.model.Filter("oGroup/isGroupVisible",sap.ui.model.FilterOperator.EQ,true));}this.oGroupList=new sap.m.List("groupListId",{includeItemInSelection:true,items:{path:"/userGroupList",template:l,filters:u}});this.oGroupList.addEventDelegate({onsapup:function(E){try{E.preventDefault();if(t.getView().getModel().getProperty("/groups/length")){var j,c=jQuery(":focus");if(c.index()===0){j=jQuery("#newGroupItem");j.focus();E._bIsStopHandlers=true;}}}catch(e){jQuery.sap.log.error("Groups popup Accessibility `up` key failed");}}});return this.oGroupList;},_createOkButton:function(){var o=new sap.m.Button({id:"okButton",press:this.getController().okButtonHandler.bind(this.getController()),text:sap.ushell.resources.i18n.getText("okBtn")});o.addEventDelegate({onsaptabprevious:function(E){try{E.preventDefault();E._bIsStopHandlers=true;var j=jQuery("#newGroupItem");if(!j.length){j=jQuery("#newGroupNameInput input");}j.focus();}catch(e){jQuery.sap.log.error("Groups popup Accessibility `shift-tab` key failed");}}});return o;},_createCancelButton:function(){return new sap.m.Button({id:"cancelButton",press:this.getController()._cancelButtonHandler.bind(this.getController()),text:sap.ushell.resources.i18n.getText("cancelBtn")});}});}());
