// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.flp.ComponentKeysHandler");var c=function(){this.aTileWrapperClasses=['.sapUshellTile','.sapUshellLinkTile'];};c.prototype={keyCodes:jQuery.sap.KeyCodes,handleCatalogKey:function(){this.oRouter.navTo("appFinder",{'menu':'catalog'});},handleHomepageKey:function(){this.oRouter.navTo("home");},getNumberOfTileInRow:function(p,i){var j=jQuery(i?".sapUshellLinkTile:first":".sapUshellTile:first");if(!j.length){return false;}var a;if(p==="catalog"){a=jQuery("#catalogTiles .sapUshellTileContainerContent").width();}else{a=jQuery("#dashboardGroups").width();}var n=Math.floor(a/j.outerWidth(true));return n;},goToTileContainer:function(k,g){var i=this.oModel.getProperty('/tileActionModeActive');if(i){sap.ushell.components.flp.ComponentKeysHandler.goToFirstVisibleTileContainer();}else{sap.ushell.components.flp.ComponentKeysHandler.goToEdgeTile('first',g);}return true;},goToEdgeTile:function(s,g){var j=jQuery('#dashboardGroups').find('.sapUshellTileContainer:visible'),t=this.oModel.getProperty("/topGroupInViewPortIndex"),a=j.get(t),b=jQuery(a).find('.sapUshellTile:visible')[s](),l=jQuery("div.sapUshellTile:visible[tabindex='0']"),d=jQuery("div.sapUshellLinkTile:visible[tabindex='0']");if(!b.length&&!l.length&&!d.length){return false;}if(l.length&&!g){this.setTileFocus(l);return true;}if(d.length&&!g){this.setTileFocus(d);return true;}this.setTileFocus(b);return true;},goToFirstVisibleTileContainer:function(){var j=jQuery('#dashboardGroups').find('.sapUshellTileContainer:visible'),t=this.oModel.getProperty("/topGroupInViewPortIndex"),a=jQuery(j.get(t));if(!a[0]){return false;}this.setTileContainerSelectiveFocus(a);return true;},goToFirstTileOfSiblingGroup:function(s,e){e.preventDefault();var a=jQuery(document.activeElement).closest(".sapUshellDashboardGroupsContainerItem");if(!a.length){return;}var n=a[s+"All"](".sapUshellDashboardGroupsContainerItem:has(.sapUshellTile:visible):not(.sapUshellCloneArea)");var t='first';if(!n.length){n=a;t=(s==="next")?'last':'first';}else{n=n.first();}var j=n.find(".sapUshellTile:visible")[t]();this.moveScrollDashboard(j);return false;},goToFirstTileOfSiblingGroupInCatalog:function(s,e){e.preventDefault();var j=this.getFocusOnTile(jQuery(document.activeElement));if(!j){return;}var a;if(s=="next"){var i=j.nextAll("h3").length?false:true;if(!i){a=j.nextAll("h3").first().nextAll().filter(":visible").first();}else{a=j.nextAll(".sapUshellTile").last();}}else{var b=j.prevAll("h3").length===1?true:false;if(!b){a=jQuery(j.prevAll("h3")[1]).next();}else{a=j.prevAll("h3").last().next();}}this.setTileFocus(a);this.moveScrollCatalog(a);return false;},moveTileInGroup:function(g,f,s){if(this.oModel.getProperty("/personalization")){var a=g.getBindingContext().getObject();var b=a.tiles.indexOf(f.getBindingContext().getObject());var d=a.tiles.indexOf(s.getBindingContext().getObject());var e=a.tiles.splice(b,1);a.tiles.splice(d,0,e[0]);var h=g.getBindingContext().getPath();g.getModel().setProperty(h,a);}},moveTileToDifferentGroup:function(s,d,a,b){if(this.oModel.getProperty("/personalization")){if(s.getIsGroupLocked()||d.getIsGroupLocked()){return;}var e=s.getBindingContext().getObject();var f=d.getBindingContext().getObject();var t=e.tiles.indexOf(a.getBindingContext().getObject());if(b==="left"||b==="up"||b==="down"){f.tiles.push(e.tiles[t]);}if(b==="right"){f.tiles.splice(0,0,e.tiles[t]);}e.tiles.splice(t,1);var g=d.getBindingContext().getPath();d.getModel().setProperty(g,f);var h=s.getBindingContext().getPath();s.getModel().setProperty(h,e);var i=d.getTiles();if(b==="left"||b==="up"||b==="down"){return i[i.length-1];}else{return i[0];}}},moveTile:function(d){var j=jQuery(".sapUshellDashboardView"),a=sap.ui.getCore().byId(j.attr("id"));a.getModel().setProperty('/isInDrag',true);setTimeout(function(){a.getModel().setProperty('/isInDrag',false);},300);if(this.oModel.getProperty("/personalization")){var i=this.getGroupAndTilesInfo();if(!i||i.group.getProperty('isGroupLocked')){return;}var m=true,I,n=this.getNextTile(d,i,I,m);if(!n){return;}else{var b=n.getParent();}if(b===i.group){this.moveTileInGroup(i.group,i.curTile,n);}else{n=this.moveTileToDifferentGroup(i.group,b,i.curTile,d);}setTimeout(function(){if(n){this.setTileFocus(jQuery(n.getDomRef()));}}.bind(this),100);}},getNextUpDownTileWithLayout:function(d,i,m){var n,a;var b=d==="down"?1:-1;var e=!i.tiles.length&&!i.links.length;var I=i.group.getIsGroupLocked();var f=jQuery(i.curTile.getDomRef()).hasClass('sapUshellPlusTile');var l=i.group.getLinks();var g=sap.ushell.Layout.organizeGroup(i.curTile.isLink?i.links:i.tiles,i.curTile.isLink);var t=sap.ushell.Layout.getTilePositionInMatrix(i.curTile,g);var h=this.isLastLineFull(g);var j=this.oModel.getProperty('/tileActionModeActive');if(!t&&!e&&!f){return;}if(!g[t.row+b]){if(j&&!I&&!f&&h&&d==="down"){return i.group.oPlusTile;}if(!i.curTile.isLink&&l.length&&d==='down'){if(!m){return l[0];}}if(i.curTile.isLink&&i.tiles.length&&d==='up'){return i.tiles[0];}t=e||f?{row:0,col:0}:t;a=this.getNextGroup(d,i);if(!a){return;}e=!a.getTiles().length&&!a.getLinks().length;if(!e){var F=this._getAggregationToFocusInNextGroup(a,d);var N=this._isNextTileLink(F);g=sap.ushell.Layout.organizeGroup(F,N);b=0;t.row=d==="down"?0:g.length-1;}}if(e&&I){return undefined;}if(e){return a.oPlusTile;}if(typeof g[t.row+b][t.col]==="object"&&!e){n=g[t.row+b][t.col];}else{n=this.getNextUpDownTile(g,t.row+b,t.col,d);}return n;},_isNextTileLink:function(t){if(t&&t.length){var j=jQuery(t[0].getDomRef());return j.hasClass("sapUshellLinkTile");}return false;},_getAggregationToFocusInNextGroup:function(n,d){if(d==="down"||d==="right"){if(n.getTiles().length){return n.getShowPlaceholder()?[].concat(n.getTiles(),n.oPlusTile):n.getTiles();}if(n.getLinks().length){return n.getLinks();}}else if(d==="up"||d==="left"){if(n.getLinks().length){return n.getLinks();}if(n.getTiles().length){return n.getShowPlaceholder()?[].concat(n.getTiles(),n.oPlusTile):n.getTiles();}}},isLastLineFull:function(l){var m=this.getNumberOfTileInRow(),a=l[l.length-1].filter(Boolean);return a.length===m;},getNextUpDownTile:function(l,r,a,d){var n=r,b=l.length,e,f=d==="up"?-1:1;while((n>=0&&n<b)&&!e){if(typeof l[n][a]!=="object"){e=l[n][a];}n=n+f;}if(e){return;}n=r;while((typeof l[n][a]!=="object")&&a>=0){a--;}return l[n][a];},getNextTile:function(d,a,I,m){var n,b,e,s,t,l,w,f,o,g=sap.ui.getCore().getConfiguration().getRTL()?-1:1,h=!a.tiles.length,j=d==="right"?1:-1;if(a.pageName==='catalog'){if(d=='right'||d=='left'){n=!h?a.tiles[a.curTileIndex+(g*j)]:undefined;return n;}if(a.curTileIndex==='0'&&d==='up'){return undefined;}b=this.whichTileRow(a.curTileIndex,a);o=parseFloat(a.curTile.getDomRef().offsetLeft);if(d=="down"){e=a.tiles.slice(a.curTileIndex+1,a.curTileIndex+(a.sizeOfLine*2));}else{s=(s>0)?s:0;e=a.tiles.slice(s,a.curTileIndex).reverse();}for(var i=0,k=e.length;i<k;i++){t=e[i].getDomRef();l=parseFloat(t.offsetLeft);w=parseFloat(t.offsetWidth);f=l+w;if(l<=o&&f>=o){n=e[i];return n;}}if(this.nextRowIsShorter(d,b,a)){n=this.getNextTileInShorterRow(d,b,a);return n;}}else{if(d==="left"||d==="right"){var p=a.curTileIndex+(g*j);var F=a.curTile.isLink?a.links:a.tiles;if(F[p]&&!(m&&F[p].getDomRef().className.indexOf("sapUshellPlusTile")>0)){n=F.length?F[p]:undefined;}if(n){return n;}if(d==="right"&&!a.curTile.isLink&&a.links.length&&!m){return a.links[0];}if(d==="left"&&a.curTile.isLink&&a.tiles.length){return a.group.getShowPlaceholder()?a.group.oPlusTile:a.tiles[a.tiles.length-1];}var q=this.getNextGroup(d,a);if(!q){return;}else{var r=this._getAggregationToFocusInNextGroup(q,d);if(r&&r.length){var u=r.length-1;if(d==="right"){n=r[g===1?0:u];}else{n=r[g===1?u:0];}}else{n=q.oPlusTile;}}}if(d==="down"||d==="up"){n=this.getNextUpDownTileWithLayout(d,a,m);}}return n;},getNextTileInShorterRow:function(d,a,i){var l=d==='down'?this.getLastTileIdInRow(i,a+1):this.getLastTileIdInRow(i,a-1);return i.tiles[l];},getLastTileIdInRow:function(a,l){var b=0;for(var i=0;i<a.rowsData.length;i++){b+=a.rowsData[i];if(i===l){break;}}return b-1;},nextRowIsShorter:function(d,a,i){if(d==='down'&&a!=i.rowsData.length-1){return i.rowsData[a]>i.rowsData[a+1];}if(d==='up'&&a!=0){return i.rowsData[a]>i.rowsData[a-1];}else{return false;}},getNextGroup:function(d,i){var n,g=i.group.getParent().getGroups(),a=sap.ui.getCore().getConfiguration().getRTL(),b=g.indexOf(i.group);if(d==="right"||d==="left"){if(a){d=(d==="right")?"up":"down";}else{d=(d==="right")?"down":"up";}}if(d==="down"||d==="up"){var e=d==="up"?-1:1;n=g[b+e];if(!n){return;}while(!n.getVisible()&&(b>=0&&b<g.length)){b=b+e;n=g[b];if(!n){return;}}}if(!n.getVisible()){return;}return n;},getGroupAndTilesInfo:function(j,p){if(!j){j=this.getFocusOnTile(jQuery(document.activeElement));}if(!j.length){return;}var a=sap.ui.getCore().byId(j.attr('id'));var g=a.getParent();var r;var t;var l;if(!g.getTiles){g=g.getParent();}a.isLink=j.hasClass('sapUshellLinkTile');if(p=="catalog"){r=this.getCatalogLayoutData();t=[];var b=jQuery('#catalogTiles').find('.sapUshellTile:visible');for(var i=0;i<b.length;i++){t.push(sap.ui.getCore().byId(b[i].id));}}else{if(g.getTiles){t=g.getTiles();l=g.getLinks();if(g.getShowPlaceholder()&&!a.isLink){t.push(g.oPlusTile);}}}var s=this.getNumberOfTileInRow(p,a.isLink);return{pageName:p,curTile:a,curTileIndex:a.isLink?l.indexOf(a):t.indexOf(a),tiles:t,links:l,sizeOfLine:s,group:g,rowsData:r};},getCatalogLayoutData:function(){var j=jQuery('#catalogTiles .sapUshellInner').children(':visible'),m=this.getNumberOfTileInRow('catalog'),r=[],a=0;for(var i=1;i<j.length;i++){if(jQuery(j[i]).hasClass("sapUshellTile")){a++;}if(jQuery(j[i]).hasClass("sapUshellHeaderTile")){r.push(a);a=0;}if(a>=m){r.push(a);a=0;}}if(a>0){r.push(a);}return r;},whichTileRow:function(a,b){var t=0,i;for(i=0;i<b.rowsData.length;i++){t+=b.rowsData[i];if(a<t){return i;}}},goToSiblingElementInTileContainer:function(d,j,p){var a=j.closest('.sapUshellTileContainer'),b,e,f;if(b=this.getFocusTileContainerBeforeContent(j)){if(d==='up'||d==="left"){this._goToNextTileContainer(b,d);}else{f=a.find('.sapUshellTileContainerHeader:first');this.setTabIndexOnTileContainerHeader(f);f.focus();}return;}if(b=this.getFocusTileContainerHeader(j)){if(d==='up'){this.setTabIndexOnTileContainerHeader(f);if(!this._goToTileContainerBeforeContent(a)){this._goToNextTileContainer(b,d);}}else if(d==="down"){e=a.find('.sapUshellTile:first');if(e.length){var t=jQuery(e);this.scrollToTileAndSetFocus(t,p);}else{this._goToNextTileContainer(b,d);}}else if(d==="left"){if(j.hasClass("sapUshellTileContainerHeader")){if(!this._goToTileContainerBeforeContent(a)){this._goToNextTileContainer(b,"left");}}else{f=j.closest(".sapUshellTileContainerHeader");f.focus();}}else if(d==="right"){var g=j.hasClass("sapMInputBaseInner");if(!g){e=a.find('.sapUshellTile:first');if(e.length){this.setTileFocus(e);}else{this._goToNextTileContainer(b,"down");}}}return;}if(b=this.getFocusOnTile(j)){this.goFromFocusedTile(d,b,p,true);return;}if(b=this.getFocusOnTileContainerAfterContent(j)){if(d==='up'||d==="left"){this._goToFirstTileInTileContainer(b);}else{this._goToNextTileContainer(b,d);}}},_goToNextTileContainer:function(j,d){var a=j.closest('.sapUshellTileContainer'),A=jQuery('.sapUshellTileContainer:visible'),n=(d==='down')?1:-1,b,e;b=jQuery(A[A.index(a)+n]);if(b){e=b.find('.sapUshellTileContainerHeader');if(d==='down'){if(!this._goToTileContainerBeforeContent(b)){this.setTabIndexOnTileContainerHeader(e);this.setTileContainerSelectiveFocus(b);}}else{if(this._goToTileContainerAfterContent(b)){return;}if(d==='up'){if(!this._goToFirstTileInTileContainer(b)){this.setTabIndexOnTileContainerHeader(e);e.focus();}}else if(d==='left'){if(!this._goToLastTileInTileContainer(b)){this.setTabIndexOnTileContainerHeader(e);e.focus();}}}}},_goToLastTileInTileContainer:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=a.find('.sapUshellTile:last'),d=a.find('.sapUshellLinkTile:last');if(!d.length&&!b.length){return false;}this.setTileFocus(d.length?d:b);return true;},_goToFirstTileInTileContainer:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=jQuery(a.find('.sapUshellTile').get(0));if(b.length){this.setTileFocus(b);return true;}else{return false;}},_goToTileContainerBeforeContent:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=a.find('.sapUshellTileContainerBeforeContent button:visible');if(b.length){b.focus();return true;}else{return false;}},_goToTileContainerAfterContent:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=a.find('.sapUshellTileContainerAfterContent button:visible');if(b.length){b.focus();return true;}else{return false;}},goFromFocusedTile:function(d,j,p,i){var a=this.getGroupAndTilesInfo(j,p),n,b,e,f,g,I;if(!a){return;}n=this.getNextTile(d,a,i);if(i){b=jQuery(j).closest('.sapUshellTileContainer');if(!n){if(d==='down'||d==='right'){g=jQuery(b).find('.sapUshellTileContainerAfterContent button:visible');g.focus();return;}if(d==='up'){this.setTabIndexOnTileContainerHeader(b.find('.sapUshellTileContainerHeader'));this.setTileContainerSelectiveFocus(b);return;}if(d==='left'){f=b.find('.sapUshellTileContainerHeader');f.focus();}}else{e=jQuery(n.getDomRef()).closest('.sapUshellTileContainer');I=b.length&&e.length&&(b.attr('id')===e.attr('id'));if(I){var t=jQuery(n.getDomRef());this.scrollToTileAndSetFocus(t,p);}else{if(d==='down'||d==='right'){if(!this._goToTileContainerAfterContent(b)){this.setTabIndexOnTileContainerHeader(e.find('.sapUshellTileContainerHeader'));this.setTileContainerSelectiveFocus(e);}}else if(d==='up'||'left'){f=b.find('.sapUshellTileContainerHeader');this.setTabIndexOnTileContainerHeader(f);f.focus();}}}}else if(n){var t=jQuery(n.getDomRef());this.scrollToTileAndSetFocus(t,p);}},scrollToTileAndSetFocus:function(t,p){var a=t.offset().top+t.height();if(p==="catalog"){var o=(a-jQuery("body").height())-jQuery("#catalogTilesPage").offset().top+200;jQuery('#catalogTilesPage section').animate({scrollTop:o},0,function(){this.setTileFocus(t);}.bind(this));}else{this.moveScrollDashboard(t);}},deleteTile:function(j){var t=j.attr("id");if(!t){return;}var T=sap.ui.getCore().byId(t);var a=this.getGroupAndTilesInfo(j);var n=this.getNextTile("right",a);if(!n||(n&&n.getParent()!=a.group)){n=this.getNextTile("left",a);}if(!n||(n&&n.getParent()!=a.group)){n=a.group.oPlusTile;}if(n){this.setTileFocus(jQuery(n.getDomRef()));setTimeout(function(g,b){var d=g.getTiles();if(!d.length){if(a.group.getProperty('defaultGroup')){var f=this.getNextGroup("right",a);n=f.getTiles()[0]||f.oPlusTile;this.setTileFocus(jQuery(n.getDomRef()));}this.setTileFocus(jQuery(g.oPlusTile.getDomRef()));return;}var n;for(var i=0;i<d.length;i++){if(d[i].getProperty('uuid')==b){n=d[i];break;}}if(n){this.setTileFocus(jQuery(n.getDomRef()));}}.bind(this,a.group,n.getProperty('uuid')),100);}var e=sap.ui.getCore().getEventBus();e.publish("launchpad","deleteTile",{tileId:T.getUuid()});},setTabIndexOnTileContainerHeader:function(j){jQuery(".sapUshellTileContainerHeader").attr("tabindex",-1);jQuery(".sapUshellTileContainerHeader .sapUshellContainerTitle").attr("tabindex",-1);jQuery(".sapUshellTileContainerHeader .sapUshellContainerHeaderActions button").attr("tabindex",-1);if(j){var a=j.find('.sapUshellContainerTitle:first'),b=j.find('.sapUshellContainerHeaderActions:first');j.attr('tabindex',0);a.attr('tabindex',0);b.find('button').attr('tabindex',0);}},setTileContainerSelectiveFocus:function(j){var a=j.find('.sapUshellTileContainerBeforeContent button'),b=j.find('.sapUshellTileContainerHeader:first'),B=a.length&&a.is(":visible");if(B){a.focus();}else if(b.length){this.setTabIndexOnTileContainerHeader(b);b.focus();}},setTileFocus:function(j){if(!j.hasClass('sapUshellPlusTile')){var n=sap.ui.getCore().byId('navContainerFlp'),C=n.getCurrentPage(),o=n?n.getCurrentPage().getViewName():undefined,a;var i=!!((o==="sap.ushell.components.flp.launchpad.appfinder.AppFinder")&&(C.getController().getCurrentMenuName()==="catalog"));a=j.find('[tabindex]');if(i){var h=sap.ushell.components.flp.ComponentKeysHandler;h.setFocusOnCatalogTile(a.eq(0));}}jQuery(".sapUshellTile").attr("tabindex",-1);jQuery(".sapUshellLinkTile").attr("tabindex",-1);j.attr("tabindex",0);var b=jQuery("#loadingDialog")[0];if(!b||b.style.visibility==="hidden"){j.focus();}},setFocusOnCatalogTile:function(j){var p=jQuery(".sapUshellTile[tabindex=0]"),a,v,b;if(p.length){jQuery(".sapUshellTileContainerContent").find('[tabindex*=0]').attr("tabindex",-1);a=p.find('[tabindex], a').andSelf().filter('[tabindex], a');a.attr("tabindex",-1);}if(!j){v=jQuery(".sapUshellTile:visible");if(v.length){b=jQuery(v[0]);j=b.find('[tabindex], a').eq(0);}else{return;}}j.closest(".sapUshellTile").attr("tabindex",0);j.attr("tabindex",0);j.closest(".sapUshellTile").find("button").attr("tabindex",0);},moveScrollDashboard:function(j){var a=j.closest(".sapUshellTileContainer")[0].id,y=-1*(document.getElementById('dashboardGroups').getBoundingClientRect().top)+document.getElementById(a).getBoundingClientRect().top;y+=49;jQuery('#sapUshellDashboardPage section').stop().animate({scrollTop:y},0,function(){this.setTileFocus(j);}.bind(this));},moveScrollCatalog:function(j){var a=jQuery("#catalogTilesPage-cont");var t=jQuery('#shell-hdr').height()+jQuery('.sapMPageHeader').height()+(parseInt(jQuery('.sapMPanelHdr').css('margin-top'),10)*2);var y=j.offset().top+a.scrollTop()-t;sap.ui.getCore().byId("catalogTilesPage").scrollTo(y,200);},moveGroupFromDashboard:function(d,j){var a,t=jQuery(".sapUshellDashboardGroupsContainerItem"),i,b;a=j.closest(".sapUshellDashboardGroupsContainerItem");i=t.index(a);b=d=="up"||d=="left"?i-1:i+1;this.moveGroup(i,b);},moveGroup:function(f,t){var g=jQuery(".sapUshellDashboardGroupsContainerItem"),n=jQuery(".sapUshellDisableDragAndDrop").length;if(t<0||t>=g.length||t<n){return;}var a=sap.ui.getCore();var d={fromIndex:f,toIndex:t};var b=a.getEventBus();b.publish("launchpad","moveGroup",d);setTimeout(function(){var e=jQuery(".sapUshellTileContainerHeader")[t];this.setTabIndexOnTileContainerHeader(jQuery(e));jQuery(e).focus();}.bind(this),100);},getFocusGroupFromDashboard:function(j){var i=j.closest('.sapUshellTileContainerHeader').length&&j[0].tagName==='H2';return i?j:false;},getFocusTileContainerBeforeContent:function(j){var a=j.closest('.sapUshellTileContainerBeforeContent');return a.length?a:false;},getFocusTileContainerHeader:function(j){var a=j.closest('.sapUshellTileContainerHeader');return a.length?a:false;},getFocusOnTileContainerAfterContent:function(j){var a=j.closest('.sapUshellTileContainerAfterContent');return a.length?a:false;},getFocusOnTile:function(j){var a;jQuery.each(this.aTileWrapperClasses,function(i,t){var b=j.closest(t);a=b.length?b:false;return!(a);});return a;},renameGroup:function(){var j=jQuery(document.activeElement);var a=this.getFocusGroupFromDashboard(j);if(a){a.click();}},upDownButtonsHandler:function(d,p){var j=jQuery(document.activeElement);this.goFromFocusedTile(d,j,p);},arrowsButtonsHandler:function(d,e){var j=jQuery(document.activeElement),i=this.oModel.getProperty('/tileActionModeActive');if(j.hasClass("sapUshellAnchorItem")){e.preventDefault();this.handleAnchorNavigationItemsArrowKeys(d);}else{if(i){if(!j.hasClass('sapMInputBaseInner')){e.preventDefault();this.goToSiblingElementInTileContainer(d,j);}}else{e.preventDefault();this.goFromFocusedTile(d,j);}}},handleAnchorNavigationItemsArrowKeys:function(d){var a=jQuery(".sapUshellAnchorItem:visible"),j=jQuery(document.activeElement),i=a.index(j),n=j,I=sap.ui.getCore().getConfiguration().getRTL();if(I){d=d==='left'?'right':'left';}if(d==="left"||d==="down"){if(i>0){n=a.get(i-1);}}else if(d==="right"||d==="up"){if(i<a.length-1){n=a.get(i+1);}}jQuery(n).focus();},homeEndButtonsHandler:function(s,e){var j=jQuery(document.activeElement),t;if(j.hasClass("sapUshellAnchorItem")){e.preventDefault();var a=jQuery(".sapUshellAnchorItem:visible:"+s);a.focus();return;}if(j.hasClass("sapUshellTile")&&(j.closest("#dashboardGroups").length||j.closest("#catalogTiles").length)){e.preventDefault();if(e.ctrlKey===true){t=jQuery(".sapUshellTile:visible:not('.sapUshellPlusTile')")[s]();}else{t=j.parent().find(".sapUshellTile:visible:not('.sapUshellPlusTile')")[s]();}this.setTileFocus(t);return;}},deleteButtonHandler:function(){if(this.oModel.getProperty("/personalization")&&this.oModel.getProperty("/tileActionModeActive")){var j,a=jQuery(document.activeElement);if(j=this.getFocusOnTile(a)){if(!j.hasClass('sapUshellLockedTile')&&!j.hasClass('sapUshellPlusTile')){this.deleteTile(j);}return;}}},ctrlPlusArrowKeyButtonsHandler:function(s){var j,a=jQuery(document.activeElement),f=jQuery(a).hasClass('sapUshellLinkTile');if(!f&&(j=this.getFocusOnTile(a))){this.moveTile(s);return;}if(j=this.getFocusTileContainerHeader(a)){var b=j.closest('.sapUshellTileContainerContent');if(b.hasClass('sapUshellTileContainerDefault')||b.hasClass('sapUshellTileContainerLocked')){return;}else{this.moveGroupFromDashboard(s,j);}}},spaceButtonHandler:function(e){var j=jQuery(document.activeElement);if(j.hasClass("sapUshellTile")){e.preventDefault();var g=j.find('[role="button"]');if(g){var a=g.attr("id");var b=sap.ui.getCore().byId(a),i=this.oModel.getProperty('/tileActionModeActive');if(b&&!i){b.firePress();return false;}}j.click();return false;}},goToFirstCatalogTile:function(){var h=sap.ushell.components.flp.ComponentKeysHandler;var f=jQuery('#catalogTiles .sapUshellTile:visible:first');h.setTileFocus(f);},goToFirstCatalogHeaderItem:function(){var n=jQuery("#catalogTilesPage header button")[0];n.focus();},goToFirstAnchorNavigationItem:function(){var j=jQuery(".sapUshellAnchorItem:visible:first");j.focus();},handleFocusOnMe:function(k,f){var h=sap.ushell.components.flp.ComponentKeysHandler,n=sap.ui.getCore().byId('navContainerFlp'),C=n.getCurrentPage(),o=C.getViewName();if(o=="sap.ushell.components.flp.launchpad.dashboard.DashboardContent"){if(f){if(k.shiftKey){h.goToTileContainer(k);}else{h.goToFirstAnchorNavigationItem();}}else{h.mainKeydownHandler(k);h.dashboardKeydownHandler(k);}}if(o=="sap.ushell.components.flp.launchpad.appfinder.AppFinder"){if(h.appFinderKeydownHandler(k,f)){return;}var m=C.getController().getCurrentMenuName();if(m==="catalog"){if(f){if(k.shiftKey){h.goToFirstCatalogTile();}else{h.goToFirstCatalogHeaderItem();}}else{h.mainKeydownHandler(k);h.catalogKeydownHandler(k);}}else{h.easyAccessKeydownHandler(k);}}},groupHeaderNavigation:function(){var j=jQuery(document.activeElement),a;if(j.hasClass("sapUshellTileContainerHeader")){a=j.find(".sapUshellContainerTitle");a.focus();}else if(a=j.closest(".sapUshellTileContainerHeader")){a.focus();}},handleShortcuts:function(e){var h=sap.ushell.components.flp.ComponentKeysHandler;if(e.altKey){switch(String.fromCharCode(e.keyCode)){case'C':if(h.oModel.getProperty("/personalization")){h.handleCatalogKey();}break;case'H':h.handleHomepageKey();break;}}},mainKeydownHandler:function(e){e=e||window.event;switch(e.keyCode){case this.keyCodes.SPACE:this.spaceButtonHandler(e);break;case this.keyCodes.HOME:this.homeEndButtonsHandler("first",e);break;case this.keyCodes.END:this.homeEndButtonsHandler("last",e);break;}},catalogKeydownHandler:function(k){var h=sap.ushell.components.flp.ComponentKeysHandler;var p="catalog";switch(k.keyCode){case h.keyCodes.ARROW_UP:h.upDownButtonsHandler("up",p);break;case h.keyCodes.ARROW_DOWN:h.upDownButtonsHandler("down",p);break;case h.keyCodes.ARROW_RIGHT:h.goFromFocusedTile("right","",p);break;case h.keyCodes.ARROW_LEFT:h.goFromFocusedTile("left","",p);break;case h.keyCodes.PAGE_UP:h.goToFirstTileOfSiblingGroupInCatalog('prev',k);break;case h.keyCodes.PAGE_DOWN:h.goToFirstTileOfSiblingGroupInCatalog('next',k);break;}},appFinderFocusAppBox:function(j,a){j.attr("tabindex","-1").find(".sapUshellPinButton").attr("tabindex","-1");a.find(".sapUshellPinButton").attr("tabindex","0");a.attr("tabindex","0").focus();},appFinderKeydownHandler:function(k,f){if(!f){return;}var b=jQuery("#catalog, #userMenu, #sapMenu").filter("[tabindex=0]");if(b.length){b.eq(0).focus();return true;}},easyAccessRightLeftHandler:function(d,k){k.preventDefault();var h=sap.ushell.components.flp.ComponentKeysHandler;var s=d=="right"?"next":"prev";var j=jQuery(document.activeElement);if(!j.hasClass("sapUshellAppBox")){return;}var n=j.parent()[s]();if(n.length){h.appFinderFocusAppBox(j,n.children());}},easyAccessUpDownHandler:function(d,k){var h=sap.ushell.components.flp.ComponentKeysHandler;k.preventDefault();var f=document.activeElement;var j=jQuery(document.activeElement);if(!j.hasClass("sapUshellAppBox")){return;}var a=f.getBoundingClientRect();var b=[].slice.call(document.querySelectorAll(".sapUshellAppBox"));if(d=="up"){b.reverse();}b.splice(0,b.indexOf(f)+1);var n;for(var i=0;i<b.length;i++){var r=b[i].getBoundingClientRect();var e=(r.left<a.right&&r.right>a.left);if(e){n=b[i];break;}}if(n){h.appFinderFocusAppBox(j,jQuery(n));}},easyAccessHomeEndHandler:function(d,k){k.preventDefault();var h=sap.ushell.components.flp.ComponentKeysHandler;var s=d=="home"?"first":"last";var j=jQuery(document.activeElement);if(!j.hasClass("sapUshellAppBox")){return;}var n=j.parent().parent().children()[s]().children();if(j==n){return;}h.appFinderFocusAppBox(j,jQuery(n));},easyAccessKeydownHandler:function(k){var h=sap.ushell.components.flp.ComponentKeysHandler;switch(k.keyCode){case h.keyCodes.ARROW_UP:h.easyAccessUpDownHandler("up",k);break;case h.keyCodes.ARROW_DOWN:h.easyAccessUpDownHandler("down",k);break;case h.keyCodes.ARROW_RIGHT:h.easyAccessRightLeftHandler("right",k);break;case h.keyCodes.ARROW_LEFT:h.easyAccessRightLeftHandler("left",k);break;case h.keyCodes.HOME:case h.keyCodes.PAGE_UP:h.easyAccessHomeEndHandler("home",k);break;case h.keyCodes.END:case h.keyCodes.PAGE_DOWN:h.easyAccessHomeEndHandler("end",k);break;}},dashboardKeydownHandler:function(k){var h=sap.ushell.components.flp.ComponentKeysHandler;switch(k.keyCode){case h.keyCodes.F2:h.renameGroup();break;case h.keyCodes.F7:h.groupHeaderNavigation();break;case h.keyCodes.DELETE:h.deleteButtonHandler();break;case h.keyCodes.BACKSPACE:h.deleteButtonHandler();break;case h.keyCodes.ARROW_UP:if(k.ctrlKey===true){h.ctrlPlusArrowKeyButtonsHandler("up");}else{h.arrowsButtonsHandler("up",k);}break;case h.keyCodes.ARROW_DOWN:if(k.ctrlKey===true){h.ctrlPlusArrowKeyButtonsHandler("down");}else{h.arrowsButtonsHandler("down",k);}break;case h.keyCodes.ARROW_RIGHT:if(k.ctrlKey===true){h.ctrlPlusArrowKeyButtonsHandler("right");}else{h.arrowsButtonsHandler("right",k);}break;case h.keyCodes.ARROW_LEFT:if(k.ctrlKey===true){h.ctrlPlusArrowKeyButtonsHandler("left");}else{h.arrowsButtonsHandler("left",k);}break;case h.keyCodes.PAGE_UP:h.goToFirstTileOfSiblingGroup("prev",k);break;case h.keyCodes.PAGE_DOWN:h.goToFirstTileOfSiblingGroup("next",k);break;}return true;},init:function(m,r){this.oModel=m;this.oRouter=r;}};sap.ushell.components.flp.ComponentKeysHandler=new c();}());
