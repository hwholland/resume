(function(){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchText');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchLink');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchLogger');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar');var S=sap.ushell.renderers.fiori2.search.controls.SearchText;var a=sap.ushell.renderers.fiori2.search.controls.SearchLink;var b=sap.ushell.renderers.fiori2.search.SearchHelper;var c=sap.ushell.renderers.fiori2.search.SearchLogger;var e=sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar;var n='\u2013';sap.ui.core.Control.extend("sap.ushell.renderers.fiori2.search.controls.SearchResultListItem",{metadata:{properties:{title:"string",titleUrl:"string",titleUrlIsIntent:"boolean",type:"string",imageUrl:"string",previewButton:"string",data:"object",path:"string",selected:"boolean",expanded:"boolean"},aggregations:{_selectionCheckBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"},_expandButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"}}},init:function(){var t=this;t.setAggregation("_selectionCheckBox",new sap.m.CheckBox({select:function(E){t.setProperty("selected",E.getParameters().selected,true);}}));t.setAggregation("_expandButton",new sap.m.Button({type:sap.m.ButtonType.Transparent,press:function(E){t.toggleDetails();}}));},renderer:function(r,C){C._renderer(r);},_renderer:function(r){this._resetPrecalculatedValues();this._renderContainer(r);},_renderContainer:function(r){var t=this;r.write('<div');r.writeControlData(t);r.addClass("sapUshellSearchResultListItem-Container");r.writeClasses();r.write('>');t._renderContentContainer(r);t._renderExpandButtonContainer(r);r.write('</div>');},_renderContentContainer:function(r){r.write('<div class="sapUshellSearchResultListItem-Content">');this._renderTitleContainer(r);this._renderAttributesContainer(r);r.write('</div>');},_renderExpandButtonContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-ExpandButtonContainer">');r.write('<div class="sapUshellSearchResultListItem-ExpandButton">');var i,d;var f=t.getProperty("expanded");if(f){i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");d=sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip")}else{i=sap.ui.core.IconPool.getIconURI("slim-arrow-down");d=sap.ushell.resources.i18n.getText("showDetailBtn_tooltip")}var g=t.getAggregation("_expandButton");g.setIcon(i);g.setTooltip(d);r.renderControl(g);r.write('</div>');r.write('</div>');},_renderTitleContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-TitleAndImageContainer">');r.write('<div class="sapUshellSearchResultListItem-TitleContainer">');t._renderCheckbox(r);var d=t._titleUrl;t.title=new a({href:d,press:function(){var N=new c.NavigationEvent();N.addUserHistoryEntry(d);var m=sap.ushell.renderers.fiori2.search.getModelSingleton();m.analytics.logCustomEvent('FLP: Search','Launch Object',[d]);}});t.title.setText(t.getTitle());t.title.addStyleClass("sapUshellSearchResultListItem-Title");t.title.addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(d.length==0){t.title.setEnabled(false);}r.renderControl(t.title);var f=new S();f.setText(t.getType());f.addStyleClass("sapUshellSearchResultListItem-Category");f.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(f);r.write('</div>');t._renderImageForPhone(r);r.write('</div>');},_renderCheckbox:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-CheckboxExpandContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxAlignmentContainer">');var d=t.getAggregation("_selectionCheckBox");var s=t.getProperty("selected");d.setSelected(s);r.renderControl(d);r.write('</div>');r.write('</div>');r.write('</div>');},_renderImageForPhone:function(r){var t=this;if(t.getImageUrl()){r.write('<div class="sapUshellSearchResultListItem-TitleImage">');r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');r.write('</div>');}},_renderAttributesContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-AttributesExpandContainer');var d=t.getProperty("expanded");if(d){r.write(" sapUshellSearchResultListItem-AttributesExpanded");}r.write('">');r.write('<div class="sapUshellSearchResultListItem-AttributesAndActions">');r.write('<ul class="sapUshellSearchResultListItem-Attributes">');t._renderImageAttribute(r);var i=t.getData().itemattributes;t._renderAllAttributes(r,i);r.write('<div class="sapUshellSearchResultListItem-ExpandSpacerAttribute" aria-hidden="true"></div>');r.write('</ul>');t._renderRelatedObjectsToolbar(r);r.write('</div>');r.write('</div>');},_renderAllAttributes:function(r,d){var t=this;var f;var l;var v;var g,h;var i=0,j=0;var k=12;if(t.getImageUrl()){k--;}for(;j<k&&i<d.length;i++){f=d[i];if(f.isTableTitle){continue;}l=f.name;v=f.value;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-MainAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(h);r.write('</li>');j++;}var m=false;for(;i<d.length;i++){f=d[i];if(!f.whyfound){continue;}l=f.name;v=f.value;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(h);r.write('</li>');m=true;}if(m){r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundSpacerAttribute" aria-hidden="true"></div>');}},_renderImageAttribute:function(r){var t=this;if(!t.getImageUrl()){return;}r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-ImageAttribute');if(!t.getImageUrl()){r.write(' sapUshellSearchResultListItem-ImageAttributeHidden');}r.write('">');r.write('<div class="sapUshellSearchResultListItem-ImageContainer">');if(t.getImageUrl()){r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');}r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('</div>');r.write('</div>');},_renderRelatedObjectsToolbar:function(r){var t=this;if(!t._intents||t._intents.length==0){return;}t._showExpandButton=true;var d=[];for(var i=0;i<t._intents.length;i++){var f=t._intents[i];d.push({label:f.text,href:f.externalHash,target:f.target});}t.relatedObjectActionsToolbar=new e({relatedObjects:d});t.relatedObjectActionsToolbar.addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar");r.renderControl(t.relatedObjectActionsToolbar);},_getExpandAreaObjectInfo:function(){var t=this;var r=$(t.getDomRef());var d=r.find(".sapUshellSearchResultListItem-AttributesExpandContainer");var f=r.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");var g=false;if(f.css("display")==="none"){f.css("display","block");g=true;}var h=d.height();var i=r.find(".sapUshellSearchResultListItem-AttributesAndActions").height();if(g){f.css("display","");}var j=[];r.find(".sapUshellSearchResultListItem-GenericAttribute").each(function(){var o=$(this);if(o.css("order")>2){j.push(this);}});var k=200;var l=k/10;var m={resultListItem:r,attributesExpandContainer:d,currentHeight:h,expandedHeight:i,elementsToFadeInOrOut:j,expandAnimationDuration:k,fadeInOrOutAnimationDuration:l,relatedObjectsToolbar:f};return m;},isShowingDetails:function(){var d=this._getExpandAreaObjectInfo();if(d.currentHeight<d.expandedHeight){return false;}return true;},showDetails:function(d){var t=this;if(t.isShowingDetails()){return;}var f=this._getExpandAreaObjectInfo();f.relatedObjectsToolbar.css("display","block");if(t.relatedObjectActionsToolbar){t.relatedObjectActionsToolbar._layoutToolbarElements();}f.attributesExpandContainer.animate({"height":f.expandedHeight},f.expandAnimationDuration,function(){$(this).addClass("sapUshellSearchResultListItem-AttributesExpanded");$(this).css("height","");$(f.elementsToFadeInOrOut).css("opacity","");var i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");var g=t.getAggregation("_expandButton");g.setTooltip(sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip"));g.setIcon(i);g.rerender();f.relatedObjectsToolbar.css("display","");t.setProperty("expanded",true,true);});$(f.elementsToFadeInOrOut).animate({"opacity":1},f.fadeInOrOutAnimationDuration);},hideDetails:function(d){var t=this;var r=$(t.getDomRef());if(!t.isShowingDetails()){return;}var f=this._getExpandAreaObjectInfo();var g=r.find(".sapUshellSearchResultListItem-MainAttribute").outerHeight(true)+r.find(".sapUshellSearchResultListItem-ExpandSpacerAttribute").outerHeight(true);var s=false;var h=f.attributesExpandContainer.animate({"height":g},{"duration":f.expandAnimationDuration,"progress":function(i,p,j){if(!s&&j<=f.fadeInOrOutAnimationDuration){s=true;var k=$(f.elementsToFadeInOrOut).animate({"opacity":0},f.fadeInOrOutAnimationDuration).promise();jQuery.when(h,k).done(function(){f.attributesExpandContainer.removeClass("sapUshellSearchResultListItem-AttributesExpanded");$(f.elementsToFadeInOrOut).css("opacity","");var l=sap.ui.core.IconPool.getIconURI("slim-arrow-down");var m=t.getAggregation("_expandButton");m.setTooltip(sap.ushell.resources.i18n.getText("showDetailBtn_tooltip"));m.setIcon(l);m.rerender();t.setProperty("expanded",false,true);});}}}).promise();},toggleDetails:function(d){if(this.isShowingDetails()){this.hideDetails(d);}else{this.showDetails(d);}},isSelectionModeEnabled:function(){var t=this;var i=false;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");if(s){i=s.css("opacity")>0;}return i;},enableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var f=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;var h=false;s.animate({width:"2rem"},{"duration":g,"progress":function(i,p,r){if(!h&&p>0.5){f.css("display","");f.animate({opacity:"1.0"},g/2);h=true;}}});},disableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var f=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;f.animate({opacity:"0.0"},g/2,function(){f.css("display","none");});s.animate({width:"0"},g);},toggleSelectionMode:function(d){if(this.isSelectionModeEnabled()){this.disableSelectionMode(d);}else{this.enableSelectionMode(d);}},onAfterRendering:function(){var t=this;t.showOrHideExpandButton();var p=767;$(t.getDomRef()).bind('click',function(){var w=$(window).width();if(w<=p){var d=t._titleUrl;if(d&&d.length>0){var f=t.getProperty("titleUrlIsIntent");d=encodeURI(d);var g=t.fireNavigate(d,f);g();}}});t.forwardEllipsis($(t.getDomRef()).find(".sapUshellSearchResultListItem-Title, .sapUshellSearchResultListItem-AttributeKey, .sapUshellSearchResultListItem-AttributeValue"));b.attachEventHandlersForTooltip(this.getDomRef());},_resetPrecalculatedValues:function(){this._visibleAttributes=undefined;this._detailsArea=undefined;this._showExpandButton=false;this._titleUrl=this.getTitleUrl();this._intents=this.getData().intents;},showOrHideExpandButton:function(){var t=this;var d=$(t.getDomRef());var f=d.find(".sapUshellSearchResultListItem-ExpandButtonContainer");var i=f.css("visibility")!="hidden";var s=false;var g=d.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");s=g.length>0;if(!s){d.find(".sapUshellSearchResultListItem-MainAttribute,.sapUshellSearchResultListItem-WhyFoundAttribute").each(function(){if($(this).css("order")>2){s=true;return false;}});}if(i&&!s){f.css("visibility","hidden");}else if(!i&&s){f.css("visibility","");}},fireNavigate:function(u,d){return function(){if(u){var N=new c.NavigationEvent();N.addUserHistoryEntry(u);var m=sap.ushell.renderers.fiori2.search.getModelSingleton();m.analytics.logCustomEvent('FLP: Search','Launch Object',[u]);var C=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");if(C&&d){C.toExternal({target:{shellHash:u}});}else{window.location.href=u;}}};},forwardEllipsis:function(o){o.each(function(i,d){b.forwardEllipsis4Whyfound(d);});}});})();
