// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";sap.ui.controller("sap.ushell.renderers.fiori2.launchpad.group_list.GroupList",{onInit:function(){this.sViewId="#"+this.getView().getId();this.sGroupListId="#"+this.getView().oGroupList.getId();this.handleScroll=this._fHandleScroll.bind(this);},onAfterRendering:function(){this.jqView=jQuery(this.sViewId);this.jgGroupList=jQuery(this.sGroupListId);var e=sap.ui.getCore().getEventBus();e.unsubscribe("grouplist","ScrollAnimationEnd",this._handleScrollAnimationEnd,this);e.subscribe("grouplist","ScrollAnimationEnd",this._handleScrollAnimationEnd,this);e.unsubscribe("grouplist","DashboardRerender",this._addScroll,this);e.subscribe("grouplist","DashboardRerender",this._addScroll,this);this._addScroll();},_addScroll:function(){var t=this;setTimeout(function(){this.dashboardElement=document.getElementById('dashboard');if(this.dashboardElement){this.dashboardElement.removeEventListener('scroll',t.handleScroll);this.dashboardElement.addEventListener('scroll',t.handleScroll);}}.bind(this),0);},_fHandleScroll:function(){var j=jQuery('#dashboardGroups').find('.sapUshellTileContainer'),o=j.not('.sapUshellHidden').first().offset(),f=(o&&o.top)||0,c=[],m=this.getView().getModel(),n=0;if(document.getElementById('dashboard')){n=document.getElementById('dashboard').scrollTop;}if(!j||!o){return;}j.each(function(){if(!jQuery(this).hasClass("sapUshellHidden")){var a=jQuery(this).parent().offset().top;c.push([a,a+jQuery(this).parent().height()]);}});if(!m.getProperty("/groupList-skipScrollToGroup")){var w=n+f;jQuery.each(c,function(i,a){if(a[0]<=w&&w<=a[1]){var g=jQuery('#groupList li.sapUshellGroupLI');var s=g.removeClass('sapUshellSelected').eq(i);s.addClass('sapUshellSelected');var b=document.getElementById('groupListPage-cont');var d=b.scrollTop;var e=d+b.offsetHeight;var h=s[0].offsetTop;if(h<d||h+s[0].offsetHeight>e){jQuery('#groupListPage section').animate({scrollTop:g[i].offsetTop},0);}}});}sap.ushell.utils.handleTilesVisibility();},_handleGroupListItemPress:function(e){var s=e.getSource();var f=e.getParameter("action")==="sapenter";this._handleScrollToGroup(s,false,f);},_handleScrollToGroup:function(g,a,f){if(!g){return;}var t=this;document.getElementById('dashboard').removeEventListener('scroll',t.handleScroll);this._publishAsync("launchpad","scrollToGroup",{group:g,groupChanged:a,focus:f});},_handleScrollAnimationEnd:function(){var t=this;document.getElementById('dashboard').addEventListener('scroll',t.handleScroll);},_publishAsync:function(c,e,d){var b=sap.ui.getCore().getEventBus();window.setTimeout($.proxy(b.publish,b,c,e,d),1);}});}());
