// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.renderers.fiori2.Navigation");jQuery.sap.require("sap.ushell.ui.shell.ShellLayout");jQuery.sap.require("sap.ushell.UserActivityLog");jQuery.sap.require("sap.ushell.ui.launchpad.ActionItem");jQuery.sap.require("sap.ushell.ui.launchpad.ViewPortContainer");jQuery.sap.require("sap.ushell.ui.shell.FloatingContainer");jQuery.sap.require("sap.ushell.ui.shell.NavigationMiniTile");jQuery.sap.require("sap.ushell.ui.launchpad.AccessibilityCustomData");sap.ui.jsview("sap.ushell.renderers.fiori2.Shell",{createContent:function(c){var t=this,v=this.getViewData()||{},C=v.config||{},s=(C.appState==="embedded")?true:false,S=(C.appState==="headerless")?true:false,f=function(I,z){return sap.ui.getCore().byId(z.getObject());},l=new sap.ushell.ui.launchpad.LoadingOverlay({id:"loadingDialog"}),o=new sap.ushell.ui.shell.ShellHeadItem({id:"configBtn",tooltip:"{i18n>showGrpsBtn_tooltip}",ariaLabel:"{i18n>showGrpsBtn_tooltip}",icon:sap.ui.core.IconPool.getIconURI("menu2"),selected:{path:"/currentState/showPane"},press:[c.togglePane,c]}),h,V;if(C.enableMergeAppAndShellHeaders===true){var b=sap.ui.getCore().getConfiguration().getRTL()?"feeder-arrow":"nav-back";h=new sap.ushell.ui.shell.ShellHeadItem({id:"homeBtn",tooltip:"{i18n>backBtn_tooltip}",ariaLabel:"{i18n>backBtn_tooltip}",icon:sap.ui.core.IconPool.getIconURI(b),press:c._navBack.bind(c)});}else{h=new sap.ushell.ui.shell.ShellHeadItem({id:"homeBtn",tooltip:"{i18n>homeBtn_tooltip}",ariaLabel:"{i18n>homeBtn_tooltip}",icon:sap.ui.core.IconPool.getIconURI("home"),target:C.rootIntent?"#"+C.rootIntent:"#"});}if(C.enableMeArea){h.setShowSeparator(false);}h.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-disabled",value:"false",writeToDom:true}));h.addEventDelegate({onsapskipback:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}},onsapskipforward:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});o.addEventDelegate({onsapskipforward:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}},onfocusin:function(){sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=true;sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusPassedToExternalHandlerFirstTime=true;}});this.aDanglingControls=[];var a;if(s){new sap.ushell.ui.shell.ShellHeadItem({id:"standardActionsBtn",tooltip:"{i18n>headerActionsTooltip}",icon:sap.ui.core.IconPool.getIconURI("account"),press:[c.pressActionBtn,c]});}else if(!S&&!C.enableMeArea){a=new sap.ushell.ui.shell.ShellHeadUserItem({id:"actionsBtn",username:sap.ushell.Container.getUser().getFullName(),tooltip:"{i18n>headerActionsTooltip}",ariaLabel:sap.ushell.Container.getUser().getFullName(),image:sap.ui.core.IconPool.getIconURI("account"),press:[c.pressActionBtn,c]});a.addEventDelegate({onsaptabnext:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}},onsapskipforward:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});}V=this.initViewPortContainer(c);if(C.enableNotificationsUI===true){var n=new sap.ushell.ui.shell.ShellHeadItem({id:"NotificationsCountButton",tooltip:"{i18n>notificationsBtn_tooltip}",selected:{path:"/currentViewPortState",formatter:function(z){if(z==='RightCenter'){return true;}else{return false;}}},icon:sap.ui.core.IconPool.getIconURI("ui-notifications"),floatingNumber:"{/notificationsCount}",visible:"{/enableNotifications}",press:[c.toggleNotificationsView,c],showSeparator:false});this.aDanglingControls.push(n);}if(C.enableMeArea===true){var m=new sap.ushell.ui.shell.ShellHeadItem({id:"meAreaHeaderButton",tooltip:"{i18n>meAreaBtn_tooltip}",icon:'sap-icon://person-placeholder',selected:{path:"/currentViewPortState",formatter:function(z){if(z==='LeftCenter'){return true;}else{return false;}}},press:[c.toggleMeAreaView,c],visible:true,showSeparator:false});this.aDanglingControls.push(m);var e=new sap.ushell.ui.shell.ShellHeadItem({id:"endItemsOverflowBtn",tooltip:"{i18n>meAreaBtn_tooltip}",icon:"sap-icon://overflow",press:[c.pressEndItemsOverflow,c],visible:true,showSeparator:false});this.aDanglingControls.push(e);}var d=new sap.ushell.ui.shell.SplitContainer({id:'shell-split',showSecondaryContent:{path:"/currentState/showPane"},secondaryContent:{path:"/currentState/paneContent",factory:f},content:V,subHeader:{path:"/currentState/subHeader",factory:f}});var g=new sap.ushell.ui.shell.ToolArea({id:'shell-toolArea',toolAreaItems:{path:"/currentState/toolAreaItems",factory:f}});var r=new sap.ushell.ui.shell.RightFloatingContainer({id:'right-floating-container',top:'10',hideItemsAfterPresentation:true,visible:'{/currentState/showRightFloatingContainer}',floatingContainerItems:{path:"/currentState/RightFloatingContainerItems",factory:f}});var i=new sap.ushell.ui.shell.FloatingContainer({id:'shell-floatingContainer',content:{path:"/currentState/floatingContainerContent",factory:f}});var j=new sap.ushell.ui.shell.ShellTitle("shellTitle",{text:{path:"/title"}});var k;if(C.enableMergeAppAndShellHeaders===true){var H=function(I,z){var A=z.getProperty("icon");var T=z.getProperty("title");var B=z.getProperty("subtitle");var D=z.getProperty("intent");if(!A){A="sap-icon://folder";}return(new sap.m.StandardListItem({type:sap.m.ListType.Active,title:T,description:B,icon:A,customData:[new sap.ui.core.CustomData({key:"intent",value:D})],press:function(E){var L=E.getSource();if(L.getCustomData()&&L.getCustomData().length===1){var G=L.getCustomData()[0].getValue();if(G&&G[0]==="#"){c.navigateFromShellApplicationNavigationMenu(G);}}}})).addStyleClass("sapUshellNavigationMenuListItems");};var R=function(I,z){var A=z.getProperty("icon");var T=z.getProperty("title");var B=z.getProperty("subtitle");var D=z.getProperty("intent");if(!B&&!A){A="sap-icon://documents";}return new sap.ushell.ui.shell.NavigationMiniTile({title:T,subtitle:B,icon:A,intent:D,press:function(){var E=this.getIntent();if(E&&E[0]==='#'){c.navigateFromShellApplicationNavigationMenu(E);}}});};var p=new sap.ushell.ui.shell.ShellNavigationMenu("shellNavigationMenu",{items:{path:"/currentState/application/hierarchy",factory:H.bind(this)},miniTiles:{path:"/currentState/application/relatedApps",factory:R.bind(this)}});this.oShellNavigationMenu=p;k=new sap.ushell.ui.shell.ShellAppTitle({id:"shellAppTitle",text:"{/currentState/application/title}",tooltip:sap.ushell.resources.i18n.getText("shellNavMenu_openMenuTooltip"),navigationMenu:p});k.addEventDelegate({onsapskipforward:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});}var F=new sap.ui.model.Filter('','EQ','a'),q,u,w;F.fnTest=c.isHeadEndItemNotInOverflow.bind(c);q=new sap.ushell.ui.shell.ShellHeader({id:'shell-header',showLogo:{path:"/currentState/showLogo"},headItems:{path:"/currentState/headItems",factory:f},headEndItems:{path:"/currentState/headEndItems",factory:f,filters:[F]},title:j,appTitle:k,showSeparators:!C.enableMeArea});w=new sap.ushell.ui.shell.ShellFloatingActions({id:'shell-floatingActions',floatingActions:{path:"/currentState/floatingActions",factory:f}});u=new sap.ushell.ui.shell.ShellLayout({id:"shell",header:q,toolArea:g,rightFloatingContainer:r,floatingContainerVisible:false,floatingContainer:i,canvasSplitContainer:d,toolAreaVisible:{path:"/currentState/toolAreaVisible"},floatingActionsContainer:w,headerHiding:{path:"/currentState/headerHiding"},headerVisible:{path:"/currentState/headerVisible"},backgroundColorForce:!C.enableMeArea,showBrandLine:!C.enableMeArea,showAnimation:!C.enableMeArea});u._setStrongBackground(true);this.setOUnifiedShell(u);if(a){q.setUser(a);}if(q){var x=q.onAfterRendering;q.onAfterRendering=function(){if(x){x.apply(this,arguments);}if(this.getModel().getProperty("/enableHelp")){jQuery('#actionsBtn').addClass('help-id-actionsBtn');jQuery('#configBtn').addClass('help-id-configBtn');jQuery('#homeBtn').addClass('help-id-homeBtn');}jQuery(".sapUshellHeadTitle").removeAttr("tabindex",0);};}this.oShellPage=this.pageFactory("shellPage",u,true);if(s){q.setLogo(sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif'));}else{this.initShellBarLogo(q);}this.setDisplayBlock(true);this.aDanglingControls=this.aDanglingControls.concat([sap.ui.getCore().byId('viewPortContainer'),this.oShellPage,l,h,o]);u.updateAggregation=this.updateShellAggregation;q.updateAggregation=this.updateShellAggregation;g.updateAggregation=this.updateShellAggregation;r.updateAggregation=this.updateShellAggregation;i.updateAggregation=this.updateShellAggregation;w.updateAggregation=this.updateShellAggregation;d.updateAggregation=this.updateShellAggregation;if(sap.ui.Device.system.desktop){r.removeStyleClass('sapUiSizeCozy');r.addStyleClass('sapUiSizeCompact');}var y=(C.enableSearch!==false);if(y){t.oShellSearchBtn=new sap.ushell.ui.shell.ShellHeadItem({id:"sf",tooltip:"{i18n>searchbox_tooltip}",text:"{i18n>searchBtn}",ariaLabel:"{i18n>searchbox_tooltip}",icon:sap.ui.core.IconPool.getIconURI("search"),visible:true,showSeparator:false,press:function(z){if(!t.searchShellHelper){jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');t.searchShellHelper=sap.ushell.renderers.fiori2.search.SearchShellHelper;}t.searchShellHelper.onShellSearchButtonPressed(z);}});if(C.openSearchAsDefault){if(!t.searchShellHelper){jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');t.searchShellHelper=sap.ushell.renderers.fiori2.search.SearchShellHelper;t.searchShellHelper.init();}t.searchShellHelper.setDefaultOpen(true);t.searchShellHelper.openSearch(false,false);}t.oShellSearchBtn.addEventDelegate({onsapskipforward:function(E){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});t.aDanglingControls.push(t.oShellSearchBtn);}this.logonIFrameReference=null;return new sap.m.App({pages:this.oShellPage});},getOUnifiedShell:function(){return this.oUnifiedShell;},setOUnifiedShell:function(u){this.oUnifiedShell=u;},loadUserImage:function(){var u=sap.ushell.Container.getUser(),i=u.getImage();if(i){this._setUserImage(i);}u.attachOnSetImage(this._setUserImage);},_setUserImage:function(p){var u=typeof(p)==='string'?p:p.mParameters,a=sap.ui.getCore().byId('actionsBtn'),m=sap.ui.getCore().byId('meAreaHeaderButton'),h={'Cache-Control':'no-cache, no-store, must-revalidate','Pragma':'no-cache','Expires':'0'};jQuery.ajax({url:u,headers:h,success:function(){if(a){a.setImage(u);}if(m){m.setIcon(u);}},error:function(){jQuery.sap.log.error("Could not load user image from: "+u,"","sap.ushell.renderers.fiori2.Shell.view");}});},_getIconURI:function(i){var r=null;if(i){var m=/url[\s]*\('?"?([^\'")]*)'?"?\)/.exec(i);if(m){r=m[1];}}return r;},initShellBarLogo:function(s){var v=this.getViewData()||{},c=v.config||{},m=jQuery.sap.getModulePath("sap.ushell");jQuery.sap.require("sap.ui.core.theming.Parameters");var i=sap.ui.core.theming.Parameters.get("sapUiGlobalLogo");if(i){i=this._getIconURI(i);if(!i){if(c.enableMergeAppAndShellHeaders===true){s.setLogo(m+'/themes/base/img/sap_55x27.png');}else{s.setLogo(sap.ui.resource("sap.ui.core","mimes/logo/sap_50x26.png"));}}}var t=this;sap.ui.getCore().attachThemeChanged(function(){if(s.bIsDestroyed){return;}var n=sap.ui.core.theming.Parameters.get("sapUiGlobalLogo");if(n){n=t._getIconURI(n);if(n){s.setLogo(n);}else{if(c.enableMergeAppAndShellHeaders===true){s.setLogo(m+'/themes/base/img/sap_55x27.png');}else{s.setLogo(sap.ui.resource("sap.ui.core","mimes/logo/sap_50x26.png"));}}}else{if(c.enableMergeAppAndShellHeaders===true){s.setLogo(m+'/themes/base/img/sap_55x27.png');}else{s.setLogo(sap.ui.resource("sap.ui.core","mimes/logo/sap_50x26.png"));}}});},initViewPortContainer:function(c){var v=new sap.ushell.ui.launchpad.ViewPortContainer({id:"viewPortContainer",defaultState:sap.ushell.ui.launchpad.ViewPortState.Center,afterNavigate:jQuery.proxy(c.onAfterNavigate,c),afterSwitchState:jQuery.proxy(c.onAfterViewPortSwitchState,c)});return v;},updateShellAggregation:function(n){var b=this.mBindingInfos[n],a=this.getMetadata().getJSONKeys()[n],c;jQuery.each(this[a._sGetter](),jQuery.proxy(function(i,v){this[a._sRemoveMutator](v);},this));jQuery.each(b.binding.getContexts(),jQuery.proxy(function(i,v){c=b.factory(this.getId()+"-"+i,v)?b.factory(this.getId()+"-"+i,v).setBindingContext(v,b.model):"";this[a._sMutator](c);},this));},disableBouncing:function(p){p.onBeforeRendering=function(){sap.m.Page.prototype.onBeforeRendering.apply(p);var s=this._oScroller,o=s.onAfterRendering;s.onAfterRendering=function(){o.apply(s);if(s._scroller){s._scroller.options.bounce=false;}};};return p;},getControllerName:function(){return"sap.ushell.renderers.fiori2.Shell";},pageFactory:function(i,c,d){var p=new sap.m.Page({id:i,showHeader:false,content:c,enableScrolling:!!sap.ui.Device.system.desktop}),e=["onAfterHide","onAfterShow","onBeforeFirstShow","onBeforeHide","onBeforeShow"],D={};jQuery.each(e,function(I,E){D[E]=jQuery.proxy(function(a){jQuery.each(this.getContent(),function(I,c){c._handleEvent(a);});},p);});p.addEventDelegate(D);if(d&&sap.ui.Device.system.desktop){this.disableBouncing(p);}return p;},createIFrameDialog:function(){var d=null,l=this.logonIFrameReference,c;var _=function(){if(l){l.remove();}return jQuery('<iframe id="SAMLDialogFrame" src="" frameborder="0" height="100%" width="100%"></iframe>');};var a=function(){d.addStyleClass('sapUshellSamlDialogHidden');jQuery('#sap-ui-blocklayer-popup').addClass('sapUshellSamlDialogHidden');};this.destroyIFrameDialog();var b=new sap.m.Button({text:sap.ushell.resources.i18n.getText("samlCloseBtn"),press:function(){sap.ushell.Container.cancelLogon();}});var h=new sap.ui.core.HTML("SAMLDialogFrame");this.logonIFrameReference=_();h.setContent(this.logonIFrameReference.prop('outerHTML'));d=new sap.m.Dialog({id:"SAMLDialog",title:sap.ushell.resources.i18n.getText("samlDialogTitle"),contentWidth:"50%",contentHeight:"50%",rightButton:b}).addStyleClass("sapUshellIframeDialog");c=sap.ushell.Container.getService("SupportTicket").isEnabled();if(c){jQuery.sap.require("sap.ushell.ui.footerbar.ContactSupportButton");var C=new sap.ushell.ui.footerbar.ContactSupportButton();C.setWidth('150px');C.setIcon('');d.setLeftButton(C);}d.addContent(h);d.open();a();this.logonIFrameReference=jQuery('#SAMLDialogFrame');return this.logonIFrameReference[0];},destroyIFrameDialog:function(){var d=sap.ui.getCore().byId('SAMLDialog');if(d){d.destroy();}this.logonIFrameReference=null;},showIFrameDialog:function(){var d=sap.ui.getCore().byId('SAMLDialog');if(d){d.removeStyleClass('sapUshellSamlDialogHidden');jQuery('#sap-ui-blocklayer-popup').removeClass('sapUshellSamlDialogHidden');}}});}());
