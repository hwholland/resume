// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.renderers.fiori2.AccessKeysHandler");var a=function(){};a.prototype={keyCodes:jQuery.sap.KeyCodes,bFocusOnShell:true,bFocusPassedToExternalHandlerFirstTime:true,isFocusHandledByAnotherHandler:false,fnExternalKeysHandler:null,sLastExternalKeysHandlerUrl:null,fnExternalShortcuts:null,isleftAltPressed:false,appOpenedHandler:function(){var c=hasher.getHash();if(c!==this.sLastExternalKeysHandlerUrl){this.fnExternalKeysHandler=null;}this.sLastExternalKeysHandlerUrl=c;},handleSearchKey:function(){var s=sap.ui.getCore().byId('sf');if(s&&$('#sf:visible').length===0){return;}jQuery(s).click();},handleUserMenuKey:function(){var u=sap.ui.getCore().byId('userPreferencesButton'),s=sap.ui.getCore().byId("mainShell").oController;if(!u){u=new sap.ushell.ui.footerbar.UserPreferencesButton("userPreferencesButton");u.setModel(s.getModel());s._setUserPrefModel();}u.showUserPreferencesDialog();},handleAccessOverviewKey:function(){var t=sap.ushell.resources.i18n,i=this.oModel.getProperty("/searchAvailable"),c=[];this.aShortcutsDescriptions.forEach(function(v){c.push(new sap.m.Label({text:v.text}));c.push(new sap.m.Text({text:v.description}));});if(i){c.push(new sap.m.Label({text:"Alt+S"}));c.push(new sap.m.Text({text:t.getText("actionSearch")}));}c.push(new sap.m.Label({text:"Alt+U"}));c.push(new sap.m.Text({text:t.getText("actionLoginDetails")}));var s=new sap.ui.layout.form.SimpleForm({editable:false,content:c}),d,o=new sap.m.Button({text:t.getText("okBtn"),press:function(){d.close();}});d=new sap.m.Dialog({id:"hotKeysGlossary",title:t.getText("hotKeysGlossary"),contentWidth:"29.6rem",leftButton:o,afterClose:function(){d.destroy();}});d.addContent(s);d.open();},handleShortcuts:function(e){if(e.altKey){switch(String.fromCharCode(e.keyCode)){case'S':this.handleSearchKey();break;case'U':this.handleUserMenuKey();break;case'0':this.handleAccessOverviewKey();break;}}},registerAppKeysHandler:function(h){this.fnExternalKeysHandler=h;this.sLastExternalKeysHandlerUrl=hasher.getHash();},resetAppKeysHandler:function(){this.fnExternalKeysHandler=null;},getAppKeysHandler:function(){return this.fnExternalKeysHandler;},registerAppShortcuts:function(h,s){this.fnExternalShortcuts=h;this.aShortcutsDescriptions=s;},handleFocusBackToMe:function(e){if(typeof e=="string"){if(jQuery("#shellAppTitle").length>0){jQuery("#shellAppTitle").focus();}else{jQuery('body').focus();}}else if(e){e.preventDefault();this.bFocusOnShell=true;if(e.shiftKey){if(e.keyCode===jQuery.sap.KeyCodes.TAB){jQuery("#actionsBtn").focus();}else if(e.keyCode===jQuery.sap.KeyCodes.F6){jQuery("#shellAppTitle").focus();}}else{jQuery("#floatingActionBtn").focus();}this.bFocusPassedToExternalHandlerFirstTime=true;}else{var E=jQuery("#homeBtn");if(E.length!==0){E.focus();}}},setIsFocusHandledByAnotherHandler:function(h){this.isFocusHandledByAnotherHandler=h;},sendFocusBackToShell:function(e){this.handleFocusBackToMe(e);},init:function(m){this.oModel=m;sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",this.sendFocusBackToShell,this);jQuery(document).on('keydown',function(e){if(!this.bFocusOnShell&&!this.isFocusHandledByAnotherHandler){if(this.fnExternalKeysHandler&&jQuery.isFunction(this.fnExternalKeysHandler)){this.fnExternalKeysHandler(e,this.bFocusPassedToExternalHandlerFirstTime);this.bFocusPassedToExternalHandlerFirstTime=false;}}if(e.keyCode===18){if(e.originalEvent.location===window.KeyboardEvent.DOM_KEY_LOCATION_LEFT){this.isleftAltPressed=true;}else{this.isleftAltPressed=false;}}if(this.isleftAltPressed){this.handleShortcuts(e);if(this.fnExternalShortcuts){this.fnExternalShortcuts(e);}}this.setIsFocusHandledByAnotherHandler(false);}.bind(this));}};sap.ushell.renderers.fiori2.AccessKeysHandler=new a();sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",a.prototype.appOpenedHandler.bind(sap.ushell.renderers.fiori2.AccessKeysHandler));}());
