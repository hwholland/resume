/*
 * sap-ina-sina - SAP HANA Simple Info Access API
 * version 2.1.24 - 2016-04-13

 * Copyright (c) 2016 SAP SE; All rights reserved
 */
/*
 * @file Simple info access (SINA) API: datasource Interface
 * @namespace sap.bc.ina.api.sina.base.datasource
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";if(g!==null){g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.sina=g.sap.bc.ina.api.sina||{};g.sap.bc.ina.api.sina.expandPackage=function(g,p){var s=p.split('.');var w=g;for(var i=0;i<s.length;i++){if(typeof w[s[i]]==='undefined'){w[s[i]]={};}w=w[s[i]];}};}}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.base.datasource');var m=g.sap.bc.ina.api.sina.base.datasource;m.DataSource=function(){this.init.apply(this,arguments);};m.DataSourceMetaData=function(){this.init.apply(this,arguments);};m.DataSourceMetaData.prototype={init:function(){}};m.DataSourceType={CATEGORY:"Category",BUSINESSOBJECT:"BusinessObject"};m.DataSourceType.DEFAULT=m.DataSourceType.CATEGORY;m.DataSource.prototype={init:function(p){p=p||{};this.type=p.type||m.DataSourceType.DEFAULT;this.name=p.name||'';this.label=p.label||p.name;this.labelPlural=p.labelPlural||p.label;this.key='';this._constructKey();},equals:function(o){if(this.key!==o.key){return false;}return true;},clone:function(){},getMetaData:function(){},getMetaDataSync:function(){if(this.equals(this.sina.getRootDataSource())){return null;}return this.sina.getBusinessObjectMetaDataSync(this);},getType:function(){return this.type;},setType:function(t){this.type=t;},getLabel:function(){return this.label;},getLabelPlural:function(){return this.labelPlural;},getIdentifier:function(){},_constructKey:function(){this.key=this.type+'/'+this.name;},getJson:function(){return{'type':this.type,'name':this.name,'label':this.label,'labelPlural':this.labelPlural};},setJson:function(j){this.type=j.type||'';this.name=j.name||'';this.label=j.label||'';this.labelPlural=j.labelPlural||'';this._constructKey();}};}(window));
/*
 * @file Simple info access (SINA) API: Filter Interface
 * @namespace sap.bc.ina.api.sina.base.filter
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.helper');var m=g.sap.bc.ina.api.sina.helper;m.removeHtmlTags=function(t){var d=document.createElement('div');d.innerHTML=t;return d.textContent||d.innerText||'';};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.base.filter');var m=g.sap.bc.ina.api.sina.base.filter;m.Filter=function(){this.init.apply(this,arguments);};m.Condition=function(){this.init.apply(this,arguments);};m.ConditionGroup=function(){this.init.apply(this,arguments);};m.Filter.prototype={init:function(p){p=p||{};this.sina=p.sina;this.setDataSource(p.dataSource);this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:"DefaultRoot",operator:'And'});this.searchTerms=p.searchTerms||"";},_findAttributeOfCondition:function(c){if(c instanceof m.Condition){return{attribute:c.attribute,attributeLabel:c.attributeLabel};}return this._findAttributeOfCondition(c.conditions[0]);},_findAttributeLabelOfGroup:function(f){if(!f||!f.conditions){return"";}for(var i=0;i<f.conditions.length;i++){var a=f.conditions[i];if(a instanceof m.Condition){return a.attributeLabel;}else if(a instanceof m.ConditionGroup){return this._findAttributeLabelOfGroup(a);}}},addFilterCondition:function(a,o,v,b,c){var f;var l;if(jQuery.type(a)==='object'){if(a instanceof m.Condition){f=a;l=f.attribute;}else if(a instanceof m.ConditionGroup){f=a;l=this._findAttributeOfCondition(f).attribute;}else{var p=a;if(p.conditions){f=this.sina.createFilterConditionGroup(p);l=this._findAttributeOfGroup(f);}else{f=this.sina.createFilterCondition(p.attribute,p.operator,p.value,p.attributeLabel,p.valueLabel);l=p.attribute;}}}else{if(a===undefined||o===undefined||v===undefined){return this;}f=this.sina.createFilterCondition(a,o,v,b,c);l=f.attribute;}if(this.defaultConditionGroup.hasCondition(f)){return this;}if(this.conditionGroupsByAttribute[l]===undefined){this.conditionGroupsByAttribute[l]=this.sina.createFilterConditionGroup({operator:'OR',label:this._findAttributeOfCondition(f).attributeLabel||""});this.defaultConditionGroup.addCondition(this.conditionGroupsByAttribute[l]);}this.conditionGroupsByAttribute[l].addCondition(f);return this;},setDefaultConditionGroup:function(d){this.defaultConditionGroup=d;this._initConditionGroupsByAttribute();},_initConditionGroupsByAttribute:function(){this.conditionGroupsByAttribute={};var c=this.defaultConditionGroup.getConditions();for(var i=0;i<c.length;++i){var a=c[i];var b=this._findAttributeOfCondition(a).attribute;this.conditionGroupsByAttribute[b]=a;}},empty:function(){this.resetFilterConditions();this.searchTerms='';return this;},hasFilterCondition:function(a,o,v){if(typeof a==="string"){a=this.sina.createFilterCondition(a,o,v);}return this.defaultConditionGroup.hasCondition(a);},resetFilterConditions:function(){this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:'DefaultRoot',operator:'And',sina:this.sina});return this;},removeFilterCondition:function(a,o,v,b,c){var f;var l;if(jQuery.type(a)==='object'){if(a instanceof m.Condition){f=a;l=f.attribute;}else if(a instanceof m.ConditionGroup){f=a;l=this._findAttributeOfCondition(f).attribute;}else{var p=a;f=this.sina.createFilterCondition(p.attribute,p.operator,p.value,p.attributeLabel,p.valueLabel);l=p.attribute;}}else{if(a===undefined||o===undefined||v===undefined){return this;}f=this.sina.createFilterCondition(a,o,v,b,c);l=f.attribute;}this.defaultConditionGroup.removeCondition(f);var d=this.conditionGroupsByAttribute[l];if(d){d.removeCondition(f);if(d.conditions.length===0){delete this.conditionGroupsByAttribute[l];this.defaultConditionGroup.removeCondition(d);}}return this;},addFilterConditionGroup:function(c){this.addFilterCondition(c);},getFilterConditions:function(){return this.defaultConditionGroup;},getSearchTerms:function(){return this.searchTerms;},removeFilterConditionGroup:function(c){this.defaultConditionGroup.removeCondition(c);var a=c.conditions[0].attribute;if(this.conditionGroupsByAttribute[a]){this.conditionGroupsByAttribute[a].removeCondition(c);if(this.conditionGroupsByAttribute[a].conditions.length===0){delete this.conditionGroupsByAttribute[a];}}},setSearchTerms:function(s){this.searchTerms=s||"";},getDataSource:function(){return this.dataSource;},setDataSource:function(d){if(this.dataSource&&!this.dataSource.equals(d)){this.resetFilterConditions();}this.dataSource=d;},getJson:function(){return{dataSource:this.dataSource.getJson(),defaultConditionGroup:this.defaultConditionGroup.getJson(),searchTerms:this.searchTerms};},setJson:function(j){var d;this.empty();if(j.dataSource){var a=this.sina.createDataSource();a.setJson(j.dataSource);this.setDataSource(a);}this.setSearchTerms(j.searchTerms);if(jQuery.isPlainObject(j.defaultConditionGroup)){d=this.sina.createFilterConditionGroup(j.defaultConditionGroup);}if(d){this.setDefaultConditionGroup(d);}},clone:function(){var n=this.sina.createFilter();n.dataSource=this.dataSource;n.searchTerms=this.searchTerms;n.conditionGroupsByAttribute={};if(this.defaultConditionGroup&&this.defaultConditionGroup.clone){n.defaultConditionGroup=this.defaultConditionGroup.clone();for(var i=0;i<n.defaultConditionGroup.conditions.length;i++){var s=n.defaultConditionGroup.conditions[i];var a=this._getAttributeName(s);n.conditionGroupsByAttribute[a]=s;}}return n;},_getAttributeName:function(c){if(c.attribute){return c.attribute;}else{var s=c.conditions[0];return this._getAttributeName(s);}},equals:function(o){if(!(o instanceof m.Filter)){return false;}if(this.dataSource&&o.dataSource){if(!this.dataSource.equals(o.dataSource)){return false;}}else if(!this.dataSource&&o.dataSource){return false;}else if(this.dataSource&&!o.dataSource){return false;}if(this.searchTerms!==o.searchTerms){return false;}if(!this.defaultConditionGroup.equals(o.defaultConditionGroup)){return false;}return true;}};m.Condition.prototype={init:function(a,o,v,s,b,c,l){if(jQuery.type(a)==='object'){var p=a;a=p.attribute;o=p.operator;v=p.value;s=p.sina;b=p.attributeLabel;c=p.valueLabel;l=p.label;}this.attribute=a||"";this.operator=o||"=";this.value=v;this.sina=s;this.attributeLabel=b||"";this.valueLabel=c||"";this.label=l||"";},equals:function(o){if(!(o instanceof m.Condition)){return false;}return this.attribute===o.attribute&&this.operator===o.operator&&this.value===o.value;},toString:function(){return this.attributeLabel+this.operator+this.valueLabel+'';},getJson:function(){return{attribute:this.attribute,value:this.value,operator:this.operator,attributeLabel:this.attributeLabel,valueLabel:this.valueLabel,label:this.label};},setJson:function(j){if(!j.attribute||!j.value||!j.operator){throw'Following filter condition JSON does not have all necessary properties(attribute, value, operator): '+JSON.stringify(j);}this.attribute=j.attribute;this.value=j.value;this.operator=j.operator;this.attributeLabel=j.attributeLabel;this.valueLabel=j.valueLabel;this.label=j.label;},clone:function(){var n=this.sina.createFilterCondition();n.operator=this.operator;n.attribute=this.attribute;n.value=this.value;n.attributeLabel=this.attributeLabel;n.valueLabel=this.valueLabel;n.label=this.label;return n;}};m.ConditionGroup.prototype={init:function(p){p=p||{};this.label=p.label||'';this.setOperator(p.operator||'And');this.sina=p.sina;this.conditions=p.conditions||[];for(var i=0;i<this.conditions.length;i++){var f=this.conditions[i];if(jQuery.isPlainObject(f)){if(f.conditions){this.conditions[i]=this.sina.createFilterConditionGroup(f);}else{this.conditions[i]=this.sina.createFilterCondition(f);}}}},addCondition:function(c){if(c instanceof m.ConditionGroup||c instanceof m.Condition){this.conditions.push(c);return this;}throw"Condition of type "+typeof c+" can not be added to a filterConditionGroup";},equals:function(o){if(!(o instanceof m.ConditionGroup)){return false;}if(this.conditions.length!==o.conditions.length){return false;}for(var i=0,l=this.conditions.length;i<l;i++){var c=this.conditions[i];var a=false;for(var j=0,b=o.conditions.length;j<b;j++){var d=o.conditions[j];if(c.equals(d)){a=true;break;}}if(!a){return false;}}if(this.label!==o.label){return false;}return true;},getConditions:function(){return this.conditions;},getConditionsAsArray:function(a,c){c=c||[];a=a||this;for(var i=0;i<a.conditions.length;i++){if(a.conditions[i]instanceof m.ConditionGroup){this.getConditionsAsArray(a.conditions[i],c);}else{c.push(a.conditions[i]);}}return c;},hasCondition:function(c){for(var i=0,l=this.conditions.length;i<l;i++){var a=this.conditions[i];if(a instanceof m.ConditionGroup){if(c instanceof m.ConditionGroup){if(a.equals(c)){return true;}}else if(c instanceof m.Condition){if(a.hasCondition(c)){return true;}}}else if(a instanceof m.Condition){if(c instanceof m.ConditionGroup){if(c.hasCondition(a)){return true;}}else if(c instanceof m.Condition){if(a.equals(c)){return true;}}}}return false;},removeCondition:function(c){var a;for(var i=0,l=this.conditions.length;i<l;i++){a=this.conditions[i];if(a instanceof m.ConditionGroup){if(c instanceof m.ConditionGroup){if(a.equals(c)){this.conditions.splice(i,1);}}else if(c instanceof m.Condition){a.removeCondition(c);}}else if(a instanceof m.Condition){if(c instanceof m.ConditionGroup){c.removeCondition(a);}else if(c instanceof m.Condition){if(a.equals(c)){this.conditions.splice(i,1);}}}}for(var j=0,b=this.conditions.length;j<b;j++){a=this.conditions[j];if(a instanceof m.ConditionGroup&&a.conditions.length===0){this.conditions.splice(j,1);}}return this;},setLabel:function(l){this.label=l;return this;},setOperator:function(o){switch(o.toLowerCase()){case'or':o='Or';break;case'and':o='And';break;default:throw{message:'unknown operator for condition group: '+o};}this.operator=o;return this;},toString:function(){return this.label;},getJson:function(){return{operator:this.operator,label:this.label,conditions:jQuery.map(this.conditions,function(c){return c.getJson();})};},setJson:function(j){this.operator=j.operator;this.label=j.label||"";var a=j.conditions;for(var i=0;i<a.length;i++){var b=a[i];var c=null;if(b.attribute){c=this.sina.createFilterCondition();}else if(jQuery.isArray(b.conditions)&&b.conditions.length>0){c=this.sina.createFilterConditionGroup();}else{throw'Following filter condition group JSON has neither attribute nor sub conditions:'+JSON.stringify(b);}c.setJson(b);this.conditions.push(c);}},clone:function(){var n=this.sina.createFilterConditionGroup();n.operator=this.operator;n.label=this.label;n.sina=this.sina;n.conditions=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];n.conditions.push(c.clone());}return n;}};}(window));
/*
 * @file The Simple Information Access (SINA) Interface
 * @namespace sap.bc.ina.api.sina.base
 * @requires jQuery
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.base');var m=g.sap.bc.ina.api.sina.base;jQuery.extend(m,{provider:{},registerProvider:function(p){this.provider[p.impl_type]=p;}});m.Sina=function(){this.init.apply(this,arguments);};m.Sina.prototype={init:function(){},_initQueryProperties:function(p){p=p||{};p.sina=this;p.system=p.system||this.getSystem();if(p.dataSource){p.dataSource=this.createDataSource(p.dataSource);}return p;},createChartQuery:function(p){p=this._initQueryProperties(p);return new this._provider.chartQuery(p);},createSearchQuery:function(p){p=this._initQueryProperties(p);return new this._provider.searchQuery(p);},createGroupBarChartQuery:function(p){p=this._initQueryProperties(p);return new this._provider.groupBarChartQuery(p);},createLineChartQuery:function(p){p=this._initQueryProperties(p);p.dimensions=[p.dimensionLine,p.dimensionX];p.measures=[{name:p.measureY.name,aggregationFunction:p.measureY.aggregationFunction}];return new this._provider.lineChartQuery(p);},createSuggestionQuery:function(p){p=this._initQueryProperties(p);return new this._provider.suggestionQuery(p);},createPerspectiveQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveQuery(p);},createPerspectiveSearchQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveSearchQuery(p);},createPerspectiveGetQuery:function(p){p=this._initQueryProperties(p);return new this._provider.perspectiveGetQuery(p);},sinaSystem:function(s){if(s){this.sys=s;}else{return this.sys;}return{};},getSystem:function(){if(this.sys){return this.sys;}return{};},setSystem:function(s){this.sys=s;},createFacet:function(p){p.sina=this;return new this._provider.Facet(p);},ChartQueryType:{ATTRIBUTE:'attribute',DATASOURCE:'datasource'},FacetType:{ATTRIBUTE:'attribute',DATASOURCE:'datasource',SEARCH:'searchresult'},ResultElementKeyStatus:{OK:'ok',NO_KEY:'no_key',NO_VALUE:'no_value'},SuggestionType:{HISTORY:'history',DATASOURCE:'datasource',OBJECTDATA:'objectdata'},createFilter:function(p){p=p||{};p.sina=this;return new this._provider.Filter(p);},createFilterCondition:function(a,o,v,b,c,l){a=a||{};var p;if(typeof a==='object'){p=a;p.sina=this;}else{p={attribute:a,operator:o,value:v,sina:this,attributeLabel:b,valueLabel:c,label:l};}if(p&&p.conditions){return new this._provider.FilterConditionGroup(p);}return new this._provider.FilterCondition(p);},createFilterConditionGroup:function(p){p=p||{};p.sina=this;return new this._provider.FilterConditionGroup(p);},createDataSource:function(p){var o={};if(p){o=p;}o.sina=o.sina||this;return new this._provider.DataSource(o);},createDataSourceQuery:function(p){p=this._initQueryProperties(p);return new this._provider.DataSourceQuery(p);},getRootDataSource:function(){return this._provider.getRootDataSource();},getSearchConfiguration:function(p){p=this._initQueryProperties(p);return new this._provider.searchConfiguration(p);},addUserHistoryEntry:function(e){var p=this._initQueryProperties(p);p.oEntry=e;return this._provider.addUserHistoryEntry(p);},emptyUserHistory:function(){var p=this._initQueryProperties(p);return this._provider.emptyUserHistory(p);},getDataSources:function(p){return this._provider.metaDataService.getDataSources(p);},getDataSourcesSync:function(p){return this._provider.metaDataService.getDataSourcesSync(p);},getDataSource:function(d){return this._provider.metaDataService.getDataSource(d);},getDataSourceByBusinessObjectName:function(b){return this._provider.metaDataService.getDataSourceByBusinessObjectName(b);},getDataSourceSync:function(d){return this._provider.metaDataService.getDataSourceSync(d);},getDataSourceSyncByBusinessObjectName:function(b){return this._provider.metaDataService.getDataSourceSyncByBusinessObjectName(b);},getBusinessObjectsMetaData:function(){return this._provider.metaDataService.getBusinessObjectsMetaData();},getBusinessObjectsMetaDataSync:function(){return this._provider.metaDataService.getBusinessObjectsMetaDataSync();},getBusinessObjectMetaData:function(d){return this._provider.metaDataService.getBusinessObjectMetaData(d);},getBusinessObjectMetaDataByBusinessObjectName:function(b){return this._provider.metaDataService.getBusinessObjectMetaDataByBusinessObjectName(b);},getBusinessObjectMetaDataSync:function(d){return this._provider.metaDataService.getBusinessObjectMetaDataSync(d);},getBusinessObjectMetaDataSyncByBusinessObjectName:function(b){return this._provider.metaDataService.getBusinessObjectMetaDataSyncByBusinessObjectName(b);},setBusinessObjectMetaDataSync:function(d,a){return this._provider.metaDataService.setBusinessObjectMetaDataSync(d,a);}};m.SinaError=function(){this.init.apply(this,arguments);};m.SinaError.SEVERITY_ERROR=3;m.SinaError.SEVERITY_WARNING=2;m.SinaError.SEVERITY_INFO=1;m.SinaError.prototype={init:function(p){this.message=p.message||'';this.errorCode=p.errorCode||null;this.severity=p.severity||m.SinaError.SEVERITY_ERROR;},getErrorCode:function(){return this.errorCode;},getMessage:function(){return this.message;},getSeverity:function(){return this.severity;},setSeverity:function(s){this.severity=s;},toString:function(){var a="";switch(this.severity){case m.SinaError.SEVERITY_ERROR:a+="SINA ERROR: ";break;case m.SinaError.SEVERITY_WARNING:a+="SINA WARNING: ";break;case m.SinaError.SEVERITY_INFO:a+="SINA INFO: ";break;}a+=this.message;return a;}};}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;var e=function(){};m.Query=function(){this.init.apply(this,arguments);};m.Query.prototype={init:function(p){p=p||{};this.sina=p.sina;this.system=p.system;this.onSuccess=p.onSuccess;this.onError=p.onError;this._responseJson=null;this.setTop(p.top||10);this.setSkip(p.skip||0);this.resultSetProperties=p;this.filter=this.filter||p.filter||this.sina.createFilter({dataSource:p.dataSource});this.datasource=this.datasource||p.dataSource;if(p.filterConditions&&p.filterConditions.length>0){for(var i=0,l=p.filterConditions.length;i<l;i++){var a=p.filterConditions[i];if(a&&a instanceof Array&&a.length>0){this.addFilterCondition(a[0],a[1],a[2]);}else if(a&&typeof a==='string'){this.addFilterCondition(p.filterConditions[0],p.filterConditions[1],p.filterConditions[2]);break;}}}this.setSearchTerms(p.searchTerms||'');},dataSource:function(n){if(n){this.setDataSource(n);return this;}else{return this.getDataSource();}},getDataSource:function(){return this.filter.getDataSource();},setDataSource:function(d){if(d===undefined){return this;}if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},setFacetOptions:function(o){this._resetResultSet();this.facetOptions=o;},getFacetOptions:function(){return this.facetOptions;},getFilter:function(){return this.filter;},setFilter:function(f){if(!this.filter.equals(f)){this._resetResultSet();}this.filter=f;return this;},setSearchTerms:function(t){if(this.filter.getSearchTerms()!==t){this.filter.setSearchTerms(t);this._resetResultSet();}return this;},getSearchTerms:function(){return this.filter.getSearchTerms();},skip:function(n){if(n!==undefined){this.setSkip(n);}else{return this._skip;}return this;},getSkip:function(){return this._skip;},setSkip:function(s){if(this._skip!==s){this._resetResultSet();}this._skip=s;return this;},top:function(n){if(n!==undefined){this.setTop(n);}else{return this._top;}return this;},getTop:function(){return this._top;},setTop:function(t){if(isNaN(t)){return false;}this._top=parseInt(this._top,10);if(this._top!==t){this._top=t;this._resetResultSet();}return this;},addFilterCondition:function(a,o,v){if(typeof a==="string"){a=this.sina.createFilterCondition(a,o,v);}if(this.filter.hasFilterCondition(a,o,v)===false){this.filter.addFilterCondition(a,o,v);this._resetResultSet();}return this;},removeFilterCondition:function(a,o,v){this.filter.removeFilterCondition(a,o,v);this._resetResultSet();return this;},resetFilterConditions:function(){this.filter.resetFilterConditions();this._resetResultSet();return this;},getResultSetSync:function(){this.resultSet=this.executeSync();return this.resultSet;},getResultSet:function(o,a){var t=this;o=o||this.onSuccess||e;a=a||this.onError||e;var r=this.execute();r.done(function(b){t.resultSet=b;o(b);});r.fail(function(b){a(b);});return r.promise();},_resetResultSet:function(){},resetResultSet:function(){this._resetResultSet();},execute:function(){},executeSync:function(){}};}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;m.ChartQuery=function(){this.init.apply(this,arguments);};m.ChartQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments);}});}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;m.FacetType=m.Sina.prototype.FacetType;m.SuggestionType=m.Sina.prototype.SuggestionType;m.ChartQueryType=m.Sina.prototype.ChartQueryType;m.Facet=function(){this.init.apply(this,arguments);};m.Facet.prototype={init:function(p){p=p||{};this.sina=p.sina;this.dataSource=p.dataSource||null;this.title=p.title||'';this.query=p.query||null;this.dimension=p.dimension||null;p.facetType=p.facetType||'';this.facetType=p.facetType.toLowerCase();if(p.query){this.setQuery(p.query);}},getChartType:function(){},getTitle:function(){return this.title;},getDimension:function(){return this.dimension;},getQuery:function(){return this.query;},getLayout:function(){},getLayoutBinding:function(){},getColorPalette:function(){},setQuery:function(q){this.query=q;}};}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;var f=g.sap.bc.ina.api.sina.base.filter;var b=g.sap.bc.ina.api.sina.base;m.Perspective=function(){this.init.apply(this,arguments);};m.Perspective.prototype={init:function(p){var t=this;t.sina=p.sina;t.chartFacets=[];t.searchFacet=null;t.layout=null;t.dataSource=p.dataSource||null;p=p||{};},getSearchResultSet:function(){return this.searchFacet.getQuery().getResultSetSync();},getChartFacets:function(){return this.chartFacets;},getSearchFacet:function(){return this.searchFacet;},getLayout:function(){return this.layout;}};m.PerspectiveQuery=function(){this.init.apply(this,arguments);};m.PerspectiveQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments);this.facets=[];this.requestedEntities=['SearchResults','Facets','TotalCount'];this.facetLoader=new m.FacetLoader({sina:this.sina});this.includeFacetsWithFilters=false;},addFacet:function(a){this.facets.push(a);return this;},getFacets:function(){return this.facets;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};return this;},getOrderBy:function(){return this.orderBy;},setRequestedEntities:function(r){if(JSON.stringify(r)===JSON.stringify(this.requestedEntities)){return;}this.requestedEntities=r;this._resetResultSet();},getRequestedEntities:function(){return this.requestedEntities;},setIncludeFacetsWithFilters:function(i){if(i===this.includeFacetsWithFilters){return;}this.includeFacetsWithFilters=i;this._resetResultSet();},_resetResultSet:function(){this.resultSetAndFacetsPromise=null;},getResultSet:function(o,a){var t=this;if(!this.includeFacetsWithFilters){return m.Query.prototype.getResultSet.apply(this,arguments);}if(t.resultSetAndFacetsPromise){if(o){t.resultSetAndFacetsPromise.done(o);}if(a){t.resultSetAndFacetsPromise.fail(a);}return t.resultSetAndFacetsPromise;}var p=m.Query.prototype.getResultSet.apply(this,[]);var c=this.facetLoader.loadFacets(this.filter);t.resultSetAndFacetsPromise=jQuery.when(p,c).then(function(d,e){t.addFacetsToPerspective(d,e);return d;});if(o){t.resultSetAndFacetsPromise.done(o);}if(a){t.resultSetAndFacetsPromise.fail(a);}return t.resultSetAndFacetsPromise;},addFacetsToPerspective:function(p,a){for(var i=0;i<a.length;++i){var c=a[i];var e=false;var j;for(j=0;j<p.chartFacets.length;++j){var d=p.chartFacets[j];if(d.getDimension()===c.getDimension()){e=true;break;}}if(e){c.title=p.chartFacets[j].title;p.chartFacets.splice(j,1,c);}else{p.chartFacets.push(c);}}}});m.FacetLoader=function(){this.init.apply(this,arguments);};m.FacetLoader.prototype={init:function(p){this.sina=p.sina;},loadFacets:function(a){var t=this;var c=this.collectAttributes(a);c=jQuery.grep(c,function(e){if(e.slice(0,2)==='$$'){return false;}return true;});var d=[];for(var i=0;i<c.length;++i){var e=c[i];d.push(this.createChartQuery(e,a));}var h=jQuery.map(d,function(j){return j.getResultSet();});return jQuery.when.apply(jQuery,h).then(function(){var j=[];for(var i=0;i<arguments.length;++i){j.push(t.sina.createFacet({dimension:c[i],query:d[i],facetType:b.FacetType.ATTRIBUTE,sina:t.sina,title:d[i].getTitle()}));}return j;});},collectAttributes:function(a){var c=a.getFilterConditions();var d={};this.doCollectAttributes(c,d);return jQuery.map(d,function(e,h){return h;});},doCollectAttributes:function(c,a){if(!(c instanceof f.ConditionGroup)){a[c.attribute]=true;}else{var d=c.getConditions();for(var i=0;i<d.length;++i){c=d[i];this.doCollectAttributes(c,a);}}},createChartQuery:function(a,c){c=c.clone();this.removeFilterConditionsByAttribute(c,a);var d=this.sina.createChartQuery();d.setFilter(c);d.addDimension(a);d.setAttributeLimit(5);return d;},removeFilterConditionsByAttribute:function(a,c){var d=a.getFilterConditions();if(!(d instanceof f.ConditionGroup)){if(d.attribute===c){a.resetFilterConditions();return;}else{return;}}this.doRemoveFilterConditionsByAttribute(c,d);},doRemoveFilterConditionsByAttribute:function(a,c){var d=c.getConditions();for(var i=0;i<d.length;++i){var e=d[i];if(!(e instanceof f.ConditionGroup)){if(e.attribute===a){d.splice(i,1);i--;}}else{this.doRemoveFilterConditionsByAttribute(a,e);}}}};}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;m.SearchQuery=function(){this.init.apply(this,arguments);};m.SearchQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments);}});}(window));(function(g){"use strict";var m=g.sap.bc.ina.api.sina.base;m.SuggestionQuery=function(){this.init.apply(this,arguments);};m.SuggestionQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(){m.Query.prototype.init.apply(this,arguments);this.suggestionTypes=[this.sina.SuggestionType.OBJECTDATA,this.sina.SuggestionType.HISTORY,this.sina.SuggestionType.DATASOURCE];},resetResultSet:function(){this._resetResultSet();return this;},setSuggestionTypes:function(s){this.suggestionTypes=s;this._resetResultSet();}});}(window));
/*
 * @file Simple info access (SINA) API: System representation
 * @namespace sap.bc.ina.api.sina.base.system
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";var p=g.sap.bc.ina.api.sina.proxy;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.base.system');var m=g.sap.bc.ina.api.sina.base.system;m.System=function(){this.init.apply(this,arguments);};m.Service=function(){this.init.apply(this,arguments);};m.Capability=function(){this.init.apply(this,arguments);};m.Capability.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Capability||'';this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;}};m.Service.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Service;this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;this.capabilities={};for(var i=0;i<this.properties.Capabilities.length;i++){this.capabilities[this.properties.Capabilities[i].Capability]=new m.Capability(this.properties.Capabilities[i]);}},getCapability:function(n){return this.capabilities[n];},getCapabilities:function(){return this.capabilities;}};m.System.prototype={init:function(a){this.properties=a||{};this.services={};this.proxy=a.proxy||new p.Proxy();},getService:function(n){return this.services[n];},getServices:function(){return this.services;},getSystemType:function(){return this.systemType;},_deleteServerInfo:function(){this.jqXHR=jQuery.Deferred();},_getServerInfo:function(i){var t=this;if(this.jqXHR&&i){return this.jqXHR.promise();}if(this.jqXHR&&i===false){if(this.jqXHR.state()==="resolved"){return this.properties;}if(this.jqXHR.state()==="pending"){this.deprecatedJqXHR=this.jqXHR;}}this.jqXHR=jQuery.Deferred();var r={async:i,type:'GET',url:this.infoUrl,getServerInfo:true,processData:false,contentType:'application/json',dataType:'json'};this.proxy.ajax(r).done(function(d){t.setServerInfo(d);t.jqXHR.resolve(t.properties);if(t.deprecatedJqXHR){t.deprecatedJqXHR.resolve(t.properties);}}).fail(function(e){t.jqXHR.reject(e);if(t.deprecatedJqXHR){t.deprecatedJqXHR.reject(e);}});if(i===true){return this.jqXHR.promise();}return this.properties;},getServerInfo:function(){return this._getServerInfo(true);},getServerInfoSync:function(){return this._getServerInfo(false);},setServerInfo:function(j){this.properties.rawServerInfo=j;}};}(window));
/*
 * @file Proxy which offers some extras for ajax calls.
 * @namespace sap.bc.ina.api.sina.proxy
 * @copyright Copyright (c) 2014 SAP SE. All rights reserved.
 * @ignore
 */
(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.proxy');var m=g.sap.bc.ina.api.sina.proxy;m.Proxy=function(){this.init.apply(this,arguments);};m.inaReqResBuffer={};m.Proxy.prototype={init:function(p){this.properties=p||{};this.xsrfToken='';this.xsrfService=this.properties.xsrfService;this.xsrfRetries=0;this.xsrfRequest={'headers':{'X-CSRF-Token':'Fetch'},'cache':false,'url':this.xsrfService};this.properties.cachelifetime=this.properties.cachelifetime||0;this.properties.httpMethod=this.properties.httpMethod||'post';if(this.properties.cachelifetime>0){g.window.setInterval(function(){m.inaReqResBuffer={};},this.properties.cachelifetime);}this.properties.recordFile=this.properties.recordFile;this.properties.demoMode=this.properties.demoMode||"";this._checkRecordingURLValues();},_checkRecordingURLValues:function(){function a(n){return decodeURI((new RegExp(n+'='+'(.+?)(&|$|#)').exec(g.window.location.search)||[null])[1]);}function h(n){if(g.window.location.search.toLowerCase().indexOf('&'+n.toLowerCase())!==-1){return true;}if(g.window.location.search.toLowerCase().indexOf('?'+n.toLowerCase())!==-1){return true;}return false;}if(h('record')){this.properties.recordFile=a('record');}if(h('demoMode')){this.properties.demoMode=a('demoMode');}},_requestHashValue:function(u,d){if(d){var p=u.indexOf("?")===-1?"?":"&";u=u+p+'Request=';if(typeof d==="string"){u+=d;}else{u+=JSON.stringify(d);}}return u;},_handleRequestFromCache:function(r){var i=JSON.stringify(r.data);var a=m.inaReqResBuffer[i];if(a){var j=jQuery.Deferred();j.resolve(a);return j.promise();}return{};},_handleRequestFromRecords:function(r,a){var t=this;function _(c,d,e){var f=c[t._requestHashValue(d,e)];if(f){return f;}else{return new jQuery.Deferred().reject("Could not find request hash "+t._requestHashValue(d,e)+" in record file "+a);}}if(r.async===false){if(!this.recordings){this.recordings=this._loadRecordings(a).responseText;this.recordings=JSON.parse(this.recordings);}var b={};if(jQuery.isArray(this.recordings)){for(var i=0;i<this.recordings.length;i++){b[t._requestHashValue(this.recordings[i].requestUrl,this.recordings[i].requestData)]=this.recordings[i].responseData;}this.recordings=b;}return{responseText:JSON.stringify(_(this.recordings,r.url,r.data))};}return this._loadRecordingsAsync(r.async,a).then(function(c){return _(c,r.url,r.data);});},_loadRecordings:function(r){return jQuery.ajax({async:false,dataType:'json',url:r});},_loadRecordingsAsync:function(a,r){var t=this;if(this.recordingsDefer){return this.recordingsDefer;}this.recordingsDefer=jQuery.Deferred();var j=jQuery.ajax({dataType:'json',url:r});j.done(function(b){var c={};if(jQuery.isArray(b)){for(var i=0;i<b.length;i++){c[t._requestHashValue(b[i].requestUrl,b[i].requestData)]=b[i].responseData;}b=c;}t.recordingsDefer.resolve(b);});j.fail(function(e){t.recordingsDefer.resolve({});});return this.recordingsDefer;},_saveRecordingsAsync:function(r){var t=this;return jQuery.ajax({type:'PUT',url:t.properties.recordFile,data:JSON.stringify(r)});},setXSRFService:function(u){this.xsrfService=u;this.xsrfRequest.url=u;},_getXSRFToken:function(){var t=this;if(!this.xsrfDeferred){this.xsrfRetries++;this.xsrfDeferred=jQuery.ajax(this.xsrfRequest);this.xsrfDeferred.done(function(d){t.xsrfToken=t.xsrfDeferred.getResponseHeader('X-CSRF-Token')||t.xsrfToken||'';if(t.xsrfToken){t.xsrfRetries=0;}});}return this.xsrfDeferred.promise();},_requestWithXSRFToken:function(r){var t=this;if(r.async===false){if(this.xsrfDeferred&&this.xsrfDeferred.state()==='pending'){this.xsrfDeferred.abort();}this.xsrfRequest.async=false;this.xsrfDeferred=jQuery.ajax(this.xsrfRequest);if(r.url===this.xsrfService){return this.xsrfDeferred();}this.xsrfToken=this.xsrfDeferred.getResponseHeader('X-CSRF-Token')||this.xsrfToken||'';r.headers={'X-CSRF-Token':this.xsrfToken};return jQuery.ajax(r);}else{if(r.url===this.xsrfService){return this._getXSRFToken();}var d=jQuery.Deferred();this._getXSRFToken().done(function(a){r.headers={'X-CSRF-Token':t.xsrfToken};jQuery.ajax(r).done(function(a){d.resolve(a);}).fail(function(e,b,c){if(e.status===400){if(e.responseJSON&&e.responseJSON.Error&&e.responseJSON.Error.Code&&e.responseJSON.Error.Code===403){if(t.xsrfRetries<5){t.xsrfDeferred=null;t._requestWithXSRFToken(r).done(function(a){d.resolve(a);}).fail(function(e){d.reject(e);});}}else{d.reject(e);}}else{if((e.status>=200&&e.status<=299)&&(b||c)){e.status=500;e.statusText=b;var E=b+': ';if(c&&c.stack){E=E+c.stack;}e.responseText=E;}d.reject(e);}});}).fail(function(e){d.reject(e);});return d.promise();}},ajax:function(r){var t=this;var j;var i=r.data===undefined?undefined:JSON.stringify(r.data);if(this.properties.cachelifetime>0){return this._handleRequestFromCache(r);}if(this.properties.demoMode){j=this._handleRequestFromRecords(r,this.properties.demoMode);}else{r.processData=r.processData||false;r.type=r.type||this.properties.httpMethod||'POST';if(i){if(r.type.toLowerCase()==='get'){r.data='Request='+i;}else{r.data=i;}}j=this._requestWithXSRFToken(r);}if(j&&j.done){j.done(function(a){if(t.properties.cachelifetime>0){t._cacheResponse(r,a);}if(t.properties.recordFile){t._recordResponseAsync(r,a,t.properties.recordFile);}});}return j;},_cacheResponse:function(r,d){var i=JSON.stringify(r.data);m.inaReqResBuffer[i]=d;},_recordResponseAsync:function(r,a,b){a=jQuery.extend(true,{},a);var t=this;this._loadRecordingsAsync(false,b).then(function(c){c[t._requestHashValue(r.url,r.data)]=a;return c;}).then(function(c){if(b===t.properties.demoMode){throw"Recording: source file must not be the same as target file";}t._saveRecordingsAsync(c);});}};}(window));
/*
 * Simple info access (SINA) API: JSON Templates
 * Package: sap.bc.ina.api.sina.impl.inav2.jsontemplates
 * Copyright (c) 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.jsontemplates');var m=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;m.getDataSourceMetaDataRequest=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Metadata":{"Context":"Search","Expand":["Cube"]},"ServiceVersion":204});};m.getCatalogRequest=function(){return jQuery.extend({},{"DataSource":{"ObjectName":"$$DataSources$$","PackageName":"ABAP"},"Options":["SynchronousRun"],"Search":{"Top":1000,"Skip":0,"OrderBy":[{"AttributeName":"Description","SortOrder":"ASC"},{"AttributeName":"ObjectName","SortOrder":"ASC"}],"Expand":["Grid","Items"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"SupportedService","Comparison":"=","Value":"Search"}}]}}},"NamedValues":[{"AttributeName":"ObjectName","Name":"ObjectName"},{"AttributeName":"Description","Name":"Description"},{"AttributeName":"Type","Name":"Type"}]},"SearchTerms":"*","ServiceVersion":204});};m.getESHConnectorRequest=function(){return jQuery.extend({},{"DataSource":{"SchemaName":"","PackageName":"ABAP","ObjectName":"~ESH_CONNECTOR~","Type":"Connector"},"Search":{"Top":1000,"Skip":0,"OrderBy":[{"AttributeName":"DESCRIPTION","SortOrder":"ASC"}],"Expand":["Grid","Items","TotalCount"],"Filter":{},"NamedValues":[{"AttributeName":"$$ResultItemAttributes$$","Name":"$$ResultItemAttributes$$"},{"AttributeName":"$$RelatedActions$$","Name":"$$RelatedActions$$"}],"SearchTerms":"*","SelectedValues":[]}});};m.getSuggestionRequest=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Suggestions":{"Expand":["Grid","Items"],"Precalculated":false,"SearchTerms":"","AttributeNames":[]},"ServiceVersion":204});};m.getSuggestion2Request=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Suggestions2":{"Expand":["Grid","Items"],"Precalculated":false,"AttributeNames":[]},"ServiceVersion":204});};m.getPerspectiveRequest=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","ResultsetFacets","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"Function":"RelatedActions","Name":"$$RelatedActions$$"}]},"ServiceVersion":204});};m.getPerspectiveSearchRequest=function(){return jQuery.extend({},{"DataSource":{"ObjectName":"$$Perspectives$$","Type":"View"},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items"],"Filter":{"Selection":{"Operator":{"Code":"Or","SubSelections":[{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"3"}},{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"4"}},{"MemberOperand":{"AttributeName":"SCHEMA_VERSION_NUMBER","Comparison":"=","Value":"5"}}]}}},"SearchTerms":"*","SelectedValues":[{"AttributeName":"PACKAGE_ID","Name":"PACKAGE_ID"},{"AttributeName":"PERSPECTIVE_ID","Name":"PERSPECTIVE_ID"},{"AttributeName":"TITLE_TEXT","Name":"TITLE_TEXT"},{"AttributeName":"SUMMARY_TEXT","Name":"SUMMARY_TEXT"}],"Skip":0,"Top":30}});};m.getPerspectiveRequestFactsheet=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","ResultsetFacets","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"AttributeName":"$$RelatedActions$$"},{"AttributeName":"$$RelatedActions.Proxy$$"}]},"ServiceVersion":204});};m.getSearchRequest=function(){return jQuery.extend({},{"DataSource":{},"SearchTerms":"DUMMY","Search":{"Expand":["Grid","Items","TotalCount"],"Top":"DUMMY","Skip":"DUMMY","SelectedValues":"DUMMY","NamedValues":[{"AttributeName":"$$ResultItemAttributes$$","Name":"$$ResultItemAttributes$$"},{"AttributeName":"$$RelatedActions$$","Name":"$$RelatedActions$$"}]}});};m.getABAPChartRequest=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","ResultsetFacets","TotalCount"],"Filter":{},"Top":10,"Skip":0,"SearchTerms":"*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"AttributeName":"$$RelatedActions$$"},{"AttributeName":"$$RelatedActions.Proxy$$"}],"OrderBy":[]},"ServiceVersion":204,"Facets":{"MaxNumberOfReturnValues":1000,"Attributes":[]}});};m.getChartRequest=function(){return jQuery.extend({},{"DataSource":{},"Options":["SynchronousRun"],"SearchTerms":"","Analytics":{"Definition":{"Dimensions":[{"Axis":"Rows","Name":"CATEGORY","SortOrder":1,"Top":5},{"Axis":"Columns","Name":"CustomDimension1","Members":[{"Aggregation":"COUNT","AggregationDimension":"CATEGORY","MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":"COUNT"},"Name":"COUNT","SortOrder":2}]}],"Filter":{}}}});};m.getSearchConfigurationRequest=function(){return jQuery.extend({},{"SearchConfiguration":{"Action":"Update","Data":{"PersonalizedSearch":{"PersonalizationPolicy":"","SessionUserActive":true,"ResetUserData":true},"NavigationEvent":{"SourceApplication":"","TargetApplication":"","Parameter":[]}}}});};}(window));
/*
 * @file Implementation of the datasource interface
 * @namespace sap.bc.ina.api.sina.impl.inav2.datasource
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";var d=g.sap.bc.ina.api.sina.base.datasource;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.datasource');var m=g.sap.bc.ina.api.sina.impl.inav2.datasource;m.DataSource=function(){this.init.apply(this,arguments);};m.DataSourceMetaData=function(){this.init.apply(this,arguments);};m.DataSource.prototype=jQuery.extend(Object.create(d.DataSource.prototype),{init:function(p){d.DataSource.prototype.init.apply(this,[p]);if(!p){return{};}var D;if(p.key){this.key=p.key;D=true;}p.schemaName=p.schemaName||p.SchemaName||{label:'',value:''};this.setSchemaName(p.schemaName,D);p.packageName=p.packageName||p.PackageName||"ABAP";this.setPackageName(p.packageName,D);p.objectName=p.objectName||p.ObjectName||{label:'',value:''};this.setObjectName(p.objectName,D);this.setType(p.type||p.Type||d.DataSourceType.DEFAULT,D);this.label=p.label||p.Label||p.Description||'';this.labelPlural=p.labelPlural||p.LabelPlural||p.DescriptionPlural||this.label||'';this.semanticObjectType=p.semanticObjectType||p.SemanticObjectType||'';this.systemId=p.systemId||p.SystemId||'';this.client=p.client||p.Client||'';this.sina=p.sina||null;if(p.metaData){this.setMetaData(p.metaData);}if(!this.key){throw'Datasource has no key'+JSON.stringify(p);}},setMetaData:function(a){this.metaData=a;},getIdentifier:function(){return this.key;},getSchemaName:function(){if(!this.schemaName){this.schemaName={label:'',value:''};}return this.schemaName;},_getSchemaNameAsString:function(){if(jQuery.type(this.schemaName)==='object'){return this.schemaName.value;}if(jQuery.type(this.schemaName)==='string'){return this.schemaName;}return'';},setSchemaName:function(s,a){if(!this.schemaName){this.schemaName={};}if(jQuery.type(s)==='object'){this.schemaName.label=s.label||s.value||'';this.schemaName.value=s.value||'';}if(jQuery.type(s)==='string'){this.schemaName.label=s;this.schemaName.value=s;}if(a!==true){this._constructKey();}},getPackageName:function(){if(!this.packageName){this.packageName={label:'',value:''};}return this.packageName;},getPackageNameAsString:function(){if(jQuery.type(this.packageName)==='object'){return this.packageName.value;}if(jQuery.type(this.packageName)==='string'){return this.packageName;}return'';},setPackageName:function(p,a){if(!this.packageName){this.packageName={};}if(jQuery.type(p)==='object'){this.packageName.label=p.label||p.value||'';this.packageName.value=p.value||'';}if(jQuery.type(p)==='string'){this.packageName.label=p;this.packageName.value=p;}if(a!==true){this._constructKey();}},getObjectName:function(){if(!this.objectName){this.objectName={label:'',value:''};}return this.objectName;},setObjectName:function(o,a){if(!this.objectName){this.objectName={};}if(jQuery.type(o)==='object'){this.objectName.label=o.label||o.value||'';this.objectName.value=o.value||'';}if(jQuery.type(o)==='string'){this.objectName.label=o;this.objectName.value=o;}if(a!==true){this._constructKey();}},_constructKey:function(){this.key=this.getTypeAsString()+'/'+this.getPackageNameAsString()+'/'+this.getObjectNameAsString();},setObjectNameValue:function(v,a){if(!this.objectName){this.objectName={};}this.objectName.value=v||'';if(a!==true){this._constructKey();}},setObjectNameLabel:function(l){if(!this.objectName){this.objectName={};}this.objectName.label=l||'';if(!this.label){this.setLabel(l);}if(!this.labelPlural){this.setLabelPlural(l);}},getObjectNameAsString:function(){if(jQuery.type(this.objectName)==='object'){return this.objectName.value;}if(jQuery.type(this.objectName)==='string'){return this.objectName;}return'';},setType:function(t,a){var v=d.DataSourceType.DEFAULT;if(typeof t==="object"){if(t.value.toLowerCase()==="view"||t.value.toLowerCase()==="businessobject"){v=d.DataSourceType.BUSINESSOBJECT;}else{v=d.DataSourceType.DEFAULT;}}else{if(t.toLowerCase()==="view"||t.toLowerCase()==="businessobject"){v=d.DataSourceType.BUSINESSOBJECT;}else{v=d.DataSourceType.DEFAULT;}}this.type=v;if(a!==true){this._constructKey();}},getTypeAsString:function(){if(jQuery.type(this.type)==='object'){return this.type.value;}if(jQuery.type(this.type)==='string'){return this.type;}return'';},getLabel:function(){if(typeof this.label!=='undefined'&&this.label!==''){return this.label;}if(typeof this.getObjectName().label!=='undefined'&&this.getObjectName().label!==''){return this.getObjectName().label;}if(typeof this.getObjectName().value!=='undefined'&&this.getObjectName().value!==''){return this.getObjectName().value;}return'';},setLabel:function(l){this.label=l||'';this.labelPlural=this.labelPlural||this.label;},getLabelPlural:function(){if(typeof this.labelPlural!=='undefined'&&this.labelPlural!==''){return this.labelPlural;}return this.getLabel();},setLabelPlural:function(l){this.labelPlural=l||'';},setJsonFromResponse:function(i){this.setSchemaName({value:i.SchemaName,label:i.SchemaLabel});this.setPackageName({value:i.PackageName,label:i.PackageLabel});this.setObjectName({value:i.ObjectName,label:i.ObjectLabel});this.setType({value:i.Type,label:''});},getDataForRequest:function(){var j={'SchemaName':this.getSchemaName().value,'PackageName':this.getPackageName().value,'ObjectName':this.getObjectName().value};if(this.getType()===d.DataSourceType.BUSINESSOBJECT){j.Type='View';}else{j.Type=this.getType();}return j;},clone:function(){var n=this.sina.createDataSource();n.setSchemaName(this.schemaName);n.setPackageName(this.packageName);n.setObjectName(this.objectName);n.setType(this.type);n.label=this.label;n.labelPlural=this.labelPlural;n.semanticObjectType=this.semanticObjectType;n.systemId=this.systemId;n.client=this.cliet;n.setMetaData(this.metaData);n.key=this.key;return n;},setJson:function(j){for(var p in j){if(j.hasOwnProperty(p)){j[p.toLowerCase()]=j[p];}}this.schemaName=j.schemaname;this.packageName=j.packagename;this.objectName=j.objectname;if(j.Type==='View'){this.setType(d.DataSourceType.BUSINESSOBJECT);}else{this.setType(j.type);}this.label=j.label;this.labelPlural=j.labelplural;this.semanticObjectType=undefined;this.systemId=undefined;this.client=undefined;this.metaData=undefined;this._constructKey();},getJson:function(){var j={"label":this.label,"labelPlural":this.labelPlural,"SchemaName":{"label":this.getSchemaName().label,"value":this.getSchemaName().value},"PackageName":{"label":this.getPackageName().label,"value":this.getPackageName().value},"ObjectName":{"label":this.getObjectName().label,"value":this.getObjectName().value}};j.Type=this.getType();return j;}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;m.MetaDataService=function(){this.init.apply(this,arguments);};m.MetaDataService.prototype={init:function(p){p=p||{};this.sina=p.sina||null;this.allInOneMap={};this.allInOneMap.dataSourceList=[];this.allInOneMap.dataSourceMap={};this.dataSourcesDeferred=null;this.allInOneMap.businessObjectList=[];this.allInOneMap.businessObjectMap={};this.businessObjectsDeferred=null;},getDataSources:function(){var t=this;return t._fillDataSourcesBuffer().then(function(){return t.allInOneMap.dataSourceList;});},getDataSourcesSync:function(){var t=this;t._fillDataSourcesBufferSync();return t.allInOneMap.dataSourceList;},getDataSource:function(d){var t=this;if(!d){throw"data source is missing";}if(!d.objectName){throw"data source's objectName is missing";}if(!d.packageName){throw"data source's packageName is missing";}if(!d.type){throw"data source's type is missing";}return t._fillDataSourcesBuffer().then(function(){return t.allInOneMap.dataSourceMap[d.key];});},getDataSourceByBusinessObjectName:function(d){var t=this;if(!d){throw'datasource key missing';}return t._fillDataSourcesBuffer().then(function(){return t.allInOneMap.dataSourceMap[d];});},getDataSourceSync:function(d){var t=this;if(!d){throw"data source is missing";}if(!d.objectName){throw"data source's objectName is missing";}if(!d.packageName){throw"data source's packageName is missing";}if(!d.type){throw"data source's type is missing";}t._fillDataSourcesBufferSync();return t.allInOneMap.dataSourceMap[d.key];},getDataSourceSyncByBusinessObjectName:function(d){var t=this;if(!d){throw'datasource key missing';}t._fillDataSourcesBufferSync();return t.allInOneMap.dataSourceMap[d];},_fillDataSourcesBuffer:function(){var t=this;if(t.dataSourcesDeferred){return t.dataSourcesDeferred;}t.dataSourcesDeferred=new jQuery.Deferred();if(t.allInOneMap.dataSourceList.length!==0){t.dataSourcesDeferred.resolve(t.allInOneMap.dataSourceList);return t.dataSourcesDeferred;}var p={sina:t.sina,system:t.sina.sys,top:1000};var d=new m.DataSourceQuery(p);var a=d.getResultSet();a.done(function(r){t._extractDataSources(r);t.dataSourcesDeferred.resolve(t.allInOneMap.dataSourceList);});a.fail(function(e){d=new m.ESHConnectorDataSourceQuery(p);d.getResultSet().done(function(r){t._extractESHConnectorDataSources(r);t.dataSourcesDeferred.resolve(t.allInOneMap.dataSourceList);});d.getResultSet().fail(function(e){t.dataSourcesDeferred.reject(e);t.dataSourcesDeferred=null;});});return t.dataSourcesDeferred;},_fillDataSourcesBufferSync:function(){var t=this;if(t.allInOneMap.dataSourceList.length!==0){return;}var p={sina:t.sina,system:t.sina.sys,top:1000};var d=new m.DataSourceQuery(p);var r=d.getResultSetSync();if(r.elements.length!==0){t._extractDataSources(r);}else{d=new m.ESHConnectorDataSourceQuery(p);r=d.getResultSetSync();t._extractESHConnectorDataSources(r);}},_extractDataSources:function(r){var t=this;var e=r.getElements();for(var i=0;i<e.length;++i){var a=e[i];if(a.Type.value.toLowerCase()!=="category"){var l=a.Description.value===null?a.ObjectName.value:a.Description.value;var b=a.DescriptionPlural===undefined||a.DescriptionPlural.value===null?l:a.DescriptionPlural.value;var d=t.sina.createDataSource({objectName:{label:a.ObjectName.value,value:a.ObjectName.value},packageName:{label:"ABAP",value:"ABAP"},schemaName:"",type:"View",label:l,labelPlural:b});var k=d.key;if(!(k in t.allInOneMap.dataSourceMap)){t.allInOneMap.dataSourceList.push(d);t.allInOneMap.dataSourceMap[k]=d;}}}t._setRemoteSystemName();},_extractESHConnectorDataSources:function(r){var t=this;var e=r.getElements();for(var i=0;i<e.length;++i){var a=e[i];if(a.$$DataSourceMetaData$$.type.toLowerCase()!=="category"){var l=a.DESCRIPTION.value===null?a.OBJECT_NAME.value:a.DESCRIPTION.value;var b=a.DESCRIPTIONPLURAL===undefined||a.DESCRIPTIONPLURAL.value===null?l:a.DESCRIPTIONPLURAL.value;var d=t.sina.createDataSource({objectName:{label:a.OBJECT_NAME.value,value:a.OBJECT_NAME.value},packageName:{label:"ABAP",value:"ABAP"},schemaName:"",type:"View",label:l,labelPlural:b});var k=d.key;if(!(k in t.allInOneMap.dataSourceMap)){t.allInOneMap.dataSourceList.push(d);t.allInOneMap.dataSourceMap[k]=d;}}}t._setRemoteSystemName();},_setRemoteSystemName:function(){var t=this;var s="";var k="";for(var i=0;i<t.allInOneMap.dataSourceList.length-1;i++){if(t.allInOneMap.dataSourceList[i].labelPlural===t.allInOneMap.dataSourceList[i+1].labelPlural){if(t.allInOneMap.dataSourceList[i].remoteSystem===undefined){s=t.allInOneMap.dataSourceList[i].objectName.value.substr(0,t.allInOneMap.dataSourceList[i].objectName.value.indexOf('~'));t.allInOneMap.dataSourceList[i].remoteSystem=s;k=t.allInOneMap.dataSourceList[i].key;t.allInOneMap.dataSourceMap[k].remoteSystem=s;}s=t.allInOneMap.dataSourceList[i+1].objectName.value.substr(0,t.allInOneMap.dataSourceList[i+1].objectName.value.indexOf('~'));t.allInOneMap.dataSourceList[i+1].remoteSystem=s;k=t.allInOneMap.dataSourceList[i+1].key;t.allInOneMap.dataSourceMap[k].remoteSystem=s;}}},getBusinessObjectsMetaData:function(){var t=this;return t.getDataSources().then(function(){return t._fillBusinessObjectsBuffer().then(function(){return t.allInOneMap.businessObjectList;});});},getBusinessObjectsMetaDataSync:function(){var t=this;t.getDataSourcesSync();t._fillBusinessObjectsBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(d){var t=this;if(!d){throw"data source is missing";}if(!d.objectName){throw"data source's objectName is missing";}if(!d.packageName){throw"data source's packageName is missing";}if(!d.type){throw"data source's type is missing";}return t.getDataSource(d).then(function(){return t._fillBusinessObjectBuffer(d.key).then(function(){return t.allInOneMap.businessObjectMap[d.key];});});},getBusinessObjectMetaDataByBusinessObjectName:function(d){var t=this;if(!d){throw'datasource key missing';}return t.getDataSourceByBusinessObjectName(d).then(function(){return t._fillBusinessObjectBuffer(d).then(function(){return t.allInOneMap.businessObjectMap[d];});});},getBusinessObjectMetaDataSync:function(d){var t=this;if(!d){throw"data source is missing";}if(!d.objectName){throw"data source's objectName is missing";}if(!d.packageName){throw"data source's packageName is missing";}if(!d.type){throw"data source's type is missing";}t.getDataSourceSync(d);t._fillBusinessObjectBufferSync(d.key);return t.allInOneMap.businessObjectMap[d.key];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(d){var t=this;if(!d){throw'datasource key missing';}t.getDataSourceSyncByBusinessObjectName(d);t._fillBusinessObjectBufferSync(d);return t.allInOneMap.businessObjectMap[d];},_fillBusinessObjectsBuffer:function(){var t=this;if(t.businessObjectsDeferred){return t.businessObjectsDeferred;}t.businessObjectsDeferred=new jQuery.Deferred();if(t.allInOneMap.businessObjectList.length!==0){t.dataSourcesDeferred.resolve(t.allInOneMap.businessObjectList);return t.dataSourcesDeferred;}var d=t.allInOneMap.dataSourceList;var b=[];for(var i=0;i<d.length;i++){b.push(t._businessObjectDeffered(d[i].key));}jQuery.when.apply(null,b).then(function(){t.businessObjectsDeferred.resolve(t.allInOneMap.businessObjectList);},function(e){t.businessObjectsDeferred=null;t.businessObjectsDeferred.reject(e);});return t.businessObjectsDeferred;},_businessObjectDeffered:function(k){var t=this;var j=t.sina.getSystem().proxy.ajax(t._parseMetaDataRequest(true,t.allInOneMap.dataSourceMap[k]));return j.then(function(r){var a=t._parseMetaDataResponse(r);t._setMetaData(k,a);return jQuery.when(true);},function(e){return jQuery.when(false);});},_fillBusinessObjectsBufferSync:function(){var t=this;if(t.allInOneMap.businessObjectList.length!==0){return;}var d=t.allInOneMap.dataSourceList;for(var i=0;i<d.length;i++){if(!(d[i].key in t.allInOneMap.businessObjectMap)){t._fillBusinessObjectBufferSync(d[i].key);}}},_fillBusinessObjectBuffer:function(k){var t=this;var b=new jQuery.Deferred();if(t.allInOneMap.businessObjectMap[k]){b.resolve(t.allInOneMap.businessObjectMap[k]);return b;}var j=t.sina.getSystem().proxy.ajax(t._parseMetaDataRequest(true,t.allInOneMap.dataSourceMap[k]));j.then(function(r){var a=t._parseMetaDataResponse(r);t._setMetaData(k,a);b.resolve(t.allInOneMap.businessObjectMap[k]);},function(e){b=null;b.reject(e);});return b;},_fillBusinessObjectBufferSync:function(k){var t=this;if(t.allInOneMap.businessObjectMap[k]!==undefined){return;}var d=t.allInOneMap.dataSourceMap[k];var j=g.sap.bc.ina.api.sina.getSystem().proxy.ajax(t._parseMetaDataRequest(false,d));var a=$.parseJSON(j.responseText);if(!a.Error){var b=t._parseMetaDataResponse(a);t._setMetaData(d.key,b);}},_parseMetaDataRequest:function(i,d){var p={ObjectName:d.objectName.value,PackageName:d.packageName.value,SchemaName:d.schemaName.value,Type:d.type.value};var r={async:i,url:this.sina.getSystem().inaUrl,processData:false,contentType:'application/json',dataType:'json',data:{"DataSource":p,"Options":["SynchronousRun"],"Metadata":{"Context":"Search","Expand":["Cube"]},"ServiceVersion":204},success:function(a){}};return r;},_parseMetaDataResponse:function(a){var b={};if(!a.Cube||!a.Cube.Dimensions){return b;}for(var i=0;i<a.Cube.Dimensions.length;i++){for(var j=0;j<a.Cube.Dimensions[i].Attributes.length;j++){var k=a.Cube.Dimensions[i].Attributes[j].Name;if(k===undefined||k===""||k.indexOf("$$")>-1){continue;}b[k]={displayOrder:a.Cube.Dimensions[i].Attributes[j].DisplayOrder||0,isTitle:$.inArray("Title",a.Cube.Dimensions[i].Attributes[j].presentationUsage)>-1?true:false,isKey:a.Cube.Dimensions[i].Attributes[j].IsKey,label:a.Cube.Dimensions[i].Attributes[j].Description||"",labelRaw:k,presentationUsage:a.Cube.Dimensions[i].Attributes[j].presentationUsage||[],accessUsage:a.Cube.Dimensions[i].Attributes[j].accessUsage||[],type:a.Cube.Dimensions[i].Attributes[j].DataType||""};}}return b;},setBusinessObjectMetaDataSync:function(d,a){var t=this;if(t.allInOneMap.businessObjectMap[d.key]){return;}var b={};for(var e in a){if(e.indexOf("$$")>-1||e==="title"||jQuery.type(a[e])==="function"||!a[e]||!a[e].$$MetaData$$){continue;}var c=a[e];var f=c.$$MetaData$$;var n={labelRaw:e,label:f.description,type:f.dataType,isTitle:f.isTitle,isKey:f.isKey,presentationUsage:f.presentationUsage,accessUsage:f.accessUsage,displayOrder:f.displayOrder};b[e]=n;}t._setMetaData(d.key,b);},_setMetaData:function(k,a){var t=this;t.allInOneMap.businessObjectMap[k]={attributeMap:{}};t.allInOneMap.businessObjectMap[k].attributeMap=a;t.allInOneMap.businessObjectList.push(a);}};}(window));
/*
 * @file Implementation of the filter interface
 * @namespace sap.bc.ina.api.sina.impl.inav2.filter
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";var f=g.sap.bc.ina.api.sina.base.filter;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.filter');var m=g.sap.bc.ina.api.sina.impl.inav2.filter;m.Filter=function(){this.init.apply(this,arguments);};m.Condition=function(){this.init.apply(this,arguments);};m.ConditionGroup=function(){this.init.apply(this,arguments);};m.Filter.prototype=jQuery.extend(Object.create(f.Filter.prototype),{init:function(p){g.sap.bc.ina.api.sina.base.filter.Filter.prototype.init.apply(this,[p]);},getDataForRequest:function(){var r=[];this.defaultConditionGroup.getDataForRequest(r);r[0].Selection.Operator=r[0].Selection.Operator||{'Code':'And'};r[0].Selection.Operator.SubSelections=r[0].Selection.Operator.SubSelections||[];r[0].Selection.Operator.SubSelections.push({"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}});r[0].Selection.Operator.SubSelections.push({"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}});r[0].Selection.Operator.SubSelections.push({"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}});r[0].Selection.Operator.SubSelections.push({"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ItemDetails"}});return r[0];},setJsonFromResponse:function(j){if(j.Selection===undefined){return;}var a=this.sina.createFilterConditionGroup();a.setJsonFromResponse(j);this.defaultConditionGroup.addCondition(a);}});m.Condition.prototype=jQuery.extend(Object.create(f.Condition.prototype),{init:function(a,o,v,s){g.sap.bc.ina.api.sina.base.filter.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(p){var o;var j={};if(this.operator.toLowerCase()==='contains'){o='SearchOperand';}else{o='MemberOperand';}j[o]={'AttributeName':this.attribute,'Comparison':this.operator,'Value':this.value};if(o==='SearchOperand'){delete j[o].Comparison;}j[o]=jQuery.extend({},j[o],this.inaV2_extended_properties);if(this.operator==='='&&this.value===null){j.MemberOperand.Comparison='IS NULL';j.MemberOperand.Value='';}p.push(j);},setJsonFromResponse:function(j){this.attribute=j.MemberOperand.AttributeName;this.operator=j.MemberOperand.Comparison;this.value=j.MemberOperand.Value;if(j.MemberOperand.Comparison==='IS NULL'&&j.MemberOperand.Value===''){this.operator='=';this.value=null;}}});m.ConditionGroup.prototype=jQuery.extend(Object.create(f.ConditionGroup.prototype),{init:function(p){f.ConditionGroup.prototype.init.apply(this,[p]);},getDataForRequest:function(p){var r={Selection:{}};var c=[];if(this.conditions.length>0){for(var i=0;i<this.conditions.length;++i){this.conditions[i].getDataForRequest(c);}r.Selection={'Operator':{'Code':this.operator,'SubSelections':c}};}if(p){p.push(r);}else{return r;}},setJsonFromResponse:function(j){if(j.Selection===undefined&&j.Operator){j.Selection={};j.Selection.Operator=j.Operator;}this.setOperator(j.Selection.Operator.Code);var c=j.Selection.Operator.SubSelections;for(var i=0;i<c.length;i++){var a;if(c[i].Operator){a=this.sina.createFilterConditionGroup();}else{a=this.sina.createFilterCondition();}a.setJsonFromResponse(c[i]);this.addCondition(a);}}});}(window));
/*
 * @file Proxy class to buffer InA JSON requests/responses.
 * @namespace sap.bc.ina.api.sina.impl.inav2.proxy
 * @copyright Copyright (c) 2014 SAP SE. All rights reserved.
 * @ignore
 */
(function(g){"use strict";var p=g.sap.bc.ina.api.sina.proxy;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.proxy');var m=g.sap.bc.ina.api.sina.impl.inav2.proxy;m.inaReqResBuffer={};m.Proxy=function(){this.init.apply(this,arguments);};m.Proxy.prototype=jQuery.extend({},p.Proxy.prototype,{init:function(a){var t=this;t.properties=a||{};p.Proxy.prototype.init.apply(this,[a]);}});}(window));
/*
 * @file Simple info access (SINA) API: Implementation of the SINA interface
 * for the INA V2 service.
 * @namespace sap.bc.ina.api.sina.impl.inav2
 * @requires sap.bc.ina.api.sina
 * @requires sap.bc.ina.api.sina.impl.inav2.filter
 * @requires sap.bc.ina.api.sina.impl.inav2.system
 * @requires sap.bc.ina.api.sina.impl.inav2.proxy
 * @requires jQuery
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;var b=g.sap.bc.ina.api.sina.base;m.Query=function(){this.init.apply(this,arguments);};m.Query.prototype=jQuery.extend({},{init:function(p){this.filter=p.filter||p.sina.createFilter({dataSource:p.dataSource});},_resetResultSet:function(){this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},_getInAV2Error:function(d){var e=[];if(d&&d.error){e.push(new b.SinaError({message:"INA V2 Service Error "+d.error.code+": "+d.error.message,errorCode:d.error.code}));}if(d&&d.Messages){for(var i=0;i<d.Messages.length;i++){if(d.Messages[i].Type>=2){e.push(new b.SinaError({message:"INA V2 Service Error "+d.Messages[i].Number+": "+d.Messages[i].Text,errorCode:d.Messages[i].Number}));}}}return e;},setDataSource:function(d){if(d===undefined){return this;}d=this.sina.createDataSource(d);if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},execute:function(){var t=this;var j=t.createJsonRequest();t.system.getServerInfo();if(!t.jqXHR){t.jqXHR=t._fireRequest(j,true);}var d=jQuery.Deferred();t.jqXHR.done(function(a){var e=t._getInAV2Error(a);if(a&&e&&e.length>0){if(a.error){d.reject(e[0]);return;}else if(a.Messages){if(e.length>=a.Messages.length){d.reject(e);return;}}}t.resultSetProperties.sina=t.sina;t.resultSetProperties.query=t;var r=new t.resultSetClass(t.resultSetProperties);r.setJsonFromResponse(a);d.resolve(r);}).fail(function(e){d.reject(e);}).always(function(a){t._responseJson=a;});return d.promise();},executeSync:function(){var t=this;if(t.resultSet!==null){return t.resultSet;}var j=t.createJsonRequest();t.system.getServerInfo();var d=JSON.parse(t._fireRequest(j,false).responseText);t._responseJson=d;t.resultSet=new t.resultSetClass(t.resultSetProperties);if(d){var e=t._getInAV2Error(d);if(e&&e.length>0){throw e[0];}t.resultSet.setJsonFromResponse(d);}return t.resultSet;},_fireRequest:function(d,a,c){a=a===undefined?true:a;var r={async:a,url:this.system.inaUrl,contentType:'application/json',dataType:c||'json',data:d};var j=this.system.proxy.ajax(r);return j;},_assembleOrderBy:function(){var o=[];function a(d,s){var i={};if(d.toLowerCase()==='$$score$$'){i.Function='Score';}else{i.AttributeName=d;}i.SortOrder=s.toUpperCase();return i;}var c;if(jQuery.type(this.orderBy)==='array'){for(var j=0;j<this.orderBy.length;j++){c=a(this.orderBy[j].orderBy,this.orderBy[j].sortOrder);o.push(c);}}else if(jQuery.type(this.orderBy)==='object'&&this.orderBy.orderBy){c=a(this.orderBy.orderBy,this.orderBy.sortOrder);o.push(c);}return o;}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;var b=g.sap.bc.ina.api.sina.base;var a=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;m.PerspectiveQuery=function(){this.init.apply(this,arguments);};m.PerspectiveQuery.prototype=jQuery.extend({},b.PerspectiveQuery.prototype,m.Query.prototype,{init:function(p){var t=this;t.chartFacets=[];t.searchFacet=null;t.searchresultset=null;t.layout=null;t.templateFactsheet=p.templateFactsheet||false;p=p||{};m.Query.prototype.init.apply(this,arguments);b.PerspectiveQuery.prototype.init.apply(this,arguments);p.orderBy=p.orderBy||{};this.setOrderBy(p.orderBy);this.resultSetClass=m.Perspective;this.resetFilterConditions();},_resetResultSet:function(){m.Query.prototype._resetResultSet.apply(this,arguments);b.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);},getExpand:function(){var e=[];for(var i=0;i<this.requestedEntities.length;i++){switch(this.requestedEntities[i]){case'SearchResults':e.push('Grid','Items');break;case'Facets':e.push('ResultsetFacets');break;case'TotalCount':e.push('TotalCount');break;case'Fuzzy':break;default:throw'Unknown requested entity!';}}return e;},resetFilterConditions:function(){b.Query.prototype.resetFilterConditions.apply(this,arguments);},createJsonRequest:function(){var t=a.getPerspectiveRequest();if(this.templateFactsheet){t=a.getPerspectiveRequestFactsheet();}t.DataSource=this.filter.dataSource.getDataForRequest();var s=this.filter.getSearchTerms();t.Search.SearchTerms=s;t.Search.Top=this._top;t.Search.Skip=this._skip;t.Search.Filter=this.filter.getDataForRequest();t.Search.OrderBy=this._assembleOrderBy();t.Search.Expand=this.getExpand();if(this.facetOptions){t.Facets=this.facetOptions;}if(this.requestedEntities.indexOf('Fuzzy')>-1){t.Options.push('Fuzzy');}return t;},getPerspective:function(o,c){this.getResultSet(o,c);},generatePerspectiveSync:function(){return this.getResultSetSync();}});m.Perspective=function(){this.init.apply(this,arguments);};m.Perspective.prototype=jQuery.extend({},b.Perspective.prototype,{determineFacetType:function(r){try{if(r.ResultSet.ItemLists[0].Items[0].NamedValues[0].Name==='$$DataSource$$'){return b.FacetType.DATASOURCE;}else{return b.FacetType.ATTRIBUTE;}}catch(e){return b.FacetType.ATTRIBUTE;}},setJsonFromResponse:function(d){var t=this;t.searchFacet=this.sina.createFacet({"facetType":"searchresult"});t.searchFacet.setJsonFromResponse(d);if(d.ResultsetFacets&&d.ResultsetFacets.Elements){for(var j=0;j<d.ResultsetFacets.Elements.length;j++){var f=t.determineFacetType(d.ResultsetFacets.Elements[j]);var c=this.sina.createFacet({"facetType":f});c.setJsonFromResponse(d.ResultsetFacets.Elements[j]);t.chartFacets.push(c);}}}});m.PerspectiveGetQuery=function(){this.init.apply(this,arguments);};m.PerspectiveGetQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(p){p=p||{};this.perspectiveId=p.perspectiveId;m.Query.prototype.init.apply(this,[p]);this.resultSetClass=m.Perspective2;},setPerspectiveId:function(p){this.perspectiveId=p;},getPerspective:function(o,c){var t=this;var r={async:true,url:"/sap/bc/ina/service/v2/Perspectives('"+this.perspectiveId+"')",type:"GET"};var j=this.system.proxy.ajax(r);j.done(function(d){if(d&&d.error){c(d.error);}t.resultSet=new t.resultSetClass(t.resultSetProperties);t.resultSet.setJsonFromResponse(d);if(o){o(t.resultSet);}}).fail(function(e){if(c){c(e);}});}});m.Perspective2=function(){this.init.apply(this,arguments);};m.Perspective2.prototype={init:function(p){p=p||{};},getFacetForID:function(f){var t=this;for(var j=0;j<t.facets.length;j++){if(t.facets[j].facetId===f){return t.facets[j];}}return undefined;},getDimensionForID:function(d){var t=this;for(var j=0;j<t.dimensions.length;j++){if(t.dimensions[j].Name===d){return t.dimensions[j];}}return undefined;},getPreviewDimension:function(){if(this.bindings["WIDGET-4"]&&this.bindings["WIDGET-4"].dimension){return this.bindings["WIDGET-4"].dimension;}if(this.bindings["WIDGET-1"]&&this.bindings["WIDGET-1"].dimension){return this.bindings["WIDGET-1"].dimension;}if(this.bindings["WIDGET-2"]&&this.bindings["WIDGET-2"].dimension){return this.bindings["WIDGET-2"].dimension;}if(this.bindings["WIDGET-3"]&&this.bindings["WIDGET-3"].dimension){return this.bindings["WIDGET-3"].dimension;}return undefined;},setJsonFromResponse:function(d){var t=this;t.rawdata=d;t.ChangedAt=d.ChangedAt;t.ChangedBy=d.ChangedBy;t.content=JSON.parse(d.Content);t.perspectiveId=d.Id;t.name=d.Name;t.packageName=d.Package;t.isActive=d.isActive;t.isGenerated=d.isGenerated;t.datasource=t.content.Model.Queries[0].Datasource;t.measures=[];var c=t.content.Model.Queries[0].CustomDimension1.Members;for(var k=0;k<c.length;k++){t.measures.push(c[k]);}t.dimensions=[];var e=t.content.Model.Queries[0].Dimensions;for(var j=0;j<e.length;j++){t.dimensions.push(e[j]);}t.facets=[];var f=t.content.Model.Facets;for(var i=0;i<f.length;i++){t.facets.push({isActive:f[i].Active,facetId:f[i].FacetId,dimension:t.getDimensionForID(f[i].SeriesChart.ScaleDimensions[0].DimensionName)});}t.bindings={};var h=t.content.Bindings;for(var l=0;l<h.length;l++){var n=h[l];t.bindings[n.WidgetId]=t.getFacetForID(n.FacetId);}}};m.PerspectiveSearchQuery=function(){this.init.apply(this,arguments);};m.PerspectiveSearchQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(p){p=p||{};m.Query.prototype.init.apply(this,[p]);this.filter.searchTerms=p.searchTerms||"*";this.resultSetClass=m.PerspectiveSearchResultSet;},createJsonRequest:function(){var t=a.getPerspectiveSearchRequest();t.Search.SearchTerms=this.filter.searchTerms;t.Search.Top=this._top;t.Search.Skip=this._skip;return t;},getPerspectiveResults:function(o,c){this.getResultSet(o,c);}});m.PerspectiveSearchResultSet=function(){this.init.apply(this,arguments);};m.PerspectiveSearchResultSet.prototype={init:function(p){var t=this;t.perspectives=[];p=p||{};},getPerspectiveSearchResultSet:function(){return this.perspectives;},setJsonFromResponse:function(d){var t=this;var p=d["ItemLists"][0]["Items"];for(var i=0;i<p.length;i++){var n=p[i]["NamedValues"];var c={packageId:n[0].Value,perspectiveId:n[0].Value+"/"+n[1].Value,perspectiveDescription:n[3].Value,title:n[2].Value};t.perspectives.push(c);}}};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var a=g.sap.bc.ina.api.sina.impl.inav2;var b=g.sap.bc.ina.api.sina.base;var d=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;a.SearchQuery=function(){this.init.apply(this,arguments);};a.SearchQuery.prototype=jQuery.extend({},b.SearchQuery.prototype,a.Query.prototype,{init:function(p){p=p||{};a.Query.prototype.init.apply(this,[p]);b.SearchQuery.prototype.init.apply(this,[p]);this.sqlSearch=(p.sqlSearch===undefined||p.sqlSearch===true)?true:false;this.attributes=p.attributes||[];p.orderBy=p.orderBy||{};this.setOrderBy(p.orderBy);this.resultSetClass=a.SearchResultSet;},addResponseAttribute:function(c){this.attributes.push(c);this._resetResultSet();return this;},createJsonRequest:function(){var t=d.getSearchRequest();t.DataSource=this.filter.dataSource.getDataForRequest();if(this.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem){if(this.attributes.length===0){throw{message:"Add at least one response attribute to your query"};}if(this.sqlSearch===true){t.Options=["SqlSearch"];}}var s=[];for(var i=0;i<this.attributes.length;++i){var c=this.attributes[i];if(jQuery.type(c)==='string'){s.push({Name:c,AttributeName:c});}else if(jQuery.type(c)==='object'){var e={Name:c.name||c.attributeName,AttributeName:c.attributeName||c.name};if(c.highlighted===true){e.Function='Highlighted';}if(c.snippet===true){e.Function='Snippet';}if(c.startPosition!==undefined){e.StartPosition=c.startPosition;}if(c.maxLength!==undefined){e.MaxLength=c.maxLength;}s.push(e);}}t.Search.SelectedValues=s;var f=this.filter.getSearchTerms();if(!f){f='*';}t.SearchTerms=f;t.Search.Top=this._top;t.Search.Skip=this._skip;t.Search.Filter=this.filter.getDataForRequest();t.Search.OrderBy=this._assembleOrderBy();return t;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};},getOrderBy:function(){return this.orderBy;}});a.SearchResultSet=function(){this.init.apply(this,arguments);};a.SearchResultSet.prototype={init:function(p){p=p||{};this.sina=p.sina;this.elements=[];this.totalcount=0;},toString:function(r){var e=this.elements;var c=[];var i;for(i=0;i<e.length;++i){var f=e[i];var h={};for(var j in f){if(j.slice(0,2)==='$$'||j.slice(0,1)==='_'){continue;}var k=f[j];if(!k.label||!k.value){continue;}var l={label:k.label,value:k.value};h[j]=l;}c.push(h);}return JSON.stringify(c);},setJsonFromResponse:function(e){var s=this;this.elements=[];function R(){this.type="";this.platform="";this.technology="";this.width="";this.height="";this.variant="";this.uri="";}R.prototype={_fromInaJson:function(k){this.type=k.Type||"";this.platform=k.Platform||"";this.technology=k.Technology||"";this.width=k.Width||"";this.height=k.Height||"";this.variant=k.Variant||"";this.uri=k.Uri||"";}};function f(){this.type="";this.description="";this.uri="";this.request=null;this.encodedJSON="";}f.prototype={_fromInaJson:function(k){var l=this;l.description=k.Description;l.uri=k.Uri;switch(k.Type){case"RelatedRequest":l.type='Search';var m={};m.dataSource=s.sina.createDataSource();m.dataSource.setJsonFromResponse(k.Request.DataSource);m.system=g.sap.bc.ina.api.sina.getSystem();m.top=1;l.request=s.sina.createSearchQuery(m);l.request.filter.setJsonFromResponse(k.Request.Filter);if(k.Request.Filter.Selection===undefined){l.request.invalid=true;l.request.invalidMessage="Related request '"+l.description+"' is invalid because of missing filter conditions.";}break;case"GeneralUri":l.type='Link';l.url=l.uri;break;case"SAPNavigation":l.type='Navigation';l.url=l.uri;break;}l.encodedJSON=encodeURIComponent(l);}};function h(k){this.resultElementAttribute=k;this.correspondingSearchAttributeName="";this.description="";this.isTitle=false;this.presentationUsage=[];this.displayOrder=null;this.semanticObjectType="";}h.prototype={_fromInaJson:function(k){var l=this;l.correspondingSearchAttributeName=k.correspondingSearchAttributeName||"";l.dataType=k.DataType||"";l.description=k.Description||"";l.presentationUsage=k.presentationUsage||[];l.accessUsage=k.accessUsage||[];l.semanticObjectType=k.SemanticObjectType||"";if(k.IsTitle!==undefined){l.isTitle=k.IsTitle;}l.isKey=k.IsKey;if(l.isTitle){if(!l.resultElementAttribute.resultElement.title){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.getLabel()+":";}l.resultElementAttribute.resultElement._registerPostProcessor(function(){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.title+" "+l.resultElementAttribute.value;});}if(l.isKey){if(!l.resultElementAttribute.resultElement.key){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.key+":";}l.resultElementAttribute.resultElement._registerPostProcessor(function(){if(l.resultElementAttribute.labelRaw&&l.resultElementAttribute.value){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.key+l.resultElementAttribute.labelRaw+'#'+l.resultElementAttribute.value+"/";}});}}};function p(k){this.resultElement=k;this.$$MetaData$$=new h(this);this.label="";this.labelRaw="";this.value="";this.valueRaw="";}p.prototype={_fromInaJson:function(k){var l=this;l.labelRaw=this.$$MetaData$$.correspondingSearchAttributeName||k.Name||"";l.label=this.$$MetaData$$.description||k.Name||"";l.valueRaw=k.Value||'';l.value=k.ValueFormatted||'';},toString:function(){return this.value;}};function q(){this.title="";this.$$DataSourceMetaData$$={};this.$$RelatedActions$$={};this.$$RenderingTemplateSpecification$$={};this.$$WhyFound$$=[];this.$$PostProcessors$$=[];}q.prototype={_fromInaJson:function(A){var H=this;var I=null;var J=null;for(var k=0;k<A.length;++k){var K=A[k];switch(K.Name){case"$$DataSourceMetaData$$":var L=K.Value[0];I=s.sina.createDataSource(jQuery.extend(true,{},L));H.$$DataSourceMetaData$$=I;break;case"$$AttributeMetadata$$":for(var m=0;m<K.Value.length;++m){J=K.Value[m];if(!H[J.Name]){H[J.Name]=new p(H);}H[J.Name].$$MetaData$$._fromInaJson(J);H[J.Name].$$MetaData$$.displayOrder=m;}break;case"$$ResultItemAttributes$$":for(var l=0;l<K.Value.length;++l){var M=K.Value[l];if(!H[M.Name]){H[M.Name]=new p(H);}H[M.Name]._fromInaJson(M);}break;case"$$RelatedActions$$":var N={};for(var n=0;n<K.Value.length;++n){var O=K.Value[n];var P=new f();P._fromInaJson(O);N[O.ID]=P;}H.$$RelatedActions$$=N;break;case"$$RenderingTemplateSpecification$$":for(var o=0;o<K.Value.length;++o){var Q=new R();Q._fromInaJson(K.Value[o]);if(Q.type==="ItemDetails"){H._detailTemplate=Q;}else{H.$$RenderingTemplateSpecification$$=Q;}}break;case"$$WhyFound$$":for(var z=0;z<K.Value.length;++z){var S={};S.label=K.Value[z].Description;S.labelRaw=K.Value[z].Name;S.value=K.Value[z].Value;S.valueHighlighted=S.value;S.valueRaw=K.Value[z].Value;H.$$WhyFound$$.push(S);}break;default:H[K.Name]=new p();H[K.Name].label=K.Name||"";H[K.Name].valueRaw=K.Value||K.ValueFormatted||null;H[K.Name].value=K.ValueFormatted||K.Value||null;}}for(var i=0;i<this.$$PostProcessors$$.length;i++){this.$$PostProcessors$$[i]();}var T=b.Sina.prototype.ResultElementKeyStatus;if(this.key){if(this.key.indexOf(':')===this.key.length-1){this.keystatus=T.NO_VALUE;}else{this.keystatus=T.OK;}}else{this.keystatus=T.NO_KEY;this.key='';}},_registerPostProcessor:function(k){this.$$PostProcessors$$.push(k);}};function _(v){if(v._detailTemplate&&!v.$$RelatedActions$$.$$DETAILS$$){v.$$RelatedActions$$.$$DETAILS$$={request:s.sina.createSearchQuery(),description:'',encodedJSON:'',type:'Search',uri:''};}if(v._detailTemplate&&v.$$RelatedActions$$.$$DETAILS$$){var k=new a.SearchResultSet({sina:s.sina});k.elements[0]=jQuery.extend(true,{},v);k.elements[0].$$RenderingTemplateSpecification$$=v._detailTemplate;k.totalcount=1;delete k.elements[0].$$RelatedActions$$.$$DETAILS$$;v.$$RelatedActions$$.$$DETAILS$$.request.resultSet=k;return k.elements[0];}return{};}var r={};if(!e.ItemLists){return{};}for(var i=0;i<e.ItemLists.length;i++){r[e.ItemLists[i].Name]=e.ItemLists[i];if(e.ItemLists[i].Name.toLowerCase()==="searchresult"){this.totalcount=e.ItemLists[i].TotalCount.Value;}}var t;if(e&&e.Grids&&e.Grids[0]&&e.Grids[0].Axes&&e.Grids[0].Axes[0]){t=e.Grids[0].Axes[0];}else{return{};}for(var j=0;j<t.Tuples.length;j++){var u=t.Tuples[j];if(u===undefined){continue;}var v=new q();for(var c=u.length-1;c>=0;c--){var w=t.Dimensions[c];var x=u[c];var y=r[w.ItemListName];var A=y.Items[x].NamedValues;v._fromInaJson(A);}if(t&&t.Dimensions[1]){var B=t.Dimensions[1];var C=r[B.ItemListName];var D=u[1];if(C&&C.Items&&C.Items[D]){var E=C.Items[D].NamedValues[2];if(E){v=this._postProcess4WhyFound(v,E.Value);}}}var F=_(v);this._postProcessRelatedAction(v);if(F){this._postProcessRelatedAction(F);}this.elements.push(v);var G=v.$$DataSourceMetaData$$;if(G&&G.getObjectName&&G.getObjectName().value!=="$$DataSources$$"&&G.getObjectName().value!=="$$All$$"){this.sina.setBusinessObjectMetaDataSync(G,v);}}return{};},getElements:function(){return this.elements;},_postProcessRelatedAction:function(e){if(!e.$$RelatedActions$$){return;}for(var r in e.$$RelatedActions$$){var c=e.$$RelatedActions$$[r];if(c.type==="Search"){g.sap.bc.ina.api.sina._postprocess(c,e.title);}}},_postProcess4WhyFound:function(e,m){if(e.$$WhyFound$$&&e.$$WhyFound$$.length>0){var i=e.$$WhyFound$$.length;while(i--){if(e[e.$$WhyFound$$[i].labelRaw]!==undefined&&m!==undefined){var j=m.length;while(j--){if(m[j].Name===e.$$WhyFound$$[i].labelRaw&&m[j].correspondingSearchAttributeName){e.$$WhyFound$$[i].labelRaw=m[j].correspondingSearchAttributeName;}}}}}return e;}};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;var b=g.sap.bc.ina.api.sina.base;var e=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;var R=m.ResultSetParser=function(){this.init.apply(this,arguments);};R.prototype={init:function(o){this.resultSet=o.resultSet;},parse:function(){this.enhance(this.resultSet);var a=this.resultSet.Grids[0];var r=a.Axes[0];var c=a.Axes[1];var k=function(q){return q.__key;};var p=function(q){var v;var s;var u;for(var w in q){switch(w){case'Name':s=q[w];break;case'Value':v=q[w];break;default:if(!u){u={};}u[w]=q[w];}}if(u){u.Value=v;return{name:s,value:u};}else{return{name:s,value:v};}};var f=function(q){if(!q.NamedValues){return q;}var s={};for(var i=0;i<q.NamedValues.length;++i){var u=q.NamedValues[i];var v=p(u);s[v.name]=v.value;}return s;};var t=new T({keyFunction:k,formatFunction:f});for(var i=0;i<a.Cells.length;++i){var d=a.Cells[i];var h=d.Index[0];var j=this.resolve(r,h);var l=d.Index[1];var n=this.resolve(c,l);n=[jQuery.extend({},n[0])];n[0].cell=d;var o=j;o.push.apply(o,n);t.insert(o);}return t;},resolve:function(a,c){var d=[];if(a.Tuples.length===0){return d;}var t=a.Tuples[c];for(var i=0;i<t.length;++i){var f=t[i];var h=a.Dimensions[i].ItemList.Items[f];h.__key=f;d.push(h);}return d;},enhance:function(r){var a={};for(var i=0;i<r.ItemLists.length;++i){var c=r.ItemLists[i];a[c.Name]=c;}for(var h=0;h<r.Grids.length;++h){var d=r.Grids[h];for(var j=0;j<d.Axes.length;++j){var f=d.Axes[j];for(var k=0;k<f.Dimensions.length;++k){var l=f.Dimensions[k];l.ItemList=a[l.ItemListName];}}}}};var T=function(){this.init.apply(this,arguments);};T.prototype={init:function(o){this.root={data:"root",subTree:{},children:[]};if(o&&o.keyFunction){this.keyFunction=o.keyFunction;}else{this.keyFunction=function(a){return a;};}if(o&&o.formatFunction){this.formatFunction=o.formatFunction;}else{this.formatFunction=function(a){return a;};}},insert:function(p){var a=this.root;for(var i=0;i<p.length;++i){var c=p[i];var k=this.keyFunction(c);var d=this.formatFunction(c);if(!a.subTree.hasOwnProperty(k)){var n={subTree:{},children:[],data:c,dataFormatted:d};a.subTree[k]=n;a.children.push(n);}a=a.subTree[k];}},toString:function(){var s=[];this.toStringHelper(this.root,[],s);return s.join("");},toStringHelper:function(t,p,s){var a=null;if(t===this.root){a=t.data;}else{a=this.keyFunction(t.data);}p.push(a);var h=false;for(var c in t.subTree){if(t.subTree.hasOwnProperty(c)){h=true;var d=t.subTree[c];var f=p.slice(0);this.toStringHelper(d,f,s);}}if(!h){s.push(p.toString()+"\n");}}};m.ABAPChartQuery=function(){this.init.apply(this,arguments);};m.ABAPChartQuery.prototype=jQuery.extend({},b.ChartQuery.prototype,m.Query.prototype,{init:function(p){p=p||{};m.Query.prototype.init.apply(this,[p]);b.ChartQuery.prototype.init.apply(this,[p]);this.dimensions=[];this.attributeLimit=p.attributeLimit||1000;if(jQuery.isArray(p.dimensions)){this.dimensions=p.dimensions;}else if(p.dimension){this.dimensions.push(p.dimension);}this.resultSetClass=m.ABAPChartResultSet;},getTitle:function(){if(this.resultSet&&this.resultSet.title){return this.resultSet.title;}else{return'unkown title';}},addDimension:function(d){this.dimensions.push(d);},setAttributeLimit:function(l){this.attributeLimit=l;},createJsonRequest:function(){var t=e.getABAPChartRequest();t.DataSource=this.filter.dataSource.getDataForRequest();t.Search.SearchTerms=this.filter.getSearchTerms();t.Search.Filter=this.filter.getDataForRequest();t.Search.Top=this.getTop();t.Search.Skip=this.getSkip();t.Facets.Attributes=this.dimensions;t.Facets.MaxNumberOfReturnValues=this.attributeLimit;return t;}});m.ABAPChartResultSet=function(){this.init.apply(this,arguments);};m.ABAPChartResultSet.prototype={init:function(p){this.properties=p||{};this.dimensions=[];this.elements=[];},setJsonFromResponse:function(d){var p=new m.Perspective(this.properties);p.setJsonFromResponse(d);for(var i=0;i<p.chartFacets.length;i++){this.dimensions.push(p.chartFacets[i].dimension);this.elements.push.apply(this.elements,p.chartFacets[i].query.resultSet.elements);this.title=p.chartFacets[i].title;}}};m.ChartQuery=function(){this.init.apply(this,arguments);};m.ChartQuery.prototype=jQuery.extend({},b.ChartQuery.prototype,m.Query.prototype,{init:function(p){p=p||{};m.Query.prototype.init.apply(this,[p]);b.ChartQuery.prototype.init.apply(this,[p]);this.dimensions={};this.dimensions.CustomDimension1={Axis:"Columns",Name:"CustomDimension1",Members:[]};p.dimensions=p.dimensions||{};if(jQuery.type(p.dimensions)==='array'){for(var i=0;i<p.dimensions.length;i++){this.addDimension(p.dimensions[i]);}}else if(jQuery.type(p.dimensions)==='string'||jQuery.type(p.dimensions)==='object'){this.addDimension(p.dimensions);}p.measures=p.measures||{};if(jQuery.type(p.measures)==='array'){for(var j=0;j<p.measures.length;j++){this.addMeasure(p.measures[j]);}}else if(jQuery.type(p.measures)==='object'){this.addMeasure(p.measures);}this.resultSetClass=m.ChartResultSet;},createJsonRequest:function(){var t=e.getChartRequest();t.DataSource=this.filter.dataSource.getDataForRequest();t.SearchTerms=this.filter.getSearchTerms();t.Analytics.Definition.Filter=this.filter.getDataForRequest();t.Analytics.Definition.Dimensions=[];for(var d in this.dimensions){t.Analytics.Definition.Dimensions.push(this.dimensions[d]);}return t;},count:function(d){this.addMeasure({name:d,aggregationFunction:'COUNT'});return this;},addMeasure:function(p){if(jQuery.isEmptyObject(p)){return{};}var a;if(p.aggregationFunction.toUpperCase()==='COUNT'||p.aggregationFunction.toUpperCase()==='AVG'){a=this._createAggregationDimension(p.aggregationFunction,p.name,p.aggregationFunction,p.sortOrder||undefined,p.top||undefined);}else{a=this._createAggregationDimension(p.aggregationFunction,'',p.name,p.sortOrder,p.top);delete a.AggregationDimension;delete a.Name;delete a.SortOrder;}this.dimensions.CustomDimension1.Members.push(a);return this;},addDimension:function(d,s,t){if(jQuery.type(d)==='object'){if(jQuery.isEmptyObject(d)){return{};}this.dimensions[d.name]=this._createDimension(d.name,null,d.sortOrder,d.top);}else if(jQuery.type(d)==='string'){if(!d){return{};}this.dimensions[d]=this._createDimension(d,null,s,t);}return this;},_createDimension:function(d,a,s,t){return{"Axis":a||"Rows","Name":d,"SortOrder":s||1,"Top":t||5};},_createAggregationDimension:function(a,c,n,s){return{"Aggregation":a,"AggregationDimension":c,"MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":n},"Name":n,"SortOrder":s||2};}});m.ChartResultSet=function(){this.init.apply(this,arguments);};m.ChartResultSet.prototype={init:function(p){p=p||{};this.type=p.type;this.elements=[];this.sina=p.sina;},_parseNamedValues:function(a,n,c){var t=this;for(var i=0;i<n.length;i++){var d=n[i].Name;var v=n[i].Value;a.label=n[i].ValueFormatted;a.labelRaw=n[i].Value;switch(d){case'$$DataSource$$':t._parseNamedValuesForDataSource(a,v);break;case'$$AttributeValue$$':t._parseNamedValuesForRange(a,v,c);break;}}},_parseNamedValuesForRange:function(a,v,c){var f,h,i;for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ValueID":a.label=n.ValueFormatted;f=n.Value;break;case"Value1":if(c.Cube.ObjectName&&(n.Value!==undefined)){h=this.sina.createFilterCondition(c.Cube.ObjectName,">=",n.Value,c.Cube.Description,n.ValueFormatted,n.ValueFormatted);}break;case"Value2":if(c.Cube.ObjectName&&(n.Value!==undefined)){i=this.sina.createFilterCondition(c.Cube.ObjectName,"<=",n.Value,c.Cube.Description,n.ValueFormatted,n.ValueFormatted);}break;case"Order":break;}}if(f){if(h&&i){var j=this.sina.createFilterConditionGroup();j.setOperator("AND");j.setLabel(a.label);if(h.value){j.addCondition(h);}if(i.value){j.addCondition(i);}a.labelRaw=j;}else if(h&&h.value&&(!i)){h.operator='=';a.labelRaw=h;}else if(i&&i.value&&(!h)){i.operator='=';a.labelRaw=i;}}},_parseNamedValuesForDataSource:function(a,v){a.dataSource=this.sina.createDataSource();for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ObjectName":var l=n.ValueFormatted;a.dataSource.setLabel(l);a.dataSource.setObjectName(n.Value,n.ValueFormatted);break;case"PackageName":a.dataSource.setPackageName(n.Value,n.ValueFormatted);break;case"SchemaName":a.dataSource.setSchemaName(n.Value,n.ValueFormatted);break;case"Type":a.dataSource.setType(n.Value,n.ValueFormatted);break;default:a[n.Name]=n.Value;break;}}},setJsonFromResponse:function(d){this.elements=[];var f;if(d.Metadata){f=d.Metadata;}if(d.ResultSet){d=d.ResultSet;}var h={};for(var i=0;i<d.ItemLists.length;i++){h[d.ItemLists[i].Name]=d.ItemLists[i];}for(var a=0;a<d.Grids.length;a++){var k=d.Grids[a].Axes;var l=d.Grids[a].Cells;for(var n=0;n<l.length;++n){if(k[0].Dimensions.length===1){var o=l[n];var p={valueRaw:o.Value||o.ValueFormatted||null,value:o.ValueFormatted||o.Value||null};for(var j=0;j<1;j++){var q=o.Index[j];var t=k[j].Tuples[q];if(t===undefined){continue;}for(var c=0;c<t.length;c++){var r=k[j].Dimensions[c];var s=t[c];var u=h[r.ItemListName];var v=u.Items[s].NamedValues;this._parseNamedValues(p,v,f);}}this.elements.push(p);}}}},getElements:function(){return this.elements;}};m.GroupBarChartQuery=function(){this.init.apply(this,arguments);};m.GroupBarChartQuery.prototype=jQuery.extend({},m.ChartQuery.prototype,{init:function(p){p=p||{};m.ChartQuery.prototype.init.apply(this,[p]);this.resultSetClass=m.GroupBarChartResultSet;}});m.GroupBarChartResultSet=function(){this.init.apply(this,arguments);};m.GroupBarChartResultSet.prototype={init:function(p){p=p||{};this.elements=[];},setJsonFromResponse:function(d){var t=this;this.elements=[];var r=new R({resultSet:d});var a=r.parse();function p(s,c){for(var i in s){var f=s[i];var h={label:f.data.NamedValues[0].ValueFormatted,value:[]};if(f.data.cell){h.value={value:f.data.cell.ValueFormatted,valueRaw:f.data.cell.Value};}if(c){c.value.push(h);}else{t.elements.push(h);}if(f.subTree){p(f.subTree,h);}}}p(a.root.subTree);},getElements:function(){return this.elements;}};m.LineChartQuery=function(){this.init.apply(this,arguments);};m.LineChartQuery.prototype=jQuery.extend({},m.ChartQuery.prototype,{init:function(p){p=p||{};m.ChartQuery.prototype.init.apply(this,[p]);this.resultSetClass=m.LineChartResultSet;}});m.LineChartResultSet=function(){this.init.apply(this,arguments);};m.LineChartResultSet.prototype=jQuery.extend({},m.GroupBarChartResultSet.prototype,{init:function(p){p=p||{};this.elements=[];},setJsonFromResponse:function(d){var t=this;this.elements=[];var r=new R({resultSet:d});var a=r.parse();function p(s,c){for(var f in s){var h=s[f];var i={label:h.data.NamedValues[0].ValueFormatted,value:[]};for(var j in h.subTree){var k=h.subTree[j];var l={x:k.data.NamedValues[0].ValueFormatted};for(var n in k.subTree){var o=k.subTree[n];l.y=o.data.cell.Value;}i.value.push(l);}t.elements.push(i);}}p(a.root.subTree);},getElements:function(){return this.elements;}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;var b=g.sap.bc.ina.api.sina.base;m.Facet=function(){this.init.apply(this,arguments);};m.Facet.prototype=jQuery.extend({},b.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===b.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new m.ChartResultSet({sina:this.sina});}else if(this.facetType===b.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new m.ChartResultSet({sina:this.sina});}else if(this.facetType===b.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new m.SearchResultSet({sina:this.sina});}this.query.resultSet.setJsonFromResponse(d);this._parseServerSideFacetMetaData(d.Metadata);},_parseServerSideFacetMetaData:function(d){if(d&&d.Cube){this.title=d.Cube.Description;this.dimension=d.Cube.ObjectName;}}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;var c=g.sap.bc.ina.api.sina.base;var e=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;var f=g.sap.bc.ina.api.sina.base.datasource;var h=g.sap.bc.ina.api.sina.helper;m.convertSuggestionType2InaOption=function(t){switch(t){case c.SuggestionType.HISTORY:return'SuggestSearchHistory';case c.SuggestionType.OBJECTDATA:return'SuggestObjectData';case c.SuggestionType.DATASOURCE:return'SuggestDataSources';default:throw'Unknown suggestion type '+t;}};m.convertScope2SuggestionType=function(s){switch(s){case'SearchHistory':return c.SuggestionType.HISTORY;case'ObjectData':return c.SuggestionType.OBJECTDATA;case'DataSources':return c.SuggestionType.DATASOURCE;default:return c.SuggestionType.OBJECTDATA;}};m.Suggestion=function(){this.init.apply(this,arguments);};m.SuggestionAutoQuery=function(p){if(p.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.ABAPSystem){jQuery.extend(this,m.Suggestion2Query.prototype);}if(p.system instanceof g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem){jQuery.extend(this,m.SuggestionQuery.prototype);}this.init.apply(this,arguments);};m.SuggestionQuery=function(){this.init.apply(this,arguments);};m.SuggestionQuery.prototype=jQuery.extend({},c.SuggestionQuery.prototype,m.Query.prototype,{init:function(p){p=p||{};this.attributes=p.attributes||[];m.Query.prototype.init.apply(this,arguments);c.SuggestionQuery.prototype.init.apply(this,arguments);this.resultSetClass=m.SuggestionResultSet;},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var t=e.getSuggestionRequest();t.Suggestions.Precalculated=false;var s=this.filter.getSearchTerms();if(this.attributes.length===0){throw"add at least one response attribute to your query";}t.Suggestions.SearchTerms=s;t.Suggestions.AttributeNames=this.attributes;t.DataSource=this.filter.dataSource.getDataForRequest();t.Suggestions.Top=this._top;var a=this.filter.getDataForRequest();if(a&&a.Selection){t.Suggestions.Filter=a;}return t;}});m.SuggestionResultSet=function(){this.init.apply(this,arguments);};m.SuggestionResultSet.prototype={init:function(){this.suggestions=[];},setJsonFromResponse:function(j){this.suggestions=[];var k={};for(var i=0;i<j.ItemLists.length;i++){k[j.ItemLists[i].Name]=j.ItemLists[i];}for(var a=0;a<k.Suggestions.Items.length;a++){var l=k.Suggestions.Items[a],t="",n="",p="";var s={};for(var d=0;d<l.NamedValues.length;++d){var q=l.NamedValues[d];switch(q.Name){case"Term":t=q.Value;s.label=t;break;case"AttributeName":n=q.Value;s.attribute=n;break;case"$$AttributeDescription$$":p=q.Value;s.attributeDescription=p;break;case"Score":var r=q.Value;s.score=parseInt(r,10);break;}}this.suggestions.push(s);}this.suggestions.sort(function(a,b){return b.score-a.score;});for(var o=this.suggestions.length-1;o>=0;o--){delete this.suggestions[o].score;}},getElements:function(){return this.suggestions;}};m.Suggestion2Query=function(){this.init.apply(this,arguments);};m.Suggestion2Query.prototype=jQuery.extend({},c.SuggestionQuery.prototype,m.Query.prototype,{init:function(p){p=p||{};this.attributes=p.attributes||[];m.Query.prototype.init.apply(this,[p]);c.SuggestionQuery.prototype.init.apply(this,[p]);this.resultSetClass=m.Suggestion2ResultSet;this.suggestionTerm=p.suggestionTerm||'';this.options=[];},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setSuggestionTerm:function(t){if(this.suggestionTerm!==t){this.suggestionTerm=t;this._resetResultSet();}return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var t=e.getSuggestion2Request();t.Suggestions2.Precalculated=false;t.Suggestions2.NamedValues=[];for(var i=0;i<this.attributes.length;i++){t.Suggestions2.NamedValues.push({AttributeName:this.attributes[i],Name:this.attributes[i]});}t.DataSource=this.filter.dataSource.getDataForRequest();t.Suggestions2.Top=this.getTop();t.Suggestions2.Skip=this.getSkip();var r=this.sina.createFilterConditionGroup();this.splittedSuggestionTerm=this.splitSuggestionTerm(this.suggestionTerm);if(this.splittedSuggestionTerm.searchTerm){var s=this.sina.createFilterCondition('$$SearchTerms$$','contains',this.splittedSuggestionTerm.searchTerm);r.addCondition(s);}var a=this.sina.createFilterCondition('$$SuggestionTerms$$','contains',this.splittedSuggestionTerm.suggestionTerm);r.addCondition(a);r.addCondition(this.getFilter().getFilterConditions());t.Suggestions2.Filter=r.getDataForRequest();t.Options=this.options.slice();t.Options.push.apply(t.Options,jQuery.map(this.suggestionTypes,function(b){return m.convertSuggestionType2InaOption(b);}));return t;},splitSuggestionTerm:function(t){var s=t.lastIndexOf(' ');if(s<0){return{searchTerm:null,suggestionTerm:t};}var a=t.slice(0,s);a=a.replace(/\s+$/,"");if(a.length===0){return{searchTerm:null,suggestionTerm:t};}var b=t.slice(s);b=b.replace(/^\s+/,"");if(b.length===0){return{searchTerm:null,suggestionTerm:t};}return{searchTerm:a,suggestionTerm:b};}});m.Suggestion2ResultSet=function(){this.init.apply(this,arguments);};m.Suggestion2ResultSet.prototype={init:function(p){this.datasources={};this.suggestions=[];this.sina=p.sina;this.query=p.query;},parseSuggestion:function(t,s){var a={label:s.dataFormatted.$$Term$$.ValueFormatted,labelRaw:s.dataFormatted.$$Term$$.Value,dataSource:this.query.getDataSource(),type:t,children:[]};if(this.query.getDataSource().type==='Category'||t===this.sina.SuggestionType.HISTORY){this.suggestions.push(a);}if(t===this.sina.SuggestionType.HISTORY){return;}for(var j=1;j<s.children.length;++j){var d=s.children[j];var b=this.sina.createDataSource({type:f.DataSourceType.BUSINESSOBJECT,objectName:d.dataFormatted.$$DataSource$$,label:d.dataFormatted.$$DataSourceDescription$$});var i={label:s.dataFormatted.$$Term$$.ValueFormatted,labelRaw:s.dataFormatted.$$Term$$.Value,dataSource:b,type:a.type};if(this.query.getDataSource().type==='Category'){a.children.push(i);}else{this.suggestions.push(i);}}},parseDataSourceSuggestion:function(s){var d=this.sina.createDataSource({type:f.DataSourceType.BUSINESSOBJECT,objectName:s.dataFormatted.$$Term$$.Value,label:h.removeHtmlTags(s.dataFormatted.$$Term$$.ValueFormatted)});var a={label:s.dataFormatted.$$Term$$.ValueFormatted,labelRaw:d,dataSource:d,type:this.sina.SuggestionType.DATASOURCE,children:[]};this.suggestions.push(a);},setJsonFromResponse:function(d){if(!d.Grids||!d.Grids[0]||!d.Grids[0].Axes){return;}var r=new m.ResultSetParser({resultSet:d});var t=r.parse();for(var i=0;i<t.root.children.length;++i){var s=t.root.children[i];var a=m.convertScope2SuggestionType(s.dataFormatted.$$Term$$.Scope);switch(a){case this.sina.SuggestionType.OBJECTDATA:this.parseSuggestion(a,s);break;case this.sina.SuggestionType.HISTORY:this.parseSuggestion(a,s);break;case this.sina.SuggestionType.DATASOURCE:this.parseDataSourceSuggestion(s);break;}}},getElements:function(){this.concatenateSearchTerm(this.suggestions,this.query.splittedSuggestionTerm);return this.suggestions;},escapeRegExp:function(s){return s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},concatenateSearchTerm:function(s,a){var t=this;if(!a.searchTerm){return;}var b=jQuery.map(a.searchTerm.split(' '),function(o){o=o.trim();return{term:o,regExp:new RegExp(t.escapeRegExp(o),'i')};});for(var i=0;i<s.length;++i){var d=s[i];var n=[];for(var j=0;j<b.length;++j){var k=b[j];if(!k.regExp.test(d.labelRaw)){n.push(k.term);}}var p=n.join(' ');var l=jQuery.map(n,function(o){return'<b>'+o+'</b>';}).join(' ');d.label=l+' '+d.label;d.labelRaw=p+' '+d.labelRaw;if(d.children&&d.children.length>0){this.concatenateSearchTerm(d.children,a);}}}};}(window));(function(g){"use strict";var b=g.sap.bc.ina.api.sina.base;var j=g.sap.bc.ina.api.sina.impl.inav2.jsontemplates;var f=g.sap.bc.ina.api.sina.impl.inav2.filter;var d=g.sap.bc.ina.api.sina.impl.inav2.datasource;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2');var m=g.sap.bc.ina.api.sina.impl.inav2;m.Condition=f.Condition;m.Sina=function(){this.init.apply(this,arguments);};m.CatalogQuery=function(){this.init.apply(this,arguments);};m.CatalogResultSet=function(){this.init.apply(this,arguments);};m.DataSourceQuery=function(){this.init.apply(this,arguments);};m.ESHConnectorDataSourceQuery=function(){this.init.apply(this,arguments);};m.SearchConfiguration=function(){this.init.apply(this,arguments);};m.UserHistory=function(){this.init.apply(this,arguments);};m.IMPL_TYPE="inav2";b.registerProvider({impl_type:m.IMPL_TYPE,sina:m.Sina,chartQuery:function(p){if(p.sina.getSystem()instanceof g.sap.bc.ina.api.sina.impl.inav2.system.HANASystem){return new m.ChartQuery(p);}else{return new m.ABAPChartQuery(p);}},searchQuery:m.SearchQuery,groupBarChartQuery:m.GroupBarChartQuery,lineChartQuery:m.LineChartQuery,suggestionQuery:m.SuggestionAutoQuery,perspectiveQuery:m.PerspectiveQuery,perspectiveSearchQuery:m.PerspectiveSearchQuery,perspectiveGetQuery:m.PerspectiveGetQuery,Facet:m.Facet,DataSource:d.DataSource,metaDataService:new m.MetaDataService(),Filter:f.Filter,FilterCondition:f.Condition,FilterConditionGroup:f.ConditionGroup,DataSourceQuery:m.DataSourceQuery,searchConfiguration:m.SearchConfiguration,addUserHistoryEntry:function(p){var u=new m.UserHistory(p);return u.addUserHistoryEntry(p.oEntry);},emptyUserHistory:function(p){var u=new m.UserHistory(p);return u.emptyUserHistory();}});m.Sina.prototype=jQuery.extend({},b.Sina.prototype,{init:function(p){p=p||{};this.setSystem(p.system||new m.system.HANASystem());b.Sina.prototype.init.apply(this,arguments);this.rootDataSource=new d.DataSource({objectName:"$$ALL$$",packageName:"ABAP",schemaName:"",sina:this});b.provider.inav2.metaDataService.sina=this;},getRootDataSource:function(){return this.rootDataSource;},sapclient:function(s){var a;if(s){if(s<0){a=new m.system.HANASystem();}else{a=new m.system.ABAPSystem({'sapclient':s});}this.setSystem(a);}else{return this.getSystem().properties.sapclient();}return{};},_registerPostProcessor:function(p){if(!this.postProcessor){this.postProcessor=[];}this.postProcessor.push(p);},_postprocess:function(s,a){if(this.postProcessor){for(var i=0;i<this.postProcessor.length;i++){this.postProcessor[i](s,a);}}}});m.CatalogQuery.prototype=jQuery.extend({},m.Query.prototype,{init:function(p){p=p||{};this.resultSetClass=m.SearchResultSet;},createJsonRequest:function(){return j.getCatalogRequest();}});m.DataSourceQuery.prototype=jQuery.extend({},b.SearchQuery.prototype,m.SearchQuery.prototype,{init:function(p){b.SearchQuery.prototype.init.apply(this,[p]);m.SearchQuery.prototype.init.apply(this,[p]);this.template=j.getCatalogRequest();this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();var t={"MemberOperand":{"AttributeName":"Type","Comparison":"=","Value":"View"}};var c=p.system.getService("Search").getCapabilities();if(c.PluralDescriptionForDataSource){this.template.Search.NamedValues.push({"AttributeName":"DescriptionPlural","Name":"DescriptionPlural"});}this.template.Search.Filter.Selection.Operator.SubSelections.push(t);},createJsonRequest:function(){return this.template;}});m.ESHConnectorDataSourceQuery.prototype=jQuery.extend({},b.SearchQuery.prototype,m.SearchQuery.prototype,{init:function(p){b.SearchQuery.prototype.init.apply(this,[p]);m.SearchQuery.prototype.init.apply(this,[p]);this.template=j.getESHConnectorRequest();var s=this.system.getServerInfoSync();var a=s.rawServerInfo.ServerInfo.SystemId;var c=a+this.system.sapclient()+"~ESH_CONNECTOR~";var e=p.dataSource||{SchemaName:"",PackageName:"ABAP",ObjectName:c,type:"Connector"};this.template.DataSource=e;this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();},createJsonRequest:function(){return this.template;}});m.UserHistory.prototype=jQuery.extend({},b.Query.prototype,m.Query.prototype,{init:function(p){p=p||{};b.Query.prototype.init.apply(this,[p]);m.Query.prototype.init.apply(this,[p]);},addUserHistoryEntry:function(n,a){var c={"SearchConfiguration":{"Action":"Update","ClientEvent":n}};return this._fireRequest(c,a,'text');},emptyUserHistory:function(a){var c={"SearchConfiguration":{"Action":"Update","Data":{"PersonalizedSearch":{"ResetUserData":true}}}};return this._fireRequest(c,a,'text');}});m.SearchConfiguration.prototype=jQuery.extend({},b.Query.prototype,m.Query.prototype,{init:function(p){p=p||{};b.Query.prototype.init.apply(this,[p]);m.Query.prototype.init.apply(this,[p]);},load:function(a){var c={"SearchConfiguration":{"Action":"Get","Data":{"PersonalizedSearch":{}}}};return this._fireRequest(c,a);},save:function(s,a){return this._fireRequest(s,a,'text');}});}(window));
/*
 * @file Simple info access (SINA) API: System representation
 * @namespace sap.bc.ina.api.sina.impl.inav2.system
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";var b=g.sap.bc.ina.api.sina.base;var s=b.system;var p=g.sap.bc.ina.api.sina.impl.inav2.proxy;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.inav2.system');var m=g.sap.bc.ina.api.sina.impl.inav2.system;m.ABAPSystem=function(){this.init.apply(this,arguments);};m.HANASystem=function(){this.init.apply(this,arguments);};m.ABAPSystem.prototype=jQuery.extend({},s.System.prototype,{init:function(a){a=a||{};this.systemType='ABAP';this.inaUrl=a.inaUrl||'/sap/es/ina/GetResponse';this.infoUrl=a.infoUrl||'/sap/es/ina/GetServerInfo';a.proxy=a.proxy||new p.Proxy({'xsrfService':this.infoUrl});s.System.prototype.init.apply(this,[a]);this.properties={};if(a.sapclient){this.sapclient(a.sapclient);}else{var c=this._readSapClientFromUrl();this.sapclient(c);}if(a.saplanguage){this.saplanguage(a.saplanguage);}else{var d=this._getUrlParameter("sap-language");this.saplanguage(d);}},setSinaUrlParameter:function(n,v){v=''+v;if(n.toUpperCase()==='SAP-CLIENT'&&v.length<3){for(var i=0;i<2;i++){v='0'+v;}}var a=function(u){var c=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(u)||[null])[1];if(!c){if(u.indexOf('?')===-1){u+='?'+encodeURIComponent(n)+'='+encodeURIComponent(v);}else{u+='&'+encodeURIComponent(n)+'='+encodeURIComponent(v);}}else{u=u.replace(n+'='+c,encodeURIComponent(n)+'='+encodeURIComponent(v));}return u;};this.infoUrl=a(this.infoUrl);this.inaUrl=a(this.inaUrl);},_getUrlParameter:function(n){var a=g.location.href;var v=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(a)||[null])[1];if(!v){return v;}v=decodeURIComponent(v.replace(/\+/g,' '));return v;},_readSapClientFromUrl:function(){if(g.sap.bc.ina.api.sina.properties&&g.sap.bc.ina.api.sina.properties.noSapClientFromUrl&&g.sap.bc.ina.api.sina.properties.noSapClientFromUrl===true){return'';}return this._getUrlParameter('sap-client');},sapclient:function(a){if(a){this.properties.sapclient=a;this.setSinaUrlParameter('sap-client',this.properties.sapclient);this._deleteServerInfo();this.getServerInfo();}else{return this.properties.sapclient;}},saplanguage:function(l){if(l){this.properties.saplanguage=l;this.setSinaUrlParameter('sap-language',this.properties.saplanguage);}else{return this.properties.saplanguage;}},setServerInfo:function(j){this.properties.rawServerInfo=j;if(this instanceof m.ABAPSystem){this.properties.dbms=j.ServerInfo.DataBaseManagementSystem;this.properties.sapclient=j.ServerInfo.Client;this.properties.saplanguage=j.ServerInfo.UserLanguageCode;this.properties.systemid=j.ServerInfo.SystemId;}var a;for(var i=0;i<j.Services.length;i++){var c=j.Services[i];switch(c.Service){case'Suggestions2':c.Service='Suggestions';a=new m.SuggestionService(c);break;default:a=new s.Service(c);}this.services[c.Service]=a;}this.properties.services=this.services;}});m.HANASystem.prototype=jQuery.extend({},s.System.prototype,{init:function(a){a=a||{};this.systemType='HANA';this.infoUrl=a.infoUrl||'/sap/bc/ina/service/v2/GetServerInfo';this.inaUrl=a.inaUrl||'/sap/bc/ina/service/v2/GetResponse';a.proxy=a.proxy||new p.Proxy({'xsrfService':this.infoUrl});s.System.prototype.init.apply(this,[a]);this._setUpAjaxErrorHandler();},_setUpAjaxErrorHandler:function(){jQuery(g.document).ajaxError(function(e,j,a,t){switch(j.status){case 401:g.window.location='/sap/hana/xs/formLogin/login.html?x-sap-origin-location='+encodeURIComponent(g.window.location.pathname)+encodeURIComponent(g.window.location.search);break;case 404:return;}});}});m.SuggestionService=function(){this.init.apply(this,arguments);};m.SuggestionService.prototype=jQuery.extend(Object.create(s.Service.prototype),{init:function(a){s.Service.prototype.init.apply(this,arguments);var c=false;for(var j=0;j<a.Capabilities.length;++j){var d=a.Capabilities[j];if(d.Capability==='ScopeTypes'){c=true;}}if(c){this.suggestionTypes=[b.SuggestionType.OBJECTDATA,b.SuggestionType.HISTORY,b.SuggestionType.DATASOURCE];}else{this.suggestionTypes=[b.SuggestionType.OBJECTDATA];}}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2.datasource');var m=g.sap.bc.ina.api.sina.impl.odata2.datasource;var d=g.sap.bc.ina.api.sina.base.datasource;m.DataSource=function(){this.init.apply(this,arguments);};m.DataSource.prototype=jQuery.extend({},d.DataSource.prototype,{init:function(p){p=p||{};d.DataSource.prototype.init.apply(this,arguments);this.type=p.type||d.DataSourceType.BUSINESSOBJECT;this.entityType=p.entityType||p.name;this.name=p.name||'';this.schema=p.schema||'';this.label=p.label||'icognito datasource';this.labelPlural=p.labelPlural||'icognito datasource plural';this.sina=p.sina||null;this.constructKey();if(!this.key){throw'Datasource has no key!! '+JSON.stringify(p);}},constructKey:function(){this.key=this.type+'/'+this.entityType;},getIdentifier:function(){return this.name;},getType:function(){return this.type;},getEntityType:function(){return this.entityType;},getLabel:function(){return this.label;},getSchema:function(){return this.schema;},getLabelPlural:function(){return this.labelPlural;},getName:function(){return this.name;},clone:function(){var n=this.sina.createDataSource();n.type=this.type;n.entityType=this.entityType;n.name=this.name;n.schema=this.schema;n.label=this.label;n.labelPlural=this.labelPlural;n.key=this.key;return n;},setJson:function(j){this.type=j.type;this.entityType=j.entityType;this.schema=j.schema;this.label=j.label;this.labelPlural=j.labelPlural;this.name=j.name;this.constructKey();},getJson:function(){return{type:this.type,entityType:this.entityType,schema:this.schema,label:this.label,labelPlural:this.labelPlural,name:this.name};}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2.filter');var m=g.sap.bc.ina.api.sina.impl.odata2.filter;var f=g.sap.bc.ina.api.sina.base.filter;m.Filter=function(){this.init.apply(this,arguments);};m.Filter.prototype=jQuery.extend({},f.Filter.prototype,{init:function(p){f.Filter.prototype.init.apply(this,[p]);},hasFilterCondition:function(){return false;},getDataForRequest:function(){return this.defaultConditionGroup.getDataForRequest();}});m.Condition=function(){this.init.apply(this,arguments);};m.Condition.prototype=jQuery.extend(Object.create(f.Condition.prototype),{init:function(a,o,v,s){g.sap.bc.ina.api.sina.base.filter.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(){return this.attribute+" "+m.nomalizeOperator(this.operator)+" '"+this.value+"'";}});m.ConditionGroup=function(){this.init.apply(this,arguments);};m.ConditionGroup.prototype=jQuery.extend(Object.create(f.ConditionGroup.prototype),{init:function(p){f.ConditionGroup.prototype.init.apply(this,[p]);},getDataForRequest:function(){var r=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];var a=c.getDataForRequest();if(a){r.push(c.getDataForRequest());}}var b=r.join(' '+m.nomalizeOperator(this.operator)+' ');if(r.length>1){b='('+b+')';}return b;}});m.nomalizeOperator=function(o){o=o.toLowerCase();switch(o){case'=':o='eq';break;case'!=':o='ne';break;case'>':o='gt';break;case'>=':o='ge';break;case'<':o='lt';break;case'<=':o='le';break;}return o;};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2.system');var m=g.sap.bc.ina.api.sina.impl.odata2.system;var b=g.sap.bc.ina.api.sina.base;var s=b.system;m.System=function(){this.init.apply(this,arguments);};m.System.prototype=jQuery.extend({},s.System.prototype,{init:function(p){p=p||{};s.System.prototype.init.apply(this,[p]);},getServerInfo:function(){return jQuery.when({rawServerInfo:{Services:[{Service:'Suggestions2',Capabilities:[{Capability:'ScopeTypes'}]}]},services:{Suggestions:{suggestionTypes:['objectdata']},Search:{capabilities:['search']}}});}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;m.MetaDataService=function(){this.init.apply(this,arguments);};m.MetaDataService.prototype={init:function(p){p=p||{};this.sina=p.sina||null;this.allInOneMap={};this.allInOneMapDeferred=null;this.presentationUsageConversionMap={TITLE:'Title',SUMMARY:'Summary',DETAIL:'Detail'};},getDataSources:function(){var t=this;return t._fillInternalBuffer().then(function(){return t.allInOneMap.dataSourcesList;});},getDataSourcesSync:function(){this._fillInternalBufferSync();return this.allInOneMap.dataSourcesList;},getDataSource:function(d){var t=this;var e=d.getName();if(!e){throw'EntitySetName missing';}return t._fillInternalBuffer().then(function(){return t.allInOneMap.dataSourceMap[e];});},getDataSourceByBusinessObjectName:function(e){var t=this;if(!e){throw'EntitySetName missing';}return t._fillInternalBuffer().then(function(){return t.allInOneMap.dataSourceMap[e];});},getDataSourceSync:function(d){var e=d.getName();if(!e){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[e];},getDataSourceSyncByBusinessObjectName:function(e){if(!e){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[e];},getBusinessObjectsMetaData:function(){var t=this;return t._fillInternalBuffer().then(function(){return t.allInOneMap.businessObjectList;});},getBusinessObjectsMetaDataSync:function(){this._fillInternalBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(d){var t=this;var e=d.getName();if(!e){throw'EntitySetName missing';}return t._fillInternalBuffer().then(function(){return t.allInOneMap.businessObjectMap[e];});},getBusinessObjectMetaDataByBusinessObjectName:function(e){var t=this;if(!e){throw'EntitySetName missing';}return t._fillInternalBuffer().then(function(){return t.allInOneMap.businessObjectMap[e];});},getBusinessObjectMetaDataSync:function(d){var e=d.getName();if(!e){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[e];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(e){if(!e){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[e];},_fillInternalBufferSync:function(){if(this.allInOneMap&&jQuery.isEmptyObject(this.allInOneMap)!==true){return;}this.allInOneMap=this._fireMetaRequest(false);},_fillInternalBuffer:function(){var t=this;if(this.allInOneMapDeferred){return this.allInOneMapDeferred;}t.allInOneMapDeferred=t._fireMetaRequest().then(function(a){t.allInOneMap=a;});return t.allInOneMapDeferred;},_parseEntityType:function(s){var t=this;var h={};s.find('EntityType').each(function(){var e=$(this).attr('Name');var a={schema:s.attr('Namespace'),keys:[],attributeMap:{}};h[e]=a;$(this).find('Key>PropertyRef').each(function(){a.keys.push($(this).attr('Name'));});$(this).find('Property').each(function(i){var b=$(this).attr('Name');var c={labelRaw:b,label:null,type:$(this).attr('Type'),isTitle:false,presentationUsage:[],displayOrder:i,unknownAnnotation:[]};a.attributeMap[b]=c;$(this).find('Annotation').each(function(){switch($(this).attr('Term')){case'SAP.Common.Label':c.label=$(this).attr('String');break;case'EnterpriseSearch.key':c.enterprisesearchkey=$(this).attr('Bool')=="true"?true:false;break;case'EnterpriseSearch.presentationMode':$(this).find('Collection>String').each(function(){var p=$(this).text();p=t.presentationUsageConversionMap[p];if(p){c.presentationUsage.push(p);if(p.toLocaleLowerCase()==='title'){c.isTitle=true;}}});break;default:c.unknownAnnotation.push($(this));}});});});return h;},_parseEntityContainer:function(s,h,a){var t=this;s.find('EntityContainer>EntitySet').each(function(){if($(this).attr('Name')&&$(this).attr('EntityType')){var n=$(this).attr('Name');var e=$(this).attr('EntityType');var b=e.slice(0,e.lastIndexOf('.'));var c=e.slice(e.lastIndexOf('.')+1);var d=t.sina.createDataSource({label:n,labelPlural:n,entityType:c,name:n,schema:b,sina:t.sina});a.dataSourceMap[n]=d;a.dataSourcesList.push(d);var f=h[c];if(f===undefined){throw'EntityType '+c+' has no corresponding meta data!';}f.name=n;f.dataSource=d;a.businessObjectMap[n]=f;a.businessObjectList.push(f);}});},_parseResponse:function(a,d){var t=this;var b={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[]};$(a).find('Schema').each(function(){var h=t._parseEntityType($(this));t._parseEntityContainer($(this),h,b);});return b;},_fireMetaRequest:function(a){var t=this;var u='/es/odata/callbuildin.xsjs/$metadata';var r={async:a===undefined?true:a,method:'GET',url:u,processData:false,dataType:'xml'};var b=$.ajax(r);if(r.async){return b.then(function(c){return t._parseResponse(c);});}else{var c=b.responseXML;return t._parseResponse(c);}}};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;m.PerspectiveQuery=function(){this.init.apply(this,arguments);};m.PerspectiveQuery.prototype=jQuery.extend({},b.PerspectiveQuery.prototype,{init:function(){b.PerspectiveQuery.prototype.init.apply(this,arguments);},_resetResultSet:function(){b.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},execute:function(){var t=this;var s=t.filter.searchTerms;var p;var d=t.filter.dataSource;var a=t.top()||10;var c=t.skip()||0;var f=5;var e="Search.search(query='";if(!d.equals(t.sina.getRootDataSource())){e+="scope:"+d.name+" ";}e+=s+"')";var h='';var i=t.filter.getDataForRequest();if(i){h=h+' and '+i;}var j='filter('+e+h+')';var k={$count:true,$top:a,$skip:c,$apply:j,whyfound:true};var u='/es/odata/callbuildin.xsjs/$all';if(this.requestedEntities.indexOf('Facets')>-1){k.facets='all';k.facetlimit=f;}return $.ajax({method:'GET',data:k,url:u}).then(function(k){p=new m.Perspective({sina:t.sina,dataSource:t.filter.dataSource});return p.setJsonFromResponse(k);});}});m.Perspective=function(){this.init.apply(this,arguments);};m.Perspective.prototype=jQuery.extend({},b.Perspective.prototype,{setJsonFromResponse:function(d){var t=this;t.searchFacet=this.sina.createFacet({"facetType":b.FacetType.SEARCH});var r=t.searchFacet.setJsonFromResponse(d);t.chartFacets=[];var f=d['@com.sap.vocabularies.Search.v1.Facets'];if(f){for(var i=0;i<f.length;++i){var a=f[i];var c=a['@com.sap.vocabularies.Search.v1.Facet.isConnectorFacet'];var e=this.sina.createFacet({"facetType":c===true?b.FacetType.DATASOURCE:b.FacetType.ATTRIBUTE,dataSource:t.dataSource});e.setJsonFromResponse(a);t.chartFacets.push(e);}}return jQuery.when([r]).then(function(){return t;});}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;m.SearchQuery=function(){this.init.apply(this,arguments);};m.SearchQuery.prototype=jQuery.extend({},b.SearchQuery.prototype,{init:function(){b.SearchQuery.prototype.init.apply(this,arguments);this.resultSet=new m.SearchResultSet({sina:this.sina});},executeSync:function(){return this.resultSet;}});m.SearchResultSet=function(){this.init.apply(this,arguments);};m.SearchResultSet.prototype={init:function(p){p=p||{};this.sina=p.sina;this.elements=[];this.totalcount=0;this.dataSource=p.dataSource;},getElements:function(){return this.elements;},createEmptyElement:function(d){return{$$RelatedActions$$:[],$$WhyFound$$:[],$$DataSourceMetaData$$:d};},createAttribute:function(a,c,d,e){var f;if(e){switch(e.type){case"Edm.DateTime":var r=/[-]?\d+/;var D=new Date(parseInt(r.exec(c)[0],10));var o=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});c=o.format(D);break;}f={$$MetaData$$:{presentationUsage:e.presentationUsage,displayOrder:e.displayOrder},label:e.label,labelRaw:e.labelRaw,value:c,valueRaw:c};}else{f={$$MetaData$$:{presentationUsage:[],displayOrder:d},label:a,labelRaw:a,value:c,valueRaw:c};}return f;},parseRecord:function(r){var t=this;var e=r['@odata.context']||t.dataSource.entityType;var p=e.lastIndexOf('#');if(p>-1){e=e.slice(p+1);}var w=r['@com.sap.vocabularies.Search.v1.WhyFound']||{};return t.sina.getBusinessObjectMetaDataByBusinessObjectName(e).then(function(a){var c=t.createEmptyElement(a.dataSource);var d=0;for(var f in r){if(f[0]==='@'||f[0]==='_'){continue;}var h=r[f];for(var i in w){if(i===f&&w[i][0]){h=w[i][0];}}c[f]=t.createAttribute(f,h,++d,a.attributeMap[f]);}return c;});},setJsonFromResponse:function(d){var t=this;t.totalcount=d['@odata.count']||0;t.totalcount=parseInt(t.totalcount,10);var r=d.value||d.d.results;var e=[];t.elements=[];for(var i=0;i<r.length;++i){var a=r[i];e.push(this.parseRecord(a).done(function(c){t.elements.push(c);}));}return jQuery.when.apply(null,e).then(function(){return arguments;});}};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;m.ChartQuery=function(){this.init.apply(this,arguments);};m.ChartQuery.prototype=jQuery.extend({},b.ChartQuery.prototype,{init:function(p){p=p||{};b.ChartQuery.prototype.init.apply(this,[p]);this.dimensions=[];this.attributeLimit=1000;},executeSync:function(){return this.resultSet;},addDimension:function(d){if(jQuery.type(d)==='object'){if(jQuery.isEmptyObject(d)||!d.name){return;}this.dimensions.push(d.name);}else if(jQuery.type(d)==='string'){if(!d){return;}this.dimensions.push(d);}},setAttributeLimit:function(l){this.attributeLimit=l;},getTitle:function(d){if(d===undefined&&this.filter.dataSource&&this.filter.dataSource.name){d=this.filter.dataSource.name;}if(!d){return'Default Title';}var a=this.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(d).attributeMap;var l=a[this.dimensions[0]].label;return l;},execute:function(){var t=this;var s=t.filter.searchTerms;var d=t.filter.dataSource;var a=this.attributeLimit||5;var c=0;var e=t.dimensions[0];var f="Search.search(query='";if(!d.equals(t.sina.getRootDataSource())){f+="scope:"+d.name+" ";}f+=s+"')";var h='';var i=t.filter.getDataForRequest();if(i){h=h+' and '+i;}var j='';if(e){j='/groupby(('+e+'),aggregate($count as _Count))';}var k='filter('+f+h+')'+j;var l={$count:true,$top:a,$skip:c,$apply:k};var u='/es/odata/callbuildin.xsjs/$all';return $.ajax({method:'GET',data:l,url:u}).then(function(l){var r=new m.ChartResultSet({dimensions:t.dimensions,sina:t.sina,datasource:t.filter.dataSource});return r.setJsonFromResponseGroupBy(l);});}});m.ChartResultSet=function(){this.init.apply(this,arguments);};m.ChartResultSet.prototype={init:function(p){p=p||{};this.type=p.type;this.sina=p.sina;this.datasource=p.datasource;this.elements=[];this.dimensions=p.dimensions;},setJsonFromResponse:function(d){var a=d['@com.sap.vocabularies.Common.v1.Facet.PropertyName'];var c=d['@com.sap.vocabularies.Search.v1.Facet.isConnectorFacet'];this.elements=[];for(var i=0;i<d.Items.length;++i){var e=d.Items[i];var f={};if(c==true){var h=this.sina.getDataSourceSyncByBusinessObjectName(e[a]);f={dataSource:h,label:h.getLabel(),labelRaw:e[a],value:e._Count,valueRaw:e._Count};}else{var j=e[a+'@com.sap.vocabularies.Common.v1.Label'];f={label:j,labelRaw:this.sina.createFilterCondition(a,"eq",e[a],this.datasource.getMetaDataSync().attributeMap[a].label,j,j),value:e._Count,valueRaw:e._Count};}this.elements.push(f);}},setJsonFromResponseGroupBy:function(d){var t=this;var a=t.dimensions[0];var l=a+'@com.sap.vocabularies.Common.v1.Label';var r=d.value;for(var i=0;i<r.length;++i){var c=r[i];var e={label:c[l],labelRaw:this.sina.createFilterCondition(a,"eq",c[a],this.datasource.getMetaDataSync().attributeMap[a].label,c[l],c[l]),value:c._Count,valueRaw:c._Count};t.elements.push(e);}return t;},getElements:function(){return this.elements;}};}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;m.Facet=function(){this.init.apply(this,arguments);};m.Facet.prototype=jQuery.extend({},b.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===b.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new m.ChartResultSet({sina:this.sina});}else if(this.facetType===b.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new m.ChartResultSet({sina:this.sina,datasource:this.dataSource});}else if(this.facetType===b.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new m.SearchResultSet({sina:this.sina});}if(this.facetType===b.FacetType.ATTRIBUTE){this.dimension=d['@com.sap.vocabularies.Common.v1.Facet.PropertyName'];this.query.addDimension(this.dimension);this.title=d['@com.sap.vocabularies.Common.v1.Label'];}return this.query.resultSet.setJsonFromResponse(d);}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;m.SuggestionQuery=function(){this.init.apply(this,arguments);};m.SuggestionQuery.prototype=jQuery.extend({},b.SuggestionQuery.prototype,{init:function(){b.SuggestionQuery.prototype.init.apply(this,arguments);this.suggestionTerm=null;this.options=[];this.deferredResultSet=null;},setOptions:function(o){this.options=o;this._resetResultSet();},setSuggestionTerm:function(t){if(this.suggestionTerm!==t){this.suggestionTerm=t;this._resetResultSet();}return this;},_resetResultSet:function(){this.deferredResultSet=null;},execute:function(){var t=this;if(this.deferredResultSet){return this.deferredResultSet;}if(this.suggestionTypes.indexOf(this.sina.SuggestionType.OBJECTDATA)<0){this.deferredResultSet=jQuery.when(new m.SuggestionResultSet({sina:this.sina}));return this.deferredResultSet;}var u="/es/odata/callbuildin.xsjs/$all/GetSuggestion(term='"+this.suggestionTerm+"')";this.deferredResultSet=$.ajax({method:'GET',url:u}).then(function(d){var r=new m.SuggestionResultSet({sina:t.sina});return r.setJsonFromResponse(d);});return this.deferredResultSet;}});m.SuggestionResultSet=function(){this.init.apply(this,arguments);};m.SuggestionResultSet.prototype=jQuery.extend({},b.SuggestionQuery.prototype,{init:function(p){this.sina=p.sina;this.elements=[];},setJsonFromResponse:function(d){var t=this;return t.sina.getDataSources().then(function(a){var s=d.value;for(var i=0;i<s.length;++i){var c=s[i];var e={children:[],label:c.term,labelRaw:c.term,value:0,valueRaw:0,dataSource:t.sina.getRootDataSource(),type:t.sina.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};t.elements.push(e);e={children:[],label:c.term,labelRaw:c.term,value:0,valueRaw:0,dataSource:t.sina.getDataSourceSyncByBusinessObjectName(c.scope),type:t.sina.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};t.elements.push(e);}return t;});},getElements:function(){return this.elements;}});}(window));(function(g){"use strict";g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina.impl.odata2');var m=g.sap.bc.ina.api.sina.impl.odata2;var b=g.sap.bc.ina.api.sina.base;var s=g.sap.bc.ina.api.sina.impl.odata2.system;var f=g.sap.bc.ina.api.sina.impl.odata2.filter;var d=g.sap.bc.ina.api.sina.impl.odata2.datasource;var p=g.sap.bc.ina.api.sina.proxy;var a=g.sap.bc.ina.api.sina.base.datasource;m.Sina=function(){this.init.apply(this,arguments);};m.Sina.prototype=jQuery.extend({},b.Sina.prototype,{init:function(){this.setSystem(new s.System({proxy:new p.Proxy({})}));b.Sina.prototype.init.apply(this,arguments);this.rootDataSource=new d.DataSource({label:'All',labelPlural:'All',name:'$$ALL$$',type:a.DataSourceType.CATEGORY,sina:this});b.provider.odata2.metaDataService.sina=this;},getRootDataSource:function(){return this.rootDataSource;}});m.IMPL_TYPE='odata2';b.registerProvider({impl_type:m.IMPL_TYPE,sina:m.Sina,Facet:m.Facet,chartQuery:m.ChartQuery,searchQuery:m.SearchQuery,suggestionQuery:m.SuggestionQuery,perspectiveQuery:m.PerspectiveQuery,metaDataService:new m.MetaDataService(),Filter:f.Filter,FilterCondition:f.Condition,FilterConditionGroup:f.ConditionGroup,DataSource:d.DataSource});}(window));
/*
 * @file Simple info access (SINA) API: Factory
 * @namespace sap.bc.ina.api.sina
 * @requires jQuery
 * @copyright 2014 SAP SE. All rights reserved.
 */
(function(g){"use strict";var b=g.sap.bc.ina.api.sina.base;g.sap.bc.ina.api.sina.expandPackage(g,'sap.bc.ina.api.sina');var m=g.sap.bc.ina.api.sina;m.properties=m.properties||{};if(m.impl&&m.impl.inav2&&m.impl.inav2.IMPL_TYPE){m.SINA_TYPE_INAV2=m.impl.inav2.IMPL_TYPE;}m.getSina=function(p){p=p||{};p.impl_type=p.impl_type||m.SINA_TYPE_INAV2;if(p.impl_type===m.SINA_TYPE_INAV2){if(!p.system){var i=m.impl.inav2.proxy;var a=m.impl.inav2.system;var n=new i.Proxy(p);var s;if(p.systemType&&p.systemType.toUpperCase()==='ABAP'){s=new a.ABAPSystem({'proxy':n});}else{s=new a.HANASystem({'proxy':n});}n.setXSRFService(s.infoUrl);p.system=s;}}if(b.provider[p.impl_type]&&b.provider[p.impl_type].sina){var c=new b.provider[p.impl_type].sina(p);c._provider=b.provider[p.impl_type];return c;}return{};};m.properties.impl_type=m.properties.impl_type||'inav2';g.sap.bc.ina.api.sina=jQuery.extend({},m,m.getSina(m.properties));return g.sap.bc.ina.api.sina;}(window));
