(function(){jQuery.sap.declare("sap.ushell.plugins.rta.Component");jQuery.sap.require("sap.ui.core.Component");jQuery.sap.require("sap.ui.model.resource.ResourceModel");"use strict";sap.ui.core.Component.extend("sap.ushell.plugins.rta.Component",{metadata:{manifest:"json"},_getRendererExtensions:function(){var d=jQuery.Deferred();var r=jQuery.sap.getObject("sap.ushell.renderers.fiori2.RendererExtensions");if(r){d.resolve(r);}else{sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","rendererLoaded",function(){d.resolve(jQuery.sap.getObject("sap.ushell.renderers.fiori2.RendererExtensions"));});}return d.promise();},init:function(){var t=this;this._oRTA=null;this.i18n=this.getModel("i18n").getResourceBundle();this._getRendererExtensions().done(function(r){sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","componentCreated",function(c,e,d){t._switchComponent.call(t,d);});var _=function(e){var s=((sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>10)||sap.ui.Device.browser.webkit||sap.ui.Device.browser.firefox);if(!s){sap.m.MessageBox.error(t.i18n.getText("MSG_UNSUPPORTED_BROWSER"),{title:t.i18n.getText("ERROR_TITLE"),onClose:null});}else{if(location.hash){t._switchToAdaptionMode();}}};var b=new sap.m.Button({icon:"sap-icon://wrench"});b.setText(t.i18n.getText("RTA_BUTTON_TEXT"));var h=location.hash.replace("#","");if(h){b.setEnabled((h.indexOf("Shell")!==0));}else{b.setEnabled(false);}b.attachPress(_,this);r.addOptionsActionSheetButton(b);sap.ui.core.routing.HashChanger.getInstance().attachEvent("shellHashChanged",function(e){var n=e.getParameter("newShellHash");var h=location.hash.replace("#","");if(n){b.setEnabled((n.indexOf("Shell")!==0));}else{if(h){b.setEnabled((h.indexOf("Shell")!==0));}else{b.setEnabled(false);}}});});},_switchToDefaultMode:function(){if(this._oRTA){this._oRTA.destroy();this._oRTA=null;}},_switchComponent:function(d){var c=d.component;this.oRootControl=c.getAggregation("rootControl");},_switchToAdaptionMode:function(){var t=this;if(!this._oRTA){sap.ui.core.BusyIndicator.show(0);setTimeout(function(){try{jQuery.sap.require("sap.ui.rta.RuntimeAuthoring");t._oRTA=new sap.ui.rta.RuntimeAuthoring({rootControl:t.oRootControl});t._oRTA.attachEvent('start',function(){sap.ui.core.BusyIndicator.hide();},t);t._oRTA.start();t._oRTA.attachEvent('stop',t._switchToDefaultMode,t);}catch(e){sap.ui.core.BusyIndicator.hide();}},100);}}});})();
