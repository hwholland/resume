/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
jQuery.sap.declare("sap.ushell.ui.footerbar.AddBookmarkButton");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.m.Button");sap.m.Button.extend("sap.ushell.ui.footerbar.AddBookmarkButton",{metadata:{library:"sap.ushell",properties:{"beforePressHandler":{type:"any",group:"Misc",defaultValue:null},"afterPressHandler":{type:"any",group:"Misc",defaultValue:null},"title":{type:"string",group:"Misc",defaultValue:null},"subtitle":{type:"string",group:"Misc",defaultValue:null},"info":{type:"string",group:"Misc",defaultValue:null},"tileIcon":{type:"string",group:"Misc",defaultValue:null},"numberUnit":{type:"string",group:"Misc",defaultValue:null},"keywords":{type:"string",group:"Misc",defaultValue:null},"customUrl":{type:"any",group:"Misc",defaultValue:null},"serviceUrl":{type:"any",group:"Misc",defaultValue:null},"serviceRefreshInterval":{type:"string",group:"Misc",defaultValue:null},"showGroupSelection":{type:"boolean",group:"Misc",defaultValue:true},"appData":{type:"object",group:"Misc",defaultValue:null}}}});(function(){"use strict";jQuery.sap.require("sap.ui.layout.form.SimpleForm");jQuery.sap.require("sap.m.Label");jQuery.sap.require("sap.m.Input");jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.ushell.resources");jQuery.sap.declare("sap.ushell.ui.footerbar.AddBookmarkButton");sap.ushell.ui.footerbar.AddBookmarkButton.prototype.init=function(){this.setIcon('sap-icon://add-favorite');this.setText(sap.ushell.resources.i18n.getText("addToHomePageBtn"));this.setEnabled();this.oModel=new sap.ui.model.json.JSONModel({showGroupSelection:true,title:'',subtitle:'',numberValue:'',info:'',icon:'',numberUnit:'',keywords:''});var t=this;this.attachPress(function(){if(t.getBeforePressHandler()){t.getBeforePressHandler()();}t.showAddBookmarkDialog(function(){if(t.getAfterPressHandler()){t.getAfterPressHandler()();}});});if(sap.m.Button.prototype.init){sap.m.Button.prototype.init.apply(this,arguments);}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.exit=function(){if(this.oDialog){this.oDialog.destroy();}if(this.oModel){this.oModel.destroy();}if(sap.m.Button.prototype.exit){sap.m.Button.prototype.exit.apply(this,arguments);}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setBookmarkTileView=function(v){this.bookmarkTileView=v;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.getBookmarkTileView=function(){return this.bookmarkTileView;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.showAddBookmarkDialog=function(c){this.oResourceBundle=sap.ushell.resources.i18n;this.appData=this.getAppData()||{};var t=this;this.cb=c;var i=jQuery.isEmptyObject(this.appData),b=sap.ui.view({type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.ushell.ui.footerbar.SaveAsTile",viewData:{appData:this.appData,serviceUrl:i?this.getServiceUrl():this.appData.serviceUrl,customUrl:i?this.getCustomUrl():this.appData.customUrl,numberUnit:i?this.getNumberUnit():this.appData.numberUnit,serviceRefreshInterval:i?this.getServiceRefreshInterval():this.appData.serviceRefreshInterval,keywords:i?this.getKeywords():this.appData.keywords}});if(jQuery.isEmptyObject(this.appData)){b.setModel(this.oModel);}t.setBookmarkTileView(b);this.oSimpleForm=new sap.ui.layout.form.SimpleForm({id:'bookmarkFormId',layout:sap.ui.layout.form.SimpleFormLayout.GridLayout,content:[b]}).addStyleClass("sapUshellAddBookmarkForm");var d=t._openDialog(this.oSimpleForm);b.getTitleInput().attachLiveChange(function(){t._toggleOkButton(this.getValue().trim(),d.getBeginButton());});};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._toggleOkButton=function(v,o){o.setEnabled(v?true:false);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._openDialog=function(c){var e=this.bookmarkTileView.getTitleInput().getValue().length?true:false,o=new sap.m.Button('bookmarkOkBtn',{text:this.oResourceBundle.getText('okBtn'),press:this._handleOkButtonPress.bind(this),enabled:e}),a=new sap.m.Button('bookmarkCancelBtn',{text:this.oResourceBundle.getText('cancelBtn'),press:function(){this.oDialog.close();this.cb();}.bind(this)});this.oDialog=new sap.m.Dialog({id:'bookmarkDialog',title:this.oResourceBundle.getText('addToHomePageBtn'),contentWidth:'25rem',content:c,beginButton:o,endButton:a,stretch:sap.ui.Device.system.phone,horizontalScrolling:false,afterClose:function(){this.oDialog.destroy();delete(this.oDialog);}.bind(this)});this.oDialog.open();return this.oDialog;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setTitle=function(t){this.setProperty("title",t,true);this.oModel.setProperty("/title",t);var o=sap.ui.getCore().byId("bookmarkOkBtn");if(o){this._toggleOkButton(t,o);}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setSubtitle=function(s){this.setProperty("subtitle",s,true);this.oModel.setProperty("/subtitle",s);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setInfo=function(i){this.setProperty("info",i,true);this.oModel.setProperty("/info",i);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setTileIcon=function(i){this.setProperty("tileIcon",i,true);this.oModel.setProperty("/icon",i);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setShowGroupSelection=function(s){this.setProperty("showGroupSelection",s,true);this.oModel.setProperty("/showGroupSelection",s);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setNumberUnit=function(n){this.setProperty("numberUnit",n,true);this.oModel.setProperty("/numberUnit",n);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setKeywords=function(k){this.setProperty("keywords",k,true);this.oModel.setProperty("/keywords",k);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._restoreDialogEditableValuesToDefault=function(){if(this.oModel){this.oModel.setProperty('/title',this.getTitle());this.oModel.setProperty('/subtitle',this.getSubtitle());this.oModel.setProperty('/info',this.getInfo());}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._handleOkButtonPress=function(){var b=this.getBookmarkTileView(),d=b.getBookmarkTileData(),t=d.group?d.group.object:"";delete d.group;var r=sap.ushell.Container.getService("Bookmark").addBookmark(d,t),R=sap.ushell.resources.i18n;r.done(function(){jQuery.proxy(this._restoreDialogEditableValuesToDefault(),this);if(sap.ushell.Container){sap.ushell.Container.getService('Message').info(R.getText('tile_created_msg'));}}.bind(this));r.fail(function(m){jQuery.sap.log.error("Failed to add bookmark",m,"sap.ushell.ui.footerbar.AddBookmarkButton");if(sap.ushell.Container){sap.ushell.Container.getService('Message').error(R.getText('fail_to_add_tile_msg'));}});this.oDialog.close();this.cb();};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setEnabled=function(e){var s="",p=true,S;if(sap.ushell.renderers&&sap.ushell.renderers.fiori2){S=sap.ushell.renderers.fiori2.RendererExtensions.getConfiguration();if(S.appState){s=S.appState;}if(S.enablePersonalization!==undefined){p=S.enablePersonalization;}}if(s==='headerless'||s==='standalone'||s==='embedded'||!p){e=false;}if(!sap.ushell.Container){if(this.getEnabled()){jQuery.sap.log.warning("Disabling 'Save as Tile' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.AddBookmarkButton");}e=false;}sap.m.Button.prototype.setEnabled.call(this,e);if(!e){this.addStyleClass("sapUshellAddBookmarkButton");}};}());
