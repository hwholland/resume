/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/ui/model/json/JSONModel","jquery.sap.global","sap/ui/documentation/sdk/model/sourceFileDownloader","sap/ui/documentation/sdk/model/formatter","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator",'sap/ui/documentation/sdk/model/libraryData'],function(q,B,R,D,J,$,s,f,M,a,F,b,l){"use strict";return B.extend("sap.ui.documentation.sdk.controller.DemoApps",{formatter:f,onInit:function(){var m=new J(),i=new R({bundleName:"sap.ui.documentation.sdk.i18n.i18n"});this.getView().setModel(i,"i18n");l.fillJSONModel(m);this.setModel(m);this.getRouter().getRoute("demoapps").attachPatternMatched(this._onMatched,this);sap.ui.getVersionInfo({async:true}).then(function(v){var V=new J({isOpenUI5:v&&v.gav&&/openui5/i.test(v.gav)});this.getView().setModel(V,"appView");}.bind(this));this._onOrientationChange({landscape:D.orientation.landscape});this._onResize({name:(D.resize.width<=600?"Phone":"NoPhone")});},onBeforeRendering:function(){this._deregisterOrientationChange();},onAfterRendering:function(){this._registerOrientationChange();this._registerResize();},onExit:function(){this._deregisterOrientationChange();this._deregisterResize();},_registerOrientationChange:function(){D.orientation.attachHandler(this._onOrientationChange,this);},_deregisterOrientationChange:function(){D.media.detachHandler(this._onOrientationChange,this);},_registerResize:function(){D.media.attachHandler(this._onResize,this);},_deregisterResize:function(){D.orientation.detachHandler(this._onResize,this);},_onOrientationChange:function(e){this.byId("phoneImage").toggleStyleClass("phoneHeaderImageLandscape",e.landscape);},_onResize:function(e){this.byId("phoneImage").setVisible(e.name==="Phone");this.byId("desktopImage").setVisible(e.name!=="Phone");this.byId("phoneImage").toggleStyleClass("phoneHeaderImageDesktop",e.name==="Phone");},_onMatched:function(){try{this.hideMasterSide();}catch(e){q.sap.log.error(e);}},onDownloadButtonPress:function(e){var d=this.byId("downloadDialog");this._oDownloadButton=e.getSource();d.getBinding("items").filter([]);d.open();d._oDialog.setContentHeight("");},onReadMoreButtonPress:function(){window.open("#/topic/a3ab54ecf7ac493b91904beb2095d208","_blank");},onSearch:function(e){e.getParameters().itemsBinding.filter([new F("name",b.Contains,e.getParameters().value)]);},onDownloadPress:function(e){var S=e.getParameters().selectedItem,L=S?S:e.getSource().getParent();this._oDownloadButton.setBusy(true);sap.ui.require(["sap/ui/core/util/File","sap/ui/thirdparty/jszip"],function(c,d){var z=new d();$.getJSON(L.data("config"),function(C){var g=C.files,p=[],h=[];g.forEach(function(i){var P=s(C.cwd+i);P.then(function(o){if(o.errorMessage){h.push(o.errorMessage);}else{if(!i.startsWith("../")){z.file(i,o,{base64:false,binary:true});}}});p.push(P);});Promise.all(p).then(function(){if(h.length){var i=h.reduce(function(E,j){return E+j+"\n";},"Could not locate the following download files:\n");this._handleError(i);}this._oDownloadButton.setBusy(false);a.show("Downloading for app \""+L.getLabel()+"\" has been started");var o=z.generate({type:"blob"});this._createArchive(c,o,L.getLabel());}.bind(this));}.bind(this));}.bind(this));},createDemoAppRow:function(i,o){var c;if(!o.getObject().categoryId){if(o.getObject().teaser){try{$.sap.registerResourcePath("test-resources","test-resources");var r=$.sap.getResourcePath(o.getObject().teaser);var t=sap.ui.xmlfragment(i,r);c=sap.ui.xmlfragment(i,"sap.ui.documentation.sdk.view.BlockLayoutTeaserCell",this);c.getContent()[0].addContent(t);$.sap.registerResourcePath("test-resources",null);}catch(e){$.sap.log.warning("Teaser for demo app \""+o.getObject().name+"\" could not be loaded: "+e);c=sap.ui.xmlfragment(i,"sap.ui.documentation.sdk.view.BlockLayoutCell",this);}}else{c=sap.ui.xmlfragment(i,"sap.ui.documentation.sdk.view.BlockLayoutCell",this);}}else{c=sap.ui.xmlfragment(i,"sap.ui.documentation.sdk.view.BlockLayoutHeadlineCell",this);}c.setBindingContext(o);return c;},_createArchive:function(c,C,d){c.save(C,d,"zip","application/zip");},_handleError:function(e){M.error(e);},handleLandingImageLoad:function(){this.byId("landingImageHeadline").setVisible(true);}});});
