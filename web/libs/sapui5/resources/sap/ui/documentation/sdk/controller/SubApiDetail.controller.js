/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ControlsInfo","sap/ui/documentation/sdk/util/ToggleFullScreenHandler","sap/ui/documentation/sdk/controller/util/APIInfo","sap/m/Label","sap/m/Link","sap/m/Text","sap/m/HBox","sap/m/ObjectAttribute","sap/m/Popover","sap/m/FlexWrap"],function(q,B,J,C,T,A,L,a,b,H,O,P,F){"use strict";return B.extend("sap.ui.documentation.sdk.controller.SubApiDetail",{NOT_AVAILABLE:'N/A',SECTION_MAP:{"properties":"controlProperties","fields":"properties","special settings":"specialsettings"},onInit:function(){this._objectPage=this.byId("apiDetailObjectPage");},initiate:function(r){this._sTopicId=r.sTopicId;this._oModel=r.oModel;this._oControlData=this._oModel.getData();this._aApiIndex=r.aApiIndex;this._aAllowedMembers=r.aAllowedMembers;this._sEntityType=r.sEntityType;this._sEntityId=r.sEntityId;this._oEntityData=r.oEntityData;this._oContainerController=r.oContainerController;this._oContainerView=r.oContainerView;this.getOwnerComponent=function(){return r.oOwnerComponent;};this._oRouter=this.getRouter();this.setModel(this._oModel);this._oEntityData.appComponent=this._oControlData.component||this.NOT_AVAILABLE;this._oEntityData.hasSample=this._oControlData.hasSample;this._oEntityData.sample=this._oControlData.hasSample?this._sTopicId:this.NOT_AVAILABLE;this._buildHeaderLayout(this._oControlData,this._oEntityData);q.sap.delayedCall(0,this,function(){this._prettify();this._objectPage.attachEvent("subSectionEnteredViewPort",function(){if(this._sPrettyPrintDelayedCallID){q.sap.clearDelayedCall(this._sPrettyPrintDelayedCallID);}this._sPrettyPrintDelayedCallID=q.sap.delayedCall(200,this,function(){var $=q('.sapUxAPObjectPageContainer .APIDetailMethodsSection pre:not(.prettyprint)',this._objectPage.$());if($.length>0){$.addClass('prettyprint');window.prettyPrint();}});},this);q.sap.delayedCall(1000,this,function(){if(this._sEntityType){this._scrollToEntity(this._sEntityType,this._sEntityId);}q.sap.delayedCall(500,this,function(){this._objectPage.attachEvent("_sectionChange",function(e){var s=e.getParameter("section"),S=e.getParameter("subSection");if(this._oNavigatingTo){if(this._oNavigatingTo===S){this._oNavigatingTo=null;}return;}this._modifyURL(s,S,false);},this);this._objectPage.attachEvent("navigate",function(e){var s=e.getParameter("section"),S=e.getParameter("subSection");this._oNavigatingTo=S;this._modifyURL(s,S,true);},this);});});});this.searchResultsButtonVisibilitySwitch(this.byId("apiDetailBackToSearch"));},onAfterRendering:function(){this.getView().attachBrowserEvent("click",this.onJSDocLinkClick,this);},onExit:function(){this.getView().detachBrowserEvent("click",this.onJSDocLinkClick,this);},onToggleFullScreen:function(e){T.updateMode(e,this._oContainerView,this._oContainerController);},onJSDocLinkClick:function(e){var c=e.target.classList,j=c.contains("jsdoclink"),l=e.target.getAttribute("data-sap-ui-target"),E;if(!j){return;}if(c.contains("scrollToMethod")){E="methods";}else if(c.contains("scrollToEvent")){E="events";}else{return;}this._scrollToEntity(E,l);this._navigateRouter(E,l,true);},_navigateRouter:function(e,E,s){this._oRouter.stop();this._oRouter.navTo("apiId",{id:this._sTopicId,entityType:e,entityId:E},!s);this._oRouter.initialize(true);},_modifyURL:function(s,S,c){var d=s.getTitle().toLowerCase(),e=(S&&S.getTitle()!=='Overview')?S.getTitle():'';d=this.SECTION_MAP[d]||d;this._navigateRouter(d,e,c);},_prettify:function(){q('.sapUxAPObjectPageContainer pre',this._objectPage.$()).addClass('prettyprint');window.prettyPrint();},scrollToMethod:function(e){this._scrollToEntity("methods",e.getSource().getText());},scrollToEvent:function(e){this._scrollToEntity("events",e.getSource().getText());},scrollToAnnotation:function(e){this._scrollToEntity("annotations",e.getSource().getText());},_scrollToEntity:function(s,S){var f,c,o;if(!s){return;}s=s.toLowerCase();o=this.byId(s);if(!o){return;}if(S){S=S.toLowerCase();c=o.getSubSections();f=c.filter(function(d){return d.getTitle().toLowerCase()===S;});if(f.length){this._oRouter.stop();q.sap.delayedCall(0,this,function(){this._oRouter.initialize(true);});this._objectPage.scrollToSection(f[0].getId(),250);}}else{this._objectPage.scrollToSection(o.getId(),250);}},_scrollContentToTop:function(){if(this._objectPage&&this._objectPage.$().length>0){this._objectPage.getScrollDelegate().scrollTo(0,0);}},_getHeaderLayoutUtil:function(){if(!this._oHeaderLayoutUtil){var _=function(t,s){return new O({title:t,text:s}).addStyleClass("sapUiTinyMarginBottom");},c=function(o){return new a(o||{});},d=function(o){return new b(o||{});},e=function(o){return new L(o||{});},f=function(o,g){var h=new H(o||{});if(g){h.addStyleClass("sapUiDocumentationHeaderNavLinks sapUiTinyMarginBottom");}return h;};this._oHeaderLayoutUtil={_getControlSampleBlock:function(o,E){return f({items:[e({design:"Bold",text:"Control Sample:"}),c({emphasized:true,text:E.sample,visible:!!E.hasSample,href:"#/entity/"+o.name}),d({text:E.sample,visible:!E.hasSample})]},true);},_getDocumentationBlock:function(o,E){return f({items:[e({design:"Bold",text:"Documentation:"}),c({emphasized:true,text:o.docuLinkText,href:"#/topic/"+o.docuLink})]},true);},_getUXGuidelinesBlock:function(o){return f({items:[e({design:"Bold",text:"UX Guidelines:"}),c({emphasized:true,text:o.uxGuidelinesLinkText,href:o.uxGuidelinesLink,target:"_blank"})]},true);},_getExtendsBlock:function(o,E){return f({items:[e({text:"Extends:"}),c({text:o.extendsText,href:"#/api/"+o.extendsText,visible:o.isDerived}),d({text:o.extendsText,visible:!o.isDerived})]},true);},_getSubclassesBlock:function(o,E){var s=E.extendedBy||E.implementedBy,S;this._aSubClasses=s;if(s.length===1){S=c({text:s[0],href:"#/api/"+s[0]});}else{S=c({text:o.isClass?"View subclasses":"View implementations",press:this._openSubclassesImplementationsPopover.bind(this)});}return f({items:[e({text:o.isClass?"Known direct subclasses:":"Known direct implementations:"}),S]},true);},_getImplementsBlock:function(o,E){var i=[e({text:"Implements:"})];o.implementsParsed.forEach(function(g){i.push(c({text:g.name,href:"#/api/"+g.href}));});return f({items:i,wrap:F.Wrap},true).addStyleClass("sapUiDocumentationCommaList");},_getModuleBlock:function(o,E){return _("Module",o.module);},_getLibraryBlock:function(o,E){return _("Library",E.lib);},_getVisibilityBlock:function(o,E){return _("Visibility",o.visibility);},_getAvailableSinceBlock:function(o,E){return _("Available since",o.sinceText);},_getApplicationComponentBlock:function(o,E){return _("Application Component",E.appComponent);}};}return this._oHeaderLayoutUtil;},_openSubclassesImplementationsPopover:function(e){var p=this._aSubClasses.map(function(E){return new a({text:E,href:"#/api/"+E}).addStyleClass("sapUiTinyMarginBottom sapUiTinyMarginEnd");}),o=this._getSubClassesAndImplementationsPopover(p);o.openBy(e.getSource());},_getSubClassesAndImplementationsPopover:function(c){var p=this._getPopover();if(p.getContent().length>0){p.destroyContent();}(c||[]).forEach(p.addContent,p);return p;},_getPopover:function(){if(!this._oPopover){this._oPopover=new P({placement:"Bottom",showHeader:false}).addStyleClass("sapUiDocumentationSubclassesPopover");}return this._oPopover;},_buildHeaderLayout:function(c,e){var d=0,S=1,f=2,E=3,h=[[],[],[]],o=this._getHeaderLayoutUtil(),s=e.extendedBy||e.implementedBy||[],g=[{creator:"_getControlSampleBlock",exists:c.isClass},{creator:"_getDocumentationBlock",exists:c.docuLink!==undefined},{creator:"_getUXGuidelinesBlock",exists:c.uxGuidelinesLink!==undefined},{creator:"_getExtendsBlock",exists:c.isClass},{creator:"_getSubclassesBlock",exists:s.length>0},{creator:"_getImplementsBlock",exists:c.hasImplementsData},{creator:"_getModuleBlock",exists:true},{creator:"_getLibraryBlock",exists:c.kind==="namespace"&&e.lib},{creator:"_getVisibilityBlock",exists:c.visibility},{creator:"_getAvailableSinceBlock",exists:true},{creator:"_getApplicationComponentBlock",exists:true}],i=function(){var j=0,I,G=function(j){if(j<=E){return d;}else if(j<=E*2){return S;}return f;};g.forEach(function(k){var l;if(k.exists){l=o[k.creator].call(this,c,e);I=G(++j);h[I].push(l);}},this);}.bind(this);i();h.forEach(function(j,I){var v=this.byId("headerColumn"+I);v.removeAllContent();if(j.length>0){v.setVisible(true);j.forEach(v.addContent,v);}},this);},onAnnotationsLinkPress:function(){this._scrollToEntity("annotations","Summary");},backToSearch:function(){this.onNavBack();}});});
