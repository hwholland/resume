/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/smartfilterbar/ControlConfiguration','sap/ui/comp/valuehelpdialog/ValueHelpDialog','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil'],function(q,C,V,O,F){"use strict";var a=function(){};a.prototype.convert=function(k,f,d,o){var b,i;var j,J,n=null;var s={SelectionVariantID:k};if(d&&f){j=JSON.parse(d);if(j){b=this._getFields(f);if(b&&b.length>0){for(i=0;i<b.length;i++){this._convertField(s,b[i],j,o);}}if(j._CUSTOM){if(typeof j._CUSTOM==="string"){J=JSON.parse(j._CUSTOM);}else{J=j._CUSTOM;}for(n in J){if(n){this._addSingleValue(s,n,this._getValue(J[n]));}}}}}return JSON.stringify(s);};a.prototype._getParameterMetaData=function(n,f){var i,j;var g;var b=f.getFilterBarViewMetadata();if(b){for(i=0;i<b.length;i++){g=b[i];for(j=0;j<g.fields.length;j++){if(n===g.fields[j].fieldName){return g.fields[j];}}}}return null;};a.prototype._convertField=function(s,f,c,o){var b,v,d=null;var r;var e;if(c&&f&&s){b=c[f];if(b){e=this._getParameterMetaData(f,o);if(e){if(e.isCustomFilterField){return;}if(e.filterRestriction===C.FILTERTYPE.single){v=(b.value===undefined)?b:b.value;this._addSingleValue(s,f,v);}else if(e.filterRestriction===C.FILTERTYPE.interval){if(b.conditionTypeInfo){this._convertFieldByValue(s,f,c);}else{r=this._addRangeEntry(s,f);if((e.type==="Edm.DateTime")&&!b.high){b.high=b.low;}else if((e.type==="Edm.String")&&!b.high){d="EQ";}if(e.type==="Edm.Time"){this._addRangeMultipleRangeValues(r,b.ranges,true);}else if(O.isNumeric(e.type)&&!b.high){var d="BT",g=F.parseFilterNumericIntervalData(b.low);if(g&&(g.length===2)&&g[0]){this._addRangeLowHigh(r,{low:g[0],high:g[1]},"BT");}else{this._addRangeLowHigh(r,b,"EQ");}}else{this._addRangeLowHigh(r,b,d);}}}else if(e.filterRestriction===C.FILTERTYPE.multiple){r=this._addRangeEntry(s,f);if(b.items&&b.items.length>0){this._addRangeMultipleSingleValues(r,b.items);}else if(b.ranges&&b.ranges.length>0){this._addRangeMultipleRangeValues(r,b.ranges);}else{this._addRangeSingleValue(r,b.value);}}else{this._convertFieldByValue(s,f,c);}}else{this._convertFieldByValue(s,f,c);}}}};a.prototype._convertFieldByValue=function(s,f,c){var o;var r;if(c&&f&&s){o=c[f];if(o){if(o.conditionTypeInfo){if(o.ranges&&o.ranges.length>0){r=this._addRangeEntry(s,f);this._addRanges(r,o.ranges);}}else if((o.ranges!==undefined)&&(o.items!==undefined)&&(o.value!==undefined)){r=this._addRangeEntry(s,f);if(o.ranges&&o.ranges.length>0){this._addRanges(r,o.ranges);}if(o.items&&o.items.length>0){this._addRangeMultipleSingleValues(r,o.items);}if(o.value){this._addRangeSingleValue(r,o.value);}}else if((o.items!==undefined)&&o.items&&(o.items.length>0)){r=this._addRangeEntry(s,f);this._addRangeMultipleSingleValues(r,o.items);}else if((o.low!==undefined)&&o.low&&(o.high!==undefined)&&o.high){r=this._addRangeEntry(s,f);this._addRangeLowHigh(r,o);}else if((o.value!==undefined)&&o.value){this._addSingleValue(s,f,o.value);}else if(o){this._addSingleValue(s,f,o);}}}};a.prototype._addRangeEntry=function(s,f){var o={PropertyName:f,Ranges:[]};if(!s.SelectOptions){s.SelectOptions=[];}s.SelectOptions.push(o);return o.Ranges;};a.prototype._addRanges=function(r,R){var s,o,l,h;for(var i=0;i<R.length;i++){s=R[i].exclude?"E":"I";l=this._getValue(R[i].value1);h=this._getValue(R[i].value2);if(R[i].operation===sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains){o="CP";if(l){l="*"+l+"*";}}else if(R[i].operation===sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith){o="CP";if(l){l=l+"*";}}else if(R[i].operation===sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith){o="CP";if(l){l="*"+l;}}else{o=R[i].operation;}r.push({Sign:s,Option:o,Low:l,High:h});}};a.prototype._addRangeMultipleSingleValues=function(r,I){for(var i=0;i<I.length;i++){r.push({Sign:"I",Option:"EQ",Low:this._getValue(I[i].key),High:null});}};a.prototype._addRangeMultipleRangeValues=function(r,I){for(var i=0;i<I.length;i++){r.push({Sign:"I",Option:"EQ",Low:this._getValue(I[i].value1),High:null});}};a.prototype._addRangeSingleValue=function(r,v){r.push({Sign:"I",Option:"EQ",Low:this._getValue(v),High:null});};a.prototype._addRangeLowHigh=function(r,l,o){var s=o||"BT";r.push({Sign:"I",Option:s,Low:this._getValue(l.low),High:this._getValue(l.high)});};a.prototype._addSingleValue=function(s,f,v){if(!s.Parameters){s.Parameters=[];}s.Parameters.push({PropertyName:f,PropertyValue:v});};a.prototype._getFields=function(f){var r=[];if(f){for(var i=0;i<f.length;i++){r.push(f[i].name);}}return r;};a.prototype._getValue=function(v){if((v===null)||(v===undefined)){return null;}return""+v;};a.prototype._getControl=function(f,n){var c=null;var o=this._getParameterMetaData(n,f);if(o){c=o.control;}return c;};return a;},true);
