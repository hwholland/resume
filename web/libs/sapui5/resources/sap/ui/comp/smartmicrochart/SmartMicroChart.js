/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/library','sap/ui/core/Control','sap/ui/comp/providers/ChartProvider','sap/suite/ui/microchart/library'],function(q,C,a,b,M){"use strict";var S=a.extend("sap.ui.comp.smartmicrochart.SmartMicroChart",{metadata:{library:"sap.ui.comp",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"164px"},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"74px"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"_chart",aggregations:{_chart:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{chartTitle:{type:"sap.m.Label",group:"Misc",multiple:false},chartDescription:{type:"sap.m.Label",group:"Misc",multiple:false},unitOfMeasure:{type:"sap.m.Label",group:"Misc",multiple:false}},events:{initialize:{}}}});S.prototype.init=function(){this._bIsinitialized=false;this._bMetaModelLoadAttached=false;};S.prototype.setChartType=function(){return this;};S.prototype.getChartType=function(){return this.getAggregation("_chart").getChartType();};S.prototype.propagateProperties=function(){if(a.prototype.propagateProperties){a.prototype.propagateProperties.apply(this,arguments);}this._initializeMetadata();};S.prototype.onBeforeRendering=function(){var c=this.getAggregation("_chart");if(c){if(c.getMetadata().hasProperty("height")){c.setProperty("height",this.getHeight(),true);}if(c.getMetadata().hasProperty("width")){c.setProperty("width",this.getWidth(),true);}if(c.getMetadata().hasProperty("isResponsive")){c.setProperty("isResponsive",this.getIsResponsive(),true);M._passParentContextToChild(this,c);}c.setProperty("showLabel",this.getShowLabel(),true);if(c.getMetadata().hasAssociation("chartTitle")){c.setAssociation("chartTitle",this.getChartTitle(),true);}if(c.getMetadata().hasAssociation("chartDescription")){c.setAssociation("chartDescription",this.getChartDescription(),true);}if(c.getMetadata().hasAssociation("unitOfMeasure")){c.setAssociation("unitOfMeasure",this.getUnitOfMeasure(),true);}}};S.prototype._initializeMetadata=function(){if(!this._bIsinitialized){var m=this.getModel();if(m&&(m instanceof sap.ui.model.odata.v2.ODataModel||m instanceof sap.ui.model.odata.ODataModel)){if(!this._bMetaModelLoadAttached){m.getMetaModel().loaded().then(this._onMetadataInitialized.bind(this));this._bMetaModelLoadAttached=true;}}else if(m){this._onMetadataInitialized();}}};S.prototype._createChartProvider=function(){var e=this.getEntitySet(),m=this.getModel();if(m&&e){this._oChartProvider=new b({entitySet:e,model:m});}};S.prototype._onMetadataInitialized=function(){this._bMetaModelLoadAttached=false;if(!this._bIsinitialized){this._createChartProvider();if(this._oChartProvider){this._oChartViewMetadata=this._oChartProvider.getChartViewMetadata();if(this._oChartViewMetadata){this._bIsinitialized=true;this._createInnerChart();this.invalidate();}}}};S.prototype._createInnerChart=function(){if(!this._checkChartMetadata()){q.sap.log.error("Created annotations not valid. Please review the annotations and metadata.");return;}var c=this._oChartViewMetadata.chartType;switch(c){case"line":case"area":if(this._oChartViewMetadata.annotation.ChartType.EnumMember.split("/").pop().toLowerCase()==="area"){this._buildSmartAreaMicroChart();}else{q.sap.log.error("Not supported chart type used.");}break;case"bullet":this._buildSmartBulletMicroChart();break;default:q.sap.log.error("Not supported chart type used.");break;}};S.prototype._buildSmartAreaMicroChart=function(){this.setAggregation("_chart",new C.smartmicrochart.SmartAreaMicroChart({entitySet:this.getEntitySet(),chartBindingPath:this.getChartBindingPath(),enableAutoBinding:this.getEnableAutoBinding(),showLabel:this.getShowLabel(),initialize:[this._onChartInitialized,this]}),true);};S.prototype._buildSmartBulletMicroChart=function(){this.setAggregation("_chart",new C.smartmicrochart.SmartBulletMicroChart({entitySet:this.getEntitySet(),chartBindingPath:this.getChartBindingPath(),enableAutoBinding:this.getEnableAutoBinding(),showLabel:this.getShowLabel(),initialize:[this._onChartInitialized,this]}),true);};S.prototype._onChartInitialized=function(){this.fireInitialize();};S.prototype._checkChartMetadata=function(){if(this._oChartViewMetadata.chartType&&this._oChartViewMetadata.annotation&&this._oChartViewMetadata.annotation.ChartType&&this._oChartViewMetadata.annotation.ChartType.EnumMember&&this._oChartViewMetadata.annotation.ChartType.EnumMember.length>0){return true;}else{return false;}};return S;});
