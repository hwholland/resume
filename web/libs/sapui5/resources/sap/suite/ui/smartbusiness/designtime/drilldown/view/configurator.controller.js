/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Bullet");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Comparison");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.MeasureComparison");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.AreaChart");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Numeric");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.HarveyBall");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.ui.vbm.AnalyticMap");jQuery.sap.require("sap.ui.core.format.NumberFormat");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator",{onInit:function(){this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");try{if(sap.ui.core.Fragment.byId("addTileDialog","addTileDialog")){sap.ui.core.Fragment.byId("addTileDialog","addTileDialog").destroy();}if(sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList")){sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList").getParent().destroy();}if(sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog")){sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog").destroy();}}catch(e){}this._addTileDialog=sap.ui.xmlfragment("addTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addTileDialog",this);this._addRelatedTilesDialog=sap.ui.xmlfragment("addRelatedTilesDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addRelatedTilesDialog",this);this._configureTileDialog=sap.ui.xmlfragment("configureTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.multipleMeasureDialog",this);this.initializeTileHeader();this.initializeAddTileDialog();this.initialiazeValueHelpDialog();this.defineHeaderFooterOptions();this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.viewsReordered=false;this.busyIndicator=new sap.m.BusyDialog();var h=this.byId("headerRibbon");this.HeaderRibbonModel=new sap.ui.model.json.JSONModel();h.setModel(this.HeaderRibbonModel);var s=this;if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}},leftArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject();}catch(e){s=null;}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i-1,0,a[0]);break;}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index-1);},rightArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject();}catch(e){s=null;}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i+1,0,a[0]);break;}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index+1);},selectedTilesFormatter:function(c,a){var b="";var t={NT:"Numeric",CT:"Comparison",AT:"Bullet",TT:"Trend"};a.forEach(function(s){if(s.REFERENCE_EVALUATION_ID==c&&s.visible)b+=t[s.VISUALIZATION_TYPE]+", ";});return b?"Selected: "+b.replace(/, $/g,""):"";},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},_cache:{},setApplicationCache:function(k,v){this._cache[k]=v;},getApplicationCache:function(k){return this._cache[k];},takeConfigSnapShot:function(){this._configSnapShot=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());},restoreFromConfigSnapShot:function(){this.getView().getModel("SB_DDACONFIG").setData(this._configSnapShot);},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addTileDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addRelatedTilesDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._configureTileDialog,"SB_DDACONFIG");},onRoutePatternMatched:function(E){var t=this;if(E.getParameter("name")==="configurator"){try{t.errorState=undefined;t.errorMsg=undefined;var a=E.getParameter("arguments")["evaluationId"];var v=E.getParameter("arguments")["viewId"];if(t.oApplicationFacade.__newViewAdded&&t.oApplicationFacade.createdViewId){v=t.oApplicationFacade.createdViewId;t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+v);}t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;t._setSelectedTile(-1);if(a!==this.evaluationId||t.viewsReordered){t.viewsReordered=false;this.evaluationId=a;this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;if(!v){v=this.DDA_MODEL.getConfigurator().getDefaultViewId();}this._oTextsModel=this.getView().getModel("i18n");this._addTileDialog.setModel(this._oTextsModel,"i18n");this._addRelatedTilesDialog.setModel(this._oTextsModel,"i18n");this._configureTileDialog.setModel(this._oTextsModel,"i18n");if(v!=null){this.viewId=v;this.DDA_MODEL.setViewId(v);}else{this.viewId=n;}this.bindUiToModel();this.initCopy=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name);});this.ddaFilter.setDimensions(f);try{this.ddaFilter.rerender();}catch(e){};}else{if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=function(){h=t.getView().getModel("SB_DDACONFIG").getData()["HEADERS"];var c=0;for(var i=0;i<h.length;++i){if(h[i]["visible"]==true)++c;}return c;}();this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;if(!this.init_filters){this.init_filters=[];this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].forEach(function(x){t.init_filters.push(x.name)});}var o=this.getView().byId("vizViewSelector");o.bindProperty("selectedKey","SB_DDACONFIG>/ID");this.getView().byId("choroplethViewSelect").bindProperty("selectedKey","SB_DDACONFIG>/ID");this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();this.displayAggregate();}catch(e){t.errorState=true;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{if(this.byId("choroplethViewSelect")&&this.byId("choroplethViewSelect").getSelectedItem()){this.byId("choroplethViewSelect").setTooltip(this.byId("choroplethViewSelect").getSelectedItem().getText());}if(this.byId("vizViewSelector")&&this.byId("vizViewSelector").getSelectedItem()){this.byId("vizViewSelector").setTooltip(this.byId("vizViewSelector").getSelectedItem().getText());}}}},changeViewOrder:function(){var t=this;new sap.suite.ui.smartbusiness.lib.ListPersona({view:this.getView(),context:'/ALL_VIEWS',listItemContext:'TITLE',namedModel:'SB_DDACONFIG',callback:function(){var c=t.DDA_MODEL.selectedView.getId();t.byId('vizViewSelector').setSelectedItem(t.byId('vizViewSelector').getItemByKey(c));t.byId('choroplethViewSelect').setSelectedItem(t.byId('choroplethViewSelect').getItemByKey(c));t.viewsReordered=true;}}).start();},SaveConfig:function(i){var s=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();m.CURRENT_FILTERS=this.getView().byId("ddaFilter").getActiveDimensions();var a=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");if(m.ALL_VIEWS.length>0){this.busyIndicator.open()&&this.getView().setBusy(true);a.saveEvalConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_SAVE_SUCCESS"));if(i==false){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:"EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)"});}s.oApplicationFacade.__refreshModel=1;try{if(sap.suite&&sap.suite.ui&&sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration){sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration(s.evaluationId);}}catch(e){}},function(e){jQuery.sap.log.error(e+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"));});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR_NO_VIEW_CONFIGURED"));jQuery.sap.log.error("No Views Configured. Please configure Views before adding filters/headers");}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={onBack:function(){if(t.isModelChanged()){var s=t;new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";s.evaluationId=null;this.getParent().close();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{var c="EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)";t.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}},sI18NDetailTitle:"SB_GENERIC_DRILLDOWN",bSuppressBookmarkButton:true,buttonList:[{sI18nBtnTxt:"Save Configuration",onBtnPressed:function(e){jQuery.sap.log.info("Save button pressed");if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.SaveConfig(false);},},{sId:"Delete",sI18nBtnTxt:"Delete",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}new sap.m.Dialog({icon:"sap-icon://warning2",title:t._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("OK"),press:function(){this.getParent().close();t.busyIndicator.open()&&t.getView().setBusy(true);t.deleteMaster();}}),endButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}},{sId:"cancel",sI18nBtnTxt:"Cancel",onBtnPressed:function(e){var s=t;if(t.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";this.getParent().close();s.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";s.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}},]};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},onBeforeRendering:function(){},navigateToConfigureChart:function(){var c=this.evaluationId+"/"+this.viewId;this.evaluationId=null;if(this.navigatingWithinDrilldown){this.oApplicationFacade.navigatingWithinDrilldown=true;}else{this.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configureChart",context:c});},onAddView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();this.oApplicationFacade.configuratorViewId=this.viewId||this.DDA_MODEL.NEW_VIEWID;if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE_TO_SAVE_CONFIGURATION")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("SAVE_AND_CONTINUE"),press:function(){var i=true;s.warn_header=false;s.SaveConfig(i);s.viewId=s.DDA_MODEL.NEW_VIEWID;s.DDA_MODEL.setViewId(s.viewId);s.bindUiToModel();this.getParent().close();s.navigateToConfigureChart();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{this.oApplicationFacade.__contextViewId=this.viewId;this.viewId=this.DDA_MODEL.NEW_VIEWID;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this.navigateToConfigureChart();}},onEditView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();this.oApplicationFacade.configuratorViewId=this.viewId||this.DDA_MODEL.NEW_VIEWID;if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE_TO_SAVE_CONFIGURATION")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("SAVE_AND_CONTINUE"),press:function(){var i=true;s.warn_header=false;this.getParent().close();s.SaveConfig(i);s.navigateToConfigureChart();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{this.navigateToConfigureChart();}},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison"},_getSelectedTile:function(){var t=this.byId("tileContainer").getItems()||[];return{tile:t[this._selectedTileIndex],index:this._selectedTileIndex}},_setSelectedTile:function(i){this._selectedTileIndex=i;var t=this.byId("tileContainer").getItems()||[];for(j=0;j<t.length;j++){t[j].getTileControl().removeStyleClass("mySelectedStyle");}this.byId("deleteTile").setEnabled(i!=-1);if(i!=-1){t[i].getTileControl().addStyleClass("mySelectedStyle");}this.byId("leftMoveArrow").setEnabled((i!=-1)&&i!=0);this.byId("rightMoveArrow").setEnabled((i!=-1)&&i!=t.length-1);},deleteTile:function(){var t=this;var c=new sap.m.Dialog({title:"Delete",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DELETE_CONFIRMATION")})],beginButton:new sap.m.Button({text:"Ok",press:function(e){c.close();var a=t._getSelectedTile().tile;var v=a.getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;v.splice(t._getSelectedTile().index,1);t._setSelectedTile(-1);t.refreshTileBindings();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close();}})});c.open();},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles").attachBrowserEvent("click",function(e){var v=this.getParent().getAggregation("content");t._setSelectedTile(v.indexOf(this));});},});},initializeAddTileDialog:function(){var t=this;this._tileEvaluationList=sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList");var a={NT:"NUMBER_TILE",AT:"ACTUAL_VS_TARGET_TILE",CT:"COMPARISON_TILE",TT:"TREND_TILE",CM:"COMPARISON_MM_TILE",HT:"HARVEY_BALL_TILE"};var b=new sap.ui.model.Sorter('SB_DDACONFIG>GROUPING_TITLE',false,function(C){return C.getProperty('GROUPING_TITLE');});var c=new sap.ui.model.Sorter('SB_DDACONFIG>VISUALIZATION_TYPE_INDEX',false);this._tileEvaluationList.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS",factory:function(i,B){var d=B.getProperty("VISUALIZATION_TYPE");var m=new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true});var f=new sap.m.HBox({width:"100%",justifyContent:"SpaceAround",items:[new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true})]});var g=new sap.m.HBox({justifyContent:"Start",width:"98%",items:[m,new sap.m.Label({text:{path:"SB_DDACONFIG>VISUALIZATION_TYPE",formatter:function(s){return t._oTextsModel.getResourceBundle().getText(a[s]);}}})]});return new sap.m.CustomListItem({type:(d=='NT'||d=='AT')?'Active':'Navigation',press:function(){var o=this.getBindingContext('SB_DDACONFIG').getObject();var v=o.VISUALIZATION_TYPE;o['visible']=true;if(v=='NT'||v=='AT'){t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(t._cloneObj(o));t.onAddTileOk();t.refreshTileBindings();}else{t._addRelatedTilesDialog.close();try{var h=v=='CM'?1:(v=="HT")?2:0;t._configureTileDialog.getContent()[h].getItems()[1].removeAllContent();t._configureTileDialog.getContent()[h].getItems()[1].addContent(f);}catch(e){}t._configureTileDialog.bindElement('SB_DDACONFIG>'+this.getBindingContextPath());t._configureTileDialog.open();var I=t.getView().getModel("i18n");var j=new sap.ui.core.Item({key:"_none^",text:I.getResourceBundle().getText("SELECT_NONE"),});if(!sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").getItemByKey("_none^"))sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").insertItem(j,"0");}},content:[new sap.m.HBox({justifyContent:"SpaceAround",items:[g]})]});},sorter:[b,c]});},onMiniChartConfigureOk:function(){var b=this._configureTileDialog.getBindingContext("SB_DDACONFIG").getObject();b['visible']=true;this.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(this._cloneObj(b));this.onAddTileOk();this.refreshTileBindings();},showConfigureTileMeasure:function(v){return v=='CM';},showConfigureTileDimension:function(v){return v=='CT'||v=='TT';},showConfigureTileSortOrder:function(v){return v=='CT';},showThirdMeasure:function(v){return!!v;},showHarveyConfigurator:function(t){return t=="HT";},harveyTotalMeasureVisibility:function(t,i){return t=="HT"&&i;},harveyFilterVisibility:function(t,i){return t=="HT"&&i;},harveyFilterOptionVisibility:function(t,i,s){return t=="HT"&&i&&s;},betweenOperatorLabelVisibility:function(o){return o=="BT";},refreshTileBindings:function(){try{var t=this.byId("tileContainer");t.getModel("SB_DDACONFIG").refresh();}catch(e){}},_refreshEvaluationsBinding:function(){},onAddTileOk:function(E){this.takeConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close();}catch(e){}this._refreshEvaluationsBinding();this.warn_header=true;},onAddTileCancel:function(E){this.restoreFromConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close();}catch(e){}this._refreshEvaluationsBinding();},_getEvalData:function(i){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:i,cache:true,filters:false,thresholds:false,getDDAEvaluation:true});return a;}catch(e){return{};}},createTileMenuForCurrentEvaluation:function(e){var t=this;var a=['NT','AT','CT','TT','CM'];var b=this._getEvalData(e);var m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var d=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var f=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var c=this.getView().getModel("SB_DDACONFIG");if(!c.getProperty("/HEADER_EVALUATIONID")[e]){c.getProperty("/HEADER_EVALUATIONID")[e]=true;var h=c.getProperty("/HEADERS");for(var g in this.tileTypeMapping){h.push({EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.viewId,REFERENCE_EVALUATION_ID:e,VISUALIZATION_TYPE:g,VISUALIZATION_TYPE_INDEX:a.indexOf(g),VISUALIZATION_ORDER:1,ALL_DIMENSIONS:d,DIMENSION:d[0]||'',SORT_BY:'',SORT_ORDER:'MD',MEASURE1:m[0],MEASURE2:m[1]||m[0],MEASURE3:m[2]||"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",DIMENSION_COLOR:"Neutral",HARVEY_FILTERS:[{NAME:f[0],OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}],HARVEY_TOTAL_MEASURE:m[0],FILTERABLE_DIMENSIONS:f,IS_HARVEY_FRACTION_KPIMEASURE:true,IS_HARVEYMEASURE_KPIMEASURE:false,ALL_MEASURES:m,VISIBILITY:1,visible:false,TITLE:b.INDICATOR_TITLE,SUBTITLE:b.TITLE,INDICATOR:b.INDICATOR});}}},openEvaluationsDialog:function(){this._addRelatedTilesDialog.open();sap.ui.core.Fragment.byId('addRelatedTilesDialog','showCurrentKpiEvals').firePress();},evaluationGroupTextFormatter:function(c){return{text:c.getProperty("GROUPING_TEXT"),key:c.getProperty("GROUPING_TEXT")};},relatedEvalGroupTextFormatter:function(c){var r=this.getView().getModel("i18n").getResourceBundle();return{text:(r.getText("KPI")+": "+c.getProperty("INDICATOR")),key:c.getProperty("INDICATOR")};},showCurrentKPIEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');var r=this.getView().getModel("i18n").getResourceBundle();if(!m.getProperty('/SIBLING_EVALUATIONS').length){var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getSiblingEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:false,filters:false,thresholds:false,getDDAEvaluation:true});a.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID);});m.getData().SIBLING_EVALUATIONS=a;m.getData().HEADERS.forEach(function(s){var p=s.REFERENCE_EVALUATION_ID==s.EVALUATION_ID?'('+t._oTextsModel.getResourceBundle().getText('CURRENT_EVALUATION')+')':'';s.GROUPING_TITLE=p+s.TITLE+" "+s.SUBTITLE;});}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.EQ,c));m.refresh();},showAssociatedEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');if(!m.getProperty('/ASSOCIATED_EVALUATIONS').length){m.getData().ASSOCIATED_EVALUATIONS=sap.suite.ui.smartbusiness.lib.Util.kpi.getAssociatedEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:true});m.getData().ASSOCIATED_EVALUATIONS.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID);});m.getData().HEADERS.forEach(function(s){s.GROUPING_TITLE=s.TITLE+" "+s.SUBTITLE;});}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.NE,c));m.refresh();},formatColorForMap:function(m,t){var s=this.dda_config.chartConfig.colorScheme.toUpperCase();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var d=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:d.DATA_MODE||"DUMMY",title:"",dataLimit:d.DATA_LIMIT||null,dataLimitations:d.DATA_LIMITATIONS||false,type:(d.CHART_TYPE).toUpperCase()||"BAR",axis:d.AXIS_TYPE||"SINGLE",value:d.VALUE_TYPE||"ABSOLUTE",colorScheme:d.COLOR_SCHEME||"NONE",thresholdMeasure:d.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<d.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:d.COLUMNS[i].NAME,type:d.COLUMNS[i].TYPE,visibility:d.COLUMNS[i].VISIBILITY||"BOTH",sortOrder:d.COLUMNS[i].SORT_ORDER||"NONE",sortBy:d.COLUMNS[i].SORT_BY||"",axis:d.COLUMNS[i].AXIS||1,stacking:d.COLUMNS[i].STACKING||0,color:d.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?d.COLUMNS[i].COLOR1:d.COLOR_SCHEME=="MANUAL_SEMANTIC"?d.COLUMNS[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;v.setVisible(false);a.setVisible(true);b.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var d=this.getView().getModel("SB_DDACONFIG").getData().COLUMNS;var e=d.length;var f=[];for(i=0;i<e;i++){if(d[i].TYPE=='MEASURE'){f.push(d[i]);}else if(d[i].TYPE=='DIMENSION'){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=d[i].NAME;}}this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=f[0].NAME;if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}b.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"550px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(s):s;};},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("vizChartContainer");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});}}}try{var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}c.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);});}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);}},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},onDeleteView:function(){var t=this;new sap.m.Dialog({icon:"sap-icon://warning2",title:t._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t._oTextsModel.getResourceBundle().getText("VIEW_WILL_BE_DELETED")})],beginButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("OK"),press:function(){t.warn_header=false;var a=t.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");if(a.ALL_VIEWS.length>0){t.busyIndicator.open()&&t.getView().setBusy(true);s.saveViewConfiguration(t.evaluationId,a,"delete",function(){jQuery.sap.log.info("view delete success");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("CHART_CONFIG_DELETE_SUCCESS"));for(var i=0,b;i<a.ALL_VIEWS.length;i++){if(a.ALL_VIEWS[i].ID==t.viewId){b=i;break;}}if(b||(b==0)){a.ALL_VIEWS.splice(b,1);}t.viewId=(a.ALL_VIEWS.length<=0?"":(a.ALL_VIEWS.length==(b)?a.ALL_VIEWS[0].ID:a.ALL_VIEWS[b].ID));t.DDA_MODEL.getConfigurator().removeViewById(a.ID);t.DDA_MODEL.setViewId(t.viewId);t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart();},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});}this.getParent().close();}}),endButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();},enableDisableButton:function(a){if(a.length<1){return false;}else{return true;}},deleteMaster:function(){var t=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");this.busyIndicator.open()&&this.getView().setBusy(true);s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);t.DDA_MODEL.removeAllViews();sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.oRouter.navTo("detail",{"contextPath":"EVALUATIONS_MODELER(ID='"+self.evaluationId+"',IS_ACTIVE=1)"});t.evaluationId=null;t.oApplicationFacade.__refreshModel=1;},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});},fetchAndRenderHeaderRibbon:function(f){var s=this;var E=this.DDA_MODEL.EVALUATION_DATA;var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(E.ODATA_URL,E.ODATA_ENTITYSET);var M=p.getUnitPropertyMappingObject();var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:E.ODATA_URL,entitySet:E.ODATA_ENTITYSET,measure:E.COLUMN_NAME,filter:E.FILTERS["results"]});u.model.read(u.uri,null,null,true,function(d){if(d){s.HeaderRibbonModel.setData({data:d.results[0]});}else{jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri);}});var k=M[E.COLUMN_NAME];var i=this.getView().getModel("i18n");this.byId("aggregate_number").bindProperty("text","/data/"+E.COLUMN_NAME,function(v){if(v==""||v==null){v=i.getResourceBundle().getText("NO_DATA");}return v;});if(k){this.byId("aggregate_number_unit").bindProperty("text","/data/"+k,function(v){return v;});}},displayAggregate:function(){var i=this.getView().getModel("i18n");if(this.byId("enableAggregate").getSelected()===false){this.byId("enableAggregate").setText(i.getResourceBundle().getText("ENABLE_KPI_AGGREGATE"));this.byId("enableAggregate").invalidate();}else if(this.byId("enableAggregate").getSelected()===true){this.byId("enableAggregate").setText("");this.byId("aggregate_number").setText("12,345.67");this.byId("aggregate_number_unit").setText("EUR");}},isModelChanged:function(){this.currentCopy=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());if(this.initCopy.CONFIG.SAP_AGGREGATE_VALUE!=this.currentCopy.CONFIG.SAP_AGGREGATE_VALUE){return true;}var c=this.getView().byId("ddaFilter").getActiveDimensions();if(c.length==this.initCopy.FILTERS.length){for(var i=0;i<c.length;i++){if(c[i]!=this.initCopy.FILTERS[i].name){return true;}}}else{return true;}if(this.initCopy.HEADERS_VISIBLE.length==this.currentCopy.HEADERS_VISIBLE.length){for(var i=0;i<this.initCopy.HEADERS_VISIBLE.length;i++){delete this.initCopy.HEADERS_VISIBLE[i].ALL_MEASURES;delete this.initCopy.HEADERS_VISIBLE[i].ALL_DIMENSIONS;delete this.currentCopy.HEADERS_VISIBLE[i].ALL_MEASURES;delete this.currentCopy.HEADERS_VISIBLE[i].ALL_DIMENSIONS;response=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:this.initCopy.HEADERS_VISIBLE[i],newPayload:this.currentCopy.HEADERS_VISIBLE[i]});if((response.updates&&response.updates.length)||(response.deletes&&response.deletes.length)){return true;}}}else{return true;}return false;},createVizChart:function(d,m){var t=this;var v=this.getView().byId("vizChartContainer");v.removeAllContent();var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if((this.dda_config.chartConfig.type).toUpperCase()=="TABLE"){v.addContent(T);setTimeout(function(){v.rerender();},0);}else{var V=this.getVizTypeAndIcon();var a=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,}});this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var b=new sap.viz.ui5.controls.Popover();b.connect(o.getVizUid());this.setAllVizFormatters();this.applyColorToViz(o);a.setContent(o);v.addContent(a);v.addContent(T);}},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b={locale:function(){},format:function(d,p){var e=sap.ui.core.format.NumberFormat.getInstance();return e.format(d);}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(b);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=(this._oModel)["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if((this._oModel)["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},onVizViewChange:function(e){var k=e.getParameters().selectedItem.getProperty("key");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.refreshChart();e.getSource().setTooltip(e.getParameters().selectedItem.getText());window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+this.viewId);},initialiazeValueHelpDialog:function(){var t=this;this.filterValueHelpDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_FILTERS"),multiSelect:true,items:{path:"/filterValues",template:new sap.m.StandardListItem({title:"{value}",selected:"{selected}"})},growingThreshold:999,confirm:function(e){var s=e.mParameters.selectedContexts;var v=[];s.forEach(function(c){v.push(c.getProperty("value"));});t.getView().getModel("SB_DDACONFIG").setProperty(this.ownerBindingPath+"/HARVEY_FILTERS/0/VALUE_1",v);},cancel:function(e){},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f,F],true);}});this.filterValueHelpDialog.setModel(new sap.ui.model.json.JSONModel({filterValues:[]}));return this.filterValueHelpDialog;},fetchFilterValuesForDimension:function(D,v,s,e){var t=this;var c;var m=this.getView().getModel("SB_DDACONFIG");var a=m.getProperty("/QUERY_SERVICE_URI");var V={};v.forEach(function(d){V[d]=true;});var b=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:a,entitySet:m.getProperty("/QUERY_ENTITY_SET"),filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS?this.DDA_MODEL.EVALUATION_DATA.FILTERS.results:[],dimension:D});if((c=this.getApplicationCache(a+"/"+b.uri))){s(c);}else{b.model.read(b.uri,null,null,false,function(f){var d=[];f.results.forEach(function(o){d.push({value:o[D],selected:!!V[o[D]]});});t.setApplicationCache(a+"/"+b.uri,d);s(d);},e);}},openFilterValueHelp:function(E){var t=this;var v=t.getView().getModel("SB_DDACONFIG");this.filterValueHelpDialog.open();this.filterValueHelpDialog.setBusy(true);this.filterValueHelpDialog.ownerBindingPath=E.getSource().getBindingContext("SB_DDACONFIG").getPath();var d=E.getSource().getBindingContext("SB_DDACONFIG").getProperty("HARVEY_FILTERS/0/NAME");var s=E.getSource().getBindingContext("SB_DDACONFIG").getProperty("HARVEY_FILTERS/0/VALUE_1");t.fetchFilterValuesForDimension(d,s,function fetchFilterValuesForDimensionCallBack(a){t.filterValueHelpDialog.getModel().setProperty("/filterValues",a);t.filterValueHelpDialog.setBusy(false);},function(e){t.filterValueHelpDialog.setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),e);});},});
