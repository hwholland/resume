/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.m.MessageBox");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S3",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.busyDialog=new sap.m.BusyDialog();var v=this.getView();this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.navigatingWithinDrilldown=true;this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){t.selectedTile=undefined;this.evalContext=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);var c=new sap.ui.model.json.JSONModel();c.setSizeLimit(100000);this.getView().setModel(c,"tileConfig");this.modelRef=this.getView().getModel("tileConfig");if(!!!this.oApplicationFacade.__tileModified&&this.evalContext.getObject()&&((this.evalContext.getObject()["CHIPS_COUNT"]===null)||(this.evalContext.getObject()["CHIPS_COUNT"]===0))){this.oApplicationFacade.__tileModified=null;this.getView().getModel("tileConfig").setData({CHIPS:[]});if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.PLATFORM=this.metadataRef.getPlatform();this.env=0;if(this.PLATFORM==this.constantsRef.Platform.ABAP){this.isPlatformABAP=true;}else{this.isPlatformABAP=false;}function a(d){t.env=d;};function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);};this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});var f=this.byId("tileGrid");f.removeAllColumns();if(this.isPlatformABAP){f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("CATALOGUE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}else{f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("NAVIGATION")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("STATUS")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}function g(d){if(d&&d.EVALUATION){d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;}t.busyDialog.close();jQuery.sap.log.info("Chips fetch called and successful");if(!(d&&d.CHIPS&&d.CHIPS.length)){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}else{t.getView().getModel("tileConfig").setData(d);if(d.affectedTiles&&d.affectedTiles.length){t.handleAffectedTilesDialogOnSelect(d);}}};function h(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);jQuery.sap.log.error("Error occured while fetching chips");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_CHIPS"),(JSON.stringify(d)));};this.busyDialog.open();this.metadataRef.getChipByEvaluation({context:this.evalContext,success:g,error:h,model:this.oApplicationFacade.getODataModel()});if(t.isPlatformABAP){this.oHeaderFooterOptions.buttonList=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_EVALUATION"),onBtnPressed:function(d){t.handleEvalDelete();}}];this.oHeaderFooterOptions.additionalShareButtonList=[];}}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("FULLSCREEN_TITLE"),onBtnPressed:function(e){if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}if(t.isPlatformABAP){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTileModelS",context:t.evalContext.sPath.substr(1)});}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.evalContext.sPath.substr(1)});}},bEnabled:false,}};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},getChipRow:function(i,c){var t=this;var a;var b;var d=null;try{d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);}catch(e){d={};jQuery.sap.log.error("parsing of Chip Failed");}var n=new sap.m.Text();if(d.navType=="0"){n.setText(t.oApplicationFacade.getResourceBundle().getText("GENERIC_DRILLDOWN"));}else{n.setText(t.oApplicationFacade.getResourceBundle().getText("OTHER_DRILLDOWN"));}var s=new sap.m.ObjectNumber();if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));s.setState("Success");}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"));s.setState("None");}}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE_DRAFT"));s.setState("Success");}var f;var g;if(Number(d.navType)){g=true;}else{g=false;}if(c.getProperty("tileType")==t.tileTypeConst["NT"])a=new sap.suite.ui.commons.NumericContent({size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});else if(c.getProperty("tileType")==t.tileTypeConst["CT"])a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});else if(c.getProperty("tileType")==t.tileTypeConst["AT"])a=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});else if(c.getProperty("tileType")==t.tileTypeConst["TT"])a=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});else if(c.getProperty("tileType")==t.tileTypeConst["CM"]){a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]});}else if(c.getProperty("tileType")==t.tileTypeConst["HT"]){a=new sap.suite.ui.commons.HarveyBallMicroChart({total:100,size:"S",scale:"M",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:30,color:"Good"})]});}b=new sap.suite.ui.commons.GenericTile({size:"S",header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:c.getProperty("tileType")})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S",}),press:function(A){}}).addStyleClass("sbTile");if(c.getProperty("isAffected")){b.addStyleClass("affectedTile");}if(c.getProperty("tileType")==t.tileTypeConst["DT-AT"]){b.setFrameType("TwoByOne");var h=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var j=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:h,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:j,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-CT"]){b.setFrameType("TwoByOne");var k=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var l=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:k,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:l,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-CM"]){b.setFrameType("TwoByOne");var m=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var o=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:m,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:o,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-TT"]){b.setFrameType("TwoByOne");var p=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var q=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:p,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:q,size:"S"}));}function r(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}if(t.isPlatformABAP){if(C.isActive){if(C.COUNTER==2){D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=1)";}}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTileModelS",context:(t.evalContext.sPath.substr(1)+"/"+D)});}else{if(C.isActive){if(C.COUNTER==2){D=D+"(id='"+C.id+"',isActive=0)";}else{D=D+"(id='"+C.id+"',isActive=1)";}}else{D=D+"(id='"+C.id+"',isActive=0)";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.evalContext.sPath.substr(1)+"/"+D)});}}var u=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Transparent,press:r});if(c.getProperty("isAffected")){u.setEnabled(false);}var v=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(A){t.handleDelete(this);}});var w=[];var x=new sap.m.Text({text:c.getObject().catalogName});var y=c.getObject().isAffected?true:false;if(t.isPlatformABAP){w=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:c.getObject().catalogName,visible:true}),new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("TILE_REMOVED_FROM_CATALOG"),state:"Error",visible:y})]}).addStyleClass("navigationVLayout"),u,v];}else{w=[b,new sap.ui.layout.VerticalLayout({content:[n,new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:g}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:g}),]}).addStyleClass("navigationVLayout"),s,u,v];}var z=new sap.m.ColumnListItem({type:"Navigation",cells:w});if(!(t.isPlatformABAP)){z.attachPress(function(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(C.isActive){if(C.COUNTER==2){D=D+"(id='"+C.id+"',isActive=0)";}else{D=D+"(id='"+C.id+"',isActive=1)";}}else{D=D+"(id='"+C.id+"',isActive=0)";}if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.evalContext.sPath.substr(1)+"/"+D)});});}else if(t.isPlatformABAP&&!(c.getProperty("isAffected"))){z.attachPress(function(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(C.isActive){if(C.COUNTER==2){D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=1)";}}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTileModelS",context:(t.evalContext.sPath.substr(1)+"/"+D)});});}else{z.setType("Inactive");}return z;},handleDelete:function(c){var t=this;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){function a(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();function f(d){t.busyDialog.close();d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;t.getView().getModel("tileConfig").setData(d);if(d.EVALUATION.CHIPS_COUNT===0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}}function g(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);}t.metadataRef.getChipByEvaluation({context:t.evalContext,success:f,error:g,model:t.oApplicationFacade.getODataModel()});};function b(d){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),d.responseText);};t.busyDialog.open();t.metadataRef.removeTile(c.getBindingContext("tileConfig").getObject(),t,a,b);}if(e=="CANCEL"){}});},handleAffectedTilesDialogOnSelect:function(c){var t=this;var a=c.affectedTiles;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_DIALOG")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){function r(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_SUCCESS"));t.refreshMasterList();function f(d){t.busyDialog.close();d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;t.getView().getModel("tileConfig").setData(d);if(d.EVALUATION.CHIPS_COUNT===0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}}function g(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);}t.metadataRef.getChipByEvaluation({context:t.evalContext,success:f,error:g,model:t.oApplicationFacade.getODataModel()});}function e(){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_ERROR"));}b.close();var p=[];for(var i=0,l=a.length;i<l;i++){p.push({ID:a[i],IS_ACTIVE:1});}if(p&&p.length){t.busyDialog.open();t.metadataRef.remove("CHIP",p,r,e);}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();},handleEvalDelete:function(){var t=this;var m=t.modelRef.getData();if(m.CHIPS&&m.CHIPS.length){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("EVALUATION_HAS_TILES_ERR"));}else{sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){function a(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("EVALUATION_DEL_SUCCESS"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true);};function b(){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERR_EVALUATION_DEL"));};var p={ID:m.EVALUATION.ID,IS_ACTIVE:m.EVALUATION.IS_ACTIVE};t.busyDialog.open();t.metadataRef.remove("EVALUATION",p,a,b);}if(e=="CANCEL"){}});}},formatChipsCount:function(c){return this.oApplicationFacade.getResourceBundle().getText("TILES")+" ("+(c||0)+")";},getFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){if(t.selectedTile){var d=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER.configuration).tileConfiguration).TILE_PROPERTIES);var a=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER.configuration).tileConfiguration).EVALUATION);var c=t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER;var f="";if(!(d.semanticObject&&d.semanticAction&&c.title&&c.description)||(!(d.storyId)&&d.navType==1)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){if(!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";}if(!(d.semanticAction)||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";}if(!(c.title)||(t.selectedTile.getBindingContext().getObject().title.length==(t.selectedTile.getBindingContext().getObject().title.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";}if(!(c.description)||(c.description.length==(c.description.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION")+"\n";}if((!(d.storyId)&&(d.navType==1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID");}sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);}else{if(t.selectedTile.getBindingContext().getObject().tileType=="CM"){if(!(a)||!(a.COLUMN_NAMES)||!(a.COLUMN_NAMES.length)){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");}else{for(var i=0,l=a.COLUMN_NAMES.length;i<l;i++){if(!(a.COLUMN_NAMES[i].COLUMN_NAME)||!(a.COLUMN_NAMES[i].semanticColor)){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break;}}if((!f)&&(a.COLUMN_NAMES.length==3)){if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[1].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(a.COLUMN_NAMES[1].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}}}if(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);}else{t.metadataRef.create("ACTIVATE_CHIP",{id:c.id},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.refreshMasterList();t.selectedTile=undefined;t.updateFooterButtons();},function(g){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),g.responseText);});}}}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT")+" "+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),onBtnPressed:function(e){if(t.selectedTile){var c=t.selectedTile.getBindingContext("tileConfig").sPath.replace("isActive=1","isActive=0");c=c.replace("/CHIPS_MODELER","CHIPS");t.oRouter.navTo("editTile",{contextPath:t.evalContext.sPath.substr(1),chipContextPath:c});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT"),onBtnPressed:function(e){if(t.selectedTile){t.oRouter.navTo("editTile",{contextPath:t.evalContext.sPath.substr(1),chipContextPath:t.selectedTile.getBindingContext("chipObj").sPath.replace("/CHIPS_MODELER","CHIPS")});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE"),onBtnPressed:function(e){if(t.selectedTile){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.oApplicationFacade.getODataModel().remove(t.selectedTile.getBindingContext("tileConfig").sPath.replace("CHIPS_MODELER","CHIPS"),null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();t.selectedTile=undefined;t.updateFooterButtons();},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body);});}if(e=="CANCEL"){}});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"));}},}];return b;},setSorting:function(k,g){g=g||false;var l=this.getView().byId("tileGrid");if(k=="tileType"){l.getBinding("items").sort([new sap.ui.model.Sorter("tileType",g,null)]);}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("isActive",g,null),new sap.ui.model.Sorter("COUNTER",g,null)]);}else if(k=="none"){l.getBinding("items").sort([]);}},setFiltering:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"DT-CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CM')),"DT-CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CT')),"DT-AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-AT')),"DT-TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-TT')),"new":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,0)),"active":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},handleSortPress:function(){var t=this;this.sortOptionsDialog=this.sortOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});this.sortOptionsDialog.open();},handleFilterPress:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),key:"NT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),key:"CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),key:"TT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),key:"AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),key:"CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_TILE"),key:"DT-CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_MM_TILE"),key:"DT-CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_DEVIATION_TILE"),key:"DT-AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_TREND_TILE"),key:"DT-TT"})]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"),key:"new"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"),key:"active"})]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){f[s[i].getParent().getKey()]=f[s[i].getParent().getKey()]||"";f[s[i].getParent().getKey()]+=(f[s[i].getParent().getKey()])?(","):"";f[s[i].getParent().getKey()]+=s[i].getText();}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?" ; ":"";a+=f[b];}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a);}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});this.filterOptionsDialog.open();},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},formatIndicatorTitle:function(i){return this.oApplicationFacade.getResourceBundle().getText("KPI_TEXT")+" : "+i;}});
