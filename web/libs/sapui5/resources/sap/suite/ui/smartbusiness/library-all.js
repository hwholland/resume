/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
sap.ui.controller("sap.suite.ui.smartbusiness.designtime.association.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.association',this);},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.authorization.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.authorization',this);},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.drilldown.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.drilldown',this);}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.evaluation.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.evaluation',this);}});jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/thresholdAndTargetBar.css");sap.ui.controller("sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",{onBeforeRendering:function(){var t=this;this.parentController=this.getView().getViewData().controller;this.oApplicationFacade=this.parentController.oApplicationFacade;this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.getView().getModel().getData().VALUES_SOURCE=this.getView().byId("valueTypeSelect").getSelectedKey();this.createTrendThresholdLayout();},onAfterRendering:function(){this.byId("valueTypeSelect").setTooltip(this.byId("valueTypeSelect").getSelectedItem().getText());},openMeasureSelectDialog:function(e){var t=this;this.valueType=e.getSource().getCustomData()[0].getKey();var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));t.parentController.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t.parentController);return;}else{var m=this.populateMeasure(d,D);var M=this.getView().getModel().getData().COLUMN_NAME;var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.NE,M);var a=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){switch(t.valueType){case"REFERENCE_VALUE":t.getView().getModel().setProperty("/REFERENCE_VALUE",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALHIGH":t.getView().getModel().setProperty("/CRITICALHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGHIGH":t.getView().getModel().setProperty("/WARNINGHIGH",e.getParameter("selectedItem").getProperty("title"));break;case"TARGET":t.getView().getModel().setProperty("/TARGET",e.getParameter("selectedItem").getProperty("title"));break;case"WARNINGLOW":t.getView().getModel().setProperty("/WARNINGLOW",e.getParameter("selectedItem").getProperty("title"));break;case"CRITICALLOW":t.getView().getModel().setProperty("/CRITICALLOW",e.getParameter("selectedItem").getProperty("title"));break;case"TREND":t.getView().getModel().setProperty("/TREND",e.getParameter("selectedItem").getProperty("title"));break;};},liveChange:function(e){var s=e.getParameter("value");var F=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([F],false);}});a.setModel(m);a.getBinding("items").filter([f],false);a.open();}},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.ui.smartbusiness.lib.OData.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o);}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M;},createTrendThresholdLayout:function(){var t=this;var v=this.getView().getModel().getData();this.byId('targetThresholdBar').removeAllItems();if(v){switch(v.GOAL_TYPE){case"MA":t.createLayoutForMaximizingKPI();this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MAXIMIZING"));this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL_NUM",1));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING_2"));this.getView().byId('targetLabel').setText(t.oResourceBundle.getText("TARGET_NUM",3));this.getView().byId('criticalHighLabel').setVisible(false);this.getView().byId('warningHighLabel').setVisible(false);this.getView().byId('evaluationCriticalHigh').setVisible(false);this.getView().byId('evaluationWarningHigh').setVisible(false);this.getView().byId('relativeCriticalHighText').setVisible(false);this.getView().byId('relativeWarningHighText').setVisible(false);break;case"MI":t.createLayoutForMinimizingKPI();this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_MINIMIZING"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL_NUM",3));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING_2"));this.getView().byId('targetLabel').setText(t.oResourceBundle.getText("TARGET_NUM",1));this.getView().byId('criticalLowLabel').setVisible(false);this.getView().byId('warningLowLabel').setVisible(false);this.getView().byId('evaluationCriticalLow').setVisible(false);this.getView().byId('evaluationWarningLow').setVisible(false);this.getView().byId('relativeWarningLowText').setVisible(false);this.getView().byId('relativeCriticalLowText').setVisible(false);break;case"RA":t.createLayoutForRangeKPI();this.getView().byId('criticalLowLabel').setText(t.oResourceBundle.getText("CRITICAL_LOW_1"));this.getView().byId('warningLowLabel').setText(t.oResourceBundle.getText("WARNING_LOW_2"));this.getView().byId('criticalHighLabel').setText(t.oResourceBundle.getText("CRITICAL_HIGH_5"));this.getView().byId('warningHighLabel').setText(t.oResourceBundle.getText("WARNING_HIGH_4"));this.getView().byId('targetLabel').setText(t.oResourceBundle.getText("TARGET_NUM",3));this.getView().byId('kpiGoalTypeLabel').setText(t.oResourceBundle.getText("KPI_GOAL_TYPE_RANGE"));break;};}},createLayoutForMaximizingKPI:function(){var t=this;var a=new sap.m.HBox({width:"100%",items:[new sap.m.HBox().addStyleClass('thresholdbar critical'),new sap.m.HBox().addStyleClass('thresholdline critical'),new sap.m.HBox().addStyleClass('thresholdbar neutral'),new sap.m.HBox().addStyleClass('thresholdline neutral'),new sap.m.HBox().addStyleClass('thresholdbar positive'),new sap.m.HBox().addStyleClass('thresholdline positive'),new sap.m.HBox({width:"10%"}).addStyleClass('thresholdbar positive'),]});var b=new sap.m.HBox({width:"100%",items:[new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_1")}),]}).addStyleClass('thresholdIndexMax'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_2")}),]}).addStyleClass('thresholdIndexMax'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_3")}),]}).addStyleClass('thresholdIndexMax'),]});this.byId('targetThresholdBar').addItem(a);this.byId('targetThresholdBar').addItem(b);switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalLow').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeWarningLowText').setVisible(false);t.getView().byId('relativeCriticalLowText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"})).setValueHelpOnly(true);t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"})).setValueHelpOnly(true);t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationWarningLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTarget').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationReferenceValue').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE")).setShowValueHelp(false);t.getView().byId('relativeWarningLowText').setVisible(false);t.getView().byId('relativeCriticalLowText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"RELATIVE":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MAXIMIZING"));t.getView().byId('evaluationWarningLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MAXIMIZING"));t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeWarningLowText').setVisible(true);t.getView().byId('relativeCriticalLowText').setVisible(true);t.getView().byId('thresholdExample').setVisible(true);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;};},createLayoutForMinimizingKPI:function(){var t=this;var a=new sap.m.HBox({width:"100%",items:[new sap.m.HBox({width:"10%"}).addStyleClass('thresholdbar positive'),new sap.m.HBox().addStyleClass('thresholdline positive'),new sap.m.HBox().addStyleClass('thresholdbar positive'),new sap.m.HBox().addStyleClass('thresholdline neutral'),new sap.m.HBox().addStyleClass('thresholdbar neutral'),new sap.m.HBox().addStyleClass('thresholdline critical'),new sap.m.HBox().addStyleClass('thresholdbar critical')]});var b=new sap.m.HBox({width:"100%",items:[new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_1")}),]}).addStyleClass('positiveThresholdBarForMin'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_2")}),]}).addStyleClass('thresholdIndexMin'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_3")}),]}).addStyleClass('thresholdIndexMin'),]});this.byId('targetThresholdBar').addItem(a);this.byId('targetThresholdBar').addItem(b);switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeCriticalHighText').setVisible(false);t.getView().byId('relativeWarningHighText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"})).setValueHelpOnly(true);t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"})).setValueHelpOnly(true);t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"FIXED":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationWarningHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTarget').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationReferenceValue').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE")).setShowValueHelp(false);t.getView().byId('relativeCriticalHighText').setVisible(false);t.getView().byId('relativeWarningHighText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"RELATIVE":t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MINIMIZING"));t.getView().byId('evaluationWarningHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MINIMIZING"));t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeCriticalHighText').setVisible(true);t.getView().byId('relativeWarningHighText').setVisible(true);t.getView().byId('thresholdExample').setVisible(true);t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;};},createLayoutForRangeKPI:function(){var t=this;var a=new sap.m.HBox({width:"100%",items:[new sap.m.HBox().addStyleClass('thresholdbarRange critical'),new sap.m.HBox().addStyleClass('thresholdline critical'),new sap.m.HBox().addStyleClass('thresholdbarRange neutral'),new sap.m.HBox().addStyleClass('thresholdline neutral'),new sap.m.HBox().addStyleClass('thresholdbarRange positive'),new sap.m.HBox().addStyleClass('thresholdline positive'),new sap.m.HBox().addStyleClass('thresholdbarRange positive'),new sap.m.HBox().addStyleClass('thresholdline neutral'),new sap.m.HBox().addStyleClass('thresholdbarRange neutral'),new sap.m.HBox().addStyleClass('thresholdline critical'),new sap.m.HBox().addStyleClass('thresholdbarRange critical')]});var b=new sap.m.HBox({width:"100%",items:[new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_1")}),]}).addStyleClass('thresholdIndexRange'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_2")}),]}).addStyleClass('thresholdIndexRange'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_3")}),]}).addStyleClass('thresholdIndexRange'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_4")}),]}).addStyleClass('thresholdIndexRange'),new sap.m.HBox({items:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_TEXT_5")}),]}).addStyleClass('thresholdIndexRange'),]});this.byId('targetThresholdBar').addItem(a);this.byId('targetThresholdBar').addItem(b);switch(this.getView().byId('valueTypeSelect').getSelectedKey()){case"MEASURE":var m=jQuery.proxy(t.openMeasureSelectDialog,t);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationWarningHigh').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationCriticalLow').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationWarningLow').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeWarningLowText').setVisible(false);t.getView().byId('relativeCriticalLowText').setVisible(false);t.getView().byId('relativeCriticalHighText').setVisible(false);t.getView().byId('relativeWarningHighText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"FIXED":t.getView().byId('evaluationCriticalLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationWarningLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationWarningHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTarget').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationReferenceValue').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE"));t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_VALUE")).setShowValueHelp(false);t.getView().byId('relativeWarningLowText').setVisible(false);t.getView().byId('relativeCriticalLowText').setVisible(false);t.getView().byId('relativeCriticalHighText').setVisible(false);t.getView().byId('relativeWarningHighText').setVisible(false);t.getView().byId('thresholdExample').setVisible(false);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L7 M7 S7"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;case"RELATIVE":var m=jQuery.proxy(t.openMeasureSelectDialog,t);t.getView().byId('evaluationCriticalHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MINIMIZING"));t.getView().byId('evaluationWarningHigh').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MINIMIZING"));t.getView().byId('evaluationCriticalLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MAXIMIZING"));t.getView().byId('evaluationWarningLow').setShowValueHelp(false).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MAXIMIZING"));t.getView().byId('evaluationTarget').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationReferenceValue').setShowValueHelp(true).setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setValueHelpOnly(true);t.getView().byId('evaluationTrend').setPlaceholder(t.oApplicationFacade.getResourceBundle().getText("SELECT_MEASURE")).setShowValueHelp(true).setValueHelpOnly(true);t.getView().byId('relativeWarningLowText').setVisible(true);t.getView().byId('relativeCriticalLowText').setVisible(true);t.getView().byId('relativeCriticalHighText').setVisible(true);t.getView().byId('relativeWarningHighText').setVisible(true);t.getView().byId('thresholdExample').setVisible(true);t.getView().byId('evaluationCriticalLow').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('evaluationWarningLow').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('evaluationCriticalHigh').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('evaluationWarningHigh').setLayoutData(new sap.ui.layout.GridData({span:"L3 M3 S3"}));t.getView().byId('EvaluationTargetThresholdTrendInputForm2').rerender();break;};},valueTypeSelectChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());this.getView().getModel().getData().REFERENCE_VALUE="";this.getView().getModel().getData().CRITICALLOW="";this.getView().getModel().getData().WARNINGLOW="";this.getView().getModel().getData().TARGET="";this.getView().getModel().getData().WARNINGHIGH="";this.getView().getModel().getData().CRITICALHIGH="";this.getView().getModel().getData().TREND="";this.getView().getModel().updateBindings();this.createTrendThresholdLayout();},validateThresholdValue:function(e){var t=this;oValue=e.getSource().getValue();oPlaceHolderValue=e.getSource().getPlaceholder();if(oPlaceHolderValue===t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MAXIMIZING")){if(oValue>100){e.getSource().setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("THRESHOLD_VALUE_LESS"));t.parentController.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("THRESHOLD_VALUE_LESS"),});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t.parentController);}else{e.getSource().setValueState("None");}}else if(oPlaceHolderValue===t.oApplicationFacade.getResourceBundle().getText("ENTER_PERCENTAGE_VALUE_MINIMIZING")){if(oValue<100){e.getSource().setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("THRESHOLD_VALUE_MORE"));t.parentController.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("THRESHOLD_VALUE_MORE"),});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t.parentController);}else{e.getSource().setValueState("None");}}},openThersholdExample:function(e){var t=this;var c=new sap.m.Bar({width:"100%",contentMiddle:[new sap.m.Label({text:t.oResourceBundle.getText("THRESHOLD_INFO")})],contentRight:[new sap.m.Button({icon:"sap-icon://decline",press:function(){i.close();}})]});var E=new sap.m.Text({width:"100%",textAlign:"Left",}).addStyleClass("evaluationThresholdInfoHeader");var v=this.getView().getModel().getData();if(v.GOAL_TYPE==="MA"){E.setText(t.oResourceBundle.getText("INFO_TEXT_MAXIMIZING"));}else if(v.GOAL_TYPE==="MI"){E.setText(t.oResourceBundle.getText("INFO_TEXT_MINIMIZING"));}else if(v.GOAL_TYPE==="RA"){E.setText(t.oResourceBundle.getText("INFO_TEXT_RANGE"));}var i=new sap.m.ResponsivePopover({showHeader:true,customHeader:c,contentWidth:"20%",contentHeight:"25%",verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Right,content:[E]});i.openBy(e.getSource());},});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.kpi.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.kpi',this);}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.tools.migration.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.tools.migration',this);}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.visualization.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.visualization',this);},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.designtime.workspace.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.designtime.workspace',this);},onExit:function(){}});sap.ui.controller("sap.suite.ui.smartbusiness.drilldown.view.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.drilldown',this);}});sap.ui.controller("sap.suite.ui.smartbusiness.mpt.Main",{onInit:function(){jQuery.sap.require("sap.ca.scfld.md.Startup");sap.ca.scfld.md.Startup.init('sap.suite.ui.smartbusiness.mpt',this);},onExit:function(){}});jQuery.sap.declare('sap.suite.ui.smartbusiness.library-all');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.js.util');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.kpi.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.tools.migration.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.Main.controller');jQuery.sap.declare('sap.suite.ui.smartbusiness.mpt.Main.controller');if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.abap.CatalogServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.CatalogServicesAdapter");sap.suite.ui.smartbusiness.adapter.abap.CatalogServicesAdapter=function(){var t=this;var c={};var a={'NT':'X-SAP-UI2-CHIP:/SSB/NUMERIC_TILE','CT':'X-SAP-UI2-CHIP:/SSB/COMPARISON_TILE','TT':'X-SAP-UI2-CHIP:/SSB/TREND_TILE','AT':'X-SAP-UI2-CHIP:/SSB/DEVIATION_TILE','CM':'X-SAP-UI2-CHIP:/SSB/COMPARISON_MM_TILE','DT-CT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON','DT-CM':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON_MM','DT-AT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_DEVIATION','DT-TT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_TREND'};var g=function(e,E){if(E){return E.evaluationValues;}else{var v=[];e.VALUES.forEach(function(j){delete j.__metadata;var o={};for(var p in j){if(j.hasOwnProperty(p)){o[p]=j[p];}}v.push(o);});return v;}};var _=function(d){var e=[];if(d&&d.length){d.forEach(function(i){var o={};o["NAME"]=i[0];o["OPERATOR"]=i[1];o["VALUE_1"]=i[2];o["VALUE_2"]=i[3];o["TYPE"]="FI";e.push(o);});}return e;};var b=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var d=sap.ushell.Container.getService("URLParsing");if(d){u=d.addSystemToServiceUrl(u,s);}}return u;};var f=function(){if(!(c.ui2Factory)){var s="PERS";jQuery.sap.log.info("Abap Adapter --> Creating UI2 Factory with Scope - "+s);if(sap.ushell&&sap.ushell.Container){c.ui2Factory=sap.ushell.Container.getService("PageBuilding",s).getFactory();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 Factory from cache");}return c.ui2Factory;};function h(p,e,i){if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}var F=f();var P=f().getPageBuildingService();var j=a[p.tileType];p.id=j;p.chipId=j;var C=new sap.ui2.srvc.Chip(p,F);var o=new sap.ui2.srvc.Page(F,p.catalogId);var k=null;var l=null;var n=null;function w(d){jQuery.sap.log.info("Abap Adapter --> Bag updated successfully for the Chip Instance");}function m(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing into the Bag of the Chip Instance");i(d,s,x);}function q(d){jQuery.sap.log.info("Abap Adapter --> Configuration updated successfully for the Chip Instance");if(e){e({response:{chipId:n}});}}function r(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing Configuration to the Chip Instance");i(d,s,x);}function u(d){jQuery.sap.log.info("Abap Adapter --> Chip Instance created successfully");var U='X-SAP-UI2-PAGE';var s=d;var x=s.getId();p.ID=x;p.configuration=p.configuration.replace(/___CHIPINSTID______CHIPINSTID___/g,x);p.configuration=p.configuration.replace(/_____CHIPID__________CHIPID_____/g,U+":"+p.catalogId+":"+x);n=U+":"+p.catalogId+":"+x;s.getApi().writeConfiguration.setParameterValues(p.configuration,q,r);s.setTitle(p.title);var D=s.getBag("sb_tileProperties");D.setText("title",p.title);D.setText("description",p.description);D.save(w,m);}function v(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error in creating a Chip Instance in the UI2 Catalog");i(d,s,x);}function y(){jQuery.sap.log.info("Abap Adapter --> Chip Stub loaded successfully");k=C;l.addChipInstance(k,u,v);}function z(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Chip Stub");i(d,s,x);}function A(){jQuery.sap.log.info("Abap Adapter --> Page Stub loaded successfully");l=o;C.load(y,z);}function B(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Page Stub");i(d,s,x);}o.load(A,B);};this.publishChip=function(p,m,s,e){if(m=="create"){jQuery.sap.log.info("Abap Adapter --> Calling Chip create");h(p,s,e);}else{jQuery.sap.log.info("Abap Adapter --> Calling Chip update");}};this.savePersonalizedTile=function(p){var r={},R,S,C,o;if(p.evaluationId&&p.tileType){R=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");var i=R.getEvaluationById({id:p.evaluationId,ID:p.evaluationId,cache:true,filters:true,values:true,thresholds:true,useRuntimeService:true,sapSystem:p.sapSystem});if(i.EVALUATION&&i.EVALUATION.ID){var T=Date.now()+"";var M={};function j(o){var d=JSON.parse(o.configuration);d.isSufficient="1";d.timestamp=T;var l=JSON.parse(d.tileConfiguration);var m=JSON.parse(l.TILE_PROPERTIES);m.id="_____CHIPID__________CHIPID_____";m.instanceId="___CHIPINSTID______CHIPINSTID___";m.catalogId="/UI2/Fiori2LaunchpadHome";l.TILE_PROPERTIES=JSON.stringify(m);l.ADDITIONAL_FILTERS=JSON.stringify(_(p.additionalFilters));l.EVALUATION_VALUES=JSON.stringify(g(i,p.evaluationValues));d.tileConfiguration=JSON.stringify(l);d=JSON.stringify(d);o.configuration=d;o.tileType=p.tileType;o.catalogId="/UI2/Fiori2LaunchpadHome";o.title=o.title||i.INDICATOR_TITLE;o.description=p.title||i.TITLE;t.publishChip(o,"create",p.success,p.error);};function k(d,s,x){};try{S=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();C=S["chipId"][0];C=decodeURIComponent(C);C=decodeURIComponent(C);o=R.getChipById({id:C,success:j,error:k});}catch(e){return{status:"Failed",message:e.message};}}else{r.status="Failed",r.message="Invalid Evaluation Id : "+p.evaluationId;}}else{r.status="Failed",r.message="Mandatory Param evaluationId or TileType is Missing";}return r;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.abap.DrilldownServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.DrilldownServicesAdapter");sap.suite=sap.suite||{};sap.suite.ui=sap.suite.ui||{};sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.adapter=sap.suite.ui.smartbusiness.adapter||{};sap.suite.ui.smartbusiness.adapter.abap=sap.suite.ui.smartbusiness.adapter.abap||{};sap.suite.ui.smartbusiness.adapter.abap.DrilldownServicesAdapter={fetchXSRFToken:function(S,e){jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/__token.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){if(S)S(d,s,x);},error:function(){if(e)e(d,s,x);}});},constants:{"write":{fn:"getWritePayload"},"delete":{fn:"getDeletePayload"},"update":{fn:"getUpdatePayload"},"viewServiceUrl":"/sap/hba/r/sb/core/logic/ddaViewConfiguration_cud.xsjs","evalServiceUrl":"/sap/hba/r/sb/core/logic/ddaEvaluation_cud.xsjs"},doUpdate:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"PUT",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doWrite:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"POST",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doDelete:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"DELETE",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doServiceCall:function(c){var t=this;if(c.type=="POST"){this.doWrite(c);}else if(c.type=="PUT"){this.doUpdate(c);}else if(c.type="DELETE"){this.doDelete(c);}},saveEvalConfiguration:function(e,d,a,s,E){var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d),url:this.constants.evalServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},saveViewConfiguration:function(e,d,a,s,E){a=d.ID_EDITABLE?"write":a;var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d,true),url:this.constants.viewServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},getUpdatePayload:function(e,d,i){return{payload:this.getWritePayload(e,d,i),keys:this.getDeletePayload(e,d,i)};},getWritePayload:function(e,d,i){var c=d.SELECTED_VIEW,r;if(i){r={DDA_COLUMNS:this.getColumnsPayload(d,e,c),DDA_CHART:this.getChartPayload(d,e,c),DDA_MASTER_TEXT:this.getViewTextPayload(d,e,c)};if(d.ID_EDITABLE){r.DDA_MASTER=this.getNewViewPayload(d.ALL_VIEWS,e,c);}}else{r={DDA_FILTERS:this.getFilterPayload(d.CURRENT_FILTERS,e,c),DDA_HEADER:this.getHeaderPayload(d.HEADERS_VISIBLE,e,c),DDA_CONFIGURATION:this.getConfigurationPayload(d,e,c)};var v=this.getViewOrderPayload(d.ALL_VIEWS,e,c);if(v.length){r.DDA_MASTER=v;}}return r;},getDeletePayload:function(e,d,i){return{"EVALUATION_ID":e,"CONFIGURATION_ID":d.ID};},getViewTextPayload:function(d,e,c){var v=[];var a=d.CURRENT_LANGUAGE,b=d.TITLE;d=d.ADDITIONAL_LANGUAGE_TITLES||[];for(var i=0;i<d.length;i++){if(d[i].SAP_LANGUAGE_KEY==a)continue;v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":d[i].SAP_LANGUAGE_KEY,"TEXT":d[i].TEXT,"IS_ACTIVE":1});}v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":a,"TEXT":b,"IS_ACTIVE":1});return v;},getChartPayload:function(d,e,c){return[{"EVALUATION_ID":e,"CONFIGURATION_ID":c,"VALUE_TYPE":d.VALUE_TYPE,"AXIS_TYPE":d.AXIS_TYPE,"CHART_TYPE":d.CHART_TYPE,"DATA_LIMIT":d.DATA_LIMITATIONS?d.DATA_LIMIT:-1,"COLOR_SCHEME":d.COLOR_SCHEME,"IS_ACTIVE":1,"THRESHOLD_MEASURE":d.THRESHOLD_MEASURE}];},getColumnsPayload:function(d,e,c){var a=[];var b=d.COLOR_SCHEME;d=d.items||[];for(var i=0;i<d.length;i++){if(d[i].SELECTED)a.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"NAME":d[i].NAME,"TYPE":d[i].TYPE.toUpperCase(),"SORT_BY":d[i].SORT_BY,"VISIBILITY":d[i].VISIBILITY,"COLOR":(b=="MANUAL_NON_SEMANTIC"?d[i].COLOR1:b=="MANUAL_SEMANTIC"?d[i].COLOR2:"")||"","STACKING":d[i].STACKING,"AXIS":d[i].AXIS,"SORT_ORDER":d[i].SORT_ORDER,"COLUMNS_ORDER":i,"IS_ACTIVE":1});}return a;},getFilterPayload:function(d,e,c){var f=[];d=d||[];for(var i=0;i<d.length;i++){f.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"DIMENSION":d[i],"VISIBILITY":1,"IS_ACTIVE":1});}return f;},_getHeaderConfiguration:function(h){var d;switch(h.VISUALIZATION_TYPE){case"CM":d=[{name:h.MEASURE1,color:h.COLOR1},{name:h.MEASURE2,color:h.COLOR2}];(h.MEASURE3&&h.MEASURE3!="_none^")?d.push({name:h.MEASURE3,color:h.COLOR3}):"";d=JSON.stringify({MEASURES:JSON.stringify(d)});break;case"CT":d={order:h.SORT_ORDER[1]=="D"?"desc":"asc",by:h.SORT_ORDER[0],dimension_color:h.DIMENSION_COLOR};d=JSON.stringify({SORTING:JSON.stringify(d)});break;}return d;},getHeaderPayload:function(d,e,c){var h=[];d=d||[];for(var i=0;i<d.length;i++){if(d[i])h.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"VISUALIZATION_TYPE":d[i].VISUALIZATION_TYPE,"VISIBILITY":1,"REFERENCE_EVALUATION_ID":d[i].REFERENCE_EVALUATION_ID,"VISUALIZATION_ORDER":i,"DIMENSION":d[i].DIMENSION,"IS_ACTIVE":1,"CONFIGURATION":this._getHeaderConfiguration(d[i])});}return h;},getConfigurationPayload:function(d,e,c){var a={"SAP_FILTER":{value:"",visibility:1},"SAP_AGGREGATE_VALUE":{value:"",visibility:(d.CONFIG.SAP_AGGREGATE_VALUE?1:0)},"SAP_HEADER":{value:"",visibility:1},"QUERY_SERVICE_URI":{value:d.QUERY_SERVICE_URI,visibility:1},"QUERY_ENTITY_SET":{value:d.QUERY_ENTITY_SET,visibility:1},};var b=[];for(var f in a){b.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"PROPERTY_TYPE":f,"PROPERTY_VALUE":a[f].value,"VISIBILITY":a[f].visibility,"IS_ACTIVE":1});}return b;},getNewViewPayload:function(d,e,c){return[{"CONFIGURATION_ID":c,"EVALUATION_ID":e,"CONFIG_ORDER":(d.length+1),"IS_ACTIVE":1}];},getViewOrderPayload:function(d,e,c){var a=[];d=d||[];for(var i=0;i<d.length;i++){a.push({"CONFIGURATION_ID":d[i].ID,"EVALUATION_ID":e,"CONFIG_ORDER":i,"IS_ACTIVE":1});}return a;}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.abap.ModelerServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.ModelerServicesAdapter");sap.suite.ui.smartbusiness.adapter.abap.ModelerServicesAdapter=function(){var t=this;this.cache=this.cache||{};var _={DDA_COLUMN:["EVALUATION_ID",{name:"IS_ACTIVE",formatter:function(s){return parseInt(s);}},"CONFIGURATION_ID","NAME","TYPE"],DDA_CHART:["EVALUATION_ID","IS_ACTIVE","CONFIGURATION_ID"],EVALUATIONS:["ID","IS_ACTIVE"],EvaluationTexts:["ID","IS_ACTIVE","LANGUAGE"],IndicatorTexts:["ID","IS_ACTIVE","LANGUAGE"],INDICATORS:["ID","IS_ACTIVE"],IndicatorTexts:["ID","IS_ACTIVE","LANGUAGE"],EVALUATION_FILTERS:["ID","IS_ACTIVE","TYPE","NAME","VALUE_1","OPERATOR","VALUE_2"],FILTERS:["ID","IS_ACTIVE","TYPE","NAME","VALUE_1","OPERATOR","VALUE_2"],EVALUATION_VALUES:["ID","IS_ACTIVE","TYPE"],TAGS:["ID","IS_ACTIVE","TYPE","TAG"],PROPERTIES:["ID","IS_ACTIVE","TYPE","NAME","VALUE"],CHIPS:["ID","IS_ACTIVE"],INDICATOR:[],EVALUATION:[],CHIPS:[],ACTIVATE_INDICATOR:[],ACTIVATE_EVALUATION:[],INDICATOR_FAVOURITE:[],EVALUATION_FAVOURITE:[],ASSOCIATION:[],ACTIVATE_ASSOCIATION:[],ACTIVATE_CHIP:[],AUTHORIZATION:[]};_ENTITYSETMAP={EVALUATION:"EVALUATIONS",CHIP:"CHIPS",INDICATOR:"INDICATORS",FILTERS:"EVALUATION_FILTERS",TEXTS:"EVALUATION_TEXTS",VALUES:"EVALUATION_VALUES"};_DATATYPE={IS_ACTIVE:"int"};function b(e){var a={"INDICATORS":{"indicator":{"entity":"INDICATORS","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"INDICATORS_MODELER":{"indicator":{"entity":"INDICATORS_MODELER","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"EVALUATIONS":{"evaluation":{"entity":"EVALUATIONS","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"}},"EVALUATIONS_MODELER":{"evaluation":{"entity":"EVALUATIONS_MODELER","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"},"texts_for_chip":{"entity":"TEXTS_FOR_CHIP","type":"EVALUATION_TEXT"}},"CHIPS":{"texts":{"entity":"TEXTS","type":"CHIP_TEXT"},"evaluation":{"entity":"EVALUATION_INFO","type":"EVALUATION"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"}}};return a[e];};function f(e){return beans={"INDICATOR":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"}},"EVALUATION":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT","NAMESPACE":"NAMESPACE"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT"}},"CHIP":{"bean":{"ID":"id","IS_ACTIVE":"isActive","EVALUATION_ID":"evaluationId","CATALOG_ID":"catalogId","TYPE":"tileType","COUNTER":"COUNTER","CREATED_BY":"createdBy","CHANGED_BY":"changedBy","CREATED_ON":"createdOn","CHANGED_ON":"changedOn"},"reverseBean":{"id":"ID","isActive":"IS_ACTIVE","evaluationId":"EVALUATION_ID","catalogId":"CATALOG_ID","tileType":"TYPE","COUNTER":"COUNTER","createdBy":"CREATED_BY","changedBy":"CHANGED_BY","createdOn":"CREATED_ON","changedOn":"CHANGED_ON"}},"ASSOCIATION":{"bean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"},"reverseBean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"}},"TAG":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"}},"PROPERTY":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"}},"FILTER":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"}},"VALUE":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"}},"DDA_MASTER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"}},"DDA_HEADER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"}},"LANGUAGE":{"bean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"},"reverseBean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"}},"INDICATOR_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"EVALUATION_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"CHIP_TEXT":{"bean":{"ID":"id","IS_ACTIVE":"isActive","LANGUAGE":"language","CATALOG_ID":"catalogId","TITLE":"title","DESCRIPTION":"description"},"reverseBean":{"id":"ID","isActive":"IS_ACTIVE","language":"LANGUAGE","catalogId":"CATALOG_ID","title":"TITLE","description":"DESCRIPTION"}}};};this.formBean=function(a,e,c){var j={};var m=[];var p={};var A={};var E=false;if(c){j=beans[e].bean;}else{j=beans[e].reverseBean;}if(a instanceof Array){E=true;}else{a=[a];}for(var i=0,l=a.length;i<l;i++){p={};A=a[i];for(var F in j){if(j.hasOwnProperty(F)){if(A[F]!==undefined&&A[F]!==null){p[j[F]]=A[F];}}}m.push(p);}if(!E){m=m[0];}return m;};function g(){t.cache.designtimeModel=t.cache.designtimeModel||new sap.ui.model.odata.ODataModel(t.getDesigntimeServiceUrl(),true);return t.cache.designtimeModel;};function h(){t.cache.runtimeModel=t.cache.runtimeModel||new sap.ui.model.odata.ODataModel(t.getRuntimeServiceUrl(),true);return t.cache.runtimeModel;};function k(){return"/sap/opu/odata/SSB/SMART_BUSINESS_MODELER_SRV";};this.getDesigntimeServiceUrl=function(){jQuery.sap.log.info("Abap Adapter --> Designtime Service URI");return"/sap/opu/odata/SSB/SMART_BUSINESS_MODELER_SRV";};this.getRuntimeServiceUrl=function(){jQuery.sap.log.info("Abap Adapter --> Runtime Service URI");return"/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV";};function n(a){return jQuery.sap.encodeURL(a);};this.getSessionUser=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Session User");var c=null;var i=a.success;var j=a.error;if(t.cache.sessionUser){c=t.cache.sessionUser;jQuery.sap.log.info("Abap Adapter --> Current Session User From Cache - "+t.cache.sessionUser);if(i){i(c);}}else{try{if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}c=sap.ushell.Container.getUser().getId();t.cache.sessionUser=c;jQuery.sap.log.info("Abap Adapter --> Current Session User - "+t.cache.sessionUser);if(i){i(c);}}catch(e){jQuery.sap.log.error("Abap Adapter --> Fetching Session User Failed");if(j){j(d,s,x);}}}return t.cache.sessionUser;};this.getSystemInfo=function(a){jQuery.sap.log.info("Abap Adapter --> Fetching System Info");var e=null;var c=a.success;var i=a.error;function j(d){if(d===null||d===undefined){d={};d.SYSFLAG=1;}if(d.length&&d[0]){e=parseInt(d[0].SYSFLAG,10);}if(jQuery.sap.getUriParameters().get("env")=="cust"){e=0;}t.cache.env=e;jQuery.sap.log.info("Abap Adapter --> System Environment - "+((t.cache.env)?"SAP":"Non-SAP"));if(c){c(e);}}function l(d,s,x){jQuery.sap.log.error("Abap Adapter --> Fetching System Info Failed");if(i){i(d,s,x);}}if(t.cache.env==undefined){t.getDataByEntity({entity:"SysInfoSet",async:a.async||false,success:j,error:l,model:a.model});}else{jQuery.sap.log.info("Abap Adapter --> System Environment From Cache - "+((t.cache.env)?"SAP":"Non-SAP"));if(c){c(t.cache.env);}}return t.cache.env;};this.getAllLanguages=function(e){var l=undefined;var j=e.success;var m=e.error;var A=function(F){F=(F.results)?F.results:F;if(F.length){if(F.length==1){var S={LAISO:{},SPRAS:{}};S.LAISO[F[0]["LAISO"]]=F[0]["SPRAS"];S.SPRAS[F[0]["SPRAS"]]=F[0]["LAISO"];}else{S=F.reduce(function(p,c,i,a){S=S||{};S.LAISO=S.LAISO||{};S.SPRAS=S.SPRAS||{};if(i==1){S.LAISO[a[0]["LAISO"]]=a[0]["SPRAS"];S.SPRAS[a[0]["SPRAS"]]=a[0]["LAISO"];}S.LAISO[a[i]["LAISO"]]=a[i]["SPRAS"];S.SPRAS[a[i]["SPRAS"]]=a[i]["LAISO"];return S;});}var G=F;t.cache.SAP_LANGUAGES=S;t.cache.SAP_LANGUAGE_ARRAY=G;t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();l=S.LAISO[t.cache.localeIsoLanguage];t.cache.localLanguage=l;t.cache.localeSapLanguage=l;jQuery.sap.log.info("Abap Adapter --> Logon Language - "+t.cache.localeIsoLanguage+" - "+t.cache.localeSapLanguage);}if(j){j(S,G,l);}};var E=function(d,s,x){if(m){m(d,s,x);}};if(t.cache.SAP_LANGUAGE_ARRAY&&t.cache.SAP_LANGUAGES){jQuery.sap.log.info("Abap Adapter --> Picking All Languages from cache");t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();t.cache.localLanguage=t.cache.SAP_LANGUAGES.LAISO[t.cache.localeIsoLanguage];t.cache.localeSapLanguage=t.cache.localLanguage;if(j){j(t.cache.SAP_LANGUAGES,t.cache.SAP_LANGUAGE_ARRAY,t.cache.localLanguage);}}else{jQuery.sap.log.info("Abap Adapter --> Calling All Languages");this.getDataByEntity({entity:"LANGUAGE",async:(e.async||false),success:A,error:E,model:e.model});}};this.getKPIById=function(a){jQuery.sap.log.info("Abap Adapter --> Calling KPI Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Indicator Id or Status for data fetch");return null;}var c=null;var j=a.context||null;var m=a.model||g();var p={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/INDICATORS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";j=new sap.ui.model.Context(m,c);}var s=a.success;var e=a.error;var E=[];var F=[];if(!(a.noIndicator)){if(j&&j.getObject()&&Object.keys(j.getObject())&&Object.keys(j)){p.INDICATOR=j.getObject();}else{E.push(m.createBatchOperation(c,"GET"));F.push("INDICATOR");}}if(a.tags){E.push(m.createBatchOperation(c+"/TAGS","GET"));F.push("TAGS");}if(a.properties){E.push(m.createBatchOperation(c+"/PROPERTIES","GET"));F.push("PROPERTIES");}if(a.texts){E.push(m.createBatchOperation(c+"/TEXTS","GET"));F.push("TEXTS");}if(a.evaluations){E.push(m.createBatchOperation(c+"/EVALUATIONS","GET"));F.push("EVALUATIONS");}if(a.associations&&a.associationProperties){E.push(m.createBatchOperation("/ASSOCIATIONS_MODELER?$filter="+n("SOURCE_INDICATOR eq '"+a.ID+"' or TARGET_INDICATOR eq '"+a.ID+"'")+"&$expand=PROPERTIES","GET"));F.push("ASSOCIATIONS");}else if(a.associations){E.push(m.createBatchOperation(c+"/ASSOCIATION_SOURCE","GET"));E.push(m.createBatchOperation(c+"/ASSOCIATION_TARGET","GET"));F.push("ASSOCIATION_SOURCE");F.push("ASSOCIATION_TARGET");}a.async=(a.async)?true:false;m.addBatchReadOperations(E);m.submitBatch(function(G,H){var A=G.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(F[i]+" : "+JSON.stringify(A[i]));p[F[i]]=(A[i].data)?((A[i].data.results)?A[i].data.results:A[i].data):null;}if(s){s(p);}},function(A){if(e){e(A);}throw new Error("Failed to fetch Indicator details");},a.async);if(a.associations&&a.associationProperties){for(var i=0,l=p.ASSOCIATIONS.length;i<l;i++){if(p.ASSOCIATIONS[i].PROPERTIES){if(p.ASSOCIATIONS[i].PROPERTIES.results&&p.ASSOCIATIONS[i].PROPERTIES.results.length){p.ASSOCIATIONS[i].PROPERTIES=p.ASSOCIATIONS[i].PROPERTIES.results;}else{p.ASSOCIATIONS[i].PROPERTIES=[];}}else{p.ASSOCIATIONS[i].PROPERTIES=[];}}}else{p.ASSOCIATIONS=[].concat(p.ASSOCIATION_SOURCE).concat(p.ASSOCIATION_TARGET);}return p;};this.getEvaluationById=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Evaluation Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var j=a.context||null;var m=a.model||g();var p={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE='0'")!=-1)||(c.indexOf("IS_ACTIVE='1'")!=-1))?((c.indexOf("IS_ACTIVE='0'")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/EVALUATIONS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";j=new sap.ui.model.Context(m,c);}var s=a.success;var e=a.error;var E=[];var F=[];if(!(a.noEvaluation)){if(j&&j.getObject()&&Object.keys(j.getObject())&&Object.keys(j)){p.EVALUATION=j.getObject();}else{E.push(m.createBatchOperation(c,"GET"));F.push("EVALUATION");}}if(a.tags){E.push(m.createBatchOperation(c+"/TAGS","GET"));F.push("TAGS");}if(a.indicator_tags){E.push(m.createBatchOperation(c+"/INDICATOR_TAGS","GET"));F.push("INDICATOR_TAGS");}if(a.properties){E.push(m.createBatchOperation(c+"/PROPERTIES","GET"));F.push("PROPERTIES");}if(a.texts){E.push(m.createBatchOperation(c+"/TEXTS","GET"));F.push("TEXTS");}if(a.filters){E.push(m.createBatchOperation(c+"/FILTERS","GET"));F.push("FILTERS");}if(a.values){E.push(m.createBatchOperation(c+"/VALUES","GET"));F.push("VALUES");}if(a.chips){E.push(m.createBatchOperation(c+"/CHIPS","GET"));F.push("CHIPS");}if(a.dda_configurations){E.push(m.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));F.push("DDA_CONFIGURATIONS");}if(a.dda_header_tiles){E.push(m.createBatchOperation(c+"/DDA_HEADER_TILES","GET"));F.push("DDA_HEADER_TILES");}a.async=(a.async)?true:false;m.addBatchReadOperations(E);m.submitBatch(function(G,H){var A=G.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(F[i]+" : "+JSON.stringify(A[i]));p[F[i]]=(A[i].data)?((A[i].data.results)?A[i].data.results:A[i].data):null;}if(s){s(p);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Evaluation details");},a.async);return p;};this.getAssociationById=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Association Data");var t=this;var c=null;var j=a.context||null;var m=a.model||g();var p={};if(a.context){c=a.context.sPath;}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){}var s=a.success;var e=a.error;var E=[];var F=[];if(!(a.noAssociation)){if(j&&j.getObject()&&Object.keys(j.getObject())&&Object.keys(j)){p.ASSOCIATION=j.getObject();}else{E.push(m.createBatchOperation(c,"GET"));F.push("ASSOCIATION");}}if(a.properties){E.push(m.createBatchOperation(c+"/PROPERTIES","GET"));F.push("PROPERTIES");}if(a.source){E.push(m.createBatchOperation(c+"/SOURCE_INDICATOR_INFO","GET"));F.push("SOURCE_INDICATOR_INFO");}if(a.target){E.push(m.createBatchOperation(c+"/TARGET_INDICATOR_INFO","GET"));F.push("TARGET_INDICATOR_INFO");}a.async=(a.async)?true:false;m.addBatchReadOperations(E);m.submitBatch(function(G,H){var A=G.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(F[i]+" : "+JSON.stringify(A[i]));p[F[i]]=(A[i].data)?((A[i].data.results)?A[i].data.results:A[i].data):null;}if(s){s(p);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Association details");},a.async);return p;};this.getChipById=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Chip Data");var t=this;if(!(a.id&&a.isActive!==null&&a.isActive!==undefined)&&!(a.context)){throw new Error("Failed to get Chip Id or Status for data fetch");return null;}var c=null;var j=a.context||null;var m=a.model||g();var p={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.id=a.context.getObject().ID;a.isActive=a.context.getObject().IS_ACTIVE;}else{a.id=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.isActive=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.id&&a.isActive!==null&&a.isActive!==undefined){a.entity=a.entity||"/CHIPS";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.id+"',IS_ACTIVE="+a.isActive+")";j=new sap.ui.model.Context(m,c);}var s=a.success;var e=a.error;var E=[];var F=[];if(!(a.noChip)){if(j&&j.getObject()&&Object.keys(j.getObject())&&Object.keys(j)){p.CHIP=j.getObject();}else{E.push(m.createBatchOperation(c,"GET"));F.push("CHIP");}}if(a.evaluation){E.push(m.createBatchOperation(c+"/EVALUATION_INFO","GET"));F.push("EVALUATION_INFO");}if(a.texts){E.push(m.createBatchOperation(c+"/TEXTS","GET"));F.push("TEXTS");}if(a.dda_configurations){E.push(m.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));F.push("DDA_CONFIGURATIONS");}a.async=(a.async)?true:false;m.addBatchReadOperations(E);m.submitBatch(function(G,H){var A=G.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(F[i]+" : "+JSON.stringify(A[i]));p[F[i]]=(A[i].data)?((A[i].data.results)?A[i].data.results:A[i].data):null;}if(s){s(p);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Chip details");},a.async);return p;};this.getChipByEvaluation=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Chips for Evaluation");a.async=false;a.chips=true;var c=a.success;var e=a.error;t.chipObj={};function i(l){var m=l.EVALUATION;if(a.partial){t.chipObj={EVALUATION:l.EVALUATION,CHIPS:l.CHIPS,CATALOGS:[]};c(t.chipObj);return;}t.chipObj={EVALUATION:l.EVALUATION,CHIPS:[],CATALOGS:[]};var p=y(l);var A=z(c,e);}function j(d,s,x){if(e){e(d,s,x);}}a.success=i;a.error=j;var l=this.getEvaluationById(a);return null;};this.getDataByEntity=function(a){jQuery.sap.log.info("Abap Adapter --> Calling Entity Data");var t=this;var c=a.uri;var m=a.model||(c?new sap.ui.model.odata.ODataModel(c,true):g());var e="";var j=[];var p="";var A="";var E="";var F=null;var G=null;var H=null;var I=a.success;var J=a.error;if(!(a.entity)){jQuery.sap.log.error("Entity or Context is missing for getDataByEntity call");throw Error("Entity or Context is missing for getDataByEntity call");}jQuery.sap.log.info("Abap Adapter --> Calling Entity Data - "+a.entity);entity=a.entity;entity=(entity.indexOf("/")==0)?entity:("/"+entity);if(a.select){if(typeof(a.select)=="string"){A=a.select;}else{A=a.select;}}if(a.expand){if(a.expand instanceof Array){for(var i=0,l=a.expand.length;i<l;i++){e+=(e)?",":"";e+=a.expand[i];}j=a.expand;}else if(typeof(a.expand)=="string"){e=a.expand;j=a.expand.split(",");}}if(a.filter){if(typeof(a.filter)=="string"){p=a.filter;}else{p=a.filter;}}if(a.orderby){if(typeof(a.orderby)=="string"){E=a.orderby;}else{E=a.orderby;}}a.async=(a.async)?true:false;if(entity.indexOf("$select")==-1){if(A){entity+=(entity.indexOf("?")==-1)?("?$select="+A):("&$select="+A);}}if(entity.indexOf("$expand")==-1){if(e){entity+=(entity.indexOf("?")==-1)?("?$expand="+e):("&$expand="+e);}}if(entity.indexOf("$filter")==-1){if(p){entity+=(entity.indexOf("?")==-1)?("?$filter="+p):("&$filter="+p);}}if(entity.indexOf("$orderby")==-1){if(E){entity+=(entity.indexOf("?")==-1)?("?$orderby="+E):("&$orderby="+E);}}if(entity.indexOf("$top")==-1){if(Number(F)){entity+=(entity.indexOf("?")==-1)?("?$top="+Number(F)):("&$top="+Number(F));}}if(entity.indexOf("$skip")==-1){if(Number(G)){entity+=(entity.indexOf("?")==-1)?("?$skip="+Number(G)):("&$skip="+Number(G));}}var K=function(d,s,x){H=(d&&d.results)?d.results:d;if(I){I(H);}};var L=function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);if(J){H={d:d,s:s,x:x};J(d,s,x);}};m.read(entity,null,null,a.async,K,L);return H;};this.getDataByBatch=function(){jQuery.sap.log.info("Abap Adapter --> Calling Entity Batch Data");};this.populateRelevantEntitySet=function(a,m,c){jQuery.sap.log.info("Abap Adapter --> Calling for Relevant Entity Sets");};this.getAllViews=function(a){jQuery.sap.log.info("Abap Adapter --> Calling for All Views");};this.getPlatform=function(){jQuery.sap.log.info("Abap Adapter --> Fetching Platform");t.cache.platform=t.cache.platform||"abap";jQuery.sap.log.info("Abap Adapter --> Platform - "+t.cache.platform);return t.cache.platform;};function o(a,c,j,l){a=a.replace(/\/$/g,"");var m=(_ENTITYSETMAP[a]||a);if(!l){try{var p=(_[a]&&_[a].length)?_[a]:Object.keys(c);}catch(e){var p=c instanceof Object?Object.keys(c):[];}if(p.length){m+="(";for(var i=0,A;i<p.length;i++){var E=p[i];A=_DATATYPE[E]=="int"?"":"'";var F=(c[E]==undefined)?j[E]:c[E];m+=p[i]+"="+A+F+A+",";}m=m.replace(/,$/g,"")+")";}}return m;}function q(a,e,p,c,m,S,E){var t=this,j,R=[];if(!(p instanceof Array)){p=[p];}for(var i=0;i<p.length;i++){if(Object.keys(p[i]).length==0)continue;for(var l in c){p[i][l]=c[l];}j=o(e,c,p[i],m=="POST");if(m=="DELETE"){R.push(a.createBatchOperation(j,m));}else{R.push(a.createBatchOperation(j,m,p[i]));}}if(R.length){a.addBatchChangeOperations(R);}else{S();}}function r(a,c,S,e){var j=a();if(j&&j.length){var t=this;var l=k();var m=sap.suite.ui.smartbusiness.lib.Util.odata?sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(l):new sap.ui.model.odata.ODataModel(l,true);for(var i=0,p;i<j.length&&((p=j[i]));i++){q(m,p.entity,p.payload,p.keys,p.method,S,e);}m.submitBatch(function(A,E){r(a,c,S,e);},c,true);}}function u(p,e){var a=[],c=[],j="POST",l=p;var R=[];if(!(l instanceof Array)){l=[l];}for(var i=0,m;i<l.length;i++){var m=l[i].payload||l[i];var A=l[i].keys||null;for(var E in m){var F=m[E]||{};if(F.remove){a.push({keys:A,payload:F.remove,method:"DELETE",entity:E});}if(F.update){c.push({keys:A,payload:F.update,method:"PUT",entity:E});}if(F.create){c.push({keys:A,payload:F.create,method:"POST",entity:E});}if(!(F.remove||F.create||F.update)){c.push({keys:A,payload:F,method:j,entity:E});}}}if(a.length)R.push(a);if(c.length)R.push(c);return R;}function v(p,e){var a=[],c=p;var j="DELETE";if(!(p instanceof Array)){c=p.payload||p;c=[c];}for(var i=0,l;i<c.length;i++){l=c[i];a.push({keys:l,payload:l,method:j,entity:e})}return a.length?[a]:[];}function w(a,c,S,e,j){var l=[],i=0;function m(){delete l;e();}function p(){var A=l[i++];if(!A){S();}return A;}if(a=='remove'){l=v(c,j);}else{l=u(c,j);}r(p,m,S,e);}this.create=function(e,p,a,S,E,c,i){w("create",p,S,E,e);};this.update=function(e,p,a,S,E,m,c,i,j){w("update",p,S,E,e);};this.remove=function(e,p,S,E,a,c,i,j){w("remove",p,S,E,e);};this.addSystemToServiceUrl=function(a){jQuery.sap.log.info("Abap Adapter --> Add System to Service Url");return a;};this.getUI2Scope=function(){if(!(t.cache.ui2Scope)){jQuery.sap.log.info("Abap Adapter --> Fetching UI2 Scope from URL");var a="CUST";var c=t.getSystemInfo({async:false,model:g()});if(c){a="CONF";var e=jQuery.sap.getUriParameters().get("scope");if(e==="CUST"){a=e;}}else{a="CUST";}t.cache.ui2Scope=a;}else{jQuery.sap.log.info("Abap Adapter --> Fetching UI2 Scope from cache");}jQuery.sap.log.info("Abap Adapter --> Current UI2 Scope - "+t.cache.ui2Scope);return t.cache.ui2Scope;};this.getUI2Factory=function(){if(!(t.cache.ui2Factory)){var S=S||this.getUI2Scope();jQuery.sap.log.info("Abap Adapter --> Creating UI2 Factory with Scope - "+S);if(sap.ushell&&sap.ushell.Container){t.cache.ui2Factory=sap.ushell.Container.getService("PageBuilding",S).getFactory();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 Factory from cache");}return t.cache.ui2Factory;};this.getUI2PageBuildingService=function(){if(!(t.cache.ui2PageBuildeingService)){if(sap.ushell&&sap.ushell.Container){jQuery.sap.log.info("Abap Adapter --> Creating UI2 PageBuildingService");var a=this.getUI2Factory();t.cache.ui2PageBuildeingService=a.getPageBuildingService();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 PageBuildingService from cache");}return t.cache.ui2PageBuildeingService;};function y(e){var c=e.CHIPS;var a=[];var j={};var m={};var p={};var A=null;if(c&&c.length){for(var i=0,l=c.length;i<l;i++){j={};j.id=c[i].ID;j.isActive=1;j.catalogId=c[i].CATALOG_ID;j.evaluationId=c[i].EVALUATION_ID;j.tileType=c[i].TYPE;j.COUNTER=1;p[j.id]=j;m[c[i].CATALOG_ID]=m[c[i].CATALOG_ID]||{};m[c[i].CATALOG_ID][c[i].ID]=m[c[i].CATALOG_ID][c[i].ID]||false;}}t.chipObj.getObjByChip=p;t.chipObj.catalogObj=m;return m;};function z(a,e){var c=t.chipObj.catalogObj;var p=jQuery.Deferred();if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}var F=t.getUI2Factory();var P=t.getUI2PageBuildingService(F);var A=0;var E=false;function G(J){var K=[];var L={};var M={};var N=[];if(!E){K=(J.Chips&&J.Chips.results)?J.Chips.results:[];t.chipObj.CATALOGS.push(J);for(var i=0,l=K.length;i<l;i++){if(t.chipObj.getObjByChip[K[i].catalogPageChipInstanceId]){t.chipObj.catalogObj[J.id][K[i].catalogPageChipInstanceId]=true;L=t.chipObj.getObjByChip[K[i].catalogPageChipInstanceId]||{};L.catalogName=J.title;L.title=K[i].title;if(K[i].ChipBags&&K[i].ChipBags.results&&K[i].ChipBags.results.length){M=K[i].ChipBags.results[0];if(M.ChipProperties&&M.ChipProperties.results&&M.ChipProperties.results.length){N=M.ChipProperties.results;for(var j=0,m=N.length;j<m;j++){if(N[j].name=="title"){L.title=N[j].value;}if(N[j].name=="description"){L.description=N[j].value;}}}}L.url=K[i].url;L.configuration=K[i].configuration;t.chipObj.CHIPS.push(L);}}var O=t.chipObj.catalogObj[J.id];for(var Q in O){if(!(O[Q])){t.chipObj.affectedTiles=t.chipObj.affectedTiles||[];t.chipObj.affectedTiles.push(Q);var R=t.chipObj.getObjByChip[Q];R.catalogName="-NA-"+R.catalogId;R.configuration=JSON.stringify({});R.title=t.chipObj.EVALUATION.INDICATOR_TITLE;R.description=t.chipObj.EVALUATION.TITLE;R.isAffected=true;t.chipObj.CHIPS.push(R);}}if(A==0){if(!E){a(t.chipObj);}}else{A--;}}}function H(d,s,x){E=true;if(e){jQuery.sap.log.error("Catalog "+this.Catalog+" does not exist");e(d,s,x);}}A=(c)?Object.keys(c).length-1:0;for(var I in c){P.readCatalog(I,G,jQuery.proxy(H,{Catalog:I}),false,false);}if(!(Object.keys(c).length)){a(t.chipObj);}return p.promise();};this.readChipFromUI2ById=function(c,a,e,i){var U='X-SAP-UI2-PAGE';var j=U+":"+c+":"+a;var p=this.getUI2PageBuildingService();p.readChip(j,e,i);};this.readAllUI2Catalogs=function(a,e,c){var p=this.getUI2PageBuildingService();p.readCatalogs(a,e,c);};function B(a){var c={'NT':'X-SAP-UI2-CHIP:/SSB/NUMERIC_TILE','CT':'X-SAP-UI2-CHIP:/SSB/COMPARISON_TILE','TT':'X-SAP-UI2-CHIP:/SSB/TREND_TILE','AT':'X-SAP-UI2-CHIP:/SSB/DEVIATION_TILE','CM':'X-SAP-UI2-CHIP:/SSB/COMPARISON_MM_TILE','DT-CT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON','DT-CM':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON_MM','DT-AT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_DEVIATION','DT-TT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_TREND'};return c[a];}this.removeTile=function(p,c,a,e){jQuery.sap.log.info("Abap Adapter --> Calling Chip delete");if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}if(p.isAffected){m();return;}var F=t.getUI2Factory();var P=t.getUI2PageBuildingService(F);var j=new sap.ui2.srvc.Page(F,p.catalogId);function m(){jQuery.sap.log.info("Abap Adapter --> Chip Instance removed successfully");var i={ID:p.id,IS_ACTIVE:p.isActive};t.remove("CHIP",i,a,e);}function A(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while removing the Chip Instance");e(d,s,x);}function E(){jQuery.sap.log.info("Abap Adapter --> Chip Stub loaded successfully");oChip=oChipStub;oChip.remove(m,A);}function G(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Chip Stub");e(d,s,x);}function H(){jQuery.sap.log.info("Abap Adapter --> Page Stub loaded successfully");oPage=j;oChips=oPage.getChipInstances();for(var i=0,l=oChips.length;i<l;i++){if(oChips[i].getId()==p.id){oChipStub=oChips[i];}}oChipStub.remove(m,A);}function I(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Page Stub");e(d,s,x);}j.load(H,I);};function C(p,c,a,e){if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}var F=t.getUI2Factory();var P=t.getUI2PageBuildingService(F);var i=B(p.tileType);p.id=i;p.chipId=i;var j=new sap.ui2.srvc.Chip(p,F);var l=new sap.ui2.srvc.Page(F,p.catalogId);var m=null;var A=null;function E(d){var R={payload:{CHIP:{ID:p.ID,IS_ACTIVE:1,EVALUATION_ID:p.evaluationId,TYPE:p.tileType,CATALOG_ID:p.catalogId}}};t.create('CHIP',R,null,a,e);}function G(d){jQuery.sap.log.info("Abap Adapter --> Bag updated successfully for the Chip Instance");}function H(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing into the Bag of the Chip Instance");e(d,s,x);}function I(d){jQuery.sap.log.info("Abap Adapter --> Configuration updated successfully for the Chip Instance");E(d);}function J(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing Configuration to the Chip Instance");e(d,s,x);}function K(d){var U='X-SAP-UI2-PAGE';jQuery.sap.log.info("Abap Adapter --> Chip Instance created successfully");var R=d;var S=R.getId();p.ID=S;p.configuration=p.configuration.replace(/___CHIPINSTID______CHIPINSTID___/g,S);p.configuration=p.configuration.replace(/_____CHIPID__________CHIPID_____/g,U+":"+p.catalogId+":"+S);R.getApi().writeConfiguration.setParameterValues(p.configuration,I,J);R.setTitle(p.title);var T=R.getBag("sb_tileProperties");T.setText("title",p.title);T.setText("description",p.description);T.save(G,H);}function L(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error in creating a Chip Instance in the UI2 Catalog");e(d,s,x);}function M(){jQuery.sap.log.info("Abap Adapter --> Chip Stub loaded successfully");m=j;A.addChipInstance(m,K,L);}function N(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Chip Stub");e(d,s,x);}function O(){jQuery.sap.log.info("Abap Adapter --> Page Stub loaded successfully");A=l;j.load(M,N);}function Q(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Page Stub");e(d,s,x);}l.load(O,Q);};function D(p,c,a,e){if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}var F=t.getUI2Factory();var P=t.getUI2PageBuildingService(F);var j=B(p.tileType);var m=[];var A=new sap.ui2.srvc.Chip(p,F);var E=new sap.ui2.srvc.Page(F,p.catalogId);var G=null;var H=null;function I(d){var i={keys:{ID:p.ID,IS_ACTIVE:1},payload:{CHIP:{update:[{ID:p.ID,IS_ACTIVE:1,EVALUATION_ID:p.evaluationId,TYPE:p.tileType,CATALOG_ID:p.catalogId}]}}};c.metadataRef.update('CHIP',i,null,a,e);}function J(d){jQuery.sap.log.info("Abap Adapter --> Bag updated successfully for the Chip Instance");}function K(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing into the Bag of the Chip Instance");e(d,s,x);}function L(d){jQuery.sap.log.info("Abap Adapter --> Configuration updated successfully for the Chip Instance");I(d);}function M(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing Configuration to the Chip Instance");e(d,s,x);}function N(d){jQuery.sap.log.info("Abap Adapter --> Chip Instance created successfully");var i=d;p.ID=i.getId();i.getApi().writeConfiguration.setParameterValues(p.configuration,L,M);i.setTitle(p.title);var l=i.getBag("sb_tileProperties");l.setText("title",p.title);l.setText("description",p.description);l.save(J,K);}function O(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error in creating a Chip Instance in the UI2 Catalog");e(d,s,x);}function Q(){jQuery.sap.log.info("Abap Adapter --> Chip Stub loaded successfully");G=A;N(G);}function R(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Chip Stub");e(d,s,x);}function S(){jQuery.sap.log.info("Abap Adapter --> Page Stub loaded successfully");H=E;m=H.getChipInstances();for(var i=0,l=m.length;i<l;i++){if(m[i].getId()==p.id){A=m[i];}}A.load(Q,R);}function T(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Page Stub");e(d,s,x);}E.load(S,T);};this.publishChip=function(p,m,c,a,e){if(m=="create"){jQuery.sap.log.info("Abap Adapter --> Calling Chip create");C(p,c,a,e);}else{jQuery.sap.log.info("Abap Adapter --> Calling Chip update");D(p,c,a,e);}};this.isTokenHandlingEnabledForODataRead=function(){return true;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.abap.NavigationAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.NavigationAdapter");sap.suite.ui.smartbusiness.adapter.abap.NavigationAdapter=function(){var _={};function a(s,b,c){var d="/GetLinksForSemanticObject?semanticObject='"+s+"'";var e="";if(c&&Object.keys(c).length){for(var k in c){e+=k+"="+c[k]+"&";}}if(b&&b.length){for(var i=0;i<b.length;i++){e+=b[i]+"=1&";}}e=encodeURIComponent(e.replace(/&$/g,""));e="&businessParams='"+e+"'";return d+e;};this.getLinksBySemanticObject=function(p){var t=this;var s=null;var b=[];var d=new sap.ui.model.odata.ODataModel("/sap/opu/odata/UI2/INTEROP",true);p.businessParam=p.businessParam||{};p.businessParam["formFactor"]=sap.ui2.srvc.getFormFactor();for(var i=0,l=p.semanticObject.length;i<l;i++){s=a(p.semanticObject[i],p.dimensions,p.businessParam);request=d.createBatchOperation(s,"GET");b.push(request);}d.addBatchReadOperations(b);var c=d.submitBatch(function(e){var f=[];for(var i=0;i<e.__batchResponses.length;i++){if(e.__batchResponses[i].data&&e.__batchResponses[i].data.results&&e.__batchResponses[i].data.results.length){f=f.concat(e.__batchResponses[i].data.results);}}p.success.call(p.context||null,f);},function(){jQuery.sap.log.error("Error fetching getLinksBySemanticObject : "+p.semanticObject);p.success.call(p.context||null,[]);});return c;};this.getLinksByContext=function(p){var o=[];var t=this;if(!_[p.viewId]){_[p.viewId]=new jQuery.Deferred(function(d){var l=[];var s=[p.semanticObject],l=[];p.dimensions=p.dimensions||[];s=s.concat(p.dimensions);var c=t.getLinksBySemanticObject({async:true,semanticObject:s,dimensions:p.dimensions,success:function(b){l=l.concat(b);d.resolve(l);},error:function(){d.resolve(l);}});o.push(c);});}return _[p.viewId].promise();};this.reset=function(){_={};}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.abap.RuntimeServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.RuntimeServicesAdapter");sap.suite.ui.smartbusiness.adapter.abap.RuntimeServicesAdapter=function(){var t=this;this.cache=this.cache||{};function g(){t.cache.runtimeModel=t.cache.runtimeModel||new sap.ui.model.odata.ODataModel(t.getRuntimeServiceUrl(),true);return t.cache.runtimeModel;};this.getRuntimeServiceUrl=function(){jQuery.sap.log.info("Abap Adapter --> Runtime Service URI");return"/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV";};function _(u){return jQuery.sap.encodeURL(u);};this.getKPIById=function(o){jQuery.sap.log.info("Abap Adapter --> Calling KPI Data");var t=this;if(!(o.ID)&&!(o.context)){throw new Error("Failed to get Indicator Id for data fetch");return null;}var c=null;var b=o.context||null;var m=o.model||g();var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;}else{o.ID=c.split("'")[1].split("'")[0];}}else if(o.ID){o.entity=o.entity||"/INDICATORS";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;c=o.entity+"('"+o.ID+"')";b=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var f=[];var r=[];if(!(o.noIndicator)){if(b&&b.getObject()&&Object.keys(b.getObject())&&Object.keys(b)){d.INDICATOR=b.getObject();}else{f.push(m.createBatchOperation(c,"GET"));r.push("INDICATOR");}}if(o.tags){f.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){f.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}o.async=(o.async)?true:false;m.addBatchReadOperations(f);m.submitBatch(function(h,j){var A=h.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(h){if(e){e(h);}throw new Error("Failed to fetch Indicator details");},o.async);return d;};this.getEvaluationById=function(o){jQuery.sap.log.info("Abap Adapter --> Calling Evaluation Data");var t=this;if(!(o.ID)&&!(o.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var b=o.context||null;var m=o.model||g();var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;}else{o.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');}}else if(o.ID){o.entity=o.entity||"/EVALUATIONS";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;c=o.entity+"('"+o.ID+"')";b=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var f=[];var r=[];if(!(o.noEvaluation)){if(b&&b.getObject()&&Object.keys(b.getObject())&&Object.keys(b)){d.EVALUATION=b.getObject();}else{f.push(m.createBatchOperation(c,"GET"));r.push("EVALUATION");}}if(o.indicator){f.push(m.createBatchOperation(c+"/INDICATOR_PROPERTIES","GET"));r.push("INDICATOR_PROPERTIES");}if(o.tags){f.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){f.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}if(o.filters){f.push(m.createBatchOperation(c+"/FILTERS","GET"));r.push("FILTERS");}if(o.values){f.push(m.createBatchOperation(c+"/VALUES","GET"));r.push("VALUES");}o.async=(o.async)?true:false;m.addBatchReadOperations(f);m.submitBatch(function(h,j){var A=h.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(h){if(e){e(h);}throw new Error("Failed to fetch Evaluation details");},o.async);return d;};this.getUI2Scope=function(){if(!(t.cache.ui2Scope)){jQuery.sap.log.info("Abap Adapter --> Fetching UI2 Scope from URL");var s="PERS";t.cache.ui2Scope=s;}else{jQuery.sap.log.info("Abap Adapter --> Fetching UI2 Scope from cache");}jQuery.sap.log.info("Abap Adapter --> Current UI2 Scope - "+t.cache.ui2Scope);return t.cache.ui2Scope;};this.getUI2Factory=function(){if(!(t.cache.ui2Factory)){var s=s||this.getUI2Scope();jQuery.sap.log.info("Abap Adapter --> Creating UI2 Factory with Scope - "+s);if(sap.ushell&&sap.ushell.Container){t.cache.ui2Factory=sap.ushell.Container.getService("PageBuilding",s).getFactory();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 Factory from cache");}return t.cache.ui2Factory;};this.getUI2PageBuildingService=function(){if(!(t.cache.ui2PageBuildeingService)){if(sap.ushell&&sap.ushell.Container){jQuery.sap.log.info("Abap Adapter --> Creating UI2 PageBuildingService");var f=this.getUI2Factory();t.cache.ui2PageBuildeingService=f.getPageBuildingService();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 PageBuildingService from cache");}return t.cache.ui2PageBuildeingService;};this.getChipById=function(o){jQuery.sap.log.info("Abap Adapter --> Calling Chip Data");var e={};var c={};var t=this;if(!(o.id)&&!(o.context)){throw new Error("Failed to get Chip Id for data fetch");return null;}var b=null;var f=o.context||null;var h=o.model||g();var i={};if(o.context){b=o.context.sPath;if(o.context.getObject()){o.id=o.context.getObject().id;}else{o.id=b.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');}}else if(o.id){o.entity=o.entity||"/Chips";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;b=o.entity+"('"+o.id+"')";f=new sap.ui.model.Context(h,b);}o.entity=o.entity+"('"+o.id+"')";var k=o.success;var l=o.error;var p=t.getUI2PageBuildingService();var n=o.id;function r(d){if(d.ChipBags&&d.ChipBags.results&&d.ChipBags.results.length){var s=d.ChipBags.results[0];if(s.ChipProperties&&s.ChipProperties.results&&s.ChipProperties.results.length){tilePropertiesArr=s.ChipProperties.results;for(var j=0,m=tilePropertiesArr.length;j<m;j++){if(tilePropertiesArr[j].name=="title"){d.title=tilePropertiesArr[j].value;}if(tilePropertiesArr[j].name=="description"){d.description=tilePropertiesArr[j].value;}}}}k(d);}function q(d,s,x){l(d,s,x);}p.readChip(n,r,q);o.async=false;return i;};function a(b){var c={'NT':'X-SAP-UI2-CHIP:/SSB/NUMERIC_TILE','CT':'X-SAP-UI2-CHIP:/SSB/COMPARISON_TILE','TT':'X-SAP-UI2-CHIP:/SSB/TREND_TILE','AT':'X-SAP-UI2-CHIP:/SSB/DEVIATION_TILE','CM':'X-SAP-UI2-CHIP:/SSB/COMPARISON_MM_TILE','DT-CT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON','DT-CM':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON_MM','DT-AT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_DEVIATION','DT-TT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_TREND'};return c[b];}this.getDataByEntity=function(o){jQuery.sap.log.info("Abap Adapter --> Calling Entity Data");var t=this;var u=o.uri;var m=o.model||(u?new sap.ui.model.odata.ODataModel(u,true):g());var e="";var b=[];var f="";var c="";var h="";var j=null;var k=null;var n=null;var p=o.success;var q=o.error;if(!(o.entity)){jQuery.sap.log.error("Entity or Context is missing for getDataByEntity call");throw Error("Entity or Context is missing for getDataByEntity call");}jQuery.sap.log.info("Abap Adapter --> Calling Entity Data - "+o.entity);entity=o.entity;entity=(entity.indexOf("/")==0)?entity:("/"+entity);if(o.select){if(typeof(o.select)=="string"){c=o.select;}else{c=o.select;}}if(o.expand){if(o.expand instanceof Array){for(var i=0,l=o.expand.length;i<l;i++){e+=(e)?",":"";e+=o.expand[i];}b=o.expand;}else if(typeof(o.expand)=="string"){e=o.expand;b=o.expand.split(",");}}if(o.filter){if(typeof(o.filter)=="string"){f=o.filter;}else{f=o.filter;}}if(o.orderby){if(typeof(o.orderby)=="string"){h=o.orderby;}else{h=o.orderby;}}o.async=(o.async)?true:false;if(entity.indexOf("$select")==-1){if(c){entity+=(entity.indexOf("?")==-1)?("?$select="+c):("&$select="+c);}}if(entity.indexOf("$expand")==-1){if(e){entity+=(entity.indexOf("?")==-1)?("?$expand="+e):("&$expand="+e);}}if(entity.indexOf("$filter")==-1){if(f){entity+=(entity.indexOf("?")==-1)?("?$filter="+f):("&$filter="+f);}}if(entity.indexOf("$orderby")==-1){if(h){entity+=(entity.indexOf("?")==-1)?("?$orderby="+h):("&$orderby="+h);}}if(entity.indexOf("$top")==-1){if(Number(j)){entity+=(entity.indexOf("?")==-1)?("?$top="+Number(j)):("&$top="+Number(j));}}if(entity.indexOf("$skip")==-1){if(Number(k)){entity+=(entity.indexOf("?")==-1)?("?$skip="+Number(k)):("&$skip="+Number(k));}}var r=function(d,s,x){n=(d&&d.results)?d.results:d;if(p){p(n);}};var v=function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);if(q){n={d:d,s:s,x:x};q(d,s,x);}};m.read(entity,null,null,o.async,r,v);return n;};this.getDataByBatch=function(){jQuery.sap.log.info("Abap Adapter --> Calling Entity Batch Data");};this.getPlatform=function(){jQuery.sap.log.info("Abap Adapter --> Fetching Platform");t.cache.platform=t.cache.platform||"abap";jQuery.sap.log.info("Abap Adapter --> Platform - "+t.cache.platform);return t.cache.platform;};this.addSystemToServiceUrl=function(u){jQuery.sap.log.info("Abap Adapter --> Add System to Service Url");return u;};this.isTokenHandlingEnabledForODataRead=function(){return true;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.hana.CatalogServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.CatalogServicesAdapter");sap.suite.ui.smartbusiness.adapter.hana.CatalogServicesAdapter=function(){var g=function(e,E){if(E){return E.evaluationValues;}else{var v=[];e.VALUES["results"].forEach(function(j){delete j.__metadata;var o={};for(var c in j){if(j.hasOwnProperty(c)){o[c]=j[c];}}v.push(o);});return v;}};var _=function(f){var c=[];if(f&&f.length){f.forEach(function(e){var o={};o["NAME"]=e[0];o["OPERATOR"]=e[1];o["VALUE_1"]=e[2];o["VALUE_2"]=e[3];o["TYPE"]="FI";c.push(o);});}return c;};var a=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var c=sap.ushell.Container.getService("URLParsing");if(c){u=c.addSystemToServiceUrl(u,s);}}return u;};var p=function(c,s,C,f){var d="/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";d=a(d,s);var O=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(d);O.create("/CHIPS_USER",c,null,function(){C.call();},function(e){f.call(null,e);},false);};var b=function(c,s,C,f){var d="/sap/hba/r/sb/core/logic/__token.xsjs";d=a(d,s);jQuery.ajax({url:d,type:"HEAD",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(e,h,x){d="/sap/hba/r/sb/core/logic/addToCatalog.xsjs";d=a(d,s);var t=x.getResponseHeader("x-csrf-token");jQuery.ajax({url:d,type:"POST",async:false,data:encodeURIComponent(JSON.stringify(c)),dataType:"json",headers:{"x-csrf-token":t},success:function(e){C.call(null,e);},error:function(i){f.call(null,i);}});},error:function(e){f.call(null,e);}});};this.savePersonalizedTile=function(P){var r={},R,s,c,C;if(P.evaluationId&&P.tileType){var d=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:P.evaluationId,cache:true,filters:true,thresholds:true,useRuntimeService:true,sapSystem:P.sapSystem});if(d&&d.ID){var T=Date.now()+"";var M={};try{R=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");s=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();c=s["chipId"][0];C=R.getChipById({id:c,isActive:1});C=C.CHIP;}catch(e){return{status:"Failed",message:e.message};}M["tileType"]=C.tileType;M["url"]=C.url;M["description"]=P.title||d.TITLE;M["title"]=d.INDICATOR_TITLE;M["catalogId"]="HANA_CATALOG";M["configuration"]={};M["evaluationId"]=C.evaluationId;M["keywords"]=C.keywords;oChipConfiguration=JSON.parse(C.configuration);oChipConfiguration.isSufficient="1";oChipConfiguration.timestamp=T;oChipTileConfiguration=JSON.parse(oChipConfiguration.tileConfiguration);var t=JSON.parse(oChipTileConfiguration.TILE_PROPERTIES);t.id="_____CHIPID__________CHIPID_____";oChipTileConfiguration.TILE_PROPERTIES=JSON.stringify(t);oChipTileConfiguration.ADDITIONAL_FILTERS=JSON.stringify(_(P.additionalFilters));var E=g(d,P.evaluationValues);oChipTileConfiguration.EVALUATION_VALUES=JSON.stringify(E);M.configuration={tileConfiguration:JSON.stringify(oChipTileConfiguration)};var m=JSON.stringify(M.configuration);if(m.length>4096){oChipTileConfiguration.EVALUATION_FILTERS=JSON.stringify([]);M.configuration.isSufficient="0";M.configuration={tileConfiguration:JSON.stringify(oChipTileConfiguration)};m=JSON.stringify(M.configuration);if(m.length>4096){oChipTileConfiguration.EVALUATION_VALUES=JSON.stringify([]);}}M.configuration=m;b(M,P.sapSystem,function(f){r.status="Success",r.chipId=f.chipId,r.message="Tile Created Successfully";},function(f){r.status="Failed",r.message="Error Creating Tile";r.errorDescription=f;});}else{r.status="Failed",r.message="Invalid Evaluation Id : "+P.evaluationId;}}else{r.status="Failed",r.message="Mandatory Param evaluationId or TileType is Missing";}if(r.status=='Success'){P.success(r);}else{P.error(r);}return r;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.hana.DrilldownServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.DrilldownServicesAdapter");sap.suite=sap.suite||{};sap.suite.ui=sap.suite.ui||{};sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.adapter=sap.suite.ui.smartbusiness.adapter||{};sap.suite.ui.smartbusiness.adapter.hana=sap.suite.ui.smartbusiness.adapter.hana||{};sap.suite.ui.smartbusiness.adapter.hana.DrilldownServicesAdapter={fetchXSRFToken:function(S,e){jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters("/sap/hba/r/sb/core/logic/__token.xsjs"),headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){if(S)S(d,s,x);},error:function(){if(e)e(d,s,x);}});},constants:{"write":{fn:"getWritePayload"},"delete":{fn:"getDeletePayload"},"update":{fn:"getUpdatePayload"},"viewServiceUrl":"/sap/hba/r/sb/core/logic/ddaViewConfiguration_cud.xsjs","evalServiceUrl":"/sap/hba/r/sb/core/logic/ddaEvaluation_cud.xsjs"},doUpdate:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"PUT",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doWrite:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"POST",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doDelete:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"DELETE",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doServiceCall:function(c){var t=this;if(c.type=="POST"){this.doWrite(c);}else if(c.type=="PUT"){this.doUpdate(c);}else if(c.type="DELETE"){this.doDelete(c);}},saveEvalConfiguration:function(e,d,a,s,E){var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d),url:this.constants.evalServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},saveViewConfiguration:function(e,d,a,s,E){a=d.ID_EDITABLE?"write":a;var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d,true),url:this.constants.viewServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},getUpdatePayload:function(e,d,i){return{payload:this.getWritePayload(e,d,i),keys:this.getDeletePayload(e,d,i)};},getWritePayload:function(e,d,i){var c=d.SELECTED_VIEW,r;if(i){r={DDA_COLUMNS:this.getColumnsPayload(d,e,c),DDA_CHART:this.getChartPayload(d,e,c),DDA_MASTER_TEXT:this.getViewTextPayload(d,e,c)};if(d.ID_EDITABLE){r.DDA_MASTER=this.getNewViewPayload(d.ALL_VIEWS,e,c);}}else{r={DDA_FILTERS:this.getFilterPayload(d.CURRENT_FILTERS,e,c),DDA_HEADER:this.getHeaderPayload(d.HEADERS_VISIBLE,e,c),DDA_CONFIGURATION:this.getConfigurationPayload(d,e,c)};var v=this.getViewOrderPayload(d.ALL_VIEWS,e,c);if(v.length){r.DDA_MASTER=v;}}return r;},getDeletePayload:function(e,d,i){return{"EVALUATION_ID":e,"CONFIGURATION_ID":d.ID};},getViewTextPayload:function(d,e,c){var v=[];var a=d.CURRENT_LANGUAGE,b=d.TITLE;d=d.ADDITIONAL_LANGUAGE_TITLES||[];for(var i=0;i<d.length;i++){if(d[i].SAP_LANGUAGE_KEY==a)continue;v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":d[i].SAP_LANGUAGE_KEY,"TEXT":d[i].TEXT,"IS_ACTIVE":1});}v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":a,"TEXT":b,"IS_ACTIVE":1});return v;},getChartPayload:function(d,e,c){return[{"EVALUATION_ID":e,"CONFIGURATION_ID":c,"VALUE_TYPE":d.VALUE_TYPE,"AXIS_TYPE":d.AXIS_TYPE,"CHART_TYPE":d.CHART_TYPE,"DATA_LIMIT":d.DATA_LIMITATIONS?d.DATA_LIMIT:-1,"COLOR_SCHEME":d.COLOR_SCHEME,"IS_ACTIVE":1,"THRESHOLD_MEASURE":d.THRESHOLD_MEASURE}];},getColumnsPayload:function(d,e,c){var a=[];var b=d.COLOR_SCHEME;d=d.items||[];for(var i=0;i<d.length;i++){if(d[i].SELECTED)a.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"NAME":d[i].NAME,"TYPE":d[i].TYPE.toUpperCase(),"SORT_BY":d[i].SORT_BY,"VISIBILITY":d[i].VISIBILITY,"COLOR":(b=="MANUAL_NON_SEMANTIC"?d[i].COLOR1:b=="MANUAL_SEMANTIC"?d[i].COLOR2:"")||"","STACKING":d[i].STACKING,"AXIS":d[i].AXIS,"SORT_ORDER":d[i].SORT_ORDER,"COLUMNS_ORDER":i,"IS_ACTIVE":1});}return a;},getFilterPayload:function(d,e,c){var f=[];d=d||[];for(var i=0;i<d.length;i++){f.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"DIMENSION":d[i],"VISIBILITY":1,"IS_ACTIVE":1});}return f;},_getHeaderConfiguration:function(h){var d;switch(h.VISUALIZATION_TYPE){case"CM":d=[{name:h.MEASURE1,color:h.COLOR1},{name:h.MEASURE2,color:h.COLOR2}];(h.MEASURE3&&h.MEASURE3!="_none^")?d.push({name:h.MEASURE3,color:h.COLOR3}):"";d=JSON.stringify({MEASURES:JSON.stringify(d)});break;case"CT":d={order:h.SORT_ORDER[1]=="D"?"desc":"asc",by:h.SORT_ORDER[0],dimension_color:h.DIMENSION_COLOR};d=JSON.stringify({SORTING:JSON.stringify(d)});break;case"HT":d={IS_HARVEY_FRACTION_KPIMEASURE:h.IS_HARVEY_FRACTION_KPIMEASURE};if(h.IS_HARVEY_FRACTION_KPIMEASURE){d.HARVEY_TOTAL_MEASURE=h.HARVEY_TOTAL_MEASURE;}else{d.HARVEY_FILTERS=JSON.stringify(h.HARVEY_FILTERS);}d=JSON.stringify(d);break;}return d;},getHeaderPayload:function(d,e,c){var h=[];d=d||[];for(var i=0;i<d.length;i++){if(d[i])h.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"VISUALIZATION_TYPE":d[i].VISUALIZATION_TYPE,"VISIBILITY":1,"REFERENCE_EVALUATION_ID":d[i].REFERENCE_EVALUATION_ID,"VISUALIZATION_ORDER":i,"DIMENSION":d[i].DIMENSION,"IS_ACTIVE":1,"CONFIGURATION":this._getHeaderConfiguration(d[i])});}return h;},getConfigurationPayload:function(d,e,c){var a={"SAP_FILTER":{value:"",visibility:1},"SAP_AGGREGATE_VALUE":{value:"",visibility:(d.CONFIG.SAP_AGGREGATE_VALUE?1:0)},"SAP_HEADER":{value:"",visibility:1},"QUERY_SERVICE_URI":{value:d.QUERY_SERVICE_URI,visibility:1},"QUERY_ENTITY_SET":{value:d.QUERY_ENTITY_SET,visibility:1},};var b=[];for(var f in a){b.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"PROPERTY_TYPE":f,"PROPERTY_VALUE":a[f].value,"VISIBILITY":a[f].visibility,"IS_ACTIVE":1});}return b;},getNewViewPayload:function(d,e,c){return[{"CONFIGURATION_ID":c,"EVALUATION_ID":e,"CONFIG_ORDER":(d.length+1),"IS_ACTIVE":1}];},getViewOrderPayload:function(d,e,c){var a=[];d=d||[];for(var i=0;i<d.length;i++){a.push({"CONFIGURATION_ID":d[i].ID,"EVALUATION_ID":e,"CONFIG_ORDER":i,"IS_ACTIVE":1});}return a;}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.hana.ModelerServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.ModelerServicesAdapter");sap.suite.ui.smartbusiness.adapter.hana.ModelerServicesAdapter=function(){var t=this;this.cache=this.cache||{};function g(c){var a=[];for(var i=0,l=(c?c.length:0);i<l;i++){if(c[i].tileType!="HT"){a.push(c[i]);}}return a;}function b(e){var a={"INDICATORS":{"indicator":{"entity":"INDICATORS","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"INDICATORS_MODELER":{"indicator":{"entity":"INDICATORS_MODELER","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"EVALUATIONS":{"evaluation":{"entity":"EVALUATIONS","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"}},"EVALUATIONS_MODELER":{"evaluation":{"entity":"EVALUATIONS_MODELER","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"},"texts_for_chip":{"entity":"TEXTS_FOR_CHIP","type":"EVALUATION_TEXT"}},"CHIPS":{"texts":{"entity":"TEXTS","type":"CHIP_TEXT"},"evaluation":{"entity":"EVALUATION_INFO","type":"EVALUATION"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"}}};return a[e];};function f(e){return beans={"INDICATOR":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"}},"EVALUATION":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT","DECIMAL_PRECISION":"DECIMAL_PRECISION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT","DECIMAL_PRECISION":"DECIMAL_PRECISION"}},"CHIP":{"bean":{"id":"id","isActive":"isActive","evaluationId":"evaluationId","catalogId":"catalogId","tileType":"tileType","COUNTER":"COUNTER","createdBy":"createdBy","changedBy":"changedBy","createdOn":"createdOn","changedOn":"changedOn"},"reverseBean":{"id":"id","isActive":"isActive","evaluationId":"evaluationId","catalogId":"catalogId","tileType":"tileType","COUNTER":"COUNTER","createdBy":"createdBy","changedBy":"changedBy","createdOn":"createdOn","changedOn":"changedOn"}},"ASSOCIATION":{"bean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"},"reverseBean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"}},"TAG":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"}},"PROPERTY":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"}},"FILTER":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"}},"VALUE":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"}},"DDA_MASTER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"}},"DDA_HEADER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"}},"LANGUAGE":{"bean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"},"reverseBean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"}},"INDICATOR_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"EVALUATION_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"CHIP_TEXT":{"bean":{"id":"id","isActive":"isActive","language":"language","catalogId":"catalogId","title":"title","description":"description"},"reverseBean":{"id":"id","isActive":"isActive","language":"language","catalogId":"catalogId","title":"title","description":"description"}}};};this.formBean=function(d,e,a){var c={};var p=[];var s={};var v={};var w=false;if(a){c=beans[e].bean;}else{c=beans[e].reverseBean;}if(d instanceof Array){w=true;}else{d=[d];}for(var i=0,l=d.length;i<l;i++){s={};v=d[i];for(var x in c){if(c.hasOwnProperty(x)){if(v[x]!==undefined&&v[x]!==null){s[c[x]]=v[x];}}}p.push(s);}if(!w){p=p[0];}return p;};function h(){t.cache.designtimeModel=t.cache.designtimeModel||new sap.ui.model.odata.ODataModel(t.getDesigntimeServiceUrl(),true);return t.cache.designtimeModel;};function j(){t.cache.runtimeModel=t.cache.runtimeModel||new sap.ui.model.odata.ODataModel(t.getRuntimeServiceUrl(),true);return t.cache.runtimeModel;};function k(){return"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";};this.getDesigntimeServiceUrl=function(){jQuery.sap.log.info("Hana Adapter --> Designtime Service URI");return"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";};this.getRuntimeServiceUrl=function(){jQuery.sap.log.info("Hana Adapter --> Runtime Service URI");return"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";};function _(a){return jQuery.sap.encodeURL(a);};this.getSessionUser=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Session User");var c=null;var e=a.success;var i=a.error;var l=function(d){if(d instanceof Array){if(d&&d.length&&d[0]){c=d[0].LOGON_USER;}}else{c=d.LOGON_USER;}t.cache.sessionUser=c;jQuery.sap.log.info("Hana Adapter --> Current Session User - "+t.cache.sessionUser);if(e){e(c);}};var p=function(d,s,x){if(i){i(d,s,x);}};if(t.cache.sessionUser){c=t.cache.sessionUser;jQuery.sap.log.info("Hana Adapter --> Current Session User From Cache - "+t.cache.sessionUser);e(c);}else{this.getDataByEntity({entity:"SESSION_USER",async:(a.async||false),success:l,error:p,model:a.model});}return t.cache.sessionUser;};this.getSystemInfo=function(a){jQuery.sap.log.info("Hana Adapter --> Fetching System Info");var s=a.success;t.cache.env=1;jQuery.sap.log.info("Hana Adapter --> System Environment - "+((t.cache.env)?"SAP HANA":"Non-SAP"));s(1);return t.cache.env;};this.getAllLanguages=function(e){var l=undefined;var v=e.success;var w=e.error;var y=function(d){d=(d.results)?d.results:d;if(d.length){if(d.length==1){var S={LAISO:{},SPRAS:{}};S.LAISO[d[0]["LAISO"]]=d[0]["SPRAS"];S.SPRAS[d[0]["SPRAS"]]=d[0]["LAISO"];}else{S=d.reduce(function(p,c,i,a){S=S||{};S.LAISO=S.LAISO||{};S.SPRAS=S.SPRAS||{};if(i==1){S.LAISO[a[0]["LAISO"]]=a[0]["SPRAS"];S.SPRAS[a[0]["SPRAS"]]=a[0]["LAISO"];}S.LAISO[a[i]["LAISO"]]=a[i]["SPRAS"];S.SPRAS[a[i]["SPRAS"]]=a[i]["LAISO"];return S;});}var s=d;t.cache.SAP_LANGUAGES=S;t.cache.SAP_LANGUAGE_ARRAY=s;t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();l=S.LAISO[t.cache.localeIsoLanguage];t.cache.localLanguage=l;t.cache.localeSapLanguage=l;jQuery.sap.log.info("Hana Adapter --> Logon Language - "+t.cache.localeIsoLanguage+" - "+t.cache.localeSapLanguage);}if(v){v(S,s,l);}};var z=function(d,s,x){if(w){w(d,s,x);}};if(t.cache.SAP_LANGUAGE_ARRAY&&t.cache.SAP_LANGUAGES){t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();t.cache.localLanguage=t.cache.SAP_LANGUAGES.LAISO[t.cache.localeIsoLanguage];t.cache.localeSapLanguage=t.cache.localLanguage;jQuery.sap.log.info("Hana Adapter --> Picking All Languages from cache");jQuery.sap.log.info("Hana Adapter --> Logon Language - "+t.cache.localeIsoLanguage+" - "+t.cache.localeSapLanguage);if(v){v(t.cache.SAP_LANGUAGES,t.cache.SAP_LANGUAGE_ARRAY,t.cache.localLanguage);}}else{jQuery.sap.log.info("Hana Adapter --> Calling All Languages");this.getDataByEntity({entity:"LANGUAGE",async:(e.async||false),success:y,error:z,model:e.model});}};this.getKPIById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling KPI Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Indicator Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/INDICATORS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noIndicator)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.INDICATOR=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("INDICATOR");}}if(a.tags){x.push(v.createBatchOperation(c+"/TAGS","GET"));y.push("TAGS");}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.evaluations){x.push(v.createBatchOperation(c+"/EVALUATIONS","GET"));y.push("EVALUATIONS");}if(a.associations&&a.associationProperties){x.push(v.createBatchOperation("/ASSOCIATIONS_MODELER?$filter="+_("SOURCE_INDICATOR eq '"+a.ID+"' or TARGET_INDICATOR eq '"+a.ID+"'")+"&$expand=PROPERTIES","GET"));y.push("ASSOCIATIONS");}else if(a.associations){x.push(v.createBatchOperation(c+"/ASSOCIATION_SOURCE","GET"));x.push(v.createBatchOperation(c+"/ASSOCIATION_TARGET","GET"));y.push("ASSOCIATION_SOURCE");y.push("ASSOCIATION_TARGET");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(z){if(e){e(z);}throw new Error("Failed to fetch Indicator details");},a.async);if(a.associations&&a.associationProperties){for(var i=0,l=w.ASSOCIATIONS.length;i<l;i++){if(w.ASSOCIATIONS[i].PROPERTIES){if(w.ASSOCIATIONS[i].PROPERTIES.results&&w.ASSOCIATIONS[i].PROPERTIES.results.length){w.ASSOCIATIONS[i].PROPERTIES=w.ASSOCIATIONS[i].PROPERTIES.results;}else{w.ASSOCIATIONS[i].PROPERTIES=[];}}else{w.ASSOCIATIONS[i].PROPERTIES=[];}}}else{w.ASSOCIATIONS=[].concat(w.ASSOCIATION_SOURCE).concat(w.ASSOCIATION_TARGET);}return w;};this.getEvaluationById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Evaluation Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/EVALUATIONS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noEvaluation)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.EVALUATION=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("EVALUATION");}}if(a.tags){x.push(v.createBatchOperation(c+"/TAGS","GET"));y.push("TAGS");}if(a.indicator_tags){x.push(v.createBatchOperation(c+"/INDICATOR_TAGS","GET"));y.push("INDICATOR_TAGS");}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.texts_for_chip){x.push(v.createBatchOperation(c+"/TEXTS_FOR_CHIP","GET"));y.push("TEXTS_FOR_CHIP");}if(a.filters){x.push(v.createBatchOperation(c+"/FILTERS","GET"));y.push("FILTERS");}if(a.values){x.push(v.createBatchOperation(c+"/VALUES","GET"));y.push("VALUES");}if(a.chips){x.push(v.createBatchOperation(c+"/CHIPS","GET"));y.push("CHIPS");}if(a.dda_configurations){x.push(v.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));y.push("DDA_CONFIGURATIONS");}if(a.dda_header_tiles){x.push(v.createBatchOperation(c+"/DDA_HEADER_TILES","GET"));y.push("DDA_HEADER_TILES");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(w.CHIPS){w.CHIPS=g(w.CHIPS);}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Evaluation details");},a.async);return w;};this.getAssociationById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Association Data");var t=this;var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noAssociation)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.ASSOCIATION=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("ASSOCIATION");}}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.source){x.push(v.createBatchOperation(c+"/SOURCE_INDICATOR_INFO","GET"));y.push("SOURCE_INDICATOR_INFO");}if(a.target){x.push(v.createBatchOperation(c+"/TARGET_INDICATOR_INFO","GET"));y.push("TARGET_INDICATOR_INFO");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Association details");},a.async);return w;};this.getChipById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Chip Data");var t=this;if(!(a.id&&a.isActive!==null&&a.isActive!==undefined)&&!(a.context)){throw new Error("Failed to get Chip Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.id=a.context.getObject().id;a.isActive=a.context.getObject().isActive;}else{a.id=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.isActive=((c.indexOf("isActive=0")!=-1)||(c.indexOf("isActive=1")!=-1))?((c.indexOf("isActive=0")!=-1)?0:1):null;}}else if(a.id&&a.isActive!==null&&a.isActive!==undefined){a.entity=a.entity||"/CHIPS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(id='"+a.id+"',isActive="+a.isActive+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noChip)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.CHIP=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("CHIP");}}if(a.evaluation){x.push(v.createBatchOperation(c+"/EVALUATION_INFO","GET"));y.push("EVALUATION_INFO");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.dda_configurations){x.push(v.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));y.push("DDA_CONFIGURATIONS");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Chip details");},a.async);return w;};this.getChipByEvaluation=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Chips for Evaluation");a.async=false;a.chips=true;if(a.success){var s=a.success;s(this.getEvaluationById(a));return null;}else{return this.getEvaluationById(a);}};this.getDataByEntity=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Entity Data");var t=this;var c=a.uri;var e=a.model||(c?new sap.ui.model.odata.ODataModel(c,true):h());var p="";var v=[];var w="";var y="";var z="";var A=a.top||null;var B=a.skip||null;var C=null;var D=a.success;var E=a.error;if(!(a.entity)){jQuery.sap.log.error("Entity or Context is missing for getDataByEntity call");throw Error("Entity or Context is missing for getDataByEntity call");}jQuery.sap.log.info("Hana Adapter --> Calling Entity Data - "+a.entity);entity=a.entity;entity=(entity.indexOf("/")==0)?entity:("/"+entity);if(a.select){if(typeof(a.select)=="string"){y=a.select;}else{y=a.select;}}if(a.expand){if(a.expand instanceof Array){for(var i=0,l=a.expand.length;i<l;i++){p+=(p)?",":"";p+=a.expand[i];}v=a.expand;}else if(typeof(a.expand)=="string"){p=a.expand;v=a.expand.split(",");}}if(a.filter){if(typeof(a.filter)=="string"){w=a.filter;}else{w=a.filter;}}if(a.orderby){if(typeof(a.orderby)=="string"){z=a.orderby;}else{z=a.orderby;}}a.async=(a.async)?true:false;if(entity.indexOf("$select")==-1){if(y){entity+=(entity.indexOf("?")==-1)?("?$select="+y):("&$select="+y);}}if(entity.indexOf("$expand")==-1){if(p){entity+=(entity.indexOf("?")==-1)?("?$expand="+p):("&$expand="+p);}}if(entity.indexOf("$filter")==-1){if(w){entity+=(entity.indexOf("?")==-1)?("?$filter="+w):("&$filter="+w);}}if(entity.indexOf("$orderby")==-1){if(z){entity+=(entity.indexOf("?")==-1)?("?$orderby="+z):("&$orderby="+z);}}if(entity.indexOf("$top")==-1){if(Number(A)){entity+=(entity.indexOf("?")==-1)?("?$top="+Number(A)):("&$top="+Number(A));}}if(entity.indexOf("$skip")==-1){if(Number(B)){entity+=(entity.indexOf("?")==-1)?("?$skip="+Number(B)):("&$skip="+Number(B));}}var F=function(d,s,x){C=(d&&d.results)?d.results:d;if(D){D(C);}};var G=function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);if(E){C={d:d,s:s,x:x};E(d,s,x);}};e.read(entity,null,null,a.async,F,G);return C;};this.getDataByBatch=function(){jQuery.sap.log.info("Hana Adapter --> Calling Entity Batch Data");};this.populateRelevantEntitySet=function(c,e,p){jQuery.sap.log.info("Hana Adapter --> Calling for Relevant Entity Sets");var t=p;var v=e.ODATA_URL.substr(0,e.ODATA_URL.lastIndexOf("/"));v=v.replace(/\//g,'.').replace(".","");var w=e.ODATA_URL.substr(e.ODATA_URL.lastIndexOf("/")+1);w=w.split(".")[0];var y="/ODATA_FOR_ENTITY(P_PACKAGE='"+e.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+e.VIEW_NAME.split("/")[1]+"')/Results";var z="PACKAGE eq '"+v+"' and OBJECT eq '"+w+"'";var A=function(d){if(d&&d.length){var s=d[0].CDATA_STR;c.open();if(s){var x=s.split("\n");for(var i=0,l=x.length;i<l;i++){if(x[i].indexOf("//")!=-1){x[i]=x[i].substr(0,x[i].indexOf("//"));}}s=x.join("\n");while(s.indexOf("/*")!=-1){var C=s.indexOf("/*");var D=s.indexOf("*/");D=(D==-1)?s.length:(D+2);s=s.substr(0,C)+s.substr(D);}}var E=[];var M=new sap.ui.model.json.JSONModel();var a=s.split(e.VIEW_NAME.split("/")[0]+'::'+e.VIEW_NAME.split("/")[1]);if(a.length==1){a=s.split(e.VIEW_NAME.split("/")[0]+'/'+e.VIEW_NAME.split("/")[1]);}if(a.length==1){sap.m.MessageToast.show("OData Document not compatible");M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());c.setModel(M);return;}for(var i=1,l=a.length;i<l;i++){var F={};F.entityName=a[i].split('"')[2];E.push(F);}M.setData({entitySet:E});c.setModel(M);return;}};var B=function(d,s,x){};this.getDataByEntity({entity:y,filter:z,async:false,success:A,error:B,model:t.oDataModel});};this.getAllViews=function(a){jQuery.sap.log.info("Hana Adapter --> Calling for All Views");return this.getDataByEntity({entity:"HANA_VIEWS",async:(a.async||false),model:a.model});};this.getPlatform=function(){jQuery.sap.log.info("Hana Adapter --> Fetching Platform");t.cache.platform=t.cache.platform||"hana";jQuery.sap.log.info("Hana Adapter --> Platform - "+t.cache.platform);return t.cache.platform;};this.create=function(e,p,a,c,i,l,v){jQuery.sap.log.info("Hana Adapter --> Calling Create Service");var w=q(e);var t=this;l=l?true:false;n().done(function(d,s,x){jQuery.ajax({type:"POST",async:l,url:o(w,v),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},success:c,error:i});});};this.update=function(e,p,a,c,i,l,v,w,y){jQuery.sap.log.info("Hana Adapter --> Calling Update Service");var z=q(e);var t=this;w=w?true:false;n().done(function(d,s,x){jQuery.ajax({type:"PUT",async:w,url:o(z,y),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage(),"If-None-Match":(v||"")},success:c,error:i});});};this.remove=function(e,p,a,c,i,l,v,w){jQuery.sap.log.info("Hana Adapter --> Calling Delete Service");var y=q(e);var t=this;v=v?true:false;n().done(function(d,s,x){jQuery.ajax({type:"DELETE",async:v,url:o(y,w),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage(),"If-None-Match":(i||"")},success:a,error:c});});};function m(p){var x;if(p instanceof Array){x=[];for(var i=0,l=p.length;i<l;i++){obj=p[i];if(!(obj.keys)&&!(obj.payload)){x.push(obj);}else{obj.keys=obj.keys||{};obj.payload=obj.payload||{};x.push(jQuery.extend(true,obj.keys,obj.payload,{}));}}}else if(p instanceof Object){x={};obj=p;if(!(obj.keys)&&!(obj.payload)){x=obj;}else{obj.keys=obj.keys||{};obj.payload=obj.payload||{};x=jQuery.extend(true,obj.keys,obj.payload,{});}}else{x=p;}return x;};function n(){var a="/sap/hba/r/sb/core/logic/__token.xsjs";a=t.addSystemToServiceUrl(a);return jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:a,headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){},error:function(){}});};this.addSystemToServiceUrl=function(a,s){jQuery.sap.log.info("Hana Adapter --> Add System to Service Url");if(sap.ushell&&sap.ushell.Container){if(s){a=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(a,s);}else{a=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(a);}}return a;};this.getHanaSystem=function(){var a=hasher||window.hasher;var c=a.getHashAsArray();if(c&&c.length&&c[0]){var d=c[0].substr(c[0].indexOf("?")+1).split("&");for(var i=0,l=d.length;i<l;i++){if(d[i]&&(d[i].indexOf("sap-system")!=-1)){return d[i].split("=")[1];}}}return"";};function o(a,c){var d=a.split("?");if(d.length>2){throw new Error("Url not formed properly");}d[0]=t.addSystemToServiceUrl(d[0]);a=d[0];if(d.length==2){a+="?"+d[1];}if(c&&Object.keys(c)&&Object.keys(c).length){a=a+"?"+jQuery.param(c);}return a;};function q(e){var C={INDICATOR:"/sap/hba/r/sb/core/logic/indicators.xsjs",EVALUATION:"/sap/hba/r/sb/core/logic/evaluations.xsjs",CHIP:"/sap/hba/r/sb/core/logic/chips.xsjs",ACTIVATE_INDICATOR:"/sap/hba/r/sb/core/logic/activateIndicator.xsjs",ACTIVATE_EVALUATION:"/sap/hba/r/sb/core/logic/activateEvaluation.xsjs",INDICATOR_FAVOURITE:"/sap/hba/r/sb/core/logic/favouriteIndicator.xsjs",EVALUATION_FAVOURITE:"/sap/hba/r/sb/core/logic/favouriteEvaluation.xsjs",ASSOCIATION:"/sap/hba/r/sb/core/logic/associations_cud.xsjs",ACTIVATE_ASSOCIATION:"/sap/hba/r/sb/core/logic/activateAssociation.xsjs",ACTIVATE_CHIP:"/sap/hba/r/sb/core/logic/activateChip.xsjs",AUTHORIZATION:"/sap/hba/r/sb/core/logic/authorization.xsjs",COPY_DDA_CONFIGURATION:"/sap/hba/r/sb/core/logic/copyDrilldownConfiguration.xsjs",DUPLICATE_ENTITY:"/sap/hba/r/sb/core/logic/deepCopy.xsjs",CHIP_USER:"/sap/hba/r/sb/core/logic/addToCatalog.xsjs"};return C[e];};function r(p,c,s,e){t.create("CHIP",p,null,s,e);};function u(p,c,s,e){t.update("CHIP",p,null,s,e);};this.removeTile=function(p,c,s,e){this.remove("CHIP",{id:p.id,isActive:p.isActive},s,e);};this.publishChip=function(p,a,c,s,e){var d=true;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;var l=[];var v=[];if(c.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<c.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var w={};w.title=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;w.description=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;w.id=p.id;w.language=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;w.isActive=0;l.push(w);}}if(a=="create"){v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:l}});r(v,c,s,e);}else{if(c.currentContextState){v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:l}});r(v,c,s,e);}else{var x=[];for(var i=0;i<c.initialData.ADDITIONAL_LANGUAGE_ARRAY.length;i++){var y={};y.id=p.id;y.language=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].language;y.isActive=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].isActive;y.description=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].description;y.title=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].title;x.push(y);}var z=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:x,newPayload:l,objectType:"CHIP_TEXTS"});var A={remove:[],create:[]};if(z){if(z.deletes.length){for(var i=0;i<z.deletes.length;i++){A.remove.push(z.deletes[i]);}}if(z.updates.length){for(var i=0;i<z.updates.length;i++){A.create.push(z.updates[i]);}}}v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:{update:p},TEXTS:A}});u(v,c,s,e);}}};this.isTokenHandlingEnabledForODataRead=function(){return false;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.hana.NavigationAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.NavigationAdapter");sap.suite.ui.smartbusiness.adapter.hana.NavigationAdapter=function(){var _={};this.getLinksBySemanticObject=function(p){var d=new sap.ui.model.odata.ODataModel("/sap/hana/uis/odata/uis_nav_data.xsodata",true);var s="UIS_US_NAVIGATIONParameters(IN_TAG='"+p.semanticObject+"')/Results?$format=json";var c=d.read(s,null,null,true,function(a){p.success.call(p.context||null,a.results);},function(){jQuery.sap.log.error("Error fetching getLinksBySemanticObject : "+p.semanticObject);p.success.call(p.context||null,[]);},!!p.async);return c;};this.getLinksByContext=function(p){return this.getLinksBySemanticObject(p);};this.reset=function(){_={};};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.adapter.hana.RuntimeServicesAdapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.RuntimeServicesAdapter");sap.suite.ui.smartbusiness.adapter.hana.RuntimeServicesAdapter=function(){var t=this;this.cache=this.cache||{};function g(){t.cache.runtimeModel=t.cache.runtimeModel||new sap.ui.model.odata.ODataModel(t.getRuntimeServiceUrl(),true);return t.cache.runtimeModel;};this.getRuntimeServiceUrl=function(){jQuery.sap.log.info("Hana Adapter --> Runtime Service URI");return"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";};function _(u){return jQuery.sap.encodeURL(u);};this.getKPIById=function(o){jQuery.sap.log.info("Hana Adapter --> Calling KPI Data");var t=this;if(!(o.ID)&&!(o.context)){throw new Error("Failed to get Indicator Id for data fetch");return null;}var c=null;var a=o.context||null;var m=o.model||g();var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;}else{o.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');}}else if(o.ID){o.entity=o.entity||"/INDICATORS";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;c=o.entity+"('"+o.ID+"')";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noIndicator)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.INDICATOR=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("INDICATOR");}}if(o.tags){b.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){b.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,h){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Indicator details");},o.async);return d;};this.getEvaluationById=function(o){jQuery.sap.log.info("Hana Adapter --> Calling Evaluation Data");var t=this;if(!(o.ID)&&!(o.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var a=o.context||null;var m=o.model||g();var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;}else{o.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');}}else if(o.ID){o.entity=o.entity||"/EVALUATIONS";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;c=o.entity+"('"+o.ID+"')";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noEvaluation)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.EVALUATION=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("EVALUATION");}}if(o.indicator){b.push(m.createBatchOperation(c+"/INDICATOR_PROPERTIES","GET"));r.push("INDICATOR_PROPERTIES");}if(o.tags){b.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){b.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}if(o.filters){b.push(m.createBatchOperation(c+"/FILTERS","GET"));r.push("FILTERS");}if(o.values){b.push(m.createBatchOperation(c+"/VALUES","GET"));r.push("VALUES");}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,h){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Evaluation details");},o.async);return d;};this.getChipById=function(o){jQuery.sap.log.info("Hana Adapter --> Calling Chip Data");var t=this;if(!(o.id)&&!(o.context)){throw new Error("Failed to get Chip Id for data fetch");return null;}var c=null;var a=o.context||null;var m=o.model||g();var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.id=o.context.getObject().id;}else{o.id=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');}}else if(o.id){o.entity=o.entity||"/Chips";o.entity=(o.entity.indexOf("/")!=0)?("/"+o.entity):o.entity;c=o.entity+"('"+o.id+"')";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noChip)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.CHIP=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("CHIP");}}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,h){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Chip details");},o.async);return d;};this.getDataByEntity=function(o){jQuery.sap.log.info("Hana Adapter --> Calling Entity Data");var t=this;var u=o.uri;var m=o.model||(u?new sap.ui.model.odata.ODataModel(u,true):g());var e="";var a=[];var f="";var b="";var c="";var h=null;var j=null;var k=null;var n=o.success;var p=o.error;if(!(o.entity)){jQuery.sap.log.error("Entity or Context is missing for getDataByEntity call");throw Error("Entity or Context is missing for getDataByEntity call");}jQuery.sap.log.info("Hana Adapter --> Calling Entity Data - "+o.entity);entity=o.entity;entity=(entity.indexOf("/")==0)?entity:("/"+entity);if(o.select){if(typeof(o.select)=="string"){b=o.select;}else{b=o.select;}}if(o.expand){if(o.expand instanceof Array){for(var i=0,l=o.expand.length;i<l;i++){e+=(e)?",":"";e+=o.expand[i];}a=o.expand;}else if(typeof(o.expand)=="string"){e=o.expand;a=o.expand.split(",");}}if(o.filter){if(typeof(o.filter)=="string"){f=o.filter;}else{f=o.filter;}}if(o.orderby){if(typeof(o.orderby)=="string"){c=o.orderby;}else{c=o.orderby;}}o.async=(o.async)?true:false;if(entity.indexOf("$select")==-1){if(b){entity+=(entity.indexOf("?")==-1)?("?$select="+b):("&$select="+b);}}if(entity.indexOf("$expand")==-1){if(e){entity+=(entity.indexOf("?")==-1)?("?$expand="+e):("&$expand="+e);}}if(entity.indexOf("$filter")==-1){if(f){entity+=(entity.indexOf("?")==-1)?("?$filter="+f):("&$filter="+f);}}if(entity.indexOf("$orderby")==-1){if(c){entity+=(entity.indexOf("?")==-1)?("?$orderby="+c):("&$orderby="+c);}}if(entity.indexOf("$top")==-1){if(Number(h)){entity+=(entity.indexOf("?")==-1)?("?$top="+Number(h)):("&$top="+Number(h));}}if(entity.indexOf("$skip")==-1){if(Number(j)){entity+=(entity.indexOf("?")==-1)?("?$skip="+Number(j)):("&$skip="+Number(j));}}var q=function(d,s,x){k=(d&&d.results)?d.results:d;if(n){n(k);}};var r=function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);if(p){k={d:d,s:s,x:x};p(d,s,x);}};m.read(entity,null,null,o.async,q,r);return k;};this.getDataByBatch=function(){jQuery.sap.log.info("Hana Adapter --> Calling Entity Batch Data");};this.handlePersonalizedTileDelete=function(a,s,e){var m=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");m.remove("CHIP_USER",a,s,e);};this.getPlatform=function(){jQuery.sap.log.info("Hana Adapter --> Fetching Platform");t.cache.platform=t.cache.platform||"hana";jQuery.sap.log.info("Hana Adapter --> Platform - "+t.cache.platform);return t.cache.platform;};this.addSystemToServiceUrl=function(u,s){jQuery.sap.log.info("Hana Adapter --> Add System to Service Url");if(sap.ushell&&sap.ushell.Container){if(s){u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u,s);}else{u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u);}}return u;};this.getHanaSystem=function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";};this.isTokenHandlingEnabledForODataRead=function(){return false;};};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S3",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));v.setBindingContext(c);t.contextIndicatorId=v.getBindingContext().getProperty("ID")||e.getParameter("arguments").contextPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var m=new sap.ui.model.json.JSONModel();t.getView().byId("kpiAssociationTable").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("SOURCE_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("TARGET_INDICATOR",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId)],false));t.getView().byId("tags").getBinding("items").filter(new sap.ui.model.Filter([new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.EQ,t.contextIndicatorId),new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1),new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"IN")],true));}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"ADD_ASSOCIATION",onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"manageSBKPIAssociation",route:"associationCreate",context:t.getView().getBindingContext().sPath.substring(1)});}}};t.byId("idDirection").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},formatAssociationCount:function(s,t){var a=this;if(s==null&&t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"(0)";}if(s==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+t+")";}if(t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+s+")";}var c=(parseInt(s)+parseInt(t));return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+c.toString()+")";},formatStatus:function(s){return((s)?this.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"):this.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"));},formatGoalType:function(g){var a=null;switch(g){case'MA':a=this.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=this.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=this.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=this.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t));},formatStatusOfAssociation:function(i,c){var t=this;if(c=="2"){var s=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT");return s;}if(i==0){return t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW");}if(i==1){return t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE");}},formatProperties:function(n,v){var p=((this.getView().byId("assoProperties").getItems().length>1)?(", "+n+" : "+v):(n+" : "+v+","));return p;},formatAssociationType:function(a){if(a=="SUPPORTING"){return this.oApplicationFacade.getResourceBundle().getText("SUPPORTING");}else{return this.oApplicationFacade.getResourceBundle().getText("CONFLICTING");}},formatArrowDirection:function(s){return((s==this.contextIndicatorId)?("sap-icon://arrow-right"):("sap-icon://arrow-left"));},formatTargetIndicatorText:function(s,t,a,b){var i=null;if(t==this.contextIndicatorId){i=a;}else{i=b;}return i;},handleAssociationEdit:function(e){var t=this;var a;if(e.getSource().getBindingContext().getObject().COUNTER=="1"){a=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS");}else{a=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS").replace("IS_ACTIVE=1","IS_ACTIVE=0")}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"manageSBKPIAssociation",route:"associationEdit",context:(t.getView().getBindingContext().sPath.substring(1).replace("INDICATORS_MODELER","INDICATORS")+"/"+a)});},handleAssociationDelete:function(e){var t=this;t.entity=e.getSource().getBindingContext().sPath.substring(1).replace("ASSOCIATIONS_MODELER","ASSOCIATIONS");t.entityObj=t.formOldObjectForAssociation(t.entity);var c=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("DELETE"),type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DELETE_ASSOCIATION")})],beginButton:new sap.m.Button({text:"Ok",press:function(E){c.close();var O=t.oApplicationFacade.getODataModel();t.metadataRef.remove("ASSOCIATION",t.entityObj,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));O.refresh();},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"));});}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close();}})});c.open();},formOldObjectForAssociation:function(s){var t=this;var o={};o.TYPE=s.substring(s.indexOf("'",s.search("TYPE"))+1,s.indexOf("'",s.indexOf("'",s.search("TYPE"))+1));o.SOURCE_INDICATOR=s.substring(s.indexOf("'",s.search("SOURCE_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=s.substring(s.indexOf("'",s.search("TARGET_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(s.substring(s.indexOf("=",s.search("IS_ACTIVE"))+1,s.indexOf("=",s.search("IS_ACTIVE"))+2));return o;},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S4.controller');
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/association/view/nameValueTable.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S4",{onInit:function(){var t=this;var v=this.getView();this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.errorMessages=[];this.errorState=false;var o=function(d){if(t.initialAssociationType){t.byId("associationTypeSelect").setSelectedKey(t.initialAssociationType);t.byId("associationTypeSelect").setTooltip(t.byId("associationTypeSelect").getSelectedItem().getText());}else{var b=d.getParameters().data&&d.getParameters().data.results&&d.getParameters().data.results[0]&&d.getParameters().data.results[0].TITLE;t.byId("associationTypeSelect").setTooltip(b);}};this.byId("associationTypeSelect").getBinding("items").attachDataReceived(o);this.oRouter.attachRouteMatched(function(e){t.viewMode=e.getParameter("name");t.directionChange=0;t.getView().byId("associationPropertyValue").setValueState("None");t.getView().byId("associationPropertyName").setValueState("None");if(e.getParameter("name")==="associationEdit"){var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.associationContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").associationPath));v.sourceIndicatorContexts={contextPath:e.getParameter("arguments").contextPath,context:c};v.associationContexts={contextPath:e.getParameter("arguments").associationPath,context:t.associationContext};v.setBindingContext(t.associationContext);t.modelForSelectAssociation=new sap.ui.model.json.JSONModel();t.byId("associationTypeSelect").setModel(t.modelForSelectAssociation,"associationSelectModel");t.sourceIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("sourceIndicatorContent").setModel(t.sourceIndicatorModel,"sourceIndicator");t.targetIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("targetIndicatorContent").setModel(t.targetIndicatorModel,"targetIndicator");t.associationPropertiesModel=new sap.ui.model.json.JSONModel();t.byId("propertyNameValueBox").setModel(t.associationPropertiesModel,"associationProp");var b=function(d){var i=d.ASSOCIATION;var s=d.SOURCE_INDICATOR_INFO;var j=d.TARGET_INDICATOR_INFO;var p=d.PROPERTIES;t.byId("associationTypeSelect").setSelectedKey(i.TYPE);if(t.byId("associationTypeSelect").getSelectedItem()){t.byId("associationTypeSelect").setTooltip(t.byId("associationTypeSelect").getSelectedItem().getText());}t.associationData=i;t.initialAssociationType=i.TYPE;t.contextIndicatorId=d.SOURCE_INDICATOR_INFO.ID;t.sourceIndicatorModel.setData({INDICATOR:s});if(s&&s.length){t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(s[0].TITLE||""));t.initialSourceIndicatorId=s[0].ID;}else{t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(s.TITLE||""));t.initialSourceIndicatorId=s.ID;}t.targetIndicatorModel.setData({INDICATOR:j});if(j&&j.length){t.byId("selectedKpiOpiId").setValue(j[0].TITLE);t.initialTargetIndicatorId=j[0].ID;}else{t.byId("selectedKpiOpiId").setValue(j.TITLE);t.initialTargetIndicatorId=j.ID;}t.associationPropertiesModel.setData({PROPERTIES:p});t.oldPropertiesList=$.extend(true,{},t.getView().byId('propertyNameValueBox').getModel("associationProp"));};var f=function(){};t.metadataRef.getAssociationById({context:v.associationContexts.context,async:false,source:true,target:true,properties:true,success:b,error:f,model:t.oApplicationFacade.getODataModel()});}else if(e.getParameter("name")==="associationCreate"){t.sourceIndicatorModel=new sap.ui.model.json.JSONModel();t.byId("sourceIndicatorContent").setModel(t.sourceIndicatorModel,"sourceIndicator");t.associationData={};t.targetIndicatorModel=new sap.ui.model.json.JSONModel();t.targetIndicatorModel.setData({INDICATOR:[]});t.byId("targetIndicatorContent").setModel(t.targetIndicatorModel,"targetIndicator");t.associationPropertiesModel=new sap.ui.model.json.JSONModel();t.byId("propertyNameValueBox").setModel(t.associationPropertiesModel,"associationProp");t.associationPropertiesModel.setData({PROPERTIES:[]});t.oldPropertiesList=$.extend(true,{},t.associationPropertiesModel);this.byId("selectedKpiOpiId").setEditable(true);var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.associationContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").associationPath));v.sourceIndicatorContexts={contextPath:e.getParameter("arguments").contextPath,context:c};v.associationContexts={contextPath:e.getParameter("arguments").associationPath,context:t.associationContext};v.setBindingContext(c);t.byId("selectedKpiOpiId").setValue("");var g=function(d){var s=d.INDICATOR;t.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(s.TITLE||""));t.sourceIndicatorModel.setData({INDICATOR:s});t.contextIndicatorId=s.ID;};var h=function(d,s,x){};if(c.getObject()){t.contextIndicatorId=v.getBindingContext().getProperty("ID");this.byId("sourceIndicatorText").setText(t.oApplicationFacade.getResourceBundle().getText("CURRENT_KPI_OPI")+": "+(v.getBindingContext().getProperty("TITLE")||""));t.sourceIndicatorModel.setData({INDICATOR:t.oApplicationFacade.getODataModel().oData[e.getParameter("arguments").contextPath]});}else{t.metadataRef.getKPIById({context:v.sourceIndicatorContexts.context,async:false,success:g,error:h,model:t.oApplicationFacade.getODataModel()});}if(this.byId("associationTypeSelect").getSelectedItem()){this.byId("associationTypeSelect").setSelectedKey(this.byId("associationTypeSelect").getItems()[0].getKey());this.byId("associationTypeSelect").setTooltip(this.byId("associationTypeSelect").getSelectedItem().getText());}}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleOnBack();},oEditBtn:{sId:"SAVE",sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0);}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleCancel(e);}}]};this.oErrorOptions={onBack:function(){t.handleOnBack();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){t.utilsRef.handleMessagePopover(e,t);}},buttonList:[{sId:"SAVE",sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0);}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleCancel(e);}}]};var a=t.oApplicationFacade.getResourceBundle().getText("DELETE")+" "+t.oApplicationFacade.getResourceBundle().getText("DRAFT");this.oHeaderFooterOptionsForDraft={bSuppressBookmarkButton:{},onBack:function(){t.handleOnBackForDraft();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0);}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleCancelForDraft(e);}},{sI18nBtnTxt:a,onBtnPressed:function(e){t.handleDeleteForDraft(e,a);}}]};t.byId("directionArrowAssociation").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));this.oErrorOptionsForDraft={bSuppressBookmarkButton:{},onBack:function(){t.handleOnBackForDraft();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){t.utilsRef.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){v.getController().saveAndExit(0);}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(e){v.getController().saveAndExit(1);v.getController().activateAssociation();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){v.getController().saveAndCreateNew();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleCancelForDraft(e);}},{sI18nBtnTxt:a,onBtnPressed:function(e){t.handleDeleteForDraft(e,a);}}]};},setFooterOnError:function(){var t=this;if(t.errorMessages.length>1){switch(t.viewMode){case"associationCreate":t.setHeaderFooterOptions(t.oErrorOptions);break;case"associationEdit":t.setHeaderFooterOptions(t.oErrorOptionsForDraft);break;}}else{switch(t.viewMode){case"associationCreate":t.setHeaderFooterOptions(t.oHeaderFooterOptions);break;case"associationEdit":t.setHeaderFooterOptions(t.oHeaderFooterOptionsForDraft);break;}}},handleOnBack:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});if(t.anythingChangedOnBack()==true){b.open();}else{if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}},handleOnBackForDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});if(t.anythingChangedOnBack()==true){b.open();}else{if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}},handleCancel:function(e){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.cancel();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});if(t.anythingChangedOnBack()==true){b.open();}else{if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}},handleCancelForDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){view.getController().cancel();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();},handleDeleteForDraft:function(e,d){var t=this;var c=new sap.m.Dialog({title:d,type:"Message",beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){t.errorMessages=[];t.errorState=false;c.close();t.deleteDraft();if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close();}})});c.open();},formOldAssociationObject:function(s){var t=this;var o={};o.TYPE=s.substring(s.indexOf("'",s.search("TYPE"))+1,s.indexOf("'",s.indexOf("'",s.search("TYPE"))+1));o.SOURCE_INDICATOR=s.substring(s.indexOf("'",s.search("SOURCE_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=s.substring(s.indexOf("'",s.search("TARGET_INDICATOR"))+1,s.indexOf("'",s.indexOf("'",s.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(s.substring(s.indexOf("=",s.search("IS_ACTIVE"))+1,s.indexOf("=",s.search("IS_ACTIVE"))+2));return o;},anythingChangedOnBack:function(){var t=this;var p=(t.viewMode!="associationCreate")?t.associationContext.sPath:null;var o=p?t.formOldAssociationObject(p):{TARGET_INDICATOR:"",SOURCE_INDICATOR:"",TYPE:this.byId("associationTypeSelect").getItems()[0].getKey(),IS_ACTIVE:0};var n=t.getView().byId('propertyNameValueBox').getModel("associationProp").getData().PROPERTIES;var a=t.oldPropertiesList?t.oldPropertiesList.getData().PROPERTIES:[];var u=t.utilsRef.dirtyBitCheck({oldPayload:a,newPayload:n,objectType:"ASSOCIATION_PROPERTIES"});if(o.TARGET_INDICATOR!=(t.targetIndicatorModel.getData().INDICATOR.ID||"")||t.directionChange==1||o.TYPE!=t.byId("associationTypeSelect").getSelectedItem().getKey()||u.updates.length>0||u.deletes.length>0){return true;}else{return false;}},deleteDraft:function(){var t=this;var p=t.associationContext.sPath;var d=t.formOldAssociationObject(p);t.metadataRef.remove("ASSOCIATION",d,function(a){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));},function(e){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED")});t.utilsRef.setErrorState(t);});},changeValueState:function(){var t=this;t.getView().byId("associationPropertyValue").setValueState("None");t.getView().byId("associationPropertyName").setValueState("None");},getHeaderFooterOptions:function(){var t=this;var p=t.associationContext.sPath;var I=parseInt(p.charAt(p.indexOf("=",p.search("IS_ACTIVE"))+1));if(t.viewMode=="associationEdit"){if(I==1){return this.oHeaderFooterOptions;}else{return this.oHeaderFooterOptionsForDraft;}}else if(t.viewMode=="associationCreate"){return this.oHeaderFooterOptions;}},handleAssociationTypeChange:function(e){var t=this;var m=this.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){if(m.getData().PROPERTIES[i].TYPE=="SUPPORTING"){m.getData().PROPERTIES[i].TYPE="CONFLICTING";}else{m.getData().PROPERTIES[i].TYPE="SUPPORTING";}}m.updateBindings();e.getSource().setTooltip(e.getParameters().selectedItem.getText());},handleReverseAssociationDirection:function(){var t=this;if(t.directionChange==0){t.directionChange=1;}else{t.directionChange=0;}var i,a;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var b=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;if(b.length==0){this.getView().byId("selectedKpiOpiId").setValueState("Error");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED")});t.utilsRef.setErrorState(t);}else{this.byId("sourceIndicatorContent").getModel("sourceIndicator").setData({INDICATOR:b});this.byId("targetIndicatorContent").getModel("targetIndicator").setData({INDICATOR:s});var m=this.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){a=null;a=m.getData().PROPERTIES[i].SOURCE_INDICATOR;m.getData().PROPERTIES[i].SOURCE_INDICATOR=m.getData().PROPERTIES[i].TARGET_INDICATOR;m.getData().PROPERTIES[i].TARGET_INDICATOR=a;}m.updateBindings();}},listAllKpis:function(){var t=this;t.hanaViewValueHelpDialog=t.hanaViewValueHelpDialog||new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_VIEW"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{parts:[{path:'ASSOCIATION_SOURCE_COUNT'},{path:'ASSOCIATION_TARGET_COUNT'}], formatter:'.formatAssociationCount'}",firstStatus:new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS"),}),attributes:[new sap.m.ObjectAttribute({text:"{ID}"})]}),},confirm:function(e){var i;if(t.viewMode==="associationEdit"){}else if(t.viewMode==="associationCreate"){if(t.getView().byId("selectedKpiOpiId").getValueState()==="Error"){t.getView().byId("selectedKpiOpiId").setValueState("None");}}t.byId("selectedKpiOpiId").setValue(e.getParameter("selectedItem").getBindingContext().getProperty("TITLE"));t.targetIndicatorModel.setData({INDICATOR:e.getParameter("selectedItem").getBindingContext().getObject()});t.targetIndicatorModel.updateBindings();var m=t.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];for(i=0;i<m.getData().PROPERTIES.length;i++){m.getData().PROPERTIES[i].TARGET_INDICATOR=e.getParameter("selectedItem").getBindingContext().getProperty("ID");}m.updateBindings();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.NE,t.contextIndicatorId);var b=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var B=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a,b],true);B.filter(new sap.ui.model.Filter([c,d],true));}});t.hanaViewValueHelpDialog.setModel(t.oApplicationFacade.getODataModel());var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));f.push(new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.NE,t.contextIndicatorId));t.hanaViewValueHelpDialog.getBinding("items").filter(new sap.ui.model.Filter(f,true));t.hanaViewValueHelpDialog.open();},addNewProperty:function(){var t=this;var p=0;if(this.getView().byId("associationPropertyName").getValue()&&this.getView().byId("associationPropertyValue").getValue()){if(this.viewMode=="associationEdit"){this.isActiveValue=0;}else if(this.viewMode=="associationCreate"){var a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;if(a.length==0){this.getView().byId("selectedKpiOpiId").setValueState("Error");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("TARGET_KPI_NOT_SELECTED")});t.utilsRef.setErrorState(t);return;}this.isActiveValue=0;}this.getView().byId("associationPropertyName").setValueState("None");if(this.getView().byId("associationPropertyValue").getValue()){this.getView().byId("associationPropertyValue").setValueState("None");var b=this.getView().byId('propertyNameValueBox').getModel("associationProp");b.getData().PROPERTIES=b.getData().PROPERTIES||[];for(var i=0;i<b.getData().PROPERTIES.length;i++){if(b.getData().PROPERTIES[i].NAME==this.getView().byId("associationPropertyName").getValue()&&b.getData().PROPERTIES[i].VALUE==this.getView().byId("associationPropertyValue").getValue()){p=1;}}if(p==0){b.getData().PROPERTIES.push({NAME:this.getView().byId("associationPropertyName").getValue(),VALUE:this.getView().byId("associationPropertyValue").getValue(),TYPE:this.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:(this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.ID||this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0].ID),TARGET_INDICATOR:(this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.ID||this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0].ID),IS_ACTIVE:this.isActiveValue});b.updateBindings();this.getView().byId("associationPropertyName").setValue("");this.getView().byId("associationPropertyValue").setValue("");}else{this.getView().byId("associationPropertyValue").setValueState("Error");this.getView().byId("associationPropertyName").setValueState("Error");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE")});t.utilsRef.setErrorState(t);}}else{this.getView().byId("associationPropertyValue").setValueState("Error");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE")});t.utilsRef.setErrorState(t);}}else{if(!this.getView().byId("associationPropertyName").getValue()){this.getView().byId("associationPropertyName").setValueState("Error");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME")});t.utilsRef.setErrorState(t);}else{this.getView().byId("associationPropertyValue").setValueState("Error");this.getView().byId("associationPropertyName").setValueState("None");t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ENTER_THE_PROPERTY_VALUE"));this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ENTER_THE_PROPERTY_VALUE")});t.utilsRef.setErrorState(t);}}},removeProperty:function(e){var t=this;var p=e.getSource().getBindingContext("associationProp").getPath();e.getSource().getBindingContext("associationProp").getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("associationProp").getModel().updateBindings();},saveAndExit:function(i){var t=this;t.errorMessages=[];this.saveAssociation(i);if(i==0){if(this.viewMode=="associationEdit"&&t.errorState==false){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(this.viewMode=="associationCreate"&&t.errorState==false){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}}},activateAssociation:function(){var t=this;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;t.ODataModel=t.oApplicationFacade.getODataModel();t.metadataRef.create("ACTIVATE_ASSOCIATION",t.payload,null,function(){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVATED"));t.oApplicationFacade.getODataModel().refresh();if(t.viewMode=="associationEdit"&&t.errorState==false){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"&&t.errorState==false){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}},function(e){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_ACTIVATION_FAILED"),e.responseText);this.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_ACTIVATION_FAILED"),"description":e.responseText});t.utilsRef.setErrorState(t);});t.setFooterOnError();},saveAndCreateNew:function(){var t=this;t.errorMessages=[];this.saveAssociation();t.byId("selectedKpiOpiId").setValue("");t.targetIndicatorModel.setData({});t.targetIndicatorModel.updateBindings();var m=t.getView().byId('propertyNameValueBox').getModel("associationProp");m.getData().PROPERTIES=m.getData().PROPERTIES||[];m.getData().PROPERTIES=[];m.updateBindings();t.setFooterOnError();},cancel:function(){var t=this;if(t.viewMode=="associationEdit"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath.replace("INDICATORS","INDICATORS_MODELER")});}else if(t.viewMode=="associationCreate"){t.utilsRef.replaceHash({action:"manageSBKPIAssociation",route:"detail",context:t.getView().sourceIndicatorContexts.contextPath});}},formOldObjectForAssociation:function(s,t){var a=this;var b=a.sourceIndicatorModel.getData().INDICATOR.length?a.sourceIndicatorModel.getData().INDICATOR[0]:a.sourceIndicatorModel.getData().INDICATOR;var o={TYPE:this.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:b.CREATED_BY,CREATED_ON:b.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};var c=a.associationContext.sPath;o.TYPE=c.substring(c.indexOf("'",c.search("TYPE"))+1,c.indexOf("'",c.indexOf("'",c.search("TYPE"))+1));o.SOURCE_INDICATOR=c.substring(c.indexOf("'",c.search("SOURCE_INDICATOR"))+1,c.indexOf("'",c.indexOf("'",c.search("SOURCE_INDICATOR"))+1));o.TARGET_INDICATOR=c.substring(c.indexOf("'",c.search("TARGET_INDICATOR"))+1,c.indexOf("'",c.indexOf("'",c.search("TARGET_INDICATOR"))+1));o.IS_ACTIVE=parseInt(c.substring(c.indexOf("=",c.search("IS_ACTIVE"))+1,c.indexOf("=",c.search("IS_ACTIVE"))+2));return o;},performBatchOperation:function(b){var t=this;t.oDataModel=t.oApplicationFacade.getODataModel();t.oDataModel.addBatchChangeOperations(b);t.oDataModel.submitBatch(function(d,r,e){if(e.length){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED")});t.utilsRef.setErrorState(t);}var a=false;var c=d.__batchResponses[0].__changeResponses;for(var k in c)if(c[k].statusCode!="201"&&c[k].statusCode!="204"&&c[k].statusCode!="200")a=true;if(a){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED")});t.utilsRef.setErrorState(t);}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));}},function(e){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED")});t.utilsRef.setErrorState(t);},false);},savePropertiesHelper:function(a,u,s,t,b){var c=this;c.batchArray=[];var p;var d=[];c.oDataModel=c.oApplicationFacade.getODataModel();for(var i=0;i<a.PROPERTIES.length;i++){p={};p.IS_ACTIVE=0;p.TYPE=a.PROPERTIES[i].TYPE;p.NAME=a.PROPERTIES[i].NAME;p.VALUE=a.PROPERTIES[i].VALUE;p.SOURCE_INDICATOR=a.PROPERTIES[i].SOURCE_INDICATOR;p.TARGET_INDICATOR=a.PROPERTIES[i].TARGET_INDICATOR;d.push(p);}if((c.viewMode==="associationEdit"&&!(c.associationData.IS_ACTIVE))||(c.viewMode==="associationEdit"&&c.associationData.IS_ACTIVE&&b)){var f={};f.DELETE={};f.CREATE={};var c=this;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var t=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;c.ODataModel=c.oApplicationFacade.getODataModel();c.payload={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID};if(u.updates.length!=0){var e=c.associationContext.sPath;c.batchArray.push(c.oDataModel.createBatchOperation(e,"DELETE"));c.batchArray.push(c.oDataModel.createBatchOperation("/ASSOCIATIONS","POST",u.updates[0]));}var o=c.oldPropertiesList.getData().PROPERTIES;var g=c.utilsRef.dirtyBitCheck({oldPayload:o,newPayload:d,objectType:"ASSOCIATION_PROPERTIES"});if(u.updates.length!=0){f.DELETE={"TYPE":u.deletes[0].TYPE,"SOURCE_INDICATOR":u.deletes[0].SOURCE_INDICATOR,"TARGET_INDICATOR":u.deletes[0].TARGET_INDICATOR,"IS_ACTIVE":u.deletes[0].IS_ACTIVE,"PROPERTY":o};f.CREATE={"TYPE":u.updates[0].TYPE,"SOURCE_INDICATOR":u.updates[0].SOURCE_INDICATOR,"TARGET_INDICATOR":u.updates[0].TARGET_INDICATOR,"IS_ACTIVE":u.updates[0].IS_ACTIVE,"PROPERTY":d};c.metadataRef.update("ASSOCIATION",f,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh();},function(k){c.utilsRef.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText);c.errorMessages.push({"type":"Error","title":c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),"description":k.responseText});c.utilsRef.setErrorState(c);});}else{if(g.deletes.length>0){f.TYPE=g.deletes[0].TYPE;f.TARGET_INDICATOR=g.deletes[0].TARGET_INDICATOR;f.SOURCE_INDICATOR=g.deletes[0].SOURCE_INDICATOR;f.IS_ACTIVE=g.deletes[0].IS_ACTIVE;}if(g.updates.length>0){f.TYPE=g.updates[0].TYPE;f.TARGET_INDICATOR=g.updates[0].TARGET_INDICATOR;f.SOURCE_INDICATOR=g.updates[0].SOURCE_INDICATOR;f.IS_ACTIVE=g.updates[0].IS_ACTIVE;}f.PROPERTY={remove:g.deletes,create:g.updates};delete f.CREATE;delete f.DELETE;c.metadataRef.update("ASSOCIATION",f,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh();},function(k){c.utilsRef.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText);c.errorMessages.push({"type":"Error","title":c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),"description":k.responseText});c.utilsRef.setErrorState(c);});}}if(c.viewMode==="associationCreate"||(c.viewMode==="associationEdit"&&c.associationData.IS_ACTIVE&&!b)){var h=c.sourceIndicatorModel.getData().INDICATOR.length?c.sourceIndicatorModel.getData().INDICATOR[0]:c.sourceIndicatorModel.getData().INDICATOR;var j={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:h.CREATED_BY,CREATED_ON:h.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};c.finalAssociationPayload={};c.finalAssociationPayload.TYPE=j.TYPE;c.finalAssociationPayload.SOURCE_INDICATOR=j.SOURCE_INDICATOR;c.finalAssociationPayload.TARGET_INDICATOR=j.TARGET_INDICATOR;c.finalAssociationPayload.IS_ACTIVE=j.IS_ACTIVE;c.finalAssociationPayload.PROPERTY=d;var s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length?this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0]:this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;var t=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length?this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0]:this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;c.ODataModel=c.oApplicationFacade.getODataModel();c.payload={TYPE:c.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID};c.metadataRef.create("ASSOCIATION",c.finalAssociationPayload,null,function(){sap.m.MessageToast.show(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED"));c.oApplicationFacade.getODataModel().refresh();},function(k){c.utilsRef.showErrorMessage(c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),k.responseText);c.errorMessages.push({"type":"Error","title":c.oApplicationFacade.getResourceBundle().getText("ASSOCIATION_SAVED_FAILED"),"description":k.responseText});c.utilsRef.setErrorState(c);});}c.setFooterOnError();},saveAssociationHelper:function(s,t,i){var a=this;var b={};if(a.sourceIndicatorModel.getData().INDICATOR.length){b=a.sourceIndicatorModel.getData().INDICATOR[0];}else{b=a.sourceIndicatorModel.getData().INDICATOR;}var c={TYPE:a.byId("associationTypeSelect").getSelectedItem().getKey(),SOURCE_INDICATOR:s.ID,TARGET_INDICATOR:t.ID,IS_ACTIVE:0,CREATED_BY:b.CREATED_BY,CREATED_ON:b.CREATED_ON,CHANGED_BY:null,CHANGED_ON:null};var d={PROPERTIES:a.getView().byId('propertyNameValueBox').getModel("associationProp").getData().PROPERTIES};var u=null;if((a.viewMode==="associationEdit"&&!(a.associationData.IS_ACTIVE))||(a.viewMode==="associationEdit"&&a.associationData.IS_ACTIVE&&i)){var o=a.formOldObjectForAssociation(s,t);u=a.utilsRef.dirtyBitCheck({oldPayload:o,newPayload:c,objectType:"ASSOCIATIONS"});a.savePropertiesHelper(d,u,s,t,i);}else if(a.viewMode==="associationCreate"||(a.viewMode==="associationEdit"&&a.associationData.IS_ACTIVE)){a.savePropertiesHelper(d,u,s,t);}},saveAssociation:function(i){var t=this;var s={};var a={};if(this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR.length&&this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR.length){s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR[0];a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR[0];}else{s=this.byId("sourceIndicatorContent").getModel("sourceIndicator").getData().INDICATOR;a=this.byId("targetIndicatorContent").getModel("targetIndicator").getData().INDICATOR;}var p={};if(this.viewMode==="associationEdit"){t.saveAssociationHelper(s,a,i);}else if(t.viewMode==="associationCreate"){if(a==null){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_KPI_TO_ASSOCIATE"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("SELECT_A_KPI_TO_ASSOCIATE")});t.utilsRef.setErrorState(t);t.byId("selectedKpiOpiId").setValueState(sap.ui.core.ValueState.Error);}else if(a.length==0){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_KPI_TO_ASSOCIATE"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("SELECT_A_KPI_TO_ASSOCIATE")});t.utilsRef.setErrorState(t);t.byId("selectedKpiOpiId").setValueState(sap.ui.core.ValueState.Error);}else{t.saveAssociationHelper(s,a,i);t.oApplicationFacade.getODataModel().refresh();}}},onBeforeRendering:function(){},onAfterRendering:function(){},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},onExit:function(){}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S3.controller');
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S3",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);var a=e.getParameter("arguments").contextPath;v.setBindingContext(c);t.getUsersAndRoles(v.getBindingContext().getProperty("ID")||a.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,''));}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"S3_EDIT",onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"authorizeSBEvaluation",route:"subDetail",context:v.getBindingContext().getPath().split("/")[1]});},bEnabled:false,},};},getUsersAndRoles:function(i){var t=this;this.byId("users").getBinding("content").filter([new sap.ui.model.Filter("ID","EQ",i),new sap.ui.model.Filter("TYPE","EQ","USER")]);this.byId("roles").getBinding("content").filter([new sap.ui.model.Filter("ID","EQ",i),new sap.ui.model.Filter("TYPE","EQ","ROLE")]);this.byId("users").getBinding("content").attachDataReceived(function(d){t.byId("usersTab").setCount(d.getSource().getLength());t.byId("usersTitle").setText(t.oApplicationFacade.getResourceBundle().getText("AUTH_USERS")+" ("+d.getSource().getLength()+")");t.byId("usersTitle").rerender();});this.byId("roles").getBinding("content").attachDataReceived(function(d){t.byId("rolesTab").setCount(d.getSource().getLength());t.byId("rolesTitle").setText(t.oApplicationFacade.getResourceBundle().getText("ROLES")+" ("+d.getSource().getLength()+")");});},formatId:function(i){return this.oApplicationFacade.getResourceBundle().getText("ID")+" : "+i;},formatOwner:function(o){return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"OWNER",o);},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v));},formatFavoriteMark:function(f){return((f)?true:false);},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S4",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.userSearch=false;this.roleSearch=false;this.previousAuthorizations=[];this.previousSelectedIds={};this.previousSelectedIds["USER"]={};this.previousSelectedIds["ROLE"]={};this.selectedIds={};this.selectedIds["USER"]={};this.selectedIds["ROLE"]={};var f=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];this.filterByAlphabetModel=new sap.ui.model.json.JSONModel();this.filterByAlphabetModel.setData(f);this.selectedItemsModel=new sap.ui.model.json.JSONModel();this.selectedItemsModel.setData([]);this.byId("selectedItemsList").setModel(this.selectedItemsModel,"selectedItems");this.alphabetFilterDialog={};this.deletedItems=[];this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")!="subDetail")return;t.byId('userSearchField').setValue('');t.byId('roleSearchField').setValue('');var c=new sap.ui.model.Context(t.getView().getModel(),'/'+(e.getParameter("arguments").contextPath));t.getView().setBindingContext(c);t.itemId=t.getView().getBindingContext().getProperty("ID");if(!t.itemId){t.itemId=(/ID=\'.*\'/).exec(e.getParameter("arguments").contextPath)[0];t.itemId=t.itemId.slice(t.itemId.indexOf("'")+1,t.itemId.lastIndexOf("'"));}t.getView().getModel().read("/AUTHORIZED_USERS",null,"$filter=ID eq '"+t.itemId+"'",false,function(d){t.selectedIds["USER"]={};t.selectedIds["ROLE"]={};t.deletedItems=[];t.previousAuthorizations=jQuery.extend(true,[],d.results);t.selectedItemsModel.setData(d.results);t.initialSelectedItems=jQuery.extend(true,[],d.results);t.byId("selectedItemsTab").setCount(d.results.length);for(var k in d.results)t.selectedIds[d.results[k].TYPE][d.results[k].NAME]=d.results[k].NAME;t.previousSelectedIds=jQuery.extend(true,{},t.selectedIds);},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LOADING_AUTH"));});t.byId("userList").bindItems("/HANA_USERS",new sap.m.CustomListItem({selected:{path:"NAME",formatter:function(n){return((t.selectedIds["USER"][n])?true:false);}},content:[new sap.ui.layout.Grid({defaultSpan:"L12 M12",width:"60%",vSpacing:0,content:[new sap.ui.core.Icon({src:"sap-icon://person-placeholder",size:"40px",color:{path:"NAME",formatter:function(n){return(t.selectedIds["USER"][n]?"#009de0":"#e6e6e6");}},layoutData:new sap.ui.layout.GridData({span:"L1 M1"})}),new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L8 M8"})})]})]}));t.byId("roleList").bindItems("/HANA_ROLES",new sap.m.CustomListItem({selected:{path:"NAME",formatter:function(n){return(t.selectedIds["ROLE"][n]?true:false);}},content:[new sap.ui.layout.Grid({defaultSpan:"L12 M12",width:"60%",vSpacing:0,content:[new sap.ui.core.Icon({src:"sap-icon://group",size:"40px",color:{path:"NAME",formatter:function(n){return(t.selectedIds["ROLE"][n]?"#009de0":"#e6e6e6");}},layoutData:new sap.ui.layout.GridData({span:"L1 M1"})}),new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L7 M7"})}),new sap.m.Link({text:{path:'NO_OF_USERS',formatter:jQuery.proxy(t.formatNoOfUsers,t)},press:jQuery.proxy(t.onAllRolesLinkSelect,t),layoutData:new sap.ui.layout.GridData({span:"L2 M2"})})]})]}));});this.oHeaderFooterOptions={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"S3_EDIT",oFilterOptions:{onFilterPressed:function(e){if(t.byId("idIconTabBarMulti").getSelectedKey()=="selected")sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FILTER_NOT_APPLICABLE"));else t.openFilterDialog();}},onBack:function(e){t.handleBackAndCancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveAuthorizations();}},buttonList:[{sI18nBtnTxt:"RESET",onBtnPressed:function(e){t.resetAuthorizations();},},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel();}}]};this.setHeaderFooterOptions(this.oHeaderFooterOptions);},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},onUserSearch:function(e){var p=this.userSearch;e.getSource().getValue()==""?this.userSearch=false:this.userSearch=true;var i=this.byId("userList").getBinding("items");var s=e.getSource().getValue().toLowerCase();s=escape(s);if(p)i.aFilters.pop();if(this.userSearch)i.aFilters.push(new sap.ui.model.Filter("tolower(NAME)","Contains","'"+s+"'"));i.filter(i.aFilters);},onRoleSearch:function(e){var p=this.roleSearch;e.getSource().getValue()==""?this.roleSearch=false:this.roleSearch=true;var s=e.getSource().getValue().toLowerCase();s=escape(s);var i=this.byId("roleList").getBinding("items");if(p)i.aFilters.pop();if(this.roleSearch)i.aFilters.push(new sap.ui.model.Filter("tolower(NAME)","Contains","'"+s+"'"));i.filter(i.aFilters);},refreshFilter:function(){var e=this.byId("idIconTabBarMulti").getSelectedKey();var i=this.byId((e==="users")?"userList":"roleList").getBinding("items");i.filter([],false);this.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(false);this.alphabetFilterDialog[e]=null;},onUserItemSelectionChange:function(e){this.onItemSelectionChange(e,"USER");},onRoleItemSelectionChange:function(e){this.onItemSelectionChange(e,"ROLE");},onItemSelectionChange:function(e,t){var s=this.selectedItemsModel.getData();var a=e.getParameter("listItem");var b=a.getBindingContext().getObject();if(a.getSelected()){for(var k in this.deletedItems){if(this.deletedItems[k].NAME===b.NAME&&this.deletedItems[k].TYPE===t)this.deletedItems.splice(k,1);}b.TYPE=t;s.push(b);var c=a.getContent()[0].getContent()[0];c.setColor("#009de0");this.selectedIds[t][b.NAME]=b.NAME;}else{for(var k in this.previousAuthorizations){if(this.previousAuthorizations[k].NAME===b.NAME&&this.previousAuthorizations[k].TYPE===t){b.TYPE=t;this.deletedItems.push(b);}}for(var k in s)if((s[k].NAME==b.NAME)&&(s[k].TYPE==t))s.splice(k,1);var c=a.getContent()[0].getContent()[0];c.setColor("#e6e6e6");this.selectedIds[t][b.NAME]=null;}this.selectedItemsModel.setData(s);this.byId("selectedItemsTab").setCount(s.length);},onSelectedItemDelete:function(e){var d=e.getParameter("listItem").getBindingContext("selectedItems").getObject();var i=this.byId(d.TYPE=="USER"?"userList":"roleList");for(var k in this.previousAuthorizations){if(this.previousAuthorizations[k].NAME===d.NAME&&this.previousAuthorizations[k].TYPE===d.TYPE)this.deletedItems.push(d);}this.selectedIds[d.TYPE][d.NAME]=null;i.getModel().refresh(true);var s=this.selectedItemsModel.getData();var a=e.getParameter("listItem").getBindingContext("selectedItems").getPath().substr(1);s.splice(a,1);this.selectedItemsModel.setData(s);this.byId("selectedItemsList").rerender();this.byId("selectedItemsTab").setCount(s.length);},onAllRolesLinkSelect:function(e){var r=e.getSource().getBindingContext().getProperty("NAME");var n=e.getSource().getBindingContext().getProperty("NO_OF_USERS");this.onRolesLinkSelect(e,r,n);},onSelectedRolesLinkSelect:function(e){var r=e.getSource().getBindingContext("selectedItems").getProperty("NAME");var n=e.getSource().getBindingContext("selectedItems").getProperty("NO_OF_USERS");this.onRolesLinkSelect(e,r,n);},onRolesLinkSelect:function(e,r,n){n=n+" "+(n==1?this.oApplicationFacade.getResourceBundle().getText("USER"):this.oApplicationFacade.getResourceBundle().getText("USERS"));if(!this._rolesPopover){this.roleNameLabel=new sap.m.Label({text:r,design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L10 M10"})});this.noOfUsersLabel=new sap.m.Label({text:n,design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12"})});var a=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.ui.core.Icon({src:"sap-icon://group",size:"40px",color:"#e6e6e6",layoutData:new sap.ui.layout.GridData({span:"L2 M2"})}),this.roleNameLabel,this.noOfUsersLabel]});this.usersForRole=new sap.ui.layout.Grid({span:"L12 M12"});var b=new sap.m.VBox({items:[a,this.usersForRole],});var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:"{i18n>ROLE_DETAILS}"})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){this._rolesPopover.close();},this)})]});this._rolesPopover=new sap.m.Popover({customHeader:c,content:b});this.getView().addDependent(this._rolesPopover);}this.roleNameLabel.setText(r);this.noOfUsersLabel.setText(n);this.usersForRole.bindAggregation("content","/USERS_GRANTED_ROLE(P_ROLE_NAME='"+r+"')/Results",new sap.m.Label({text:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L12 M12"})}));var i=e.getSource();jQuery.sap.delayedCall(0,this,function(){this._rolesPopover.openBy(i);});},formatSelectedItemsIcon:function(t){if(t==="ROLE")return"sap-icon://group";else return"sap-icon://person-placeholder";},formatNoOfUsers:function(n){if(n)return n+" "+(n==1?this.oApplicationFacade.getResourceBundle().getText("USER"):this.oApplicationFacade.getResourceBundle().getText("USERS"));else return"";},saveAuthorizations:function(){var t=this;var s=this.selectedItemsModel.getData();var d=[];var c=[];var i=true;var p={ID:this.itemId,REVOKE:[],GRANT:[]};var b=new sap.m.BusyDialog();b.open();for(var k in this.deletedItems){p.REVOKE.push(this.deletedItems[k].NAME);}for(var k in s){p.GRANT.push(s[k].NAME);}sap.suite.ui.smartbusiness.lib.Util.utils.create(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("AUTHORIZATION_SERVICE_URI"),p,null,function(a){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("AUTH_SAVE_SUCCESS"));t.onNavBack();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]});b.close();},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("AUTH_SAVE_ERROR"),e.responseText);b.close();});},resetAuthorizations:function(){this.selectedIds=jQuery.extend(true,{},this.previousSelectedIds);this.selectedItemsModel.setData(jQuery.extend(true,[],this.previousAuthorizations));this.byId("selectedItemsTab").setCount(this.previousAuthorizations.length);this.byId("selectedItemsList").rerender();this.byId("userList").getModel().refresh(true);this.byId("roleList").getModel().refresh(true);this.deletedItems=[];},onNavBack:function(){this.selectedIds["USER"]={};this.selectedIds["ROLE"]={};this.deletedItems=[];},openFilterDialog:function(){var t=this;var e=this.byId("idIconTabBarMulti").getSelectedKey();if(!this.alphabetFilterDialog[e]){this.alphabetFilterDialog[e]=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("FILTER")+" : "+(e=="users"?t.oApplicationFacade.getResourceBundle().getText("USERS"):t.oApplicationFacade.getResourceBundle().getText("ROLES")),growingScrollToLoad:true,rememberSelections:true,multiSelect:true,search:function(E){t.alphabetFilterDialog[e].getBinding("items").filter(new sap.ui.model.Filter("","Contains",E.getParameters().value));},confirm:function(E){var f=[];var i=t.byId((e==="users")?"userList":"roleList").getBinding("items");var s=null;if(e==="users")s=t.userSearch?i.aFilters.pop():null;else s=t.roleSearch?i.aFilters.pop():null;var a=[];var b=E.getParameter("selectedContexts");for(var k in b){f.push(new sap.ui.model.Filter("NAME","StartsWith",b[k].getObject()));a.push(b[k].getObject());}if(s)f.push(s);i.filter(f,false);if(a.length>0){t.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(true);t.byId((e==="users")?"userInfoToolbarLabel":"roleInfoToolbarLabel").setText(t.oApplicationFacade.getResourceBundle().getText("FILTERED_BY")+"("+a.join(", ")+")");}else t.byId((e==="users")?"userInfoToolbar":"roleInfoToolbar").setVisible(false);},items:{path:"/",template:new sap.m.StandardListItem({title:"{}"})}});this.alphabetFilterDialog[e].setModel(this.filterByAlphabetModel);}this.alphabetFilterDialog[e].open();},onSelectIconTab:function(e){if(e.getParameter("selectedKey")=="selected"){this.oHeaderFooterOptions.oFilterOptions.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}else{this.oHeaderFooterOptions.oFilterOptions.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}},handleBackAndCancel:function(){var t=this;var d=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.initialSelectedItems,newPayload:t.selectedItemsModel.getData(),objectType:"AUTHORIZATION"});if(d.updates.length||d.deletes.length){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]});}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"authorizeSBEvaluation",route:"detail",context:t.getView().getBindingContext().getPath().split("/")[1]});}},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.S2",{onInit:function(){var t=this;t.selectedGroupItemKey="workspace";t.selectedGroupItemIndex=0;t.lastSavedIndex=0;t.oApplicationFacade.getODataModel().setSizeLimit(100000);t.lastGroupingOption=new sap.ui.model.Sorter("MANUAL_ENTRY",true,function(c){var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}});t.lastSortingOrder={indicatorTextOrder:null,order:new sap.ui.model.Sorter("CHANGED_ON",true,null)};if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null;},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.getView().getModel("i18n").getProperty("YMSG_ERROR_RETRIEVING_DATA"),e.response.body);});}this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("IS_ACTIVE","EQ",1)]);this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);},onRoutePatternMatched:function(e){var t=this;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");if(e.getParameter("name")==="detail"||e.getParameter("name")==="noDataView"){sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("list"),hideElement:"list",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");}},formatEvaluationHeader:function(i,e){var t=this;if(i==null&&e!=null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+"- "+e);}else if(i!=null&&e==null){return(i+" -"+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else if(i==null&&e==null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+" - "+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else{return(i+" - "+e);}},formatIndicatorId:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:g,text:g}},createGroupOptions:function(){var t=this;var j={groupItems:[{text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace",index:0},{text:t.oApplicationFacade.getResourceBundle().getText("BY_INDICATOR"),key:"indicator",index:1},{text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner",index:2},{text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none",index:3},]};var m=new sap.ui.model.json.JSONModel(j);var g=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("GROUP_BY"),id:this.createId("groupOptionsDialog"),content:[new sap.m.List({items:{path:"/groupItems",template:new sap.m.ObjectListItem({type:"Active",title:"{text}"})},itemPress:function(e){e.getParameter("listItem").setSelected(true);t.selectedGroupItemKey=e.getParameter("listItem").getBindingContext().getProperty("key");t.selectedGroupItemIndex=e.getParameter("listItem").getBindingContext().getProperty("index");if(t.selectedGroupItemKey=="workspace"){t.setGrouping(t.selectedGroupItemKey,true);}else{t.setGrouping(t.selectedGroupItemKey,false);}t.lastSavedIndex=t.selectedGroupItemIndex;this.getParent().close();}})],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(e){t.selectedGroupItemIndex=t.lastSavedIndex;this.getParent().close();}})});g.setModel(m);return g;},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"ALL_ACTIVE_EVALUATIONS",oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open();}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open();}},oGroupOptions:{onGroupPressed:function(e){if(t.byId("groupOptionsDialog")){t.byId("groupOptionsDialog").destroy();}t.getView().groupOptionDialog=t.createGroupOptions();t.getView().groupOptionDialog.open();t.byId("groupOptionsDialog").getContent()[0].getItems()[t.selectedGroupItemIndex].setSelected(true);}},};},setGrouping:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var a;if(k=="workspace"){a=new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var b="";switch(i){case 1:b=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:b=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:b=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:b,text:b}})}else if(k=="indicator"){a=new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}});}else if(k=="owner"){a=new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var b="";switch(o){case null:b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:b=o;}return{key:b,text:b}});}else if(k=="none"){a=null;}if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order,t.lastSortingOrder.indicatorTextOrder],true);}else if(!t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order],true);}else{if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order){l.getBinding("items").sort([t.lastSortingOrder.indicatorTextOrder,t.lastSortingOrder.order]);}else{l.getBinding("items").sort([t.lastSortingOrder.order]);}}this.lastGroupingOption=a;},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_CHANGE_DATE"),key:"changedate"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NAME"),key:"name"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_ID"),key:"id"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});s.setSelectedSortItem("changedate");s.setSortDescending(true);return s;},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var s,a;if(k=="changedate"){s=new sap.ui.model.Sorter("CHANGED_ON",g,null);}else if(k=="name"){s=new sap.ui.model.Sorter("TITLE",g,null);a=new sap.ui.model.Sorter("INDICATOR_TITLE",g,null);}else if(k=="id"){s=new sap.ui.model.Sorter("ID",g,null);}if(t.lastGroupingOption){if(a){l.getBinding("items").sort([t.lastGroupingOption,a,s],true);}else{l.getBinding("items").sort([t.lastGroupingOption,s],true);}}else{if(a){l.getBinding("items").sort([a,s]);}else{l.getBinding("items").sort([s]);}}this.lastSortingOrder={indicatorTextOrder:a,order:s};},setFiltering:function(i){var f=[];var l=this.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,this.oApplicationFacade.currentLogonHanaUser)),};for(var b in i){f.push(a[b]);}if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,false));}else{l.getBinding("items").filter(f);}},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.getView().getModel("i18n").getProperty("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.getView().getModel("i18n").getProperty("SELF_CREATED"),key:"self_created"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterKeys"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText();}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c];}}}}});return f;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.emptyView.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.emptyView.controller');
/*
 * Copyright (C) 2009-2013 SAP AG or an SAP affiliate company. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.ca.ui.images.images');jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("/")+"/sap/ca/scfld/md/css/flower.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.emptyView",{onInit:function(){var i=this.byId("flower");this.errorState=false;if(i){i.setSrc(sap.ca.ui.images.images.Flower);}this.getView().addEventDelegate(this,this);this.getView().addEventDelegate({onBeforeShow:jQuery.proxy(function(e){if(e.data&&(e.data.viewTitle||e.data.languageKey||e.data.infoText)){this.setTitleAndMessage(e.data.viewTitle,e.data.languageKey,e.data.infoText);}},this)});var v=this.getView();var t=this;if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}this.oRouter.attachRouteMatched(function(E){if(E.getParameter("name")==="noDataView"){if(this.oApplicationFacade.copyClipboard){this.copyClipboard=this.oApplicationFacade.copyClipboard;}this.isPasteEnabled=false;var s=E.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+s);v.setBindingContext(c);this.context=c;try{this.evaluationId=v.getBindingContext().getObject()["ID"];}catch(e){try{this.evaluationId=s.match(/ID=[^,]+/g)[0].replace(/(ID=')|(')/g,"");}catch(e){this.evaluationId=s.replace(/EVALUATIONS_MODELER\('|'\)/g,"")}}var a=E.getParameter("arguments");this.setTitleAndMessage(a.viewTitle,a.languageKey);if(this.copyClipboard&&Object.keys(this.copyClipboard)&&Object.keys(this.copyClipboard).length){this.checkEvaluationForPaste();}else{if(this._oControlStore&&this._oControlStore.oButtonListHelper){this.updateHeaderFooterOptions(false);}}}},this);},lauchConfigurator:function(){this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));var c=this.evaluationId+"/"+this.DDA_MODEL.NEW_VIEWID;this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configureChart",context:c});},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:true,sI18NDetailTitle:"DRILLDOWN_CONFIG_DETAILS",oEditBtn:{sI18nBtnTxt:"CONFIGURE",onBtnPressed:function(e){t.lauchConfigurator()},bEnabled:false,},buttonList:[{sId:"Paste",sI18nBtnTxt:"PASTE",bDisabled:(!(t.isPasteEnabled)),onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyDDAConfiguration();}}]};return this.oHeaderFooterOptions;},setTitleAndMessage:function(v,l,i){var p=this.byId("sap.ca.scfld.md.view.empty");var t=this.oApplicationFacade.oApplicationImplementation.getResourceBundle().getText(v);if(!t||t===v){if(!i){t=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());}else{t=i;}};p.setTitle(t);var L=this.byId("emptyLabel");if(!i){var m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(l);if(!m||m===l){m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());};L.setText(m);}else{L.setText(i);}},updateHeaderFooterOptions:function(p){this.isPasteEnabled=p;this.setHeaderFooterOptions(this.getHeaderFooterOptions());},checkEvaluationForPaste:function(){var c=this.context.getObject();if((this.copyClipboard.evaluationData.ID==c.ID)||this.checkEvaluationForPaste1()){this.updateHeaderFooterOptions(false);}else{this.updateHeaderFooterOptions(true);}},checkEvaluationForPaste1:function(){var b=this.context.getObject();var d=this.copyClipboard.masterData;var f={};var g={};var h=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(b.ODATA_URL,b.ODATA_ENTITYSET);var k=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(b.ODATA_URL,b.ODATA_ENTITYSET);if(k.length){if(k.length==1){f[k[0]]="M";}else{f=k.reduce(function(p,c,i,a){f=f||{};if(i==1){f[a[0]]="M";}f[a[i]]="M";return f;});}}if(h.length){if(h.length==1){g[h[0]]="D";}else{g=h.reduce(function(p,c,i,a){g=g||{};if(i==1){g[a[0]]="D";}g[a[i]]="D";return g;});}}var n=null;this.diffHeaders=[];for(var i=0,l=d.FILTERS.length;i<l;i++){delete d.FILTERS[i].__metadata;if(g[d.FILTERS[i].DIMENSION]!="D"){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.FILTERS[i].DIMENSION]==undefined){n.DIMENSIONS[d.FILTERS[i].DIMENSION]=[];}d.FILTERS[i].entityType="FILTER";n.DIMENSIONS[d.FILTERS[i].DIMENSION].push(d.FILTERS[i]);}}for(var i=0,l=d.CHART.length;i<l;i++){delete d.CHART[i].__metadata;if(d.CHART[i].THRESHOLD_MEASURE){if(f[d.CHART[i].THRESHOLD_MEASURE]!="M"){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.CHART[i].THRESHOLD_MEASURE]==undefined){n.MEASURES[d.CHART[i].THRESHOLD_MEASURE]=[];}d.CHART[i].entityType="THRESHOLD_MEASURE";n.MEASURES[d.CHART[i].THRESHOLD_MEASURE].push(d.CHART[i]);}}}for(var i=0,l=d.COLUMNS.length;i<l;i++){delete d.COLUMNS[i].__metadata;var o=null;var q=null;if(d.COLUMNS[i].TYPE=="MEASURE"){if((f[d.COLUMNS[i].NAME]!="M")){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.COLUMNS[i].NAME]==undefined){n.MEASURES[d.COLUMNS[i].NAME]=[];}d.COLUMNS[i].entityType="MEASURE";n.MEASURES[d.COLUMNS[i].NAME].push(d.COLUMNS[i]);}if((f[d.COLUMNS[i].SORT_BY]!="M")){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.COLUMNS[i].SORT_BY]==undefined){n.MEASURES[d.COLUMNS[i].SORT_BY]=[];}o=jQuery.extend(true,{},d.COLUMNS[i],{});o.entityType="SORT_BY";n.MEASURES[d.COLUMNS[i].SORT_BY].push(o);}}else if(d.COLUMNS[i].TYPE=="DIMENSION"){if((g[d.COLUMNS[i].NAME]!="D")){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.COLUMNS[i].NAME]==undefined){n.DIMENSIONS[d.COLUMNS[i].NAME]=[];}d.COLUMNS[i].entityType="DIMENSION";n.DIMENSIONS[d.COLUMNS[i].NAME].push(d.COLUMNS[i]);}if((g[d.COLUMNS[i].SORT_BY]!="D")){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.COLUMNS[i].SORT_BY]==undefined){n.DIMENSIONS[d.COLUMNS[i].SORT_BY]=[];}q=jQuery.extend(true,{},d.COLUMNS[i],{});q.entityType="SORT_BY";n.DIMENSIONS[d.COLUMNS[i].SORT_BY].push(q);}}}for(var i=0,l=d.HEADER.length;i<l;i++){if(d.HEADER[i].EVALUATION_ID!==d.HEADER[i].REFERENCE_EVALUATION_ID){this.diffHeaders.push(d.HEADER[i]);}else{if((d.HEADER[i].VISUALIZATION_TYPE!="NT")&&(d.HEADER[i].VISUALIZATION_TYPE!="AT")){if((d.HEADER[i].VISUALIZATION_TYPE==="CM")){var r=undefined;try{r=JSON.parse(JSON.parse(d.HEADER[i].CONFIGURATION).MEASURES);}catch(e){throw new Error("Failed to parse multiple measures of Comparison Chart Multiple Measures");}for(var j=0,m=r.length;i<m;i++){if(f[r[j]["name"]]!="M"){d.HEADER[i].entityType="HEADERS";if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[r[j]["name"]]==undefined){n.MEASURES[r[j]["name"]]=[];}n.MEASURES[r[j]["name"]].push(d.HEADER[i]);break;}}}else{if(g[d.HEADER[i].DIMENSION]!="D"){d.HEADER[i].entityType="HEADERS";if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.HEADER[i].DIMENSION]==undefined){n.DIMENSIONS[d.HEADER[i].DIMENSION]=[];}n.DIMENSIONS[d.HEADER[i].DIMENSION].push(d.HEADER[i]);}}}}}return n;},copyDDAConfiguration:function(){var t=this;if(this.copyClipboard&&this.copyClipboard.evaluationData){var p={sourceEvaluationId:this.copyClipboard.evaluationData.ID,targetEvaluationId:t.evaluationId};var c=function(){sap.suite.ui.smartbusiness.lib.Util.utils.create(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("COPY_DDA_CONFIGURATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_SUCCESS"));t.oApplicationFacade.__refreshModel=1;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:"EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)"});},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_ERROR"),e.responseText);});};c();}},onAfterRendering:function(){}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.Component')){
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.evaluation.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.evaluation.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.evaluation","includes":["../../lib/Util.js","../../lib/OData.js","../../Adapter.js"],"dependencies":{"libs":["sap.m"],"components":[],},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","icon":"sap-icon://Fiori5/F0822","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0822_Create_Evaluation.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0822_Create_Evaluation/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.evaluation.view",fullScreenPageRoutes:{"fullscreen":{"pattern":"","view":"S1"},"addEvaluation":{"pattern":"addEvaluation/{indicatorContext}","view":"S1"},"editEvaluation":{"pattern":"editEvaluation/{indicatorContext}/{evaluationContext}","view":"S1"},"duplicateEvaluation":{"pattern":"duplicateEvaluation/{indicatorContext}/{evaluationContext}","view":"S1"},"editEvaluationDraft":{"pattern":"editEvaluationDraft/{indicatorContext}/{evaluationContext}","view":"S1"},},}),createContent:function(){var v={component:this};jQuery.sap.require("sap.ca.ui.utils.Lessifier");sap.ca.ui.utils.Lessifier.lessifyCSS("sap.suite.ui.smartbusiness.designtime.evaluation","view/thresholdAndTargetBar.css");return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.view.thresholdAndTargetBar')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.evaluation.view.thresholdAndTargetBar");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/thresholdAndTargetBar.css");sap.ui.core.Control.extend("sap.suite.ui.smartbusiness.designtime.evaluation.view.thresholdAndTargetBar",{metadata:{properties:{criticalLow:"int",warningLow:"int",target:"int",criticalHigh:"int",warningHigh:"int",goalType:"string"},},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("thresholdAndTargetBar");r.writeClasses();r.write(">");switch(c.getGoalType()){case"MA":{c.getMaximizingThresholdBar(r,c);break;}case"MI":{c.getMinimizingThresholdBar(r,c);break;}case"RA":{c.getRangeThresholdBar(r,c);break;}}r.write("</div>");},generateBlock:function(r,c,a,w){r.write("<div");r.addClass("block");r.writeClasses();r.addStyle("width",w+"%");r.addStyle("background-color",a);r.writeStyles();r.write("></div>");},generateBar:function(r,c,a){r.write("<div");r.addClass("thresholdBar");r.addStyle("background-color",a);r.writeStyles();r.writeClasses();r.write("></div>");},generateThresholdDiv:function(r,c){r.write("<div");r.addClass("thresholdDiv");r.writeClasses();r.write(">");},generateEmptyDiv:function(r,c,w){r.write("<div");r.addStyle("width",w+"%");r.writeStyles();r.write("></div>");},generateNumbers:function(r,c,n){r.write("<div");r.write(">");r.writeEscaped(n);r.write("</div>");},getMaximizingThresholdBar:function(r,c){var t=c.getTarget();var a=c.getCriticalLow();var w=c.getWarningLow();var o=10;criticalLowSection=(a/t)*100;warningLowSection=((w-a)/t)*100;targetSection=100-(criticalLowSection+warningLowSection);c.generateThresholdDiv(r,c);c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')),criticalLowSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')),warningLowSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),targetSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),o);r.write("</div>");c.generateThresholdDiv(r,c);c.generateEmptyDiv(r,c,criticalLowSection);c.generateNumbers(r,c,"1");c.generateEmptyDiv(r,c,warningLowSection);c.generateNumbers(r,c,"2");c.generateEmptyDiv(r,c,targetSection);c.generateNumbers(r,c,"3");c.generateEmptyDiv(r,c,o);r.write("</div>");},getMinimizingThresholdBar:function(r,c){var t=c.getTarget();var w=c.getWarningHigh();var a=c.getCriticalHigh();var o=10;targetSection=(t/a)*100;warningHighSection=((w-t)/a)*100;criticalHighSection=((a-w)/a)*100;c.generateThresholdDiv(r,c);c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),o);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),targetSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')),warningHighSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')),criticalHighSection);r.write("</div>");c.generateThresholdDiv(r,c);c.generateEmptyDiv(r,c,o);c.generateNumbers(r,c,"1");c.generateEmptyDiv(r,c,targetSection);c.generateNumbers(r,c,"2");c.generateEmptyDiv(r,c,warningHighSection);c.generateNumbers(r,c,"3");c.generateEmptyDiv(r,c,criticalHighSection);r.write("</div>");},getRangeThresholdBar:function(r,c){var t=c.getTarget();var a=c.getCriticalLow();var w=c.getWarningLow();var b=c.getWarningHigh();var d=c.getCriticalHigh();var o=10;criticalLowSection=(a/d)*100;warningLowSection=((w-a)/d)*100;targetSection=(((t-w)/d)*100)/2;warningHighSection=((b-t)/d)*100;criticalHighSection=((d-b)/d)*100;c.generateThresholdDiv(r,c);c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')),criticalLowSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')),warningLowSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),targetSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive')),targetSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiCritical')),warningHighSection);c.generateBar(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')));c.generateBlock(r,c,sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative')),criticalHighSection);r.write("</div>");c.generateThresholdDiv(r,c);c.generateEmptyDiv(r,c,criticalLowSection);c.generateNumbers(r,c,"1");c.generateEmptyDiv(r,c,warningLowSection);c.generateNumbers(r,c,"2");c.generateEmptyDiv(r,c,targetSection);c.generateNumbers(r,c,"3");c.generateEmptyDiv(r,c,targetSection);c.generateNumbers(r,c,"4");c.generateEmptyDiv(r,c,warningHighSection);c.generateNumbers(r,c,"5");c.generateEmptyDiv(r,c,criticalHighSection);r.write("</div>");}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.kpi.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.kpi.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.kpi","includes":["../../lib/Util.js","../../Adapter.js"],"dependencies":{"libs":["sap.m"],"components":[],},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","icon":"sap-icon://Fiori5/F0817","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0817_Define_New_KPI.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0817_Define_New_KPI/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.kpi.view",fullScreenPageRoutes:{"editKpi":{"pattern":"editKpi/{contextPath}","view":"S1"},"createKpi":{"pattern":"","view":"S1"},"editDraftKpi":{"pattern":"editDraftKpi/{contextPath}","view":"S1"},"duplicateKpi":{"pattern":"duplicateKpi/{contextPath}","view":"S1"}},}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.kpi.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.tools.migration.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS1",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.tools.migration","includes":["../../../lib/formatters.js","../../../lib/Util.js"],"dependencies":{"libs":["sap.m","sap.ca.ui"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.tools.migration.view",fullScreenPageRoutes:{"fullscreen":{"pattern":"","view":"S1"}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.tools.migration.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.Configuration",{oServiceParams:{serviceList:[]},getAppConfig:function(){return this.oAppConfig;},getServiceList:function(){return this.oServiceParams.serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.tools.migration.view.S1",{onInit:function(){jQuery.sap.require("sap.m.MessageBox");var r=jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.designtime.tools.migration");var m=this;var t=this;this.oI18nModel=new sap.ui.model.resource.ResourceModel({bundleName:"sap/suite/ui/smartbusiness/designtime/tools/migration/i18n/i18n"});this.getView().setModel(m.oI18nModel,"i18n");var o={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_MIGRATE"),onBtnPressed:function(e){m.migrateData();}},buttonList:[{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_RESET"),onBtnPressed:function(e){m.clearData();}},{sI18nBtnTxt:m.oI18nModel.getResourceBundle().getText("BTN_CANCEL"),onBtnPressed:function(e){m.cancel();}}]};this.setHeaderFooterOptions(o);this.newEvaluationsModel=new sap.ui.model.json.JSONModel();var n={EVALUATIONS:[{ID:"",INDICATOR:"",TITLE:"",OLD_ID:"",VALID_ID:""}]};this.newEvaluationsModel.setData((n));this._dialog=new sap.m.BusyDialog({});this.getView().byId("kpiInput").setValueHelpOnly(true);},showBusy:function(o){var m=this;var t=this;if(o=="L")this._dialog.setText(m.oI18nModel.getResourceBundle().getText("LOADING_DIALOG_TEXT"));if(o=="M")this._dialog.setText(m.oI18nModel.getResourceBundle().getText("MIGRATING_DIALOG_TEXT"));this._dialog.open();},hideBusy:function(){var t=this;this._dialog.close();},handleKpiValueHelp:function(){var m=this;var t=this;this.selectedKPIs=[];this.oldModel=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/modeler_services.xsodata",true);this.oldModelDDA=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/query_view_annotation_services.xsodata",true);this.oldModelVariants=new sap.ui.model.odata.ODataModel("/sap/hba/apps/kpi/s/odata/variant_services.xsodata",true);this.newModel=new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);this.kpiList=new sap.m.ObjectListItem({title:"{id}",number:"{evalCount}",numberUnit:"Evaluations",attributes:new sap.m.ObjectAttribute({text:"{text}"}),});var k=new sap.m.SelectDialog({title:m.oI18nModel.getResourceBundle().getText("SELECT_KPI_DIALOG"),multiSelect:true,noDataText:"No data found",items:{path:"/ActiveKPIs",sorter:new sap.ui.model.Sorter({path:'id',descending:false}),template:m.kpiList},confirm:function(e){var c=e.mParameters.selectedContexts;m.selectedKPIs=[];for(var i=0;i<c.length;i++){m.selectedKPIs.push(c[i].sPath.split('\'')[1]);}if(m.selectedKPIs.length>0){var a;var b=0;var p="";var j=0;for(var i=j;i<m.selectedKPIs.length;i++){p="ID eq '"+m.selectedKPIs[i]+"' and IS_ACTIVE eq 1";a=m.serviceCallDataValidation("/INDICATORS",["$format=json","$filter="+p],m.newModel);if(a.success){b++;}}}if(m.selectedKPIs.length>0){if(b>0&&b!=m.selectedKPIs.length){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_FEW_KPIs_MIGRATED"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("L");setTimeout(function(){m.bindEvaluations();},2500);});}if(b==0){m.showBusy("L");setTimeout(function(){m.bindEvaluations();},2500);}if(b>0&&b==m.selectedKPIs.length){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_ALL_KPIs_MIGRATED"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("L");setTimeout(function(){m.bindEvaluations();},2500);});}}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(id)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f]);}});k.setModel(m.oldModel);k.open();},bindEvaluations:function(){var m=this;m.testVal=[];var t=this;var v=[];var a={};var b="";var o=this.getView().byId("oldList");var n=this.getView().byId("newList");var p={};p.VIEWS=[];var d={};d.CONFIGURATIONS=[];var f=new sap.m.List({});var g=new sap.m.List({});var h=new sap.ui.model.json.JSONModel();this.dialogModel=new sap.ui.model.json.JSONModel();this.newConfigurationObject=[];m.newConfigurationObject.CONFIGURATIONS=[];var k=new sap.m.ObjectListItem({title:"{viewName}",});var l=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{CONFIGURATION_NAME}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12"})}),new sap.m.Label({text:"*View ID: ",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{VALID_CONFIGURATION_ID}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",}),}),]});f.bindItems({path:"/VIEWS",sorter:new sap.ui.model.Sorter({path:'viewName',descending:false,}),template:k});var q=new sap.m.ResponsivePopover({});var r=new sap.m.CustomListItem({content:l,});var s=new sap.m.Dialog({endButton:new sap.m.Button({text:m.oI18nModel.getResourceBundle().getText("BTN_SAVE_CLOSE"),press:function(){var x=this.getModel().getData().CONFIGURATIONS;for(var i=0;i<x.length;i++){for(var j=0;j<m.newConfigurationObject.CONFIGURATIONS.length;j++){if(x[i].CONFIGURATION_NAME==m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_NAME){m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID=x[i].VALID_CONFIGURATION_ID;}}}s.close();}}),});s.addContent(g);s.setModel(m.dialogModel);g.bindItems({path:"/CONFIGURATIONS",sorter:new sap.ui.model.Sorter({path:'CONFIGURATION_NAME',descending:false,}),template:r});q.addContent(f);q.setModel(h);o.attachUpdateStarted(function(e){this.setBusy(true);this.setNoDataText(m.oI18nModel.getResourceBundle().getText("LIST_LOADING"));});o.attachUpdateFinished(function(e){this.setBusy(false);this.setNoDataText("");});n.attachUpdateStarted(function(e){this.setBusy(true);this.setNoDataText(m.oI18nModel.getResourceBundle().getText("LIST_LOADING"));});n.attachUpdateFinished(function(e){this.setBusy(false);this.setNoDataText("");});for(var i=0;i<m.selectedKPIs.length;i++){a={};a.operator="EQ";a.value1=m.selectedKPIs[i];v.push(a);}var F=new sap.ui.model.odata.Filter("objectId",v,false);var u=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{evaluationText}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L9 M9 S9"})}).addStyleClass("listContentTop"),new sap.m.Label({text:this.oI18nModel.getResourceBundle().getText("VAR_ID"),layoutData:new sap.ui.layout.GridData({span:"L2 M2 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{variantId}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",}),editable:false}),new sap.m.Link({text:{path:"/variantId",formatter:function(){var b;var c=this.getBindingContext().getProperty("objectId");var e=this.getBindingContext().getProperty("variantId");var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+e+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));}else{b=0;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));}}},press:function(e){b="";p.VIEWS=[];var c=this.getBindingContext().getProperty("objectId");var j=this.getBindingContext().getProperty("variantId");var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+j+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;q.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));for(var i=0;i<b;i++){var x={};x.viewName=a.data[0].value.split(",")[i];p.VIEWS.push(x);}h.setData(p);q.openBy(e.getSource());}else{h.setData(p);b=0;q.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));q.openBy(e.getSource());}},layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",indent:"L2 M2 S2",linebreakL:true,linebreakM:true,linebreakS:true}),}),]});var w=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,content:[new sap.m.Label({text:"{TITLE}",design:sap.m.LabelDesign.Bold,layoutData:new sap.ui.layout.GridData({span:"L9 M9 S9"})}).addStyleClass("listContentTop"),new sap.m.Label({text:"*"+this.oI18nModel.getResourceBundle().getText("EVAL_ID"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true})}),new sap.m.Input({type:"Text",value:"{ID}",layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",liveChange:function(e){},change:function(e){}}),}),new sap.m.Link({text:{path:"/variantId",formatter:function(){var b;var c=this.getBindingContext().getProperty("OLD_ID").split("~")[0];var e=this.getBindingContext().getProperty("OLD_ID").split("~")[1];var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+c+"' and variantId eq '"+e+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));}else{b=0;return(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));}}},press:function(e){b="";d.CONFIGURATIONS=[];var x=this.getBindingContext().getProperty("OLD_ID").split("~")[0];var A=this.getBindingContext().getProperty("OLD_ID").split("~")[1];var a=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+x+"' and variantId eq '"+A+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);if(a.success){b=a.data[0].value.split(",").length;s.setTitle(this.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));var B=0;for(var i=0;i<b;i++){B=0;for(var j=0;j<m.newConfigurationObject.CONFIGURATIONS.length;j++){if(m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_NAME==a.data[0].value.split(",")[i]){B++;var c=m.newConfigurationObject.CONFIGURATIONS[j].VALID_CONFIGURATION_ID;m.newConfigurationObject.CONFIGURATIONS[j].VALID_CONFIGURATION_ID=m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID;m.newConfigurationObject.CONFIGURATIONS[j].CONFIGURATION_ID=c;d.CONFIGURATIONS.push(jQuery.extend({},m.newConfigurationObject.CONFIGURATIONS[j]));break;}}if(B==0){var C={};C.CONFIGURATION_NAME=a.data[0].value.split(",")[i];C.CONFIGURATION_ID=a.data[0].objectId+"~"+a.data[0].variantId+"_"+a.data[0].value.split(",")[i];C.VALID_CONFIGURATION_ID=this.getBindingContext().getProperty("VALID_ID")+"."+a.data[0].value.split(",")[i];C.EVALUATION_ID=this.getBindingContext().getProperty("OLD_ID");d.CONFIGURATIONS.push(C);m.newConfigurationObject.CONFIGURATIONS.push(jQuery.extend({},C));}}m.dialogModel.setData(d);s.open();}else{m.dialogModel.setData(d);b=0;s.setTitle(t.oI18nModel.getResourceBundle().getText("CONFIGURED_DD",b));s.open();}},layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8",indent:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true}),})]});var y=new sap.m.CustomListItem({content:w,});var z=new sap.m.CustomListItem({content:u,});n.setModel(this.newEvaluationsModel);n.bindItems({path:"/EVALUATIONS",sorter:new sap.ui.model.Sorter({path:'INDICATOR',descending:false,group:true}),template:y});o.setModel(m.oldModel);o.bindItems({path:"/ActiveEvaluations",filters:[F],sorter:new sap.ui.model.Sorter({path:'objectId',descending:false,group:true}),template:z});this.prepareTempDataForNewList();},prepareTempDataForNewList:function(){var n={};n.EVALUATIONS=[];var t=this;var m=this;m.objectToPush={};m.objectToPush.INDICATORS=[];m.objectToPush.INDICATOR_TEXTS=[];m.objectToPush.EVALUATIONS=[];m.objectToPush.EVALUATION_TEXTS=[];m.objectToPush.EVALUATION_FILTERS=[];m.objectToPush.EVALUATION_VALUES=[];m.objectToPush.TAGS=[];var K=[];var a=[];var b=0;var E=[];var V=[];var c={};var d={};var e={};var f="";var g="";var h="";for(var i=0;i<m.selectedKPIs.length;i++){if(i<(m.selectedKPIs.length-1)){f+="id eq '"+m.selectedKPIs[i]+"' or ";g+="objectId eq '"+m.selectedKPIs[i]+"' or ";}else{f+="id eq '"+m.selectedKPIs[i]+"'";g+="objectId eq '"+m.selectedKPIs[i]+"'";}}c=m.serviceCallDataValidation("/ActiveKPIs",["$format=json","$filter=("+f+")"],m.oldModel);d=m.serviceCallDataValidation("/ActiveEvaluations",["$format=json","$filter=("+g+")"],m.oldModel);e=m.serviceCallDataValidation("/ActiveKPIsTexts",["$format=json","$filter=("+f+")"],m.oldModel);if(c.success){K=c.data;}if(d.success){E=d.data;}if(e.success){a=e.data;}if(K.length>0&&a.length>0){for(var i=0;i<a.length;i++){m.objectToPush.INDICATOR_TEXTS.push(m.migrateIndicatorTexts(a[i]));}}if(K.length>0){for(var i=0;i<K.length;i++){var l=[];m.objectToPush.INDICATORS.push(m.migrateIndicator(K[i]));l=m.migrateTags(K[i]);if(l.length>0){for(var k=0;k<l.length;k++){m.objectToPush.TAGS.push(l[k]);}}if(E.length>0){for(var j=0;j<E.length;j++){if(K[i].id==E[j].objectId){n.EVALUATIONS.push(m.migrateTempEvaluation(K[i],E[j]));}}}}}this.newEvaluationsModel.setData(n);m.hideBusy();if(n.EVALUATIONS.length==0){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_NO_EVALUATIONS"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK]);}},prepareMigrationData:function(){var m=this;var t=this;var n=this.newEvaluationsModel.getData();var a=m.newConfigurationObject.CONFIGURATIONS;if(m.objectToPush.EVALUATIONS.length>0)m.objectToPush.EVALUATIONS=[];m.objectToPush.EVALUATION_TEXTS=[];m.objectToPush.EVALUATION_FILTERS=[];m.objectToPush.EVALUATION_VALUES=[];m.objectToPush.DDA_MASTER=[];m.objectToPush.DDA_CONFIG=[];m.objectToPush.DDA_FILTERS=[];m.objectToPush.DDA_HEADER=[];m.objectToPush.DDA_CHART=[];m.objectToPush.DDA_COLUMNS=[];m.objectToPush.DDA_MASTER_TEXT=[];var K=[];var b=0;var E=[];var c;var V=[];var d={};var e={};var f={};var g={};var D={};var v={};var h={};var l="";var o="";var p="";var r="";var u="";var w="";var x="";for(var i=0;i<m.selectedKPIs.length;i++){if(i<(m.selectedKPIs.length-1)){l+="id eq '"+m.selectedKPIs[i]+"' or ";o+="objectId eq '"+m.selectedKPIs[i]+"' or ";}else{l+="id eq '"+m.selectedKPIs[i]+"'";o+="objectId eq '"+m.selectedKPIs[i]+"'";}}d=m.serviceCallDataValidation("/ActiveKPIs",["$format=json","$filter=("+l+")"],m.oldModel);e=m.serviceCallDataValidation("/ActiveEvaluations",["$format=json","$filter=("+o+")"],m.oldModel);f=m.serviceCallDataValidation("/ActiveEvaluationsTexts",["$format=json","$filter=("+o+")"],m.oldModel);if(d.success){K=d.data;}if(e.success){E=e.data;}if(f.success){c=f.data;}if(c&&E){if(c.length>0&&E.length>0){for(var i=0;i<c.length;i++){m.objectToPush.EVALUATION_TEXTS.push(m.migrateEvaluationTexts(c[i],n.EVALUATIONS));}}}if(K.length>0&&E.length>0){for(var i=0;i<K.length;i++){for(var j=0;j<E.length;j++){if(K[i].id==E[j].objectId){var y=[];m.objectToPush.EVALUATIONS.push(m.migrateEvaluation(K[i],E[j],n.EVALUATIONS));y=m.migrateEvaluationValues(K[i],E[j],n.EVALUATIONS);for(var k=0;k<y.length;k++){m.objectToPush.EVALUATION_VALUES.push(y[k]);}}}}for(var j=0;j<E.length;j++){r="id eq '"+E[j].variantId+"'";g=m.serviceCallDataValidation("/VARIANT_VALUES",["$format=json","$filter=("+r+")"],m.oldModelVariants);if(g.success){var A=[];A=m.migrateEvaluationFilters(E[j],g.data,n.EVALUATIONS);for(var k=0;k<A.length;k++){m.objectToPush.EVALUATION_FILTERS.push(A[k]);}}}var B="";for(var j=0;j<E.length;j++){var C=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=(objectId eq '"+E[j].objectId+"' and variantId eq '"+E[j].variantId+"' and property eq 'queryAnnotationDocURIs')"],m.oldModel);u="objectId eq '"+E[j].objectId+"' and variantId eq '"+E[j].variantId+"'";D=m.serviceCallDataValidation("/DDA_CONFIG_PROPERTIES",["$format=json","$filter=("+u+")"],m.oldModel);if(C.success&&D.success){var F={};var G=0;var H=0;var I="";var J;var L=C.data[0].variantId.split(' ').join('');var M="";if(L.indexOf('.')>-1){M=L.split('.');I=J||(C.data[0].objectId+"."+M[M.length-1]);}else{I=J||(C.data[0].objectId+"."+L);}B=C.data[0].value.split(",").length;for(var s=0;s<B;s++){H=0;G=0;for(var z=0;z<a.length;z++){if(a[z].CONFIGURATION_NAME==C.data[0].value.split(",")[s]){G++;break;}}if(G==0){F={};F.CONFIGURATION_ID=I+"."+C.data[0].value.split(",")[s];F.CONFIGURATION_NAME=C.data[0].value.split(",")[s];for(var q=0;q<n.EVALUATIONS.length;q++){if((E[j].objectId+"~"+E[j].variantId)==n.EVALUATIONS[q].OLD_ID){H++;F.EVALUATION_ID=n.EVALUATIONS[q].OLD_ID;break;}}if(H==0){F.EVALUATION_ID=E[j].objectId+"~"+E[j].variantId;break}a.push(jQuery.extend({},F));}}w="";for(var k=0;k<B;k++){if(k<(B-1)){w+="queryViewAnnotationDocumentURI eq '"+C.data[0].value.split(",")[k]+"' or ";}else{w+="queryViewAnnotationDocumentURI eq '"+C.data[0].value.split(",")[k]+"'";}}if(j==0||x=="")x=w;else x+=" or "+w;if(w.length>0){v=m.serviceCallDataValidation("/QUERYVIEWANNOTATION",["$format=json","$expand=QUERY_VIEW_PROPERTIES&$filter=("+w+")"],m.oldModelDDA);if(v.success)m.migrateDDA(D.data,v.data,n.EVALUATIONS,a);}}}if(x.length>0){h=m.serviceCallDataValidation("/QUERYVIEWANNOTATIONTEXTS",["$format=json","$filter=("+x+")"],m.oldModelDDA);var N=[];if(h.success){N=m.migrateDDAText(h.data,a,n.EVALUATIONS);for(var k=0;k<N.length;k++){m.objectToPush.DDA_MASTER_TEXT.push(N[k]);}}}}},migrateIndicator:function(K,m){m=m||1;var I={};I.ID=K.id;I.IS_ACTIVE=m;I.TYPE="KPI";I.TITLE=K.text;I.DESCRIPTION=K.description||"";if(Number(K.improvementDirection)==0){I.GOAL_TYPE="RA";}else if(Number(K.improvementDirection)==1){I.GOAL_TYPE="MA";}else{I.GOAL_TYPE="MI";}I.DATA_SPECIFICATION="";I.ODATA_URL=K.queryServiceURI;I.ODATA_ENTITYSET=K.queryQualifiedResultEntitySetName;I.VIEW_NAME="";I.COLUMN_NAME=K.queryResultMeasurePropertyName;I.OWNER_NAME=K.owner||"";I.OWNER_ID="";I.ENTITY_TYPE="";I.OWNER_E_MAIL="";I.ODATA_PROPERTY="";I.SEMANTIC_OBJECT=K.semanticObject;I.ACTION=K.semanticObjectAlias;return I;},migrateIndicatorTexts:function(K){var I={};I.ID=K.id;I.IS_ACTIVE=1;I.LANGUAGE=K.sapLanguageKey;I.TITLE=K.text;I.DESCRIPTION=K.description||"";return I;},migrateTags:function(K,m,t){m=m||1;t=t||"IN";var T=[];var a={};if(K.tags){if(K.tags.length>0){var b=K.tags.split(",");for(var i=0,l=b.length;i<l;i++){a.ID=K.id;a.IS_ACTIVE=m;a.TYPE=t;a.TAG=b[i];T.push(a);a={};}return T;}}return T;},migrateEvaluation:function(K,E,a,m){m=m||1;var b={};var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID;}var v="";var d=E.variantId.split(' ').join('');if(d.indexOf('.')>-1){v=d.split('.');b.ID=c||(E.objectId+"."+v[v.length-1]);}else{b.ID=c||(E.objectId+"."+d);}b.IS_ACTIVE=m;b.INDICATOR=E.objectId;b.INDICATOR_TYPE="KPI";b.TITLE=E.evaluationText;b.DESCRIPTION="";b.VIEW_NAME="";b.SCALING=E.scaleFactor;b.ODATA_URL=K.queryServiceURI;b.ODATA_ENTITYSET=K.queryQualifiedResultEntitySetName;b.COLUMN_NAME=K.queryResultMeasurePropertyName;b.OWNER_NAME=K.owner||"";b.OWNER_ID="";b.OWNER_E_MAIL="";b.ENTITY_TYPE="";if(Number(K.improvementDirection)==0){b.GOAL_TYPE="RA";}else if(Number(K.improvementDirection)==1){b.GOAL_TYPE="MA";}else{b.GOAL_TYPE="MI";}b.DATA_SPECIFICATION="";b.ODATA_PROPERTY="";b.SEMANTIC_OBJECT=K.semanticObject;b.ACTION=K.semanticObjectAlias;b.VALUES_SOURCE="FIXED";return b;},migrateEvaluationTexts:function(E,a){var b;var c={};for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID){b=a[i].ID;break;}}var v="";var d=E.variantId.split(' ').join('');if(d.indexOf('.')>-1){v=d.split('.');c.ID=b||(E.objectId+"."+v[v.length-1]);}else{c.ID=b||(E.objectId+"."+d);}c.IS_ACTIVE=1;c.LANGUAGE=E.sapLanguageKey;c.TITLE=E.evaluationText;c.DESCRIPTION="";return c;},migrateTempEvaluation:function(K,E,m){m=m||1;var a={};var v="";var b=E.variantId.split(' ').join('');if(b.indexOf('.')>-1){v=b.split('.');a.ID=E.objectId+"."+v[v.length-1];a.VALID_ID=E.objectId+"."+v[v.length-1];}else{a.ID=E.objectId+"."+b;a.VALID_ID=E.objectId+"."+b;}a.OLD_ID=E.objectId+"~"+E.variantId;a.VARIANT_ID=b;a.INDICATOR=E.objectId;a.TITLE=E.evaluationText;return a;},migrateEvaluationValues:function(K,E,a,m){m=m||1;var b=[];var e={};var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID;}var d="";var v="";var f=E.variantId.split(' ').join('');if(f.indexOf('.')>-1){v=f.split('.');d=c||(E.objectId+"."+v[v.length-1]);}else{d=c||(E.objectId+"."+f);}var g=0;if((E.toleranceRangeHighValue==0)||E.toleranceRangeHighValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="WH";e.FIXED=E.toleranceRangeHighValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={};}if((E.deviationRangeHighValue==0)||E.deviationRangeHighValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="CH";e.FIXED=E.deviationRangeHighValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={};}if((E.toleranceRangeLowValue==0)||E.toleranceRangeLowValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="WL";e.FIXED=E.toleranceRangeLowValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={};}if((E.deviationRangeLowValue==0)||E.deviationRangeLowValue){e.ID=d;e.IS_ACTIVE=m;e.TYPE="CL";e.FIXED=E.deviationRangeLowValue;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={};}if((E.target==0)||E.target){e.ID=d;e.IS_ACTIVE=m;e.TYPE="TA";e.FIXED=E.target;e.COLUMN_NAME="";e.ODATA_PROPERTY="";b.push(e);e={};}return b;},migrateEvaluationFilters:function(E,V,a,m){m=m||1;var b=[];var c;for(var i=0;i<a.length;i++){if((E.objectId+"~"+E.variantId)==a[i].OLD_ID)c=a[i].ID;}var d="";var v="";var e=E.variantId.split(' ').join('');if(e.indexOf('.')>-1){v=e.split('.');d=c||(E.objectId+"."+v[v.length-1]);}else{d=c||(E.objectId+"."+e);}var f={};for(var i=0,l=V.length;i<l;i++){f.ID=d;f.IS_ACTIVE=m;f.NAME=V[i].filterPropertyName;f.VALUE_1=V[i].value;f.VALUE_2=V[i].valueTo||"";f.OPERATOR=V[i].comparator;if(V[i].type=="F")f.TYPE="FI";if(V[i].type=="I")f.TYPE="PA";b.push(f);f={};}return b;},migrateDDAText:function(C,a,E){var m=this;var D=[];var b={};var c=[];var d=[];for(var j=0;j<C.length;j++){for(var i=0;i<a.length;i++){if(C[j].queryViewAnnotationDocumentURI==a[i].CONFIGURATION_NAME){c[j]=a[i].CONFIGURATION_ID;for(var k=0;k<E.length;k++){if(a[i].EVALUATION_ID==E[k].OLD_ID){d[j]=E[k].ID;break;}}}}}for(var i=0;i<C.length;i++){b={};b.CONFIGURATION_ID=c[i];b.EVALUATION_ID=d[i];b.SAP_LANGUAGE_KEY=C[i].sapLanguageKey;b.TEXT=C[i].title;b.IS_ACTIVE=1;D.push(b);}return D;},migrateDDAText:function(C,a,E){var m=this;var D=[];var b={};var c=[];var d=[];for(var j=0;j<C.length;j++){for(var i=0;i<a.length;i++){if(C[j].queryViewAnnotationDocumentURI==a[i].CONFIGURATION_NAME){c[j]=a[i].CONFIGURATION_ID;for(var k=0;k<E.length;k++){if(a[i].EVALUATION_ID==E[k].OLD_ID){d[j]=E[k].ID;break;}}}}}for(var i=0;i<C.length;i++){b={};b.CONFIGURATION_ID=c[i];b.EVALUATION_ID=d[i];b.SAP_LANGUAGE_KEY=C[i].sapLanguageKey;b.TEXT=C[i].title;b.IS_ACTIVE=1;D.push(b);}return D;},migrateDDA:function(D,Q,E,C){var a=this;var d={};var q=[];var b={};var c;for(var i=0;i<E.length;i++){if((D[0].objectId+"~"+D[0].variantId)==E[i].OLD_ID)c=E[i].ID;}var e="";var v="";var f=D[0].variantId.split(' ').join('');if(f.indexOf('.')>-1){v=f.split('.');e=c||(D[0].objectId+"."+v[v.length-1]);}else{e=c||(D[0].objectId+"."+f);}for(var i=0,l=Q.length;i<l;i++){b=Q[i];var g=0;for(var j=0,m=Q[i].QUERY_VIEW_PROPERTIES.length;j<m;j++){b[Q[i].QUERY_VIEW_PROPERTIES[j]["property"]]=Q[i].QUERY_VIEW_PROPERTIES[j]["value"];}if(q.length==0)q.push(jQuery.extend({},b));else{for(var k=0;k<q.length;k++){if(b.queryViewAnnotationDocumentURI==q[k].queryViewAnnotationDocumentURI)g++;}if(g==0)q.push(jQuery.extend({},b));}delete b.QUERY_VIEW_PROPERTIES;}for(var i=0,l=D.length;i<l;i++){if(D[i].property=='queryAnnotationDocURIs'){d.queryAnnotationDocURIs=D[i].value.split(",");}else if(D[i].property=='filters'){d.filters=D[i].value.split(",");}else{d[D[i].property]=D[i].value;}}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";if(d.filters){for(j=0,m=d.filters.length;j<m;j++){h.DIMENSION=d.filters[j];h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_FILTERS.push(jQuery.extend({},h));}}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";h.REFERENCE_EVALUATION_ID=h.EVALUATION_ID;h.VISUALIZATION_TYPE='NT';h.VISUALIZATION_ORDER=1;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h.VISUALIZATION_TYPE='AT';h.VISUALIZATION_ORDER=2;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h.VISUALIZATION_TYPE='TT';h.VISUALIZATION_ORDER=3;h.VISIBILITY=1;h.DIMENSION=null;h.IS_ACTIVE=1;a.objectToPush.DDA_HEADER.push(jQuery.extend({},h));h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID="NIL";h.PROPERTY_TYPE='SAP_FILTER';h.PROPERTY_VALUE='';h.VISIBILITY=d.isFilter||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='SAP_AGGREGATE_VALUE';h.PROPERTY_VALUE='';h.VISIBILITY=d.aggregateNumberEnabled||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='SAP_HEADER';h.PROPERTY_VALUE='';h.VISIBILITY=d.isTarget||0;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='QUERY_SERVICE_URI';h.PROPERTY_VALUE=Q[0].queryServiceURI;h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));h.PROPERTY_TYPE='QUERY_ENTITY_SET';h.PROPERTY_VALUE=Q[0].queryQualifiedResultEntitySetName;h.VISIBILITY=1;h.IS_ACTIVE=1;a.objectToPush.DDA_CONFIG.push(jQuery.extend({},h));for(var i=0,l=d.queryAnnotationDocURIs.length;i<l;i++){var h={};var n;for(var k=0;k<C.length;k++){if(d.queryAnnotationDocURIs[i]==C[k].CONFIGURATION_NAME)n=C[k].CONFIGURATION_ID;}h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);h.TEXT=q[i].title;h.CONFIG_ORDER=i+1;h.IS_ACTIVE=1;a.objectToPush.DDA_MASTER.push(jQuery.extend({},h));h={};var o=1;h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);var p=q[i].measurePropertyNames.split(",");var r=q[i].dimensionPropertyNames.split(",");var s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="dimensionPropertySortNames"});var t=s.length?s[0].value:null;var u=t?t.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="measurePropertySortNames"});var w=s.length?s[0].value:null;var y=w?w.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="colorNames"});var z=s.length?s[0].value:null;var A=z?z.split(","):null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="colorType"});var B=s.length?s[0].value:null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="semanticColorMeasure"});var F=s.length?s[0].value:null;s=q[i].QUERY_VIEW_PROPERTIES.results.filter(function(x){return x["property"]=="hiddenMeasureNames"});var G=s.length?s[0].value:null;var H=G?G.split(","):null;for(var j=0,m=r.length;j<m;j++){h.NAME=r[j];h.TYPE='DIMENSION';if(u!=null){if(u.length){h.SORT_BY=(u&&u[j])?u[j]:r[j];}else h.SORT_BY=r[j];}else h.SORT_BY=r[j];h.AXIS=1;h.STACKING=0;h.VISIBILITY="BOTH";h.COLOR=null;switch(Number(q[i].orderBy)){case 1:h.SORT_ORDER=null;break;case 2:h.SORT_ORDER=null;break;case 3:h.SORT_ORDER='asc';break;case 4:h.SORT_ORDER='desc';break;case 0:h.SORT_ORDER=null;break;}h.COLUMNS_ORDER=o++;h.IS_ACTIVE=1;a.objectToPush.DDA_COLUMNS.push(jQuery.extend({},h));}for(var j=0,m=p.length;j<m;j++){h.NAME=p[j];h.TYPE='MEASURE';h.VISIBILITY="BOTH";if(y!=null){if(y.length){h.SORT_BY=(y&&y[j])?y[j]:p[j];}else h.SORT_BY=p[j];}else h.SORT_BY=p[j];if(q[i].chartType&&(jQuery.sap.startsWithIgnoreCase(q[i].chartType,"dual"))&&(j<2)){h.AXIS=j+1;}else{h.AXIS=1;}h.STACKING=0;h.COLOR=null;switch(Number(q[i].orderBy)){case 1:h.SORT_ORDER='asc';break;case 2:h.SORT_ORDER='desc';break;case 3:h.SORT_ORDER=null;break;case 4:h.SORT_ORDER=null;break;case 0:h.SORT_ORDER=null;break;}h.COLUMNS_ORDER=o++;h.IS_ACTIVE=1;if(q[i].chartType&&(q[i].chartType.indexOf("Stacked")>-1)){h.STACKING=1;}if(H!=null){if(H&&(H.indexOf(p[j])>-1)){h.VISIBILITY="CHART";}}if(B==0||B==2){if(A!=null)h.COLOR=(A&&A[j])?A[j]:"";else h.COLOR="";}else if(q[i].colorType==1){}a.objectToPush.DDA_COLUMNS.push(jQuery.extend({},h));}h={};h.EVALUATION_ID=e;h.CONFIGURATION_ID=n||(e+"."+d.queryAnnotationDocURIs[i]);h.VALUE_TYPE='ABSOLUTE';h.AXIS_TYPE='SINGLE';h.DATA_LIMIT=q[i].top||null;switch(q[i].chartType){case null:h.CHART_TYPE='Table';break;case'Select Type':h.CHART_TYPE='Table';break;case'StackedColumn':h.CHART_TYPE='Column';break;case'Stacked Column':h.CHART_TYPE='Column';break;case'Transposed':h.CHART_TYPE='Column';break;case'DualStackedBar':h.CHART_TYPE='Bar';h.AXIS_TYPE='DUAL';break;case'StackedBar':h.CHART_TYPE='Bar';break;case'StackedColumn100':h.CHART_TYPE='Column';h.VALUE_TYPE='PERCENTAGE';break;case'DualStackedColumn':h.CHART_TYPE='Column';h.AXIS_TYPE='DUAL';break;case'DualStackedBar100':h.CHART_TYPE='Bar';h.VALUE_TYPE='PERCENTAGE';h.AXIS_TYPE='DUAL';break;case'DualStackedColumn100':h.CHART_TYPE='Column';h.VALUE_TYPE='PERCENTAGE';h.AXIS_TYPE='DUAL';break;default:h.CHART_TYPE=q[i].chartType;}switch(B){case undefined:h.COLOR_SCHEME='NONE';break;case null:h.COLOR_SCHEME='NONE';break;case 0:h.COLOR_SCHEME='MANUAL_NON_SEMANTIC';break;case 1:h.COLOR_SCHEME='AUTO_SEMANTIC';break;case 2:h.COLOR_SCHEME='MANUAL_SEMANTIC';break;default:h.COLOR_SCHEME='NONE';}h.THRESHOLD_MEASURE=F;h.IS_ACTIVE=1;a.objectToPush.DDA_CHART.push(jQuery.extend({},h));}},clearData:function(){this.getView().byId("oldList").removeAllItems();this.getView().byId("newList").removeAllItems();this.objectToPush.INDICATORS=[];this.objectToPush.INDICATOR_TEXTS=[];this.objectToPush.EVALUATIONS=[];this.objectToPush.EVALUATION_TEXTS=[];this.objectToPush.EVALUATION_FILTERS=[];this.objectToPush.EVALUATION_VALUES=[];this.objectToPush.TAGS=[];this.objectToPush.DDA_MASTER=[];this.objectToPush.DDA_CONFIG=[];this.objectToPush.DDA_FILTERS=[];this.objectToPush.DDA_HEADER=[];this.objectToPush.DDA_CHART=[];this.objectToPush.DDA_COLUMNS=[];this.objectToPush.DDA_MASTER_TEXT=[];},migrateData:function(){var m=this;if((this.objectToPush!=undefined)&&(this.objectToPush.INDICATORS.length>0)){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_BEGIN"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.showBusy("M");setTimeout(function(){m.writeData();},2500);});}else{sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_NO_KPI"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK]);}},cancel:function(){window.history.back();},writeData:function(){var m=this;this.errorMessage="";this.prepareMigrationData();var d=m.objectToPush;if(d){m.initiateRequests();}},initiateRequests:function(){var m=this;var u="/sap/hba/r/sb/core/logic/MIGRATION.xsjs";jQuery.ajax({url:"/sap/hba/r/sb/core/logic/__token.xsjs",async:false,type:"HEAD",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){jQuery.ajax({type:"POST",url:u,cache:false,data:encodeURIComponent(JSON.stringify(m.objectToPush)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token")},success:function(a){if(JSON.parse(a).success){sap.m.MessageBox.show(m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_SUCCESS"),sap.m.MessageBox.Icon.INFORMATION,m.oI18nModel.getResourceBundle().getText("INFORMATION_MSG_TITLE"),[sap.m.MessageBox.Action.OK],function(){m.cancel()});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_ERROR"),details:JSON.parse(a).errorMessage});}m.hideBusy();},async:true,error:function(X,t,e){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m.oI18nModel.getResourceBundle().getText("MSG_MIGRATION_ERROR"),details:e+"\n"+JSON.parse(X.responseText).errorMessage});m.hideBusy();}});},error:function(){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("ERR_FETCH_AUTH_TOKEN"));$.sap.log.error("ERR_FETCH_AUTH_TOKEN");}});},serviceCreate:function(e,p,O){var r={success:false,text:""};O.create(e,p,null,function(d){r.success=true;},function(a){var b=JSON.parse(a.response.body);r.success=false;r.text=a.response.statusText+" - "+b.error.message.value;});return r;},serviceDelete:function(e,i,O){var r={success:false,text:""};O.remove(e+"("+i+")",null,function(d){r.success=true;},function(a){r.success=false;r.text=a.response.statusText;},false,"",true);return r;},serviceCallDataValidation:function(e,p,d){var r={success:false,text:""};d.read(e,null,p,false,function(a,b){if(a.results[0]){r.success=true;r.data=a.results;}else{r.success=false;r.text="Record not found";}},function(a){r.success=false;r.text=a.response.statusText;});return r;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.AddTileModelS.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.AddTileModelS.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.AddTileModelS",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.LUMIRA_SEMANTIC_OBECT="LumiraAnalytics";this.LUMIRA_ACTION="openStory";this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="FioriApplication";this.apfAction="executeAPFConfiguration";this.APF_SEMANTIC_OBECT="FioriApplication";this.APF_ACTION="executeAPFConfiguration";this.sbAction="analyzeSBKPIDetails";this.busyDialog=new sap.m.BusyDialog();this.oRouter.attachRouteMatched(function(E){var t=this;if(E.getParameter("name")=="addTileModelS"){this.createMode=true;this.editMode=false;}else if(E.getParameter("name")=="editTileModelS"){this.createMode=false;this.editMode=true;}else{this.createMode=false;this.editMode=false;}if(this.createMode||this.editMode){this.cache={};this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.oDataModel=this.oApplicationFacade.getODataModel();this.PLATFORM=this.metadataRef.getPlatform();this.env=0;var c=new sap.ui.model.json.JSONModel();this.getView().setModel(c,"tileConfig");this.modelRef=this.getView().getModel("tileConfig");var i=this.getInitialModelData();this.getView().getModel("tileConfig").setData(i);function a(d){t.env=d;var j=t.getModelDataAfterEnv(t.env);t.getView().getModel("tileConfig").setData(j);};function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);};this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});this.oFactory=this.metadataRef.getUI2Factory();this.oPBService=this.metadataRef.getUI2PageBuildingService(this.oFactory);if(!(t.oApplicationFacade.currentLogonHanaUser)){var f=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var g=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);};this.metadataRef.getSessionUser({async:true,success:f,error:g,model:this.oApplicationFacade.getODataModel()});}this.busyDialog.open();var p=this.fetchChipData({evalContextPath:E.getParameter("arguments").contextPath,chipContextPath:E.getParameter("arguments").chipContextPath});if(E.getParameter("arguments").contextPath){this.context=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").contextPath);var h=(/ID=\'.*\'/).exec(E.getParameter("arguments").contextPath)[0];t.kpiId=h.slice(h.indexOf("'")+1,h.lastIndexOf("'"));}if(E.getParameter("arguments").chipContextPath){this.chipContext=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").chipContextPath);}this.appMode=E.getParameter("name");t.byId("tileTitle").setValueState("None");t.byId("tileSubtitle").setValueState("None");t.byId("allCatalogs").setValueState("None");t.byId("semanticObjectText").setValueState("None");t.byId("selectODD").setValueState("None");t.byId("appPropertyName").setValueState("None");t.byId("appPropertyValue").setValueState("None");}},this);try{if(sap.ui.core.Fragment.byId("tiles","compchart")){sap.ui.core.Fragment.byId("tiles","compchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","compchartmul")){sap.ui.core.Fragment.byId("tiles","compchartmul").destroy();}if(sap.ui.core.Fragment.byId("tiles","bulletchart")){sap.ui.core.Fragment.byId("tiles","bulletchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","areachart")){sap.ui.core.Fragment.byId("tiles","areachart").destroy();}}catch(e){};sap.ui.xmlfragment("tiles","sap.suite.ui.smartbusiness.designtime.visualization.view.tiles",this);},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveTile();}},buttonList:[]};return this.oHeaderFooterOptions;},getSelectedRadioButton:function(e,c){var b=this.getView().getBindingContext();var d=this.modelRef.getData();if((e&&e.mParameters.selected)||c){this.confirmationType=(e)?e.getSource().data("drilldownType"):c;if(this.confirmationType==='GDD'){d.CHIP.navType="0";d.CONTROL=this.getControlObject(d);d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject;d.CHIP.semanticAction=this.sbAction;this.modelRef.setData(d);}else if(this.confirmationType==='ODD'){d.CHIP.navType=(Number(d.CHIP.navType))?d.CHIP.navType:"4";d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);this.selectNavType(null,d.CHIP.navType);}}},selectTileType:function(e){this.selectTile(e.getSource().getSelectedItem().getKey());},onTileSelect:function(e){if(this.createMode){this.selectTile(e.getSource().data("tileType"));}else{if(this.modelRef.getData().CHIP.tileType!=e.getSource().data("tileType"))sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("BLOCK_TILETYPE_CHANGE_FOR_EDIT"));}},selectTile:function(k){var d=this.modelRef.getData();d.CHIP.tileType=k;d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);if(k=="CM"){if(this.cache.inSufficientAdditionalMeasure&&!(this.cache.inSufficientAdditionalMeasureAlerted)){sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("INSUFFICIENT_ADDL_MEASURES"));this.cache.inSufficientAdditionalMeasureAlerted=true;}}this.getView().byId(d.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));},selectSortOrder:function(e){},selectNavType:function(e,k){var d=this.modelRef.getData();if(e){k=e.getSource().getSelectedKey();}d.CHIP.navType=k;d.CONTROL=this.getControlObject(d);switch(Number(k)){case 1:d.CHIP.semanticObject=this.lumiraSemanticObject;d.CHIP.semanticAction=this.lumiraAction;break;case 2:d.CHIP.semanticObject=this.apfSemanticObject;d.CHIP.semanticAction=this.apfAction;break;case 3:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;case 4:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;default:break;}this.modelRef.setData(d);},formChipConfiguration:function(){var t=this;var p={};var d=this.modelRef.getData();var a=d.CHIP;var c=null;var b={};var e={};p.id=a.id||"";this.currentChipId=p.id;p.isActive=1;p.catalogId=a.catalogId;p.title=a.title;p.description=a.description;if(a.tileType=="DT"){p.tileType=a.tileType+"-"+a.dualTileType;}else{p.tileType=a.tileType;}p.evaluationId=a.evaluationId;p.url=this.getChipUrl(p.tileType);if(a.changedOn){p.changedOn=a.changedOn;}e.id=a.id||"_____CHIPID__________CHIPID_____";e.instanceId=a.instanceId||"___CHIPINSTID______CHIPINSTID___";e.catalogId=a.catalogId;e.evaluationId=a.evaluationId;if(a.tileType=="DT"){e.tileType=a.tileType+"-"+a.dualTileType;}else{e.tileType=a.tileType;}if(a.tileType=='CT'||(a.tileType=='DT'&&a.dualTileType=='CT')){e.dimension=a.dimension;e.sortOrder=a.sortOrder;e.semanticColorContribution=a.semanticColorContribution;}if(a.tileType=='TT'){e.dimension=a.dimension;}var f=d.EVALUATION;if(a.tileType=='NT'||a.tileType=='TT'||a.tileType=='CT'||a.tileType=='AT'||a.tileType=='CM'){e.frameType='OneByOne';}else{e.frameType='TwoByOne';}e.navType=a.navType;if(e.navType=="0"){e.semanticObject=(a.semanticObject&&(a.semanticObject.length!=(a.semanticObject.split(" ").length-1)))?a.semanticObject:f.COLUMN_NAME;e.semanticAction=this.sbAction;}else if(e.navType=="1"){e.storyId=a.storyId;e.semanticObject=a.semanticObject||this.lumiraSemanticObject||this.LUMIRA_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.lumiraAction||this.LUMIRA_ACTION;}else if(e.navType=="2"){e.semanticObject=a.semanticObject||this.apfSemanticObject||this.APF_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.apfAction||this.APF_ACTION;}else{e.semanticObject=a.semanticObject;e.semanticAction=a.semanticAction;}if(a.navLikeTId){e.navLikeTId=a.navLikeTId;}if(a.navLikeTCId){e.navLikeTCId=a.navLikeTCId;}e.sb_metadata="abap";e.sb_navigation="abap";e.sb_catalog="abap";if(a.tileType=='CM'||(a.tileType=='DT'&&a.dualTileType=='CM')){e.COLUMN_NAMES=[];var g=a.MULTI_MEASURE;var h=[];for(var i=0,l=g.length;i<l;i++){if(g[i].COLUMN_NAME){e.COLUMN_NAMES.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});h.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});}else{h.push({COLUMN_NAME:null,semanticColor:null});}}}b.ADDITIONAL_APP_PARAMETERS={};var j=d.CHIP.APP_PARAMETERS;if(j&&j.length){for(var i=0,l=j.length;i<l;i++){b.ADDITIONAL_APP_PARAMETERS[j[i].NAME]=j[i].VALUE;}}b.ADDITIONAL_APP_PARAMETERS=Object.keys(b.ADDITIONAL_APP_PARAMETERS).length?JSON.stringify(b.ADDITIONAL_APP_PARAMETERS):JSON.stringify({});b.TILE_PROPERTIES=JSON.stringify(e);b.EVALUATION_FILTERS=d.FILTERS.length?JSON.stringify(d.FILTERS):JSON.stringify([]);b.EVALUATION_VALUES=d.VALUES.length?JSON.stringify(d.VALUES):JSON.stringify([]);b.TAGS=d.TAGS?JSON.stringify(Object.keys(d.TAGS)):JSON.stringify([]);var k={};k.ID=f.ID;k.INDICATOR=f.INDICATOR;k.INDICATOR_TYPE=f.INDICATOR_TYPE;k.INDICATOR_TITLE=f.INDICATOR_TITLE;k.GOAL_TYPE=f.GOAL_TYPE;k.TITLE=f.TITLE;k.SCALING=f.SCALING;k.ODATA_URL=f.ODATA_URL;k.ODATA_ENTITYSET=f.ODATA_ENTITYSET;k.VIEW_NAME=f.VIEW_NAME;k.COLUMN_NAME=f.COLUMN_NAME;k.OWNER_NAME=f.OWNER_NAME;k.VALUES_SOURCE=f.VALUES_SOURCE;b.EVALUATION=k?JSON.stringify(k):JSON.stringify({});var m=Date.now().toString();c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"1",timeStamp:m});var n=4050;if(p.id){n=4096;}if(c.length>n){b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:m});if(c.length>n){b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:m});if(c.length>n){b.EVALUATION_VALUES=JSON.stringify([]);b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:m});}}}p.configuration=c;var s=p;return s;},publishChip:function(p){var s=true;var t=this;delete p.navType;delete p.semanticObject;delete p.action;this.chipTextPayload=[];var b=[];this.deleteBatch=[];this.createBatch=[];var a=true;var d=this.oApplicationFacade.getODataModel();if(this.createMode){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});var e=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");e.create('CHIPS',p,null,function(j){s=true;t.currentChipId=JSON.parse(j).response[0].id;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(j){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),j.responseText);});}else if(this.editMode){if(this.currentContextState){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({id:p.id,isActive:p.isActive,CHIP:p,TEXTS:t.chipTextPayload});}else{var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.initialData.ADDITIONAL_LANGUAGE_ARRAY.length;i++){var g={};g.id=p.id;g.language=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].language;g.isActive=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].isActive;g.description=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].description;g.title=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].title;t.languagePayloadForDirtyBitTest.push(g);}var l=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var h={remove:[],create:[]};if(l){if(l.deletes.length){for(var i=0;i<l.deletes.length;i++){h.remove.push(l.deletes[i]);}}if(l.updates.length){for(var i=0;i<l.updates.length;i++){t.createBatch.push(d.createBatchOperation("/CHIP_TEXTS","POST",l.updates[i]));h.create.push(l.updates[i]);}}}f.push({id:p.id,isActive:p.isActive,CHIP:{update:p},TEXTS:h});sap.suite.ui.smartbusiness.lib.Util.utils.update(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("CHIP_SERVICE_URI"),f,null,function(j){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(j){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),j.responseText);});}}return s;},getChipUrl:function(t){var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcomparison/ComparisonTileChip.xml","DT-CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDualContribution/DualContributionChip.xml","DT-CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDualComparison/DualComparisonChip.xml","DT-AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDualDeviation/DualDeviationChip.xml"};return c[t];},populateDimension:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var a=[],b=[],o={};var i;a=sap.suite.ui.smartbusiness.lib.Util.odata.dimensions(d,e).getAsStringArray();for(i=0;i<a.length;i++){o={};o.dimensionName=a[i];b.push(o);}var m=new sap.ui.model.json.JSONModel();m.setData({dimensions:b});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},handleDimensionSelectionChange:function(e){},setGenericDrillDown:function(n){return(n==0)?true:false;},setOtherDrillDown:function(n){return(n>0)?true:false;},addNewProperty:function(){var t=this;if(this.getView().byId("appPropertyName").getValue()){this.getView().byId("appPropertyName").setValueState("None");if(this.getView().byId("appPropertyValue").getValue()){this.getView().byId("appPropertyValue").setValueState("None");var p=this.modelRef.getData().CHIP.APP_PARAMETERS;p=p||[];if(this.checkForDuplicateProperty()){p.push({NAME:this.getView().byId("appPropertyName").getValue(),VALUE:this.getView().byId("appPropertyValue").getValue()});this.getView().byId("appPropertyName").setValue("");this.getView().byId("appPropertyValue").setValue("");var d=this.modelRef.getData();d.CHIP.APP_PARAMETERS=p;this.modelRef.setData(d);}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyValue").setValueState("Error");this.getView().byId("appPropertyValue").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));}},removeProperty:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();e.getSource().getBindingContext("tileConfig").getModel().getData().CHIP.APP_PARAMETERS.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("tileConfig").getModel().updateBindings();},getAllFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_DRAFT"),onBtnPressed:function(e){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){sap.suite.ui.smartbusiness.lib.Util.utils.remove(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("CHIP_SERVICE_URI"),{id:t.currentChipId,isActive:t.currentContextState},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body);});}if(e=="CANCEL"){}});},},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){function s(){t.refreshMasterList();var h=hasher||window.hasher;var c=hasher.getHash();sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPITile"});setTimeout(function(){sap.suite.ui.smartbusiness.lib.Util.utils.hashChange({hash:c});},0);}t.saveTile(s);}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel();}}];return b;},updateFooterButtons:function(c){var b=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(c&&c.CHIP){if((!(c.CHIP.isActive))&&(this.editMode)){this.oHeaderFooterOptions.buttonList.push(b[0]);}}for(var i=1,l=b.length;i<l;i++){if(i==2){if(c.CHIP&&(c.CHIP.isActive==1)){this.oHeaderFooterOptions.buttonList.push(b[i]);}}else{this.oHeaderFooterOptions.buttonList.push(b[i]);}}this.setHeaderFooterOptions(this.oHeaderFooterOptions);},checkForDuplicateProperty:function(){var t=this;var p=this.modelRef.getData().CHIP.APP_PARAMETERS;var a=this.getView().byId("appPropertyName").getValue();var v=this.getView().byId("appPropertyValue").getValue();if(!isNaN(Number(a))){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));return false;}for(var i=0,l=p.length;i<l;i++){if((p[i].NAME==a)){if(p[i].NAME==a){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));}return false;}}return true;},inputNameChange:function(e){var t=this;var p=e.getSource().getValue();var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));return;}}e.getSource().setValueState("None");},inputValueChange:function(e){var t=this;var v=e.getSource().getValue();var p=e.getSource().getBindingContext("tileConfig").getObject().NAME;var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p&&b[i].VALUE==v){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));}}},onAfterRendering:function(){var t=this;},handleSemanticObjectChange:function(e){this.tempSemanticObject=e.getSource().getValue();if(e.getSource().getValue()){e.getSource().setValueState("None");}if(this.tempSemanticObject.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="0"||this.modelRef.getData().CHIP.navType.toString()=="4"){this.onLoadSemanticObject=e.getSource().getValue();}},setSemanticAction:function(e){this.tempAction=e.getSource().getValue();if(e.getSource().getValue()){e.getSource().setValueState("None");}if(this.tempAction.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfAction=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraAction=e.getSource().getValue();}},subTitleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},titleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyNameChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyValueChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},setStoryId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}if(e.getSource().getValue().indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}},handleStoryIdValueHelp:function(){var t=this;var s=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("STORY_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/Stories",template:new sap.m.StandardListItem({title:"{NAME}",description:"{UUID}"})},confirm:function(e){t.modelRef.getData().CHIP.storyId=e.getParameter("selectedItem").getProperty("description");},liveChange:function(e){var a="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(NAME)",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("tolower(UUID)",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});s.open();var d=new sap.ui.model.odata.ODataModel("/sap/bi/launchpad/integration/smb.xsodata",true);s.setModel(d);if(this.evaluationObj.VIEW_NAME){s.getBinding("items").filter([new sap.ui.model.Filter("VIEW_NAME","EQ",this.evaluationObj.VIEW_NAME)]);}},handleCustomMeasure:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"tileConfig>/ADDITIONAL_MEASURES/Measures",template:new sap.m.StandardListItem({title:"{tileConfig>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v);},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});this.customMeasuresDialog.open();this.customMeasuresDialog.setModel(this.modelRef,"tileConfig");},addAdditionalLanguageDialog:function(){var t=this;var m=this.getView().getModel("tileConfig").getData();this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),}).setModel(t.getView().getModel("tileConfig"),"tileConfig");this.addedLanguagesList.bindItems("tileConfig>/ADDITIONAL_LANGUAGE_ARRAY",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{tileConfig>title}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>description}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>isoLanguage}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();var b=parseInt(p.substr(p.length-1));var n=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.splice(b,1);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("SUB_TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;i++){if(t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY[i].isoLanguage===t.languageKeySelect.getSelectedItem().getText()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"title":t.languageTextInput.getValue(),"description":t.languageDescriptionInput.getValue(),"isoLanguage":t.languageKeySelect.getSelectedItem().getText(),"language":t.languageKeySelect.getSelectedKey()};t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.push(b);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){a.close();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){var b=t.modelRef.getData();b.ADDITIONAL_LANGUAGE_ARRAY=o.ADDITIONAL_LANGUAGE_ARRAY;b.NO_OF_ADDITIONAL_LANGUAGES=o.NO_OF_ADDITIONAL_LANGUAGES;t.modelRef.setData(b);a.close();}})});var d=m.SAP_LANGUAGE_ARRAY;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}t.languageKeySelect.setModel(this.getView().getModel("tileConfig"),"tileConfig");t.languageKeySelect.bindItems("tileConfig>/SAP_LANGUAGE_ARRAY",new sap.ui.core.Item({text:"{tileConfig>LAISO}",key:"{tileConfig>SPRAS}"}));a.open();var o=jQuery.extend(true,{},this.modelRef.getData(),{});},checkForValidChipForActivation:function(){var t=this;var d=t.modelRef.getData();var a=d.CHIP;var e="";var c=null;if(((!(a.semanticObject)||(a.semanticObject.length==(a.semanticObject.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT"));}if(a.semanticObject.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(((!(a.semanticAction)||(a.semanticAction.length==(a.semanticAction.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION"));}if(a.semanticAction.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(((!(a.storyId)||(a.storyId.length==(a.storyId.split(" ").length-1)))&&(Number(a.navType)==1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID"));}if(a.storyId.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}if(((!(a.apfConfId)||(a.apfConfId.length==(a.apfConfId.split(" ").length-1)))&&(Number(a.navType)==2))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID")+"\n";t.byId("apfConfId").setValueState("Error");t.byId("apfConfId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID"));}if(!(a.title)||(a.title.length==(a.title.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";t.byId("tileTitle").setValueState("Error");t.byId("tileTitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE"));}if(!(a.description)||(a.description.length==(a.description.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION")+"\n";t.byId("tileSubtitle").setValueState("Error");t.byId("tileSubtitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION"));}if(!(a.catalogId)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_SELECT_CATALOG")+"\n";t.byId("allCatalogs").setValueState("Error");t.byId("allCatalogs").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_SELECT_CATALOG"));}if(a.tileType=="CM"&&!(e)){c=t.formChipConfiguration();var b=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).EVALUATION);var f=b.COLUMN_NAMES;if(!(f)||!(f.length)||(f.length<2)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")+"\n";}else{for(var i=0,l=f.length;i<l;i++){if(!(f[i].COLUMN_NAME)||!(f[i].semanticColor)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES")+"\n";break;}}if(!e){if(f.length==2){if(f[0].COLUMN_NAME==f[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")+"\n";}}else if(f.length==3){if(f[0].COLUMN_NAME==f[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")+"\n";}else if(f.COLUMN_NAME==f[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")+"\n";}else if(f[1].COLUMN_NAME==f[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES")+"\n";}}}}}return e;},saveTile:function(c){var t=this;var e="";var a=null;e=t.checkForValidChipForActivation();if(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),e);}else{t.isPropertyAdded=true;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}a=t.formChipConfiguration();function p(d){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));t.oApplicationFacade.__tileModified=true;if(c){c();}else{t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}};function b(d){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),(d.responseText||d.description||d.title||JSON.stringify(d)));};mode=t.createMode?"create":(t.editMode?"edit":"edit");t.busyDialog.open();t.metadataRef.publishChip(a,mode,t,p,b);}},handleBackAndCancel:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();},fetchChipData:function(o){var p='X-SAP-UI2-PAGE';var t=this;var f={};if(this.createMode){var e={};if(o.evalContextPath){var a=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.evalContextPath);e=this.metadataRef.getEvaluationById({context:a,texts:true,entity:"EVALUATIONS_MODELER",model:t.oApplicationFacade.getODataModel()});f=this.formModelByEvaluation(e);}}else if(this.editMode){var c={};var e={};if(o.chipContextPath){o.chipContextPath=o.chipContextPath.replace("id","ID");o.chipContextPath=o.chipContextPath.replace("isActive","IS_ACTIVE");var b=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.chipContextPath);var a=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.evalContextPath);e=this.metadataRef.getEvaluationById({context:a,entity:"EVALUATIONS_MODELER",model:t.oApplicationFacade.getODataModel()});c=this.metadataRef.getChipById({context:b,evaluation:false,texts:false,model:t.oApplicationFacade.getODataModel()});c.EVALUATION=e.EVALUATION;c.CHIP.id=c.CHIP.ID;c.CHIP.catalogId=c.CHIP.CATALOG_ID;c.CHIP.evaluationId=c.CHIP.EVALUATION_ID;c.CHIP.tileType=c.CHIP.TYPE;function d(g){var h=(g.Chips&&g.Chips.results)?g.Chips.results:[];var j={};var k=[];var m={};c.CHIP.title=m.title;c.CHIP.title='';for(var i=0,l=h.length;i<l;i++){if(h[i].catalogPageChipInstanceId==c.CHIP.id){m=h[i];if(h[i].ChipBags&&h[i].ChipBags.results&&h[i].ChipBags.results.length){j=h[i].ChipBags.results[0];if(j.ChipProperties&&j.ChipProperties.results&&j.ChipProperties.results.length){k=j.ChipProperties.results;for(var i=0,l=k.length;i<l;i++){if(k[i].name=="title"){c.CHIP.title=k[i].value;}if(k[i].name=="description"){c.CHIP.description=k[i].value;}}}}}}c.CHIP.catalogName=g.title;c.CHIP.url=m.url;c.CHIP.configuration=m.configuration;f=t.formModelByChip(c);t.currentContextState=f.CHIP.isActive;t.currentChipId=f.CHIP.id;t.fetchOtherInfoAsync(f);return f;};t.oPBService.readCatalog(c.CHIP.CATALOG_ID,d,null,false,false);return;}}else{f={CHIP:{}};}this.currentContextState=f.CHIP.isActive;this.currentChipId=f.CHIP.id;this.fetchOtherInfoAsync(f);return f;},formModelByEvaluation:function(e){var t=this;var o=e.EVALUATION;var c={CHIP:{}};c.CHIP.id="";c.CHIP.isActive=1;c.CHIP.evaluationId=o.ID;c.CHIP.tileType="NT";c.CHIP.dualTileType="CT";c.CHIP.title=o.INDICATOR_TITLE||"";c.CHIP.description=o.TITLE||"";c.CHIP.url=c.url||this.getChipUrl(c.tileType);c.CHIP.configuration="";c.CHIP.storyId="";c.CHIP.navType=(!(o.ACTION)||(o.ACTION==this.sbAction))?"0":"4";if(c.CHIP.navType=="0"){c.CHIP.semanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";c.CHIP.semanticAction=o.ACTION||this.sbAction;}else{c.CHIP.semanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";c.CHIP.semanticAction=o.ACTION||this.sbAction;}this.onLoadSemanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";this.onLoadSemanticAction=o.ACTION||this.sbAction;c.CHIP.appParameters=[];c.CHIP.dimension="";c.CHIP.sortOrder="0";c.CHIP.semanticColorContribution="Neutral";c.CHIP.frameType='OneByOne';c.CHIP.MULTI_MEASURE=[{COLUMN_NAME:o.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];c.CHIP.navLikeTId="";c.CHIP.navLikeTCId="";c.TEXTS=[];for(var i=0,l=e.TEXTS;i<l;i++){c.TEXTS[i].id="";c.TEXTS[i].title=e.TEXTS[i].TITLE;c.TEXTS[i].description=e.TEXTS[i].DESCRIPTION;c.TEXTS[i].language=e.TEXTS[i].LANGUAGE;}c.EVALUATION=o;return c;},formModelByChip:function(c){var t=this;var o=c.CHIP;var a={CHIP:{}};if(c.EVALUATION_INFO){a.EVALUATION=c.EVALUATION_INFO;}if(c.EVALUATION){a.EVALUATION=c.EVALUATION;}a.TEXTS=c.TEXTS;a.CHIP.id=o.id||"";a.CHIP.isActive=1;a.CHIP.evaluationId=o.evaluationId||"";a.CHIP.tileType=o.tileType||"NT";if(o.tileType=="DT-CT"){a.CHIP.dualTileType="CT";a.CHIP.tileType="DT";}else if(o.tileType=="DT-CM"){a.CHIP.dualTileType="CM";a.CHIP.tileType="DT";}else if(o.tileType=="DT-AT"){a.CHIP.dualTileType="AT";a.CHIP.tileType="DT";}if(o.catalogName){a.CHIP.catalogName=o.catalogName;}if(o.catalogId){a.CHIP.catalogId=o.catalogId;}a.CHIP.title=o.title||"";a.CHIP.description=o.description||"";a.CHIP.url=o.url||this.getChipUrl(a.tileType);a.CHIP.configuration=o.configuration||"";var b=null;var d=null;var f=null;var g=null;try{a.CHIP.configurationObj=JSON.parse(a.CHIP.configuration);if(a.CHIP.configurationObj&&a.CHIP.configurationObj.tileConfiguration){b=JSON.parse(a.CHIP.configurationObj.tileConfiguration);if(b&&b.TILE_PROPERTIES){d=JSON.parse(b.TILE_PROPERTIES);if(d){a.CHIP.navType=d.navType||"0";a.CHIP.frameType=d.frameType||'OneByOne';a.CHIP.semanticObject=d.semanticObject||"";a.CHIP.semanticAction=d.semanticAction||"";this.onLoadSemanticObject=a.CHIP.semanticObject||"";this.onLoadSemanticAction=a.CHIP.semanticAction||"";a.CHIP.storyId=d.storyId||"";a.CHIP.dimension=d.dimension||"";a.CHIP.sortOrder=d.sortOrder||"";a.CHIP.semanticColorContribution=d.semanticColorContribution||"Neutral";a.CHIP.navLikeTId=d.navLikeTId||"";a.CHIP.navLikeTCId=d.navLikeTCId||"";a.CHIP.navLikeTName=a.CHIP.navLikeTId?'-NA-'+a.CHIP.navLikeTId:"";}f=JSON.parse(b.ADDITIONAL_APP_PARAMETERS);a.CHIP.appParameters=f||[];g=JSON.parse(b.EVALUATION);if(g){a.CHIP.MULTI_MEASURE=d.COLUMN_NAMES||g.COLUMN_NAMES||[{COLUMN_NAME:a.EVALUATION.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];}}}}catch(e){jQuery.sap.log.error="Failed to parse chip";c.EVALUATION=c.EVALUATION_INFO;delete c.EVALUATION_INFO;a=t.formModelByEvaluation(c);a.CHIP.id=o.id;a.CHIP.isActive=o.isActive;this.errorConfigParse=true;}return a;},fetchOtherInfoAsync:function(o){var t=this;this.updateFooterButtons(o);o.CONTROL=this.getControlObject(o);try{this.oModelForEntity=this.populateDimension(o.EVALUATION.ODATA_URL,o.EVALUATION.ODATA_ENTITYSET);o.CHIP.dimension=o.CHIP.dimension||this.oModelForEntity.getData().dimensions[0].dimensionName;}catch(e){}finally{if(this.oModelForEntity&&this.oModelForEntity.getData()&&this.oModelForEntity.getData().dimensions&&this.oModelForEntity.getData().dimensions.length){o.DIMENSIONS=this.oModelForEntity.getData();}else{o.DIMENSIONS=[];sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"));}}var p=[];var a=o.CHIP.appParameters;if(a&&Object.keys(a).length){for(var k in a){if(a.hasOwnProperty(k)){p.push({NAME:k,VALUE:a[k]});}}}o.CHIP.APP_PARAMETERS=p;var b=function(c){var f={};o.TAGS={};if(c.TAGS){for(var i=0,l=c.TAGS.length;i<l;i++){o.TAGS[c.TAGS[i].TAG]=c.TAGS[i].TYPE;}}if(c.INDICATOR_TAGS){for(var i=0,l=c.INDICATOR_TAGS.length;i<l;i++){o.TAGS[c.INDICATOR_TAGS[i].TAG]="IN";}}o.FILTERS=[];if(c.FILTERS){for(var i=0,l=c.FILTERS.length;i<l;i++){f={};f.TYPE=c.FILTERS[i].TYPE;f.NAME=c.FILTERS[i].NAME;f.VALUE_1=c.FILTERS[i].VALUE_1;f.VALUE_2=c.FILTERS[i].VALUE_2;f.OPERATOR=c.FILTERS[i].OPERATOR;o.FILTERS.push(f);}}o.VALUES=[];var m={Measures:[]};m.Measures.push({COLUMN_NAME:"",COLUMN_TEXT:""});if(o.EVALUATION&&o.EVALUATION.COLUMN_NAME){m.Measures.push({COLUMN_NAME:o.EVALUATION.COLUMN_NAME,COLUMN_TEXT:o.EVALUATION.COLUMN_NAME});}if(c.VALUES){for(var i=0,l=c.VALUES.length;i<l;i++){f={};if(/^\d{2}/.test(c.VALUES[i].TYPE.toString())){m.Measures.push({COLUMN_NAME:c.VALUES[i].COLUMN_NAME,COLUMN_TEXT:c.VALUES[i].COLUMN_NAME});}else{f.TYPE=c.VALUES[i].TYPE;f.FIXED=c.VALUES[i].FIXED;f.COLUMN_NAME=c.VALUES[i].COLUMN_NAME;f.ODATA_PROPERTY=c.VALUES[i].ODATA_PROPERTY;o.VALUES.push(f);}}}if(m.Measures.length<3){t.cache.inSufficientAdditionalMeasure=true;}var g=jQuery.extend(true,{},m,{});if(g&&g.Measures&&g.Measures.length){g.Measures[0].COLUMN_TEXT="("+t.oApplicationFacade.getResourceBundle().getText("NONE")+")";}o.ADDITIONAL_MEASURES=m;o.ADDITIONAL_MEASURES_OPT=g;if(c.TEXTS){o.TEXTS=c.TEXTS;}t.getView().getModel("tileConfig").setData(o);t.busyDialog.close();if(!(t.env)){function h(d){var s=t.modelRef.getData();if(d.ChipBags&&d.ChipBags.results&&d.ChipBags.results.length){if(d.ChipBags.results[0]&&d.ChipBags.results[0].ChipProperties&&d.ChipBags.results[0].ChipProperties.results&&d.ChipBags.results[0].ChipProperties.results.length){var u=d.ChipBags.results[0].ChipProperties.results;for(var i=0,l=u.length;i<l;i++){if(u[i].name=="title"){s.CHIP.navLikeTName=u[i].value;t.getView().getModel("tileConfig").setData(s);}}}}};function j(d,s,x){};if(o.CHIP.navLikeTId&&o.CHIP.navLikeTCId){t.metadataRef.readChipFromUI2ById(o.CHIP.navLikeTCId,o.CHIP.navLikeTId,h,j);}function n(d){t.cache.sapCopiedEvaluation=(d&&d.length)?d[0].VALUE:"";jQuery.sap.log.info("SAP Copied Evaluation - "+t.cache.sapCopiedEvaluation);};function q(){};t.metadataRef.getDataByEntity({entity:"PROPERTIES",async:false,filter:"TYPE eq 'EV' and IS_ACTIVE eq 1 and ID eq '"+o.EVALUATION.ID+"' and NAME eq 'SAP:Copied_From'",success:n,error:q,model:t.oDataModel});}t.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(t.errorConfigParse){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_PARSE_CHIP_INFO"));}t.errorConfigParse=false;t.initialData=jQuery.extend(true,{},o,{});if(o.CHIP.tileType&&o.CHIP.tileType=="DT"){var r=t.getView().byId("selectTileType").getSelectedKey();t.getView().byId("selectVizRight").fireChange(r);}};t.metadataRef.getEvaluationById({ID:o.CHIP.evaluationId,IS_ACTIVE:1,async:true,success:b,noEvaluation:true,tags:true,indicator_tags:true,values:true,filters:true,entity:"EVALUATIONS_MODELER",model:t.oApplicationFacade.getODataModel()});return o;},selectVizRight:function(){var r;var d=this.modelRef.getData();d.CONTROL=d.CONTROL||{};var a=this.getView().byId("selectVizRight").getSelectedKey();if(a=="CT"){r=sap.ui.core.Fragment.byId("tiles","compchart");d.CONTROL.vDimension=true;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=true;d.CONTROL.vSemanticColorContribution=true;}else if(a=="CM"){r=sap.ui.core.Fragment.byId("tiles","compchartmul");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=true;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}else if(a=="AT"){r=sap.ui.core.Fragment.byId("tiles","bulletchart");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}this.getView().byId("DT").getTileContent()[1].setContent(r);this.modelRef.setData(d);},getControlObject:function(o){var c=o.CONTROL||{};this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('TT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('AT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CM').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('DT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(o&&o.CHIP&&o.CHIP.tileType){switch(o.CHIP.tileType){case'NT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'AT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=false;c.vVizRight=false;break;case'TT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CM':c.vDimension=false;c.vMultiMeasure=true;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'DT':c.vDimension=false;c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=true;c.vVizRight=true;default:break;}}if(o&&o.CHIP&&o.CHIP.navType){switch(o.CHIP.navType.toString()){case'0':c.vSemanticObject=true;c.vAction=true;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;break;case'1':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=true;c.vSelectNavType=true;break;case'2':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;break;case'3':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;break;case'4':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;break;default:break;}c.vSelectNavigationType=true;c.vAppParameter=true;}if(this.env){c.vNavigateLikeTile=false;}else{c.vNavigateLikeTile=true;c.vSemanticObject=false;c.vAction=false;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;c.vSelectNavigationType=false;c.vAppParameter=false;}if(this.createMode){c.eSelectTileType=true;c.eSelectCatalog=true;}else if(this.editMode){c.eSelectTileType=false;c.eSelectCatalog=false;}return c;},getSAPCopiedEvaluationChips:function(s,e){var t=this;function f(c){t.cache.sapCopiedEvaluationChipObj=c;if(s){s(t.cache.sapCopiedEvaluationChipObj);}}function a(){}if(t.cache.sapCopiedEvaluationChipObj){if(s){s(t.cache.sapCopiedEvaluationChipObj);}}else{if(!(t.cache.sapCopiedEvaluation)){if(s){s([]);}return;}t.metadataRef.getChipByEvaluation({ID:t.cache.sapCopiedEvaluation,IS_ACTIVE:1,success:f,error:a,model:t.oDataModel});}},getChipIdsForSAPEvaluation:function(s,e,p){var t=this;p=(p)?true:false;function f(c){t.cache.chipIdsForSAPEvaluation=c;if(s){s(t.cache.chipIdsForSAPEvaluation);}}function a(){}if(t.cache.chipIdsForSAPEvaluation){if(s){s(t.cache.chipIdsForSAPEvaluation);}}else{if(!(t.cache.sapCopiedEvaluation)){if(s){s([]);}return;}t.metadataRef.getChipByEvaluation({ID:t.cache.sapCopiedEvaluation,IS_ACTIVE:1,noEvaluation:true,success:f,error:a,partial:true,model:t.oDataModel});}},listAllCatalogs:function(e){var t=this;var c=new sap.ui.model.json.JSONModel();var f=undefined;t.catalogModel=c;t.catalogsObj={};function a(d){if(d){var g=d.results||d;var h=[];t.cache.allUI2Catalogs=t.cache.allUI2Catalogs||g;if(t.env){c.setData({Catalogs:t.cache.allUI2Catalogs});t.busyDialog.close();t.customMeasuresDialog.open();return;}else{if(!(t.oPBService.getReferencingCatalogIds)){t.cache.relevantCustCatalogs=t.cache.allUI2Catalogs;c.setData({Catalogs:t.cache.allUI2Catalogs});t.busyDialog.close();t.customMeasuresDialog.open();jQuery.sap.log.error("getReferencingCatalogIds API missing, showing all Catalogs");return;}if(t.cache.relevantCustCatalogs){t.catalogModel.setData({Catalogs:t.cache.relevantCustCatalogs});t.busyDialog.close();t.customMeasuresDialog.open();return;}if(!(t.cache.allUI2CatalogIds)){for(var i=0,l=g.length;i<l;i++){h.push(g[i].id);t.catalogsObj[g[i].id]=g[i].title;}t.cache.allUI2CatalogIds=h;}function k(o){var U='X-SAP-UI2-PAGE';var p=o.CHIPS;var q=(p)?(p.length-1):0;var r=null;var u={};var v=[];function w(d){if(d){d=(d.results)?d.results:d;for(var j=0,m=d.length;j<m;j++){if(!(u[d[j]])){u[d[j]]=true;v.push({id:d[j],title:t.catalogsObj[d[j]]});}}if(q==0){t.cache.relevantCustCatalogs=v;t.catalogModel.setData({Catalogs:v});t.busyDialog.close();t.customMeasuresDialog.open();}else{q--;}}}function y(d,s,x){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("REF_CATALOG_FETCH_ERROR"));}if(p&&p.length){for(var i=0,l=p.length;i<l;i++){r=U+":"+p[i].CATALOG_ID+":"+p[i].ID;t.oPBService.getReferencingCatalogIds(r,t.cache.allUI2CatalogIds,w,y);}}else{jQuery.sap.log.error("No tiles in the SAP shipped evaluation");t.cache.relevantCustCatalogs=v;t.catalogModel.setData({Catalogs:v});t.busyDialog.close();t.customMeasuresDialog.open();}};function n(j){t.catalogModel.setData({Catalogs:[]});t.customMeasuresDialog.open();t.busyDialog.close();};t.getChipIdsForSAPEvaluation(k,n);}}}function b(d){t.catalogModel.setData({Catalogs:[]});t.busyDialog.close();}this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_CATALOGUE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA"),items:{path:"/Catalogs",template:new sap.m.StandardListItem({title:{path:"title",formatter:t.formatCatalogTitle},description:{path:"id",formatter:jQuery.proxy(t.formatTileId,t)}})},confirm:function(E){var v=E.getParameter("selectedItem").getBindingContext().getObject().title;t.selectedCatalogId=E.getParameter("selectedItem").getBindingContext().getObject().id;var d=t.modelRef.getData();d.CHIP.catalogId=t.selectedCatalogId;d.CHIP.catalogName=v;t.modelRef.setData(d);t.byId("allCatalogs").setValueState("None");},liveChange:function(E){var s=""+E.getParameter("value").toLowerCase()+"";var F=new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("id",sap.ui.model.FilterOperator.Contains,s);var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([F,o],false));}});this.customMeasuresDialog.setModel(t.catalogModel);f="startswith(id,'X-SAP-UI2-CATALOGPAGE')";if(t.cache.allUI2Catalogs){a(t.cache.allUI2Catalogs);}else{t.busyDialog.open();t.metadataRef.readAllUI2Catalogs(a,b,f);}},listAllTilesForNavigation:function(){var t=this;var o={};t.navigateLikeTileModel=new sap.ui.model.json.JSONModel();this.navigateLikeTileDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_TILE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA"),items:{path:"/CHIPS",template:new sap.m.StandardListItem({title:{path:"title",formatter:t.formatNavLikeTileTitle},description:{path:"id",formatter:jQuery.proxy(t.formatTileId,t)}})},confirm:function(E){var d=t.modelRef.getData();var n=E.getParameter("selectedItem").getBindingContext().getObject().title;var b=E.getParameter("selectedItem").getBindingContext().getObject().id;var c=E.getParameter("selectedItem").getBindingContext().getObject().catalogId;var g=E.getParameter("selectedItem").getBindingContext().getObject().configuration;try{d.CHIP.navLikeTName=n;d.CHIP.navLikeTId=b;d.CHIP.navLikeTCId=c;g=JSON.parse(g);var h=JSON.parse(g.tileConfiguration);var i=JSON.parse(h.TILE_PROPERTIES);var j=JSON.parse(h.ADDITIONAL_APP_PARAMETERS);d.CHIP.navType=i.navType;d.CHIP.semanticObject=i.semanticObject;d.CHIP.semanticAction=i.semanticAction;if(i.storyId){d.CHIP.storyId=i.storyId;}if(i.apfConfId){d.CHIP.apfConfId=i.apfConfId;}d.CHIP.APP_PARAMETERS=[];if(Object.keys(j).length){for(var p in j){if(j.hasOwnProperty(p)){d.CHIP.APP_PARAMETERS.push({NAME:p,VALUE:j[p]});}}}}catch(e){d.CHIP.navType=d.CHIP.navType||0;d.CHIP.semanticObject=d.CHIP.semanticObject||t.modelRef.getData().EVALUATION.COLUMN_NAME;d.CHIP.semanticAction=d.CHIP.semanticAction||t.sbAction;}t.modelRef.setData(d);},liveChange:function(e){var s=""+e.getParameter("value").toLowerCase()+"";var F=new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,s);var b=new sap.ui.model.Filter("id",sap.ui.model.FilterOperator.Contains,s);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([F,b],false));}});this.navigateLikeTileDialog.setModel(t.navigateLikeTileModel);function f(c){t.busyDialog.close();t.navigateLikeTileDialog.open();t.navigateLikeTileModel.setData({CHIPS:c.CHIPS});}function a(c){t.navigateLikeTileDialog.open();t.busyDialog.close();}t.busyDialog.open();t.getSAPCopiedEvaluationChips(f,a);},formatNavLikeTileTitle:function(t){var o=this.getBindingContext().getObject();return(o.title||o.description)?((o.title||"")+" - "+(o.description||"")):("-NA-"+o.id);},formatTileId:function(i){return this.oApplicationFacade.getResourceBundle().getText("ID",i);},formatCatalogTitle:function(t){var o=this.getBindingContext().getObject();return o.title||"-NA-"+o.id;},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},getInitialModelData:function(){var c={};c.vNavigateLikeTile=false;c.vSemanticObject=false;c.vAction=false;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;c.vSelectNavigationType=false;c.vAppParameter=false;c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;if(this.createMode){c.eSelectTileType=true;c.eSelectCatalog=true;}else if(this.editMode){c.eSelectTileType=false;c.eSelectCatalog=false;}return{CONTROL:c};},getModelDataAfterEnv:function(e){var c={};if(e){c.vNavigateLikeTile=false;c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=true;c.vSelectNavType=true;c.vSelectNavigationType=true;c.vAppParameter=true;}else{c.vNavigateLikeTile=true;c.vSemanticObject=false;c.vAction=false;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;c.vSelectNavigationType=false;c.vAppParameter=false;}c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;if(this.createMode){c.eSelectTileType=true;c.eSelectCatalog=true;}else if(this.editMode){c.eSelectTileType=false;c.eSelectCatalog=false;}return{CONTROL:c};}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S3.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S3",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.busyDialog=new sap.m.BusyDialog();var v=this.getView();this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.navigatingWithinDrilldown=true;this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="detail"){t.selectedTile=undefined;this.evalContext=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);var c=new sap.ui.model.json.JSONModel();c.setSizeLimit(100000);this.getView().setModel(c,"tileConfig");this.modelRef=this.getView().getModel("tileConfig");if(!!!this.oApplicationFacade.__tileModified&&this.evalContext.getObject()&&((this.evalContext.getObject()["CHIPS_COUNT"]===null)||(this.evalContext.getObject()["CHIPS_COUNT"]===0))){this.oApplicationFacade.__tileModified=null;this.getView().getModel("tileConfig").setData({CHIPS:[]});if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.PLATFORM=this.metadataRef.getPlatform();this.env=0;if(this.PLATFORM==this.constantsRef.Platform.ABAP){this.isPlatformABAP=true;}else{this.isPlatformABAP=false;}function a(d){t.env=d;};function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);};this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});var f=this.byId("tileGrid");f.removeAllColumns();if(this.isPlatformABAP){f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("CATALOGUE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}else{f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("NAVIGATION")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("STATUS")}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));f.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}function g(d){if(d&&d.EVALUATION){d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;}t.busyDialog.close();jQuery.sap.log.info("Chips fetch called and successful");if(!(d&&d.CHIPS&&d.CHIPS.length)){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}else{t.getView().getModel("tileConfig").setData(d);if(d.affectedTiles&&d.affectedTiles.length){t.handleAffectedTilesDialogOnSelect(d);}}};function h(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);jQuery.sap.log.error("Error occured while fetching chips");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_CHIPS"),(JSON.stringify(d)));};this.busyDialog.open();this.metadataRef.getChipByEvaluation({context:this.evalContext,success:g,error:h,model:this.oApplicationFacade.getODataModel()});if(t.isPlatformABAP){this.oHeaderFooterOptions.buttonList=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_EVALUATION"),onBtnPressed:function(d){t.handleEvalDelete();}}];this.oHeaderFooterOptions.additionalShareButtonList=[];}}},this);var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("FULLSCREEN_TITLE"),onBtnPressed:function(e){if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}if(t.isPlatformABAP){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTileModelS",context:t.evalContext.sPath.substr(1)});}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.evalContext.sPath.substr(1)});}},bEnabled:false,}};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},getChipRow:function(i,c){var t=this;var a;var b;var d=null;try{d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);}catch(e){d={};jQuery.sap.log.error("parsing of Chip Failed");}var n=new sap.m.Text();if(d.navType=="0"){n.setText(t.oApplicationFacade.getResourceBundle().getText("GENERIC_DRILLDOWN"));}else{n.setText(t.oApplicationFacade.getResourceBundle().getText("OTHER_DRILLDOWN"));}var s=new sap.m.ObjectNumber();if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));s.setState("Success");}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"));s.setState("None");}}else{s.setNumber(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE_DRAFT"));s.setState("Success");}var f;var g;if(Number(d.navType)){g=true;}else{g=false;}if(c.getProperty("tileType")==t.tileTypeConst["NT"])a=new sap.suite.ui.commons.NumericContent({size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});else if(c.getProperty("tileType")==t.tileTypeConst["CT"])a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});else if(c.getProperty("tileType")==t.tileTypeConst["AT"])a=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});else if(c.getProperty("tileType")==t.tileTypeConst["TT"])a=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});else if(c.getProperty("tileType")==t.tileTypeConst["CM"]){a=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]});}else if(c.getProperty("tileType")==t.tileTypeConst["HT"]){a=new sap.suite.ui.commons.HarveyBallMicroChart({total:100,size:"S",scale:"M",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:30,color:"Good"})]});}b=new sap.suite.ui.commons.GenericTile({size:"S",header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:c.getProperty("tileType")})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S",}),press:function(A){}}).addStyleClass("sbTile");if(c.getProperty("isAffected")){b.addStyleClass("affectedTile");}if(c.getProperty("tileType")==t.tileTypeConst["DT-AT"]){b.setFrameType("TwoByOne");var h=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var j=new sap.suite.ui.commons.BulletChart({scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:h,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:j,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-CT"]){b.setFrameType("TwoByOne");var k=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var l=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:k,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:l,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-CM"]){b.setFrameType("TwoByOne");var m=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var o=new sap.suite.ui.commons.ComparisonChart({scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:t.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:m,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:o,size:"S"}));}else if(c.getProperty("tileType")==t.tileTypeConst["DT-TT"]){b.setFrameType("TwoByOne");var p=new sap.suite.ui.commons.NumericContent({value:"0.0",scale:"M",size:"S",valueColor:"Good",unit:t.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:t.oApplicationFacade.getResourceBundle().getText("ACTUAL")});var q=new sap.suite.ui.commons.MicroAreaChart({size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});b.removeAllTileContent();b.addTileContent(new sap.suite.ui.commons.TileContent({content:p,size:"S"}));b.addTileContent(new sap.suite.ui.commons.TileContent({content:q,size:"S"}));}function r(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}if(t.isPlatformABAP){if(C.isActive){if(C.COUNTER==2){D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=1)";}}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTileModelS",context:(t.evalContext.sPath.substr(1)+"/"+D)});}else{if(C.isActive){if(C.COUNTER==2){D=D+"(id='"+C.id+"',isActive=0)";}else{D=D+"(id='"+C.id+"',isActive=1)";}}else{D=D+"(id='"+C.id+"',isActive=0)";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.evalContext.sPath.substr(1)+"/"+D)});}}var u=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Transparent,press:r});if(c.getProperty("isAffected")){u.setEnabled(false);}var v=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(A){t.handleDelete(this);}});var w=[];var x=new sap.m.Text({text:c.getObject().catalogName});var y=c.getObject().isAffected?true:false;if(t.isPlatformABAP){w=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:c.getObject().catalogName,visible:true}),new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("TILE_REMOVED_FROM_CATALOG"),state:"Error",visible:y})]}).addStyleClass("navigationVLayout"),u,v];}else{w=[b,new sap.ui.layout.VerticalLayout({content:[n,new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:g}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:g}),]}).addStyleClass("navigationVLayout"),s,u,v];}var z=new sap.m.ColumnListItem({type:"Navigation",cells:w});if(!(t.isPlatformABAP)){z.attachPress(function(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(C.isActive){if(C.COUNTER==2){D=D+"(id='"+C.id+"',isActive=0)";}else{D=D+"(id='"+C.id+"',isActive=1)";}}else{D=D+"(id='"+C.id+"',isActive=0)";}if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTile",context:(t.evalContext.sPath.substr(1)+"/"+D)});});}else if(t.isPlatformABAP&&!(c.getProperty("isAffected"))){z.attachPress(function(A){var B=this.getBindingContext("tileConfig");var C=B.getObject();var D="CHIPS";if(C.isActive){if(C.COUNTER==2){D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=1)";}}else{D=D+"(ID='"+C.id+"',IS_ACTIVE=0)";}if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"editTileModelS",context:(t.evalContext.sPath.substr(1)+"/"+D)});});}else{z.setType("Inactive");}return z;},handleDelete:function(c){var t=this;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){function a(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();function f(d){t.busyDialog.close();d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;t.getView().getModel("tileConfig").setData(d);if(d.EVALUATION.CHIPS_COUNT===0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}}function g(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);}t.metadataRef.getChipByEvaluation({context:t.evalContext,success:f,error:g,model:t.oApplicationFacade.getODataModel()});};function b(d){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),d.responseText);};t.busyDialog.open();t.metadataRef.removeTile(c.getBindingContext("tileConfig").getObject(),t,a,b);}if(e=="CANCEL"){}});},handleAffectedTilesDialogOnSelect:function(c){var t=this;var a=c.affectedTiles;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_DIALOG")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){function r(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_SUCCESS"));t.refreshMasterList();function f(d){t.busyDialog.close();d.EVALUATION.CHIPS_COUNT=(d.CHIPS)?d.CHIPS.length:0;t.getView().getModel("tileConfig").setData(d);if(d.EVALUATION.CHIPS_COUNT===0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"noDataView",context:t.evalContext.sPath.substr(1)});return;}}function g(d,s,x){t.busyDialog.close();t.getView().getModel("tileConfig").setData([]);}t.metadataRef.getChipByEvaluation({context:t.evalContext,success:f,error:g,model:t.oApplicationFacade.getODataModel()});}function e(){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("AFFECTED_TILES_DEL_ERROR"));}b.close();var p=[];for(var i=0,l=a.length;i<l;i++){p.push({ID:a[i],IS_ACTIVE:1});}if(p&&p.length){t.busyDialog.open();t.metadataRef.remove("CHIP",p,r,e);}}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();},handleEvalDelete:function(){var t=this;var m=t.modelRef.getData();if(m.CHIPS&&m.CHIPS.length){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("EVALUATION_HAS_TILES_ERR"));}else{sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){function a(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("EVALUATION_DEL_SUCCESS"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true);};function b(){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERR_EVALUATION_DEL"));};var p={ID:m.EVALUATION.ID,IS_ACTIVE:m.EVALUATION.IS_ACTIVE};t.busyDialog.open();t.metadataRef.remove("EVALUATION",p,a,b);}if(e=="CANCEL"){}});}},formatChipsCount:function(c){return this.oApplicationFacade.getResourceBundle().getText("TILES")+" ("+(c||0)+")";},getFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(e){if(t.selectedTile){var d=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER.configuration).tileConfiguration).TILE_PROPERTIES);var a=JSON.parse(JSON.parse(JSON.parse(t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER.configuration).tileConfiguration).EVALUATION);var c=t.selectedTile.getBindingContext("tileConfig").getObject().CHIP_MODELER;var f="";if(!(d.semanticObject&&d.semanticAction&&c.title&&c.description)||(!(d.storyId)&&d.navType==1)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){if(!(d.semanticObject)||(d.semanticObject.length==(d.semanticObject.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";}if(!(d.semanticAction)||(d.semanticAction.length==(d.semanticAction.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";}if(!(c.title)||(t.selectedTile.getBindingContext().getObject().title.length==(t.selectedTile.getBindingContext().getObject().title.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";}if(!(c.description)||(c.description.length==(c.description.split(" ").length-1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION")+"\n";}if((!(d.storyId)&&(d.navType==1))){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID");}sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);}else{if(t.selectedTile.getBindingContext().getObject().tileType=="CM"){if(!(a)||!(a.COLUMN_NAMES)||!(a.COLUMN_NAMES.length)){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");}else{for(var i=0,l=a.COLUMN_NAMES.length;i<l;i++){if(!(a.COLUMN_NAMES[i].COLUMN_NAME)||!(a.COLUMN_NAMES[i].semanticColor)){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break;}}if((!f)&&(a.COLUMN_NAMES.length==3)){if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[1].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(a.COLUMN_NAMES[0].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(a.COLUMN_NAMES[1].COLUMN_NAME==a.COLUMN_NAMES[2].COLUMN_NAME){f+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}}}if(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);}else{t.metadataRef.create("ACTIVATE_CHIP",{id:c.id},null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.refreshMasterList();t.selectedTile=undefined;t.updateFooterButtons();},function(g){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),g.responseText);});}}}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT")+" "+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),onBtnPressed:function(e){if(t.selectedTile){var c=t.selectedTile.getBindingContext("tileConfig").sPath.replace("isActive=1","isActive=0");c=c.replace("/CHIPS_MODELER","CHIPS");t.oRouter.navTo("editTile",{contextPath:t.evalContext.sPath.substr(1),chipContextPath:c});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("EDIT"),onBtnPressed:function(e){if(t.selectedTile){t.oRouter.navTo("editTile",{contextPath:t.evalContext.sPath.substr(1),chipContextPath:t.selectedTile.getBindingContext("chipObj").sPath.replace("/CHIPS_MODELER","CHIPS")});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_EDIT"));}},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE"),onBtnPressed:function(e){if(t.selectedTile){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.oApplicationFacade.getODataModel().remove(t.selectedTile.getBindingContext("tileConfig").sPath.replace("CHIPS_MODELER","CHIPS"),null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();t.selectedTile=undefined;t.updateFooterButtons();},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETION_FAILED"),a.response.body);});}if(e=="CANCEL"){}});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"));}},}];return b;},setSorting:function(k,g){g=g||false;var l=this.getView().byId("tileGrid");if(k=="tileType"){l.getBinding("items").sort([new sap.ui.model.Sorter("tileType",g,null)]);}else if(k=="status"){l.getBinding("items").sort([new sap.ui.model.Sorter("isActive",g,null),new sap.ui.model.Sorter("COUNTER",g,null)]);}else if(k=="none"){l.getBinding("items").sort([]);}},setFiltering:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"DT-CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CM')),"DT-CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CT')),"DT-AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-AT')),"DT-TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-TT')),"new":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,0)),"active":(new sap.ui.model.Filter("isActive",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},handleSortPress:function(){var t=this;this.sortOptionsDialog=this.sortOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});this.sortOptionsDialog.open();},handleFilterPress:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),key:"NT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),key:"CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),key:"TT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),key:"AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),key:"CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_TILE"),key:"DT-CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_MM_TILE"),key:"DT-CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_DEVIATION_TILE"),key:"DT-AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_TREND_TILE"),key:"DT-TT"})]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW"),key:"new"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"),key:"active"})]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){f[s[i].getParent().getKey()]=f[s[i].getParent().getKey()]||"";f[s[i].getParent().getKey()]+=(f[s[i].getParent().getKey()])?(","):"";f[s[i].getParent().getKey()]+=s[i].getText();}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?" ; ":"";a+=f[b];}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a);}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});this.filterOptionsDialog.open();},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},formatIndicatorTitle:function(i){return this.oApplicationFacade.getResourceBundle().getText("KPI_TEXT")+" : "+i;}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S4.controller');
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S4",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.errorMessages=[];this.errorState=false;this.LUMIRA_SEMANTIC_OBECT="LumiraAnalytics";this.LUMIRA_ACTION="openStory";this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="FioriApplication";this.apfAction="executeAPFConfiguration";this.APF_SEMANTIC_OBECT="FioriApplication";this.APF_ACTION="executeAPFConfiguration";this.adhocAnalysisSemanticObject="AdhocAnalysis";this.adhocAnalysisAction="analyze";this.ADHOC_ANALYSIS_SEMANTIC_OBECT="AdhocAnalysis";this.ADHOC_ANALYSIS_ACTION="analyze";this.sbAction="analyzeSBKPIDetails";this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.oDataModel=this.oApplicationFacade.getODataModel();this.PLATFORM=this.metadataRef.getPlatform();this.initialiazeDialogs();if(!(this.oApplicationFacade.env)){function a(d){if(d===null||d===undefined){d={};d.SYS_FLAG=1;}t.env=d.SYS_FLAG;t.sScope=d.SYS_FLAG?"CONF":"CUST";};function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),"description":d.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});}if(!(t.oApplicationFacade.currentLogonHanaUser)){var c=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var f=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":d.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};this.metadataRef.getSessionUser({async:true,success:c,error:f,model:this.oApplicationFacade.getODataModel()});}this.oRouter.attachRouteMatched(function(E){if(E.getParameter("name")=="addTile"){this.createMode=true;this.editMode=false;}else if(E.getParameter("name")=="editTile"){this.createMode=false;this.editMode=true;}else{this.createMode=false;this.editMode=false;}if(this.createMode||this.editMode){this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");t.inSufficientAdditionalMeasureAlerted=false;t.inSufficientAdditionalMeasure=false;var d=new sap.ui.model.json.JSONModel();d.setSizeLimit(100000);this.getView().setModel(d,"tileConfig");this.modelRef=this.getView().getModel("tileConfig");var i=this.getInitialModelData();this.getView().getModel("tileConfig").setData(i);var p=this.fetchChipData({evalContextPath:E.getParameter("arguments").contextPath,chipContextPath:E.getParameter("arguments").chipContextPath});if(E.getParameter("arguments").contextPath){this.context=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").contextPath);}if(E.getParameter("arguments").chipContextPath){this.chipContext=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").chipContextPath);}this.appMode=E.getParameter("name");t.byId("tileSubtitle").setValueState("None");t.byId("appPropertyName").setValueState("None");t.byId("semanticObjectText").setValueState("None");t.byId("selectODD").setValueState("None");t.byId("tileTitle").setValueState("None");t.byId("appPropertyValue").setValueState("None");t.byId("selectStoryId").setValueState("None");t.byId("apfConfId").setValueState("None");}},this);try{if(sap.ui.core.Fragment.byId("tiles","compchart")){sap.ui.core.Fragment.byId("tiles","compchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","compchartmul")){sap.ui.core.Fragment.byId("tiles","compchartmul").destroy();}if(sap.ui.core.Fragment.byId("tiles","bulletchart")){sap.ui.core.Fragment.byId("tiles","bulletchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","areachart")){sap.ui.core.Fragment.byId("tiles","areachart").destroy();}}catch(e){};sap.ui.xmlfragment("tiles","sap.suite.ui.smartbusiness.designtime.visualization.view.tiles",this);},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveTile();}},buttonList:[]};return this.oHeaderFooterOptions;},getHeaderFooterOptionsForError:function(){var t=this;this.oErrorOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){t.utilsRef.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveTile();}}]};return this.oErrorOptions;},setFooterOnError:function(){var t=this;if(t.errorMessages.length>1){switch(t.mode){case"create":t.setHeaderFooterOptions(t.oErrorOptions);break;case"edit":t.updateFooterButtons(this.modelRef.getData());t.setHeaderFooterOptions(t.oErrorOptionsForDraft);break;}}else{switch(t.mode){case"create":t.setHeaderFooterOptions(t.oHeaderFooterOptions);break;case"edit":t.updateFooterButtons(this.modelRef.getData());t.setHeaderFooterOptions(t.oHeaderFooterOptionsForDraft);break;}}},initialiazeDialogs:function(){var t=this;this.filterValueHelpDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_FILTERS"),multiSelect:true,items:{path:"/filterValues",template:new sap.m.StandardListItem({title:"{value}",selected:"{selected}"})},growingThreshold:999,confirm:function(e){var s=e.mParameters.selectedContexts;var v=[];s.forEach(function(c){v.push(c.getProperty("value"));});t.getView().getModel("tileConfig").setProperty("/CHIP/harveyFilters/0/VALUE_1",v);},cancel:function(e){},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f,F],true);}});this.filterValueHelpDialog.setModel(new sap.ui.model.json.JSONModel({filterValues:[]}));return this.filterValueHelpDialog;},fetchFilterValuesForDimension:function(D,v,s,e){var t=this;var c;var m=this.getView().getModel("tileConfig");var a=m.getProperty("/EVALUATION/ODATA_URL");var V={};v.forEach(function(d){V[d]=true;});var b=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:a,entitySet:m.getProperty("/EVALUATION/ODATA_ENTITYSET"),filter:m.getProperty("/FILTERS"),dimension:D});if((c=this.getApplicationCache(a+"/"+b.uri))){s(c);}else{b.model.read(b.uri,null,null,false,function(f){var d=[];f.results.forEach(function(o){d.push({value:o[D],selected:!!V[o[D]]});});t.setApplicationCache(a+"/"+b.uri,d);s(d);},e);}},openFilterValueHelp:function(){var t=this;var v=t.getView().getModel("tileConfig");this.filterValueHelpDialog.open();this.filterValueHelpDialog.setBusy(true);var d=v.getProperty("/CHIP/harveyFilters/0/NAME");var s=v.getProperty("/CHIP/harveyFilters/0/VALUE_1");t.fetchFilterValuesForDimension(d,s,function fetchFilterValuesForDimensionCallBack(a){t.filterValueHelpDialog.getModel().setProperty("/filterValues",a);t.filterValueHelpDialog.setBusy(false);},function(e){t.filterValueHelpDialog.setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),e);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),"description":e});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});},initializeDimensionsForHarveyFilters:function(t){var d=t.EVALUATION.ODATA_URL;var e=t.EVALUATION.ODATA_ENTITYSET;var D=sap.suite.ui.smartbusiness.lib.Util.odata.dimensions(d,e).getAsObjectArrayWithLabel();var a=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensionsWithProperty(d,e);var h=[];var b={};h.forEach(function(o){b[o.name]=true;});for(var c in a){if(!b[c]){h.push({name:c,label:a[c]._sLabelText||c});}}t.CHIP.HARVEY_DIMENSION=h;if(!t.CHIP.harveyFilters[0].NAME){t.CHIP.harveyFilters[0].NAME=h[0].label;}},harveyTotalMeasureVisibility:function(i,I){return i&&I;},harveyFilterVisibility:function(i,I){return i&&I;},harveyFilterOptionVisibility:function(i,I,s){return i&&I&&s;},betweenOperatorLabelVisible:function(o){return o=="BT";},_cache:{},setApplicationCache:function(k,v){this._cache[k]=v;},getApplicationCache:function(k){return this._cache[k];},onKpiMeasureAsHarveyTotalMeasure:function(e){},getSelectedRadioButton:function(e,c){var b=this.getView().getBindingContext();var d=this.modelRef.getData();if((e&&e.mParameters.selected)||c||true){this.confirmationType=(e)?e.getSource().data("drilldownType"):c;if(this.confirmationType==='GDD'){d.CHIP.navType="0";d.CONTROL=this.getControlObject(d);d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject;d.CHIP.semanticAction=this.sbAction;this.updateFooterButtons(d);this.modelRef.setData(d);}else if(this.confirmationType==='ODD'){d.CHIP.navType=(Number(d.CHIP.navType))?d.CHIP.navType:"4";d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);this.selectNavType(null,d.CHIP.navType);}}},selectTileType:function(e){this.selectTile(e.getSource().getSelectedItem().getKey());},onTileSelect:function(e){this.selectTile(e.getSource().data("tileType"));},selectTile:function(k){var d=this.modelRef.getData();d.CHIP.tileType=k;d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);if(k=="CM"){if(this.inSufficientAdditionalMeasure&&!(this.inSufficientAdditionalMeasureAlerted)){sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("INSUFFICIENT_ADDL_MEASURES"));this.inSufficientAdditionalMeasureAlerted=true;}}this.getView().byId(d.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));this.byId("selectTileType").setTooltip(this.byId("selectTileType").getSelectedItem().getText());},selectSortOrder:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},multiMeasureSelect:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},semanticColorContributionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},selectNavType:function(e,k){var d=this.modelRef.getData();if(e){k=e.getSource().getSelectedKey();e.getSource().setTooltip(e.getParameters().selectedItem.getText());}d.CHIP.navType=k;d.CONTROL=this.getControlObject(d);switch(Number(k)){case 1:d.CHIP.semanticObject=this.lumiraSemanticObject;d.CHIP.semanticAction=this.lumiraAction;break;case 2:d.CHIP.semanticObject=this.apfSemanticObject;d.CHIP.semanticAction=this.apfAction;break;case 3:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;case 4:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;case 5:d.CHIP.semanticObject=this.adhocAnalysisSemanticObject;d.CHIP.semanticAction=this.adhocAnalysisAction;break;default:break;}this.updateFooterButtons(d);this.modelRef.setData(d);},formChipConfiguration:function(){var t=this;var p={};var d=this.modelRef.getData();var a=d.CHIP;var c=null;var b={};var e={};var h=a.harveyFilters||[];p.id=a.id||"";this.currentChipId=p.id;p.isActive=0;p.catalogId='HANA_CATALOG';p.title=a.title;p.description=a.description;if(a.tileType=="DT"){p.tileType=a.tileType+"-"+a.dualTileType;}else{p.tileType=a.tileType;}p.evaluationId=a.evaluationId;p.url=this.getChipUrl(p.tileType);p.keywords=a.keywords;if(a.changedOn){p.changedOn=a.changedOn;}e.id=a.id||"";e.evaluationId=a.evaluationId;if(a.tileType=="DT"){e.tileType=a.tileType+"-"+a.dualTileType;}else{e.tileType=a.tileType;}if(a.tileType=='CT'||(a.tileType=='DT'&&a.dualTileType=='CT')){e.dimension=a.dimension;e.sortOrder=a.sortOrder;e.semanticColorContribution=a.semanticColorContribution;}if(a.tileType=='TT'||(a.tileType=='DT'&&a.dualTileType=='TT')){e.dimension=a.dimension;}var f=d.EVALUATION;if(a.tileType=='NT'||a.tileType=='TT'||a.tileType=='CT'||a.tileType=='AT'||a.tileType=='CM'||a.tileType=="HT"){e.frameType='OneByOne';}else{e.frameType='TwoByOne';}e.navType=a.navType;if(e.navType=="0"){e.semanticObject=(a.semanticObject&&(a.semanticObject.length!=(a.semanticObject.split(" ").length-1)))?a.semanticObject:f.COLUMN_NAME;e.semanticAction=this.sbAction;}else if(e.navType=="1"){e.storyId=a.storyId;e.semanticObject=a.semanticObject||this.lumiraSemanticObject||this.LUMIRA_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.lumiraAction||this.LUMIRA_ACTION;}else if(e.navType=="2"){e.apfConfId=a.apfConfId;e.semanticObject=a.semanticObject||this.apfSemanticObject||this.APF_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.apfAction||this.APF_ACTION;}else if(e.navType=="5"){e.semanticObject=a.semanticObject||this.adhocAnalysisSemanticObject||this.ADHOC_ANALYSIS_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.adhocAnalysisAction||this.ADHOC_ANALYSIS_ACTION;}else{e.semanticObject=a.semanticObject;e.semanticAction=a.semanticAction;}if(a.tileType=='CM'||(a.tileType=='DT'&&a.dualTileType=='CM')){e.COLUMN_NAMES=[];var g=a.MULTI_MEASURE;var j=[];for(var i=0,l=g.length;i<l;i++){if(g[i].COLUMN_NAME){e.COLUMN_NAMES.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});j.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});}else{j.push({COLUMN_NAME:null,semanticColor:null});}}}if(a.tileType=='HT'){e.isFractionMeasure=d.CHIP.isKPIMeasureFractionMeasureHarvey;if(e.isFractionMeasure){e.harveyTotalMeasure=a.totalValueMeasure;}else{e.harveyFilters=[];if(h[0]&&h[0].VALUE_1){h[0].VALUE_1.forEach(function(v){e.harveyFilters.push({NAME:h[0].NAME,OPERATOR:h[0].OPERATOR,VALUE_1:v,VALUE_2:"",TYPE:"FI"});});}}}b.ADDITIONAL_APP_PARAMETERS={};var k=d.CHIP.APP_PARAMETERS;if(k&&k.length){for(var i=0,l=k.length;i<l;i++){b.ADDITIONAL_APP_PARAMETERS[k[i].NAME]=k[i].VALUE;}}b.ADDITIONAL_APP_PARAMETERS=Object.keys(b.ADDITIONAL_APP_PARAMETERS).length?JSON.stringify(b.ADDITIONAL_APP_PARAMETERS):JSON.stringify({});b.TILE_PROPERTIES=JSON.stringify(e);b.EVALUATION_FILTERS=d.FILTERS.length?JSON.stringify(d.FILTERS):JSON.stringify([]);b.EVALUATION_VALUES=d.VALUES.length?JSON.stringify(d.VALUES):JSON.stringify([]);b.TAGS=d.TAGS?JSON.stringify(Object.keys(d.TAGS)):JSON.stringify([]);var m={};m.ID=f.ID;m.INDICATOR=f.INDICATOR;m.INDICATOR_TYPE=f.INDICATOR_TYPE;m.INDICATOR_TITLE=f.INDICATOR_TITLE;m.GOAL_TYPE=f.GOAL_TYPE;m.TITLE=f.TITLE;m.SCALING=f.SCALING;m.ODATA_URL=f.ODATA_URL;m.ODATA_ENTITYSET=f.ODATA_ENTITYSET;m.VIEW_NAME=f.VIEW_NAME;m.COLUMN_NAME=f.COLUMN_NAME;m.OWNER_NAME=f.OWNER_NAME;m.VALUES_SOURCE=f.VALUES_SOURCE;m.DECIMAL_PRECISION=f.DECIMAL_PRECISION;b.EVALUATION=m?JSON.stringify(m):JSON.stringify({});var n=Date.now().toString();c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"1",timeStamp:n});var o=4050;if(p.id){o=4096;}if(c.length>o){b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});if(c.length>o){b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});if(c.length>o){b.EVALUATION_VALUES=JSON.stringify([]);b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});}}}p.configuration=c;return p;},publishChip:function(p){var s=true;var t=this;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;this.chipTextPayload=[];var b=[];this.deleteBatch=[];this.createBatch=[];var a=true;var d=this.oApplicationFacade.getODataModel();if(this.createMode){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:t.chipTextPayload}});t.metadataRef.create("CHIP",f,null,function(h){s=true;t.currentChipId=JSON.parse(h).response[0].id;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(this.editMode){if(this.currentContextState){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:t.chipTextPayload}});t.metadataRef.create("CHIP",f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.initialData.ADDITIONAL_LANGUAGE_ARRAY.length;i++){var e={};e.id=p.id;e.language=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].language;e.isActive=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].isActive;e.description=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].description;e.title=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].title;t.languagePayloadForDirtyBitTest.push(e);}var l=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var g={remove:[],create:[]};if(l){if(l.deletes.length){for(var i=0;i<l.deletes.length;i++){g.remove.push(l.deletes[i]);}}if(l.updates.length){for(var i=0;i<l.updates.length;i++){t.createBatch.push(d.createBatchOperation("/CHIP_TEXTS","POST",l.updates[i]));g.create.push(l.updates[i]);}}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:{update:p},TEXTS:g}});t.metadataRef.update("CHIP",f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}return s;},getChipUrl:function(t){var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","HT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorHarveyBall/HarveyBallTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcomparison/ComparisonTileChip.xml","DT-CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml"};return c[t];},populateDimension:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var a=[],b=[],o={};var i;a=sap.suite.ui.smartbusiness.lib.Util.odata.dimensions(d,e).getAsStringArray();for(i=0;i<a.length;i++){o={};o.dimensionName=a[i];b.push(o);}var m=new sap.ui.model.json.JSONModel();m.setData({dimensions:b});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},handleDimensionSelectionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},setGenericDrillDown:function(n){return(n==0)?true:false;},setOtherDrillDown:function(n){return(n>0)?true:false;},onAfterContextData:function(c){var t=this;this.evaluationObj=c;if(this.customMeasuresModel&&this.customMeasuresModel.getData()){var a=this.customMeasuresModel.getData();a.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel.setData(a);}try{this.oModelForEntity=this.populateDimension(c.ODATA_URL,c.ODATA_ENTITYSET);this.tileConfigurationModel.getData().dimension=this.oModelForEntity.getData().dimensions[0].dimensionName;this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});}catch(e){}finally{if(this.oModelForEntity&&this.oModelForEntity.getData()&&this.oModelForEntity.getData().dimensions&&this.oModelForEntity.getData().dimensions.length){this.getView().byId("selectDimension").setModel(this.oModelForEntity,"populateDimension");}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}if(this.appMode=="addTile"){t.selectTile('NT');t.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));t.currentLocaleLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase()];var b="/EVALUATIONS_CHIP_TEXTS?$filter=ID eq '"+c.ID+"' and IS_ACTIVE eq 1";t.oApplicationFacade.getODataModel().read(b,null,null,true,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.TEXTS=[];var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.language=d.results[i].LANGUAGE;o.title=d.results[i].TITLE;o.description=d.results[i].DESCRIPTION;t.evaluationDetails.TEXTS.push(o);}},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":e.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});this.updateFooterButtons(null);this.tileConfigurationModel.setData({evaluationId:c.ID,title:c.INDICATOR_TITLE,description:c.TITLE,semanticObject:(c.SEMANTIC_OBJECT||''),action:(c.ACTION||''),storyId:'',tileType:'NT',navType:0});this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});this.tempSemanticObject=c.SEMANTIC_OBJECT||"";this.onLoadSemanticObject=this.tempSemanticObject;this.tempAction=c.ACTION||"";var m=new sap.ui.model.json.JSONModel();m.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(m,"multiMeasures");}},onAfterChipContextData:function(c){var t=this;this.currentContextState=c.isActive;this.currentChipId=c.id;this.updateFooterButtons(c);if(this.appMode=="editTile"){var a=JSON.parse(c.configuration);var b=[];if(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS){b=JSON.parse(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS);}var e={};var m={MULTI_MEASURE:[]};if(JSON.parse(a.tileConfiguration).EVALUATION){e=JSON.parse(JSON.parse(a.tileConfiguration).EVALUATION);var d=new sap.ui.model.json.JSONModel();if(e.COLUMN_NAMES&&e.COLUMN_NAMES.length){for(var i=0,l=e.COLUMN_NAMES.length;i<l;i++){m.MULTI_MEASURE.push({COLUMN_NAME:e.COLUMN_NAMES[i].COLUMN_NAME,semanticColor:e.COLUMN_NAMES[i].semanticColor});}if(m.MULTI_MEASURE&&m.MULTI_MEASURE.length==2){m.MULTI_MEASURE.push({COLUMN_NAME:"",semanticColor:"Good"});}d.setData(m);this.getView().setModel(d,"multiMeasures");}else{d.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(d,"multiMeasures");}}var f=JSON.parse(JSON.parse(a.tileConfiguration).TILE_PROPERTIES);c.semanticObject=f.semanticObject;t.onLoadSemanticObject=c.semanticObject;c.action=f.semanticAction;this.tempSemanticObject=c.semanticObject||"";this.tempAction=c.action||"";c.navType=f.navType||"0";c.sortOrder=f.sortOrder||undefined;c.dimension=f.dimension||undefined;if(c.navType.toString()=="1"){this.lumiraSemanticObject=c.semanticObject;this.lumiraAction=c.action;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}else if(c.navType.toString()=="2"){this.apfSemanticObject=c.semanticObject;this.apfAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}else if(c.navType.toString()=="5"){this.adhocAnalysisSemanticObject=c.semanticObject;this.adhocAnalysisAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;}else{this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}this.byId('selectTileType').setSelectedKey(c.tileType);this.selectTile(c.tileType);if(Number(c.navType)==1){c.storyId=f.storyId;}else{c.storyId="";}this.tileConfigurationModel.setData(c);this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});if(Number(c.navType)){this.byId("selectNavType").setSelectedKey(c.navType);this.getSelectedRadioButton(null,"ODD");}else{this.getSelectedRadioButton(null,"GDD");}var p=[];if(b&&Object.keys(b).length){for(var k in b){if(b.hasOwnProperty(k)){p.push({NAME:k,VALUE:b[k]});}}}this.byId("propertyNameValueBox").getModel("appParameters").setData({PROPERTIES:p});this.initialAppParameters=jQuery.extend(true,[],(this.appParametersModel.getData().PROPERTIES||[]));}},addNewProperty:function(){var t=this;if(this.getView().byId("appPropertyName").getValue()){this.getView().byId("appPropertyName").setValueState("None");if(this.getView().byId("appPropertyValue").getValue()){this.getView().byId("appPropertyValue").setValueState("None");var p=this.modelRef.getData().CHIP.APP_PARAMETERS;p=p||[];if(this.checkForDuplicateProperty()){p.push({NAME:this.getView().byId("appPropertyName").getValue(),VALUE:this.getView().byId("appPropertyValue").getValue()});this.getView().byId("appPropertyName").setValue("");this.getView().byId("appPropertyValue").setValue("");var d=this.modelRef.getData();d.CHIP.APP_PARAMETERS=p;this.modelRef.setData(d);}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyValue").setValueState("Error");this.getView().byId("appPropertyValue").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));}},removeProperty:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();e.getSource().getBindingContext("tileConfig").getModel().getData().CHIP.APP_PARAMETERS.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("tileConfig").getModel().updateBindings();},getAllFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_DRAFT"),onBtnPressed:function(e){this.errorMessages=[];this.errorState=false;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.errorMessages=[];t.errorState=false;t.metadataRef.remove("CHIP",{payload:{id:t.currentChipId,isActive:t.currentContextState}},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});},function(a){});}if(e=="CANCEL"){}});},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("SAVE")+' and '+t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(a){t.errorMessages=[];t.errorState=false;var d=t.modelRef.getData();var c=d.CHIP;var f="";var g=null;f=t.checkForValidChipForActivation();if(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),"description":f});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{t.isPropertyAdded=true;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}g=t.formChipConfiguration();function p(c){try{t.currentChipId=JSON.parse(c).response[0].id;}catch(e){t.currentChipId=t.currentChipId||null;}finally{t.metadataRef.create("ACTIVATE_CHIP",{id:t.currentChipId},null,function(c){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.__tileModified=true;t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});},function(i){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),i.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),"description":i.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}};function h(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(g,mode,t,p,h);}t.setFooterOnError();},},{sI18nBtnTxt:"SAVE_AND_CONFIG_DRILLDOWN",onBtnPressed:function(e){t.handleNavToDrillDown();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.isPropertyAdded=true;t.errorMessages=[];t.errorState=false;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var c=t.formChipConfiguration();function p(f){try{t.currentChipId=JSON.parse(f).response[0].id;}catch(e){}sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));if(t.appMode=="addTile"){var h=hasher||window.hasher;var g=hasher.getHash();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile"});setTimeout(function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:"#"+g},true);},0);}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.context.sPath.substr(1)});}}function d(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(c,mode,t,p,d);t.setFooterOnError();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel();}}];return b;},updateFooterButtons:function(c){var b=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];this.oErrorOptionsForDraft={bSuppressBookmarkButton:{},onBack:function(){that.handleBackAndCancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){that.utilsRef.handleMessagePopover(e,that);}},buttonList:[]};this.oErrorOptionsForDraft.buttonList.push({sI18nBtnTxt:"SAVE",onBtnPressed:function(e){that.saveTile();}});if(c&&c.CHIP){if((!(c.CHIP.isActive))&&(this.editMode)){this.oHeaderFooterOptions.buttonList.push(b[0]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[0]);}}for(var i=1,l=b.length;i<l;i++){if(i==2){if(c.CHIP&&(c.CHIP.navType=="2"||c.CHIP.navType=="0")){this.oHeaderFooterOptions.buttonList.push(b[i]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[i]);}}else{this.oHeaderFooterOptions.buttonList.push(b[i]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[i]);}}this.setHeaderFooterOptions(this.oHeaderFooterOptions);},checkForDuplicateProperty:function(){var t=this;var p=this.modelRef.getData().CHIP.APP_PARAMETERS;var a=this.getView().byId("appPropertyName").getValue();var v=this.getView().byId("appPropertyValue").getValue();if(!isNaN(Number(a))){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));return false;}for(var i=0,l=p.length;i<l;i++){if((p[i].NAME==a)){if(p[i].NAME==a){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));}return false;}}return true;},inputNameChange:function(e){var t=this;var p=e.getSource().getValue();var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));return;}}e.getSource().setValueState("None");},inputValueChange:function(e){var t=this;var v=e.getSource().getValue();var p=e.getSource().getBindingContext("tileConfig").getObject().NAME;var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p&&b[i].VALUE==v){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));}}},onAfterRendering:function(){var t=this;},handleSemanticObjectChange:function(e){this.tempSemanticObject=e.getSource().getValue();if(this.tempSemanticObject){e.getSource().setValueState("None");}if(this.tempSemanticObject.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="5"){this.adhocAnalysisSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="0"||this.modelRef.getData().CHIP.navType.toString()=="4"){this.onLoadSemanticObject=e.getSource().getValue();}},setSemanticAction:function(e){this.tempAction=e.getSource().getValue();if(this.tempAction){e.getSource().setValueState("None");}if(this.tempAction.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfAction=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraAction=e.getSource().getValue();}},subTitleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},titleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyNameChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyValueChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},setStoryId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}if(e.getSource().getValue().indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}},setAPFConfId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},handleStoryIdValueHelp:function(){var t=this;var v=this.modelRef.getData().EVALUATION.VIEW_NAME;var s=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("STORY_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/Stories",template:new sap.m.StandardListItem({title:"{NAME}",description:"{UUID}"})},confirm:function(e){t.modelRef.getData().CHIP.storyId=e.getParameter("selectedItem").getProperty("description");t.byId("selectStoryId").setValueState("None");t.getView().getModel("tileConfig").setData(t.modelRef.getData());},liveChange:function(e){var a="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(NAME)",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("tolower(UUID)",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");var o=new sap.ui.model.Filter([f,F],false);if(v){var c=new sap.ui.model.Filter("VIEW_NAME",sap.ui.model.FilterOperator.EQ,v);b.filter(new sap.ui.model.Filter([o,c],true));}else{b.filter(o);}}});s.open();t.oDataStoryIdModel=t.oDataStoryIdModel||new sap.ui.model.odata.ODataModel("/sap/bi/launchpad/integration/smb.xsodata",true);s.setModel(t.oDataStoryIdModel);if(v){s.getBinding("items").filter([new sap.ui.model.Filter("VIEW_NAME",sap.ui.model.FilterOperator.EQ,v)]);t.getView().getModel("tileConfig").setData(t.modelRef.getData());}},handleAPFConfigIdValueHelp:function(){var t=this;var a=t.modelRef.getData().CHIP.semanticObject;var b=t.modelRef.getData().CHIP.semanticAction;t.jsonApfConfigIdModel=t.jsonApfConfigIdModel||new sap.ui.model.json.JSONModel();var c=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CONFIG_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/AnalyticalConfigForSemObjQueryResults",template:new sap.m.StandardListItem({title:"{AnalyticalConfigurationName}",description:"{AnalyticalConfiguration}"})},confirm:function(E){t.modelRef.getData().CHIP.apfConfId=E.getParameter("selectedItem").getBindingContext().getProperty("AnalyticalConfiguration");t.modelRef.getData().CHIP.apfConfName=E.getParameter("selectedItem").getBindingContext().getProperty("AnalyticalConfigurationName");t.modelRef.getData().CHIP.apfAppId=E.getParameter("selectedItem").getBindingContext().getProperty("Application");t.byId("apfConfId").setValueState("None");t.getView().getModel("tileConfig").setData(t.modelRef.getData());},liveChange:function(E){var s=E.getParameter("value");var F=new sap.ui.model.Filter("AnalyticalConfigurationName",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("AnalyticalConfiguration",sap.ui.model.FilterOperator.Contains,s);var d=new sap.ui.model.Filter([F,o],false);var g=new sap.ui.model.Filter("SemanticObject",sap.ui.model.FilterOperator.EQ,a);var B=E.getSource().getBinding("items");if(a){B.filter(new sap.ui.model.Filter([d,g],true));}else{B.filter(new sap.ui.model.Filter(d));}}});c.open();t.oDataApfConfigIdModel=t.oDataApfConfigIdModel||new sap.ui.model.odata.ODataModel("/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata",true);function e(d){if((a!==t.APF_SEMANTIC_OBECT)||(b!==t.APF_ACTION)){d.unshift({AnalyticalConfigurationName:"",AnalyticalConfiguration:"",Application:""});}t.jsonApfConfigIdModel.setData({AnalyticalConfigForSemObjQueryResults:d});c.setModel(t.jsonApfConfigIdModel);}function f(d,s,x){var g=[];g.unshift({AnalyticalConfigurationName:"",AnalyticalConfiguration:"",Application:""});t.jsonApfConfigIdModel.setData({AnalyticalConfigForSemObjQueryResults:g});c.setModel(t.jsonApfConfigIdModel);}t.metadataRef.getDataByEntity({entity:"AnalyticalConfigForSemObjQueryResults",filter:a?"SemanticObject eq '"+a+"'":undefined,success:e,error:f,model:t.oDataApfConfigIdModel});},handleCustomMeasure:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"tileConfig>/ADDITIONAL_MEASURES/Measures",template:new sap.m.StandardListItem({title:"{tileConfig>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v);},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});this.customMeasuresDialog.open();this.customMeasuresDialog.setModel(this.modelRef,"tileConfig");},addAdditionalLanguageDialog:function(){var t=this;var m=this.getView().getModel("tileConfig").getData();this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),}).setModel(t.getView().getModel("tileConfig"),"tileConfig");this.addedLanguagesList.bindItems("tileConfig>/ADDITIONAL_LANGUAGE_ARRAY",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{tileConfig>title}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>description}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>isoLanguage}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();var b=Number(p.substr(p.lastIndexOf("/")+1));var n=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.splice(b,1);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("SUB_TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;i++){if(t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY[i].isoLanguage===t.languageKeySelect.getSelectedItem().getText()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"title":t.languageTextInput.getValue(),"description":t.languageDescriptionInput.getValue(),"isoLanguage":t.languageKeySelect.getSelectedItem().getText(),"language":t.languageKeySelect.getSelectedKey()};t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.push(b);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){a.close();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){var b=t.modelRef.getData();b.ADDITIONAL_LANGUAGE_ARRAY=o.ADDITIONAL_LANGUAGE_ARRAY;b.NO_OF_ADDITIONAL_LANGUAGES=o.NO_OF_ADDITIONAL_LANGUAGES;t.modelRef.setData(b);a.close();}})});var d=m.SAP_LANGUAGE_ARRAY;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}t.languageKeySelect.setModel(this.getView().getModel("tileConfig"),"tileConfig");t.languageKeySelect.bindItems("tileConfig>/SAP_LANGUAGE_ARRAY",new sap.ui.core.Item({text:"{tileConfig>LAISO}",key:"{tileConfig>SPRAS}"}));a.open();var o=jQuery.extend(true,{},this.modelRef.getData(),{});},hasUIChanged:function(){var t=this;var o={};var a=t.initialData;var n=jQuery.extend(true,{},t.modelRef.getData(),{});if(JSON.stringify(a)==JSON.stringify(n)){return false;}var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:a.CHIP.APP_PARAMETERS,newPayload:n.CHIP.APP_PARAMETERS,objectType:"APP_PARAMETERS"});o.oldPayload=a.CHIP;delete o.oldPayload.APP_PARAMETERS;delete o.oldPayload.MULTI_MEASURE;delete o.oldPayload.appParameters;delete o.oldPayload.configurationObj;delete o.oldPayload.HARVEY_DIMENSION;delete o.oldPayload.harveyFilters;o.newPayload=n.CHIP;delete o.newPayload.APP_PARAMETERS;delete o.newPayload.MULTI_MEASURE;delete o.newPayload.appParameters;delete o.newPayload.configurationObj;delete o.newPayload.HARVEY_DIMENSION;delete o.newPayload.harveyFilters;o.objectType="Chips";o=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(o);t.chipTextPayload=[];if(n.NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<n.NO_OF_ADDITIONAL_LANGUAGES.length;i++){var c={};c.title=n.ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=n.ADDITIONAL_LANGUAGE_ARRAY[i].description;c.language=n.ADDITIONAL_LANGUAGE_ARRAY[i].language;t.chipTextPayload.push(c);}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<a.NO_OF_ADDITIONAL_LANGUAGES.length;i++){var d={};d.language=a.NO_OF_ADDITIONAL_LANGUAGES[i].language;d.description=a.NO_OF_ADDITIONAL_LANGUAGES[i].description;d.title=a.NO_OF_ADDITIONAL_LANGUAGES[i].title;t.languagePayloadForDirtyBitTest.push(d);}var l=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});if((o&&o.updates&&o.updates.length)||(l&&l.deletes&&l.deletes.length)||(l&&l.updates&&l.updates.length)||(b&&b.deletes&&b.deletes.length)||(b&&b.updates&&b.updates.length)){return true;}else{return false;}},handleBackAndCancel:function(){var t=this;this.errorMessages=[];this.errorState=false;if(this.hasUIChanged()){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}},handleNavToDrillDown:function(){var t=this;this.errorMessages=[];this.errorState=false;var p=t.context.getPath();function n(){if(t.modelRef.getData().CHIP.navType=="2"){var c=t.modelRef.getData().CHIP;if(c.apfAppId&&c.apfConfId){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"editAPFConfiguration",route:"app",context:c.apfAppId+"/config/"+c.apfConfId});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"editAPFConfiguration"});}}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:(p)});setTimeout(function(){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:(p)});},0);}}this.saveTile(n);},fetchChipData:function(o){var t=this;var f={};if(this.createMode){var e={};if(o.evalContextPath){var a=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.evalContextPath);e=this.metadataRef.getEvaluationById({context:a,texts_for_chip:true,entity:"EVALUATIONS_MODELER",model:t.oApplicationFacade.getODataModel()});f=this.formModelByEvaluation(e);}}else if(this.editMode){var c={};if(o.chipContextPath){var b=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.chipContextPath);c=this.metadataRef.getChipById({context:b,evaluation:true,texts:true,model:t.oApplicationFacade.getODataModel()});f=this.formModelByChip(c);}}else{f={CHIP:{}};}this.currentContextState=f.CHIP.isActive;this.currentChipId=f.CHIP.id;this.fetchOtherInfoAsync(f);return f;},formModelByEvaluation:function(e){var t=this;var o=e.EVALUATION;var c={CHIP:{}};if(e.TEXTS_FOR_CHIP&&e.TEXTS_FOR_CHIP.length){e.TEXTS=e.TEXTS_FOR_CHIP;}c.CHIP.id="";c.CHIP.isActive=0;c.CHIP.evaluationId=o.ID;c.CHIP.tileType="NT";c.CHIP.dualTileType="CT";c.CHIP.title=o.INDICATOR_TITLE||"";c.CHIP.description=o.TITLE||"";c.CHIP.url=c.url||this.getChipUrl(c.tileType);c.CHIP.keywords="";c.CHIP.configuration="";c.CHIP.storyId="";c.CHIP.navType=(!(o.ACTION)||(o.ACTION==this.sbAction))?"0":"4";if(c.CHIP.navType=="0"){c.CHIP.semanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";c.CHIP.semanticAction=o.ACTION||this.sbAction;}else{c.CHIP.semanticObject=this.lumiraSemanticObject;c.CHIP.semanticAction=this.lumiraAction;}this.onLoadSemanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";this.onLoadSemanticAction=o.ACTION||this.sbAction;c.CHIP.appParameters=[];c.CHIP.dimension="";c.CHIP.sortOrder="0";c.CHIP.semanticColorContribution="Neutral";c.CHIP.frameType='OneByOne';c.CHIP.totalValueMeasure='';c.CHIP.isKPIMeasureFractionMeasureHarvey=true;c.CHIP.isKPIMeasureTotalMeasureHarvey=false;c.CHIP.HARVEY_DIMENSION=[];c.CHIP.harveyFilters=[{NAME:"",LABEL:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];c.CHIP.MULTI_MEASURE=[{COLUMN_NAME:o.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];c.TEXTS=[];var C={};for(var i=0,l=e.TEXTS.length;i<l;i++){C={};C.id="";C.title=e.TEXTS[i].TITLE;C.description=e.TEXTS[i].DESCRIPTION;C.language=e.TEXTS[i].LANGUAGE;c.TEXTS.push(C);}c.EVALUATION=o;return c;},formModelByChip:function(c){var t=this;var o=c.CHIP;var a={CHIP:{}};var b;if(c.EVALUATION_INFO){a.EVALUATION=c.EVALUATION_INFO;}a.TEXTS=c.TEXTS;a.CHIP.id=o.id||"";a.CHIP.isActive=o.isActive;a.CHIP.evaluationId=o.evaluationId||"";a.CHIP.tileType=o.tileType||"NT";if(o.tileType=="DT-CT"){a.CHIP.dualTileType="CT";a.CHIP.tileType="DT";}else if(o.tileType=="DT-CM"){a.CHIP.dualTileType="CM";a.CHIP.tileType="DT";}else if(o.tileType=="DT-AT"){a.CHIP.dualTileType="AT";a.CHIP.tileType="DT";}else if(o.tileType=="DT-TT"){a.CHIP.dualTileType="TT";a.CHIP.tileType="DT";}a.CHIP.title=o.title||"";a.CHIP.description=o.description||"";a.CHIP.url=o.url||this.getChipUrl(a.tileType);a.CHIP.keywords=o.keywords||"";a.CHIP.configuration=o.configuration||"";var d=null;var f=null;var g=null;var h=null;try{a.CHIP.configurationObj=JSON.parse(a.CHIP.configuration);if(a.CHIP.configurationObj&&a.CHIP.configurationObj.tileConfiguration){d=JSON.parse(a.CHIP.configurationObj.tileConfiguration);if(d&&d.TILE_PROPERTIES){f=JSON.parse(d.TILE_PROPERTIES);if(f){a.CHIP.navType=f.navType||"0";a.CHIP.frameType=f.frameType||'OneByOne';a.CHIP.semanticObject=f.semanticObject||"";a.CHIP.semanticAction=f.semanticAction||"";this.onLoadSemanticObject=a.CHIP.semanticObject||"";this.onLoadSemanticAction=a.CHIP.semanticAction||"";a.CHIP.storyId=f.storyId||"";a.CHIP.apfConfId=f.apfConfId||"";a.CHIP.apfConfName=(f.apfConfId)?('-NA-'+f.apfConfId):"";a.CHIP.dimension=f.dimension||"";a.CHIP.HARVEY_DIMENSION=a.CHIP.HARVEY_DIMENSION||[];a.CHIP.harveyFilters=[{NAME:"",LABEL:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];if(f.harveyFilters&&f.harveyFilters.length){b={};a.CHIP.harveyFilters=[];f.harveyFilters.forEach(function(i){if(!b[i.NAME]){b[i.NAME]={NAME:i.NAME,OPERATOR:i.OPERATOR,VALUE_1:[i.VALUE_1],VALUE_2:[],LABEL:i.NAME};a.CHIP.harveyFilters.push(b[i.NAME]);}else{b[i.NAME].VALUE_1.push(i.VALUE_1);}});if(a.CHIP.HARVEY_DIMENSION.length==0){a.CHIP.HARVEY_DIMENSION.push({name:f.harveyFilters[0].NAME,label:f.harveyFilters[0].NAME});}}a.CHIP.totalValueMeasure=f.harveyTotalMeasure;a.CHIP.isKPIMeasureFractionMeasureHarvey=f.isFractionMeasure;a.CHIP.isKPIMeasureTotalMeasureHarvey=!f.isFractionMeasure;a.CHIP.sortOrder=f.sortOrder||"";a.CHIP.semanticColorContribution=f.semanticColorContribution||"Neutral";}g=JSON.parse(d.ADDITIONAL_APP_PARAMETERS);a.CHIP.appParameters=g||[];h=JSON.parse(d.EVALUATION);if(h){a.CHIP.MULTI_MEASURE=f.COLUMN_NAMES||h.COLUMN_NAMES||[{COLUMN_NAME:a.EVALUATION.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];}}}}catch(e){jQuery.sap.log.error="Failed to parse chip";c.EVALUATION=c.EVALUATION_INFO;delete c.EVALUATION_INFO;a=t.formModelByEvaluation(c);a.CHIP.id=o.id;a.CHIP.isActive=o.isActive;this.errorConfigParse=true;}return a;},fetchOtherInfoAsync:function(o){var t=this;this.updateFooterButtons(o);var a=function(l,d,m){o.SAP_LANGUAGES=l;o.SAP_LANGUAGE_ARRAY=d;o.localLanguage=m;};this.metadataRef.getAllLanguages({async:false,success:a,model:this.oDataModel});var b=o.TEXTS;var c=[];var i;for(i=0;i<b.length;i++){if(b[i].language!=o.localLanguage){c.push(b[i]);}}var e=[];var i;for(i=0;i<c.length;i++){var f={};f.title=c[i].title;f.description=c[i].description;f.language=c[i].language;f.isoLanguage=o.SAP_LANGUAGES.SPRAS[f.language];f.isActive=o.isActive;e.push(f);}o.ADDITIONAL_LANGUAGE_ARRAY=e;o.NO_OF_ADDITIONAL_LANGUAGES=o.ADDITIONAL_LANGUAGE_ARRAY.length||0;t.byId('additionalLanguageLink').bindProperty("text","tileConfig>/NO_OF_ADDITIONAL_LANGUAGES",function(v){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";});o.CONTROL=this.getControlObject(o);try{this.oModelForEntity=this.populateDimension(o.EVALUATION.ODATA_URL,o.EVALUATION.ODATA_ENTITYSET);o.CHIP.dimension=o.CHIP.dimension||this.oModelForEntity.getData().dimensions[0].dimensionName;}catch(g){}finally{if(this.oModelForEntity.getData().dimensions.length){o.DIMENSIONS=this.oModelForEntity.getData();}else{o.DIMENSIONS=[];sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}var p=[];var h=o.CHIP.appParameters;if(h&&Object.keys(h).length){for(var k in h){if(h.hasOwnProperty(k)){p.push({NAME:k,VALUE:h[k]});}}}o.CHIP.APP_PARAMETERS=p;var j=function(m){var n={};o.TAGS={};if(m.TAGS){for(var i=0,l=m.TAGS.length;i<l;i++){o.TAGS[m.TAGS[i].TAG]=m.TAGS[i].TYPE;}}if(m.INDICATOR_TAGS){for(var i=0,l=m.INDICATOR_TAGS.length;i<l;i++){o.TAGS[m.INDICATOR_TAGS[i].TAG]="IN";}}o.FILTERS=[];if(m.FILTERS){for(var i=0,l=m.FILTERS.length;i<l;i++){n={};n.TYPE=m.FILTERS[i].TYPE;n.NAME=m.FILTERS[i].NAME;n.VALUE_1=m.FILTERS[i].VALUE_1;n.VALUE_2=m.FILTERS[i].VALUE_2;n.OPERATOR=m.FILTERS[i].OPERATOR;o.FILTERS.push(n);}}o.VALUES=[];var q={Measures:[]};q.Measures.push({COLUMN_NAME:"",COLUMN_TEXT:""});if(o.EVALUATION&&o.EVALUATION.COLUMN_NAME){q.Measures.push({COLUMN_NAME:o.EVALUATION.COLUMN_NAME,COLUMN_TEXT:o.EVALUATION.COLUMN_NAME});}if(m.VALUES){for(var i=0,l=m.VALUES.length;i<l;i++){n={};if(/^\d{2}/.test(m.VALUES[i].TYPE.toString())){q.Measures.push({COLUMN_NAME:m.VALUES[i].COLUMN_NAME,COLUMN_TEXT:m.VALUES[i].COLUMN_NAME});}else{n.TYPE=m.VALUES[i].TYPE;n.FIXED=m.VALUES[i].FIXED;n.COLUMN_NAME=m.VALUES[i].COLUMN_NAME;n.ODATA_PROPERTY=m.VALUES[i].ODATA_PROPERTY;o.VALUES.push(n);}}}if(q.Measures.length<3){t.inSufficientAdditionalMeasure=true;}var r=jQuery.extend(true,{},q,{});if(r&&r.Measures&&r.Measures.length){r.Measures[0].COLUMN_TEXT="("+t.oApplicationFacade.getResourceBundle().getText("NONE")+")";}o.ADDITIONAL_MEASURES=q;o.ADDITIONAL_MEASURES_OPT=r;if(m.TEXTS){o.TEXTS=m.TEXTS;}t.getView().getModel("tileConfig").setData(o);t.setTooltipForAllSelect();if(o.CHIP.apfConfId){var u=new sap.ui.model.odata.ODataModel("/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata",true);function v(d){if(d.length&&d[0]){t.modelRef.getData().CHIP.apfConfName=d[0].AnalyticalConfigurationName;t.modelRef.getData().CHIP.apfAppId=d[0].Application;t.getView().getModel("tileConfig").setData(t.modelRef.getData());t.initialData=jQuery.extend(true,{},t.modelRef.getData(),{});}};function w(d,s,x){};t.metadataRef.getDataByEntity({entity:"AnalyticalConfigForSemObjQueryResults",async:true,filter:("AnalyticalConfiguration eq '"+o.CHIP.apfConfId+"'"),success:v,error:w,model:u});}t.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(t.errorConfigParse){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_PARSE_CHIP_INFO"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_PARSE_CHIP_INFO")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}t.errorConfigParse=false;t.initialData=jQuery.extend(true,{},o,{});if(o.CHIP.tileType&&o.CHIP.tileType=="DT"){var y=t.getView().byId("selectTileType").getSelectedKey();t.getView().byId("selectVizRight").fireChange(y);}};t.metadataRef.getEvaluationById({ID:o.CHIP.evaluationId,IS_ACTIVE:1,async:true,success:j,noEvaluation:true,tags:true,indicator_tags:true,values:true,filters:true,entity:"EVALUATIONS",model:t.oApplicationFacade.getODataModel()});this.initializeDimensionsForHarveyFilters(o);return o;},setTooltipForAllSelect:function(){this.byId("selectTileType").setTooltip(this.byId("selectTileType").getSelectedItem().getText());this.byId("selectNavType").setTooltip(this.byId("selectNavType").getSelectedItem().getText());this.byId("selectSortOrder").setTooltip(this.byId("selectSortOrder").getSelectedItem().getText());this.byId("selectDimension").setTooltip(this.byId("selectDimension").getSelectedItem().getText());this.byId("semanticColorContribution").setTooltip(this.byId("semanticColorContribution").getSelectedItem().getText());this.byId("selectVizRight").setTooltip(this.byId("selectVizRight").getSelectedItem().getText());this.byId("measure1").setTooltip(this.byId("measure1").getSelectedItem().getText());this.byId("measureColor1").setTooltip(this.byId("measureColor1").getSelectedItem().getText());this.byId("measure2").setTooltip(this.byId("measure2").getSelectedItem().getText());this.byId("measureColor2").setTooltip(this.byId("measureColor2").getSelectedItem().getText());this.byId("measure3").setTooltip(this.byId("measure3").getSelectedItem().getText());this.byId("measureColor3").setTooltip(this.byId("measureColor3").getSelectedItem().getText());},saveTile:function(c){var t=this;t.errorMessages=[];t.errorState=false;t.isPropertyAdded=true;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var a=t.formChipConfiguration();function p(d){try{t.currentChipId=JSON.parse(d).response[0].id;}catch(e){t.currentChipId=t.currentChipId||null;}finally{t.oApplicationFacade.__tileModified=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));if(c){c();}else{t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}}}function b(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(a,mode,t,p,b);t.setFooterOnError();},checkForValidChipForActivation:function(){var t=this;var d=t.modelRef.getData();var a=d.CHIP;var e="";var c=null;if(((!(a.semanticObject)||(a.semanticObject.length==(a.semanticObject.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT"));}if(a.semanticObject.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(((!(a.semanticAction)||(a.semanticAction.length==(a.semanticAction.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION"));}if(a.semanticAction.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(((!(a.storyId)||(a.storyId.length==(a.storyId.split(" ").length-1)))&&(Number(a.navType)==1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID"));}if(a.storyId.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}if(((!(a.apfConfId)||(a.apfConfId.length==(a.apfConfId.split(" ").length-1)))&&(Number(a.navType)==2))){if((a.semanticObject===t.APF_SEMANTIC_OBECT)&&(a.semanticAction===t.APF_ACTION)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID")+"\n";t.byId("apfConfId").setValueState("Error");t.byId("apfConfId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID"));}}if(!(a.title)||(a.title.length==(a.title.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";t.byId("tileTitle").setValueState("Error");t.byId("tileTitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE"));}if(!(a.description)||(a.description.length==(a.description.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION");t.byId("tileSubtitle").setValueState("Error");t.byId("tileSubtitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION"));}if((a.tileType=="CM"||a.dualTileType=="CM")&&!(e)){c=t.formChipConfiguration();var b=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).EVALUATION);var f=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).TILE_PROPERTIES);var g=f.COLUMN_NAMES||b.COLUMN_NAMES;if(!(g)||!(g.length)||(g.length<2)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");}else{for(var i=0,l=g.length;i<l;i++){if(!(g[i].COLUMN_NAME)||!(g[i].semanticColor)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break;}}if(!e){if(g.length==2){if(g[0].COLUMN_NAME==g[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}else if(g.length==3){if(g[0].COLUMN_NAME==g[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(g.COLUMN_NAME==g[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(g[1].COLUMN_NAME==g[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}}}}return e;},selectVizRight:function(o){var r;var d=this.modelRef.getData();d.CONTROL=d.CONTROL||{};if(o.CHIP){d=o;var a=o.CHIP.dualTileType;}else{var a=this.getView().byId("selectVizRight").getSelectedKey();}if(a=="CT"){r=sap.ui.core.Fragment.byId("tiles","compchart");d.CONTROL.vDimension=true;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=true;d.CONTROL.vSemanticColorContribution=true;}else if(a=="CM"){r=sap.ui.core.Fragment.byId("tiles","compchartmul");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=true;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}else if(a=="AT"){r=sap.ui.core.Fragment.byId("tiles","bulletchart");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}else if(a=="TT"){r=sap.ui.core.Fragment.byId("tiles","areachart");d.CONTROL.vDimension=true;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}this.getView().byId("DT").getTileContent()[1].setContent(r);this.modelRef.setData(d);this.getView().byId("selectVizRight").setTooltip(this.getView().byId("selectVizRight").getSelectedItem().getText());return d;},getControlObject:function(o){var c=o.CONTROL||{};this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('TT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('AT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CM').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('DT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(o&&o.CHIP&&o.CHIP.tileType){c.isHarvey=false;switch(o.CHIP.tileType){case'NT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'AT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=false;c.vVizRight=false;break;case'TT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CM':c.vDimension=false;c.vMultiMeasure=true;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'DT':c.vDimension=false;c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=true;c.vVizRight=true;o.CONTROL=c;o=this.selectVizRight(o);c=o.CONTROL;break;case'HT':c.isHarvey=true;c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;default:break;}}if(o&&o.CHIP&&o.CHIP.navType){switch(o.CHIP.navType.toString()){case'0':c.vSemanticObject=true;c.vAction=true;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;c.vAPFConfId=false;break;case'1':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=true;c.vSelectNavType=true;c.vAPFConfId=false;break;case'2':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=true;break;case'3':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;case'4':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;case'5':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;default:break;}}return c;},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},getInitialModelData:function(){var c={};c.vStoryId=false;c.vAPFConfId=false;c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;return{CONTROL:c};},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.addEvaluation.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.addEvaluation.controller');
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.addEvaluation",{onInit:function(){var t=this;this.context=null;var s=false;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");var o={onBack:function(){t.navigateBack();},bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){if(!(t.validateEvalId())){if(t.getView().getModel().getData().mode=="create"){s=t.saveEvaluation();}else{s=t.updateEvaluation();}if(s){t.refreshMasterList();t.navigateBack();}}}},buttonList:[{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.navigateBack();}}]};this.setHeaderFooterOptions(o);this.busyDialog=new sap.m.BusyDialog();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.evalCreateModel=new sap.ui.model.json.JSONModel({NO_OF_ADDITIONAL_LANGUAGES:0});this.getView().setModel(this.evalCreateModel);this.oDataServiceUrl=this.metadataRef.getDesigntimeServiceUrl();this.oDataModel=new sap.ui.model.odata.ODataModel(t.oDataServiceUrl,true);this.oModelForInputParameters=new sap.ui.model.json.JSONModel();this.oModelForDimensions=new sap.ui.model.json.JSONModel();this.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);this.setInputParameterAndFilterLayout();this.decideMode();},saveEvaluation:function(){var m=this.evalCreateModel.getData();var t=this;var s=false;var l=[];var a=null;if(m.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<m.NO_OF_ADDITIONAL_LANGUAGES;i++){a={};a.LANGUAGE=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;a.TITLE=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;a.DESCRIPTION=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;l.push(a);}}this.saveFilters(t.getView());var p={"keys":{"ID":m.ID,"IS_ACTIVE":1},"payload":{"EVALUATION":{"TITLE":m.TITLE,"DESCRIPTION":m.DESCRIPTION,"SCALING":m.SCALING,"INDICATOR":m.INDICATOR,"ODATA_URL":m.ODATA_URL,"ODATA_ENTITYSET":m.ODATA_ENTITYSET,"VIEW_NAME":m.VIEW_NAME,"COLUMN_NAME":m.COLUMN_NAME,"OWNER_NAME":m.OWNER_NAME,"OWNER_E_MAIL":m.OWNER_E_MAIL,"OWNER_ID":m.OWNER_ID,"ODATA_PROPERTY":m.ODATA_PROPERTY,"SEMANTIC_OBJECT":m.SEMANTIC_OBJECT,"ACTION":m.ACTION,"VALUES_SOURCE":m.VALUES_SOURCE,"INDICATOR_TYPE":m.INDICATOR_TYPE,"GOAL_TYPE":m.GOAL_TYPE,"ENTITY_TYPE":"EV"},"FILTERS":this.evalFiltersPayload,"TEXTS":l,"PROPERTIES":[{"NAME":"SAP:Copied_From","VALUE":t.byId('evalTemplateId').getValue(),"TYPE":"EV"}],"VALUES":m.VALUES}};this.metadataRef.create("EVALUATIONS",p,null,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("EVALUATION_SAVED_SUCCESSFULLY"));s=true;},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_EVALUATION"));s=false;},false);return s;},updateEvaluation:function(){var m=this.evalCreateModel.getData();var t=this;var s=false;var l=[];var a=null;if(m.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<m.NO_OF_ADDITIONAL_LANGUAGES;i++){a={};a.LANGUAGE=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;a.TITLE=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;a.DESCRIPTION=m.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;l.push(a);}}this.saveFilters(t.getView());var p={"keys":{"ID":m.ID,"IS_ACTIVE":1,},"payload":{"EVALUATION":{"update":{"TITLE":m.TITLE,"DESCRIPTION":m.DESCRIPTION,"SCALING":m.SCALING,"INDICATOR":m.INDICATOR,"ODATA_URL":m.ODATA_URL,"ODATA_ENTITYSET":m.ODATA_ENTITYSET,"VIEW_NAME":m.VIEW_NAME,"COLUMN_NAME":m.COLUMN_NAME,"OWNER_NAME":m.OWNER_NAME,"OWNER_E_MAIL":m.OWNER_E_MAIL,"OWNER_ID":m.OWNER_ID,"ODATA_PROPERTY":m.ODATA_PROPERTY,"SEMANTIC_OBJECT":m.SEMANTIC_OBJECT,"ACTION":m.ACTION,"VALUES_SOURCE":m.VALUES_SOURCE,}},"FILTERS":{"remove":t.OLD_FILTER_DATA,"create":t.evalFiltersPayload},"TEXTS":{"remove":t.OLD_ADDITIONAL_LANGUAGE_ARRAY,"create":l,},}};this.metadataRef.update("EVALUATIONS",p,null,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("EVALUATION_SAVED_SUCCESSFULLY"));s=true;},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_EVALUATION"));s=false;},null,null,false);return s;},saveFilters:function(f){this.evalFiltersPayload=[];this.getInputParamPayload(f);this.getFiltersPayload(f);},getInputParamPayload:function(f){var e={},j=0;var a=f.getModel().getData();if(f.getController().oModelForInputParameters){e=f.getController().oModelForInputParameters.getData();if(e.inputParameters){if(e.inputParameters.length>0){var i=0,b=[],c;while(i<e.inputParameters.length){if(e.inputParameters[i].operator==="BT"){if((e[i].value_1!=="")||(e[i].value_2!=="")){b=e.inputParameters[i].value_1.split(",");c=e.inputParameters[i].value_2.split(",");if((c.length===1)&&(!b.length===1)){e.inputParameters[i].value_1=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_1).toJSON():e.inputParameters[i].value_1;e.inputParameters[i].value_2=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_2).toJSON():e.inputParameters[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,e.inputParameters[i].value_1,e.inputParameters[i].value_2);j++;}}}else{b=e.inputParameters[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!==""){b[k]=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,b[k]);j++;}}}}i++;}}}}},getFiltersPayload:function(f){var a=f.getModel().getData();var e={},j=this.evalFiltersPayload.length;if(f.getController().oModelForDimensions){e=f.getController().oModelForDimensions.getData();if(e.selectedDimensions){if(e.selectedDimensions.length>0){var i=0,b=[],c;while(i<e.selectedDimensions.length){if(e.selectedDimensions[i].operator==="BT"){if((e.selectedDimensions[i].value_1!=="")&&(e.selectedDimensions[i].value_2!=="")){b=e.selectedDimensions[i].value_1.split(",");c=e.selectedDimensions[i].value_2.split(",");if((c.length===1)||(!b.length===1)){e.selectedDimensions[i].value_1=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_1).toJSON():e.selectedDimensions[i].value_1;e.selectedDimensions[i].value_2=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_2).toJSON():e.selectedDimensions[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,e.selectedDimensions[i].value_1,e.selectedDimensions[i].value_2);j++;}}}else{b=e.selectedDimensions[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!=""){b[k]=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,b[k]);j++;}}}}i++;}}}}},navigateBack:function(){this.byId('evalTemplateIdLabel').setVisible(true);this.byId('evalTemplateId').setVisible(true);this.byId('evalTemplateId').setEditable(true);this.byId('evalTemplateId').setValue("");this.byId('evalId').setEditable(true);var e=this.evalCreateModel.getData().ID||null;this.getView().getModel().setData({NO_OF_ADDITIONAL_LANGUAGES:0});this.resetDimensionsAndInputParameters();if(e){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:"EVALUATIONS_MODELER(ID='"+e+"',IS_ACTIVE=1)"});}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile"});}},listAllActiveEvaluations:function(){var t=this;var e=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_EVALUATION"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/EVALUATIONS_MODELER",template:new sap.m.ObjectListItem({title:{parts:[{path:"TITLE"},{path:"INDICATOR_TITLE"}],formatter:jQuery.proxy(t.formatTitleInEvalDialog,t)},attributes:[new sap.m.ObjectAttribute({text:"{ID}"})]})},confirm:function(E){t.byId('evalTemplateId').setValue(E.getParameter("selectedItem").getAttributes()[0].getText());t.byId('evalTemplateId').fireChange();},liveChange:function(E){var s=E.getParameter("value");var F=new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("TITLE",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("INDICATOR_TITLE",sap.ui.model.FilterOperator.Contains,s);var b=new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.StartsWith,".");var B=E.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o,a],false);var d=new sap.ui.model.Filter([b],true);B.filter(new sap.ui.model.Filter([c,d],true));}});e.setModel(t.oDataModel);var f=[];f.push(new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.StartsWith,"."));e.getBinding("items").filter(new sap.ui.model.Filter(f,true));e.open();},formatTitleInEvalDialog:function(e,i){var t=this;return((i||t.oResourceBundle.getText("TITLE_UNAVAILABLE"))+" - "+(e||t.oResourceBundle.getText("TITLE_UNAVAILABLE")));},changeEvalTemplate:function(){this.resetDimensionsAndInputParameters();this.setInputParameterAndFilterLayout();this.populateEvalDetails();},decideMode:function(){var t=this;this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="editEvaluation"){t.getView().getModel().setProperty("/mode","edit");t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(e.getParameter("arguments").contextPath));var i=(/ID=\'.*\'/).exec(e.getParameter("arguments").contextPath)[0];var a=i.slice(i.indexOf("'")+1,i.lastIndexOf("'"));t.populateEvalDetails(a);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("EDIT_EVALUATION"));t.byId("evalId").setEditable(false);}else if(e.getParameter("name")==="addEvaluation"){t.getView().getModel().setProperty("/mode","create");t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.populateEvalDetails(null);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("ADD_EVALUATION"));t.busyDialog.close();}},this);},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},formObjectForFilters:function(l){var i=0,j=0,k=0,t=[],a;for(i=0;i<l.length;i++){if(l[i].OPERATOR=="BT"){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a;}else{for(k=0;k<t.length;k++){if((t[k].name==l[i].NAME)&&(t[k].operator==l[i].OPERATOR)){break;}}if(k==t.length){a={};a={"name":l[i].NAME,"operator":l[i].OPERATOR,"value_1":l[i].VALUE_1,"value_2":l[i].VALUE_2};t[j++]=a;}else{t[k].value_1+=","+l[i].VALUE_1;}}}return t;},populateEvalDetails:function(a){var t=this;var b=null;var c=null;t.busyDialog.open();if(this.evalCreateModel.getData().mode=="create"){if(this.byId('evalTemplateId').getValue()){a=this.byId('evalTemplateId').getValue();this.byId('dataSourcePanel').setVisible(true);this.byId('dataSourcePanel').setExpanded(false);}else{this.byId('dataSourcePanel').setVisible(false);}}if(a){c={ID:a,IS_ACTIVE:1};evaluationMetaData=t.metadataRef.getEvaluationById({ID:a,IS_ACTIVE:1,entity:"EVALUATIONS_MODELER",async:false,texts:true,values:true,filters:true,properties:true,tags:true,model:t.oDataModel});if(evaluationMetaData.EVALUATION){b={};var d=evaluationMetaData.EVALUATION.ID;evaluationMetaData.EVALUATION.ID=(d.indexOf(".")===0)?d.substring(1):d;b=t._cloneObj(evaluationMetaData.EVALUATION);evalTextData=t._cloneObj(evaluationMetaData.TEXTS);evalFilterData=t._cloneObj(evaluationMetaData.FILTERS);evalValueData=t._cloneObj(evaluationMetaData.VALUES);evalPropertiesData=t._cloneObj(evaluationMetaData.PROPERTIES);t.getView().getModel().setProperty("/ID",b.ID);if(t.evalCreateModel.getData().mode=="edit"){t.byId('evalTemplateId').setVisible(false);t.byId('evalTemplateIdLabel').setVisible(false);}t.getView().getModel().setProperty("/TITLE",b.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",b.DESCRIPTION);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",b.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/SCALING",b.SCALING);t.getView().getModel().setProperty("/ACTION",b.ACTION);t.getView().getModel().setProperty("/GOAL_TYPE",b.GOAL_TYPE);t.getView().getModel().setProperty("/INDICATOR_TYPE",b.INDICATOR_TYPE);t.getView().getModel().setProperty("/OWNER_NAME",b.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",b.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",b.OWNER_E_MAIL);t.getView().getModel().setProperty("/VALUES_SOURCE",b.VALUES_SOURCE);t.getView().getModel().setProperty("/VIEW_NAME",b.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",b.ODATA_URL);if(b.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",b.ODATA_ENTITYSET);try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.resetDimensionsAndInputParameters();t.busyDialog.close();}}t.getView().getModel().setProperty("/COLUMN_NAME",b.COLUMN_NAME);t.getView().getModel().setProperty("/INDICATOR",b.INDICATOR);t.getView().getModel().updateBindings();var l=function(q,r,s){t.SAP_LANGUAGES=q;t.SAP_LANGUAGE_ARRAY=r;t.languageKeyModelData=t._cloneObj(r);t.localLanguage=s;t.localLAISOLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();};this.metadataRef.getAllLanguages({async:false,success:l,model:this.oDataModel});var f=[];var i;for(i=0;i<evalTextData.length;i++){if(evalTextData[i].LANGUAGE!=t.localLanguage){f.push(evalTextData[i]);}}var g=[];var i;for(i=0;i<f.length;i++){var h={};h.ADDITIONAL_LANGUAGE_TITLE=f[i].TITLE;h.ADDITIONAL_LANGUAGE_DESCRIPTION=f[i].DESCRIPTION;h.ADDITIONAL_LANGUAGE_SPRAS_KEY=f[i].LANGUAGE;if(t.SAP_LANGUAGES){h.ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[f[i].LANGUAGE];}else{h.ADDITIONAL_LANGUAGE_KEY="";}g.push(h);}t.OLD_ADDITIONAL_LANGUAGE_ARRAY=f;t.getView().getModel().setProperty("/ADDITIONAL_LANGUAGE_ARRAY",g);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",g.length);t.OLD_FILTER_DATA=evalFilterData;if(evalFilterData&&evalFilterData.length>0){var m=[],n=[],j=0,k=0;for(var i=0;i<evalFilterData.length;i++){if(evalFilterData[i].TYPE==="PA"){m[j]={};m[j++]=evalFilterData[i];}else if(evalFilterData[i].TYPE==="FI"){n[k]={};n[k++]=evalFilterData[i];}}if(m.length>0){var o={};o.inputParameters=[];o.inputParameters=t.formObjectForFilters(m);for(var i=0;i<t.oModelForInputParameters.getData().inputParameters.length;i++){for(var j=0;j<o.inputParameters.length;j++){if(t.oModelForInputParameters.getData().inputParameters[i].name===o.inputParameters[j].name){t.oModelForInputParameters.getData().inputParameters[i].value_1=o.inputParameters[j].value_1;t.oModelForInputParameters.getData().inputParameters[i].value_2=o.inputParameters[j].value_2;}}}t.oModelForInputParameters.updateBindings();}if(n.length>0){var p={};p.selectedDimensions=[];p.selectedDimensions=t.formObjectForFilters(n);t.oModelForDimensions.getData().selectedDimensions=p.selectedDimensions;t.oModelForDimensions.updateBindings();}}if(evalValueData){t.OLD_VALUES=evalValueData;t.getView().getModel().setProperty("/VALUES",evalValueData);t.formatEvalValues();}t.OLD_PROPERTIES=evalPropertiesData;t.getView().getModel().setProperty("/PROPERTIES",evalPropertiesData);t.busyDialog.close();}else{t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST"));}}},formatEvalValues:function(){var e=this.evalCreateModel.getData();var t=this;e.TA=null;e.TC=null;e.RE=null;e.CL=null;e.CH=null;e.WL=null;e.WH=null;for(var i=0;i<e.VALUES.length;i++){if((e.VALUES_SOURCE=="FIXED")){e[e.VALUES[i]["TYPE"]]=e.VALUES[i]["FIXED"];}else if(e.VALUES_SOURCE=="MEASURE"){e[e.VALUES[i]["TYPE"]]=e.VALUES[i]["COLUMN_NAME"];}}if(e.GOAL_TYPE=="RA"){this.byId('CHlabel').setText(t.oResourceBundle.getText("CRITICAL_HIGH"));this.byId('CLlabel').setText(t.oResourceBundle.getText("CRITICAL_LOW"));this.byId('WHlabel').setText(t.oResourceBundle.getText("WARNING_HIGH"));this.byId('WLlabel').setText(t.oResourceBundle.getText("WARNING_LOW"));}else if(e.GOAL_TYPE=="MA"){this.byId('CHlabel').setVisible(false);this.byId('CHinput').setVisible(false);this.byId('WHlabel').setVisible(false);this.byId('WHinput').setVisible(false);this.byId('CLlabel').setText(t.oResourceBundle.getText("CRITICAL"));this.byId('WLlabel').setText(t.oResourceBundle.getText("WARNING"));}else if(e.GOAL_TYPE=="MI"){this.byId('CLlabel').setVisible(false);this.byId('CLinput').setVisible(false);this.byId('WLlabel').setVisible(false);this.byId('WLinput').setVisible(false);this.byId('CHlabel').setText(t.oResourceBundle.getText("CRITICAL"));this.byId('WHlabel').setText(t.oResourceBundle.getText("WARNING"));}this.evalCreateModel.setData(e);this.evalCreateModel.updateBindings();},validateEvalId:function(){var t=this;var e=this.getView().byId('evalId');var i=0;var a=e.getValue();if(a){if((!(/^[a-zA-Z0-9.]*$/.test(a)))||(a.indexOf(".")===0)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));e.setValueState("Error");return true;}else{e.setValueState("None");var b=this.metadataRef.getEvaluationById({ID:a,IS_ACTIVE:1,model:t.oDataModel});if(b&&b.EVALUATION){e.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a));return true;}else{e.setValueState("None");}}}return false;},formatLangCount:function(v){if(!this.getView().getModel().getData()){v=0;}else v=this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES;return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=jQuery.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var d=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(d,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getKey()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getKey()));return;}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_LANGUAGE_SPRAS_KEY":t.languageKeySelect.getSelectedItem().getKey()};for(var i=0;i<t.SAP_LANGUAGE_ARRAY.length;i++){if(t.languageKeySelect.getSelectedItem().getText()==t.SAP_LANGUAGE_ARRAY[i].LAISO){b.ADDITIONAL_LANGUAGE_KEY_DESCRIPTION=t.SAP_LANGUAGE_ARRAY[i].SPTXT}}t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close();}})});if(t.SAP_LANGUAGE_ARRAY&&t.SAP_LANGUAGE_ARRAY.length){var m=new sap.ui.model.json.JSONModel();for(i=0;i<t.SAP_LANGUAGE_ARRAY.length;i++){if(t.SAP_LANGUAGE_ARRAY[i].LAISO==t.localLAISOLanguage){t.languageKeyModelData.splice(i,1);}}m.setData(t.languageKeyModelData);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));}a.open();},populateDimensionsAndInputParameters:function(d,e){var a=[];var b=[];this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(d),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e);var q=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensionsWithProperty(d,e);for(k in q){var n=q[k].getName();var p=q[k].getKeyProperty().type;var c={name:n,propertyType:p};a.push(c);}var f=this.oModelForDimensions.getData();f.dimensions=a;f.dataSource=d;f.entitySet=e;if(f.selectedDimensions){for(var k in f.selectedDimensions){f.selectedDimensions[k].propertyType=this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name)?this.queryResultObj.findDimensionByName(f.selectedDimensions[k].name).getKeyProperty().type:"";if(f.selectedDimensions[k].propertyType=="Edm.DateTime"){var v=f.selectedDimensions[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds();}}f.selectedDimensions[k].value_1=v.join(",");v=null;v=f.selectedDimensions[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds();}}f.selectedDimensions[k].value_2=v.join(",");this.dimensionValue[f.selectedDimensions[k].name]=this.dimensionValue[f.selectedDimensions[k].name]?this.dimensionValue[f.selectedDimensions[k].name]:{};this.dimensionValue[f.selectedDimensions[k].name]["value_1"]=f.selectedDimensions[k].value_1;this.dimensionValue[f.selectedDimensions[k].name]["value_2"]=f.selectedDimensions[k].value_2;}}}this.oModelForDimensions.setData(f);var o=this.queryResultObj.getParameterization();if(o){if(this.oModelForInputParameters.getData().inputParameters){var b=this.oModelForInputParameters.getData().inputParameters;for(var k in b){b[k].propertyType=o.findParameterByName(b[k].name).getProperty().type;if(b[k].propertyType=="Edm.DateTime"){var v=b[k].value_1.split(",");for(i in v){if(v[i]!=""){var g=new Date(v[i]);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds();}}b[k].value_1=v.join(",");v=null;v=b[k].value_2.split(",");for(var i in v){if(v[i]!=""){var g=new Date(f.selectedDimensions[k].value_2);var m=g.getMonth()+1;m=/^\d$/.test(m)?"0"+m:m;var h=g.getDate();h=/^\d$/.test(h)?"0"+h:h;var j=g.getHours();j=/^\d$/.test(j)?"0"+j:j;var l=g.getMinutes();l=/^\d$/.test(l)?"0"+l:l;var s=g.getSeconds();s=/^\d$/.test(s)?"0"+s:s;v[i]=g.getFullYear()+"-"+m+"-"+h+" "+j+":"+l+":"+s+"."+g.getMilliseconds();}}b[k].value_2=v.join(",");}}}else{var r=o.getAllParameters();for(var k in r){var n=r[k].getName();var p=r[k].getProperty().type;var t=r[k].isOptional();var c={name:n,propertyType:p,operator:"EQ",value_1:"",value_2:""};b.push(c);}}if(b.length>0)this.byId("inputParameterLayoutHeaders").setVisible(true);f=this.oModelForInputParameters.getData();f.inputParameters=b;this.oModelForInputParameters.setData(f);}},setFilterPayload:function(i,t,n,o,v,a){var b={};b.ID=i;b.IS_ACTIVE=1;b.TYPE=t;b.NAME=n;b.OPERATOR=o;b.VALUE_1=v;if(a)b.VALUE_2=a;else b.VALUE_2="";return b;},setInputParameterAndFilterLayout:function(){var t=this;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("inputParameterBaseLayout").setModel(this.oModelForInputParameters);this.byId("inputParameterBaseLayout").bindAggregation("items","/inputParameters",function(i,c){var a=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var b=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var d=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),a,b]});return d;});this.byId("dimensionLayoutHeaders").setVisible(false);this.byId("baseDimensionLayout").setModel(this.oModelForDimensions);this.byId("baseDimensionLayout").bindAggregation("items","/selectedDimensions",function(i,c){var d=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("GREATER_THAN"),key:"GT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("LESS_THAN"),key:"LT"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("NOT_EQUAL_TO"),key:"NE"}),new sap.ui.core.Item({text:t.oResourceBundle.getText("BETWEEN"),key:"BT"})],selectedKey:"{operator}",change:jQuery.proxy(t.handleOperatorChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var a=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],showValueHelp:true,valueState:{path:"error_1",formatter:function(j){if(j)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var b=new sap.m.Input({value:"{value_2}",customData:[{key:"valueType",value:"value_2"}],showValueHelp:true,visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}},valueState:{path:"error_2",formatter:function(j){if(j)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueToHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L4 M4"})});var e=new sap.m.Label({text:"To",visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}}});var f=new sap.m.VBox({items:[a,e,b],layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var g=new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(j){var p=j.getSource().getBindingContext().getPath();if(t.dimensionValue){if(t.dimensionValue[j.getSource().getBindingContext().getObject().name]){delete t.dimensionValue[j.getSource().getBindingContext().getObject().name]}}j.getSource().getBindingContext().getModel().getData().selectedDimensions.splice(p.substring(p.lastIndexOf("/")+1),1);j.getSource().getBindingContext().getModel().updateBindings();if(j.getSource().getBindingContext().getModel().getData().selectedDimensions.length==0){t.byId("dimensionLayoutHeaders").setVisible(false);}}});var h=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),d,f,g]});return h;});},openInputParameterValueHelpDialog:function(n){var t=this;var i=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",template:new sap.m.StandardListItem({title:"{"+n+"}",})},confirm:function(e){},liveChange:function(e){}});i.setGrowingThreshold(100);i.open();},openDimensionDialog:function(){var t=this;if(!this.dimensionDialog){var s=new sap.ui.model.Sorter("name",false);this.dimensionDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_DIMENSIONS"),multiSelect:true,items:{path:"/dimensions",sorter:s,template:new sap.m.StandardListItem({title:"{name}"})},confirm:function(e){var a=t.oModelForDimensions.getData().selectedDimensions||[];var b=e.getParameter("selectedItems");var c=[];for(var k in b){c[k]=b[k].getBindingContext();}for(var k in c){var d=t._cloneObj(c[k].getObject());d.value_1="";d.value_2="";d.operator="EQ";a.push(d);}if(c.length>0)t.byId("dimensionLayoutHeaders").setVisible(true);else t.byId("dimensionLayoutHeaders").setVisible(false);t.oModelForDimensions.setProperty("/selectedDimensions",a);},liveChange:function(e){var a=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");b.filter([f]);}});this.dimensionDialog.setGrowingThreshold(100);this.dimensionDialog.setModel(this.oModelForDimensions);}this.dimensionDialog.open();},handleDimensionValueHelp:function(e){this.openDimensionValueHelpDialog(e,"value_1");},handleDimensionValueToHelp:function(e){this.openDimensionValueHelpDialog(e,"value_2");},openDimensionValueHelpDialog:function(e,v){var t=this;var p=e.getSource();var b=this.getView().getModel();var d=new sap.ui.model.json.JSONModel();var a=[];this.dimensionContext=e.getSource().getBindingContext();var c=e.getSource().getBindingContext().getProperty("name");var f=e.getSource().getBindingContext().getProperty("operator");var g=e.getSource().getBindingContext().getProperty("propertyType");var h=this.oModelForInputParameters.getData().inputParameters;for(var l in h){a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:h[l].value_1,VALUE_2:h[l].value_2,TYPE:"PA"});}var q=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:b.getProperty("/ODATA_URL"),entitySet:b.getProperty("/ODATA_ENTITYSET"),filter:a,dimension:c});q.model.read(q.uri,null,null,false,function(r){if(t.dimensionValue[c]){t.dimensionValue[c][v]=t.dimensionValue[c][v]?t.dimensionValue[c][v]:"";var u=t.dimensionValue[c][v]===""?null:t.dimensionValue[c][v].split(",");for(l in u){var w=true;for(var i in r.results){if(g=="Edm.DateTime"){var x=new Date(u[l]).toJSON();var y=new Date(r.results[i][c]).toJSON();if(x==y){w=false;break;}}else if(u[l]===r.results[i][c]){w=false;break;}}if(w){var z={};z[c]=u[l];z.userInput=true;z.selected=true;r.results.push(z);}else r.results[i].selected=true;}}d.setData(r);},function(r){});var s=new sap.ui.model.Sorter(c,false,function(r){if(r.getProperty("userInput")===true)return{key:"USER_VALUES",text:t.oResourceBundle.getText("VALUES_ENTERED_BY_USER")};else return{key:"SERVICE_VALUES",text:t.oResourceBundle.getText("VALUES_FETCHED_FROM_SERVICE")};});this.dimensionValueHelpDialogs=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",sorter:s,template:new sap.m.StandardListItem({title:"{"+c+"}",selected:"{selected}"})},confirm:function(e){var r="";var C=e.getParameter("selectedContexts");for(var l in C){if(g=="Edm.DateTime"){var u=new Date(C[l].getProperty(t.dimensionContext.getProperty("name")));var w=u.getMonth()+1;w=/^\d$/.test(w)?"0"+w:w;var x=u.getDate();x=/^\d$/.test(x)?"0"+x:x;var y=u.getHours();y=/^\d$/.test(y)?"0"+y:y;var z=u.getMinutes();z=/^\d$/.test(z)?"0"+z:z;var A=u.getSeconds();A=/^\d$/.test(A)?"0"+A:A;r=r+u.getFullYear()+"-"+w+"-"+x+" "+y+":"+z+":"+A+"."+u.getMilliseconds()+",";}else r=r+C[l].getProperty(t.dimensionContext.getProperty("name"))+",";}r=r.substring(0,r.length-1);t.oModelForDimensions.setProperty(t.dimensionContext.getPath()+"/"+v,r);p.fireChange({value:r});t.dimensionValue[c]=t.dimensionValue[c]?t.dimensionValue[c]:{};t.dimensionValue[c][v]=r;},liveChange:function(e){var r=e.getParameter("value");var F=new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,r);var B=e.getSource().getBinding("items");B.filter([F]);}});this.dimensionValueHelpDialogs.setGrowingThreshold(100);this.dimensionValueHelpDialogs.setModel(d);var m=this.oModelForDimensions.getData().selectedDimensions;var n=this.dimensionValueHelpDialogs.getItems();for(var i=0;i<m.length;i++){if((c===m[i].name)&&(f===m[i].operator)){var o;if(m[i].operator==="BT"){if(v==="value_1")o=m[i].value_1.split(",");else o=m[i].value_2.split(",");}else{o=m[i].value_1.split(",");}for(var j=0;j<o.length;j++){for(var k=1;k<n.length;k++){if(o[j]===n[k].getTitle()){n[k].setSelected(true);}}}}}this.dimensionValueHelpDialogs.open();for(var i=1;i<n.length;i++){if(!n[i].getSelected()){this.dimensionValueHelpDialogs.getItems()[i].setSelected(true);this.dimensionValueHelpDialogs.getItems()[i].setSelected(false);}}},handleDimensionValueChange:function(e){this.validateValue(e,"dimensionValue");var v=e.getSource().getCustomData()[0].getValue();var d=e.getSource().getBindingContext().getProperty("name");if(!this.dimensionValue[d])this.dimensionValue[d]={};this.dimensionValue[d][v]=e.getParameter("value");},validateValue:function(e,s){var t=this,r;var d=e.getSource().getBindingContext().getProperty("name");var v=e.getSource().getCustomData()[0].getValue();var a=(s==="dimensionValue")?e.getParameter("value").split(","):e.getSource().getBindingContext().getProperty("value_1");var o=e.getSource().getBindingContext().getProperty("operator");if(o==="BT"){if(a.length>1){r=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d));var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}var b=e.getSource().getBindingContext().getProperty("propertyType");var c,f;for(var k in a){r=true;var g=/<(script)(.*)\/?>/i;var j=/function\s*[^\(]*\(\s*([^\)]*)\)/;var h=/[^\(]*\(\s*([^\)]*)\)\s*{/;if(g.test(a[k])||j.test(a[k])||h.test(a[k])){r=false;c=t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",d);}if(b=="Edm.Int32"||b=="Edm.Int16"||b=="Edm.Int64"){f=/^[-+]?\d+$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_INTEGER",d);}else if(b=="Edm.Decimal"){f=/^[-+]?\d+(\.\d+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DECIMAL",d);}else if(b=="Edm.DateTime"){f=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s([0-1][0-9]|2[0-3]):[0-5][0-9]:([0-9]|[0-5][0-9])[.][0-9]+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DATE",d);}if(!r){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(c);var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}},handleOperatorChange:function(e){var c=e.getSource().getBindingContext();c.getObject().value_1="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_1="";}}if(c.getProperty("operator")==="BT"){c.getObject().value_2="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_2="";}}}c.getModel().updateBindings();},validateDimensionsAndInputParameters:function(){var i=this.oModelForInputParameters.getData().inputParameters;var d=this.oModelForDimensions.getData().selectedDimensions;var e=false;var a="";var b="";for(var k in i){if(i[k].error_1===true||i[k].error_2===true)e=true;if(i[k].value_1===""){e=true;a="mandatoryFieldEmpty";i[k].error_1=true;}}this.oModelForInputParameters.updateBindings();for(var k in d){if(d[k].error_1===true||d[k].error_2===true){e=true;a="invalidEntry";b=d[k];}if(d[k].value_1===""){e=true;a="fieldEmpty";d[k].error_1=true;}if(d[k].operator==="BT"&&d[k].value_2===""){e=true;a="fieldEmpty";d[k].error_2=true;}}this.oModelForDimensions.updateBindings();return{error:e,errorType:a,errorDimension:b};},resetDimensionsAndInputParameters:function(){this.oModelForDimensions.setData({});this.oModelForInputParameters.setData({});this.dimensionDialog=null;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("inputParameterLayoutHeaders").setVisible(false);this.byId("dimensionLayoutHeaders").setVisible(false);},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v));},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.emptyView.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.emptyView.controller');
/*
 * Copyright (C) 2009-2013 SAP AG or an SAP affiliate company. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.ca.ui.images.images');jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("/")+"/sap/ca/scfld/md/css/flower.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.emptyView",{onInit:function(){var i=this.byId("flower");if(i){i.setSrc(sap.ca.ui.images.images.Flower);}this.getView().addEventDelegate(this,this);this.getView().addEventDelegate({onBeforeShow:jQuery.proxy(function(e){if(e.data&&(e.data.viewTitle||e.data.languageKey||e.data.infoText)){this.setTitleAndMessage(e.data.viewTitle,e.data.languageKey,e.data.infoText);}},this)});var v=this.getView();var t=this;if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}this.busyDialog=new sap.m.BusyDialog();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="noDataView"){this.evalContext=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);var a=e.getParameter("arguments");this.setTitleAndMessage(a.viewTitle,a.languageKey);this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.PLATFORM=this.metadataRef.getPlatform();this.env=0;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;if(this.PLATFORM==this.constantsRef.Platform.ABAP){this.isPlatformABAP=true;}else{this.isPlatformABAP=false;}this.oHeaderFooterOptions={bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("FULLSCREEN_TITLE"),onBtnPressed:function(d){if(t.navigatingWithinDrilldown){t.oApplicationFacade.navigatingWithinDrilldown=true;}else{t.oApplicationFacade.navigatingWithinDrilldown=undefined;}if(t.isPlatformABAP){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTileModelS",context:t.evalContext.sPath.substr(1)});}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.evalContext.sPath.substr(1)});}},bEnabled:false,}};if(t.isPlatformABAP){this.oHeaderFooterOptions.buttonList=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_EVALUATION"),onBtnPressed:function(d){t.handleEvalDelete();}}];this.oHeaderFooterOptions.additionalShareButtonList=[];}function b(d){t.env=d;};function c(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);};this.metadataRef.getSystemInfo({async:false,success:b,error:c,model:this.oDataModel});}},this);},handleEvalDelete:function(){var t=this;var m={EVALUATION:t.evalContext.getObject()};sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){function a(){t.busyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("EVALUATION_DEL_SUCCESS"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true);};function b(){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERR_EVALUATION_DEL"));};var p={ID:m.EVALUATION.ID,IS_ACTIVE:m.EVALUATION.IS_ACTIVE};t.busyDialog.open();t.metadataRef.remove("EVALUATION",p,a,b);}if(e=="CANCEL"){}});},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},setTitleAndMessage:function(v,l,i){var p=this.byId("sap.ca.scfld.md.view.empty");var t=this.oApplicationFacade.oApplicationImplementation.getResourceBundle().getText(v);if(!t||t===v){if(!i){t=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());}else{t=i;}};p.setTitle(t);var L=this.byId("emptyLabel");if(!i){var m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(l);if(!m||m===l){m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());};L.setText(m);}else{L.setText(i);}},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S3.controller');
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S3",{onInit:function(){var t=this;this.errorMessages=[];this.errorModel=new sap.ui.model.json.JSONModel();this.errorModel.setData(this.errorMessages);this.errorState=false;var v=this.getView();this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="multiSelect"){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(false);}this.oApplicationFacade.multiSelectMode=true;}else if(e.getParameter("name")==="detail"){t.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");if(this.oApplicationFacade.multiSelectMode){var p=this.getView().getContent()[0].getContent();for(var i=0,l=p.length;i<l;i++){p[i].setVisible(true);}this.oApplicationFacade.multiSelectMode=undefined;}this.oApplicationFacade.currentContextPath=e.getParameter("arguments").contextPath;this.context=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));var m=new sap.ui.model.json.JSONModel();m.setData(t.metadataRef.getKPIById({context:this.context,tags:true,properties:true,texts:true,evaluations:true,associations:true,associationProperties:true,model:this.oApplicationFacade.getODataModel()}));v.setModel(m,"indicator");v.setBindingContext(this.context);v.contextPath=e.getParameter("arguments").contextPath;this.updateFooterButtons(m.getData().INDICATOR);t.oApplicationFacade.evaluationData=m.getData().EVALUATIONS;t.oApplicationFacade.evaluationDetails=[];}},this);this.oHeaderFooterOptions={bSuppressBookmarkButton:{},buttonList:[]};t.byId("directionArrowAssociation").setColor(sap.ui.core.theming.Parameters.get("sapUiLightText"));},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},onAfterRendering:function(){},formatOwner:function(o){return(o||"");},formatStatus:function(s){return((s)?(this.oApplicationFacade.getResourceBundle().getText("ACTIVE")):this.oApplicationFacade.getResourceBundle().getText("DRAFT"));},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatEvaluationCount:function(e){return(e||0);},formatFavoriteMark:function(f){return((f)?true:false);},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t));},formatAssociationCount:function(s,t){var a=this;if(s==null&&t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"(0)";}if(s==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+t+")";}if(t==null){return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+s+")";}var c=(parseInt(s)+parseInt(t));return a.oApplicationFacade.getResourceBundle().getText("ASSOCIATIONS")+"("+c.toString()+")";},formatAssociationCountValue:function(s,t){var a=this;if(s==null&&t==null){return 0;}if(s==null){return t;}if(t==null){return s;}var c=(parseInt(s)+parseInt(t));return c;},formatProperties:function(n,v){var p=((this.getView().byId("assoProperties").getItems().length>1)?(", "+n+" : "+v):(n+" : "+v+","));return p;},formatArrowDirection:function(s){return((s==this.getView().getModel("indicator").getData().INDICATOR.ID)?("sap-icon://arrow-right"):("sap-icon://arrow-left"));},formatAssociationType:function(a){if(a=="SUPPORTING"){return this.oApplicationFacade.getResourceBundle().getText("SUPPORTING");}else{return this.oApplicationFacade.getResourceBundle().getText("CONFLICTING");}},formatTargetIndicatorText:function(s,t,a,b){var i=null;if(t==this.getView().getModel("indicator").getData().INDICATOR.ID){i=a;}else{i=b;}return i;},formatStatusOfAssociation:function(i,c){var t=this;if(c=="2"){var s=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT");return s;}if(i==0){return t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW");}if(i==1){return t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE");}},formatKpiStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"));}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE");}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW");}return i;},handleEvaluationSelect:function(e){var t=this;var b=e.getParameter("listItem").getBindingContext("indicator");var a="/EVALUATIONS_MODELER(ID='"+b.getObject().ID+"',IS_ACTIVE="+b.getObject().IS_ACTIVE+")";this.oApplicationFacade.evaluationIndex=parseInt(b.getPath().substring(b.getPath().length-1),10);sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(this.getView().contextPath+a)});},getAllFooterButtons:function(){var t=this;var b=[{id:"addEval",sId:"addEvaluationButton",sI18nBtnTxt:"ADD_EVALUATION",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:(t.getView().contextPath)});},},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){t.errorMessages=[];var p="/FAVOURITES";var c=t.getView().getModel("indicator").getData().INDICATOR;var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){t.metadataRef.remove("INDICATOR_FAVOURITE",a,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_SUCCESS_KPI_OPI"));c.MANUAL_ENTRY=0;t.updateFooterButtons(c);t.getView().getModel("indicator").getData().INDICATOR=c;t.getView().getModel("indicator").setData(t.getView().getModel("indicator").getData());t.refreshMasterList();},function(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_ERROR_KPI_OPI"),f.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_DELETE_ERROR_KPI_OPI"),"description":f.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==0){t.metadataRef.update("INDICATOR_FAVOURITE",a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("indicator").getData().INDICATOR=c;t.getView().getModel("indicator").setData(t.getView().getModel("indicator").getData());t.refreshMasterList();},function(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),"description":f.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==null){t.metadataRef.create("INDICATOR_FAVOURITE",a,null,function(f){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("indicator").getData().INDICATOR=c;t.getView().getModel("indicator").setData(t.getView().getModel("indicator").getData());t.refreshMasterList();},function(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),f.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),"description":f.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}},{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){t.errorMessages=[];var a="ACTIVE_INDICATORS";var p={};var c=[];p.ID=t.getView().getModel("indicator").getData().INDICATOR.ID;c.push(p);t.oApplicationFacade.getODataModel().read(("/INDICATOR_TEXTS?$filter=ID eq '"+t.getView().getModel("indicator").getData().INDICATOR.ID+"' and IS_ACTIVE eq 0 and TITLE ne ''"),null,null,false,function(d){if(d&&d.results&&d.results.length){var O=t.oApplicationFacade.getODataModel();t.metadataRef.create("ACTIVATE_INDICATOR",c,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_SUCCESS"));sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);t.refreshMasterList();},function(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_ERROR"),f.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_KPI_OPI_ERROR"),"description":f.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_KPI_OPI_TITLE"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_KPI_OPI_TITLE"),"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}},function(){});}},{id:"editBut",sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI=sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;var c=t.getView().contextPath;c=(t.getView().getBindingContext().getObject().COUNTER==2)?c.replace("IS_ACTIVE=1","IS_ACTIVE=0"):c;c=c.replace("INDICATORS_MODELER","INDICATORS");if(t.getView().getBindingContext().getObject().COUNTER==2){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI",route:"editDraftKpi",context:(c)});}else if(t.getView().getBindingContext().getObject().COUNTER==1){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI",route:"editKpi",context:(c)});}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){t.errorMessages=[];if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox");}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_INDICATOR_DELETE_KPI_OPI"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var a=t.getView().contextPath.substring(1).replace("INDICATORS_MODELER","INDICATORS");var p=[];p.push({ID:t.getView().getModel("indicator").getData().INDICATOR.ID,IS_ACTIVE:t.getView().getModel("indicator").getData().INDICATOR.IS_ACTIVE});var O=t.oApplicationFacade.getODataModel();t.metadataRef.remove("INDICATOR",p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_SUCCESS"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.substr(0,window.location.hash.indexOf("&/"))},true);},function(c){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_ERROR"),c.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("DELETE_KPI_OPI_ERROR"),"description":c.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}if(e=="CANCEL"){}});}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){t.errorMessages=[];this.duplicateKPIDialog=this.duplicateKPIDialog||t.createDuplicateDialog();this.duplicateKPIDialog.setContentHeight("350px");t.vBoxForIdPrefixText.setVisible(true);t.prefixInput.setValue();t.prefixInput.setValueState("None");t.prefixForm.setVisible(true);if(!t.settingModel.getData().ID_VISIBLE){t.vBoxForIdPrefixText.setVisible(false);t.prefixForm.setVisible(false);this.duplicateKPIDialog.setContentHeight("200px");}this.duplicateKPIDialog.open();}}];return b;},createDuplicateDialog:function(){var t=this;var k=new sap.m.RadioButton({groupName:"DuplicateKPI",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_ONLY"),selected:true});var a=new sap.m.RadioButton({groupName:"DuplicateKPI",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_AND_ENTITIES")});var b=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("KPI_ONLY_TEXT")});var c=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("KPI_AND_ENTITIES_TEXT")});var g=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("GENERATED_ID_INFO")});var d=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_ID_SAMPLE")});var p=new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("ID_PREFIX")});this.prefixInput=new sap.m.Input({type:"Text",maxLength:4,placeholder:t.oApplicationFacade.getResourceBundle().getText("PREFIX_PLACEHOLDER"),showValueHelp:false}).attachLiveChange(function(){t.validatePrefix();});var e=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("CHAR_LIMIT"),});var B=new sap.m.VBox({items:[k,b]});var v=new sap.m.VBox({items:[a,c]});this.vBoxForIdPrefixText=new sap.m.VBox({items:[g,d]});var o=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_OK"),press:function(){if(k.getSelected()){if(t.prefixInput.getVisible()){if(t.validatePrefix()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"INDICATOR-ONLY",id:t.getView().getModel("indicator").getData().INDICATOR.ID,prefix:t.prefixInput.getValue()},null,function(s){h.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(i){h.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(i.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(i.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"INDICATOR-ONLY",id:t.getView().getModel("indicator").getData().INDICATOR.ID,prefix:""},null,function(s){h.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(i){h.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(i.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(i.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}else if(a.getSelected()){if(t.prefixInput.getVisible()){if(t.validatePrefix()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"INDICATOR",id:t.getView().getModel("indicator").getData().INDICATOR.ID,prefix:t.prefixInput.getValue()},null,function(s){h.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(i){h.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(i.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(i.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"INDICATOR",id:t.getView().getModel("indicator").getData().INDICATOR.ID,prefix:""},null,function(s){h.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(i){h.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(i.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(i.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}}});var f=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_CANCEL"),press:function(){h.close();}});this.prefixForm=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",maxContainerCols:12,labelSpanL:3,labelSpanM:3,labelSpanS:3,columnsL:4,columnsM:4,columnsS:4,content:[p,t.prefixInput,e]});var h=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_DIALOG_TITLE"),contentWidth:"100px",verticalScrolling:false,horizontalScrolling:false,content:[new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",content:[B,v,t.vBoxForIdPrefixText,t.prefixForm]})],beginButton:o,endButton:f});return h;},validatePrefix:function(){var t=this;this.HANA="hana";this.CDS="cds";this.VIEW_MODE=this.HANA;var s=true;var u;if((u=jQuery.sap.getUriParameters().get("viewmode"))){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}var p=t.prefixInput.getValue();if(!p){t.prefixInput.setValueState("None");}if(this.VIEW_MODE==this.CDS){t.prefixInput.setValue(p.toUpperCase());}if(p){if(this.VIEW_MODE==this.CDS&&p[0]!='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_CDS_KPI_ID_BEGIN_WITH_PERIOD"));s=false;}else if(this.VIEW_MODE==this.HANA&&p[0]=='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_KPI_ID_BEGIN_WITH_PERIOD"));s=false;}else if(!(/^[a-zA-Z0-9.]*$/.test(p))){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_ID_PREFIX_NO_SPL_CHAR"));s=false;}else{t.prefixInput.setValueState("None");t.prefixInput.setValueStateText();}}return s;},updateFooterButtons:function(i){i=i||this.getView().getBindingContext().getObject();var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if((i.COUNTER==2)||(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[0];}if(i.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE");}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE");}this.oHeaderFooterOptions.buttonList.push(f[1]);if(!(i.IS_ACTIVE)){this.oHeaderFooterOptions.oEditBtn=f[2];}if(i.IS_ACTIVE){this.oHeaderFooterOptions.buttonList.push(f[5]);}if(i.COUNTER==2){f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT");}else{f[3].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT");}this.oHeaderFooterOptions.buttonList.push(f[3]);this.oHeaderFooterOptions.buttonList.push(f[4]);this.setHeaderFooterOptions(this.oHeaderFooterOptions);},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},openAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=[];this.additionalLanguageListModelData=t.getView().getModel('indicator').getData().TEXTS;var a=function(o,c,d){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=c;t.localLanguage=d;};var i=0;var l=this.additionalLanguageListModelData.length;sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getAllLanguages({async:false,success:a,model:this.oDataModel});for(i=0;i<l;i++){this.additionalLanguageListModelData[i].ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[this.additionalLanguageListModelData[i].LANGUAGE];}this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.addedLanguagesList=new sap.m.List({showNoData:false,layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){b.getBeginButton().setEnabled(false);}else{b.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L7 M7 S7",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"}),editable:false}),]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var b=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGES"),content:[t.addedLanguagesList],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){b.close();}})});b.open();}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.Component')){sap.ui.getCore().loadLibrary("sap.suite.ui.smartbusiness");jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.drilldown.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Smart Business Generic Drilldown","version":"1.0.0","library":"sap.suite.ui.smartbusiness.drilldown","includes":["lib/AllLibrary.js"],"dependencies":{"libs":["sap.m","sap.ca.ui","sap.ui.vbm","sap.suite.ui.commons"],"components":[]},config:{resourceBundle:"i18n/i18n.properties",titleResource:"SAP Smart Business",fullWidth:true},viewPath:"sap.suite.ui.smartbusiness.drilldown.view",fullScreenPageRoutes:{"miniChart":{"pattern":"/miniChart","view":"miniChart"},"fullscreen":{"pattern":":all*:","view":"Drilldown"}},}),createContent:function(){var m=jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.drilldown");jQuery.sap.require("sap.ca.ui.utils.Lessifier");sap.ca.ui.utils.Lessifier.lessifyCSS("sap.suite.ui.smartbusiness.drilldown","css/colors.css");jQuery.sap.includeStyleSheet(m+"/css/override.css");try{var v=this.getComponentData().startupParameters;v.component=this;}catch(e){v={};v.component=this;jQuery.sap.log.error("Startup Parameters not found!!");}return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.drilldown.view.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.drilldown.Configuration",{getServiceParams:function(){return[];},getServiceList:function(){return[];}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Configuration");sap.suite.ui.smartbusiness.drilldown.lib.Configuration=(function(){var _={};var b=function(u){return jQuery.sap.encodeURL(u);};var t=function(s){if(s){return s.trim();}return s;};var H=function(o){this.oHeader=o;this.oHeader.CONFIGURATION=t(this.oHeader.CONFIGURATION);if(this.oHeader.CONFIGURATION){var a=this.oHeader.CONFIGURATION;try{tempObject=JSON.parse(a);for(var i in tempObject){try{tempObject[i]=JSON.parse(tempObject[i]);}catch(e){tempObject[i]=tempObject[i];}}this.oHeader.PARSED_CONFIGURATION=tempObject;}catch(e){jQuery.sap.log.error("Error Parsing Drilldown Header Configuration");this.oHeader.PARSED_CONFIGURATION=null;}}else{this.oHeader.PARSED_CONFIGURATION=null;}};H.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE;},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID;},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID;},getEvaluationId:function(){return this.oHeader.EVALUATION_ID;},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER;},isVisible:function(){return this.oHeader.VISIBILITY==1;},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true;}}return false;},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION";},getDimension:function(){return this.oHeader.DIMENSION;},getTileConfiguration:function(){return this.oHeader.PARSED_CONFIGURATION;},getVisibility:function(){return this.oHeader.VISIBILITY;}};var C=function(o){this.oChart=o;};C.prototype={getValueType:function(){return this.oChart.VALUE_TYPE;},getAxisType:function(){return this.oChart.AXIS_TYPE;},getChartType:function(){var a=this;return{isBar:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BAR";},isColumn:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COLUMN";},isLine:function(){return a.oChart.CHART_TYPE.toUpperCase()=="LINE";},isCombination:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COMBINATION";},isTable:function(){return a.oChart.CHART_TYPE.toUpperCase()=="TABLE";},isBubble:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BUBBLE";},isGeoMap:function(){return a.oChart.CHART_TYPE.toUpperCase()=="GEOMAP";},isAnalyticalMap:function(){return a.oChart.CHART_TYPE.toUpperCase()=="CHOROPLETH";},getText:function(){return a.oChart.CHART_TYPE;}};},getColorScheme:function(){var a=this;return{getText:function(){return a.oChart.COLOR_SCHEME;},isManual:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualSemantic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualNonSematic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC";},isAutoSemantic:function(){return a.oChart.COLOR_SCHEME=='AUTO_SEMANTIC';}};},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE;},getDataLimit:function(){return this.oChart.DATA_LIMIT;},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE";},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE";},isSingleAxis:function(){return this.getAxisType()=="SINGLE";},isDualAxis:function(){return this.getAxisType()=="DUAL";},isStackingEnabled:function(v){var a=false;var e=v.getColumns();e.forEach(function(i){var o=v.findColumnByName(i);if(o.isStacked()){a=true;return false;}});return a;}};var c=function(){};c.prototype={getName:function(){return this.oParam.NAME;},getSortBy:function(){return this.oParam.SORT_BY;},getSortOrder:function(){return this.oParam.SORT_ORDER;},getType:function(){return this.oParam.TYPE;},getVisibility:function(){return this.oParam.VISIBILITY;},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART";},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE";},getColor:function(){return this.oParam.COLOR;},isStacked:function(){return this.oParam.STACKING==1;},getStacking:function(){return this.oParam.STACKING;},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION";},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE";},getAxis:function(){return this.oParam.AXIS;}};var D=function(p){this.oParam=p;};D.prototype=new c();var M=function(p){this.oParam=p;};M.prototype=new c();var F=function(p){this.oFilter=p;};F.prototype={getName:function(){return this.oFilter.DIMENSION;},isVisible:function(){return this.oFilter.VISIBILITY==1;}};var V=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._dimensionMap={};this._measureMap={};this._chartConfig=[];};V.prototype={getTitle:function(){return this._title;},getId:function(){return this._viewId;},getEvaluationId:function(){return this._evaluationId;},getViewOrder:function(){return this._order;},getColumns:function(){return this._columns;},getDimensions:function(){return this._dimensions;},getDimensionCount:function(){return this._dimensions.length;},getMeasures:function(){return this._measures;},getMeasureCount:function(){return this._measures.length;},findDimensionByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a];}else{throw new Error("Invalid Dimension Name : "+a);}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m];}else{throw new Error("Invalid Dimension Name : "+m);}},findColumnByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a];}else if(this._measureMap[a]){return this._measureMap[a];}else{throw new Error("Invalid Column Name : "+a);}},getChartConfiguration:function(){return this._chartConfig;}};var d=function(e,j){this.evaluationId=e;this._batchResponse=j;var k=null;var m={};var n=[];var o=-1;this._filters=[];this._filterMap={};this._headers=[];var p=function(q,r,s,u,w,x){q.forEach(function(v,i,a){var A=v.CONFIGURATION_ID;if(A){o++;n.push(A);var O=new V(v);m[A]=O;if(o==0){k=A;}V.setDimensionAndMeasures(w,O);V.setChart(x,O);}});var S=d.Constants;for(var y in S){var z=S[y].func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return true;};}else{d.prototype[z]=function(){return null;};}}r.forEach(function(v,i,a){var A=S[v.PROPERTY_TYPE];if(A){var z=A.func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return v.VISIBILITY==1;};}else{d.prototype[z]=function(){return v.PROPERTY_VALUE;};}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE);}},this);if(u.length){u.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new F(v);},this);}if(s.length){s.forEach(function(v,i,a){this.getHeaders().push(new H(v));},this);}};this.getFilters=function(){return this._filters;};this.getHeaders=function(){return this._headers;};this.getMaxViewOrder=function(){var a=0;for(var v in m){a=Math.max(a,m[v].getViewOrder());}return a;};this.findViewById=function(i){if(m[i]){return m[i];}return null;},this.getDefaultViewId=function(){return k;},this.getDefaultView=function(){if(k){return m[k];}return null;};this.removeViewById=function(v){delete m[v];};this.getAllViews=function(){var v=[];n.forEach(function(a){v.push({ID:a,TITLE:this.findViewById(a).getTitle()||"-NA- ("+a+")"})},this);return v;};p.call(this,this._batchResponse[0].data.results,this._batchResponse[1].data.results,this._batchResponse[2].data.results,this._batchResponse[3].data.results,this._batchResponse[4].data.results,this._batchResponse[5].data.results);};d.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};V.setDimensionAndMeasures=function(o,T){o.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new M(v);this._measures.push(v.NAME);}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new D(v);this._dimensions.push(v.NAME);}}},T);};V.setChart=function(o,T){if(o.length){o.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new C(v));}},T);}};var f=function(e){var T={TT:"Area Chart Tile",CT:"Comparison Tile",NT:"Numeric Tile",AT:"Bullet Tile"};var a={name:e,children:[]};var i=this.getAllViews();for(var j in i){var k={name:i[j].TITLE||"NA",children:[]};var v=this.findViewById(i[j].ID);var m={name:"*Configuration",children:[]};k.children.push(m);m.children.push({name:"Filter Enabled : "+this.isFilterEnabled()});m.children.push({name:"Kpi Aggregate Value Enabled: "+this.isAggregateValueEnabled()});m.children.push({name:"Header Enabled : "+this.isHeaderEnabled()});m.children.push({name:"OData Service Uri : "+this.getQueryServiceUri()});m.children.push({name:"Entity Set : "+this.getEntitySet()});var n=this.getFilters();var o={name:"*Filters("+n.length+")",children:[]};k.children.push(o);n.forEach(function(z){o.children.push({name:z});});var p=v.getChartConfiguration().length?v.getChartConfiguration()[0]:null;var q={name:"*Chart",children:[]};k.children.push(q);if(p){q.children.push({name:"Type : "+p.getChartType().getText()});q.children.push({name:"Color Scheme : "+p.getColorScheme().getText()});q.children.push({name:"Value Type : "+p.getValueType()});q.children.push({name:"Axis Type : "+p.getAxisType()});q.children.push({name:"Data Limit : "+(p.getDataLimit()||"NA")});q.children.push({name:"Stacking Enabled : "+p.isStackingEnabled(v)});q.children.push({name:"Threshold Measure : "+p.getThresholdMeasure()});}else{q.children.push({name:"Oops!!!NO Chart Configuration"});}var r=v.getMeasures();var s={name:"*Measures("+r.length+")",children:[]};k.children.push(s);r.forEach(function(z,A,B){var E={name:z,children:[]};s.children.push(E);var G=v.findMeasureByName(z);E.children.push({name:"Color : "+(G.getColor()||"NA")});E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis : "+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()});},this);var u=v.getDimensions();var w={name:"*Dimensions("+u.length+")",children:[]};k.children.push(w);u.forEach(function(z,A,B){var E={name:z,children:[]};w.children.push(E);var G=v.findDimensionByName(z);E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis :"+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()});},this);var x=this.getHeaders();var y={name:"*Kpi_Headers("+x.length+")",children:[]};k.children.push(y);x.forEach(function(j,z){var A={name:z+1+"",children:[]};y.children.push(A);A.children.push({name:"Type : "+T[j.getVisualizationType()],});A.children.push({name:"Reference Evaluation : "+j.getReferenceEvaluationId(),});A.children.push({name:"Dimension : "+(j.getDimension()||"NA"),});A.children.push({name:"isAssociatedOrOtherEvaluation : "+j.isAssociated(),});});a.children.push(k);}return a;};var g=function(p){var k=p.id;return k;};var h=function(e){var a=[];var m=[];var v=[];var n=parseInt(e.results[0].FILTERS_COUNT)||1;var o=parseInt(e.results[0].VALUES_COUNT)||1;var p=n*o;for(var i=0;i<e.results.length;i+=p){var q=parseInt(e.results[i].FILTERS_COUNT)||1;var o=parseInt(e.results[i].VALUES_COUNT)||1;var p=q*o;var r={};r.keys={};r.keys.VALUES={};r.keys.VALUES.results=[];r.keys.FILTERS={};r.keys.FILTERS.results=[];r.keys.ID=e.results[i].ID;r.keys.DESCRIPTION=e.results[i].DESCRIPTION;r.keys.ACTION=e.results[i].ACTION;r.keys.INDICATOR=e.results[i].INDICATOR;r.keys.INDICATOR_TITLE=e.results[i].INDICATOR_TITLE;r.keys.TITLE=e.results[i].TITLE;r.keys.NAME=e.results[i].NAME;r.keys.SCALING=e.results[i].SCALING;r.keys.ODATA_URL=e.results[i].ODATA_URL;r.keys.ODATA_ENTITYSET=e.results[i].ODATA_ENTITYSET;r.keys.VIEW_NAME=e.results[i].VIEW_NAME;r.keys.COLUMN_NAME=e.results[i].COLUMN_NAME;r.keys.OWNER_NAME=e.results[i].OWNER_NAME;r.keys.OWNER_E_MAIL=e.results[i].OWNER_E_MAIL;r.keys.OWNER_ID=e.results[i].OWNER_ID;r.keys.PROPERTIES=e.results[i].PROPERTIES||{};r.keys.ODATA_PROPERTY=e.results[i].ODATA_PROPERTY;r.keys.SEMANTIC_OBJECT=e.results[i].SEMANTIC_OBJECT;r.keys.VALUES_SOURCE=e.results[i].VALUES_SOURCE;r.keys.INDICATOR_TYPE=e.results[i].INDICATOR_TYPE;r.keys.GOAL_TYPE=e.results[i].GOAL_TYPE;r.keys.DECIMAL_PRECISION=e.results[i].DECIMAL_PRECISION;for(var j=i;j<o+i;j++){if(parseInt(e.results[i].VALUES_COUNT)){var s={};s.TYPE=e.results[j].TYPE;s.FIXED=e.results[j].FIXED;s.COLUMN_NAME=e.results[j].COLUMN_NAME_1;s.ODATA_PROPERTY=e.results[j].ODATA_PROPERTY_1;s.ID=e.results[j].ID;r.keys.VALUES.results.push(s);}}for(var k=i;k<p+i;k+=o){if(parseInt(e.results[i].FILTERS_COUNT)){var u={};u.ID=e.results[k].ID;u.NAME=e.results[k].NAME;u.OPERATOR=e.results[k].OPERATOR;u.TYPE=e.results[k].TYPE_1;u.VALUE_1=e.results[k].VALUE_1;u.VALUE_2=e.results[k].VALUE_2;r.keys.FILTERS.results.push(u);}}a.push(r.keys);}return a;};var l=function(s,a){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var u=sap.ushell.Container.getService("URLParsing");s=u.addSystemToServiceUrl(s,a);}return s;};return{getConfigurationTree:function(e,s,a){this.loadConfiguration({evaluationId:e,cache:true,success:function(i){var d=this.parse(e,i);s.call(null,f.apply(d,["Evaluation"]));},error:function(i){jQuery.sap.log.error("Error Fetching Drilldown Configuration")},context:this});},parse:function(e,a){return new d(e,a);},getConfigurationFromCache:function(e){return _[e];},resetDrilldownConfiguration:function(e){if(e){_[e]=null;}},_getModelerServicesAdapter:function(){return sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");},_getRuntimeServiceUrl:function(){return this._getModelerServicesAdapter().getRuntimeServiceUrl();},loadConfiguration:function(p,a){var e=this;var i=p.evaluationId;var j=!!p.cache;if(_[i]&&j){p.success.call(p.context||null,_[i]);}else{var o=null;var s=this._getRuntimeServiceUrl();s=l(s,p.sapSystem);var k=function(m){e.loadConfigurationBatch(m,a,p);};if(sap.suite.ui.smartbusiness.lib.Util.odata){o=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s,k);}else{o=new sap.ui.model.odata.ODataModel(s,{json:true,loadMetadataAsync:true});o.attachMetadataLoaded(function(){k(o)});}}},loadConfigurationBatch:function(o,a,p){var e=p.evaluationId;o.setTokenHandlingEnabled(this._getModelerServicesAdapter().isTokenHandlingEnabledForODataRead());var m="/DDA_MASTER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=CONFIG_ORDER";var i="/DDA_CONFIG?$filter="+b("EVALUATION_ID eq '"+e+"'");var j="/DDA_HEADER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=VISUALIZATION_ORDER";var k="/DDA_FILTERS?$filter="+b("EVALUATION_ID eq '"+e+"'");var n="/DDA_COLUMNS?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=COLUMNS_ORDER";var q="/DDA_CHART?$filter="+b("EVALUATION_ID eq '"+e+"'");var r=o.createBatchOperation(m,"GET");var s=o.createBatchOperation(i,"GET");var u=o.createBatchOperation(j,"GET");var v=o.createBatchOperation(k,"GET");var w=o.createBatchOperation(n,"GET");var x=o.createBatchOperation(q,"GET");o.addBatchReadOperations([r,s,u,v,w,x]);var y=o.submitBatch(function(z,A){var B=z.__batchResponses;_[e]=B;p.success.call(p.context||null,B);},function(z){jQuery.sap.log.error("Failed to fetch DDA Configuration");if(p.error){p.error.call(p.context||null,z);}},true);a(y);return y;},setEvaluationsCache:function(p,a){var e=this;if(!p.evalIdArray){throw new Error("Evaluation Id Not Found")}var j=g(p);var m=null;var s=this._getModelerServicesAdapter().addSystemToServiceUrl(this._getRuntimeServiceUrl(),p.sapSystem);if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{m=new sap.ui.model.odata.ODataModel(s,true);}var k="";p.evalIdArray.forEach(function(i){var j=i;var q=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(j);if(!q)k+="ID eq '#EVALUATION_ID' or ".replace("#EVALUATION_ID",j);});if(k){k=k.slice(0,-4);var o={};o["$filter"]=k;o["$orderby"]="ID,NAME,OPERATOR,VALUE_1,VALUE_2";var n=m.read("/EVALUATIONS_CORE",null,o,true,function(q){if(q.results&&q.results.length){var r=h(q);for(var i=0;i<r.length;i++)sap.suite.ui.smartbusiness.lib.Util.cache.setEvaluationById(r[i].ID,r[i]);p.success.call(p.context||null);}else{jQuery.sap.log.error("Empty Evaluation returned");p.success.call(p.context||null);}},function(){jQuery.sap.log.error("Error fetching Evaluations");p.success.call(p.context||null);});return n;}else{p.success.call(p.context||null);return null;}},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var a=g(p);if(p.cache){var e=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(a);if(e){if(p.success){p.success.call(p.context||null,e);return null;}}}var m=null;var s=this._getModelerServicesAdapter().addSystemToServiceUrl(this._getRuntimeServiceUrl(),p.sapSystem);if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{m=new sap.ui.model.odata.ODataModel(s,true);}var i="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var j=null;var o={};o["$filter"]=i;var k="";if(p.filters){k+="FILTERS,";}if(p.thresholds){k+="VALUES,";}if(k){o["$expand"]=k.substring(0,k.length-1);}var n=m.read("/EVALUATIONS",null,o,true,function(q){if(q.results&&q.results.length){j=q.results[0];sap.suite.ui.smartbusiness.lib.Util.cache.setEvaluationById(a,j);p.success.call(p.context||null,j);}else{p.error.call(p.context||null,"Empty Results with EvaluationID : "+p.id);}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments);}});return n;}};})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.CustomTable')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.CustomTable");sap.m.Table.extend("sap.suite.ui.smartbusiness.drilldown.lib.CustomTable",{metadata:{properties:{actionItems:{type:"any",multiple:true}}},renderer:{}});sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.init=function(){sap.m.Table.prototype.init.apply(this);this._selectedContext=[];var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:"{i18n>TABLE_POPOVER_HEADING}"})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(this._closePopover,this)})]});this._popOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c}).addStyleClass("smartbusinessTablePopover");var s=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());s.addContent(this._popOver,true);};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype._closePopover=function(){if(this._popOver.isOpen()){this._popOver.close();}};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.setPopoverFooter=function(c){this._popOver.removeAllContent();this._popOver.addContent(c);};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.onBeforeRendering=function(){this._popOver.getCustomHeader().getContentMiddle()[0].setText(this.getModel("i18n").getProperty("TABLE_POPOVER_HEADING"));this.attachItemPress(function(e){var a=e.getParameters().listItem||e.getParameters().listItems[0];this.popoverOpenAt=a;var s=[];var i=this.getSelectedItems();var c=this.getColumns();if(i.length){var b=i[0];var d=b.getBindingContext().getObject();var o={};for(var f in d){o[f]=d[f];}s.push(o);this.setSelectedContext(s);if(true||this._notEmpty()){this._popOver.openBy(a.getCells()[parseInt(a.getCells().length/2)||0],false);}}else{this._closePopover();}});};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype._notEmpty=function(){var c=this._popOver.getContent();var n=false;if(c&&c.length>0){var b=c[0];var l=b.getItems();l.forEach(function(a){if(a.getItems().length>0){n=true;return false;}});}return n;};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.setSelectedContext=function(s){this._selectedContext=s;};sap.suite.ui.smartbusiness.drilldown.lib.CustomTable.prototype.getSelectedContext=function(s){return this._selectedContext;};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Hash')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Hash");sap.suite.ui.smartbusiness.drilldown.lib.Hash=(function(){var o=null;var n=null;var b=null,c=null,d=null,e=null;var H=null;var f="|^",g=/\|\^/g;function r(){b=null,c=null,d=null,e=null;H=null;}function h(a){var s={};if(a){var B=a.split("/");for(var i=1;i<B.length;i++){var C=B[i];var D=C.split("=");if(s[D[0]]){}else{s[D[0]]=[];}if(D[1]||D[1]==''){var E=decodeURIComponent(D[1]).split(",");var F=s[D[0]];for(var j=0;j<E.length;j++){if(F.indexOf(E[j])==-1){E[j]=E[j].replace(g,",");F.push(E[j]);}}}}}return s;}function k(a){var j={};if(a){var s=a.split("&");for(var i=0;i<s.length;i++){var B=s[i];var C=B.split("=");if(j[C[0]]){}else{j[C[0]]=[];}var D=j[C[0]];var E=decodeURIComponent(C[1]);if(D.indexOf(E)==-1){D.push(E);}}}return j;}function p(n){n=n||window.location.hash;if(n){var a=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/;var i=a.exec(n);var j=i[1];var s=i[2];var B=/^([A-Za-z0-9_]+)-([A-Za-z0-9_]+)[\?]?(.*)/;if(j){var C=B.exec(j);b=C[1];c=C[2];d=k(C[3]);}e=h(s);}}function _(){};if(window.addEventListener){}function l(){var j="";if(b){j+=b;}if(c&&b){j+="-"+c;}if(d){j+="?";for(var B in d){var C=d[B];for(var i=0;i<C.length;i++){j+=B+"="+encodeURIComponent(C[i])+"&";}}j=j.substring(0,j.length-1);}if(e){var C="";for(var B in e){if(e[B]instanceof Array){e[B].forEach(function(s,i,a){a[i]=(s+"").replace(/,/g,f);});}C+=B+"="+encodeURIComponent(e[B])+"/";}if(C.length){C=C.substring(0,C.length-1);C="&/"+C;}j+=C;}return j;};function m(){return l();};function u(){var s=l();window.location.hash=s;H=s;p();}p();function q(O,U){if(typeof U=='undefined'){U=true;}U=!!U;b=O;if(U){u();}}function t(a,U){if(typeof U=='undefined'){U=true;}U=!!U;c=a;if(U){u();}}function v(a,U){if(typeof U=='undefined'){U=true;}U=!!U;d=a;if(U){u();}}function w(a,U){if(typeof U=='undefined'){U=true;}if(d&&d[a]){d[a]=null;delete d[a];}if(U){u();}}function x(a,U){if(typeof U=='undefined'){U=true;}U=!!U;e=a;if(U){u();}}function y(a,U){if(typeof U=='undefined'){U=true;}if(e&&e[a]){e[a]=null;delete e[a];}if(U){u();}}function z(a,U){if(typeof U=='undefined'){U=true;}U=!!U;if(!d){d=a;}else{for(var i in a){var s=a[i];if(!d[i]){d[i]=[];}var B=d[i];for(var j=0;j<s.length;j++){if(B.indexOf(s[j]+"")==-1){B.push(s[j]+"");}}}}if(U){u();}}function A(a,U){if(typeof U=='undefined'){U=true;}U=!!U;if(!e){e=a;}else{for(var i in a){var s=a[i];if(!jQuery.isArray(s)){s=[s];}if(!e[i]){e[i]=[];}var B=e[i];for(var j=0;j<s.length;j++){if(B.indexOf(s[j]+"")==-1){B.push(s[j]+"");}}}}if(U){u();}}return{getSemanticObject:function(){r();p(window.location.hash);return b;},getAction:function(){r();p(window.location.hash);return c;},getStartupParameters:function(){r();p(window.location.hash);return d;},getApplicationParameters:function(a){r();p(window.location.hash);if(a&&a.length){a.forEach(function(i){delete e[i];});}return e;},setSemanticObject:function(O,U){q(O,U);return this;},setAction:function(c,U){t(c,U);return this;},setStartupParameters:function(a,U){v(a,U);return this;},updateStartupParameters:function(a,U){z(a,U);return this;},removeStartupParameter:function(a,U){w(a,U);return this;},setApplicationParameters:function(a,U){x(a,U);return this;},updateApplicationParameters:function(a,U){A(a,U);return this;},removeApplicationParameter:function(a,U){y(a,U);return this;},getUrlParameters:function(){return jQuery.sap.getUriParameters();},updateHash:function(){u();},getHash:function(){return m();}};})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager");sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager=(function(){"use strict";var h=[];var V={NT:"Numeric",CT:"Comparison",AT:"Bullet",TT:"AreaChart",CM:"MeasureComparison"};var a={"NT":5,"AT":4,"CT":3,"TT":2,"CM":1,"HT":0};var u=sap.ushell.Container.getService("URLParsing");var g=function(p,o){var e="";if(o.isAssociated())e=o.getReferenceEvaluationId();else e=o.getReferenceEvaluationId();var r=[];var d="";if(sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(e))d=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(e).ODATA_URL;if(d){var U=u.addSystemToServiceUrl(sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(e).ODATA_URL,p.sapSystem);var b=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(e).ODATA_ENTITYSET;var c=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(U,b);for(var i=0;i<p.urlFilters.length;i++){if(c.indexOf(p.urlFilters[i].NAME)!=-1)r.push(p.urlFilters[i]);}}return r;};return{renderHeaders:function(p){if(p.allTiles.length){var b=p.allTiles;h=[];b.forEach(function(o){var t=o.getVisualizationType();if(V[t]){var c=V[t];jQuery.sap.require("sap.suite.ui.smartbusiness.tiles."+c);if(sap.suite.ui.smartbusiness.tiles[c]){var f=g(p,o);var d=new sap.suite.ui.smartbusiness.tiles[c]({dimension:o.getDimension(),evaluationId:o.getEvaluationId(),associationEvaluationId:o.getReferenceEvaluationId(),sapSystem:p.sapSystem,additionalFilters:f,tileConfiguration:o.getTileConfiguration(),navigation:p.onNavigation,layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})}).addStyleClass("drilldownKpiTiles");h.push(d);var e=new sap.suite.ui.commons.HeaderCellItem();var i=new sap.suite.ui.commons.HeaderCell();if(jQuery.device.is.desktop){p.headerContainer.addItem(d);}else{p.headerContainer.addContent(d);}if(p.urlFilters.length){if(f&&f.length){}else{d.setVisible(false);d.setClick(false);}}}else{jQuery.sap.log.error("Ignoring the tile "+c+" : Not Implemented Yet");}}else{jQuery.sap.log.error("No Tile Mapping  for Visualisation Type : "+t);}});}},hashChangeListner:function(p){if(p.firstTimeFlag){var b=[];var c=p.allTiles;for(var i=0;i<c.length;i++){var d=null;var o=c[i];var e=h[i];if(e){var f=g(p,o);if(p.urlFilters.length){if(f&&f.length){e.$().css("opacity","1");e.setAdditionalFilters(f);e.$().off("click");}else{e.$().css("opacity","0.2");e.$().click(function(){return false;});}}else{e.$().css("opacity","1");e.setAdditionalFilters(f);e.$().off("click");}}}}},}})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.Performance')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Performance");sap.suite.ui.smartbusiness.drilldown.lib.Performance=function(p){this.oParam=p;this._init();};sap.suite.ui.smartbusiness.drilldown.lib.Performance.prototype={_processData:function(j){var d=[];for(var e in j){var D=j[e];d.push({"TimeTaken":(D.time)/1000,"Call":D.title});}return d;},_init:function(){var t=this;this._dataSet=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/"}});var d=["Call"];var m=["TimeTaken"];d.forEach(function(D){var a=new sap.viz.ui5.data.DimensionDefinition({name:D,axis:1,value:{path:D}});this._dataSet.addDimension(a);},this);m.forEach(function(M){var a=new sap.viz.ui5.data.MeasureDefinition({name:M,value:{path:M}});this._dataSet.addMeasure(a);},this);this._oChart=new sap.viz.ui5.Bar({dataset:this._dataSet,width:"750px",height:"380px"});this._oChart.setModel(new sap.ui.model.json.JSONModel());this._oDialog=new sap.m.Dialog({title:"Performance Check",contentWidth:"800px",contentHeight:"400px",endButton:new sap.m.Button({text:"Close",press:function(){t._oDialog.close();}})});this._oDialog.addContent(this._oChart);},start:function(d,c){var p=this._processData(d);this._oChart.getModel().setData(p);var t=this;if(!this._oDialog.isOpen()){if(c){this._oDialog.addStyleClass("sapUiSizeCompact");}else{this._oDialog.removeStyleClass("sapUiSizeCompact");}this._oDialog.open();setTimeout(function(){t._oChart.rerender();},200);}}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.AddToHome.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.AddToHome.controller');jQuery.sap.require('sap.m.MessageBox');sap.ui.controller("sap.suite.ui.smartbusiness.drilldown.view.AddToHome",{onInit:function(){this.drilldownController=this.getView().getViewData();this.evaluationApi=this.drilldownController.EVALUATION;this.thresholds=this.evaluationApi.getThresholds();this.LAYOUT=this.byId("container");this.SAP_SYSTEM=this.drilldownController.SAP_SYSTEM;try{this.LAYOUT_MODEL=new sap.ui.model.json.JSONModel({TITLE:"",CL:this.thresholds.getCriticalLow(),CH:this.thresholds.getCriticalHigh(),WL:this.thresholds.getWarningLow(),WH:this.thresholds.getWarningHigh(),TA:this.thresholds.getTarget(),TC:this.thresholds.getTrend(),RE:this.thresholds.getReference(),MINIMIZING_KPI:this.evaluationApi.isMinimizingKpi(),MAXIMIZING_KPI:this.evaluationApi.isMaximizingKpi(),TARGET_KPI:this.evaluationApi.isTargetKpi()});this.LAYOUT.setModel(this.LAYOUT_MODEL),this.createForm(this.evaluationApi.getThresholdValueType());}catch(e){}},createForm:function(v){var _=function(m){return{parts:[{path:m},{path:"/TARGET_KPI"}],formatter:function(M,t){if(M||t){return true;}return false;}}};var f=null;var n=null;if(v=="MEASURE"){f=new sap.ui.layout.form.SimpleForm({content:[new sap.m.Label({text:"{i18n>SUB_TITLE_LABEL}",required:true}),new sap.m.Input({value:"{/TITLE}"})]});n=new sap.m.Label({text:"{i18n>DYNAMIC_MEASURE_NOT_EDITABLE}"});n.addStyleClass("labelDynamicThresholdNotEditable");}else if(v=="RELATIVE"){f=new sap.ui.layout.form.SimpleForm({content:[new sap.m.Label({text:"{i18n>SUB_TITLE_LABEL}",required:true}),new sap.m.Input({value:"{/TITLE}"}),new sap.m.Label({text:"{i18n>CRITICAL_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/CH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>WARNING_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/WH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>TARGET_LABEL}"}),new sap.m.Input({value:"{/TA}",valueState:sap.ui.core.ValueState.None,valueStateText:"{i18n>TARGET_VALUE_HELP}",editable:false}),new sap.m.Label({text:"{i18n>WARNING_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/WL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_LOW_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>CRITICAL_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/CL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_LOW_VALUE_HELP}"}),]});}else{f=new sap.ui.layout.form.SimpleForm({content:[new sap.m.Label({text:"{i18n>SUB_TITLE_LABEL}",required:true}),new sap.m.Input({value:"{/TITLE}"}),new sap.m.Label({text:"{i18n>CRITICAL_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/CH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>WARNING_HIGH_LABEL}",visible:_("/MINIMIZING_KPI")}),new sap.m.Input({value:"{/WH}",visible:_("/MINIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_HIGH_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>TARGET_LABEL}"}),new sap.m.Input({value:"{/TA}",valueState:sap.ui.core.ValueState.None,valueStateText:"{i18n>TARGET_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>WARNING_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/WL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Warning,valueStateText:"{i18n>WARNING_LOW_VALUE_HELP}"}),new sap.m.Label({text:"{i18n>CRITICAL_LOW_LABEL}",visible:_("/MAXIMIZING_KPI")}),new sap.m.Input({value:"{/CL}",visible:_("/MAXIMIZING_KPI"),valueState:sap.ui.core.ValueState.Error,valueStateText:"{i18n>CRITICAL_LOW_VALUE_HELP}"}),]});}this.LAYOUT.removeAllItems();this.LAYOUT.addItem(f);if(n){this.LAYOUT.addItem(n);}},validate:function(c,C){var a=this.drilldownController.getView().getModel("i18n");var m=this.LAYOUT_MODEL.getData();var o={title:""};var t=this.thresholds.getTargetType();if(t==="FIXED"){var n=this._areEvaluationValuesNumber(m);if(n.length){var b="";for(i=0;i<n.length;i++){b=b+a.getProperty("ENTER_NUMERIC_VALUE_FOR_"+n[i])+"\n";}C.call(this,{errorMessage:b});return;}var v=this._validateEvaluationValues(m);if(v.length){var b=a.getProperty("ERROR_ENTER_VALID_THRESHOLD_VALUES");var i;for(i=0;i<v.length;i++){if(v[i]==="CL"){if(this.evaluationApi.getGoalType()==="RA"){b=b+"\n"+a.getProperty("CRITICAL_LOW");}else{b=b+"\n"+a.getProperty("CRITICAL");}}if(v[i]==="WL"){if(this.evaluationApi.getGoalType()==="RA"){b=b+"\n"+a.getProperty("WARNING_LOW");}else{b=b+"\n"+a.getProperty("WARNING");}}if(v[i]==="TA"){b=b+"\n"+a.getProperty("TARGET");}if(v[i]==="CH"){if(this.evaluationApi.getGoalType()==="RA"){b=b+"\n"+a.getProperty("CRITICAL_HIGH");}else{b=b+"\n"+a.getProperty("CRITICAL");}}if(v[i]==="WH"){if(this.evaluationApi.getGoalType()==="RA"){b=b+"\n"+a.getProperty("WARNING_HIGH");}else{b=b+"\n"+a.getProperty("WARNING");}}}C.call(this,{errorMessage:b});return;}}if(t==="RELATIVE"){var p=/^(?=.*\d)\d*(?:\.\d\d)?$/;var b="";if(this.evaluationApi.getGoalType()==="MA"){if((m.WL!=""&&m.WL!=null)&&(m.CL!=""&&m.CL!=null)&&parseInt(m.WL)<=parseInt(m.CL)){b+=a.getProperty("CRITICAL_SHOULD_BE_LESS_THAN_WARNING");}if(m.WL>=100&&(m.WL!=""&&m.WL!=null)){b+="\n"+a.getProperty("WARNING_SHOULD_BE_LESS_THAN_100");}if(m.CL!=""&&(m.CL>=100&&m.CL!=null)){b+="\n"+a.getProperty("CRITICAL_SHOULD_BE_LESS_THAN_100");}if((m.WL!=""&&m.WL!=null)&&!p.test(m.WL)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_WARNING");}if((m.CL!=""&&m.CL!=null)&&!p.test(m.CL)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}}if(this.evaluationApi.getGoalType()==="MI"){if((m.CH!=""&&m.CH!=null)&&(m.WH!=""&&m.WH!=null)&&parseInt(m.CH)<=parseInt(m.WH)){b+=a.getProperty("CRITICAL_SHOULD_BE_MORE_THAN_WARNING");}if(m.CH<=100&&(m.CH!=""&&m.CH!=null)){b+="\n"+a.getProperty("CRITICAL_SHOULD_BE_MORE_THAN_100");}if(m.WH<=100&&(m.WH!=""&&m.WH!=null)){b+="\n"+a.getProperty("WARNING_SHOULD_BE_MORE_THAN_100");}if(m.CH!=""&&m.CH!=null&&!p.test(m.CH)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}if((m.WH!=""&&m.WH!=null&&!p.test(m.WH))){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_WARNING");}}if(this.evaluationApi.getGoalType()==="RA"){if((m.CH!=""&&m.CH!=null)&&(m.CH!=""&&m.CH!=null)&&parseInt(m.CH)<=parseInt(m.WH)){b+=a.getProperty("CRITICAL_HIGH_MORE_THAN_WARNING_HIGH");}if((m.WL!=""&&m.WL!=null)&&(m.CL!=""&&m.CL!=null)&&parseInt(m.WL)<=parseInt(m.CL)){b+="\n"+a.getProperty("WARNING_LOW_MORE_THAN_CRITICAL_LOW");}if(m.CH<=100&&(m.CH!=""&&m.CH!=null)){b+="\n"+a.getProperty("CRITICAL_HIGH_SHOULD_BE_MORE_THAN_100");}if(m.WH<=100&&(m.WH!=""&&m.WH!=null)){b+="\n"+a.getProperty("WARNING_HIGH_SHOULD_BE_MORE_THAN_100");}if(m.CL>=100&&(m.CL!=""&&m.CL!=null)){b+="\n"+a.getProperty("CRITICAL_LOW_SHOULD_BE_LESS_THAN_100");}if(m.WL>=100&&(m.WL!=""&&m.WL!=null)){b+="\n"+a.getProperty("WARNING_LOW_SHOULD_BE_LESS_THAN_100");}if((m.WL!=""&&m.WL!=null)&&!p.test(m.WL)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_WARNING_LOW");}if((m.CL!=""&&m.CL!=null)&&!p.test(m.CL)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_CRITICAL_LOW");}if(m.CH!=""&&m.CH!=null&&!p.test(m.CH)){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_CRITICAL_HIGH");}if((m.WH!=""&&m.WH!=null&&!p.test(m.WH))){b+="\n"+a.getProperty("ENTER_NUMERIC_VALUE_FOR_WARNING_HIGH");}}if(b!=""){C.call(this,{errorMessage:b});return;}}if(this.evaluationApi.getThresholdValueType()=="MEASURE"){if(!m.TITLE.trim()){C.call(this,{errorMessage:this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_TITLE_MISSING")});}else{o.title=m.TITLE.trim();c.call(this,o);}}else if(this.evaluationApi.getThresholdValueType()=="RELATIVE"){if(!m.TITLE.trim()){C.call(this,{errorMessage:this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_TITLE_MISSING")});return;}o.title=m.TITLE.trim();o.evaluationValues=[];var d=m.TA?m.TA.trim():null;var e=m.CL?m.CL.trim():null;var f=m.CH?m.CH.trim():null;var W=m.WL?m.WL.trim():null;var g=m.WH?m.WH.trim():null;if(d){o.evaluationValues.push({TYPE:"TA",FIXED:null,ID:this.evaluationApi.getId(),COLUMN_NAME:d,ODATA_PROPERTY:null});}if(e){o.evaluationValues.push({TYPE:"CL",FIXED:e,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(f){o.evaluationValues.push({TYPE:"CH",FIXED:f,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(W){o.evaluationValues.push({TYPE:"WL",FIXED:W,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(g){o.evaluationValues.push({TYPE:"WH",FIXED:g,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(o.evaluationValues.length==0){o.evaluationValues=null;}c.call(this,o);}else{if(!m.TITLE.trim()){C.call(this,{errorMessage:this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_TITLE_MISSING")});return;}o.title=m.TITLE.trim();o.evaluationValues=[];var d=m.TA?m.TA.trim():null;var e=m.CL?m.CL.trim():null;var f=m.CH?m.CH.trim():null;var W=m.WL?m.WL.trim():null;var g=m.WH?m.WH.trim():null;if(d){o.evaluationValues.push({TYPE:"TA",FIXED:d,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(e){o.evaluationValues.push({TYPE:"CL",FIXED:e,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(f){o.evaluationValues.push({TYPE:"CH",FIXED:f,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(W){o.evaluationValues.push({TYPE:"WL",FIXED:W,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(g){o.evaluationValues.push({TYPE:"WH",FIXED:g,ID:this.evaluationApi.getId(),COLUMN_NAME:null,ODATA_PROPERTY:null});}if(o.evaluationValues.length==0){o.evaluationValues=null;}c.call(this,o);}},_addTileToHomePage:function(c){var t=this;var b=sap.ushell.Container.getService("Bookmark");var a=null;b.addCatalogTileToGroup(c,a,{baseUrl:"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",remoteId:"HANA_CATALOG"}).done(function(){sap.m.MessageToast.show(t.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_ADDED_TO_HOME_SUCCESSFULLY"));jQuery.sap.log.info("Tile Added to HOME");}).fail(function(e){sap.m.MessageToast.show(t.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_ADD_TO_HOME_FAILED"));jQuery.sap.log.error("Failed to add tile to home : "+e);});},_notifyShell:function(c){var s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;if(s){oNotifyShell=s("LaunchPage");if(oNotifyShell&&oNotifyShell.onCatalogTileAdded){oNotifyShell.onCatalogTileAdded(c);}}},publishTile:function(c){var t=this;this.validate(function(a){var C=sap.suite.ui.smartbusiness.Adapter.getService("CatalogServices");var r=C.savePersonalizedTile({evaluationId:this.evaluationApi.getId(),tileType:this.drilldownController.TILE_TYPE,dimension:this.drilldownController.DIMENSION,additionalFilters:this.drilldownController.getAdditionFiltersForChipConfiguration(),evaluationValues:a.evaluationValues?a:null,title:a.title,sapSystem:this.SAP_SYSTEM,success:function(r){sap.m.MessageToast.show(t.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_CREATED_SUCCESSFULLY"));c.call();t._addTileToHomePage(r.chipId);t._notifyShell(r.chipId);},error:function(r){jQuery.sap.log.error(r.message);sap.m.MessageToast.show(t.drilldownController.getView().getModel("i18n").getProperty("PERSONALIZED_TILE_CREATION_FAILED"));c.call();}});},function(e){sap.m.MessageBox.show(e.errorMessage,null,this.drilldownController.getView().getModel("i18n").getProperty("VALIDATION_ERROR_HEADER"))});},_validateEvaluationValues:function(m){var v=[];var e=[];var s=0;var d={};if(m.CL||m.CL===0){v.push({key:"CL",value:m.CL,score:s++});}if(m.WL||m.WL===0){v.push({key:"WL",value:m.WL,score:s++});}if(m.TA||m.TA===0){v.push({key:"TA",value:m.TA,score:s++});}if(m.WH||m.WH===0){v.push({key:"WH",value:m.WH,score:s++});}if(m.CH||m.CH===0){v.push({key:"CH",value:m.CH,score:s++});}v.sort(function(a,b){return(a.value-b.value)});for(var i=0,l=v.length;i<l;i++){if(v[i].score!=i){e.push(v[i].key);}if(v[i]&&v[i-1]){if(v[i].value==v[i-1].value){d[v[i-1].key]=v[i-1].value;d[v[i].key]=v[i].value;}}}if(!(e.length)){e=Object.keys(d);}return e;},_areEvaluationValuesNumber:function(m){var e=[];if(isNaN(m.CL)||isNaN(m.CH)){e.push("CRITICAL");}if(isNaN(m.WL)||isNaN(m.WH)){e.push("WARNING");}if(isNaN(m.TA)){e.push("TARGET");}return e;},onAfterRendering:function(){}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap",{onInit:function(){this.parentController=null;if(this.getView().getViewData()){var v=this.getView().getViewData();this.parentController=v.parent;}this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.getAllMapColors();this.mapDetails=this.getMapDetails();},onBeforeRendering:function(){},onAfterRendering:function(){},onExit:function(){},onRegionClick:function(e){var t=this;jQuery.sap.log.info("Clicked on "+e.getParameter("code"));},onRegionContextMenu:function(e){},formatCountryCode:function(c){return c;},renderMap:function(){var t=this;var p=t.parentController;var m=t.getView().analyticalMap;var a={parts:[],formatter:jQuery.proxy(t.formatTooltip,t)};var b=t.mapDetails.getAllMeasures();a.parts.push({path:t.mapDetails.getMapDimension()});a.parts.push({path:t.mapDetails.getMapDimensionTextName()});b.forEach(function(d){a.parts.push({path:d});});var c=new sap.ui.vbm.Region({code:{path:t.mapDetails.getMapDimension(),formatter:jQuery.proxy(t.formatCountryCode,t)},color:{parts:[{path:t.mapDetails.getMapMeasure()},{path:t.mapDetails.getThresholdMeasure()}],formatter:t.getColorFormatterFunction(p.EVALUATION,t)},tooltip:a});m.bindAggregation("regions","/data",c);},getRgbaColorCode:function(s,o){var h=sap.ui.core.theming.Parameters.get(s);var r=this.utilsRef.convertHexToRgba(h,o);return r;},getColorFormatterFunction:function(e,c){var a=null;var s=function(m,t){m=parseFloat(m);t=parseFloat(t);return((m>t)?c.colors.semanticGoodColorRgba:((m==t)?c.colors.semanticNeutralColorRgba:c.colors.semanticBadColorRgba));};var b=function(m,t){m=parseFloat(m);t=parseFloat(t);return((m<t)?c.colors.semanticGoodColorRgba:((m==t)?c.colors.semanticNeutralColorRgba:c.colors.semanticBadColorRgba));};var r=function(m,t){m=parseFloat(m);t=parseFloat(t);return c.colors.semanticNeutralColorRgba;};var n=function(m,t){m=parseFloat(m);t=parseFloat(t);return((m>t)?c.colors.nonSemanticGoodColorRgba:((m==t)?c.colors.nonSemanticNeutralColorRgba:c.colors.nonSemanticBadColorRgba));};var d=function(m,t){m=parseFloat(m);t=parseFloat(t);return((m<t)?c.colors.nonSemanticGoodColorRgba:((m==t)?c.colors.nonSemanticNeutralColorRgba:c.colors.nonSemanticBadColorRgba));};if(e.isMaximizingKpi()){a=(c.mapDetails.isColorSchemeAutoSemantic())?s:n;}else if(e.isMinimizingKpi()){a=(c.mapDetails.isColorSchemeAutoSemantic())?b:d;}else{a=r;}return a;},getAllMapColors:function(){this.colors={};this.colors.NONSEMANTIC_GOOD_OPACITY="1.0";this.colors.NONSEMANTIC_NEUTRAL_OPACITY="0.60";this.colors.NONSEMANTIC_BAD_OPACITY="0.30";this.colors.semanticGoodColorRgba=this.colors.semanticGoodColorRgba||this.getRgbaColorCode("sapUiPositive");this.colors.semanticBadColorRgba=this.colors.semanticBadColorRgba||this.getRgbaColorCode("sapUiNegative");this.colors.semanticNeutralColorRgba=this.colors.semanticNeutralColorRgba||this.getRgbaColorCode("sapUiNeutral");this.colors.nonSemanticGoodColorRgba=this.colors.nonSemanticGoodColorRgba||this.getRgbaColorCode("sapUiNeutral",this.colors.NONSEMANTIC_GOOD_OPACITY);this.colors.nonSemanticBadColorRgba=this.colors.nonSemanticBadColorRgba||this.getRgbaColorCode("sapUiNeutral",this.colors.NONSEMANTIC_BAD_OPACITY);this.colors.nonSemanticNeutralColorRgba=this.colors.nonSemanticNeutralColorRgba||this.getRgbaColorCode("sapUiNeutral",this.colors.NONSEMANTIC_NEUTRAL_OPACITY);},getMapDetails:function(){var p=this.parentController;var s=p.SELECTED_VIEW;var a=s.getDimensions();var b=s.getMeasures();var m=(a&&a.length)?a[0]:"";var c=p.DIMENSION_TEXT_PROPERTY_MAPPING[m];var d=(s.getChartConfiguration()&&s.getChartConfiguration().length)?s.getChartConfiguration()[0]:null;var i=d.getColorScheme().isAutoSemantic();var t="";var e=[];if(d){t=d.getThresholdMeasure();if(t){b.forEach(function(g){if(g!=t){e.push(g);}});}else{e=b;}}var f=e[0];return{getMapMeasure:function(){return f;},getAllMeasures:function(){return b;},getMapDimension:function(){return m;},isColorSchemeAutoSemantic:function(){return i;},getThresholdMeasure:function(){return t;},getMeasuresExceptThreshold:function(){return e;},setMapMeasure:function(g){f=g;},getMapDimensionTextName:function(){return c;}}},formatTooltip:function(){var p=this.parentController;var v=arguments;var c=p.COLUMN_LABEL_MAPPING;var r=p.getView().getModel("i18n").getResourceBundle();var t=r.getText("OTHER_MEASURES")+" : \n";var m=r.getText("MAIN_MEASURE")+" : \n";var a=r.getText("THRESHOLD_MEASURE")+" : \n";var d=r.getText("DIMENSIONS")+" : \n";var b=this.mapDetails.getMapMeasure();var e=this.mapDetails.getThresholdMeasure();var f=this.mapDetails.getAllMeasures();var g=this.mapDetails;d+=(c[this.mapDetails.getMapDimension()]||this.mapDetails.getMapDimension())+" - "+v[1];for(var i=0,l=f.length;i<l;i++){if(f[i]==b){m+=(c[f[i]]||f[i])+" - "+v[i+2];}else if(f[i]==e){a+=(c[f[i]]||f[i])+" - "+v[i+2];}else{t+=(c[f[i]]||f[i])+" - "+v[i+2];}}t=d+"\n\n"+m+"\n\n"+a+"\n\n"+t;return t;}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap.view')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap.view');jQuery.sap.require('sap.ui.vbm.AnalyticMap');(function(){"use strict";sap.ui.jsview("sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap",{getControllerName:function(){return"sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap";},createContent:function(c){this.analyticalMap=new sap.ui.vbm.AnalyticMap({width:"100%",plugin:false});return this.analyticalMap;}});}());};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.Drilldown.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.Drilldown.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.drilldown.view.Drilldown",{_getEvaluationId:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;return s["evaluationId"][0];}catch(e){return sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters().evaluationId[0];}},_getDataFromUrl:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;this.TILE_TYPE='';this.DIMENSION='';if(s["tileType"]){this.TILE_TYPE=s["tileType"][0];}if(s["dimension"]){this.DIMENSION=s["dimension"][0];}if(s["sap-system"]){this.SAP_SYSTEM=s["sap-system"][0];}if(s["chipId"]){this.CHIP_ID=s["chipId"][0];}}catch(e){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();if(p){if(p.tileType){this.TILE_TYPE=p.tileType[0];}if(p.dimension){this.DIMENSION=p.dimension[0];}if(p["sap-system"]){this.SAP_SYSTEM=p["sap-system"][0];}if(p["chipId"]){this.CHIP_ID=p["chipId"][0];}}}},fetchAllEvaluations:function(p){var h=[this._getEvaluationId()];var H=this.CONFIGURATION.getHeaders();H.forEach(function(c){if(c.isAssociated()){if(h.indexOf(c.getReferenceEvaluationId())==-1){h.push(c.getReferenceEvaluationId());}if(h.indexOf(c.getEvaluationId())==-1){h.push(c.getEvaluationId());}}});this._bundled_evaluations_call_ref=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.setEvaluationsCache({evalIdArray:h,sapSystem:this.SAP_SYSTEM,success:p.success,context:p.context});},onAfterRendering:function(){},onInit:function(){var t=this;if(sap.ui.Device.system.desktop){this.getOwnerComponent().setRouterSetCloseDialogs(false);this.byId("header-ribbon").setShowTitleSelector(true);}if(sap.ui.Device.system.tablet){$(window).on("orientationchange",function(e){t.getUIComponents().getHeaderContainer().rerender();});}sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();this._requestTimeLog={};this._busyDialog=new sap.m.BusyDialog();sap.sb_drilldown_app=this;this.EVALUATION=null;this.CONFIGURATION=null;this.SELECTED_VIEW=null;this.POPOVER_VIEW_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"VIEW_NAVIGATION":[]});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"APP_NAVIGATION":[]});this.SEMANTIC_OBJECT=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject();this.ACTION=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getAction();this.urlParsingService=sap.ushell.Container.getService("URLParsing");this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.addExportMethodToTable();var E=this._getEvaluationId();var a=E;this._EVALUATION_ID=E;this.firstTimeFlag=false;this._getDataFromUrl();if(!this._proxyHashChangeListener){this._proxyHashChangeListener=jQuery.proxy(this.hashChangeListener,this);this._attachHashChangeEvent();}this._busyDialog.open();var i=sap.suite.ui.smartbusiness.Configuration.isMetadataFromABAP();if(i){var r=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");r.getDataByEntity({entity:"PROPERTIES",filter:"TYPE eq 'EV' and IS_ACTIVE eq 1 and ID eq '"+E+"' and NAME eq 'SAP:Copied_From'",async:false,success:function(d){if(d&&d.length){a=d[0].VALUE||E;}},error:function(e){jQuery.sap.log.error(e&&e.message);}});}var s=new Date().getTime();var c=function(d){this.DDA_CONFIG_ODATA_CALL_REF=d;};sap.suite.ui.smartbusiness.drilldown.lib.Configuration.loadConfiguration({evaluationId:a,cache:true,success:function(b){var e=new Date().getTime();this._requestTimeLog["DDA_CONFIG_FETCH"]={title:"Configuration",time:e-s};this.CONFIGURATION=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.parse(a,b);var t=this;if(this.CONFIGURATION.getAllViews().length==0){jQuery.sap.log.error("drilldown not configured");var I=t.getView().getModel("i18n");sap.m.MessageBox.alert(I.getResourceBundle().getText("DDA_NOT_CONFIGURED"),function(){window.location.hash="";t._busyDialog.close();});return;}var d=new Date().getTime();this.fetchAllEvaluations({success:function(){var f=new Date().getTime();this._requestTimeLog["BUNDLED_EVALUATIONS_FETCH"]={title:"Evaluations",time:f-d};this.EVALUATION_ODATA_CALL_REF=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.getEvaluationById({id:E,cache:true,filters:true,thresholds:true,success:function(g){this._busyDialog.close();this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(g);if(this.metadataRef.getPlatform().toUpperCase()==="HANA"){this.EVALUATION.parse_sapclient();}this._initialize();if(jQuery.device.is.phone){var o=this.getUIComponents().getHeader();o.addAttribute(new sap.m.ObjectAttribute({text:this.EVALUATION.getDescription()}));}},error:function(){this._busyDialog.close();throw new Error("Evaluation Details Not Found with ID : "+E);},context:this,sapSystem:this.SAP_SYSTEM});},context:this,});},error:function(){jQuery.sap.log.error("Drilldown Configuration Fetching Failed");this._busyDialog.close();},context:this,sapSystem:this.SAP_SYSTEM},c);},updateFilter:function(){var f=this.getUIComponents().getFilter();var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(f.getVisible()){f.refreshFilter();}else{f.setVisible(true);}this._fixFacetListSelection();},onBeforeRendering:function(){},isACurrencyMeasure:function(m){var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var e=this.EVALUATION.getEntitySet();return sap.suite.ui.smartbusiness.lib.Util.odata.getFormattingMetadata(u,e,m)._hasCurrency;},libFormat:function(n,i,c){i=i||false;c=c||null;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Formatter");return sap.suite.ui.smartbusiness.lib.Formatter.getLocaleFormattedValue(Number(n),this.EVALUATION.getScaling(),this.nDecimal,i,c);},libFormat_nonscaled:function(n,i,c){i=i||false;c=c||null;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Formatter");return sap.suite.ui.smartbusiness.lib.Formatter.getLocaleFormattedValue_nonscaled(Number(n),this.EVALUATION.getScaling(),this.nDecimal,i,c);},getLibFormatter:function(n,i,s,d){if(s==null||typeof s=="undefined"){s=this.EVALUATION.getScaling();}if(d==null||typeof d=="undefined"){d=this.nDecimal;}i=i||false;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Formatter");return sap.suite.ui.smartbusiness.lib.Formatter.getLocaleFormatter(Number(n),s,d,i);},getLibFormatter_nonscaled:function(n,i,s,d){if(s==null||typeof s=="undefined"){s=this.EVALUATION.getScaling();}if(d==null||typeof d=="undefined"){d=this.nDecimal;}i=i||false;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Formatter");return sap.suite.ui.smartbusiness.lib.Formatter.getLocaleFormatter_nonscaled(Number(n),s,d,i);},_initialize:function(){var t=this;this._OPEN_IN_LINKS={};this._fetchNavigationLinks().done(function(r){if(r&&r.length){t.setHeaderFooterOptions(t.getHeaderFooterOptions());t._initExternalNavigationLinks(r);t.renderTitle();}else{t.setHeaderFooterOptionsWithoutOpenInButton();}});this.nDecimal=this.EVALUATION.getDecimalPrecision();if(typeof this.nDecimal=="undefined"){this.nDecimal=-1;}this.oFormatOptions_ca={style:"standard"};this.oFormatOptions_core={style:"short"};this.oFormatOptions_percent={style:"percent"};if(!(this.nDecimal==null||this.nDecimal==-1)){this.oFormatOptions_ca.decimals=this.nDecimal;this.oFormatOptions_core.minFractionDigits=this.nDecimal;this.oFormatOptions_core.maxFractionDigits=this.nDecimal;}if(this.nDecimal==-1){this.oFormatOptions_ca.decimals=-1;this.oFormatOptions_core.minFractionDigits=-1;this.oFormatOptions_core.maxFractionDigits=-1;}var w=this.EVALUATION.getKpiName()+" - "+this.EVALUATION.getTitle();try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(w);}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+w)}var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),this.EVALUATION.getEntitySet());this.COLUMN_LABEL_MAPPING=p.getLabelMappingObject();this.DIMENSION_TEXT_PROPERTY_MAPPING=p.getTextPropertyMappingObject();this.MEASURE_UNIT_PROPERTY_MAPPING=p.getUnitPropertyMappingObject();this._initAddToHomeDialogBox();var v=new sap.ui.model.json.JSONModel();v.setData(this.CONFIGURATION.getAllViews());var U=this.getUIComponents();U.getVizChartContainer().setModel(v,"VIEW_SWITCH");this.chartModel=new sap.ui.model.json.JSONModel();var c=9999;this.chartModel.setSizeLimit(c);U.getVizChartContainer().setModel(this.chartModel);this.EvaluationHeaderModel=new sap.ui.model.json.JSONModel();U.getHeader().setModel(this.EvaluationHeaderModel);this.titleModel=new sap.ui.model.json.JSONModel();U.getPage().getCustomHeader().getContentMiddle()[0].setModel(this.titleModel);this.renderDrilldownHeader();this._initRequestTimeLogChart();this.hashChangeListener();sap.ui.Device.orientation.attachHandler(this.renderTitle,this);},applyTrendColor:function(W,C,a,b,g,k){var r=null;var w=parseFloat(W);var c=parseFloat(C);var d=parseFloat(a);var e=parseFloat(b);if(g=="MI"){if(d&&e){if(k<e){r=sap.ui.core.ValueState.Success;}else if(k<=d){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Error;}}}else if(g=="MA"){if(c&&w){if(k<c){r=sap.ui.core.ValueState.Error;}else if(k<=w){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Success;}}}else{if(w&&e&&c&&d){if(k<c||k>d){r=sap.ui.core.ValueState.Error;}else if((k>=c&&k<=w)||(k>=e&&k<=d)){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Success;}}}return r;},switchedToTableView:function(){if(this.getUIComponents().getChart()){this.setChartSelectionContextObject(null);}},switchedToChartView:function(){this.getUIComponents().getTable().setSelectedContext(null);},renderDrilldownHeader:function(){var f=this.CONFIGURATION.getFilters();var o=this.getUIComponents().getHeaderContainer();this.renderFilters(f);var h=this.CONFIGURATION.getHeaders();if(!((h&&h.length)||this.EVALUATION.getDescription())){this.getUIComponents().getHeader().setShowTitleSelector(false);}this.renderTitle();this.renderEvaluationHeader();},renderTitle:function(){var t=this.getUIComponents().getPage().getCustomHeader().getContentMiddle()[0];if(t){if(this.EVALUATION){t.setText(this.EVALUATION.getKpiName());}}},renderFilters:function(f){var a=this.getUIComponents().getFilter();a.setEvaluationData(this.EVALUATION);a.setEvaluationId(this.EVALUATION.getId());a.setDimensions(f);a.setSapSystem(this.SAP_SYSTEM);},displayMiniCharts:function(){var o=this.getUIComponents().getHeader();var a=this.getUIComponents().getHeaderContainer();var b=o.getAttributes()||[];if(a.getVisible()||b.length){a.setVisible(false);o.removeAllAttributes();}else{var h=this.CONFIGURATION.getHeaders();if(!(h&&h.length)){a.setVisible(false);}else{a.setVisible(true);this.renderKpiHeaders(h);}o.removeAllAttributes();o.addAttribute(new sap.m.ObjectAttribute({text:this.EVALUATION.getDescription()}));}this._fixPostResizeIssue();$(window).trigger('resize');},renderKpiHeaders:function(h){var s=this;var a=this.getUIComponents().getTileContainer();a.removeAllItems();this.miniChartManager=sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager.renderHeaders({allTiles:h,headerContainer:a,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters(),onNavigation:function(){s._detachHashChangeListener();}});},renderView:function(c){this.table=null;this.chart=null;this.geoMap=null;this.analyticalMap=null;this._addUIComponents(c);var a=c.getColumns();var b=c.getChartConfiguration();this.renderTable(a,b[0].getColorScheme());if(this.chart){this.renderChart(c,b[0],a);}else if(this.analyticalMap){this.renderAnalyticalMap(c);}else if(this.geoMap){this.renderGeoMap(c);}},renderEvaluationHeader:function(){var s=this;var o=this.getUIComponents().getHeader(),t=this;o.setTitle(this.EVALUATION.getTitle());var k=this.EVALUATION.getKpiMeasureName();var f=k;var a=this.MEASURE_UNIT_PROPERTY_MAPPING[k];o.bindProperty("number",{parts:[{path:"/data/"+f},{path:"/data/"+a}],formatter:function(v,c){if(f!=k){return v;}if(v){var i=s.isACurrencyMeasure(k);c=c||null;return s.libFormat_nonscaled(v,i,c);}return v;}});if(a){o.bindProperty("numberUnit","/data/"+a);}},fetchKpiValue:function(){if(!this.CONFIGURATION.isAggregateValueEnabled()){return;}var t=this;var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),measure:this._getEvaluationThresholdMeasures(),filter:this.getAllFilters()});var s=new Date().getTime();var e=this._getEvaluationId();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS=function(d){var a=new Date().getTime();t._requestTimeLog["KPI_VALUE"]={title:"Kpi Value",time:a-s};if(d&&d.results.length){t.EvaluationHeaderModel.setData({data:d.results[0]});var h=t.getView().byId("header-ribbon");var k=d.results[0];if(t.EVALUATION){var b,W,C,c,g,j;b=parseFloat(k[t.EVALUATION.getKpiMeasureName()]);var l=t.EVALUATION.getThresholds();if(t.EVALUATION.getThresholdValueType()=="MEASURE"){var i,v=t.EVALUATION.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){W=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="CL"){C=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="CH"){c=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="WH"){g=k[v[i].COLUMN_NAME];}}j=t.applyTrendColor(W,C,c,g,t.EVALUATION.getGoalType(),b);h.setNumberState(j);}else if(t.EVALUATION.getThresholdValueType()=="RELATIVE"){var i,m,v=t.EVALUATION.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="TA"){m=k[v[i].COLUMN_NAME];break;}}for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){W=Number(m)*v[i].FIXED/100;}if(v[i].TYPE=="CL"){C=Number(m)*v[i].FIXED/100;}if(v[i].TYPE=="CH"){c=Number(m)*v[i].FIXED/100;}if(v[i].TYPE=="WH"){g=Number(m)*v[i].FIXED/100;}}j=t.applyTrendColor(W,C,c,g,t.EVALUATION.getGoalType(),b);h.setNumberState(j);}}sap.suite.ui.smartbusiness.lib.Util.cache.setKpiDetailsById(e,d);if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){var x=sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];x.resolve();}}else{delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri);t.EvaluationHeaderModel.setData({data:{}});}};this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL=function(a){jQuery.sap.log.error(a);t.EvaluationHeaderModel.setData({data:{}});if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){var x=sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];x.reject();}};var f=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(e);if(f){this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(f);}else if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){jQuery.when(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]).then(function(){var d=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(e);t.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(d);},function(a){jQuery.sap.log.error(a)});}else{sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]=jQuery.Deferred();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL);}},_addPopoverContent:function(c,i){var l=new sap.m.List({visible:{path:"/VIEW_NAVIGATION",formatter:function(A){if(A&&A.length>0){return true;}return false;}}});l.bindItems("/VIEW_NAVIGATION",new sap.m.ActionListItem({text:"{TITLE}",customData:new sap.ui.core.CustomData({key:"{ID}",value:"{ID}"}),press:jQuery.proxy(this._onViewSelection,this,{publishContext:true,isTable:!!i})}).addStyleClass("smartbusinessTablePopoverAction").setTooltip("{TITLE}"));var a=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());l.setModel(this.POPOVER_VIEW_NAVIGATION_MODEL);var b=new sap.m.List({});this._popoverNavigationListReferences.push(b);b.bindItems("/APP_NAVIGATION",new sap.m.StandardListItem({title:"{text}",type:sap.m.ListType.Navigation,customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationType}"}),press:jQuery.proxy(this._onAppSelection,this,{publishContext:true,isTable:!!i})}).setTooltip("{text}"));b.setModel(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL);var p=new sap.m.VBox({items:[l,b],width:"99%"});c.setPopoverFooter(p);},_addUIComponents:function(v){this.table=null;this.chart=null;this.geoMap=null;this.analyticalMap=null;var c=this.getUIComponents().getVizChartContainer();c.removeAllContent();var a=v.getChartConfiguration()[0];if(a){var t=this;this._popoverNavigationListReferences=[];this.table=new sap.suite.ui.smartbusiness.drilldown.lib.CustomTable({mode:sap.m.ListMode.SingleSelectMaster}).addStyleClass("smartBusinessDrilldownTable");this.table.attachSelectionChange(function(){t._onTableRowSelected();});this.table.addEventDelegate({onAfterRendering:function(){t.switchedToTableView();}});this.table.setModel(this.getView().getModel("i18n"),"i18n");this._addPopoverContent(this.table,true);if(a.getChartType().isTable()){var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});b.setContent(this.table);c.addContent(b);}else if(a.getChartType().isGeoMap()){}else if(a.getChartType().isAnalyticalMap()){try{this.analyticalMap=new sap.ui.core.mvc.JSView({viewName:"sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap",viewData:{parent:this}});}catch(e){jQuery.sap.log.error("Map view not available");jQuery.sap.log.error(e.message);throw(e);}var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var m=new sap.m.VBox({items:[this.analyticalMap],fitContainer:true});b.setContent(m);c.addContent(b);}else{this.chart=new sap.viz.ui5.controls.VizFrame({vizType:"bar",uiConfig:{applicationSet:'fiori'},});this.chart.setVizProperties({plotArea:{dataLabel:{visible:true,formatString:"dataLabelFormatter",hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false},valueAxis:{label:{formatString:"yValueAxisFormatter"}}});this.vizChartPopover=new sap.viz.ui5.controls.Popover().setFormatString("vizPopOver");this.vizChartPopover.connect(this.chart.getVizUid());this.chart.addEventDelegate({onAfterRendering:function(){t.switchedToChartView();}});var d=new sap.suite.ui.commons.ChartContainerContent({icon:"sap-icon://bar-chart",});d.setContent(this.chart);c.addContent(d);var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});b.setContent(this.table);c.addContent(b);}}else{jQuery.sap.log.error("NO Chart Configuration found!! ");}},_setNoDataText:function(p){this.table.setNoDataText(this.getView().getModel("i18n").getProperty(p));if(this.chart){}},fetchDataForChart:function(){var c=this.getUIComponents().getVizChartContainer();var V=this.SELECTED_VIEW;var t=this;try{this.chartModel.setData({data:[]});c.setBusy(true);var d=[].concat(this.SELECTED_VIEW.getDimensions());var m=this.SELECTED_VIEW.getMeasures();var s=null;if(this.TABLE_SORTING&&this.TABLE_SORTING.length){s=this.TABLE_SORTING;}else if(this.COLUMNS_SORT&&this.COLUMNS_SORT.length){s=this.COLUMNS_SORT;}var a=null;try{var D=window.parseInt(this.SELECTED_VIEW.getChartConfiguration()[0].getDataLimit());if(isNaN(D)){jQuery.sap.log.error("Invalid Data Limit Value : "+a);}else{if(D!=-1){a=D;}}}catch(e){jQuery.sap.log.error("Error parsing Data Limit Value")}var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),dimension:d,measure:m,filter:this.getAllFilters(),sort:s,dataLimit:a});this._setNoDataText("DATA_LOADING");var b=new Date().getTime();this.CHART_TABLE_DATA_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,function(f){var g=new Date().getTime();t._requestTimeLog["CHART_TABLE_DATA"]={title:"Chart/Table Data",time:g-b};if(f.results.length===0){t._setNoDataText("DATA_NODATA");}t.chartModel.setData({data:f.results});c.setBusy(false);if(t.getUIComponents().getChart()){t.setAllVizFormatters();}if(f.results.length){t._appendUOMToTableHeader(f.results[0]);t._appendUOMToVizChartAxis(f.results[0]);}},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t._setNoDataText("DATA_LOADING_FAILED");t.chartModel.setData({data:[]});c.setBusy(false);t.chartModel.setData({data:[]});});}catch(e){t._setNoDataText("DATA_LOADING_FAILED");jQuery.sap.log.error(e);c.setBusy(false);this.chartModel.setData({data:[]});}},_getTableContextParameters:function(d){var e={};var t=this.getUIComponents().getTable().getSelectedContext();if(t&&t.length){t.forEach(function(a){d.forEach(function(b){var c=a[b];if(c==null){c="SAP_SMARTBUSINESS_NULL";}if(c||c==0||c==''){if(c.getTime){c=c.getTime();}if(!e[b]){e[b]=[];}e[b].push(c);}});});}return e;},_getChartContextParameters:function(d){var e,c;c=this.getChartSelectionContextObject();e={};if(c){var a=this.getUIComponents().getChart().getDataset();for(var b in c){var f=c[b];var g=a.findContext(f).getObject();d.forEach(function(h){var i=g[h];if(i==null){i="SAP_SMARTBUSINESS_NULL";}if(i||i==0||i==''){if(i.getTime){i=i.getTime();}if(e[h]){e[h].push(i);}else{e[h]=[];e[h].push(i);}}});}}return e;},_onViewSelection:function(c,e){var v=e.getSource().getCustomData()[0].getKey();var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var d=this.SELECTED_VIEW.getDimensions();var a=this[c.isTable?"_getTableContextParameters":"_getChartContextParameters"](d,false);for(var b in a){if(p[b]){delete p[b];}p[b]=a[b]}p["viewId"]=v;sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(p,false);if(c.isTable){this.getUIComponents().getTable().setSelectedContext(null);}else{this.setChartSelectionContextObject(null);}sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateHash();},getChartSelectionContextObject:function(){},setChartSelectionContextObject:function(v){},_detachHashChangeListener:function(){try{this.hashChanger.detachEvent("hashChanged",this._proxyHashChangeListener);this._proxyHashChangeListener=null;this.hashChangerAttached=true;}catch(e){jQuery.sap.log.error("Error Detaching hashChanged Event");}},_onAppSelection:function(c,e){var a=function(i,m){if(m){for(var p in m){if(i&&i[p]){delete i[p];}}}};var b,n=e.getSource().getCustomData()[0].getKey();var d=e.getSource().getCustomData()[0].getValue();var s=n.split("~")[0];var f=s.split("-");var g=f[0];var h=f[1];var i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(g=="AdhocAnalysis"){i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();}var j=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();var k={};var l=this.SELECTED_VIEW.getDimensions();if(c.isFromOpenIn){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);b=this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{if(c.isTable){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{b=this._getChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}}jQuery.extend(true,k,j,i);if(sap.ushell.Container&&sap.ushell.Container.getService){var C=sap.ushell.Container.getService("CrossApplicationNavigation");if(C){var t=C.hrefForExternal({target:{semanticObject:g,action:h},params:k});if(d=="SAPUI5"){this._detachHashChangeListener();}window.location.hash=t;}else{jQuery.sap.log.error("ushell CrossApplicationNavigation service returns null");}}else{jQuery.sap.log.error("ushell Services not running");}},_fillChartTablePopoverContent:function(){var t=this;var v=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());this.POPOVER_VIEW_NAVIGATION_MODEL.setData({VIEW_NAVIGATION:v});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:[]});if(this._popoverNavigationListReferences&&this._popoverNavigationListReferences.length){this._popoverNavigationListReferences.forEach(function(n){n.setNoDataText(" ");n.setBusy(true);},this);}t._fetchNavigationLinks().done(function(){var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");t.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF=N.getLinksByContext({semanticObject:t.SEMANTIC_OBJECT,dimensions:t.SELECTED_VIEW.getDimensions(),context:t,viewId:t.EVALUATION.getId()+"_"+t.SELECTED_VIEW.getId()}).done(function(l){var O=jQuery.extend({},t._OPEN_IN_LINKS);var u=t._getUniqueNavLinks(l,O);if(u.length){t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:u});}if(t._popoverNavigationListReferences&&t._popoverNavigationListReferences.length){t._popoverNavigationListReferences.forEach(function(n){n.setBusy(false);},t);}})});},_getListOfViewsForPopover:function(a,e){var b=[];a.forEach(function(v){if(v.ID!==e){b.push(jQuery.extend(false,{},v));}});return b;},_onTableRowSelected:function(){this._fillChartTablePopoverContent();},_getStacking:function(c){var s={stacking:false,dimensionStacked:false,measureStacked:false,stackedDimensionName:null};var a=this.SELECTED_VIEW;c.forEach(function(e){var C=a.findColumnByName(e);if(C.isMeasure()){if(C.isStacked()){s.stacking=true;s.measureStacked=true;return false;}}});if(!s.stacking){c.forEach(function(e){var C=a.findColumnByName(e);if(C.isDimension()){if(C.isStacked()){s.stacking=true;s.dimensionStacked=true;if(C.getAxis()==2){s.stackedDimensionName=C.getName();return false;}}}});}return s;},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"||this.EVALUATION.getThresholdValueType()==="RELATIVE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME);}}}}return t;},renderChart:function(v,c,a){var t=this;var b=this.getUIComponents().getChart();if(!c||!a.length)return;var d=this.getUIComponents().getVIZvbox();d.setVisible(true);b.addEventDelegate({onAfterRendering:function(){t._fillVizChartPopoverContent(t.vizChartPopover,false);}});b.attachSelectData(jQuery.proxy(this._onVizChartDataPointSelection,this,{chartPopover:this.vizChartPopover}));var e=this.create_vizDataset(c,a);var V=this.getVizTypeAndIcon(c,v);b.setVizType(V.type);b.getParent().setIcon(V.icon);b.setDataset(e);this._addFeedsToVizFrame(b,c,a);this.applyColorToVizChart(b,c);if(c.isDualAxis()||c.getChartType().isBubble()){var p=this.chart.getVizProperties();p.valueAxis2={label:{formatString:"y2ValueAxisFormatter"}};this.chart.setVizProperties(p);if((this.EVALUATION.getScaling()==-2)&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){this._handleVizDualAxisWhenPercentScale(t.chart);}}this._showChartLegendIfApplicable(c,a);},renderAnalyticalMap:function(v){var a=this.getUIComponents().getAnalyticalMap();var m=a.analyticalMap.getParent().getController();m.renderMap();},renderGeoMap:function(v){var g=this.getUIComponents().getGeoMap();},_showChartLegendIfApplicable:function(c,C){var o=this.getUIComponents().getVizChartContainer();var s=this._getStacking(C);var V=this.SELECTED_VIEW;var a=c.getChartType();var i=((a.isBar()||a.isColumn())&&s.dimensionStacked&&s.stackedDimensionName&&(V.getDimensionCount()>1))?true:false;if((V.getMeasures().length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length){if(t.indexOf(m)!=-1){return true;}}return false;},_getMeasuresByAxis:function(){var t=this;var V=this.SELECTED_VIEW;var m=V.getMeasures();var a=[],b=[];for(var i=0;i<m.length;i++){var c=V.findColumnByName(m[i]);if(c.isMeasure()&&(c.getAxis()==1)){a.push(m[i]);}else if(c.isMeasure()&&(c.getAxis()==2)){b.push(m[i]);}}return{axis1Msr:a,axis2Msr:b}},_isMeasureSetPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length&&m&&m.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){return true;}}}return false;},_getChartNumberFormatter:function(i,d,m,o,f){var a=this;o=o||false;function b(n){return!isNaN(parseFloat(n))&&isFinite(n);}return function(s){if(!b(s))if(f)return'"'+s+'"';else return s;var c=a.isACurrencyMeasure(m);var e=o?0:null;var g=a.getLibFormatter(s,c,e,d);if(f)return'"'+s+'"';return g.format(Number(s));};},_getChartPercentFormatter:function(f){var t=this;var p=t.getLibFormatter(1,false,-2);function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}return function(s){if(i(s)){if(f)return'"'+s+'"';else return p.format(Number(s));}else if(f){return'"'+s+'"';}else return s;};},getColumnValueFormatter:function(n,i,a,b,f){var t=this;var V=this.SELECTED_VIEW;var c=(V.getChartConfiguration())[0];var d;if(i){d=function(s){if(f){return(s===0||s)?'"'+s+'"':'"'+s+'"';}else{return(s===0||s)?s+"":s;}};}else{if(a){if(c.getChartType().isTable()){if(t._isEvaluationThresholdMeasure(n))d=this._getChartPercentFormatter(f);else d=this._getChartNumberFormatter(true,this.nDecimal,n,true,f);}else if((c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){var C=V.findColumnByName(n);if(b[(C.getAxis())-1]&&t._isEvaluationThresholdMeasure(n))d=this._getChartPercentFormatter(f);else d=this._getChartNumberFormatter(true,this.nDecimal,n,true,f);}else{if(t._isEvaluationThresholdMeasure(n)){d=this._getChartPercentFormatter(f);}else{d=this._getChartNumberFormatter(true,this.nDecimal,n,true,f);}}}else d=this._getChartNumberFormatter(true,this.nDecimal,n,true,f);}var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var m=sap.suite.ui.smartbusiness.lib.Util.odata.getEdmType(u,n,true);var T=m.type;var F=m.format;F=F.toUpperCase();if(T=='Edm.DateTime'){if(!sap.suite.ui.smartbusiness.lib.Util.odata.isTimeZoneIndependent(u,this.EVALUATION.getEntitySet())){var e;if(F=="DATE"||F=="NONE"){e="daysAgo";}else if(F=="DATETIME"){e="";}if(e){var o=new sap.ca.ui.model.type.Date({style:e});d=function(s){if(f)return'"'+o.formatValue(s,"string")+'"';else return o.formatValue(s,"string");};}else{var o=sap.ui.core.format.DateFormat.getDateTimeInstance();d=function(g){if(g&&g.getMinutes){if(f)return'"'+o.format(g)+'"';else return o.format(g);}if(f)return'"'+g+'"';else return g;};}}else{d=function(g){if(g&&g.getMinutes){g.setMinutes(g.getMinutes()+g.getTimezoneOffset());var h=(F=="DATE")?"getDateInstance":"getDateTimeInstance";return sap.ui.core.format.DateFormat[h]().format(g);}if(f)return'"'+g+'"';else return g;};}}return d;},_getVisibleColumns:function(d){var v=[];d.forEach(function(c,i,a){var C=this.SELECTED_VIEW.findColumnByName(c);if(C.isVisibleInTable()){v.push(c);}},this);return v;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,c,i,a){var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var b=this.EVALUATION.getEntitySet();var f=sap.suite.ui.smartbusiness.lib.Util.odata.getFormattingMetadata(u,b,o);var t=this.SELECTED_VIEW.getChartConfiguration()[0]&&this.SELECTED_VIEW.getChartConfiguration()[0].getThresholdMeasure();var d=this;function _(){jQuery.sap.require("sap.ui.core.format.NumberFormat");return function(s,e){var g=true;return d.libFormat_nonscaled(s,g,e);};}if(f._hasCurrency&&!i){if(this.EVALUATION.isTargetKpi()){return new sap.m.Label({text:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()},tooltip:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()}});}else{if(c.isAutoSemantic()&&t){return new sap.m.ObjectNumber({number:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()},tooltip:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()},state:{parts:[{path:o},{path:t}],formatter:function(m,g){try{m=window.parseFloat(m);g=window.parseFloat(g);return d._getValueState(m,g);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()},tooltip:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()}});}}}else{if(this.EVALUATION.isTargetKpi()){return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},tooltip:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}});}else{if(c.isAutoSemantic()&&t){return new sap.m.ObjectNumber({number:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},tooltip:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,g){try{m=window.parseFloat(m);g=window.parseFloat(g);return d._getValueState(m,g);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},tooltip:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}});}}}},_sortTableByColumnName:function(c){var i={"asc":String.fromCharCode(0xe1e1),"desc":String.fromCharCode(0xe1e2)};var s=null;if(c.sort_by===void(0)){s="desc";}else{s=c.sort_by=="asc"?"desc":"asc";}c.sort_by=s;var a=this.getUIComponents().getTable().getColumns();a.forEach(function(C){var h=C.getHeader();h.setText(h.dimension_label+(h.UOM?" ("+h.UOM+")":""));});c.setText(i[s]+" "+c.dimension_label+(c.UOM?" ("+c.UOM+")":""));var C=this.SELECTED_VIEW.findColumnByName(c.dimension_key);var b=C.getSortBy();this.TABLE_SORTING=[{name:b,order:s}];this.fetchDataForChart();},_appendUOMToTableHeader:function(r){if(this.UOM_APPENDED_TO_HEADER){return;}var c=this.getUIComponents().getTable().getColumns();c.forEach(function(C){var a=C.getHeader().getText();var b=C.column_name;var o=this.SELECTED_VIEW.findColumnByName(b);if(o.isMeasure()){var u=this.MEASURE_UNIT_PROPERTY_MAPPING[b];if(u!==b){var d=r[u];if(d){C.getHeader().UOM=d;C.getHeader().setText(a+" ("+d+")");C.getHeader().setTooltip(a+" ("+d+")");}}}},this);this.UOM_APPENDED_TO_HEADER=true;},renderTable:function(t,c){var a=this;var v=this.getUIComponents().getVIZvbox();v.setVisible(true);var b=this.getUIComponents().getTable();var C=(this.SELECTED_VIEW.getChartConfiguration())[0];b.removeAllColumns();var S=this.SELECTED_VIEW;var d=this._getVisibleColumns(t);this.COLUMNS_SORT=[];t.forEach(function(s,m,n){var o=this.SELECTED_VIEW.findColumnByName(s);if(o.getSortBy()&&o.getSortOrder()){if(o.getSortOrder()=="asc"||o.getSortOrder()=="desc"){this.COLUMNS_SORT.push({name:o.getSortBy(),order:o.getSortOrder()});}}},this);var e=false;if((this.EVALUATION.getScaling()==-2)&&!((C.isPercentageValue())&&(C.getChartType().isBar()||C.getChartType().isColumn()))){e=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());}var f=[];if(e){if((C.isDualAxis())&&(C.isAbsoluteValue())&&(C.getChartType().isBar()||C.getChartType().isColumn())){var g=this._getMeasuresByAxis();f.push(this._isMeasureSetPercentScaled(g.axis1Msr));f.push(this._isMeasureSetPercentScaled(g.axis2Msr));}}var h=new sap.m.ColumnListItem({type:sap.m.ListType.Active});for(var i=0,l=d.length;i<l;i++){var o=this.SELECTED_VIEW.findColumnByName(d[i]);var L=new sap.m.Label({text:this.COLUMN_LABEL_MAPPING[d[i]],tooltip:this.COLUMN_LABEL_MAPPING[d[i]]}).addStyleClass("tableColumnHeader");L.dimension_key=d[i];L.dimension_label=this.COLUMN_LABEL_MAPPING[d[i]];L.attachBrowserEvent("click",function(){a._sortTableByColumnName(this);});var j=new sap.m.Column({hAlign:o.isMeasure()?"End":"Begin",styleClass:"qty",header:L,minScreenWidth:"Tablet",demandPopin:true,});j.column_name=d[i];if(o.isMeasure()){var k=this._getTableCell(d[i],c,e,f);h.addCell(k);}else{var k=new sap.m.Label({text:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[d[i]],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[d[i]],true)},tooltip:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[d[i]],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[d[i]],true)}});h.addCell(k);}b.addColumn(j);}b.bindAggregation("items","/data",h);},_abortPendingODataCalls:function(){var a=function(d){try{if(d){d.abort();}}catch(e){}};var b=function(o){if(o&&o.length){o.forEach(function(c){a(c);});}};a(this.DDA_CONFIG_ODATA_CALL_REF);a(this._bundled_evaluations_call_ref);a(this.EVALUATION_ODATA_CALL_REF);a(this.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF);b(this.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF);a(this.CHART_TABLE_DATA_ODATA_CALL_REF);a(this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF);},onBack:function(e){this._abortPendingODataCalls();window.history.back();},_resetConfigurations:function(){this.TABLE_SORTING=null;this.UOM_APPENDED_TO_HEADER=null;this.setChartSelectionContextObject(null);},_attachHashChangeEvent:function(){this.hashChanger=this.oRouter.oHashChanger;var t=this;if(this.hashChanger){try{if(!t.hashChangerAttached){this.hashChanger.attachEvent("hashChanged",this._proxyHashChangeListener);this.hashChanger.viewRef=this;}t.hashChangerAttached=true;}catch(e){jQuery.sap.log.error("Couldn't Attach HashChange Event");}}else{jQuery.sap.log.error("Router HashChanger Object Found NULL");}},getUrlFilters:function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O);});}}return u;},getAllFilters:function(){var e=this.EVALUATION.getFilters()["results"]||[];var u=this.getUrlFilters();var t={};u.forEach(function(o){t[o.NAME]=true;});return u.concat(e.filter(function(o){return!t[o.NAME];}));},getAdditionFiltersForChipConfiguration:function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];if(p){for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(e){var t=[];t[0]=k;t[1]="EQ";t[2]=e;t[3]="";u.push(t);});}}}return u;},_hideKpiHeaderIfRequired:function(){return;if(this.CONFIGURATION.getHeaders().length==0){return;}try{var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(a){if(Object.keys(a).length){this.getUIComponents().getTileContainer().$().css("overflow","hidden");this.getUIComponents().getTileContainer().$().animate({height:"0px"});return;}}this.getUIComponents().getTileContainer().$().animate({height:"156px"});}catch(e){jQuery.sap.log.error("Failed to Hide KPI Header : "+e);}},hashChangeListener:function(h){this.NEW_HASH=h?h.getParameter("newHash"):"";this.OLD_HASH=h?h.getParameter("oldHash"):"";var A=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var K="viewId";if(!A[K]){this.SELECTED_VIEW=this.CONFIGURATION.getDefaultView();if(this.SELECTED_VIEW){this.renderView(this.SELECTED_VIEW);A.viewId=[this.SELECTED_VIEW.getId()];sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(A,false);var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getHash();window.location.replace("#"+a);}else{jQuery.sap.log.error("Evaluation does not have any views configured");}}else if(!this.SELECTED_VIEW){this.firstTimeFlag=true;this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.SELECTED_VIEW){this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this._hideKpiHeaderIfRequired();this._setViewComboBoxSelectedIndex();this.fetchKpiValue();this.fetchDataForChart();this.updateFilter();}else{jQuery.sap.log.error("The view with viewId : "+A[K][0]+" does not exist");}}else if(this.SELECTED_VIEW&&A[K][0]!=this.SELECTED_VIEW.getId()){this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.firstTimeFlag){sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();}this._setViewComboBoxSelectedIndex();this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this.fetchKpiValue();this.fetchDataForChart();this._hideKpiHeaderIfRequired();this.updateFilter();this._refreshKpiHeaderTiles();}else{if(this.firstTimeFlag){sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();}this._setViewComboBoxSelectedIndex();this._hideKpiHeaderIfRequired();this.updateFilter();this.fetchKpiValue();this.fetchDataForChart();this._refreshKpiHeaderTiles();}this.byId("vizViewSelector").setTooltip(((this.SELECTED_VIEW&&this.SELECTED_VIEW.getTitle())||""));},_refreshKpiHeaderTiles:function(){var h=this.getUIComponents().getTileContainer();sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager.hashChangeListner({allTiles:this.CONFIGURATION.getHeaders(),headerContainer:h,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters(),firstTimeFlag:this.firstTimeFlag});this.firstTimeFlag=true;},_setViewComboBoxSelectedIndex:function(){try{var v=this.getView().byId("vizViewSelector");v.setSelectedKey(this.SELECTED_VIEW.getId());}catch(e){jQuery.sap.log.error("Failed to Set Selected Index of View ComboBox");}},_fixFacetListSelection:function(){try{var f=this.getUIComponents().getFilter();var a=f.getFacetFilterReference();var u=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var b=a.getLists();if(b.length){b.forEach(function(c){var d=c._techName;if(u[d]){var F=u[d];var i=c.getItems();if(i.length){i.forEach(function(g){var h=g.getBindingContext().getObject()[c._techName]||"";h=h.getTime?h.getTime()+"":h+"";if(F.indexOf(h)>-1){g.setSelected(true);}else{g.setSelected(false);}});}}else{var i=c.getItems();if(i.length){i.forEach(function(g){g.setSelected(false);});}}},this);}}catch(e){}},_getUniqueNavLinks:function(r,e){var u=[];var c=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject()+"-"+sap.suite.ui.smartbusiness.drilldown.lib.Hash.getAction();r.forEach(function(s){var t=s.id.split("~")[0];if(t){if(!e[t]){e[t]=t;if(s.id.indexOf(c)==-1){u.push(s);}}}});return u;},_initExternalNavigationLinks:function(r){var t=this;this.noNavigationLinks=false;this.listOfLinks=new sap.m.List({});this._externalLinkPromiseObject={};sap.suite.ui.smartbusiness.Adapter.getService("Navigation").reset();this._oExternalNavLinksSOPopover=new sap.m.ResponsivePopover({modal:false,showHeader:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Top,contentWidth:"18rem",content:t.listOfLinks});if(jQuery.device.is.phone){this._oExternalNavLinksSOPopover.setShowHeader(true);}var m=new sap.ui.model.json.JSONModel({"EXTERNAL_APP_LINKS":null});t.listOfLinks.bindItems("/EXTERNAL_APP_LINKS",new sap.m.StandardListItem({title:"{text}",customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationType}"}),tooltip:"{text}",type:sap.m.ListType.Navigation,press:jQuery.proxy(t._onAppSelection,t,{publishContext:true,isFromOpenIn:true})})).setModel(m);t.listOfLinks.getModel().setData({"EXTERNAL_APP_LINKS":r});},_externalLinkPromiseObject:{},_fetchNavigationLinks:function(){var k="EXTERNAL_NAV_LINK";if(!this._externalLinkPromiseObject[k]){var t=this;var d=new jQuery.Deferred();var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");var s=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject();var a=[s];var b=new Date().getTime();var c={};if(this.CHIP_ID){c["chipId"]=this.CHIP_ID;}if(this._EVALUATION_ID){c["evaluationId"]=this._EVALUATION_ID;}t.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF=N.getLinksBySemanticObject({success:function(r){var e=new Date().getTime();t._requestTimeLog["SEMANTIC_OBJECT_LINKS"]={title:"Semantic Object Links",time:e-b};r=t._getUniqueNavLinks(r,t._OPEN_IN_LINKS)||[];if(r.length){}d.resolve(r);},async:true,error:function(e){jQuery.sap.log.error("Error fetching navigation links by semantic object : "+s);t._oExternalNavLinksSOPopover.setBusy(false);d.reject();},semanticObject:a,businessParam:c,context:t});}return d.promise();},_showExternalNavigationLinks:function(s){if(!this._oExternalNavLinksSOPopover.isOpen()){this._oExternalNavLinksSOPopover.openBy(s);}},_toggleFilter:function(){var c=this;var f=this.getUIComponents().getFilter();if(!f.getSelectedItems()){f.setVisible(!f.getVisible());}else if(f.getSelectedItems()&&f.getVisible()==true){this.oI18nModel=c.getView().getModel("i18n");sap.m.MessageBox.alert(c.oI18nModel.getResourceBundle().getText("Do_you_really_want_to_reset_the_filters?"),{onClose:function(e){if(e=="OK"){f.resetFilter();f.setVisible(false);}else if(e=="CANCEL"){f.setVisible(true);}},title:c.oI18nModel.getResourceBundle().getText("Reset_Filters"),actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL]});}},setHeaderFooterOptionsWithoutOpenInButton:function(){var o=this.getHeaderFooterOptions();o.buttonList=[];this.setHeaderFooterOptions(o);this.renderTitle();},getHeaderFooterOptions:function(){var o=this._getHeaderFooterOptions();var c=this;var i=c.getView().getModel("i18n");var a=sap.ui.Device.os.name;if(a&&a==sap.ui.Device.os.OS.WINDOWS){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("EXPORT_AS_CSV"),sIcon:"sap-icon://excel-attachment",onBtnPressed:function(e){c._exportAsCSV();}});}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbcmode")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Enable Compact Mode",sIcon:"sap-icon://resize",onBtnPressed:function(e){if(c._compactMode){c.getView().removeStyleClass("sapUiSizeCompact");c._compactMode=false;e.getSource().setText("Enable Compact Mode");}else{c.getView().addStyleClass("sapUiSizeCompact");c._compactMode=true;e.getSource().setText("Disable Compact Mode");}this._fixPostResizeIssue();jQuery(window).trigger("resize");}});}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Request-Time Log",sIcon:"sap-icon://time-entry-request",onBtnPressed:function(e){c._performance.start(c._requestTimeLog,c._compactMode);}});}if(c.CHIP_ID&&c.CHIP_ID!=sap.suite.ui.smartbusiness.Configuration.Constants.SMARTBUSINESS_NULL_VALUE){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("SAVE_AS_TILE"),sIcon:"sap-icon://add-favorite",onBtnPressed:function(e){c._openAddToHomeDialogBox();}});}return o;},_getHeaderFooterOptions:function(){var c=this;var i=c.getView().getModel("i18n");this.oListItem=new sap.m.ObjectListItem();var a=String.fromCharCode(0xe078);var o={onBack:function(){c._abortPendingODataCalls();window.history.back();},sFullscreenTitle:"",onFacetFilter:function(){c._toggleFilter();c._fixPostResizeIssue();$(window).trigger('resize');},buttonList:[{sBtnTxt:i.getResourceBundle().getText("OPEN_IN_LABEL"),onBtnPressed:function(e){c._showExternalNavigationLinks(e.getSource());}}],bSuppressBookmarkButton:true,oJamOptions:{fGetShareSettings:function(){var h=c.getView().byId("header-ribbon");var l=new sap.m.ObjectListItem();l.setTitle(h.getTitle());l.setNumber(h.getNumber());l.setNumberUnit(h.getNumberUnit());var s={object:{id:window.location.href,display:l,share:"SAP Smart Business"}};return s;},},additionalShareButtonList:[],oEmailSettings:{fGetMailBody:function(){var h=c.getView().byId("header-ribbon");if(h.getNumberUnit()){return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+" "+(h.getNumberUnit())+")"+"\n"+window.location.href;}else{return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+")"+"\n"+window.location.href;}}},};if(jQuery.device.is.phone){o.buttonList.push({sBtnTxt:i.getResourceBundle().getText("SHOW_RELATED_KPIS"),onBtnPressed:function(e){var b=c.ACTION;c._detachHashChangeListener();sap.suite.ui.smartbusiness.lib.Util.utils.setHash({action:b,route:"miniChart"});}});}return o;},_initRequestTimeLogChart:function(){if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){jQuery.sap.require("sap.suite.ui.smartbusiness.drilldown.lib.Performance");this._performance=new sap.suite.ui.smartbusiness.drilldown.lib.Performance();}},addExportMethodToTable:function(){var t=this;sap.m.Table.prototype.exportData=sap.m.Table.prototype.exportData||function(s){jQuery.sap.require("sap.ui.core.util.Export");s=s||{};if(!s.rows){s.rows={path:"/data",};}var e=new sap.ui.core.util.Export(s);this.addDependent(e);return e;}},_exportAsCSV:function(){var t=this;jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var c=[];var a=[];var C=(this.SELECTED_VIEW.getChartConfiguration())[0];var b=false;a=this.SELECTED_VIEW.getColumns();for(var i=0;i<a.length;i++){c.push(a[i]);var d=this.DIMENSION_TEXT_PROPERTY_MAPPING[a[i]];var u=this.MEASURE_UNIT_PROPERTY_MAPPING[a[i]];if(d&&d!=a[i]){c.push(d);}if(u){c.push(u);}}if((t.EVALUATION.getScaling()==-2)&&!((C.isPercentageValue())&&(C.getChartType().isBar()||C.getChartType().isColumn()))){b=t._isMeasureSetPercentScaled(t.SELECTED_VIEW.getMeasures());}var e=jQuery.map(c,function(f){return{name:t.COLUMN_LABEL_MAPPING[f]||f,template:{content:{path:f,formatter:t.getColumnValueFormatter(f,t.SELECTED_VIEW.getDimensions().indexOf(f)>-1?true:false,b,false,true)}}};});this.getUIComponents().getTable().exportData({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:","}),columns:e}).saveFile().always(function(){this.destroy();});},_openAddToHomeDialogBox:function(){this.oATHDialog.setModel(this.getView().getModel("i18n"),"i18n");this._compactMode?this.oATHDialog.addStyleClass("sapUiSizeCompact"):this.oATHDialog.removeStyleClass("sapUiSizeCompact");this.oATHDialog.open();},_initAddToHomeDialogBox:function(){var c=this;this.oATHDialogContent=new sap.ui.view({type:"XML",viewName:"sap.suite.ui.smartbusiness.drilldown.view.AddToHome",viewData:this});this.oATHDialog=new sap.m.Dialog({title:"{i18n>SAVE_AS_TILE_DIALOG_TITLE}",content:[this.oATHDialogContent],beginButton:new sap.m.Button({text:"{i18n>OK_BUTTON}",press:function(){c.oATHDialogContent.getController().publishTile(function(){c.oATHDialog.close();});}}),endButton:new sap.m.Button({text:"{i18n>CANCEL_BUTTON}",press:function(){c.oATHDialog.close();}})});this.oATHDialog.addStyleClass("sbAddToHomeDialogBox");this.getView().addDependent(this.oATHDialog);},getUIComponents:function(){var p=this.getView().byId("smartbusiness_drilldown_page");var v=this.getView().byId("vizChartContainer");var h=this.getView().byId("header-ribbon");var a=this.byId('headerContainerVBox');var t=this.getView().byId("header-container");var f=this.getView().byId("facetFilter");var b=this.getView().byId("vizVbox");var c=this;return{getChart:function(){return c.chart;},getTable:function(){return c.table;},getVizChartContainer:function(){return v;},getFilter:function(){return f;},getHeader:function(){return h;},getHeaderContainer:function(){return a;},getTileContainer:function(){return t;},getPage:function(){return p;},getVIZvbox:function(){return b;},getAnalyticalMap:function(){return c.analyticalMap;},getGeoMap:function(){return c.geoMap;}};},onExit:function(){this._abortPendingODataCalls();this._detachHashChangeListener();},create_vizDataset:function(c,C){var d=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/data"}});var s=this._getStacking(C);var V=this.SELECTED_VIEW;var o=c.getChartType();C.forEach(function(a){var b=V.findColumnByName(a);if(b.isDimension()){var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[b.getName()],value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[b.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[b.getName()],true)}});D.column_name=b.getName();d.addDimension(D);}},this);if(o.isLine()||o.isCombination()||o.isBubble()||o.isBar()||o.isColumn()){C.forEach(function(a){var b=V.findColumnByName(a);if(b.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[b.getName()],value:{path:b.getName()}});m.column_name=b.getName();d.addMeasure(m);}},this);}return d;},setAllVizFormatters:function(){var t=this;sap.viz.api.env.Format.useDefaultFormatter(false);jQuery.sap.require("sap.ui.core.format.NumberFormat");var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var e=this.EVALUATION.getEntitySet();var d=this.getUIComponents().getChart().getModel().getData().data;var v=this.chart;var c=(this.SELECTED_VIEW.getChartConfiguration())[0];var C=c.getChartType();var i=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());if((this.EVALUATION.getScaling()==-2)&&(c.isDualAxis())&&(c.isAbsoluteValue())&&(C.isBar()||C.isColumn())){var a=this._getMeasuresByAxis();var b=this._isMeasureSetPercentScaled(a.axis1Msr);var f=this._isMeasureSetPercentScaled(a.axis2Msr);}function _(h,u,e,j,v,k){var n=t.getLibFormatter(h,k,0);return n.format(Number(h));}var g={locale:function(){},format:function(h,p){var j=false;if(p=="yValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((t.EVALUATION.getScaling()==-2)&&i&&(c.isDualAxis())&&(C.isBar()||C.isColumn())){if(b){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(h));}else if(p=="y2ValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((t.EVALUATION.getScaling()==-2)&&i&&(c.isDualAxis())&&(C.isBar()||C.isColumn())){if(f){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(h));}else if(p=="dataLabelFormatter"){var n=t.getLibFormatter(h,j,0);if((t.EVALUATION.getScaling()==-2)&&i&&!((c.isPercentageValue()||c.isDualAxis())&&(C.isBar()||C.isColumn()))){n=t.getLibFormatter(h,j,-2);}return n.format(Number(h));}else if(p=="dataLabelPercentFormatter"){var n=t.getLibFormatter(h,j,-2);return n.format(Number(h));}else if(p=="vizPopOver"){if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){var n=t.getLibFormatter(h,j,-2);return n.format(Number(h));}else if((t.EVALUATION.getScaling()==-2)&&i&&!((c.isPercentageValue()||c.isDualAxis())&&(C.isBar()||C.isColumn()))){var n=t.getLibFormatter(h,j,-2);return n.format(Number(h));}return _(h,u,e,d,v,j);}else if(p=="vizPercentPopOver"){var n=t.getLibFormatter(h,j,-2);return n.format(Number(h));}else{return h;}}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(g);},_handleVizDualAxisWhenPercentScale:function(c){var t=this;var p=c.getVizProperties();var f={};var a={};var b=this._getMeasuresByAxis();var d=this._isMeasureSetPercentScaled(b.axis1Msr);var e=this._isMeasureSetPercentScaled(b.axis2Msr);if(d){for(var i=0;i<b.axis1Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="dataLabelPercentFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis1Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="dataLabelFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="vizPopOver";}}if(e){for(var i=0;i<b.axis2Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="dataLabelPercentFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis2Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="dataLabelFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="vizPopOver";}}p.plotArea.dataLabel={visible:true,formatString:f};c.setVizProperties(p);this.vizChartPopover.setFormatString(a);},_appendUOMToVizChartAxis:function(d){var c,m,v,U,u,a,b,e,f;var g=function(o){var k=[];for(var n in o){k.push(o[n]);}return k.join(" & ");};var h=function(A){return{visible:true,text:A};};c=this.getUIComponents().getChart();if(!c){return;}m=this.SELECTED_VIEW.getMeasures();v=c.getVizProperties()||{};U={};u=false;if(m.length==1&&m[0]==this.EVALUATION.getKpiMeasureName()){var M=m[0];a=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(a){b=d[a];if(b){U[M]=b;u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{m.forEach(function(M){a=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(a){b=d[a];if(b){U[M]=this.COLUMN_LABEL_MAPPING[M]+" ("+b+")";u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}},this);}e=this.SELECTED_VIEW.getChartConfiguration()[0];f=e.getChartType();if(u){if(!(v.valueAxis)){v.valueAxis={};}if(f.isColumn()||f.isBar()){if(e.isSingleAxis()){v.valueAxis.title=h(g(U));}else{var x={},j={};m.forEach(function(M){var o=this.SELECTED_VIEW.findMeasureByName(M);if(o.getAxis()==1){x[M]=U[M];}else if(o.getAxis()==2){j[M]=U[M];}},this);v.valueAxis.title=h(g(x));if(!(v.valueAxis2)){v.valueAxis2={};}v.valueAxis2.title=h(g(j));}}else if(f.isBubble()){var l=[];for(var i=0;i<2;i++){l[i]=U[(m[i])];}v.valueAxis.title=h(l[0]);if(!(v.valueAxis2)){v.valueAxis2={};}v.valueAxis2.title=h(l[1]);}else if(f.isTable()){}else{v.valueAxis.title=h(g(U));}c.setVizProperties(v);}},onVizViewChange:function(e){this._resetConfigurations();var s=e.getParameters().selectedItem.getProperty("key");var A=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();A["viewId"]=[s];sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(A);},getVizTypeAndIcon:function(c,v){var t="bar";var i="sap-icon://bar-chart";var T=c.getChartType();if(T.isBar()){i="sap-icon://horizontal-bar-chart";if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else{t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else{t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.isColumn()){t="column";i="sap-icon://vertical-bar-chart";if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else{t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else{t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.isLine()){t="line";i="sap-icon://line-chart";}else if(T.isCombination()){t="combination";i="sap-icon://business-objects-experience";}else if(T.isBubble()){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},_fillVizChartPopoverContent:function(c,I){var t=this;var v=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());this.POPOVER_VIEW_NAVIGATION_MODEL.setData({VIEW_NAVIGATION:v});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:[]});var p=[];for(var i=0;i<this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i].TITLE,press:jQuery.proxy(t._onVizViewSelection,t,{customData:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i],publishContext:true,isTable:!!I})});}c.setActionItems(p);t._fetchNavigationLinks().done(function(){var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");t.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF=N.getLinksByContext({semanticObject:t.SEMANTIC_OBJECT,dimensions:t.SELECTED_VIEW.getDimensions(),context:t,viewId:t.EVALUATION.getId()+"_"+t.SELECTED_VIEW.getId()}).done(function(l){var O=jQuery.extend({},t._OPEN_IN_LINKS);var u=t._getUniqueNavLinks(l,O);if(u.length){t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:u});}if(u.length){p.pop();for(var i=0;i<t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length;i++){p.push({type:'action',text:(t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i].text,press:jQuery.proxy(t._onVizAppSelection,t,{customData:(t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i],publishContext:true,isTable:!!I}),});}c.setActionItems(p);}});});},_addVizPopoverContent:function(c,I){var t=this;var a=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());var p=[];for(var i=0;i<this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i].TITLE,press:jQuery.proxy(t._onVizViewSelection,t,{customData:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i],publishContext:true,isTable:!!I})});}if(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length){for(var i=0;i<this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i].text,press:jQuery.proxy(t._onVizAppSelection,t,{customData:(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i],publishContext:true,isTable:!!I}),});}}c.setActionItems(p);},_onVizViewSelection:function(c,e){var v=c.customData.ID;var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var d=this.SELECTED_VIEW.getDimensions();var a=this[c.isTable?"_getTableContextParameters":"_getVizChartContextParameters"](d,false);for(var b in a){if(p[b]){delete p[b];}p[b]=a[b]}p["viewId"]=v;sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(p,false);if(c.isTable){this.getUIComponents().getTable().setSelectedContext(null);}else{this.setChartSelectionContextObject(null);}sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateHash();},_getVizChartContextParameters:function(d){var t=this;var e,c;e={};var a=this.DIMENSION_TEXT_PROPERTY_MAPPING;var x=[];d.forEach(function(g){y={};y.dimId=g;y.dimText=a[g];x.push(y);});if(this.chart){c=this.chart.vizSelection();var b=this.chart.getModel().getData().data;if(c&&c.length){for(var i=0;i<c.length;i++){var f=c[i];x.forEach(function(g){if(g.dimText){var h=[];var s=b[(f.data._context_row_number)][g.dimText];for(var j=0;j<b.length;j++){if(b[j][g.dimText]===s){h.push(b[j][g.dimId]);}}for(var j=0;j<h.length;j++){if(h[j]==null){k="SAP_SMARTBUSINESS_NULL";}if(h[j]||h[j]==0||h[j]==''){if(h[j].getTime){h[j]=h[j].getTime();}if(e[g.dimId]){e[g.dimId].push(h[j]);}else{e[g.dimId]=[];e[g.dimId].push(h[j]);}}}}else{var k=b[(f.data._context_row_number)][g.dimId];if(k==null){k="SAP_SMARTBUSINESS_NULL";}if(k||k==0||k==''){if(k.getTime){k=k.getTime();}if(e[g.dimId]){e[g.dimId].push(k);}else{e[g.dimId]=[];e[g.dimId].push(k);}}}});}}}return e;},_onVizAppSelection:function(c,e){var a=function(i,m){if(m){for(var p in m){if(i&&i[p]){delete i[p];}}}};var b,n=c.customData.id;var d=c.customData.value;var s=n.split("~")[0];var f=s.split("-");var g=f[0];var h=f[1];var i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(g=="AdhocAnalysis"){i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();}var j=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();var k={};var l=this.SELECTED_VIEW.getDimensions();if(c.isFromOpenIn){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);b=this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{if(c.isTable){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{b=this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}}jQuery.extend(true,k,j,i);if(sap.ushell.Container&&sap.ushell.Container.getService){var C=sap.ushell.Container.getService("CrossApplicationNavigation");if(C){var t=C.hrefForExternal({target:{semanticObject:g,action:h},params:k});if(d=="SAPUI5"){this._detachHashChangeListener();}window.location.hash=t;}else{jQuery.sap.log.error("ushell CrossApplicationNavigation service returns null");}}else{jQuery.sap.log.error("ushell Services not running");}},_onVizChartDataPointSelection:function(c,e){if(!(c.chartPopover.getActionItems()&&c.chartPopover.getActionItems().length)){this._fillVizChartPopoverContent(c.chartPopover,false);}},_addFeedsToVizFrame:function(v,c,C){var t=this;var s=this._getStacking(C);var V=this.SELECTED_VIEW;var o=c.getChartType();var d=[],m=[];for(var i=0;i<V.getDimensions().length;i++){d.push(t.COLUMN_LABEL_MAPPING[((V.getDimensions())[i])]);}for(var i=0;i<V.getMeasures().length;i++){m.push(t.COLUMN_LABEL_MAPPING[((V.getMeasures())[i])]);}if(o.isBubble()){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),a=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),b=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:d});v.addFeed(f);v.addFeed(a);v.addFeed(b);v.addFeed(e);}else if((o.isBar()||o.isColumn())&&(c.isDualAxis())){var g=this._getMeasuresByAxis();var h=[],j=[];for(var i=0;i<g.axis1Msr.length;i++){h.push(t.COLUMN_LABEL_MAPPING[g.axis1Msr[i]]||g.axis1Msr[i]);}for(var i=0;i<g.axis2Msr.length;i++){j.push(t.COLUMN_LABEL_MAPPING[g.axis2Msr[i]]||g.axis2Msr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:h});var k=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:j});var l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(k);v.addFeed(l);}else if((o.isBar()||o.isColumn())&&s.dimensionStacked&&s.stackedDimensionName&&(V.getDimensionCount()>1)){var n=d.indexOf(t.COLUMN_LABEL_MAPPING[(s.stackedDimensionName)]);if(n>-1){var D=d.splice(n,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(l);if(D&&D.length){var e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(e);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(l);}},applyColorToVizChart:function(c,a){var C=this;this.oI18nModel=C.getView().getModel("i18n");var o=a.getChartType();var t=a.getThresholdMeasure();var b=a.getColorScheme();if(!b.getText()){jQuery.sap.log.error("Color Scheme Value Missing");return;}var m=c.getDataset().getMeasures();var v=c.getVizProperties();v.plotArea.dataPointStyle={};c.setVizProperties(v);if((o.isBar()||o.isColumn())&&(a.isDualAxis())){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];}else{v.plotArea.colorPalette=[];}if(b.isManual()){m.forEach(function(M,i,d){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getColor();var e=this.SELECTED_VIEW.findMeasureByName(M.column_name).getAxis();if(!_){if(b.isManualSemantic()){jQuery.sap.log.warning("Semantic Color NOT found for measure name : "+M.getName()+", assigning default to 'Neutral Light'");_="sapUiChartPaletteSemanticNeutralLight1";}else{jQuery.sap.log.warning("Color NOT found for measure name : "+M.getName()+", assigning default color");_="";}}var f=(C.convertCAtoVizColorCode(_))||("sapUiChartPaletteQualitativeHue"+((i%11)+1));if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(e==1){(v.plotArea.primaryValuesColorPalette).push(f);}else if(e==2){(v.plotArea.secondaryValuesColorPalette).push(f);}}else{(v.plotArea.colorPalette).push(f);}},this);c.setVizProperties(v);}else if(b.isAutoSemantic()&&!this.EVALUATION.isTargetKpi()){if(t){m.forEach(function(M,i,d){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getAxis();if(M.getName()==t){if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(_==1){(v.plotArea.primaryValuesColorPalette).push("sapUiChartPaletteSemanticNeutral");}else if(_==2){(v.plotArea.secondaryValuesColorPalette).push("sapUiChartPaletteSemanticNeutral");}}else{(v.plotArea.colorPalette).push("sapUiChartPaletteSemanticNeutral");}}else{if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(_==1){(v.plotArea.primaryValuesColorPalette).push("sapUiChartPaletteSemanticGood");}else if(_==2){(v.plotArea.secondaryValuesColorPalette).push("sapUiChartPaletteSemanticGood");}}else{(v.plotArea.colorPalette).push("sapUiChartPaletteSemanticGood");}}},this);v.plotArea.dataPointStyle={rules:[{callback:function(d){var e=c.getModel().getData().data;var f=d._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(d[d.measureNames]>r){if(C.EVALUATION.isMaximizingKpi())return true;}else if(d[d.measureNames]<r){if(C.EVALUATION.isMinimizingKpi())return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(C.oI18nModel.getResourceBundle().getText("GOOD"))},{callback:function(d){var e=c.getModel().getData().data;var f=d._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(d[d.measureNames]>r){if(C.EVALUATION.isMinimizingKpi())return true;}else if(d[d.measureNames]<r){if(C.EVALUATION.isMaximizingKpi())return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(C.oI18nModel.getResourceBundle().getText("BAD"))},{callback:function(d){var e=c.getModel().getData().data;var f=d._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(C.oI18nModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(C.oI18nModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Chart Color Scheme is Auto-Semantic but no threshold measure Configured!!!");}}else{jQuery.sap.log.debug("Color Scheme is None: Default Color will be used by viz Chart");}if(b.isAutoSemantic()){if(this.EVALUATION.isTargetKpi()){jQuery.sap.log.error("Auto Semantic Coloring can not be applied on target type KPI");}}},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},_fixPostResizeIssue:function(){this.setChartSelectionContextObject(null);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.view.miniChart.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.drilldown.view.miniChart.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.drilldown.view.miniChart",{_getEvaluationId:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;return s["evaluationId"][0];}catch(e){return sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters().evaluationId[0];}},_detachHashChangeListener:function(){try{this._proxyHashChangeListener=null;this.hashChangerAttached=true;}catch(e){jQuery.sap.log.error("Error Detaching hashChanged Event");}},onInit:function(){var t=this;var o={onBack:function(){window.history.back();},additionalShareButtonList:[],sFullscreenTitle:"",};this.setHeaderFooterOptions(o);this.getPage().getCustomHeader().getContentMiddle()[0].setText("");this.SAP_SYSTEM="HANA";this._requestTimeLog={};var E=this._getEvaluationId();var a=E;this._EVALUATION_ID=E;var s=new Date().getTime();var c=function(d){this.DDA_CONFIG_ODATA_CALL_REF=d;};sap.suite.ui.smartbusiness.drilldown.lib.Configuration.loadConfiguration({evaluationId:a,cache:true,success:function(b){var e=new Date().getTime();this._requestTimeLog["DDA_CONFIG_FETCH"]={title:"Configuration",time:e-s};this.CONFIGURATION=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.parse(a,b);t.displayMiniCharts();if(this.CONFIGURATION.getAllViews().length==0){jQuery.sap.log.error("drilldown not configured");return;}var d=new Date().getTime();},error:function(){jQuery.sap.log.error("Drilldown Configuration Fetching Failed");},context:this,sapSystem:this.SAP_SYSTEM},c);},getUrlFilters:function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O);});}}return u;},renderKpiHeaders:function(h){var s=this;var m=this.byId("mobileGrid");m.removeAllContent();this.miniChartManager=sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager.renderHeaders({allTiles:h,headerContainer:m,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters(),onNavigation:function(){s._detachHashChangeListener();}});},displayMiniCharts:function(){var h=this.CONFIGURATION.getHeaders();if(!(h&&h.length)){}else{this.renderKpiHeaders(h);}$(window).trigger('resize');},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.AppSetting')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting=(function(){var c,h,a,b;var p={container:"sap.suite.ui.smartbusiness",item:"idVisibility"};var P=sap.ushell.Container.getService("Personalization").getPersonalizer(p);var d=new sap.m.CheckBox({selected:true,layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10",vAlign:"Middle"}),});var C=new sap.m.Bar({width:"100%",contentMiddle:[new sap.m.Label({text:"{i18n>TABLE_POPOVER_HEADING}"})],contentRight:[new sap.m.Button({icon:"sap-icon://decline",width:"100%",press:function(){i.close();}})]});var i=new sap.m.ResponsivePopover({title:"Working with IDs",showHeader:true,customHeader:C,contentWidth:"20%",contentHeight:"25%",verticalScrolling:true,showCloseButton:true,horizontalScrolling:false,placement:sap.m.PlacementType.Right,content:[new sap.m.Text({width:"100%",textAlign:"Center",text:"\n\nIDs are used purely for identifying entities in the backend of Smart Business framework apps.\n\n While creating, although you may edit the IDs with your unique id, but they wont be extendable.\n\n Within each App you would individually need to enable this feature to work with IDs."})]});var e=new sap.m.Button({icon:"sap-icon://message-information",type:sap.m.ButtonType.Transparent,layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2",vAlign:"Middle"}),press:function(){i.openBy(this);}});var s=function(v){sap.ui.getCore().getModel("SB_APP_SETTING").getData().ID_VISIBLE=v;sap.ui.getCore().getModel("SB_APP_SETTING").updateBindings();};var f=function(){if(d.getSelected()==true){s(true);P.setPersData({"SHOW_ID":true});}else{s(false);P.setPersData({"SHOW_ID":false});}};var g=function(){P.getPersData().done(function(n){d.setSelected(n&&n.SHOW_ID);});};var j=function(){if(d.getSelected()==true){s(true);P.setPersData({"SHOW_ID":true});}else{s(false);a(b);P.setPersData({"SHOW_ID":false});}};var k=new sap.m.Button({press:function(){(h=="list")?f():(h=="input")?j():"";m.close();}});var l=new sap.m.Button({press:function(){g();m.close();}});var m=new sap.m.Dialog({width:"100%",content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[d,e]}),buttons:[k,l]});var B=new sap.m.Button({press:function(){m.open();}});return{init:function(o){m.setTitle(o.title);c=o.oControl;if(o.action&&o.controllerReference){a=o.action;b=o.controllerReference}i.getContent()[0].setText(o.i18n.settingInfoText);i.getTitle(o.i18n.settingInfoTitle);h=o.hideElement;d.setText(o.i18n.checkBoxText);k.setText(o.i18n.saveText);l.setText(o.i18n.cancelText);B.setText(o.i18n.settingsText);P.getPersData().done(function(n){if(n){d.setSelected(n.SHOW_ID);s(n.SHOW_ID);}else{d.setSelected(true);s(true);}});sap.ushell.services.AppConfiguration.addApplicationSettingsButtons([B]);},setVisibility:function(){P.getPersData().done(function(n){if(n){s(n.SHOW_ID);}else{s(true);}});},}})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.CatalogServices')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.CatalogServices");sap.suite.ui.smartbusiness.lib.CatalogServices=function(){this.savePersonalizedTile=function(p){};};sap.suite.ui.smartbusiness.lib.CatalogServices.hasAdapter=true;};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownConfiguration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownConfiguration");sap.suite.ui.smartbusiness.lib.DrilldownConfiguration=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration||{};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header=function(h){this.oHeader=h;};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE;},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID;},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID;},getEvaluationId:function(){return this.oHeader.EVALUATION_ID;},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER;},isVisible:function(){return this.oHeader.VISIBILITY==1;},getEvaluation:function(){var t=this;var D=this.oHeader.REFERENCE_EVALUATION_INFO;return{getTitle:function(){if(D&&D.TITLE){return D.TITLE;}else{return"";}},getSubtitle:function(){if(D&&D.INDICATOR_TITLE){return D.INDICATOR_TITLE;}else{return"";}}};},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true;}}return false;},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION";},getDimension:function(){return this.oHeader.DIMENSION;},getMeasure:function(){return this.oHeader.MEASURE;},getVisibility:function(){return this.oHeader.VISIBILITY;},getConfiguration:function(){var d=[{name:"",color:"Good"},{name:"",color:"Critical"},{name:"",color:"Error"}];var a={order:"desc",by:"M",};var b=[{NAME:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];var c={MEASURES:d,SORTING:a,DIMENSION_COLOR:"Neutral",HARVEY_FILTERS:b,HARVEY_MEASURE:"",IS_HARVEY_FRACTION_KPIMEASURE:true};if(this.oHeader.CONFIGURATION){try{c=JSON.parse(this.oHeader.CONFIGURATION);c.MEASURES=c.MEASURES?JSON.parse(c.MEASURES):d;c.SORTING=c.SORTING?JSON.parse(c.SORTING):a;c.HARVEY_FILTERS=c.HARVEY_FILTERS?JSON.parse(c.HARVEY_FILTERS):b;c.HARVEY_MEASURE=c.HARVEY_MEASURE||"";c.IS_HARVEY_FRACTION_KPIMEASURE=(c.IS_HARVEY_FRACTION_KPIMEASURE===false)?false:true}catch(e){};}return c;}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart=function(c){this.oChart=c;};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart.prototype={getValueType:function(){return this.oChart.VALUE_TYPE;},getAxisType:function(){return this.oChart.AXIS_TYPE;},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE;},getChartType:function(){var _=this;return{isBar:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BAR";},isColumn:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COLUMN";},isLine:function(){return _.oChart.CHART_TYPE.toUpperCase()=="LINE";},isCombinationChart:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COMBINATION";},isTable:function(){return _.oChart.CHART_TYPE.toUpperCase()=="TABLE";},isBubble:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BUBBLE";},getText:function(){return _.oChart.CHART_TYPE;}};},getColorScheme:function(){var t=this;return{getText:function(){return t.oChart.COLOR_SCHEME;},isManual:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualSemantic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualNonSematic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC";},isAutoSemantic:function(){return t.oChart.COLOR_SCHEME=='AUTO_SEMANTIC';}};},getDataLimit:function(){return this.oChart.DATA_LIMIT;},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE";},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE";},isSingleAxis:function(){return this.getAxisType()=="SINGLE";},isDualAxis:function(){return this.getAxisType()=="DUAL";},isStackingEnabled:function(){return false;}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column=function(){};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column.prototype={getName:function(){return this.oParam.NAME;},getSortBy:function(){return this.oParam.SORT_BY;},getColumnOrder:function(){return this.oParam.COLUMNS_ORDER;},getSortOrder:function(){return this.oParam.SORT_ORDER;},getType:function(){return this.oParam.TYPE;},getVisibility:function(){return this.oParam.VISIBILITY;},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART";},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE";},getColor:function(){return this.oParam.COLOR;},isStacked:function(){return this.oParam.STACKING==1;},getStacking:function(){return this.oParam.STACKING;},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION";},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE";},getAxis:function(){return this.oParam.AXIS;}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension=function(p){this.oParam=p;};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension.prototype=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column();sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure=function(p){this.oParam=p;};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure.prototype=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column();sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter=function(p){this.oFilter=p;};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter.prototype={getName:function(){return this.oFilter.DIMENSION;},isVisible:function(){return this.oFilter.VISIBILITY==1;}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._filters=[];this._dimensionMap={};this._measureMap={};this._filterMap={};this._headers=[],this._chartConfig=[];this._additionalLanguageTitles=[];};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype={getTitle:function(){return this._title;},getId:function(){return this._viewId;},getEvaluationId:function(){return this._evaluationId;},getViewOrder:function(){return this._order;},getFilters:function(){return this._filters;},getColumns:function(){return this._columns;},getDimensions:function(){return this._dimensions;},getMeasures:function(){return this._measures;},findDimensionByName:function(d){if(this._dimensionMap[d]){return this._dimensionMap[d];}else{throw new Error("Invalid Dimension Name : "+d);}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m];}else{throw new Error("Invalid Dimension Name : "+m);}},findColumnByName:function(c){if(this._dimensionMap[c]){return this._dimensionMap[c];}else if(this._measureMap[c]){return this._measureMap[c];}else{throw new Error("Invalid Column Name : "+c);}},getHeaders:function(){return this._headers;},getChartConfiguration:function(){return this._chartConfig;},getAdditionalLanguageTitles:function(){return this._additionalLanguageTitles;}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setDimensionAndMeasures=function(c,t){c.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure(v);this._measures.push(v.NAME);}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension(v);this._dimensions.push(v.NAME);}}},t);};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setFilters=function(f,t){f.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter(v);},t);};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setConfig=function(c,t){var S=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration.Constants;for(var e in S){var f=S[e].func;if(jQuery.sap.startsWith(f,"is")){sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return true;};}else{sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return null;};}}c.forEach(function(v,i,a){var b=S[v.PROPERTY_TYPE];if(b){var f=b.func;if(jQuery.sap.startsWith(f,"is")){sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return v.VISIBILITY==1;};}else{sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return v.PROPERTY_VALUE;};}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE);}},t);};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setHeader=function(h,t){if(h.length){h.forEach(function(v,i,a){this.getHeaders().push(new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header(v));},t);t.getHeaders().sort(function(o,a){if(o.VISUALIZATION_ORDER>a.VISUALIZTION_ORDER){return 1;}return-1;});}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setChart=function(c,t){if(c.length){c.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart(v));}},t);}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setAdditionalLanguageTitles=function(m,t){if(m.length){m.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getAdditionalLanguageTitles().push(v);}},t);}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration=function(e,M){this.evaluationId=e;var d=null;this.MODE=!!M;var b={};var _=true;var c=jQuery.sap.getUriParameters().get("debug_ddaconfig")=="true";var f=-1;var g=function(m,C,H,F,o,k,l){m.forEach(function(v,i,a){var n=v.CONFIGURATION_ID;if(n){f++;var O=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View(v);b[n]=O;if(f==0){d=n;}sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setConfig(C,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setDimensionAndMeasures(o,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setFilters(F,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setHeader(H,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setChart(k,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setAdditionalLanguageTitles(l,O);_=false;}});};this.getMaxViewOrder=function(){var m=0;for(var v in b){m=Math.max(m,b[v].getViewOrder());}return m;};this.hasNoConfiguration=function(){return _;};this.findViewById=function(i){if(b[i]){return b[i];}return null;},this.getDefaultViewId=function(){return d;},this.getDefaultView=function(){if(d){return b[d];}return null;};this.removeViewById=function(v){delete b[v];};this.removeAllViews=function(v){b={};};this.getAllViews=function(){var v=[];for(var a in b){var t={};t["ID"]=a;t["TITLE"]=b[a].getTitle()||"-NA- ("+a+")";v.push(t);}return v;};this.getTree=function(){var t={name:"Evaluation",children:[]};var a=this.getAllViews();for(var i in a){var k={name:a[i].TITLE||"NA",children:[]};var v=this.findViewById(a[i].ID);var m=v.getMeasures();var l={name:"measures",children:[]};k.children.push(l);m.forEach(function(r,s,u){l.children.push({name:r,children:[]});},this);var n=v.getDimensions();var o={name:"dimensions",children:[]};k.children.push(o);n.forEach(function(r,s,u){o.children.push({name:r,children:[]});},this);var p=v.getHeaders();var q={name:"header",children:[]};k.children.push(q);p.forEach(function(i){var r={name:"1",children:[]};q.children.push(r);r.children.push({name:"Visualization Type = "+i.getVisualizationType(),children:[]});r.children.push({name:"Reference Evaluation = "+i.getReferenceEvaluationId(),children:[]});});t.children.push(k);}return t;};var h=function(u){return jQuery.sap.encodeURL(u);};var j=function(){var t=this;var D=null;var s="/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";if(sap.suite.ui.smartbusiness.lib.Util.odata){D=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{D=new sap.ui.model.odata.ODataModel(s,true);}var m="/DDA_MASTER?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=CONFIG_ORDER";var a="/DDA_CONFIG?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var i="/DDA_HEADER?$expand=REFERENCE_EVALUATION_INFO&$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var k="/DDA_FILTERS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var l="/DDA_COLUMNS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=COLUMNS_ORDER";var n="/DDA_CHART?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var o="/DDA_MASTER_TEXT?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var r=D.createBatchOperation(m,"GET");var p=D.createBatchOperation(a,"GET");var q=D.createBatchOperation(i,"GET");var u=D.createBatchOperation(k,"GET");var v=D.createBatchOperation(l,"GET");var w=D.createBatchOperation(n,"GET");var x=D.createBatchOperation(o,"GET");D.addBatchReadOperations([r,p,q,u,v,w,x]);D.submitBatch(function(y,z){var A=y.__batchResponses;if(c){jQuery.sap.log.info("DDA-MASTER : ",JSON.stringify(A[0]));jQuery.sap.log.info("DDA-CONFIG : ",JSON.stringify(A[1]));jQuery.sap.log.info("DDA-HEADER : ",JSON.stringify(A[2]));jQuery.sap.log.info("DDA-FILTERS : ",JSON.stringify(A[3]));jQuery.sap.log.info("DDA-COLUMNS : ",JSON.stringify(A[4]));jQuery.sap.log.info("DDA-CHART : ",JSON.stringify(A[5]));jQuery.sap.log.info("DDA-MASTER-TEXT : ",JSON.stringify(A[6]));}sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData={};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER=A[0].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.CONFIG=A[1].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER=A[2].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.FILTERS=A[3].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.COLUMNS=A[4].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.CHART=A[5].data.results;g.call(t,A[0].data.results,A[1].data.results,A[2].data.results,A[3].data.results,A[4].data.results,A[5].data.results,A[6].data.results);},function(y){throw new Error("Failed to fetch DDA Configuration");},false);};j.call(this);};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.writeservices=(function(){var _=null;return{getInstance:function(f){jQuery.sap.require("sap.suite.ui.smartbusiness.lib.DrilldownWriteService");if(_&&!f){return _;}else{_=new sap.suite.ui.smartbusiness.lib.DrilldownWriteService();}return _;}}})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownSaveService')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownSaveService");sap.suite.ui.smartbusiness.lib.DrilldownSaveService={fetchXSRFToken:function(S,e){jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters("/sap/hba/r/sb/core/logic/__token.xsjs"),headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){if(S)S(d,s,x);},error:function(){if(e)e(d,s,x);}});},constants:{"write":{fn:"getWritePayload"},"delete":{fn:"getDeletePayload"},"update":{fn:"getUpdatePayload"},"viewServiceUrl":"/sap/hba/r/sb/core/logic/ddaViewConfiguration_cud.xsjs","evalServiceUrl":"/sap/hba/r/sb/core/logic/ddaEvaluation_cud.xsjs"},doUpdate:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"PUT",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doWrite:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"POST",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doDelete:function(c){var t=this;this.fetchXSRFToken(function(d,s,x){jQuery.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c.url),type:"DELETE",headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},data:JSON.stringify(c.payload)}).done(c.success||function(){}).fail(c.error||function(){});},c.error);},doServiceCall:function(c){var t=this;if(c.type=="POST"){this.doWrite(c);}else if(c.type=="PUT"){this.doUpdate(c);}else if(c.type="DELETE"){this.doDelete(c);}},saveEvalConfiguration:function(e,d,a,s,E){var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d),url:this.constants.evalServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},saveViewConfiguration:function(e,d,a,s,E){a=d.ID_EDITABLE?"write":a;var t=(a=="delete"?"DELETE":(a=="update"?"PUT":"POST"));if(this.constants[a]){this.doServiceCall({type:t,payload:this[this.constants[a].fn](e,d,true),url:this.constants.viewServiceUrl,success:s,error:E});}else{E("Service Failed. Unrecognized action "+a);}},getUpdatePayload:function(e,d,i){return{payload:this.getWritePayload(e,d,i),keys:this.getDeletePayload(e,d,i)};},getWritePayload:function(e,d,i){var c=d.SELECTED_VIEW,r;if(i){r={DDA_COLUMNS:this.getColumnsPayload(d,e,c),DDA_CHART:this.getChartPayload(d,e,c),DDA_MASTER_TEXT:this.getViewTextPayload(d,e,c)};if(d.ID_EDITABLE){r.DDA_MASTER=this.getNewViewPayload(d.ALL_VIEWS,e,c);}}else{r={DDA_FILTERS:this.getFilterPayload(d.CURRENT_FILTERS,e,c),DDA_HEADER:this.getHeaderPayload(d.HEADERS_VISIBLE,e,c),DDA_CONFIGURATION:this.getConfigurationPayload(d,e,c)};var v=this.getViewOrderPayload(d.ALL_VIEWS,e,c);if(v.length){r.DDA_MASTER=v;}}return r;},getDeletePayload:function(e,d,i){return{"EVALUATION_ID":e,"CONFIGURATION_ID":d.ID};},getViewTextPayload:function(d,e,c){var v=[];var a=d.CURRENT_LANGUAGE,b=d.TITLE;d=d.ADDITIONAL_LANGUAGE_TITLES||[];for(var i=0;i<d.length;i++){if(d[i].SAP_LANGUAGE_KEY==a)continue;v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":d[i].SAP_LANGUAGE_KEY,"TEXT":d[i].TEXT,"IS_ACTIVE":1});}v.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"SAP_LANGUAGE_KEY":a,"TEXT":b,"IS_ACTIVE":1});return v;},getChartPayload:function(d,e,c){return[{"EVALUATION_ID":e,"CONFIGURATION_ID":c,"VALUE_TYPE":d.VALUE_TYPE,"AXIS_TYPE":d.AXIS_TYPE,"CHART_TYPE":d.CHART_TYPE,"DATA_LIMIT":d.DATA_LIMITATIONS?d.DATA_LIMIT:-1,"COLOR_SCHEME":d.COLOR_SCHEME,"IS_ACTIVE":1,"THRESHOLD_MEASURE":d.THRESHOLD_MEASURE}];},getColumnsPayload:function(d,e,c){var a=[];var b=d.COLOR_SCHEME;d=d.items||[];for(var i=0;i<d.length;i++){if(d[i].SELECTED)a.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"NAME":d[i].NAME,"TYPE":d[i].TYPE.toUpperCase(),"SORT_BY":d[i].SORT_BY,"VISIBILITY":d[i].VISIBILITY,"COLOR":(b=="MANUAL_NON_SEMANTIC"?d[i].COLOR1:b=="MANUAL_SEMANTIC"?d[i].COLOR2:"")||"","STACKING":d[i].STACKING,"AXIS":d[i].AXIS,"SORT_ORDER":d[i].SORT_ORDER,"COLUMNS_ORDER":i,"IS_ACTIVE":1});}return a;},getFilterPayload:function(d,e,c){var f=[];d=d||[];for(var i=0;i<d.length;i++){f.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"DIMENSION":d[i],"VISIBILITY":1,"IS_ACTIVE":1});}return f;},_getHeaderConfiguration:function(h){var d;switch(h.VISUALIZATION_TYPE){case"CM":d=[{name:h.MEASURE1,color:h.COLOR1},{name:h.MEASURE2,color:h.COLOR2}];(h.MEASURE3&&h.MEASURE3!="_none^")?d.push({name:h.MEASURE3,color:h.COLOR3}):"";d=JSON.stringify({MEASURES:JSON.stringify(d)});break;case"CT":d={order:h.SORT_ORDER[1]=="D"?"desc":"asc",by:h.SORT_ORDER[0],dimension_color:h.DIMENSION_COLOR};d=JSON.stringify({SORTING:JSON.stringify(d)});break;}return d;},getHeaderPayload:function(d,e,c){var h=[];d=d||[];for(var i=0;i<d.length;i++){if(d[i])h.push({"CONFIGURATION_ID":c,"EVALUATION_ID":e,"VISUALIZATION_TYPE":d[i].VISUALIZATION_TYPE,"VISIBILITY":1,"REFERENCE_EVALUATION_ID":d[i].REFERENCE_EVALUATION_ID,"VISUALIZATION_ORDER":i,"DIMENSION":d[i].DIMENSION,"IS_ACTIVE":1,"CONFIGURATION":this._getHeaderConfiguration(d[i])});}return h;},getConfigurationPayload:function(d,e,c){var a={"SAP_FILTER":{value:"",visibility:1},"SAP_AGGREGATE_VALUE":{value:"",visibility:(d.CONFIG.SAP_AGGREGATE_VALUE?1:0)},"SAP_HEADER":{value:"",visibility:1},"QUERY_SERVICE_URI":{value:d.QUERY_SERVICE_URI,visibility:1},"QUERY_ENTITY_SET":{value:d.QUERY_ENTITY_SET,visibility:1},};var b=[];for(var f in a){b.push({"EVALUATION_ID":e,"CONFIGURATION_ID":c,"PROPERTY_TYPE":f,"PROPERTY_VALUE":a[f].value,"VISIBILITY":a[f].visibility,"IS_ACTIVE":1});}return b;},getNewViewPayload:function(d,e,c){return[{"CONFIGURATION_ID":c,"EVALUATION_ID":e,"CONFIG_ORDER":(d.length+1),"IS_ACTIVE":1}];},getViewOrderPayload:function(d,e,c){var a=[];d=d||[];for(var i=0;i<d.length;i++){a.push({"CONFIGURATION_ID":d[i].ID,"EVALUATION_ID":e,"CONFIG_ORDER":i,"IS_ACTIVE":1});}return a;}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownServices')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownServices");sap.suite.ui.smartbusiness.lib.DrilldownServices={saveEvalConfiguration:function(p){},saveViewConfiguration:function(p){}};sap.suite.ui.smartbusiness.lib.DrilldownServices.hasAdapter=true;};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownWriteService')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownWriteService");sap.suite.ui.smartbusiness.lib.DrilldownWriteService=function(){var d=null;var s="/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";if(sap.suite.ui.smartbusiness.lib.Util.odata){d=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{d=new sap.ui.model.odata.ODataModel(s,true);}this.getODataModel=function(){return d;};this.getEntitySet=function(){var E={CHART_CONFIGURATION:"/DDA_CHART",MASTER_CONFIGURATION:"/DDA_MASTER",COLUMNS_CONFIGURATION:"/DDA_COLUMNS",HEADER_CONFIGURATION:"/DDA_HEADER",FILTER_CONFIGURATION:"/DDA_FILTERS",DDA_CONFIGURATION:"/DDA_CONFIG",DDA_MASTER_TEXT_CONFIGURATION:"/DDA_MASTER_TEXT"};return{getChartEntity:function(){return E.CHART_CONFIGURATION;},getMasterEntity:function(){return E.MASTER_CONFIGURATION;},getColumnEntity:function(){return E.COLUMNS_CONFIGURATION;},getHeaderEntity:function(){return E.HEADER_CONFIGURATION;},getFilterEntity:function(){return E.FILTER_CONFIGURATION;},getConfigEntity:function(){return E.DDA_CONFIGURATION;},getMasterTextEntity:function(){return E.DDA_MASTER_TEXT_CONFIGURATION;}};};};sap.suite.ui.smartbusiness.lib.DrilldownWriteService.prototype={_executeBatch:function(e,p,h,c,C){var r=[];for(var i=0,l=p.length;i<l;i++){var a=p[i];if(h=="POST"){r.push(this.getODataModel().createBatchOperation(e,h,a));}else if(h=="DELETE"){r.push(this.getODataModel().createBatchOperation(a,h));}else if(h=="PUT"){r.push(this.getODataModel().createBatchOperation(e[i],h,a));}}this.getODataModel().addBatchChangeOperations(r);this.getODataModel().submitBatch(function(d,b){if(c){c.call(null,d,b);}},function(){if(C){C.apply(null,arguments);}},true);},createMasterEntry:function(p,c,C){this._executeBatch(this.getEntitySet().getMasterEntity(),p,"POST",c,C);},createConfig:function(p,c,C){this._executeBatch(this.getEntitySet().getConfigEntity(),p,"POST",c,C);},createFilters:function(p,c,C){this._executeBatch(this.getEntitySet().getFilterEntity(),p,"POST",c,C);},createHeader:function(p,c,C){this._executeBatch(this.getEntitySet().getHeaderEntity(),p,"POST",c,C);},createColumns:function(p,c,C){this._executeBatch(this.getEntitySet().getColumnEntity(),p,"POST",c,C);},createChartConfiguration:function(p,c,C){this._executeBatch(this.getEntitySet().getChartEntity(),p,"POST",c,C);},createMasterTextEntry:function(p,c,C){this._executeBatch(this.getEntitySet().getMasterTextEntity(),p,"POST",c,C);},updateMasterEntry:function(p,c,C){var e=[];for(var i=0;i<p.length;i++){e.push(this.getEntitySet().getMasterEntity()+"(EVALUATION_ID='"+p[i].EVALUATION_ID+"',CONFIGURATION_ID='"+p[i].CONFIGURATION_ID+"',IS_ACTIVE="+p[i].IS_ACTIVE+")");}this._executeBatch(e,p,"PUT",c,C);},updateConfig:function(i,p,c,C){this._executeBatch(this.getEntitySet().getConfigEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},updateFilters:function(i,p,c,C){this._executeBatch(this.getEntitySet().getFilterEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},updateHeader:function(i,p,c,C){this._executeBatch(this.getEntitySet().getHeaderEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},updateColumns:function(i,p,c,C){this._executeBatch(this.getEntitySet().getColumnEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},updateChartConfiguration:function(i,p,c,C){this._executeBatch(this.getEntitySet().getChartEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},updateMasterTextEntry:function(i,p,c,C){this._executeBatch(this.getEntitySet().getMasterTextEntity()+"("+this.formId(i)+")",p,"PUT",c,C);},deleteMasterEntry:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push(this.getEntitySet().getMasterEntity()+"(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteMasterEntry_Eval:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_DEL_EVAL_LEVEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteConfig:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_CONFIG_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteFilters:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_FILTERS_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteHeader:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_HEADER_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteColumns:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_COLUMNS_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteChartConfiguration:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push(this.getEntitySet().getChartEntity()+"(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},deleteMasterTextEntry:function(a,c,C){var e=[];for(var i=0;i<a.length;i++){e.push("DDA_MASTEXT_DEL(EVALUATION_ID='"+a[i].EVALUATION_ID+"',CONFIGURATION_ID='"+a[i].CONFIGURATION_ID+"',IS_ACTIVE="+a[i].IS_ACTIVE+")");}this._executeBatch(null,e,"DELETE",c,C);},formId:function(i){var t='';for(each in i){if(isNaN(i[each])){t=t+(each+"='"+i[each]+"',");}else{t=t+(each+"="+i[each]+",");}}return t.substring(0,t.length-1);},saveDDAConfiguration:function(p){},};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Filter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Filter");sap.ui.core.Control.extend("sap.suite.ui.smartbusiness.lib.Filter",{metadata:{properties:{evaluationId:"string",dimensions:{type:"any",defaultValue:[]},visible:{type:"boolean",defaultValue:true},advancedSetting:{type:"object",defaultValue:{}},mode:{type:"string",defaultValue:"Runtime"},suppressAction:{type:"boolean",defaultValue:false},sapSystem:{type:"string",defaultValue:null}},aggregations:{"_filter":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_popover":{type:"sap.m.Popover",multiple:false,visibility:"hidden"}},events:{filterChange:{}}},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("SmartBusinessFilter");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_filter"));r.write("</div>");}});sap.suite.ui.smartbusiness.lib.Filter.prototype.init=function(){this._filterObj={};if(sap.ushell&&sap.ushell.Container){this.urlParsingService=sap.ushell.Container.getService("URLParsing");}else{this.urlParsingService=undefined;}};sap.suite.ui.smartbusiness.lib.Filter.prototype.onBeforeRendering=function(){if(this.getEvaluationId()){try{this._updateOdataProperties();this._facetListsReference={};var c=this._getChildControl();c.setVisible(this.getVisible());this.setAggregation("_filter",c);this._initModel();if(this.getMode()=="Runtime"){this._addDimensions(this.getDimensions());}else{this._addDimensionsDesignTime(this.getDimensions());}}catch(e){jQuery.sap.log.error(e);}}};sap.suite.ui.smartbusiness.lib.Filter.prototype.onAfterRendering=function(){if(this.getMode()=="Runtime"){this.refreshFilter(true);}};sap.suite.ui.smartbusiness.lib.Filter.prototype.getFacetFilterReference=function(){return this.getAggregation("_filter");};sap.suite.ui.smartbusiness.lib.Filter.prototype.getSelectedItems=function(){var f=this.getAggregation("_filter");var l=f.getLists();var c=0;for(var i=0;i<l.length;i++){if(l[i].getSelectedItems().length>0){c++;}}if(c>0){return true;}else{return false;}};sap.suite.ui.smartbusiness.lib.Filter.prototype._updateOdataProperties=function(){if(this.urlParsingService){this._serviceUri=this.urlParsingService.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.getSapSystem());}else{this._serviceUri=this.EVALUATION.getODataUrl();}this._entitySet=this.EVALUATION.getEntitySet();};sap.suite.ui.smartbusiness.lib.Filter.prototype._getChildControl=function(){var c,t=this;function _(C,w){return new sap.m.HBox({items:C,width:w})}if(this.getMode()=="Runtime"){c=new sap.m.FacetFilter({showReset:false,showPersonalization:true,showPopoverOKButton:true,reset:jQuery.proxy(function(){t.resetFilter.call(this);},this)});}else{this._facetContainer=new sap.m.ScrollContainer({vertical:false,horizontal:true,}).addStyleClass("facetFilterContainer");c=new sap.m.HBox({justifyContent:"SpaceBetween",alignItems:"Center",items:[_([this._facetContainer]),_([new sap.m.Button({icon:"sap-icon://undo",type:"Transparent",visible:(!t.getSuppressAction()),press:function(){if(!t.getSuppressAction()){t.rerender();}}}),new sap.m.Button({icon:((!t.getSuppressAction())?"sap-icon://add-filter":"sap-icon://filter"),type:"Transparent",enabled:((!t.getSuppressAction())?true:false),press:function(){if(!t.getSuppressAction()){t._popover.openBy(this);}}})])]});}return c;};sap.suite.ui.smartbusiness.lib.Filter.prototype.resetFilter=function(){this._filterObj=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var v=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters().viewId[0];var n={viewId:[v]};var t=this;var d=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(this._serviceUri,this._entitySet);d.forEach(function(s){delete t._filterObj[s];});for(var e in this._filterObj){n[e]=this._filterObj[e];}sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(n);this.rerender();};sap.suite.ui.smartbusiness.lib.Filter.prototype._addDimensions=function(d){var c=[];if(d&&d.length){if(typeof d=='string'){d=d.split(",");}}if(this.getEvaluationId()){var f=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(this._serviceUri,this._entitySet);}for(var i=0;i<d.length;i++){c.push({name:d[i],isDelta:false});}for(var i=0;i<f.length;i++){if(d.indexOf(f[i])==-1)c.push({name:f[i],isDelta:true});}var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._serviceUri,this._entitySet);var C=p.getLabelMappingObject();try{c.sort(function(a,b){return C[a.name]>C[b.name]?1:-1;});}catch(e){jQuery.sap.log.error(e);}for(var i=0;i<c.length;i++){this.addFacetList(c[i].name,c[i].isDelta,p);}};sap.suite.ui.smartbusiness.lib.Filter.prototype.facetListClosed=function(e){this.fireFilterChange(e);};sap.suite.ui.smartbusiness.lib.Filter.prototype.setEvaluationData=function(e){this.EVALUATION=e;};sap.suite.ui.smartbusiness.lib.Filter.prototype.getSelectedKeys=function(l){var s=[];if(l.getActive()){var a=l.getSelectedItems();for(var i=0;i<a.length;i++){if(a[i].getSelected()){var v=a[i].getKey();var b=(v||v==0)?v:(v==null)?"SAP_SMARTBUSINESS_NULL":"";b=b.getTime?b.getTime():b;s.push(b+"");}}}return s;};sap.suite.ui.smartbusiness.lib.Filter.prototype.addFacetList=function(f,i,p){var t=this;var a=this.getAggregation("_filter");var C=p.getLabelMappingObject();var T=p.getTextPropertyMappingObject();var b=new sap.m.FacetFilterList({key:f,title:C[f],displaySecondaryValues:true,growingThreshold:999,active:!i,listOpen:function(){t._fetchListData(this);}});this._facetListsReference[f]=b;b._techName=f;b._isDelta=i;b._isFilterDirty=true;b._prevSelectedKeys=[];if(this.getMode()=="Runtime"){b.attachListClose(function(){var c=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(['viewId']);this._prevSelectedKeys=c[this._techName]||[];if(JSON.stringify(this._prevSelectedKeys)!=JSON.stringify(t.getSelectedKeys(this))){this._prevSelectedKeys=t.getSelectedKeys(this);t._setFilterDirty(this.getKey());t._updateFilter(this.getKey(),this._prevSelectedKeys);}if(!this.getActive()){this._isFilterDirty=true}});}b.bindAggregation("items","/",new sap.m.FacetFilterItem({key:{path:f},text:{formatter:t._getColumnValueFormatter(T[f]),path:T[f]}})).setModel(new sap.ui.model.json.JSONModel());a.addList(b);};sap.suite.ui.smartbusiness.lib.Filter.prototype.refreshFilter=function(n){if(this.getVisible()){var p=this._filterObj||{};var i=false;try{var f=this._facetListsReference;if(f&&this.getMode()=="Runtime"){this._filterObj=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);for(var a in this._filterObj){if(((p[a]+"")!=(this._filterObj[a]+""))||(this._filterObj[a]+""&&!f[a].getActive())){f[a].setActive(true);f[a]._isSelectionChanged=true;i=true;}}for(var a in p){if(((p[a]+"")!=(this._filterObj[a]+""))||(p[a]+""&&!f[a].getActive())){f[a].setActive(true);f[a]._isSelectionChanged=true;i=true;}}n=!!n;if(this.getAggregation("_filter")&&!n){}}var b=this.getAggregation("_filter");if(b&&i){var c=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);for(var a in f){if(f[a]._isSelectionChanged){this.updateSelections(f[a],c[a]||[]);}}}}catch(e){jQuery.sap.log.error(e);}}};sap.suite.ui.smartbusiness.lib.Filter.prototype.updateSelections=function(f,s){var a=f.getModel().getData();if(!(a instanceof Array)||!a.length){if(s.length==1){f._isFilterDirty=true;this._fetchListData(f);}else{this._fetchPseudoListData(f,s);f._isFilterDirty=true;}}else{this._retainListSelections(f);}};sap.suite.ui.smartbusiness.lib.Filter.prototype._updateFilter=function(d,f){this._filterObj=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var v=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters().viewId[0];var n={viewId:[v]};if(f.length){this._filterObj[d]=f;}else{delete this._filterObj[d];}for(var e in this._filterObj){n[e]=this._filterObj[e];}sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(n);};sap.suite.ui.smartbusiness.lib.Filter.prototype._getValidFilters=function(d){var o=[];var f=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId",d]);for(var e in f){var a=f[e];if(a&&a.length){a.forEach(function(F){o.push({NAME:e,VALUE_1:F,VALUE_2:"",TYPE:"FI",OPERATOR:"EQ"});});}}return o;};sap.suite.ui.smartbusiness.lib.Filter.prototype.getActiveDimensions=function(){var t=[];if(this.getMode()=="RunTime"){var f=this.getAggregation("_filter").getLists();f.forEach(function(s){if(s.getActive()){t.push(s._techName);}});}else{var l=this._designTimeModel.getProperty("/");l.forEach(function(s){if(s.selected){t.push(s.name);}});}return t;};sap.suite.ui.smartbusiness.lib.Filter.prototype._retainListSelections=function(l){if(this.getMode()=="Runtime"){this._filterObj=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var c=this._filterObj[l.getKey()]||[];for(var i=0,a=l.getItems();i<a.length;i++){var b=a[i].getBindingContext().getObject()[l._techName];b=(b==null)?"SAP_SMARTBUSINESS_NULL":(b||b==0?b:"");b=b.getTime?b.getTime()+"":b+"";a[i].setSelected(c.indexOf(b)!=-1);}l._isSelectionChanged=false;}};sap.suite.ui.smartbusiness.lib.Filter.prototype._getFilterString=function(d,o){return sap.suite.ui.smartbusiness.lib.Util.odata.getUri({entitySet:this._entitySet,serviceUri:this._serviceUri,dimension:d,filter:o.concat(this.EVALUATION.getFilters().results)}).uri;};sap.suite.ui.smartbusiness.lib.Filter.prototype._setFilterDirty=function(e){var f=this.getAggregation("_filter");for(var i=0,l=f.getLists();i<l.length;i++){if(l[i].getKey()!=e){l[i]._isFilterDirty=true;}}};sap.suite.ui.smartbusiness.lib.Filter.prototype._onAfterListDataFetch=function(l,d){l.getModel().setData(d);this._retainListSelections(l);l._isFilterDirty=false;l.setBusy(false);};sap.suite.ui.smartbusiness.lib.Filter.prototype._fetchPseudoListData=function(l,p){var d=[];var a=l.getKey();for(var e in p){var o={};o[a]=p[e];d.push(o);}this._onAfterListDataFetch(l,d);};sap.suite.ui.smartbusiness.lib.Filter.prototype._fetchListData=function(l,f){if(l._isFilterDirty){var t=this;if(this.getMode()=="Runtime"){l.setBusy(true);this.oDataModel.read(this._getFilterString(l.getKey(),this._getValidFilters(l.getKey())),null,null,true,function(d){t._onAfterListDataFetch(l,d.results);},function(){});}}else if(l._isSelectionChanged){this._retainListSelections(l);}};sap.suite.ui.smartbusiness.lib.Filter.prototype._initModel=function(){if(this.getEvaluationId()){if(sap.suite.ui.smartbusiness.lib.Util.odata){this.oDataModel=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(this._serviceUri);}else{this.oDataModel=new sap.ui.model.odata.ODataModel(this._serviceUri,true);}}};sap.suite.ui.smartbusiness.lib.Filter.prototype._getColumnValueFormatter=function(n){var f=function(s){return s==0?s+"":s;};var m=sap.suite.ui.smartbusiness.lib.Util.odata.getEdmType(this._serviceUri,n,true);var t=m.type;var F=m.format.toUpperCase();if(t=='Edm.DateTime'){if(!sap.suite.ui.smartbusiness.lib.Util.odata.isTimeZoneIndependent(this._serviceUri,this._entitySet)){var a;if(F=="DATE"||F=="NONE"){a="daysAgo";}else if(F=="DATETIME"){a="";}if(a){var o=new sap.ca.ui.model.type.Date({style:a});f=function(s){return o.formatValue(s,"string");}}else{var o=sap.ui.core.format.DateFormat.getDateTimeInstance();f=function(b){if(b&&b.getMinutes){return o.format(b);}return b;}}}else{f=function(b){if(b&&b.getMinutes){b=new Date(b.getTime());b.setMinutes(b.getMinutes()+b.getTimezoneOffset());var i=(F=="DATE")?"getDateInstance":"getDateTimeInstance";return sap.ui.core.format.DateFormat[i]().format(b);}return b;}}}return f;};sap.suite.ui.smartbusiness.lib.Filter.prototype._getDesignTimeModel=function(a){var d=[];a=a||[];var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._serviceUri,this._entitySet);var C=p.getLabelMappingObject();var b=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(this._serviceUri,this._entitySet);if(a&&a.length){if(typeof a=='string'){a=a.split(",");}}b.forEach(function(s){d.push({name:s,label:C[s],selected:a.indexOf(s)!=-1});});return new sap.ui.model.json.JSONModel(d);};sap.suite.ui.smartbusiness.lib.Filter.prototype._addDimensionsDesignTime=function(d){function o(e){var c=[];var q=e.getSource().getValue();var g=p.getBinding("items");if(q&&q.length>0){c=[new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,q)]}g.filter(c);}this._designTimeModel=this._getDesignTimeModel(d);this._designTimeModel.setSizeLimit(999);this._facetContainer.setModel(this._designTimeModel);var p=new sap.m.List({mode:"MultiSelect"});var s=new sap.m.SearchField({width:"100%",liveChange:jQuery.proxy(o,this)});this._popover=new sap.m.Popover({customHeader:s,content:[p],showHeader:false,placement:"Bottom"});this._popover.setModel(this._designTimeModel);var a=new sap.ui.model.Sorter('label',false);p.bindAggregation("items",{path:"/",template:new sap.m.StandardListItem({title:"{label}",selected:"{selected}"}),sorter:a});var f=new sap.m.HBox({visible:"{selected}",justifyContent:"SpaceBetween",items:[new sap.m.Label({text:"{label}"}).addStyleClass("dimensionName"),new sap.ui.core.Icon({src:"sap-icon://sys-cancel",visible:!this.getSuppressAction(),press:function(){this.getParent().setVisible(false);}})]}).addStyleClass("facetFilterDimension");var b=new sap.m.HBox();b.bindAggregation("items","/",f);this._facetContainer.addContent(b);};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Formatter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Formatter");var autoFormat=(function(){this._getMantissaLength=function(n){var N=n.toString();var i=0;if(n<0){i=1;}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length;};this._getLocaleFormatter_FormattedValue=function(n,s,d,a,i,c){jQuery.sap.require("sap.ui.core.format.NumberFormat");var f;var b;if(i){f=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:a,showMeasure:false});c=c||null;b=f.format(n,c);return{formatter:f,formatted_value:b};}if(s===-2){if(d==-1||d==null||typeof d=="undefined"){d=2;var m=this._getMantissaLength(n*100);if(!(m%3)){d=1;}if(m%3===1){d=3;}if(m%3===2){d=2;}if(Math.abs(n)%Math.pow(10,m-1)==0){d=0;}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){d=0;}}var F={minFractionDigits:d,maxFractionDigits:d};f=sap.ui.core.format.NumberFormat.getInstance(F);b=f.format(n*100);return{formatter:f,formatted_value:b};}var D=2;var F={style:a};var N;if(!(d==-1||d==null)){F.shortDecimals=Number(d);F.minFractionDigits=Number(d);F.maxFractionDigits=Number(d);}var v=sap.ui.core.format.NumberFormat.getFloatInstance(F);if(d==-1||d==null){var m=this._getMantissaLength(n);if(!(m%3)){D=1;}if(m%3===1){D=3;}if(m%3===2){D=2;}if(Math.abs(n)%Math.pow(10,m-1)==0){D=0;}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){D=0;}v=sap.ui.core.format.NumberFormat.getFloatInstance({style:a,shortDecimals:D,minFractionDigits:D,maxFractionDigits:D});N=v.format(n);}else{N=v.format(n);}return{formatter:v,formatted_value:N};};this._getLocaleFormattedValue=function(n,s,d,a,i,c){return this._getLocaleFormatter_FormattedValue(n,s,d,a,i,c)["formatted_value"];};this._getLocaleFormatter=function(n,s,d,a,i){return this._getLocaleFormatter_FormattedValue(n,s,d,a,i,null)["formatter"];};this.getLocaleFormattedValue=function(n,s,d,i,c){i=i||false;return this._getLocaleFormattedValue(n,s,d,"short",i,c);};this.getLocaleFormattedValue_nonscaled=function(n,s,d,i,c){i=i||false;return this._getLocaleFormattedValue(n,s,d,"standard",i,c);};this.getLocaleFormatter=function(n,s,d,i){i=i||false;return this._getLocaleFormatter(n,s,d,"short",i);};this.getLocaleFormatter_nonscaled=function(n,s,d,i){i=i||false;return this._getLocaleFormatter(n,s,d,"standard",i);};});sap.suite.ui.smartbusiness.lib.Formatter=new autoFormat();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.IDGenerator')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.IDGenerator");(function(){var d={EVALUATION_ID_PREFIX:"E",KPI_ID_PREFIX:"K",VIEW_ID_PREFIX:"V"};var P="/tmp/aijaz/rnd/test.xsjs";var F=function(){};var I={TIMESTAMP:"TIMESTAMP",PUNYCODE:"PUNYCODE"};var C=I.TIMESTAMP;var p=function(n,m){var s=""+n;if(s.length>=m){return s;}else{return new Array(m-s.length+1).join('0')+n;}};var g=null;(function(s){switch(s){case I.TIMESTAMP:g=function(o){var a=new jQuery.Deferred();var b=o.prefix;if(o.title){b=(o.title+"").replace(/[\s]+/g,".")}b=b+"."+new Date().getTime();a.resolve(b);return a.promise();};break;case I.PUNYCODE:g=function(o){jQuery.sap.require("sap.ui.thirdparty.punycode");var t=punycode.encode(o.title.replace(/\s|\W/g,""));if(t.length>35){t=t.substring(0,35);}return jQuery.ajax({url:P,type:"get",data:{type:o.type,id:t},dataType:"json"}).pipe(function(a){if(a.found){var i=a.id.substring(0,35),n,f;var l=a.id.substring(35);if(l.length){n=-1;if(isNaN(l)){n=0;}else{n=Number(l);++n;}f=i+p(n,4);}else{f=i+p(0,4);}return f;}else{return t+p(0,4);}});};break;default:throw new Error("Please use a valid ID Generation Strategy");}})(C);F.prototype={generateEvaluationId:function(s){return g({prefix:d.EVALUATION_ID_PREFIX,title:s&&s.title,type:"evaluation"});},generateKpiId:function(s){return g({prefix:d.KPI_ID_PREFIX,title:s&&s.title,type:"kpi"});},generateViewId:function(s){return g({prefix:d.VIEW_ID_PREFIX,title:s&&s.title,type:"view"});}};sap.suite.ui.smartbusiness.lib.IDGenerator=new F();})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.ListPersona')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.ListPersona");sap.suite.ui.smartbusiness.lib.ListPersona=function(p){this.oParam=p;this.init();};sap.suite.ui.smartbusiness.lib.ListPersona.prototype={init:function(){this.CHANGE_STATE=false;this.oContext=this.oParam.context;if(jQuery.sap.startsWith(this.oContext,"/")){this.oContext=this.oContext.substring(1);}this.oView=this.oParam.view;this.namedModel=this.oParam.namedModel;this.oModel=this.oView.getModel();if(this.namedModel){this.oModel=this.oView.getModel(this.namedModel);}var v=this.oModel.getContext("/"+this.oContext).getObject();this.oData=[];this.oBackupData=[];jQuery.extend(true,this.oData,v);jQuery.extend(true,this.oBackupData,v);this.iLength=this.oData.length;if(this.oParam.filter){this.iLength=this._getArrayIndex(this.oData.length-1)+1;}this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this._initializeDialogView();this.oDialog.setModel(this.oTempModel);if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value));}},_getArrayIndex:function(I){var a=-1;for(var i=0;i<=I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){a++;}}return a;},handleListSelection:function(e){if(this.iLength>1){this._oSelectedItemIndex=+((e.getParameter("listItem").getBindingContext().getPath()).split('/').pop());var i=this._oSelectedItemIndex;if(this.oParam.filter){i=this._getArrayIndex(this._oSelectedItemIndex);}this.setSelectedIndex(i);}},setSelectedIndex:function(i,c){this.selectedIndex=i;if(this.selectedIndex==0){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(false);}else if(this.selectedIndex>0&&this.selectedIndex<this.iLength-1){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(true);}else if(this.selectedIndex==this.iLength-1){this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(true);}else{jQuery.sap.log.error("Invalid Selected Index");}if(c){this.oList.setSelectedItem(this.oList.getItems()[this.selectedIndex],true);}},_getPreviousIndex:function(I){var r=-1;for(var i=0;i<I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i;}}return r;},_getNextIndex:function(I){var r=-1;for(var i=this.oData.length-1;i>I;i--){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i;}}return r;},moveItemUp:function(){var t=this.oData[this._oSelectedItemIndex];var p=this._oSelectedItemIndex-1;if(this.oParam.filter){p=this._getPreviousIndex(this._oSelectedItemIndex);}this.oData[this._oSelectedItemIndex]=this.oData[p];this.oData[p]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex-1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=p;},moveItemDown:function(){var t=this.oData[this._oSelectedItemIndex];var n=this._oSelectedItemIndex+1;if(this.oParam.filter){n=this._getNextIndex(this._oSelectedItemIndex);}this.oData[this._oSelectedItemIndex]=this.oData[n];this.oData[n]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex+1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=n;},resetEverything:function(){if(this.CHANGE_STATE){this.oData=[];jQuery.extend(true,this.oData,this.oBackupData);this.oList.removeSelections();this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this.oDialog.setModel(this.oTempModel);this.oTempModel.updateBindings();if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value));}this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(false);this.CHANGE_STATE=false;}},_initializeDialogView:function(){var t=this;this.oList=new sap.m.List({mode:"SingleSelectMaster",selectionChange:jQuery.proxy(this.handleListSelection,this)}).bindAggregation("items","/data",new sap.m.StandardListItem({title:{path:this.oParam.listItemContext}}));this.moveUpButton=new sap.m.Button({icon:"sap-icon://arrow-top",enabled:false,press:function(){t.moveItemUp();}});this.moveDownButton=new sap.m.Button({icon:"sap-icon://arrow-bottom",enabled:false,press:function(){t.moveItemDown();}});this.undoButton=new sap.m.Button({icon:"sap-icon://undo",press:function(){t.resetEverything();}});this.oDialog=new sap.m.Dialog({title:this.oParam.title||"Change Order of List Item",content:[this.oList,new sap.m.Bar({design:"Header",contentLeft:[this.moveUpButton,this.moveDownButton],contentRight:[this.undoButton]})],beginButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("OK"),press:jQuery.proxy(this.okDialog,this)}),endButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("CANCEL"),press:jQuery.proxy(this.closeDialog,this)})});},start:function(){this.oDialog.open();},closeDialog:function(){this.oDialog.close();},okDialog:function(){if(this.CHANGE_STATE){this.oModel.getData()[this.oContext]=this.oData;this.oModel.updateBindings();}this.oDialog.close();if(this.oParam.callback){this.oParam.callback.call(null);}}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.ModelerServices')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.ModelerServices");sap.suite.ui.smartbusiness.lib.ModelerServices={getKPIById:function(p){},getEvaluationById:function(p){},getChipById:function(p){},getDataByEntity:function(p){},getDataByBatch:function(p){}};sap.suite.ui.smartbusiness.lib.ModelerServices.hasAdapter=true;};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Navigation')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Navigation");sap.suite.ui.smartbusiness.lib.Navigation={getLinksBySemanticObject:function(p){},getLinksByContext:function(p){},reset:function(){}};sap.suite.ui.smartbusiness.lib.Navigation.hasAdapter=true;};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.OData')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.OData");sap.suite.ui.smartbusiness.lib.OData=(function(){var m={};var c={};function g(M){if(M&&M.sServiceUrl){if(c[M.sServiceUrl]){return c[M.sServiceUrl];}}var O=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(M));if(M&&M.sServiceUrl){c[M.sServiceUrl]=O;}return O;};return{getModelByServiceUri:function(s,u){var a=new sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");s=a.addSystemToServiceUrl(s);if(typeof s=='string'){if(!m[s]){var M=new sap.ui.model.odata.ODataModel(s,true);m[s]=M;}return m[s];}return s;},getUri:function(p){function _(H){if(H&&H.replace){H=H.replace(/'/g,"''");}return H;}function a(S,M){var R=[];if(S&&S.length){S.forEach(function(H){if(M.indexOf(H.name)!=-1){R.push(H.name);}});}return R;}function b(S,M){var R=[];if(S&&S.length){S.forEach(function(H){if(M[H.name]){R.push(M[H.name]);}});}return R;}try{var O=g(this.getModelByServiceUri(p.oDataModel||p.serviceUri));var q=O.findQueryResultByName(p.entitySet);var Q=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(q);var d=p.measure;if(d){if(typeof d=='string'){d=d.split(",");}var f=this.getAllMeasures(p.serviceUri,p.entitySet);Q.setMeasures(d.concat(a(p.sort,f)));if(typeof p.includeMeasureRawFormattedValueUnit=='undefined'){p.includeMeasureRawFormattedValueUnit=true;}if(p.includeMeasureRawFormattedValueUnit){Q.includeMeasureRawFormattedValueUnit(null,true,true,true);}}var h=p.dimension||[];if(h){if(typeof h=='string'){h=h.split(",");}var j=this.getPropertyToDimensionMap(O.getODataModel().sServiceUrl,p.entitySet);Q.addToAggregationLevel(h.concat(b(p.sort,j)));if(typeof p.includeDimensionKeyTextAttribute=='undefined'){p.includeDimensionKeyTextAttribute=true;}if(p.includeDimensionKeyTextAttribute){Q.includeDimensionKeyTextAttributes(null,true,true,null);}}var s=Q.getSortExpression();s.clear();var k={};if(p.sort&&p.sort.length){p.sort.forEach(function(S){if(!k[S.name]){s.addSorter(S.name,S.order);k[S.name]=true;}});}if(p.filter&&p.filter.length){var v=p.filter;var n=new Array();var o=new Array();for(var i=0,l=v.length;i<l;i++){var r=v[i];if(r.VALUE_1=="SAP_SMARTBUSINESS_NULL")continue;if(r.TYPE==="PA"){o.push(r);}else if(r.TYPE==="FI"){n.push(r);}}function t(H){var I=H.toJSON();var J=I.charAt(I.length-1).toUpperCase();if(J.charCodeAt(0)>=65&&J.charCodeAt(0)<=90){I=I.slice(0,-1);}return I;};function u(H){if(H){try{if(H==+H){H=window.parseInt(H);}var I=new Date(H);var J=I.getTime();if(isNaN(J)){return H;}else{return t(I);}}catch(e){}}return H;};if(n.length){var F=Q.getFilterExpression();for(var i=0,l=n.length;i<l;i++){var r=n[i];if(this.getEdmType(p.serviceUri,r.NAME)=="Edm.DateTime"){r.VALUE_1=u(r.VALUE_1);r.VALUE_2=u(r.VALUE_2);}r.VALUE1=(r.VALUE_1&&r.VALUE_1.replace)?r.VALUE_1.replace(/\|\^/g,","):r.VALUE_1;if(r.OPERATOR==sap.ui.model.FilterOperator.BT){F.addCondition(r.NAME,r.OPERATOR,_(r.VALUE_1),r.VALUE_2);}else{F.addCondition(r.NAME,r.OPERATOR,_(r.VALUE_1),null);}}}if(o.length){if(q.getParameterization()){var P=new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(q.getParameterization());var w=q.getParameterization();var x,A,B,C,D,E;for(var y=0,z=o.length;y<z;y++){x=o[y];A=w.findParameterByName(x.filterPropertyName);if(A.isIntervalBoundary()===true&&A.isLowerIntervalBoundary()===true){B=A.getPeerIntervalBoundaryParameter();E=B.getPeerIntervalBoundaryParameter();for(var i=0,l=o.length;i<l;i++){if(o[i].filterPropertyName===E){D=_(o[i].value);break;}}C=_(x.value);if(D){P.setParameterValue(x.filterPropertyName,C,D);}else{}}else if(A.isIntervalBoundary()===true&&A.isLowerIntervalBoundary()===false){}else{P.setParameterValue(x.filterPropertyName,_(x.value));}}Q.setParameterizationRequest(P);}}}var G=Q.getURIToQueryResultEntries();if(p.dataLimit){G=G+"&$top="+p.dataLimit;}return{uri:G,model:O.getODataModel()};}catch(e){jQuery.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());return null;}},getEdmType:function(u,p,d){function _(h){var k="None";var l=h.extensions||[];for(var i=0;i<l.length;i++){if(l[i].name=="display-format"){k=l[i].value.toUpperCase();break;}}return k;}var D=null;var r=null;if(u instanceof sap.ui.model.odata.ODataModel){D=u;}else{D=this.getModelByServiceUri(u);}if(D&&D.getServiceMetadata()){var s=D.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var a=e[i];var b=a.property;for(var j=0;j<b.length;j++){var f=b[j];if(f.name==p){if(d){r={type:f.type,format:_(f)};}else{r=f.type;}}}}}}return r;},getAllEntitySet:function(u){var a=new Array();try{var o=g(this.getModelByServiceUri(u));a=o.getAllQueryResultNames();}catch(e){jQuery.sap.log.error("Error fetching Enity Set : "+e.toString());}return a;},measures:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasureNames();return{getAsStringArray:function(){return a;},getAsObjectArray:function(k){k=k||"name";var b=[];a.forEach(function(M){var d={};d[k]=M;b.push(d);});return b;},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var b=[];a.forEach(function(M){var d=q.findMeasureByName(M);var f={};f[O]=M;f[l]=d.getLabelText()||M;b.push(f);});return b;},getUnitProperty:function(b){var M=q.findMeasureByName(b);if(M.getUnitProperty()){return M.getUnitProperty().name;}return null;}};},properties:function(u,a){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames();var b=q.getAllMeasureNames();return{getLabelMappingObject:function(p){var f={};if(p&&p.length){p.forEach(function(h,i,j){try{var D=q.findDimensionByName(h);f[h]=D.getLabelText()||h;}catch(e){var M=q.findMeasureByName(h);f[h]=M.getLabelText()||h;}});return f;}else{d.forEach(function(D){var e=q.findDimensionByName(D);f[D]=e.getLabelText()||D;});b.forEach(function(M){var e=q.findMeasureByName(M);f[M]=e.getLabelText()||M;});return f;}},getTextPropertyMappingObject:function(p){var f={};if(p&&p.length){p.forEach(function(h,i,j){try{var D=q.findDimensionByName(h);if(D.getTextProperty()){f[h]=D.getTextProperty().name||h;}else{f[h]=h;}}catch(e){jQuery.sap.log.error("Invalid Dimension Name : "+h);}});}else{d.forEach(function(D){var e=q.findDimensionByName(D);if(e.getTextProperty()){f[D]=e.getTextProperty().name||D;}else{f[D]=D;}});b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getFormattedValueProperty&&e.getFormattedValueProperty()){f[M]=e.getFormattedValueProperty().name;}else{f[M]=null;}});}return f;},getUnitPropertyMappingObject:function(){var e={};b.forEach(function(M){var f=q.findMeasureByName(M);if(f.getUnitProperty()){e[M]=f.getUnitProperty().name;}else{e[M]=null;}});return e;}};},dimensions:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var d=q.getAllDimensionNames();var D=q.getAllDimensions();return{all:function(){return D;},getAsStringArray:function(){var a=q.getEntityType();return d;},getAsObjectArray:function(k){k=k||"name";var a=[];d.forEach(function(s){var b={};b[k]=s;a.push(b);});return a;},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var a=[];d.forEach(function(s){var b=q.findDimensionByName(s);var f={};f[O]=s;f[l]=b.getLabelText()||s;a.push(f);});return a;},getTextProperty:function(a){var b=q.findDimensionByName(a);if(b.getTextProperty()){return b.getTextProperty().name;}return null;}}},filter:function(u,e){var d=this.dimensions(u,e).all();var D;return{getAsArray:function(){var r=[];for(sDimension in d){var D=d[sDimension];var t={};t.name=sDimension;D._oProperty.extensions.forEach(function(E){t[E.name]=E.value;});r.push(t);}return r;},getAsObject:function(){return d;},getMandatoryList:function(){var r=[];for(sDimension in d){var D=d[sDimension];D._oProperty.extensions.forEach(function(E){if(E.name==="required-in-filter"&&E.value=="true"){r.push(sDimension);}});}return r;}};},getAllMeasures:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);b=q.getAllMeasureNames();}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString());}return b;},getAllMeasuresWithLabelText:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllMeasureNames();for(var i=0;i<d.length;i++){var f=d[i];var M=q.findMeasureByName(f);b.push({key:f,value:M.getLabelText()});}}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString());}return b;},isTimeZoneIndependent:function(u,a){var i=false;try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();var d=b._oPropertySet;for(var f in d){if(f.match(/TimeZone$/gi)){i=true;}}}catch(e){jQuery.sap.log.error("TimeZone dependency check failed : "+e.toString());}return i;},getAllFilterables:function(u,a){var f=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();f=b.getFilterablePropertyNames();}catch(e){jQuery.sap.log.error("Error Fetching Filterable dimensions : "+e.toString());}return f;},getSortableProperties:function(u,a){var s=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();s=b.getSortablePropertyNames();}catch(e){jQuery.sap.log.error("Error Fetching Sortable dimensions : "+e.toString());}return s;},getPropertyToDimensionMap:function(u,e){var p={};var d=this.getAllDimensionsWithProperty(u,e);var a;var b;for(var a in d){p[a]=a;if((b=d[a].getTextProperty())){p[b.name]=a;}}return p;},getAllDimensions:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);d=q.getAllDimensionNames()||[];}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return d;},getAllFilterableDimensions:function(u,e){function i(a,b){var h=0,j=0;var r=new Array();while(h<a.length&&j<b.length){if(a[h]<b[j]){h++;}else if(a[h]>b[j]){j++;}else{r.push(a[h]);h++;j++;}}return r;}var d=this.getAllDimensions(u,e);var f=this.getAllFilterables(u,e);return i(f.sort(),d.sort());},getAllFilterableDimensionsWithProperty:function(u,a){function i(h,j){var k=0,l=0;var n={};while(k<h.length&&l<j.length){if(h[k]<j[l]){k++;}else if(h[k]>j[l]){l++;}else{n[h[k]]=b[h[k]];k++;l++;}}return n;}try{var r={};var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames()||[];var b=q.getAllDimensions()||{};var f=this.getAllFilterables(u,a);r=i(f.sort(),d.sort());}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return r;},getAllDimensionsWithProperty:function(u,a){try{var r={};var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var r=q.getAllDimensions()||{};}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return r;},getAllDimensionsWithLabelText:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getAllDimensionNames();for(var i=0;i<b.length;i++){var f=b[i];var D=q.findDimensionByName(f);var t=null;if(D.getTextProperty()!=null)t=D.getTextProperty().name;d.push({key:f,value:D.getLabelText(),textProperty:t});}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return d;},getAllInputParams:function(u,a){var i=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames();}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString());}return i;},getAllInputParamsWithFlag:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();var d=p.getAllParameterNames();for(var i=0;i<d.length;i++){var f=d[i];var h=p.findParameterByName(f);b.push({name:f,optional:h.isOptional()});}}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString());}return b;},formatOdataEdmTimeToString:function(v){if(v&&v.constructor.name=="Object"){if(v.__edmType=="Edm.Time"){var a=v.ms;var s=Math.floor((a/1000)%60);var b=Math.floor((a/60000)%60);var h=Math.floor((a/3600000)%24);return h+"H"+b+"M"+s+"S";}}return v;},formatValue:function(v,s,p,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};var t,a,b;t=Number(v).toPrecision(M);a=Number(t.split("e")[0]);b=Number(t.split("e")[1])||0;if(!v&&v!=0)return{value:"",unitPrefix:""};if(b%3!=0){if(b%3==2){if(b+1==s){b=b+1;a=a/10;}else{b=b-2;a=a*100;}}else{if(b+2==s){b=b+2;a=a/100;}else{b--;a=a*10;}}}else if(b==15){a=a*1000;b=12;}a+="";if((a).indexOf(".")<M){a=Number(a).toPrecision(M);var d=a.split(".")[1]?a.split(".")[1].length:0;if((p||p==0)&&p<d){a=Number(a).toFixed(p);}}else a=Number(a).toPrecision(M);return{value:Number(a),unitPrefix:u[b]};},getFormattingMetadata:function(u,e,p){var f={};f._hasCurrency=false;f._hasSapText=false;var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasures();if(a[p]){var s=(a[p]._oTextProperty&&a[p]._oTextProperty.name)?a[p]._oTextProperty.name:"";if(s!=""){f._hasSapText=true;f._sapTextColumn=s;}else if(a[p].hasOwnProperty("_oUnitProperty")){var b=a[p]._oUnitProperty.extensions;for(var i=0;i<a[p]._oUnitProperty.extensions.length;i++){if(b[i].name==="semantics"&&b[i].value==="currency-code"){f._hasCurrency=true;f._currencyColumn=a[p]._oUnitProperty.name;}}}}return f;}};})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.RuntimeServices')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.RuntimeServices");sap.suite.ui.smartbusiness.lib.RuntimeServices={getKPIById:function(p){},getEvaluationById:function(p){},getChipById:function(p){},getDataByEntity:function(p){}};sap.suite.ui.smartbusiness.lib.RuntimeServices.hasAdapter=true;};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Util')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Util");jQuery.sap.require('sap.ui.model.analytics.odata4analytics');jQuery.sap.require('sap.m.MessageBox');sap.suite.ui.smartbusiness.lib.Util=sap.suite.ui.smartbusiness.lib.Util||{};sap.suite.ui.smartbusiness.lib.Util.odata=(function(){var m={};var c={};function g(M){if(M&&M.sServiceUrl){if(c[M.sServiceUrl]){return c[M.sServiceUrl];}}var O=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(M));if(M&&M.sServiceUrl){c[M.sServiceUrl]=O;}return O;};return{getModelByServiceUri:function(s,a){var M;var t;var S;var b=new sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");var o={};s=s.replace(/;(.)*$/gi,"");S=b.addSystemToServiceUrl(s);try{t=sap.ushell.components.tiles.indicatorTileUtils.util;if((M=(t.getODataModelByServiceUri(s)||t.getODataModelByServiceUri(S)))){if(M){if(a){a(M);}}else{if(m[s]){if(a){a(m[s]);}M=m[s]}else{if(a){o={json:true,loadMetadataAsync:true};}else{o=true;}M=new sap.ui.model.odata.ODataModel(s,o);m[s]=M;if(a){m[s].attachMetadataLoaded(function(M){if(a){a(M);}});}}}return M;}}catch(e){if(typeof s=='string'){if(m[s]){if(a){a(m[s]);}M=m[s]}else{if(a){o={json:true,loadMetadataAsync:true};}else{o=true;}M=new sap.ui.model.odata.ODataModel(s,o);m[s]=M;if(a){m[s].attachMetadataLoaded(function(){if(a){a(m[s]);}});}}return M;}return s;}},getUri:function(p){function _(G){if(G&&G.replace){G=G.replace(/'/g,"''");}return G;}function a(S,M){var R=[];if(S&&S.length){S.forEach(function(G){if(M.indexOf(G.name)!=-1){R.push(G.name);}});}return R;}function b(S,M){var R=[];if(S&&S.length){S.forEach(function(G){if(M[G.name]){R.push(M[G.name]);}});}return R;}try{var O=g(this.getModelByServiceUri(p.oDataModel||p.serviceUri));var q=O.findQueryResultByName(p.entitySet);var Q=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(q);var d=p.measure;if(d){if(typeof d=='string'){d=d.split(",");}var f=this.getAllMeasures(p.serviceUri,p.entitySet);Q.setMeasures(d.concat(a(p.sort,f)));if(typeof p.includeMeasureRawFormattedValueUnit=='undefined'){p.includeMeasureRawFormattedValueUnit=true;}if(p.includeMeasureRawFormattedValueUnit){Q.includeMeasureRawFormattedValueUnit(null,true,true,true);}}var h=p.dimension||[];if(h){if(typeof h=='string'){h=h.split(",");}var j=this.getPropertyToDimensionMap(O.getODataModel().sServiceUrl,p.entitySet);Q.addToAggregationLevel(h.concat(b(p.sort,j)));if(typeof p.includeDimensionKeyTextAttribute=='undefined'){p.includeDimensionKeyTextAttribute=true;}if(p.includeDimensionKeyTextAttribute){Q.includeDimensionKeyTextAttributes(null,true,true,null);}}var s=Q.getSortExpression();s.clear();var k={};if(p.sort&&p.sort.length){p.sort.forEach(function(S){if(!k[S.name]){s.addSorter(S.name,S.order);k[S.name]=true;}});}if(p.filter&&p.filter.length){var v=p.filter;var n=new Array();var o=new Array();for(var i=0,l=v.length;i<l;i++){var r=v[i];if(r.VALUE_1=="SAP_SMARTBUSINESS_NULL")continue;if(r.TYPE==="PA"){o.push(r);}else if(r.TYPE==="FI"){n.push(r);}}function t(G){var H=G.toJSON();var I=H.charAt(H.length-1).toUpperCase();if(I.charCodeAt(0)>=65&&I.charCodeAt(0)<=90){H=H.slice(0,-1);}return H;};function u(G){if(G){try{if(G==+G){G=window.parseInt(G);}var H=new Date(G);var I=H.getTime();if(isNaN(I)){return G;}else{return t(H);}}catch(e){}}return G;};if(n.length){var F=Q.getFilterExpression();for(var i=0,l=n.length;i<l;i++){var r=n[i];if(this.getEdmType(p.serviceUri,r.NAME)=="Edm.DateTime"){r.VALUE_1=u(r.VALUE_1);r.VALUE_2=u(r.VALUE_2);}r.VALUE1=(r.VALUE_1&&r.VALUE_1.replace)?r.VALUE_1.replace(/\|\^/g,","):r.VALUE_1;if(r.OPERATOR==sap.ui.model.FilterOperator.BT){F.addCondition(r.NAME,r.OPERATOR,_(r.VALUE_1),r.VALUE_2);}else{F.addCondition(r.NAME,r.OPERATOR,_(r.VALUE_1),null);}}}if(o.length){if(q.getParameterization()){var P=new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(q.getParameterization());var w=q.getParameterization();var x,A,B,C,D;for(var y=0,z=o.length;y<z;y++){x=o[y];A=w.findParameterByName(x.NAME);if(A.isIntervalBoundary()===true&&A.isLowerIntervalBoundary()===true){D=A.getPeerIntervalBoundaryParameter();for(var i=0,l=o.length;i<l;i++){if(o[i].NAME===D.getName()){C=_(o[i].VALUE_1);break;}}B=_(x.VALUE_1);if(C){P.setParameterValue(x.NAME,B,C);}}else if(A.isIntervalBoundary()===true&&A.isLowerIntervalBoundary()===false){jQuery.sap.log.info("Future development");}else{P.setParameterValue(x.NAME,_(x.VALUE_1));}}Q.setParameterizationRequest(P);}}}var E=Q.getURIToQueryResultEntries();if(p.dataLimit){E=E+"&$top="+p.dataLimit;}return{uri:E,model:O.getODataModel()};}catch(e){jQuery.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());return null;}},getEdmType:function(u,p,d){function _(h){var k="None";var l=h.extensions||[];for(var i=0;i<l.length;i++){if(l[i].name=="display-format"){k=l[i].value.toUpperCase();break;}}return k;}var D=null;var r=null;if(u instanceof sap.ui.model.odata.ODataModel){D=u;}else{D=this.getModelByServiceUri(u);}if(D&&D.getServiceMetadata()){var s=D.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var a=e[i];var b=a.property;for(var j=0;j<b.length;j++){var f=b[j];if(f.name==p){if(d){r={type:f.type,format:_(f)};}else{r=f.type;}}}}}}return r;},getAllEntitySet:function(u){var a=new Array();try{var o=g(this.getModelByServiceUri(u));a=o.getAllQueryResultNames();}catch(e){jQuery.sap.log.error("Error fetching Enity Set : "+e.toString());}return a;},measures:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasureNames();return{getAsStringArray:function(){return a;},getAsObjectArray:function(k){k=k||"name";var b=[];a.forEach(function(M){var d={};d[k]=M;b.push(d);});return b;},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var b=[];a.forEach(function(M){var d=q.findMeasureByName(M);var f={};f[O]=M;f[l]=d.getLabelText()||M;b.push(f);});return b;},getUnitProperty:function(b){var M=q.findMeasureByName(b);if(M.getUnitProperty()){return M.getUnitProperty().name;}return null;}};},properties:function(u,a){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames();var b=q.getAllMeasureNames();return{getLabelMappingObject:function(p){var f={};if(p&&p.length){p.forEach(function(h,i,j){try{var D=q.findDimensionByName(h);f[h]=D.getLabelText()||h;}catch(e){var M=q.findMeasureByName(h);f[h]=M.getLabelText()||h;}});return f;}else{d.forEach(function(D){var e=q.findDimensionByName(D);f[D]=e.getLabelText()||D;});b.forEach(function(M){var e=q.findMeasureByName(M);f[M]=e.getLabelText()||M;});return f;}},getTextPropertyMappingObject:function(p){var f={};if(p&&p.length){p.forEach(function(h,i,j){try{var D=q.findDimensionByName(h);if(D.getTextProperty()){f[h]=D.getTextProperty().name||h;}else{f[h]=h;}}catch(e){jQuery.sap.log.error("Invalid Dimension Name : "+h);}});}else{d.forEach(function(D){var e=q.findDimensionByName(D);if(e.getTextProperty()){f[D]=e.getTextProperty().name||D;}else{f[D]=D;}});b.forEach(function(M){var e=q.findMeasureByName(M);if(e.getFormattedValueProperty&&e.getFormattedValueProperty()){f[M]=e.getFormattedValueProperty().name;}else{f[M]=null;}});}return f;},getUnitPropertyMappingObject:function(){var e={};b.forEach(function(M){var f=q.findMeasureByName(M);if(f.getUnitProperty()){e[M]=f.getUnitProperty().name;}else{e[M]=null;}});return e;}};},dimensions:function(u,e){var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var d=q.getAllDimensionNames();return{getAsStringArray:function(){var a=q.getEntityType();return d;},getAsObjectArray:function(k){k=k||"name";var a=[];d.forEach(function(D){var b={};b[k]=D;a.push(b);});return a;},getAsObjectArrayWithLabel:function(O,l){O=O||"name";l=l||"label";var a=[];d.forEach(function(D){var b=q.findDimensionByName(D);var f={};f[O]=D;f[l]=b.getLabelText()||D;a.push(f);});return a;},getTextProperty:function(a){var D=q.findDimensionByName(a);if(D.getTextProperty()){return D.getTextProperty().name;}return null;}}},getAllMeasures:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);b=q.getAllMeasureNames();}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString());}return b;},getAllMeasuresWithLabelText:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllMeasureNames();for(var i=0;i<d.length;i++){var f=d[i];var M=q.findMeasureByName(f);b.push({key:f,value:M.getLabelText()});}}catch(e){jQuery.sap.log.error("Error Fetching All Measures : "+e.toString());}return b;},isTimeZoneIndependent:function(u,a){var i=false;try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();var d=b._oPropertySet;for(var f in d){if(f.match(/TimeZone$/gi)){i=true;}}}catch(e){jQuery.sap.log.error("TimeZone dependency check failed : "+e.toString());}return i;},getAllFilterables:function(u,a){var f=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();f=b.getFilterablePropertyNames();}catch(e){jQuery.sap.log.error("Error Fetching Filterable dimensions : "+e.toString());}return f;},getSortableProperties:function(u,a){var s=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getEntityType();s=b.getSortablePropertyNames();}catch(e){jQuery.sap.log.error("Error Fetching Sortable dimensions : "+e.toString());}return s;},getPropertyToDimensionMap:function(u,e){var p={};var d=this.getAllDimensionsWithProperty(u,e);var a;var b;for(var a in d){p[a]=a;if((b=d[a].getTextProperty())){p[b.name]=a;}}return p;},getAllDimensions:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);d=q.getAllDimensionNames()||[];}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return d;},getAllFilterableDimensions:function(u,e){function i(a,b){var h=0,j=0;var r=new Array();while(h<a.length&&j<b.length){if(a[h]<b[j]){h++;}else if(a[h]>b[j]){j++;}else{r.push(a[h]);h++;j++;}}return r;}var d=this.getAllDimensions(u,e);var f=this.getAllFilterables(u,e);return i(f.sort(),d.sort());},getAllFilterableDimensionsWithProperty:function(u,a){function i(h,j){var k=0,l=0;var n={};while(k<h.length&&l<j.length){if(h[k]<j[l]){k++;}else if(h[k]>j[l]){l++;}else{n[h[k]]=b[h[k]];k++;l++;}}return n;}try{var r={};var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var d=q.getAllDimensionNames()||[];var b=q.getAllDimensions()||{};var f=this.getAllFilterables(u,a);r=i(f.sort(),d.sort());}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return r;},getAllDimensionsWithProperty:function(u,a){try{var r={};var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var r=q.getAllDimensions()||{};}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return r;},getAllDimensionsWithLabelText:function(u,a){var d=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);var b=q.getAllDimensionNames();for(var i=0;i<b.length;i++){var f=b[i];var D=q.findDimensionByName(f);var t=null;if(D.getTextProperty()!=null)t=D.getTextProperty().name;d.push({key:f,value:D.getLabelText(),textProperty:t});}}catch(e){jQuery.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return d;},getAllInputParams:function(u,a){var i=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames();}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString());}return i;},getAllInputParamsWithFlag:function(u,a){var b=new Array();try{var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(a);if(q.getParameterization()){var p=q.getParameterization();var d=p.getAllParameterNames();for(var i=0;i<d.length;i++){var f=d[i];var h=p.findParameterByName(f);b.push({name:f,optional:h.isOptional()});}}}catch(e){jQuery.sap.log.error("Error Fetching Input Params : "+e.toString());}return b;},formatOdataEdmTimeToString:function(v){if(v&&v.constructor.name=="Object"){if(v.__edmType=="Edm.Time"){var a=v.ms;var s=Math.floor((a/1000)%60);var b=Math.floor((a/60000)%60);var h=Math.floor((a/3600000)%24);return h+"H"+b+"M"+s+"S";}}return v;},formatValue:function(v,s,p,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};var t,a,b;t=Number(v).toPrecision(M);a=Number(t.split("e")[0]);b=Number(t.split("e")[1])||0;if(!v&&v!=0)return{value:"",unitPrefix:""};if(b%3!=0){if(b%3==2){if(b+1==s){b=b+1;a=a/10;}else{b=b-2;a=a*100;}}else{if(b+2==s){b=b+2;a=a/100;}else{b--;a=a*10;}}}else if(b==15){a=a*1000;b=12;}a+="";if((a).indexOf(".")<M){a=Number(a).toPrecision(M);var d=a.split(".")[1]?a.split(".")[1].length:0;if((p||p==0)&&p<d){a=Number(a).toFixed(p);}}else a=Number(a).toPrecision(M);return{value:Number(a),unitPrefix:u[b]};},getFormattingMetadata:function(u,e,p){var f={};f._hasCurrency=false;f._hasSapText=false;var o=g(this.getModelByServiceUri(u));var q=o.findQueryResultByName(e);var a=q.getAllMeasures();if(a[p]){var s=(a[p]._oTextProperty&&a[p]._oTextProperty.name)?a[p]._oTextProperty.name:"";if(s!=""){f._hasSapText=true;f._sapTextColumn=s;}else if(a[p].hasOwnProperty("_oUnitProperty")){var b=a[p]._oUnitProperty.extensions;for(var i=0;i<a[p]._oUnitProperty.extensions.length;i++){if(b[i].name==="semantics"&&b[i].value==="currency-code"){f._hasCurrency=true;f._currencyColumn=a[p]._oUnitProperty.name;}}}}return f;}};})();sap.suite.ui.smartbusiness.lib.Util.cache=(function(){var B={};var D={};var s="HANA_CLIENT";return{getCacheHanaClient:function(){if(B[s]){return B[s];}return null;},setCacheHanaClient:function(d){B[s]=d;},getEvaluationById:function(k){if(B[k]){return B[k];}return null;},setEvaluationById:function(k,d){B[k]=d;},getKpiDetailsById:function(k){if(D[k]){return D[k];}return null;},setKpiDetailsById:function(k,d){D[k]=d;},invalidateKpiDetailsCache:function(){D={};},current_calls:{}}})();sap.suite.ui.smartbusiness.lib.Util.utils=(function(){return{convertHexToRgba:function(c,o){o=o||"1.0";var h=/^(#[a-fA-F0-9]{3}$)|(#[a-fA-F0-9]{6}$)/;if(c.match(h)){var m=c.match(/^#([A-Fa-f0-9]{1,2})([A-Fa-f0-9]{1,2})([A-Fa-f0-9]{1,2})$/);var C=[];m.forEach(function(a,i){if(i>0){if(a.length==1){a+=a;}C.push(a);}});var r="rgba(";C.forEach(function(a){r+=window.parseInt(a,16)+",";});r+=(o+")");return r;}jQuery.sap.log.error("Not a valid Hex Color Code : "+c);return c;},applySearchPatternToListItem:function(i,f){if(f==""){return true;}var p=i.getBindingContext(this.sModelName).getProperty();for(var k in p){if(k!="TITLE"){continue;}var c=p[k];if(typeof c=="string"){if(c.toLowerCase().indexOf(f)!=-1){return true;}}}if((i.getIntro()&&i.getIntro().toLowerCase().indexOf(f)!=-1)||(i.getTitle()&&i.getTitle().toLowerCase().indexOf(f)!=-1)||(i.getNumber()&&i.getNumber().toLowerCase().indexOf(f)!=-1)||(i.getNumberUnit()&&i.getNumberUnit().toLowerCase().indexOf(f)!=-1)||(i.getFirstStatus()&&i.getFirstStatus().getText().toLowerCase().indexOf(f)!=-1)||(i.getSecondStatus()&&i.getSecondStatus().getText().toLowerCase().indexOf(f)!=-1)){return true;}var d=i.getDependents();for(var x=0,l=d.length;x<l;x++){if(d[x].getText()&&d[x].getText().toLowerCase().indexOf(f)!=-1){return true;}}return false;},addSystemToServiceUrl:function(s,S){if(S){if(s.indexOf('/')!==0||s.indexOf('//')===0){throw new Error("addSystemToServiceUrl: Invalid URL: "+s,"sap.suite.ui.smartbusiness.lib.Util.utils");}if(/^[^?]*(;o=([\/;?]|$))/.test(s)){return s.replace(/;o=([\/;?]|$)/,(S?";o="+S:"")+"$1");}if(/^[^?]*;o=/.test(s)){return s;}if(S){return s.replace(/(\/[^?]*?)(\/$|$|(\/?\?.*))/,"$1;o="+S+"$2");}}else{jQuery.sap.log.warning("Not adding System to Service URL : "+s);}return s;},showErrorMessage:function(e,d){var M=sap.m.MessageBox;if(d==null||d==''){M.show(e,{icon:M.Icon.ERROR,title:"Error",actions:[M.Action.OK],});}else{M.show(e,{icon:M.Icon.ERROR,title:"Error",actions:[M.Action.OK],details:d,});}},handleMessagePopover:function(e,c){var t=this;var a=new sap.ui.model.json.JSONModel();a.setData({messagesLength:c.errorMessages.length,errorMessages:c.errorMessages});var m=new sap.m.MessagePopoverItem({type:'{type}',title:'{title}',description:'{description}'});var M=new sap.m.MessagePopover({items:{path:'/errorMessages',template:m}});M.setModel(a);if(e){M.openBy(e.getSource());}},setErrorState:function(c){if(c.errorMessages.length>1){c.setBtnEnabled("errorBtn",true);c.errorState=true;}else{c.setBtnEnabled("errorBtn",false);c.errorState=false;}},getMantissaLength:function(n){var N=n.toString();var i=0;if(n<0){i=1;}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length;},getLocaleFormattedValue:function(n,s,d){var D=2;var f={style:"short"};var N;if(!(d==-1||d==null)){f.shortDecimals=d;}var v=sap.ca.ui.model.format.NumberFormat.getInstance(f);if(s==-2){if(n>9999){N="????";}else if(n<0.001){N="0";}else{if(n.toString().indexOf('.')!=-1){N=Number(n).toFixed(4-n.toString().indexOf('.'));}else{N=Number(n);}N=v.format(N);}}else if(d==-1||d==null){var m=this.getMantissaLength(n);if(!(m%3))D=1;if(Math.abs(n)%Math.pow(10,m-1)==0){D=0;}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){D=0;}v=sap.ca.ui.model.format.NumberFormat.getInstance({style:"short",shortDecimals:D});N=v.format(n);}else{N=v.format(n);}return N;},getRandomNumber:function(m){return Math.floor(Math.random()*10000)%m;},getObjectOrder:function(o){var d={TAGS:["ID","IS_ACTIVE","TYPE","TAG"],PROPERTIES:["ID","IS_ACTIVE","TYPE","NAME","VALUE"],EVALUATION_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],INDICATOR_TEXTS:["ID","IS_ACTIVE","LANGUAGE","TITLE","DESCRIPTION"],CHIP_TEXTS:["id","isActive","language","title","description"],EVALUATION_VALUES:["ID","IS_ACTIVE","TYPE","FIXED","COLUMN_NAME","ODATA_PROPERTY"],EVALUATION_FILTERS:["ID","IS_ACTIVE","TYPE","NAME","VALUE_1","OPERATOR","VALUE_2"],ASSOCIATION_PROPERTIES:["TYPE","SOURCE_INDICATOR","TARGET_INDICATOR","IS_ACTIVE","NAME","VALUE"],APP_PARAMETERS:["NAME","VALUE"],AUTHORIZATION:["NAME","TYPE"]};return d[o];},getFilterArray:function(a,f){var b=[];var c={};for(var i=0,l=a.length;i<l;i++){c[a[i].getParent().getKey()]=c[a[i].getParent().getKey()]||[];c[a[i].getParent().getKey()].push(f[a[i].getKey()]);}for(var d in c){b.push(new sap.ui.model.Filter(c[d],false));}return b;},dirtyBitCheck:function(a){var b=a.oldPayload;var c=a.newPayload;var t=a.objectType;if((b instanceof Array)&&(c instanceof Array)){var o={};var n={};var u=[];var d=[];o=this.arrayToObject(b,t);n=this.arrayToObject(c,t);for(var a in n){if(!(o[a])){u.push(n[a]);}else{delete o[a];}}for(var a in o){d.push(o[a]);}return{updates:u,deletes:d};}else if((b instanceof Object)&&(c instanceof Object)){var e={};for(var k in c){if(c.hasOwnProperty(k)){if(c[k]!=b[k]){e=c;if(t=="ASSOCIATIONS"){return{updates:[e],deletes:[b]};}return{updates:[e]};}}}return{updates:[]};}},updateChips:function(o,a){var b=null;var e=null;a=a||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);if(o.INDICATORS){b=o.INDICATORS;}else if(o.EVALUATIONS){e=o.EVALUATIONS;}if(b&&b.length){for(var i=0,l=b.length;i<l;i++){}}if(e&&e.length){for(var i=0,l=e.length;i<l;i++){a.read(("/CHIPS?$filter=evaluationId eq '"+e[i].EVALUATIONS.ID+"' and isActive eq 1"),null,null,false,function(d){if(d.results&&d.results.length){var c=d.results;var u=[];var v=[];var f=[];var g=true;var o={};for(var j=0,m=c.length;j<m;j++){var h=JSON.parse(c[j].configuration);var t=JSON.parse(h.tileConfiguration);for(var k=0,n=e[i].EVALUATION_VALUES.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_VALUES[k].TYPE;o.FIXED=e[i].EVALUATION_VALUES[k].FIXED;o.COLUMN_NAME=e[i].EVALUATION_VALUES[k].COLUMN_NAME;o.ODATA_PROPERTY=e[i].EVALUATION_VALUES[k].ODATA_PROPERTY;v.push(o);}for(var k=0,n=e[i].EVALUATION_FILTERS.length;k<n;k++){o={};o.TYPE=e[i].EVALUATION_FILTERS[k].TYPE;o.NAME=e[i].EVALUATION_FILTERS[k].NAME;o.VALUE_1=e[i].EVALUATION_FILTERS[k].VALUE_1;o.OPERATOR=e[i].EVALUATION_FILTERS[k].OPERATOR;o.VALUE_2=e[i].EVALUATION_FILTERS[k].VALUE_2;f.push(o);}t.EVALUATION=JSON.stringify(e[i].EVALUATIONS);t.EVALUATION_VALUES=JSON.stringify(v);t.EVALUATION_FILTERS=JSON.stringify(f);h.tileConfiguration=JSON.stringify(t);h.timeStamp=Date.now().toString();h=JSON.stringify(h);if(h.length>4096){t.EVALUATION_FILTERS=JSON.stringify([]);h=JSON.stringify({tileConfiguration:JSON.stringify(t),isSufficient:"0"});}for(var p in d.results[j]){if(d.results[j].hasOwnProperty(p)){if((d.results[j][p]instanceof Object)&&!(d.results[j][p]instanceof Array)&&!(d.results[j][p]instanceof Date)){delete d.results[j][p];}}}d.results[j].configuration=h;var q="CHIPS(id='"+d.results[j].id+"',isActive=1)";u.push(a.createBatchOperation(q,"PUT",d.results[j]));}a.addBatchChangeOperations(u);a.submitBatch(function(d,r,s){if(s.length){g=false;return;}var w=d.__batchResponses[0].__changeResponses;for(var x in w)if(w[x].statusCode!="201"&&w[x].statusCode!="204"&&w[x].statusCode!="200"){g=false;}},function(r){g=false;},false);if(!g){}}},function(c){});}}},arrayToObject:function(a,t){var o=this.getObjectOrder(t);var b={};var k="";for(var i=0,l=a.length;i<l;i++){if(!(a[i]instanceof Array)&&(a[i]instanceof Object)){k="";for(var j=0,m=o.length;j<m;j++){k+=(j)?"^|":"";k+=a[i][o[j]];}b[k]=a[i];}}return b;},refreshMasterList:function(c,i){var r=null;var m=null;var a=null;var A=c.oApplicationFacade;var b=true;var d=A.getODataModel();if(i){a=c._oApplicationImplementation;}else{a=c.oApplicationImplementation;}if(a&&a.oMHFHelper&&A.masterListControllerRef){r=a.oMHFHelper;m=A.masterListControllerRef;r.refreshList(m,b);}else{d.refresh();}},appToAppNavigation:function(o){var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1);}if(o.action){if(o.context||o.route){if(o.context.charAt(0)=="/"){o.context=o.context.substr(1);}o.context="&/"+((o.route+"/")||"")+(o.context||"");}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"");}if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing");}var c=new sap.ui.core.routing.HashChanger();sap.suite.ui.smartbusiness.lib.Util.utils.setPrevAppHash();c.setHash(h);},hashChange:function(o){if(!(sap.ui.core.routing)){jQuery.sap.require("sap.ui.core.routing");}var h=new sap.ui.core.routing.HashChanger();h.setHash(o.hash||"#");},replaceHash:function(o,i){if(i){window.location.replace(o.hash);}else{var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1);}if(o.action){if(o.context||o.route){if(o.context&&o.context.charAt(0)=="/"){o.context=o.context.substr(1);}o.context="&/"+((o.route+"/")||"")+(o.context||"");}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"");}window.location.replace(h);}},setHash:function(o,i){if(i){window.location.hash=o.hash;}else{var h="#";var a=window.hasher.getHashAsArray();var b=a[0].substr(a[0].indexOf("?"));if(b&&(b.charAt(b.length-1)=="&")){b=b.substr(0,b.length-1);}if(o.action){if(o.context||o.route){if(o.context&&o.context.charAt(0)=="/"){o.context=o.context.substr(1);}o.context="&/"+((o.route+"/")||"")+(o.context||"");}h+=(o.semanticObject||"FioriApplication-")+o.action+b+(o.context||"");}window.location.hash=h;}},setPrevAppHash:function(){hasher=hasher||window.hasher;sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache.prevApp=sap.suite.ui.smartbusiness.modelerAppCache.prevApp||{};sap.suite.ui.smartbusiness.modelerAppCache.prevApp.prevAppHash=hasher.getHash();sap.suite.ui.smartbusiness.modelerAppCache.prevApp.prevAppHashAsArray=hasher.getHashAsArray();},backToHome:function(){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};if(sap.suite.ui.smartbusiness.modelerAppCache.prevApp){delete sap.suite.ui.smartbusiness.modelerAppCache.prevApp;}sap.suite.ui.smartbusiness.modelerAppCache.SBWorkspace={};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI={};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPIEvaluation={};sap.suite.ui.smartbusiness.modelerAppCache.configureSBKPITile={};sap.suite.ui.smartbusiness.modelerAppCache.manageSBKPIAssociation={};sap.suite.ui.smartbusiness.modelerAppCache.configureSBKPIDrilldown={};sap.suite.ui.smartbusiness.modelerAppCache.authorizeSBEvaluation={};},isHanaViewValid:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false;}if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewValid;}else{var f=false;var e="/HANA_VIEWS"+"?$filter="+"PACKAGE eq "+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+" and "+"OBJECT eq "+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){f=true;}else{f=false;}},function(){f=true;});if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewValid=f;}return f;}},isHanaViewFormatValid:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(!(o.VIEW_NAME)){return false;}if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid;}else{if((o.VIEW_NAME.indexOf("/")==-1)&&(o.VIEW_NAME.indexOf("::")==-1)){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=false;}return false;}if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].hanaViewFormatValid=true;}return true;}},isODataURLValidForHanaView:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid;}else{var e="/ODATA_FOR_ENTITY"+"("+"P_PACKAGE="+"'"+o.VIEW_NAME.substr(0,o.VIEW_NAME.indexOf("/"))+"'"+","+"P_OBJECT="+"'"+o.VIEW_NAME.substr(o.VIEW_NAME.indexOf("/")+1)+"'"+")/Results";o.model=o.model||new sap.ui.model.odata.ODataModel("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",true);o.model.read(e,null,null,false,function(d){if(d.results.length){if(d.results.indexOf(odata)){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid=true;sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=true;}return true;}else{if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false;}return false;}}else{if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false;}return false;}},function(){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid=false;sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValidForHanaView=false;}return false;});}},isODataURLValidByExistence:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid;}else{var m=new sap.ui.model.odata.ODataModel(o.ODATA_URL,true);if(m.getServiceMetadata()){odataExists=true;}else{odataExists=false;}if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValid=odataExists;sap.suite.ui.smartbusiness.modelerAppCache[o.app].oDataURLValidByExistence=odataExists;}return odataExists;}},isODataURLValid:function(o){if(o.VIEW_NAME){return sap.suite.ui.smartbusiness.lib.Util.utils.isODataURLValidForHanaView(o);}else{return sap.suite.ui.smartbusiness.lib.Util.utils.isODataURLValidByExistence(o);}},isEntitysetValid:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].entitysetValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].entitysetValid;}else{try{if(o.VIEW_NAME){}else{if(sap.suite.ui.smartbusiness.lib.Util.odata.getAllEntitySet(o.ODATA_URL).indexOf(o.ODATA_ENTITYSET)==-1){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].entitysetValid=false;}return false;}else{if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].entitysetValid=true;}return true;}}}catch(e){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].entitysetValid=false;}return false;}}},isMeasureValid:function(o){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache[o.app]=sap.suite.ui.smartbusiness.modelerAppCache[o.app]||{};if(o.cache&&o.app&&(sap.suite.ui.smartbusiness.modelerAppCache[o.app].measureValid!==undefined)){return sap.suite.ui.smartbusiness.modelerAppCache[o.app].measureValid;}try{if(sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(o.ODATA_URL,o.ODATA_ENTITYSET).indexOf(o.COLUMN_NAME)==-1){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].measureValid=false;}return false;}else{if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].validValueMeasure=true;}return true;}}catch(e){if(o.app){sap.suite.ui.smartbusiness.modelerAppCache[o.app].validValueMeasure=false;}return false;}},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},fetchCSRFToken:function(){var t="/sap/hba/r/sb/core/logic/__token.xsjs";if(sap.ushell&&sap.ushell.Container){t=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(t,this.getHanaSystem());}return jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:t,headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){},error:function(){}});},appendUrlParameters:function(u,a){var b=u.split("?");if(b.length>2){throw new Error("Url not formed properly");}if(sap.ushell&&sap.ushell.Container){b[0]=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(b[0],this.getHanaSystem());}u=b[0];if(b.length==2){u+="?"+b[1];}if(a&&Object.keys(a)&&Object.keys(a).length){u=u+"?"+jQuery.param(a);}return u;},getLocaleLanguage:function(){return((sap.ui.getCore().getConfiguration().getLanguage())?sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase():"");},create:function(u,p,a,b,e,c,f){var t=this;c=c?true:false;sap.suite.ui.smartbusiness.lib.Util.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"POST",async:c,url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(u,f),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage()},success:b,error:e});});},update:function(u,p,a,b,e,m,c,f,g){var t=this;f=f?true:false;sap.suite.ui.smartbusiness.lib.Util.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"PUT",async:f,url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(c||"")},success:b,error:e});});},remove:function(u,p,a,e,b,c,f,g){var t=this;f=f?true:false;sap.suite.ui.smartbusiness.lib.Util.utils.fetchCSRFToken().done(function(d,s,x){jQuery.ajax({type:"DELETE",async:f,url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(u,g),data:encodeURIComponent(JSON.stringify(p)),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":t.getLocaleLanguage(),"If-None-Match":(b||"")},success:a,error:e});});},serviceUrl:function(u){var C={INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/indicators.xsjs",EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/evaluations.xsjs",CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/chips.xsjs",ACTIVATE_INDICATOR_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateIndicator.xsjs",ACTIVATE_EVALUATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateEvaluation.xsjs",INDICATOR_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteIndicator.xsjs",EVALUATION_FAVOURITE_SERVICE_URI:"/sap/hba/r/sb/core/logic/favouriteEvaluation.xsjs",ASSOCIATIONS_CUD:"/sap/hba/r/sb/core/logic/associations_cud.xsjs",ACTIVATE_ASSOCIATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateAssociation.xsjs",ACTIVATE_CHIP_SERVICE_URI:"/sap/hba/r/sb/core/logic/activateChip.xsjs",AUTHORIZATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/authorization.xsjs",COPY_DDA_CONFIGURATION_SERVICE_URI:"/sap/hba/r/sb/core/logic/copyDrilldownConfiguration.xsjs"};return C[u];}}})();sap.suite.ui.smartbusiness.lib.Util.kpi=(function(){var C={KPI_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata",KPI_RUNTIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata",EVALUATIONS_ENTITY_SET:"/EVALUATIONS",EVALUATIONS_DDA_ENTITY_SET:"/EVALUATIONS_DDA",ASSOCIATED_INDICATORS_ENTITY_SET:"ASSOCIATED_INDICATORS",DESIGN_TIME_SERVICE_URI:"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata"};function g(p,r){var a=r?"_rt":"_dt";var k=p.id;if(p.filters){k+="_FILTERS";}if(p.thresholds){k+="_VALUES";}k+=a;return k;};var _=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s);}}return u;};return{getSiblingEvaluations:function(p){if(!p.indicator){throw new Error("Indicator Not Found")}var m=null;if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(C.KPI_SERVICE_URI);}else{m=new sap.ui.model.odata.ODataModel(C.KPI_SERVICE_URI,true);}var a=!!p.success;var f="INDICATOR eq '#INDICATOR_ID'".replace("#INDICATOR_ID",p.indicator);var s=[];var d={};d["$filter"]=f;var e="";if(p.filters){e+="FILTERS,";}if(p.thresholds){e+="VALUES,";}if(e){d["$expand"]=e.substring(0,e.length-1);}var b=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){b=C.EVALUATIONS_DDA_ENTITY_SET;}m.read(b,null,d,a,function(c){if(c.results&&c.results.length){var t=c.results||[];s=t;}if(a){p.success.call(p.context||null,s);}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments);}});return s;},getAssociatedEvaluations:function(p){if(!p.id){throw new Error("Evaluation Not Found")}var m=null;if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(C.DESIGN_TIME_SERVICE_URI);}else{m=new sap.ui.model.odata.ODataModel(C.DESIGN_TIME_SERVICE_URI,true);}var a=!!p.success;var f="SOURCE_EVALS eq '#EVALUATION_ID' or TARGET_EVALS eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var b=[];var d={};d["$filter"]=f;var e="SOURCE_EVALUATION,TARGET_EVALUATION";if(p.filters){e+="FILTERS,";}if(p.thresholds){e+="VALUES,";}if(e){d["$expand"]=e.substring(0,e.length);}m.read(C.ASSOCIATED_INDICATORS_ENTITY_SET,null,d,a,function(c){c=(c.results&&c.results.length)?c.results:[];c.forEach(function(o){if(o.TARGET_EVALS==p.id){b.push(o.SOURCE_EVALUATION);}else if(o.SOURCE_EVALS==p.id){b.push(o.TARGET_EVALUATION);}});if(a){p.success.call(p.context||null,b);}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments);}});return b;},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var u=!!p.useRuntimeService;var c=g(p,u);if(p.cache){var e=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(c);if(e){if(p.success){p.success.call(p.context||null,e);return null;}else{return e;}}}var m=null;var a=u?C.KPI_RUNTIME_SERVICE_URI:C.KPI_SERVICE_URI;var a=_(a,p.sapSystem);if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(a);}else{m=new sap.ui.model.odata.ODataModel(a,true);}var b=!!p.success;var f="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var d=null;var D={};D["$filter"]=f;var h="";if(p.filters){h+="FILTERS,";}if(p.thresholds){h+="VALUES,";}if(h){D["$expand"]=h.substring(0,h.length-1);}var i=C.EVALUATIONS_ENTITY_SET;if(p.getDDAEvaluation){i=C.EVALUATIONS_DDA_ENTITY_SET;}else{}m.read(i,null,D,b,function(j){if(j.results&&j.results.length){d=j.results[0];sap.suite.ui.smartbusiness.lib.Util.cache.setEvaluationById(c,d);}if(b){p.success.call(p.context||null,d);}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments);}});return d;},parseEvaluation:function(e){return new sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation(e);}}})();sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds=function(t){this.thresholdsData=t;var T={"TA":{prop:'_target',func:"getTarget"},"CL":{prop:'_criticalLow',func:"getCriticalLow"},"CH":{prop:'_criticalHigh',func:"getCriticalHigh"},"WL":{prop:'_warningLow',func:"getWarningLow"},"WH":{prop:'_warningHigh',func:"getWarningHigh"},"TC":{prop:'_trend',func:"getTrend"},"RE":{prop:"_reference",func:"getReference"}};var g=function(o){if(o.FIXED){return'FIXED';}if(o.COLUMN_NAME){return'COLUMN_NAME';}if(o.ODATA_URL){return'ODATA_URL'}return null;};this.parse=function(a){a.forEach(function(b){var m=T[b.TYPE];if(m){var c=g(b);this[m.prop+"Type"]=c;this[m.prop+"Value"]=b[c];sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds.prototype[m.func+"Type"]=function(){return this[m.prop+"Type"];};sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds.prototype[m.func]=function(){return this[m.prop+"Value"];};}},this);for(var e in T){var o=T[e];if(!sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds.prototype[o.func]){sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds.prototype[o.func+"Type"]=function(){return null;};sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds.prototype[o.func]=function(){return null;};}}};this.parse(this.thresholdsData.results);};sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation=function(e){this.evaluationData=e;this.thresholds=null;if(this.evaluationData&&this.evaluationData.VALUES){this._init();this.thresholds=new sap.suite.ui.smartbusiness.lib.Util.kpi.Thresholds(this.evaluationData.VALUES);}};sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation.PropertyMapping={ID:"getId",ODATA_URL:"getODataUrl",ODATA_ENTITYSET:"getEntitySet",GOAL_TYPE:"getGoalType",INDICATOR:"getKpiId",TITLE:"getTitle",DESCRIPTION:"getDescription",SCALING:"getScaling",COLUMN_NAME:"getKpiMeasureName",INDICATOR_TITLE:"getKpiName",SEMANTIC_OBJECT:"getSemanticObject",ACTION:"getAction",OWNER_NAME:"getOwnerName",OWNER_ID:"getOwnerId",VALUES_SOURCE:"getThresholdValueType",FILTERS:"getFilters",VALUES:"getValues",PROPERTIES:"getProperties",TAGS:"getTags",INDICATOR_PROPERTIES:"getKpiDetail",DECIMAL_PRECISION:"getDecimalPrecision"};sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation.prototype={_init:function(){for(var e in sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation.PropertyMapping){(function(e){var f=sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation.PropertyMapping[e];sap.suite.ui.smartbusiness.lib.Util.kpi.Evaluation.prototype[f]=function(){return this.evaluationData[e];}})(e);}},getThresholds:function(){return this.thresholds;},isMaximizingKpi:function(){return this.getGoalType()=="MA";},isMinimizingKpi:function(){return this.getGoalType()=="MI";},isTargetKpi:function(){return this.getGoalType()=="RA";},get_hana_client:function(){var a;var c=sap.suite.ui.smartbusiness.lib.Util.cache.getCacheHanaClient();if(c){a=c;return a;}jQuery.ajax({type:"GET",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/GetSessionClient.xsjs",success:function(d,s,x){a=d.sessionClient;},error:function(j,t,e){jQuery.sap.log.error(j.responseText);}});sap.suite.ui.smartbusiness.lib.Util.cache.setCacheHanaClient(a);return a;},parse_sapclient:function(){var e;var r;var a;var S;var b;var H=this.get_hana_client();e=this.evaluationData;S="P_SAPClient";b="$$$";if(!e.hasOwnProperty("FILTERS")&&!e.FILTERS.hasOwnProperty("results")){return;}if(e.FILTERS.results.constructor!==Array){return;}if(e.FILTERS.results.length<1){return;}r=e.FILTERS.results;for(var i in e.FILTERS.results){var a=r[i];if(a["NAME"]===S&&a["VALUE_1"]===b){a["VALUE_1"]=H;return;}}}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.formatters')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.formatters");sap.suite.ui.smartbusiness.lib.formatters={getBundleText:function(c,t,p,P){var b;if(c===undefined){var a=sap.ca.scfld.md.app.Application.getImpl().oConfiguration.oApplicationFacade;b=a.getResourceBundle();}else{b=c.oApplicationFacade.getResourceBundle();}var T=b.getText(t,[p,P]);return T;},kpiStatus:function(s){return(s?sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS",sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS_ACTIVE")):sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS",sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS_DRAFT")));},kpiStatusText:function(s){return(s?sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS_ACTIVE"):sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"STATUS_DRAFT"));},kpiStatusState:function(s){return(s?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.None);},kpiOwner:function(o){if(o)return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"ADDED_BY",o);return;},kpiOwnerInOH:function(o){if(o)return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"OWNER",o);return;},kpiID:function(i,t){if(i){if(t&&t=="KPI"){return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"KPI",i);}else{return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,("OPI ID:"+i));}}return;},kpiIDInOH:function(i,t){if(i){if(t&&t=="KPI"){return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"KPI",i);}else{return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,("OPI: "+i));}}return;},evalStatus:function(s){try{if(s)return"Success";return"None";}catch(e){return;}},};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.library')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.suite.ui.smartbusiness.library");jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');jQuery.sap.require('sap.m.library');sap.ui.getCore().initLibrary({name:"sap.suite.ui.smartbusiness",dependencies:["sap.ui.core","sap.m"],types:[],interfaces:[],controls:[],elements:[],noLibraryCSS:true,version:"1.28.28"});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.mpt.Component')){
/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.mpt.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.mpt.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("FS",{"name":"Fullscreen Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.mpt","includes":["../lib/Util.js","themes/visualization.css","../Adapter.js"],"dependencies":{"libs":["sap.m","sap.suite.ui.commons"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"FULLSCREEN_TITLE","icon":"sap-icon://Fiori5/F0820","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0820_Edit_Tiles.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.mpt.view",fullScreenPageRoutes:{"fullscreen":{"pattern":"","view":"S1",}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.mpt.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.mpt.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.mpt.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.mpt.view.S1",{onInit:function(){var t=this;var v=this.getView();this.dateFormatter=sap.ui.core.format.DateFormat.getInstance({style:"long"});this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="fullscreen"){var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c);}},this);var t=this;t.selectedTile=null;t.runtimeRef=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");t.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;sap.sb_mpt=t;t.byId("tileGrid").getBinding("items").attachDataReceived(function(){t.updateChipsCount();});},onAfterRendering:function(){},getHeaderFooterOptions:function(){var t=this;function a(){t.getView().getModel().refresh();t.selectedTile=null;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));}function b(d){t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("CANNOT_DELETE_TILE"),d.response.body);}this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){window.history.back();},oEditBtn:{sI18nBtnTxt:"DELETE_TILE",onBtnPressed:function(e){var s=t.byId("tileGrid").getSelectedItems();if(s.length){t.handleDelete(s);}else{t.utilsRef.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("SELECT_A_TILE_TO_DELETE"));}},bEnabled:false,}};return this.oHeaderFooterOptions;},_notifyShell:function(c){var s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;if(s){oNotifyShell=s("LaunchPage");if(oNotifyShell&&oNotifyShell.onCatalogTileAdded){oNotifyShell.onCatalogTileAdded(c);}}},handleDelete:function(t){var a=this;var o=[];for(var i=0,l=t.length;i<l;i++){o.push({id:t[i].getBindingContext().getObject().id});}function b(r){var d=null;try{d=JSON.parse(r).chipId;}catch(e){jQuery.sap.log.error("Failed to parse the response");}if(d){a._notifyShell(d);}a.getView().getModel().refresh();sap.m.MessageToast.show(a.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));}function c(d){a.utilsRef.showErrorMessage(a.oApplicationFacade.getResourceBundle().getText("CANNOT_DELETE_TILE"),d.response.body);}sap.m.MessageBox.show(a.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",a.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){a.runtimeRef.handlePersonalizedTileDelete(o,b,c);}if(e=="CANCEL"){}});},updateChipsCount:function(){var c=this.byId("tileGrid").getBinding("items").getLength();this.byId("chipsTableLabel").setText(this.oApplicationFacade.getResourceBundle().getText("PERS_TILE")+" ("+(c||0)+")");},_evalValueMapping:function(){return{"TA":"TARGET","CL":"CRITICAL_LOW","WL":"WARNING_LOW","CH":"CRITICAL_HIGH","WH":"WARNING_HIGH"}},prepareFilterArray:function(f){var g={};var a=[];var k="";for(var i=0,l=f.length;i<l;i++){if(f[i].OPERATOR!='BT'){k=f[i].NAME+"_"+f[i].OPERATOR;if(g[k]){g[k].VALUE_1.push(f[i].VALUE_1);}else{g[k]={};g[k].NAME=f[i].NAME;g[k].OPERATOR=f[i].OPERATOR;g[k].VALUE_1=[f[i].VALUE_1];g[k].VALUE_2="";}}else{k=f[i].NAME+"_"+f[i].OPERATOR+"_"+f[i].VALUE_1+"_"+f[i].VALUE_2;g[k]={};g[k].NAME=f[i].NAME;g[k].OPERATOR=f[i].OPERATOR;g[k].VALUE_1=[f[i].VALUE_1];g[k].VALUE_2=[f[i].VALUE_2];}}for(var b in g){if(g.hasOwnProperty(b)){a.push(g[b]);}}return a;},getTile:function(a,c){var t=this;var b=[];var r=t.oApplicationFacade.getResourceBundle();var d=c.getObject();var f={},g={},h=[],j={},k=[],m=[];try{f=JSON.parse(JSON.parse(d.configuration).tileConfiguration);g=JSON.parse(f.TILE_PROPERTIES);h=JSON.parse(f.EVALUATION_VALUES);j=JSON.parse(f.EVALUATION);k=JSON.parse(f.ADDITIONAL_FILTERS);}catch(e){f=f||{};g=g||{};h=h||[];j=j||{};k=k||[];jQuery.sap.log.error("parsing of Chip Failed");}var n=d.tileType;var o={"NT":function(){return new sap.suite.ui.commons.NumericContent({value:"9999",size:sap.suite.ui.commons.InfoTileSize.Auto,scale:"K",valueColor:"Error"});},"CT":function(){return new sap.suite.ui.commons.ComparisonChart({scale:"M",size:sap.suite.ui.commons.InfoTileSize.Auto,data:[new sap.suite.ui.commons.ComparisonData({title:r.getText("USA"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:r.getText("INDIA"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:r.getText("GERMANY"),value:66.46})]});},"TT":function(){return new sap.suite.ui.commons.MicroAreaChart({size:sap.suite.ui.commons.InfoTileSize.Auto,width:"164px",height:"74px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:r.getText("JAN_01"),color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:r.getText("JAN_31"),color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),});},"AT":function(){return new sap.suite.ui.commons.BulletChart({scale:"M",size:sap.suite.ui.commons.InfoTileSize.Auto,minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]});},"CM":function(){return new sap.suite.ui.commons.ComparisonChart({scale:"M",size:sap.suite.ui.commons.InfoTileSize.Auto,data:[new sap.suite.ui.commons.ComparisonData({title:r.getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:r.getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:r.getText("MEASURE_3"),value:97,color:"Critical"})]});},"HT":function(){return new sap.suite.ui.commons.HarveyBallMicroChart({total:100,size:sap.suite.ui.commons.InfoTileSize.Auto,scale:"M",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:30,color:"Good"})]});}};var v="COLUMN_NAME";if(j.VALUES_SOURCE=="FIXED"){v="FIXED";}var p=new sap.m.VBox();for(var i=0,l=h.length;i<l;i++){if(h[i].TYPE&&t._evalValueMapping()[h[i].TYPE]){p.addItem(new sap.m.Text({text:r.getText(t._evalValueMapping()[h[i].TYPE])+" - "+h[i][v]}).addStyleClass("evalValItems"));}}if(k&&k.length){m=t.prepareFilterArray(k)||[];}var q=new sap.m.VBox();for(var i=0,l=m.length;i<l;i++){if(jQuery.sap.getUriParameters().get("op")){q.addItem(new sap.m.Text({text:m[i].NAME+" "+m[i].OPERATOR+" "+m[i].VALUE_1.join(",")}).addStyleClass("evalValItems"));}else{q.addItem(new sap.m.Text({text:m[i].NAME+" - "+m[i].VALUE_1.join(",")}).addStyleClass("evalValItems"));}}var s=new sap.suite.ui.commons.GenericTile({size:sap.suite.ui.commons.InfoTileSize.Auto,header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:c.getProperty("tileType")})],press:function(y){}}).addStyleClass("sbTile");if(n&&(n.split("-").length==2)){s.setFrameType("TwoByOne");}if(n=="NT"){b.push(o["NT"]());}else if(n=="CT"){b.push(o["CT"]());}else if(n=="AT"){b.push(o["AT"]());}else if(n=="TT"){b.push(o["TT"]());}else if(n=="HT"){b.push(o["HT"]());}else if(n=="CM"){b.push(o["CM"]());}else if(n=="DT-AT"){b.push(o["NT"]());b.push(o["AT"]());}else if(n=="DT-CT"){b.push(o["NT"]());b.push(o["CT"]());}else if(n=="DT-CM"){b.push(o["NT"]());b.push(o["CM"]());}else if(n=="DT-TT"){b.push(o["NT"]());b.push(o["TT"]());}else if(n=="DT-HT"){b.push(o["NT"]());b.push(o["HT"]());}s.removeAllTileContent();for(var i=0,l=b.length;i<l;i++){s.addTileContent(new sap.suite.ui.commons.TileContent({content:b[i],size:sap.suite.ui.commons.InfoTileSize.Auto}));}var u=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(y){t.handleDelete(this);}});var w=[s,p,q,new sap.m.Text({text:this.dateFormatter.format(new Date(d.createdOn)),visible:true}),];var x=new sap.m.ColumnListItem({type:"Inactive",cells:w});return x;},searchTile:function(e){var s="'"+e.getParameter("query").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(title)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(description)",sap.ui.model.FilterOperator.Contains,s);var b=this.byId("tileGrid").getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));},setSorting:function(k,g){g=g||false;var l=this.getView().byId("tileGrid");if(k=="tileType"){l.getBinding("items").sort([new sap.ui.model.Sorter("tileType",g,null)]);}else if(k=="title"){l.getBinding("items").sort([new sap.ui.model.Sorter("title",g,null)]);}else if(k=="subtitle"){l.getBinding("items").sort([new sap.ui.model.Sorter("description",g,null)]);}else if(k=="creation"){l.getBinding("items").sort([new sap.ui.model.Sorter("createdOn",g,null)]);}else if(k=="none"){l.getBinding("items").sort([]);}},setFiltering:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"HT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'HT')),"DT-CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CM')),"DT-CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CT')),"DT-AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-AT')),"DT-TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-TT'))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},setFilteringN:function(i){var f=[];var l=this.getView().byId("tileGrid");var a={"NT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'NT')),"CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CT')),"AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'AT')),"TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'TT')),"CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'CM')),"HT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'HT')),"DT-CM":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CM')),"DT-CT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-CT')),"DT-AT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-AT')),"DT-TT":(new sap.ui.model.Filter("tileType",sap.ui.model.FilterOperator.EQ,'DT-TT'))};f=this.getFilterArrayN(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},getFilterArrayN:function(a,f){var b=[];var c={},k,p;for(var i=0,l=a.length;i<l;i++){k=a[i].getDependents()[0].getText();p="tileType";c[p]=c[p]||[];c[p].push(f[k]);}for(var d in c){b.push(new sap.ui.model.Filter(c[d],false));}return b;},handleSortPress:function(){var t=this;this.sortOptionsDialog=this.sortOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),key:"title"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SUBTITLE"),key:"subtitle"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("CREATION_TIME"),key:"creation"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});this.sortOptionsDialog.open();},handleFilterPressN:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.SelectDialog({id:this.createId("filterOptionsDialog"),title:"Filter By",multiSelect:true,rememberSelections:true,items:[new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),dependents:[new sap.m.Label({text:"NT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),dependents:[new sap.m.Label({text:"CT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),dependents:[new sap.m.Label({text:"TT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),dependents:[new sap.m.Label({text:"AT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),dependents:[new sap.m.Label({text:"CM"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("HARVEY_BALL_TILE"),dependents:[new sap.m.Label({text:"HT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_TILE"),dependents:[new sap.m.Label({text:"DT-CT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_MM_TILE"),dependents:[new sap.m.Label({text:"DT-CM"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("DUAL_DEVIATION_TILE"),dependents:[new sap.m.Label({text:"DT-AT"})]}),new sap.m.StandardListItem({title:t.oApplicationFacade.getResourceBundle().getText("DUAL_TREND_TILE"),dependents:[new sap.m.Label({text:"DT-TT"})]})],confirm:function(e){var a="";var s=e.getParameter("selectedItems");t.setFilteringN(s);if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){var k=s[i].getDependents()[0].getText();f[k]=f[k]||"";f[k]+=(f[k])?(","):"";f[k]+=s[i].getTitle();}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?", ":"";a+=f[b];}}a=t.oApplicationFacade.getResourceBundle().getText("FILTERED_BY")+" : "+a;t.byId("filterToolbar").setVisible(true);t.byId("mptInfo").setText(a);}else{t.byId("mptInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});this.filterOptionsDialog.open();},handleFilterPress:function(){var t=this;this.filterOptionsDialog=this.filterOptionsDialog||new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("TILE_TYPE"),key:"tileType",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("NUMERIC_TILE"),key:"NT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_TILE"),key:"CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("TREND_TILE"),key:"TT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTUAL_VS_TARGET_TILE"),key:"AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("COMPARISON_MM_TILE"),key:"CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("HARVEY_BALL_TILE"),key:"HT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_TILE"),key:"DT-CT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_COMPARISON_MM_TILE"),key:"DT-CM"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_DEVIATION_TILE"),key:"DT-AT"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DUAL_TREND_TILE"),key:"DT-TT"})]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var f={};for(var i=0,l=s.length;i<l;i++){f[s[i].getParent().getKey()]=f[s[i].getParent().getKey()]||"";f[s[i].getParent().getKey()]+=(f[s[i].getParent().getKey()])?(","):"";f[s[i].getParent().getKey()]+=s[i].getText();}for(var b in f){if(f.hasOwnProperty(b)){a+=(a)?" ; ":"";a+=f[b];}}t.byId("filterToolbar").setVisible(true);t.byId("mptInfo").setText(a);}else{t.byId("mptInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});this.filterOptionsDialog.open();}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Generic')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Generic");sap.ui.core.Control.extend("sap.suite.ui.smartbusiness.tiles.Generic",{metadata:{properties:{evaluationId:"string",associationEvaluationId:{type:"string",defaultValue:null},header:"string",subheader:"string",mode:{type:"string",defaultValue:"RUNTIME"},size:{type:"string",defaultValue:"S"},dimension:{type:"string",defaultValue:null},frameType:{type:"string",defaultValue:"OneByOne"},contentOnly:{type:"boolean",defaultValue:false},kpiValueRequired:{type:"boolean",defaultValue:true},sapSystem:{type:"string",defaultValue:null},additionalFilters:{type:"object",defaultValue:{}},visible:{type:"boolean",defaultValue:true},click:{type:"boolean",defaultValue:true},onNavigation:{type:"function",defaultValue:null},tileConfiguration:{type:"object",defaultValue:null}},events:{navigation:{}},aggregations:{_tile:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}}});sap.suite.ui.smartbusiness.tiles.Generic.Mode={"RUNTIME":"RUNTIME","DUMMY":"DUMMY",};sap.suite.ui.smartbusiness.tiles.Generic.prototype._addSystemAliasToUri=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var p=sap.ushell.Container.getService("URLParsing");if(p){u=p.addSystemToServiceUrl(u,s);}}return u;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.init=function(){this._oScalingFactor={"0":"","3":"Kilo","6":"Million","9":"Billion","-9":"Nano","-6":"Micro","-3":"Milli"};this.EVALUATION_DATA=null;this.evaluationApi=null;this.THRESHOLD_MAPPING={"TA":{prop:'TARGET_VALUE',},"CL":{prop:'CRITICAL_LOW_VALUE'},"CH":{prop:'CRITICAL_HIGH_VALUE'},"WL":{prop:'WARNING_LOW_VALUE'},"WH":{prop:'WARNING_HIGH_VALUE'},"TC":{prop:'TREND_VALUE',},"RE":{prop:"REFERENCE_VALUE"}};for(var e in this.THRESHOLD_MAPPING){var p=this.THRESHOLD_MAPPING[e].prop;this[p]=null;}this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({}));};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering=function(){};sap.suite.ui.smartbusiness.tiles.Generic.prototype._initODataMetadata=function(){var s=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(s,this.evaluationApi.getEntitySet());var c=[];c.push(this.evaluationApi.getKpiMeasureName());if(this.getDimension()){c.push(this.getDimension());}this.LABEL_PROPERTY_MAPPING=p.getLabelMappingObject();this.TEXT_PROPERTY_MAPPING=p.getTextPropertyMappingObject();this.UOM_PROPERTY_MAPPING=p.getUnitPropertyMappingObject();};sap.suite.ui.smartbusiness.tiles.Generic.prototype.renderTile=function(){var a=this.getEvaluationId();if(this.isAssociatedKpi()){a=this.getAssociationEvaluationId();}this.setLoadingState();this.oData_Call_Ref_Evaluation_Details=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.getEvaluationById({id:a,cache:true,filters:true,thresholds:true,sapSystem:this.getSapSystem(),success:function(b){if(b.ID){this.EVALUATION_DATA=b;if(this.EVALUATION_DATA.hasOwnProperty("DECIMAL_PRECISION")&&(typeof this.EVALUATION_DATA.DECIMAL_PRECISION=="undefined")){this.EVALUATION_DATA.DECIMAL_PRECISION=-1;}this.evaluationApi=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(b);this.evaluationApi.parse_sapclient();this._initODataMetadata();this._fetchKpiValue(function(){if(!this.getVisible()){this.$().css("opacity","0.2");}else{this.$().show(1000);}if(this.getClick())this.$().off("click");else this.$().click(function(){return false;});this._initThresholdPopOver();try{this.doProcess();}catch(e){jQuery.sap.log.error("Error in doProcess() : "+e.message);this.setFailedState();}});}else{this.logError("Empty results for evaluation Id : "+a);}},error:function(e){this.logError(e);},context:this})};sap.suite.ui.smartbusiness.tiles.Generic.prototype._getOtherThresholdMeasures=function(){var t=this.EVALUATION_DATA.VALUES.results;var o={};if(this.evaluationApi.getThresholdValueType()=="MEASURE"||this.evaluationApi.getThresholdValueType()=="RELATIVE"){t.forEach(function(a){var m=a.COLUMN_NAME;if(m){var b=this.THRESHOLD_MAPPING[a.TYPE];if(b){o[b.prop]=m;}}},this);return o;}else{t.forEach(function(a){var b=this.THRESHOLD_MAPPING[a.TYPE];if(b){this[b.prop]=a.FIXED;}},this);return null;}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._getThresholdsValues=function(q,t){if(t){for(var e in t){this[e]=q[t[e]];}}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._fetchKpiValue=function(c){if(this.getKpiValueRequired()){var k=this.evaluationApi.getKpiMeasureName();var t=this._getOtherThresholdMeasures();var a=[k];if(t){a.push(this.evaluationApi.getKpiMeasureName());for(var e in t){a.push(t[e]);}}var u=this.UOM_PROPERTY_MAPPING[k];var b=this.getUrlFilters();var d=this.evaluationApi.getFilters()["results"];var q=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem()),entitySet:this.evaluationApi.getEntitySet(),measure:a,dimension:null,filter:this.getAllFilters()});var T=this;var f=this.getEvaluationId();if(this.isAssociatedKpi()){f=this.getAssociationEvaluationId();}this.Fetch_Kpi_Value_Success=function(h){if(h&&h.results.length&&h.results[0][k]){var r=h.results[0];T.KPI_VALUE=r[k];T.UOM="";if(u){T.UOM=r[u];}T._getThresholdsValues(r,t);sap.suite.ui.smartbusiness.lib.Util.cache.setKpiDetailsById(f,h);if(T.evaluationApi.getThresholdValueType()=="MEASURE"){var i,v=T.evaluationApi.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){T.WARNING_LOW_VALUE=r[v[i].COLUMN_NAME];}if(v[i].TYPE=="CL"){T.CRITICAL_LOW_VALUE=r[v[i].COLUMN_NAME];}if(v[i].TYPE=="CH"){T.CRITICAL_HIGH_VALUE=r[v[i].COLUMN_NAME];}if(v[i].TYPE=="WH"){T.WARNING_HIGH_VALUE=r[v[i].COLUMN_NAME];}}}else if(T.evaluationApi.getThresholdValueType()=="RELATIVE"){var i,j,v=T.evaluationApi.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="TA"){j=r[v[i].COLUMN_NAME];break;}}for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){T.WARNING_LOW_VALUE=Number(j)*v[i].FIXED/100;}if(v[i].TYPE=="CL"){T.CRITICAL_LOW_VALUE=Number(j)*v[i].FIXED/100;}if(v[i].TYPE=="CH"){T.CRITICAL_HIGH_VALUE=Number(j)*v[i].FIXED/100;}if(v[i].TYPE=="WH"){T.WARNING_HIGH_VALUE=Number(j)*v[i].FIXED/100;}}}if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f]){var x=sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f];delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f];x.resolve();}c.call(T);}else{T.setNoData();}};this.Fetch_Kpi_Value_Fail=function(h){if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f]){sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f].reject();}T.logError("Error Fetching Kpi Value : "+q.uri);};var g=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(f);if(g){this.Fetch_Kpi_Value_Success(g);}else if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f]){jQuery.when(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f]).then(function(){var h=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(f);T.Fetch_Kpi_Value_Success(h);},function(h){T.logError(h)});}else{sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[f]=jQuery.Deferred();this.OData_Call_Ref_Fetch_Kpi_Value=q.model.read(q.uri,null,null,true,this.Fetch_Kpi_Value_Success,this.Fetch_Kpi_Value_Fail);}}else{c.call(this,null);}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getAllFilters=function(){var e=this.evaluationApi.getFilters()["results"]||[];var u=this.getAdditionalFilters()||[];var t={};u.forEach(function(o){t[o.NAME]=true;});return u.concat(e.filter(function(o){return!t[o.NAME];}));return ret;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getUrlFilters=function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O);});}}return u;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onAfterRendering=function(){try{if(this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){this.renderTile();}else{this.doDummyProcess();}}catch(e){jQuery.sap.log.error(e);this.setFailedState();}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.numberOfLeadingZeros=function(n){n=String(n);var c=0;var d=n.indexOf('.');if(d==-1)return 0;if(Number(n.split('.')[0])!=0)return 0;var i=d+1;while(n[i++]=='0'){++c;}return c;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.formatValue=function(v,s,M){M=M||4;var u={3:"K",6:"M",9:"B",12:"T",0:""};u["-3"]="m";u["-6"]="u";u["-9"]="n";u["-12"]="t";u["-2"]="%";var t,p,a;t=Number(v).toPrecision(M);var z=this.numberOfLeadingZeros(t);if(z>0&&s<0){p=t*Math.pow(10,z+M);a=-(z+M);}else{p=Number(t.split("e")[0]);a=Number(t.split("e")[1])||0;}if(!v&&v!=0)return{value:"",unitPrefix:""};if(s>=0){if(a%3!=0){if(a%3==2){if(a+1==s){a=a+1;p=p/10;}else{a=a-2;p=p*100;}}else{if(a+2==s){a=a+2;p=p/100;}else{a--;p=p*10;}}}else if(a==15){p=p*1000;a=12;}}else{if(s=="-2"){var x=this.formatValue((v*100),0);}else if(a>=0&&v<10&&s=="-3"){p=v*Math.pow(10,3);a=-3;}else if(a>=0)return this.formatValue(v,0);else{a=Math.abs(a);s=Math.abs(s);if(s>a){p=p/(Math.pow(10,a%3));a=a-(a%3);}else{var d=a-s;p=p/(Math.pow(10,d));a=a-d;}a=0-a;}}p+="";if(s=="-2"){var b=(x.unitPrefix=="")?Number(x.value+"").toFixed(4-(x.value+"").indexOf('.')):Number(x.value+"").toFixed(3-(x.value+"").indexOf('.'));return{value:Number(b),unitPrefix:(x.unitPrefix)+u[-2]};}p=Number(p).toFixed(4-p.indexOf('.'));return{value:Number(p),unitPrefix:u[a]};};sap.suite.ui.smartbusiness.tiles.Generic.prototype.formatOdataObjectToString=function(v){if(v&&v.constructor==Object){if(v.__edmType=="Edm.Time"){var m=v.ms;var s=Math.floor((m/1000)%60);var a=Math.floor((m/60000)%60);var h=Math.floor((m/3600000)%24);return h+"H"+a+"M"+s+"S";}}return v;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getScalingFactorMapping=function(){return this._oScalingFactor;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.isAssociatedKpi=function(){if(this.getAssociationEvaluationId()&&(this.getAssociationEvaluationId()!==this.getEvaluationId())){return true;}return false;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getTileControl=function(){return this.getAggregation("_tile");};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setFailedState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Failed);}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setLoadingState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Loading);}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setDoneState=function(){if(this.getTileControl().setState){this.getTileControl().setState(sap.suite.ui.commons.LoadState.Loaded);}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.logError=function(e){jQuery.sap.log.error(e);this.setFailedState();};sap.suite.ui.smartbusiness.tiles.Generic.prototype.setNoData=function(){this.getModel().setProperty('/footerNum',"No data available");this.getModel().setProperty('/footerComp',"No data available");this.getModel().setProperty('/header',this.EVALUATION_DATA.INDICATOR_TITLE);this.getModel().setProperty('/subheader',this.EVALUATION_DATA.TITLE);this.setDoneState();};sap.suite.ui.smartbusiness.tiles.Generic.prototype.abortODataCalls=function(){var _=function(r){if(r){r.abort();}};_(this.comparisionChartODataRef);_(this.OData_Call_Ref_Fetch_Kpi_Value);_(this.areaChartODataRef);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.onExit=function(){this.abortODataCalls();};sap.suite.ui.smartbusiness.tiles.Generic.prototype.isACurrencyMeasure=function(m){jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Util");var u=this.EVALUATION_DATA.ODATA_URL;var e=this.EVALUATION_DATA.ODATA_ENTITYSET;return sap.suite.ui.smartbusiness.lib.Util.odata.getFormattingMetadata(u,e,m)._hasCurrency;};sap.suite.ui.smartbusiness.tiles.Generic.prototype.libFormat=function(n,i,c,o){i=i||false;c=c||null;o=o||false;var s=this.EVALUATION_DATA.SCALING;if(o){s=0;}jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Formatter");return sap.suite.ui.smartbusiness.lib.Formatter.getLocaleFormattedValue(Number(n),s,this.EVALUATION_DATA.DECIMAL_PRECISION,i,c);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForNumericTile=function(){var d={subheader:"Expenses by Region",header:"Comparative Annual Totals",footerNum:"",footerComp:"",scale:"M",unit:"EUR",value:"10.34",size:"Auto",color:"Good",};return this._cleanUpDummyData(d);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForBulletTile=function(){var d={subheader:"Lorem Epsom",header:"Lorem Epsom",footerNum:"",footerComp:"Compare across regions",frameType:"OneByOne",scale:"M",actual:{value:120,color:sap.suite.ui.commons.InfoTileValueColor.Good},targetValue:100,thresholds:[{value:0,color:sap.suite.ui.commons.InfoTileValueColor.Error},{value:50,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:150,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:200,color:sap.suite.ui.commons.InfoTileValueColor.Error}],showActualValue:true,showTargetValue:true};return this._cleanUpDummyData(d);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForComparisonTile=function(){var d={subheader:"Expenses By Region",header:"Comparative Anual Totals",footerNum:"",footerComp:"Compare across regions",scale:"MM",unit:"EUR",value:8888,data:[{title:"Americas",value:10},{title:"EMEA",value:50},{title:"APAC",value:-20}],};return this._cleanUpDummyData(d);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForMeasureComparisonTile=function(){var d={subheader:"Lorem Epsom",header:"Lorem Epsom",footerNum:"",footerComp:"Compare across regions",scale:"M",unit:"EUR",value:8888,data:[{title:"Measure 1",value:50,color:"Good"},{title:"Measure 2",value:-20,color:"Error"},{title:"Measure 3",value:10,color:"Critical"}],};return this._cleanUpDummyData(d);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.getDummyDataForAreaChartTile=function(){var d={subheader:"Expenses By Region",header:"Comparative Anual Totals",footerNum:"",footerComp:"Compare across regions",scale:"MM",unit:"EUR",value:8888,size:"S",frameType:"OneByOne",state:sap.suite.ui.commons.LoadState.Loaded,title:"US Profit Margin",footer:"Current Quarter",description:"Maximum deviation",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70},]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}};return this._cleanUpDummyData(d);};sap.suite.ui.smartbusiness.tiles.Generic.prototype._cleanUpDummyData=function(d){d.header=this.getHeader()||"Lorem Epsom";d.subheader=this.getSubheader()||"Lorem Epsom";return d;};sap.suite.ui.smartbusiness.tiles.GenericRenderer={};sap.suite.ui.smartbusiness.tiles.GenericRenderer.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("drilldownKpiTile");r.writeClasses();r.write(">");r.renderControl(c.getTileControl());r.write("</div>");};sap.suite.ui.smartbusiness.tiles.Generic.prototype._closePopover=function(){if(this._popOver.isOpen()){this._popOver.close();}};sap.suite.ui.smartbusiness.tiles.Generic.prototype._initThresholdPopOver=function(){var m=new sap.ui.model.json.JSONModel(a);var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:sap.ui.core.ValueState.None}));t.setModel(m);var b={};b.targetVal=this.TARGET_VALUE;b.critLowVal=this.CRITICAL_LOW_VALUE;b.warnLowVal=this.WARNING_LOW_VALUE;b.critHighVal=this.CRITICAL_HIGH_VALUE;b.warnHighVal=this.WARNING_HIGH_VALUE;if(this.evaluationApi.getScaling()==-2){for(var e in b){if(b[e]){b[e]=(b[e]*100)+" %";}}}if(this.evaluationApi.isMaximizingKpi()){if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}else if(this.evaluationApi.isMinimizingKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});}else if(this.evaluationApi.isTargetKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.getModel("i18n").getProperty("THRESHOLD_LABEL")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(this._closePopover,this)})]});this._popOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var s=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());s.addContent(this._popOver,true);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.showThresholds=function(){this._popOver.openBy(this);};sap.suite.ui.smartbusiness.tiles.Generic.prototype.tilePressed=function(){if(!this.isAssociatedKpi()&&this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){if(this.getTileType()=="NT"||this.getTileType()=="AT"){this.showThresholds();}else if(this.getTileType()=="TT"){this.showTTPopup&&this.showTTPopup();}else if(this.getTileType()=="CT"){this.showCTPopup&&this.showCTPopup();}else if(this.getTileType()=="CM"){this.showCMPopup&&this.showCMPopup();}}else if(this.isAssociatedKpi()&&this.getMode()==sap.suite.ui.smartbusiness.tiles.Generic.Mode.RUNTIME){var s=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);s["evaluationId"]=[];s["chipId"]=[];var b=this.getAssociationEvaluationId();s.evaluationId.push(b);jQuery.sap.require("sap.suite.ui.smartbusiness.Configuration");s.chipId.push(sap.suite.ui.smartbusiness.Configuration.Constants.SMARTBUSINESS_NULL_VALUE);sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(a,false);sap.suite.ui.smartbusiness.drilldown.lib.Hash.setStartupParameters(s,false);var c=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.getConfigurationFromCache(b);try{if(c){configurationApi=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.parse(b,c);if(configurationApi){var d=configurationApi.getDefaultView();if(d){var v=d.getId();if(v){this.fireNavigation();sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateApplicationParameters({"viewId":[v]},false);}}}}}catch(e){}this.fireNavigation();sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateHash();}};sap.suite.ui.smartbusiness.tiles.Generic.prototype.hasSomeValue=function(){var f=true;if(arguments.length){for(var i=0,l=arguments.length;i<l;i++){if(arguments[i]||arguments[i]=="0"){}else{f=false;break;}}}else{f=false;}return f;};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.HarveyBall')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.HarveyBall");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.HarveyBall",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:true},tileType:{type:"string",defaultValue:"CM"},size:{type:"string",defaultValue:"S"},}},renderer:{}});sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this._bShowUOM=false;this._bUseFormattedVDMValue=false;this._bShowKpiMeasureUOMInFooter=true;this._bHasKpiMeasure=null;this._oDataRequestReference={};this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({size:"S",content:new sap.suite.ui.commons.HarveyBallMicroChart({total:"{/totalValue}",size:"S",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:"{/fractionValue}",color:"{/color}"})]})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({size:"S",content:new sap.suite.ui.commons.HarveyBallMicroChart({total:"{/totalValue}",size:"S",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:"{/fractionValue}",color:"{/color}"})]})}));}};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype._getTrendColor=function(){var r=null;var w=window.parseFloat(this.WARNING_LOW_VALUE);var c=window.parseFloat(this.CRITICAL_LOW_VALUE);var a=window.parseFloat(this.CRITICAL_HIGH_VALUE);var b=window.parseFloat(this.WARNING_HIGH_VALUE);var i=this.EVALUATION_DATA.GOAL_TYPE;if(this.evaluationApi.isMinimizingKpi()){if(this.hasSomeValue(a,b)){if(this.KPI_VALUE<b){r=sap.suite.ui.commons.InfoTileValueColor.Good;}else if(this.KPI_VALUE<=a){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Error;}}}else if(this.evaluationApi.isMaximizingKpi()){if(this.hasSomeValue(c,w)){if(this.KPI_VALUE<c){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if(this.KPI_VALUE<=w){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}else{if(this.hasSomeValue(w,b,c,a)){if(this.KPI_VALUE<c||this.KPI_VALUE>a){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if((this.KPI_VALUE>=c&&this.KPI_VALUE<=w)||(this.KPI_VALUE>=b&&this.KPI_VALUE<=a)){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}return r;};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.doProcess=function(){var t=this;this._fetchDataForHarveyBallTile(function(d){var i=this.isACurrencyMeasure(this.getVariable("totalMeasure"));var a=this.isACurrencyMeasure(this.getVariable("fractionMeasure"));var j={totalValue:Number(d.totalValue),totalValueLabel:this.libFormat(Number(d.totalValue),i,d.totalValueUnit)+" "+d.totalValueUnit,fractionValue:Number(d.fractionValue),fractionValueLabel:this.libFormat(Number(d.fractionValue),a,d.fractionValueUnit)+" "+d.fractionValueUnit};if(t.getTileConfiguration().IS_HARVEY_FRACTION_KPIMEASURE){j.color=t._getTrendColor();}if(true||t.isAssociatedKpi()){j.subheader=this.evaluationApi.getTitle();j.header=this.evaluationApi.getKpiName();}if(this._bShowKpiMeasureUOMInFooter&&this._bHasKpiMeasure){}t.jsonModel.setData(j);t.setDoneState();t.initPopup();},this.logError);};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype._getFormattedHarveyFilters=function(h){var t=[];if(h&&h[0]&&h[0].VALUE_1){h[0].VALUE_1.forEach(function(c){harveyFilters.push({NAME:h[0].NAME,TYPE:"FI",VALUE_1:[c],OPERATOR:tileConfiguration.HARVEY_FILTERS[0].OPERATOR,VALUE_2:[]})})}if(tileConfiguration.HARVEY_FILTERS[0]&&tileConfiguration.HARVEY_FILTERS[0].VALUE_1){}};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype._fetchDataForHarveyBallTile=function(s,e){function m(M,u,b,c,S,E){var d=t.UOM_PROPERTY_MAPPING[b];var D=M.read(u,null,null,true,function(f){t.deregisterODataRequest(c);if(f&&f.results&&f.results.length){k[c]=f.results[0][b];k[c+"Unit"]=f.results[0][d]||"";S.call(t,k);}else{E.call(t,"no Response from QueryServiceUri");}},function(f){t.deregisterODataRequest(c);if(f&&f.response){jQuery.sap.log.error(f.message+" : "+f.request.requestUri);}});t.registerODataRequest(c,D);}var t=this;var a=this.getTileConfiguration();this._bHasKpiMeasure=true;var q;var k={};var h=[];var v;var p={serviceUri:this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem()),entitySet:this.evaluationApi.getEntitySet(),measure:this.evaluationApi.getKpiMeasureName(),filter:this.getAllFilters()};if(a.IS_HARVEY_FRACTION_KPIMEASURE){p.measure=a.HARVEY_TOTAL_MEASURE;k.fractionValue=this.KPI_VALUE;k.fractionValueUnit=this.UOM;v="totalValue";}else{a.HARVEY_FILTERS=a.HARVEY_FILTERS||[];k.totalValue=this.KPI_VALUE;k.totalValueUnit=this.UOM;p.filter=p.filter.concat(h);v="fractionValue";}this.setVariable('fractionMeasure',this.evaluationApi.getKpiMeasureName());this.setVariable('totalMeasure',p.measure);q=sap.suite.ui.smartbusiness.lib.Util.odata.getUri(p);m(q.model,q.uri,p.measure,v,s,e);};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyData());};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.getDummyData=function(){return this._cleanUpDummyData({subheader:"Expenses by Region",header:"Comparative Annual Totals",footerNum:"",footerComp:"",scale:"M",unit:"EUR",fractionValue:34,totalValue:100,size:"S",color:"Good",});};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.showPopup=function(){this._popover.openBy(this);};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.initPopup=function(){var s=this;var m=new sap.ui.model.json.JSONModel();var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});var g=function(d){return{"Error":sap.ui.core.ValueState.Error,"Neutral":sap.ui.core.ValueState.None,"Good":sap.ui.core.ValueState.Success,"Warning":sap.ui.core.ValueState.Warning,"Critical":sap.ui.core.ValueState.Warning}[d]||sap.ui.core.ValueState.None;};t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:{path:"color",formatter:g}}));t.setModel(m);var b=this.jsonModel.getData().data;if(this.evaluationApi.getScaling()==-2){for(var e in b){if(b[e]){b[e].value=(b[e].value*100)+" %";}}}for(var j in b){a.THRESHOLDS.push({name:b[j].title,value:this.VALUE_FORMATTER.format(b[j].value),color:b[j].color});}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.getModel("i18n").getProperty("DETAILS")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){if(this._popover.isOpen()){this._popover.close();}},this)})]});this._popover=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var S=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());S.addContent(this._popover,true);};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.registerODataRequest=function(k,r){this._oDataRequestReference[k]=r;};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.deregisterODataRequest=function(k){delete this._oDataRequestReference[k];};sap.suite.ui.smartbusiness.tiles.HarveyBall.prototype.abortODataCalls=function(){for(var e in this._oDataRequestReference){this._oDataRequestReference[e].abort();this.deregisterODataRequest(e);}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.MeasureComparison')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.MeasureComparison");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.MeasureComparison",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"CM"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this._bShowUOM=false;this._bUseFormattedVDMValue=false;this._bShowKpiMeasureUOMInFooter=true;this._bHasKpiMeasure=null;this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}));}};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doProcess=function(){var t=this;this._fetchDataForMeasureComparisonTile(function(c){var j={};this._processedComparisionData=this._processMeasureComparisionData(c);j.data=this._processedComparisionData;if(true||t.isAssociatedKpi()){j.subheader=this.evaluationApi.getTitle();j.header=this.evaluationApi.getKpiName();}if(this._bShowKpiMeasureUOMInFooter&&this._bHasKpiMeasure){var k=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];if(k){j.unit=c[k];}}t.jsonModel.setData(j);t.setDoneState();t.initCMPopup();},this.logError);};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._fetchDataForMeasureComparisonTile=function(s,e){var t=this;var _=function(a){var m=[];if(a&&a.MEASURES&&a.MEASURES.length){var b=a.MEASURES;for(var i=0,l=b.length;i<l;i++){m.push(b[i].name);}}if(m.length){return m;}else{throw new Error("No Measures Defined for Measure Comparision Tile");}};function c(d,a){var b=false;if(d&&d.results&&d.results.length){for(var i=0,l=a.length;i<l&&!b;i++){b=d.results[0][a[i]]!==null;}}return b;}var p={};p.serviceUri=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());p.entitySet=this.evaluationApi.getEntitySet();p.measure=_(this.getTileConfiguration());if(p.measure.indexOf(this.evaluationApi.getKpiMeasureName())>-1){this._bHasKpiMeasure=true;}p.filter=this.getAllFilters();var f=sap.suite.ui.smartbusiness.lib.Util.odata.getUri(p);this.comparisionChartODataRef=f.model.read(f.uri,null,null,true,function(d){if(c(d,p.measure)){s.call(t,d.results[0]);}else{t.setNoData();}},function(a){if(a&&a.response){jQuery.sap.log.error(a.message+" : "+a.request.requestUri);}});};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype._processMeasureComparisionData=function(r){var p=[],f,V,U,m,a,i,b,o;b=this.getTileConfiguration().MEASURES;for(i=0,l=b.length;i<l;i++){o={};a=b[i].name;m=this.LABEL_PROPERTY_MAPPING[a];o["title"]=m;U=this.UOM_PROPERTY_MAPPING[a];V=this.TEXT_PROPERTY_MAPPING[a];var c=Number(r[a]);if(this._bUseFormattedVDMValue&&V&&(V!=a)){f=r[V];}else{var d=this.isACurrencyMeasure(a);var u=null;var e=false;var k=this.evaluationApi.getKpiMeasureName();var t=this._getOtherThresholdMeasures();if(a===k){e=true;}else if(t){for(var g in t){if(t[g]===a){e=true;}}}if(d){var h=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];if(h){u=r[h];}}f=this.libFormat(c,d,u);if(this.evaluationApi.getScaling()==-2){if(e){f=this.libFormat(c,d,null,true);}else{f=this.libFormat(c,d);}}}o.value=Number(r[a]);o.displayValue=""+f;if(this._bShowUOM&&U){o.displayValue+=" "+r[U];}o.color=b[i].color;p.push(o);}return p;};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForMeasureComparisonTile());};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.showCMPopup=function(){this._CTpopOver.openBy(this);};sap.suite.ui.smartbusiness.tiles.MeasureComparison.prototype.initCMPopup=function(){var s=this;var m=new sap.ui.model.json.JSONModel();var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});var g=function(d){return{"Error":sap.ui.core.ValueState.Error,"Neutral":sap.ui.core.ValueState.None,"Good":sap.ui.core.ValueState.Success,"Warning":sap.ui.core.ValueState.Warning,"Critical":sap.ui.core.ValueState.Warning}[d]||sap.ui.core.ValueState.None;};t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:{path:"color",formatter:g}}));t.setModel(m);var b=this.jsonModel.getData().data;if(this.evaluationApi.getScaling()==-2){for(var e in b){if(b[e]){b[e].value=(b[e].value*100)+" %";}}}for(var j in b){a.THRESHOLDS.push({name:b[j].title,value:this.VALUE_FORMATTER.format(b[j].value),color:b[j].color});}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.getModel("i18n").getProperty("DETAILS")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){if(this._CTpopOver.isOpen()){this._CTpopOver.close();}},this)})]});this._CTpopOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var S=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());S.addContent(this._CTpopOver,true);};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Numeric')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Numeric");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Numeric",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:true},tileType:{type:"string",defaultValue:"NT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Numeric.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.NumericContent({value:"{/value}",scale:"{/scale}",valueColor:"{/valueColor}",size:this.getSize(),state:"{/state}",formatterValue:true,truncateValueTo:5,nullifyValue:false})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.NumericContent({value:"{/value}",scale:"{/scale}",valueColor:"{/valueColor}",size:this.getSize(),state:"{/state}",formatterValue:true,truncateValueTo:5,nullifyValue:false})}));}};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.switchOffFormatting=function(){try{this.getTileControl().getTileContent()[0].getContent().setFormatterValue(false);}catch(e){}};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.doProcess=function(){var n={};n.valueColor=this._applyTrendColor();n.indicator=this._applyTrendIndicator();n.frameType=this.getFrameType();n.unit=this.UOM;var s="";var c=this.KPI_VALUE;if(this.EVALUATION_DATA.SCALING==-2){n.formatterValue=false;}var i=this.isACurrencyMeasure(this.EVALUATION_DATA.COLUMN_NAME);var f=this.libFormat(c,i,this.UOM);if(this.EVALUATION_DATA.SCALING==-2){n.scale="%";this.switchOffFormatting();}if(f){n.value=f.toString();}else{n.value="0";}if(true||this.isAssociatedKpi()){n.header=this.EVALUATION_DATA.INDICATOR_TITLE;n.subheader=this.EVALUATION_DATA.TITLE;}this.jsonModel.setData(n);this.jsonModel.updateBindings();this.setDoneState();};sap.suite.ui.smartbusiness.tiles.Numeric.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForNumericTile());};sap.suite.ui.smartbusiness.tiles.Numeric.prototype._applyTrendColor=function(){var r=null;var w=window.parseFloat(this.WARNING_LOW_VALUE);var c=window.parseFloat(this.CRITICAL_LOW_VALUE);var a=window.parseFloat(this.CRITICAL_HIGH_VALUE);var b=window.parseFloat(this.WARNING_HIGH_VALUE);var i=this.EVALUATION_DATA.GOAL_TYPE;if(this.evaluationApi.isMinimizingKpi()){if(this.hasSomeValue(a,b)){if(this.KPI_VALUE<b){r=sap.suite.ui.commons.InfoTileValueColor.Good;}else if(this.KPI_VALUE<=a){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Error;}}}else if(this.evaluationApi.isMaximizingKpi()){if(this.hasSomeValue(c,w)){if(this.KPI_VALUE<c){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if(this.KPI_VALUE<=w){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}else{if(this.hasSomeValue(w,b,c,a)){if(this.KPI_VALUE<c||this.KPI_VALUE>a){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if((this.KPI_VALUE>=c&&this.KPI_VALUE<=w)||(this.KPI_VALUE>=b&&this.KPI_VALUE<=a)){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}return r;};sap.suite.ui.smartbusiness.tiles.Numeric.prototype._applyTrendIndicator=function(){var t=sap.suite.ui.commons.DeviationIndicator.None;if(this.TREND_VALUE||this.TREND_VALUE=="0"){if(this.TREND_VALUE>this.KPI_VALUE){t=sap.suite.ui.commons.DeviationIndicator.Down;}else if(this.TREND_VALUE<this.KPI_VALUE){t=sap.suite.ui.commons.DeviationIndicator.Up;}}return t;}};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.Configuration");(function(){var R,L,p,a,_,b;var c,d,f;a={"abap":"adapter.abap","hana":"adapter.hana"};R="sap.suite.ui.smartbusiness";L=R+".lib";try{var P=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();if(P){if(P.sb_metadata){c=P.sb_metadata[0];}if(P.sb_navigation){d=P.sb_navigation[0];}if(P.sb_catalog){f=P.sb_catalog[0];}}}catch(e){}finally{c=c||jQuery.sap.getUriParameters().get("sb_metadata")||"hana";d=d||jQuery.sap.getUriParameters().get("sb_navigation")||"abap";f=f||jQuery.sap.getUriParameters().get("sb_catalog")||"hana";}var C={getLibraryModulePath:function(){return L;},getMetadataPath:function(){return R+"."+a[c];},getNavigationServicePath:function(){return R+"."+a[d];},getCatalogServicePath:function(){return R+"."+a[f];},isMetadataFromABAP:function(){return c.toUpperCase()=="ABAP"},getMetadataServicePlatfrom:function(){return c;},getNavigationServicePlatform:function(){return d;},getCatalogServicePlatform:function(){return f;}};C.Constants={TileType:{"NT":"NT","CT":"CT","TT":"TT","AT":"AT","CM":"CM","DT-AT":"DT-AT","DT-CT":"DT-CT","DT-TT":"DT-TT","DT-CM":"DT-CM","HT":"HT"},ChipUrl:{"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/ComparisionTileChip.xml","HT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorHarveyBall/HarveyBallTileChip.xml"},Platform:{"ABAP":"abap","HANA":"hana","SOH":"soh","MODELS":"modelS","IOT":"iot"},SMARTBUSINESS_NULL_VALUE:"sap_smartbusiness_null"};sap.suite.ui.smartbusiness.Configuration=C;})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.association.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.association.view.S2",{onInit:function(){var t=this;this.oApplicationFacade.masterListControllerRef=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("list"),hideElement:"list",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");t.oApplicationFacade.getODataModel().setSizeLimit(100000);t.selectedGroupItemKey="workspace";t.selectedGroupItemIndex=0;t.lastSavedIndex=0;t.lastGroupingOption=new sap.ui.model.Sorter("MANUAL_ENTRY",true,function(c){var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}});t.lastSortingOrder=new sap.ui.model.Sorter("CHANGED_ON",true,null);if(!(t.oApplicationFacade.currentLogonHanaUser)){var a=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var b=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);};this.metadataRef.getSessionUser({async:true,success:a,error:b,model:this.oApplicationFacade.getODataModel()});}this.byId("list").getBinding("items").filter(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVOURITE"),key:"favorite"}),]})],confirm:function(e){t.setFiltering(e.getParameter("filterItems"));}});return f;},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_CHANGE_DATE"),key:"changedate"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NAME"),key:"name"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_ID"),key:"id"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});s.setSelectedSortItem("changedate");s.setSortDescending(true);return s;},createGroupOptions:function(){var t=this;var j={groupItems:[{text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace",index:0},{text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type",index:1},{text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status",index:2},{text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner",index:3},{text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none",index:4}]};var m=new sap.ui.model.json.JSONModel(j);var g=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("GROUP_BY"),id:this.createId("groupOptionsDialog"),content:[new sap.m.List({items:{path:"/groupItems",template:new sap.m.ObjectListItem({type:"Active",title:"{text}"})},itemPress:function(e){e.getParameter("listItem").setSelected(true);t.selectedGroupItemKey=e.getParameter("listItem").getBindingContext().getProperty("key");t.selectedGroupItemIndex=e.getParameter("listItem").getBindingContext().getProperty("index");if(t.selectedGroupItemKey=="workspace"){t.setGrouping(t.selectedGroupItemKey,true);}else{t.setGrouping(t.selectedGroupItemKey,false);}t.lastSavedIndex=t.selectedGroupItemIndex;this.getParent().close();}})],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(e){t.selectedGroupItemIndex=t.lastSavedIndex;this.getParent().close();}})});g.setModel(m);return g;},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",onBack:function(){window.history.back();},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open();}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open();}},oGroupOptions:{onGroupPressed:function(e){if(t.byId("groupOptionsDialog")){t.byId("groupOptionsDialog").destroy();}t.getView().groupOptionDialog=t.createGroupOptions();t.getView().groupOptionDialog.open();t.byId("groupOptionsDialog").getContent()[0].getItems()[t.selectedGroupItemIndex].setSelected(true);}}};},formatTitle:function(t){return(t||"");},formatAssociationCount:function(s,t){if(s==null&&t==null){return 0;}if(s==null){return parseInt(t);}if(t==null){return parseInt(s);}return(parseInt(s)+parseInt(t));},formatID:function(i,t){if(t=="KPI"){return(this.oApplicationFacade.getResourceBundle().getText(t,i));}else{return(this.oApplicationFacade.getResourceBundle().getText(t)+": "+i);}},setVisibility:function(){return sap.suite.ui.smartbusiness.lib.AppSetting.setVisibilty();},formatOwnerName:function(o){return(this.oApplicationFacade.getResourceBundle().getText("ADDED_BY",o));},formatState:function(s){return(s?"ACTIVE":"DRAFT");},formatGroupName:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=this.getView().byId("list");var a;if(k=="type"){a=new sap.ui.model.Sorter("TYPE",g,function(c){return{key:c.getProperty("TYPE"),text:(c.getProperty("TYPE")+"S")}});}else if(k=="status"){a=new sap.ui.model.Sorter("IS_ACTIVE",g,function(c){return{key:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"):t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),text:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("ACTIVE_KPI_OPI"):t.oApplicationFacade.getResourceBundle().getText("DRAFT_KPI_OPI"),}});}else if(k=="owner"){a=new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var b="";switch(o){case null:b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:b=o;}return{key:b,text:b}});}else if(k=="workspace"){a=new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var b="";switch(i){case 1:b=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:b=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:b=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:b,text:b}});}else if(k=="none"){a=null;}if(t.lastSortingOrder&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder],true);}else{l.getBinding("items").sort([t.lastSortingOrder]);}this.lastGroupingOption=a;},setFiltering:function(i){var t=this;var f=[];var l=this.getView().byId("list");var a={"drafts":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,0)),"activated":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1)),"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var s;if(k=="changedate"){s=new sap.ui.model.Sorter("CHANGED_ON",g,null);}else if(k=="type"){s=new sap.ui.model.Sorter("TYPE",g,null);}else if(k=="name"){s=new sap.ui.model.Sorter("TITLE",g,null);}else if(k=="id"){s=new sap.ui.model.Sorter("ID",g,null);}if(t.lastGroupingOption){l.getBinding("items").sort([t.lastGroupingOption,s],true);}else{l.getBinding("items").sort([s]);}this.lastSortingOrder=s;},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.ui.smartbusiness.lib.Util.utils.backToHome();}},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,true);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.authorization.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.authorization.view.S2",{onInit:function(){var t=this;this.oApplicationFacade.masterListControllerRef=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("list"),hideElement:"list",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");t.selectedGroupItemKey="workspace";t.selectedGroupItemIndex=0;t.lastSavedIndex=0;t.oApplicationFacade.getODataModel().setSizeLimit(100000);t.lastGroupingOption=new sap.ui.model.Sorter("MANUAL_ENTRY",true,function(c){var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}});t.lastSortingOrder={indicatorTextOrder:null,order:new sap.ui.model.Sorter("CHANGED_ON",true,null)};if(!(t.oApplicationFacade.currentLogonHanaUser)){this.oApplicationFacade.getODataModel().read("/SESSION_USER",null,null,true,function(d){t.oApplicationFacade.currentLogonHanaUser=(d.results&&d.results.length)?d.results[0].LOGON_USER:null;},function(e){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body);});}this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("IS_ACTIVE","EQ",1)]);},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVORITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText();}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c];}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a);}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});return f;},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_CHANGE_DATE"),key:"changedate"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NAME"),key:"name"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_ID"),key:"id"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});s.setSelectedSortItem("changedate");s.setSortDescending(true);return s;},createGroupOptions:function(){var t=this;var j={groupItems:[{text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace",index:0},{text:t.oApplicationFacade.getResourceBundle().getText("BY_INDICATOR"),key:"indicator",index:1},{text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner",index:2},{text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none",index:3},]};var m=new sap.ui.model.json.JSONModel(j);var g=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("GROUP_BY"),id:this.createId("groupOptionsDialog"),content:[new sap.m.List({items:{path:"/groupItems",template:new sap.m.ObjectListItem({type:"Active",title:"{text}"})},itemPress:function(e){e.getParameter("listItem").setSelected(true);t.selectedGroupItemKey=e.getParameter("listItem").getBindingContext().getProperty("key");t.selectedGroupItemIndex=e.getParameter("listItem").getBindingContext().getProperty("index");if(t.selectedGroupItemKey=="workspace"){t.setGrouping(t.selectedGroupItemKey,true);}else{t.setGrouping(t.selectedGroupItemKey,false);}t.lastSavedIndex=t.selectedGroupItemIndex;this.getParent().close();}})],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(e){t.selectedGroupItemIndex=t.lastSavedIndex;this.getParent().close();}})});g.setModel(m);return g;},getHeaderFooterOptions:function(){var t=this;return{sI18NMasterTitle:"MASTER_TITLE",onBack:function(){window.history.back();},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open();}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open();}},oGroupOptions:{onGroupPressed:function(e){if(t.byId("groupOptionsDialog")){t.byId("groupOptionsDialog").destroy();}t.getView().groupOptionDialog=t.createGroupOptions();t.getView().groupOptionDialog.open();t.byId("groupOptionsDialog").getContent()[0].getItems()[t.selectedGroupItemIndex].setSelected(true);}},};},formatEvaluationHeader:function(i,e){var t=this;if(i==null&&e!=null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+"- "+e);}else if(i!=null&&e==null){return(i+" -"+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else if(i==null&&e==null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+" - "+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else{return(i+" - "+e);}},formatIndicatorId:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var a;if(k=="workspace"){a=new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var b="";switch(i){case 1:b=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:b=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:b=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:b,text:b}})}else if(k=="indicator"){a=new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}});}else if(k=="owner"){a=new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var b="";switch(o){case null:b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:b=o;}return{key:b,text:b}});}else if(k=="none"){a=null;}if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order,t.lastSortingOrder.indicatorTextOrder],true);}else if(!t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order],true);}else{if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order){l.getBinding("items").sort([t.lastSortingOrder.indicatorTextOrder,t.lastSortingOrder.order]);}else{l.getBinding("items").sort([t.lastSortingOrder.order]);}}this.lastGroupingOption=a;},setFiltering:function(i){var t=this;var f=[];var l=t.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var s,a;if(k=="changedate"){s=new sap.ui.model.Sorter("CHANGED_ON",g,null);}else if(k=="name"){s=new sap.ui.model.Sorter("TITLE",g,null);a=new sap.ui.model.Sorter("INDICATOR_TITLE",g,null);}else if(k=="id"){s=new sap.ui.model.Sorter("ID",g,null);}if(t.lastGroupingOption){if(a){l.getBinding("items").sort([t.lastGroupingOption,a,s],true);}else{l.getBinding("items").sort([t.lastGroupingOption,s],true);}}else{if(a){l.getBinding("items").sort([a,s]);}else{l.getBinding("items").sort([s]);}}this.lastSortingOrder={indicatorTextOrder:a,order:s};},applySearchPatternToListItem:function(i,s){return sap.suite.ui.smartbusiness.lib.Util.utils.applySearchPatternToListItem.apply(this,arguments);},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,true);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');jQuery.sap.require('sap.ui.vbm.AnalyticMap');jQuery.sap.require('sap.ui.core.format.NumberFormat');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView",{onInit:function(){var t=this;this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.CDS="cds";var v=jQuery.sap.getUriParameters().get("viewmode");v=v?v.toUpperCase():null;if(v===this.CDS.toUpperCase()){this.isCDS=true;}this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.COLUMN_LABEL_MAPPING={};this.measureDimensionList=this.byId(sap.ui.core.Fragment.createId('measureDimensionsList','measureDimensionsList'));this._oDimensionList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);this._oMeasureList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);try{if(sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog")){sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog").destroy();}if(sap.ui.core.Fragment.byId("thresholdDialog","dialogRef")){sap.ui.core.Fragment.byId("thresholdDialog","dialogRef").destroy();}if(sap.ui.core.Fragment.byId("editDialog","editDialog")){sap.ui.core.Fragment.byId("editDialog","editDialog").destroy();}if(sap.ui.core.Fragment.byId("editChartDialog","editChartDialog")){sap.ui.core.Fragment.byId("editChartDialog","editChartDialog").destroy();}if(sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig")){sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig").destroy();}if(sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog")){sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog").destroy();}if(sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog")){sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog").destroy();}if(sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig")){sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig").getParent().destroy();}if(sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethSettingsDialog")){sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethSettingsDialog").destroy();}}catch(e){};this._oShowMeasureDialog=sap.ui.xmlfragment("measureDimensionDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.measureDimensionDialog",this);this._oShowMeasureDialog.addStyleClass("dialog");this.addThresholdMeasureDialog=sap.ui.xmlfragment("thresholdDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addThresholdMeasure",this);this._editMeasureDialog=sap.ui.xmlfragment("editDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.editDialog",this);this._editChartDialog=sap.ui.xmlfragment("editChartDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.editChartDialog",this);this._dualAxisConfig=sap.ui.xmlfragment("dualAxisConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.dualAxisConfig",this);this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this);this.AdditionalLanguagesDialog=new sap.ui.xmlfragment("additionalLanguageDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.additionalLanguagesDialog",this);this.choroplethSettingsDialog=new sap.ui.xmlfragment("choroplethSettingsDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.choroplethSettingsDialog",this);this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog();if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}this.choroplethSettingsDialog.attachAfterOpen(jQuery.proxy(t.afterChoroplethSettingsDialogOpen,t));},onError:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,this);},afterChoroplethSettingsDialogOpen:function(c){var t=this;var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").getBinding("items").filter(new sap.ui.model.Filter(f,true));sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").rerender();this.handleMainMeasureChange();},onRoutePatternMatched:function(E){var t=this;var n;if(E.getParameter("name")==="configureChart"){t.errorState=undefined;t.errorMsg=undefined;try{this.evaluationId=E.getParameter("arguments")["evaluationId"];this.currentViewId=E.getParameter("arguments")["viewId"];this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,false,this.getView().getModel("i18n"));if(this.currentViewId!==this.DDA_MODEL.NEW_VIEWID){this.DDA_MODEL.setViewId(this.currentViewId);}else{this.DDA_MODEL.setViewId(this.DDA_MODEL.NEW_VIEWID);n=true;}this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);this.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this.EVALUATION.getODataUrl(),this.EVALUATION.getEntitySet());this.COLUMN_LABEL_MAPPING=this.mProperties.getLabelMappingObject();this.bindUiToModel();this._oModel=this.getView().getModel("SB_DDACONFIG");this._oModel.getData().NO_OF_ADDITIONAL_LANGUAGES=this._oModel.getData().ADDITIONAL_LANGUAGE_TITLES.length?(this._oModel.getData().ADDITIONAL_LANGUAGE_TITLES.length-1):0;this._oTextsModel=this.getView().getModel("i18n");this._editMeasureDialog.setModel(this._oTextsModel,"i18n");this._editChartDialog.setModel(this._oTextsModel,"i18n");this._dualAxisConfig.setModel(this._oTextsModel,"i18n");this._msrDialogForStack1.setModel(this._oTextsModel,"i18n");this._oShowMeasureDialog.setModel(this._oTextsModel,"i18n");this.addThresholdMeasureDialog.setModel(this._oTextsModel,"i18n");this.prepareInitialModelData(this._oModel);this._updateMeasureDimensionBindings();this.choroplethSettingsDialog.setModel(this._oTextsModel,"i18n");this.choroplethSettingsDialog.setModel(this._oModel,"SB_DDACONFIG");this.nDecimal=this.EVALUATION.getDecimalPrecision();this.oFormatOptions_core={style:"short"};if(!(this.nDecimal===null||this.nDecimal===-1)){this.oFormatOptions_core.minFractionDigits=this.nDecimal;this.oFormatOptions_core.maxFractionDigits=this.nDecimal;}if(this.nDecimal===-1){this.oFormatOptions_core.minFractionDigits=2;this.oFormatOptions_core.maxFractionDigits=2;}this.refreshChart();this.chartTypeInit();jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");var v=this.getView().getModel("SB_DDACONFIG").getData();if(this.currentViewId==this.DDA_MODEL.NEW_VIEWID){this.generateViewId(this);}this.takeConfigMasterSnapShot();this.initCopy=this.getView().getModel("SB_DDACONFIG").getJSON();sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("chartIdInput"),controllerReference:t,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateViewId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");}catch(e){t.errorState=true;t.errorMsg=e.message;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{this.setTooltipForAllSelect();}if(n){this.openAllMeasuresDimension();}}},setTooltipForAllSelect:function(){var s,t,i,l;var d=this.getView().getModel("SB_DDACONFIG").getData();s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));for(i=0,l=d.CHART_TYPES.length;i<l;i++){if(d.CHART_TYPES[i].key==d.CHART_TYPE){t=d.CHART_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual"));for(i=0,l=d.AXIS_TYPES.length;i<l;i++){if(d.AXIS_TYPES[i].key==d.AXIS_TYPE){t=d.AXIS_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute"));for(i=0,l=d.VALUE_TYPES.length;i<l;i++){if(d.VALUE_TYPES[i].key==d.VALUE_TYPE){t=d.VALUE_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));for(i=0,l=d.COLOR_SCHEMES.length;i<l;i++){if(d.COLOR_SCHEMES[i].key==d.COLOR_SCHEME){t=d.COLOR_SCHEMES[i].text;}}s.setTooltip(t);s=this.getView().byId("chartDataMode");t=d.DATA_MODES[0].text;s.setTooltip(t);},displayLabelsFormatter:function(s){return this.COLUMN_LABEL_MAPPING[s]||s;},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog);this.DDA_MODEL.bindModel(this._editChartDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editChartDialog);this.DDA_MODEL.bindModel(this._oShowMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._oShowMeasureDialog);this.DDA_MODEL.bindModel(this.addThresholdMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this.AdditionalLanguagesDialog,"SB_DDACONFIG");},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},takeConfigMasterSnapShot:function(){this._masterConfig=this._cloneObj(this._oModel.getData());},restoreFromConfigMasterSnapShot:function(){this._oModel.setData(this._cloneObj(this._masterConfig));},copyConfigSnapshot:function(){this._config=this._cloneObj(this._oModel.getData());this.enableOrDisableSave();},restorePrevConfig:function(){this._oModel.setData(this._cloneObj(this._config));},prepareInitialModelData:function(m){var t=m.getData();var a=(t.AXIS_TYPE==="SINGLE");var d=t.ALL_DIMENSIONS;var b=t.ALL_MEASURES;var c=[],e={};var f=t.COLUMNS;for(var i=0;i<f.length;i++){if(a&&f[i].TYPE==="MEASURE"){f[i].AXIS=1;}f[i].SELECTED=true;f[i].LABEL=this.COLUMN_LABEL_MAPPING[f[i].NAME];c.push(f[i]);e[f[i].NAME]=true;}for(var i=0;i<d.length;i++){if(e[d[i]])continue;c.push({AXIS:1,NAME:d[i],SORT_BY:d[i],SORT_ORDER:"none",STACKING:0,TYPE:"DIMENSION",VISIBILITY:"BOTH",SELECTED:false,LABEL:this.COLUMN_LABEL_MAPPING[d[i]]});}for(var i=0;i<b.length;i++){if(e[b[i]]){continue;}c.push({0:Object,AXIS:1,COLOR1:"",COLOR2:"",NAME:b[i],SORT_BY:b[i],SORT_ORDER:"none",STACKING:0,TYPE:"MEASURE",VISIBILITY:"BOTH",SELECTED:t.SELECTED_VIEW==""?this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME==b[i]:false,LABEL:this.COLUMN_LABEL_MAPPING[b[i]]});}t.items=c;m.setData(t);},_updateMeasureDimensionBindings:function(){var f=new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true);var s=new sap.ui.model.Sorter("COLUMNS_ORDER",false,null);var b=this.measureDimensionList.getBinding("items");b.filter(f);b.sort(s);},onChartTypeChange:function(e){var t=this;if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).setVisible(c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH");this.updateSemanticColorComboBox(c.getSelectedKey());this._updateMeasureDimensionBindings();this.getView().getModel('SB_DDACONFIG').setProperty("/AXIS_TYPE","SINGLE");this.getView().getModel('SB_DDACONFIG').setProperty("/VALUE_TYPE","ABSOLUTE");this.getView().getModel('SB_DDACONFIG').setProperty("/COLOR_SCHEME","NONE");if(c.getSelectedKey().toUpperCase()=="LINE"||c.getSelectedKey().toUpperCase()=="COMBINATION"||c.getSelectedKey().toUpperCase()=="BUBBLE"||c.getSelectedKey().toUpperCase()=="TABLE")this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","openchartsettings")).setEnabled(false);else this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","openchartsettings")).setEnabled(true);if(c.getSelectedKey().toUpperCase()=="CHOROPLETH"){if(this.chartMeasures.length<2){this.refreshChart();}else if(this.chartDimensions.length>1){this.refreshChart();}else{t.choroplethSettingsDialog.open();}}else{this.refreshChart();}this.enableOrDisableSave();c.setTooltip(c.getSelectedItem().getText());},chartTypeInit:function(e){var t=this;if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()!="BUBBLE")this.copyConfigSnapshot();this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).setVisible(c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH");this.setSemanticColorComboBox(c.getSelectedKey());this.refreshChart();this.enableOrDisableSave();},updateSemanticColorComboBox:function(c){if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}else if(c=="BUBBLE"){s.setSelectedKey("NONE");s.setVisible(false);}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);if(!(s.getSelectedKey().toUpperCase()=="NONE"||s.getSelectedKey().toUpperCase()=="AUTO_SEMANTIC"))s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}else if(c=="CHOROPLETH"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);if(this.dda_config.chartConfig.colorScheme=="AUTO_SEMANTIC"){s.setSelectedKey("AUTO_SEMANTIC");if(!(this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));return;}}else{s.setSelectedKey("NONE");}}else if(c=="LINE"||c=="COMBINATION"){s.setSelectedKey("MANUAL_NON_SEMANTIC");s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}},setSemanticColorComboBox:function(c){c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}else if(c=="BUBBLE"){s.setVisible(false);}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}else if(c=="CHOROPLETH"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);if(this.dda_config.chartConfig.colorScheme=="AUTO_SEMANTIC"){s.setSelectedKey("AUTO_SEMANTIC");if(!(this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));return;}}else{s.setSelectedKey("NONE");}}else if(c=="LINE"||c=="COMBINATION"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}},formatcolor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"transparent";},formatEditColor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"black";},sortByMeasureVisibility:function(s){return s?(s.toUpperCase()=="MEASURE"||s.toUpperCase()=="KPI MEASURE"):false;},sortByDimensionVisibility:function(s){return s?s.toUpperCase()=="DIMENSION":false;},openAllMeasuresDimension:function(){this.copyConfigSnapshot();this._oShowMeasureDialog.open();var b=this._oShowMeasureDialog.getContent()[0];b.getButtons()[1].firePress();if(b.getSelectedButton()==b.getButtons()[1].getId()){this.showDimensionList();}else{this.showMeasureList();}},_isAddDimensionMode:function(){var b=this._oShowMeasureDialog.getContent()[0];return b.getSelectedButton()==b.getButtons()[1].getId()},onMeasureDimensionSearch:function(e){var m=this._isAddDimensionMode()?"DIMENSION":"MEASURE";var c=this._isAddDimensionMode()?this._oDimensionList:this._oMeasureList;var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.Contains,m)];var k=e.getSource().getValue();if(k&&k.length>0){f.push(new sap.ui.model.Filter("LABEL",sap.ui.model.FilterOperator.StartsWith,k));}var b=c.getBinding("items");b.filter(f);},onMeasureDimensionAdded:function(){var c=this._oDimensionList.getSelectedItems().length;if(this.chartMeasures.length==0||c==0){if(this.chartMeasures.length==0){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel("i18n").getProperty("NO_MEASURES")});}if(c==0){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel("i18n").getProperty("SELECT_AT_LEAST_ONE_DIMENSION")});}}else{this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close();this.refreshChart();this.enableOrDisableSave();}},onMeasureDimensionCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close();},showDimensionList:function(){this._oShowMeasureDialog.removeContent(this._oMeasureList);this._oShowMeasureDialog.addContent(this._oDimensionList);this._oDimensionList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"));},showMeasureList:function(){this._oShowMeasureDialog.removeContent(this._oDimensionList);this._oShowMeasureDialog.addContent(this._oMeasureList);this._oMeasureList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"));},formatSortOrder:function(s){if(s=="asc"){return"sap-icon://up"}else if(s=="desc"){return"sap-icon://down"}else{return"";}},colorButtonVisiblity:function(s,c){if(s)return(c=="MANUAL_SEMANTIC"||c=="MANUAL_NON_SEMANTIC")&&s.toLowerCase()=='measure';},colorButton1Visiblity:function(s){return s=="MANUAL_NON_SEMANTIC";},colorButton2Visiblity:function(s){return s=="MANUAL_SEMANTIC";},openChartSettings:function(e){var t=this;this.copyConfigSnapshot();if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(true);this.copyStackConfigSnapshot();this.setDualStackModel(this.chartMeasures);}else{sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(false);}var S=t.getStacking(t.chartMeasures,t.chartDimensions);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setEnabled(true);if(S.isEnabled){sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(true);if(S.type==="M"){sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}else if(S.type==="D"){sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").setSelected(false);sap.ui.core.Fragment.byId("editChartDialog","dimStack").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:{path:"name",formatter:jQuery.proxy(t.formatMeasureName,t),}});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name);}}}else{sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(false);sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&(((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")||((this.dda_config.chartConfig.value).toUpperCase()==="PERCENTAGE"))){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setEnabled(false);}if(!(((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setVisible(false);}else{sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setVisible(true);}if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"||(this.dda_config.chartConfig.type).toUpperCase()==="CHOROPLETH"){var f=[];var a;if((this.dda_config.chartConfig.type).toUpperCase()==="CHOROPLETH"){sap.ui.core.Fragment.byId("editChartDialog","messageAddThresholdMeasure").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(true);sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(true);var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"name":(new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getSelectedKey())),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getBinding('items').filter(new sap.ui.model.Filter(F,true));}else{sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(true);var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};}for(var i in a){f.push(a[i]);}var s=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","thresholdMeasureChart"));var b=s.getItems()?s.getItems():[];if(b.length&&s.getBinding('items')){s.getBinding('items').filter(f);}if(this._oModel.getData().THRESHOLD_MEASURE)s.setSelectedKey(this._oModel.getData().THRESHOLD_MEASURE);s.setTooltip(this._oModel.getData().THRESHOLD_MEASURE);}else{sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(false);}this._editChartDialog.open();},onEditIconPress:function(e){var t=this;this.copyConfigSnapshot();var b=e.getSource().getBindingContext("SB_DDACONFIG");this.columnBeingEdited=b.getObject();this._editMeasureDialog.bindElement(b.getPath());if(b.getObject().TYPE.toLowerCase()=="kpi measure"){sap.ui.core.Fragment.byId("editDialog","typeOf").setText(this.getView().getModel("i18n").getProperty("KPI_MEASURE"));}if(b.getObject().VISIBILITY.toUpperCase()==="CHART")sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(true);else sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(false);sap.ui.core.Fragment.byId("editDialog","allMeasures").setTooltip(sap.ui.core.Fragment.byId("editDialog","allMeasures").getSelectedItem().getText());sap.ui.core.Fragment.byId("editDialog","allDimensions").setTooltip(sap.ui.core.Fragment.byId("editDialog","allDimensions").getSelectedItem().getText());sap.ui.core.Fragment.byId("editDialog","sortOrder").setTooltip(sap.ui.core.Fragment.byId("editDialog","sortOrder").getSelectedItem().getText());this._editMeasureDialog.open();},onEnableStacking:function(){var i=sap.ui.core.Fragment.byId("editChartDialog","enableStacking").getSelected();if(i){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(true);}else{sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);}},onMsrStacking:function(){if(sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").getSelected()){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}},onDimStacking:function(){var t=this;if(sap.ui.core.Fragment.byId("editChartDialog","dimStack").getSelected()){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:{path:"name",formatter:jQuery.proxy(t.formatMeasureName,t),}});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setTooltip(this.COLUMN_LABEL_MAPPING[t.getDimensionToBeStacked(t.chartDimensions).name]);}else{sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setTooltip(this.COLUMN_LABEL_MAPPING[t.chartDimensions[0].name]);}}else{sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}},onAfterRendering:function(){this._fixSplitterHeight();sap.ui.Device.resize.attachHandler(this._fixSplitterHeight,this);},_fixSplitterHeight:function(){var _=$(window).height();var a=48;var b=49;this.byId('splitContainer').$().css("height",(_-(a+b+a))+"px");},onEditChartDialogOk:function(e){var t=this;if(sap.ui.core.Fragment.byId("editChartDialog","enableStacking").getSelected()){if(sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").getSelected()){t.setStacking(true,"M",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}}else if(sap.ui.core.Fragment.byId("editChartDialog","dimStack").getSelected()){var d=sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").getSelectedKey();t.setStacking(true,"D",t._oModel.getData().items);t.setDimensionToBeStacked(t._oModel.getData().items,d);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}}else{t.setStacking(false,"N",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){var a=this._oModel.getData();for(var i=0;i<a.items.length;i++){if(a.items[i].TYPE.toUpperCase()==="MEASURE"){a.items[i].AXIS=1;for(var j=0;j<t.chartMeasures.length;j++){if(a.items[i].NAME===t.chartMeasures[j].name){a.items[i].AXIS=t.chartMeasures[j].axis;break;}}}}this._oModel.setData(a);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){var b=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var f=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethThresholdMeasure").getSelectedKey();this.updateMeasuresAndDimensionsInmodel(b,f);}this.copyConfigSnapshot();this._updateMeasureDimensionBindings();this.refreshChart();this._editChartDialog.close();},onEditChartDialogCancel:function(e){this.restorePrevConfig();if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){this.restoreStackPrevConfig();}this._updateMeasureDimensionBindings();this._editChartDialog.close();},onEditDialogOk:function(e){var t=this;var b=e.getSource().getBindingContext("SB_DDACONFIG");if(sap.ui.core.Fragment.byId("editDialog","hideInTable").getSelected()){t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","CHART");}else{t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","BOTH");}this._updateMeasureDimensionBindings();this._editMeasureDialog.close();this.refreshChart();},onEditDialogCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._editMeasureDialog.close();},_getColorPaletteTemplate:function(b){var i=new sap.ui.core.Icon({color:{path:"SB_DDACONFIG>color",formatter:this.formatcolor},src:"sap-icon://color-fill",size:"32px",width:"5%",press:function(e){var a=b.getModel("SB_DDACONFIG").getProperty("/COLOR_SCHEME");a=(a=="MANUAL_NON_SEMANTIC")?"COLOR1":(a=="MANUAL_SEMANTIC")?"COLOR2":"";b.getBindingContext().getObject()[a]=this.getBindingContext("SB_DDACONFIG").getProperty("color");b.getModel().refresh();}});var c=new sap.m.Label({text:{path:"SB_DDACONFIG>index",formatter:function(a){var t="";switch(a){case 1:t="Neutral";break;case 4:t="Good";break;case 7:t="Warning";break;case 10:t="Bad";}return t;}},visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"}}});return new sap.m.HBox({items:[i,c]});},showColorPopUp:function(e){var c;var b=e.getSource();var a=this._oModel.getProperty("/COLOR_SCHEME");var d=new sap.m.VBox();d.bindAggregation("items","SB_DDACONFIG>/"+a,this._getColorPaletteTemplate(b));var f=new sap.m.Popover({visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"||s=="MANUAL_NON_SEMANTIC";}},showHeader:false,content:[d],});f.setModel(this._oModel,"SB_DDACONFIG");f.openBy(b);},onEditDialogCloseButton:function(){this._editMeasureDialog.close();},onSingleDualChange:function(){var t=this;var s=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual"))).getSelectedKey()).toUpperCase();this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setTooltip(this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).getSelectedItem().getText());switch(s){case"SINGLE":if(!(this.prevStack&&this.prevStack.isEnabled)){this.setStacking(false,"N",t._oModel.getData().items);}this.refreshChart();break;case"DUAL":if(this.chartMeasures.length<2){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("DUAL_AXIS_CHART_MIN_MEASURE"),{onClose:function(){t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE");}});}else{this.prevStack=this.getStacking(this.chartMeasures,this.chartDimensions);this.setStacking(true,"M",this._oModel.getData().items);this.copyStackConfigSnapshot();this.dualStackValue(this.chartMeasures);this.setDualStackModel(this.chartMeasures);this._dualAxisConfig.open();}break;default:break;}},setDualStackModel:function(m){var t=this;var d=this.getMeasuresByAxis(m);var D=new sap.ui.model.json.JSONModel();D.setData({DATA:d.axis1.objArr});this._dualAxisConfig.setModel(D,"DUAL_AXIS1");this._editChartDialog.setModel(D,"DUAL_AXIS1");var a=new sap.ui.model.json.JSONModel();a.setData({DATA:d.axis2.objArr});this._dualAxisConfig.setModel(a,"DUAL_AXIS2");this._editChartDialog.setModel(a,"DUAL_AXIS2");sap.ui.core.Fragment.byId("dualAxisConfig","stack1list").setText("");sap.ui.core.Fragment.byId("editChartDialog","stack1list_edit").setText("");sap.ui.core.Fragment.byId("dualAxisConfig","stack2list").setText("");sap.ui.core.Fragment.byId("editChartDialog","stack2list_edit").setText("");sap.ui.core.Fragment.byId("dualAxisConfig","stack1list").setText("("+d.axis1.objArr.length+")");sap.ui.core.Fragment.byId("editChartDialog","stack1list_edit").setText("("+d.axis1.objArr.length+")");sap.ui.core.Fragment.byId("dualAxisConfig","stack2list").setText("("+d.axis2.objArr.length+")");sap.ui.core.Fragment.byId("editChartDialog","stack2list_edit").setText("("+d.axis2.objArr.length+")");},copyStackConfigSnapshot:function(){this._stackConfig=this._cloneObj(this.chartMeasures);},restoreStackPrevConfig:function(){this.chartMeasures=this._stackConfig;this.setDualStackModel(this._stackConfig);},stack1removed:function(e){var r=new sap.ui.model.Context(this._dualAxisConfig.getModel("DUAL_AXIS1"),e.getSource().getBindingContextPath()).getProperty();var t=this;if(e.getSource().getModel("DUAL_AXIS1").getData().DATA.length===1){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_ERROR_MSG"));}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===r.name){t.chartMeasures[i].axis=2;}}this.setDualStackModel(this.chartMeasures);}},stack2removed:function(e){var r=new sap.ui.model.Context(this._dualAxisConfig.getModel("DUAL_AXIS2"),e.getSource().getBindingContextPath()).getProperty();var t=this;if(e.getSource().getModel("DUAL_AXIS2").getData().DATA.length===1){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_ERROR_MSG"));}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===r.name){t.chartMeasures[i].axis=1;}}this.setDualStackModel(this.chartMeasures);}},onDualAxisDialogOk:function(){var t=this;var a=this._oModel.getData();for(var i=0;i<a.items.length;i++){if(a.items[i].TYPE.toUpperCase()==="MEASURE"){a.items[i].AXIS=1;for(var j=0;j<t.chartMeasures.length;j++){if(a.items[i].NAME===t.chartMeasures[j].name){a.items[i].AXIS=t.chartMeasures[j].axis;break;}}}}this._oModel.setData(a);this.refreshChart();this._dualAxisConfig.close();},onDualAxisDialogCancel:function(){this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE");this.restoreStackPrevConfig();this._dualAxisConfig.close();},formatAxisToBool:function(a){if(a===1)return true;else return false;},openMsrDialogForStack1:function(){var t=this;if(!this._msrDialogForStack1){this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this);}var S=new sap.ui.model.json.JSONModel();S.setData({DATA:t.chartMeasures});this._msrDialogForStack1.setModel(S);this._msrDialogForStack1.open();},onSearchInStack1SelectDialog:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},onStack1SelectDialogOK:function(e){var t=this;var c=e.getParameter("selectedItems");if(!(c.length)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",1));}else if(c.length==t.chartMeasures.length){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("STACK_ALL_MEASURES"));}else{for(var i=0;i<t.chartMeasures.length;i++){t.chartMeasures[i].axis=1;for(var j=0;j<c.length;j++){if(t.chartMeasures[i].name===c[j].getTitle()){t.chartMeasures[i].axis=2;break;}}}e.getSource().getBinding("items").filter([]);var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("dualAxisConfig","stack1MsrsLabel").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("dualAxisConfig","stack2MsrsLabel").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr1").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr2").setSelectedKey(d.axis2.nameArr[0])};sap.ui.core.Fragment.byId("editChartDialog","stack1MsrsLabel_edit").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("editChartDialog","stack2MsrsLabel_edit").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("editChartDialog","AxisMsr1_edit").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("editChartDialog","AxisMsr2_edit").setSelectedKey(d.axis2.nameArr[0])};}},onStack1SelectDialogCancel:function(){},onDataModeChange:function(){this.refreshChart();var d=this.getView().byId("chartDataMode");d.setTooltip(d.getSelectedItem().getText());},onIsAbsoluteChange:function(){var v=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute"))).getSelectedKey()).toUpperCase();if(v==="PERCENTAGE")this.setStacking(true,"M",this._oModel.getData().items);this.refreshChart();this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setTooltip(this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).getSelectedItem().getText());},onSemanticColorOptionChange:function(){var t=this;var s=this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));s.setTooltip(s.getSelectedItem().getText());if(this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey()=="AUTO_SEMANTIC"){if(this.chartMeasures.length>=2){if(!(this.dda_config.chartConfig.type.toUpperCase()=="CHOROPLETH"&&this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){var f=[];var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};for(var i in a){f.push(a[i]);}var b=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure"));var c=b.getItems()?b.getItems():[];if(c.length&&b.getBinding('items')){b.getBinding('items').filter(f);}if(this._oModel.getData().THRESHOLD_MEASURE)b.setSelectedKey(this._oModel.getData().THRESHOLD_MEASURE);this.addThresholdMeasureDialog.open();if(b&&b.getSelectedItem()){b.setTooltip(b.getSelectedItem().getText());}return;}}}this.refreshChart();},onThresholdMeasureAdded:function(){var t=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure")).getSelectedKey();this.updateMeasuresAndDimensionsInmodel(this.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE,t);this.copyConfigSnapshot();this.refreshChart();this.addThresholdMeasureDialog.close();},onThresholdMeasureCancel:function(){this.addThresholdMeasureDialog.close();},getLAISOfromSPRAS:function(k){var a=this.getView().getModel('SB_DDACONFIG').getData().ALL_LANGUAGES;for(var i=0;i<a.length;++i){if(a[i]["SPRAS"]==k)return a[i]["LAISO"];}},getIndexOfDuplicate:function(d,l){for(var i=0;i<d.length;++i){if(d[i]["SAP_LANGUAGE_KEY"]==l)return i;}return-1;},openAdditionalLanguagesDialog:function(){var a=this;this.AdditionalLanguagesDialog.setModel(this._oTextsModel,"i18n");this.copyConfigSnapshot();sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").setValue("");var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.bindAggregation("items","SB_DDACONFIG>/ADDITIONAL_LANGUAGE_TITLES",new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{SB_DDACONFIG>TEXT}"}),new sap.m.Label({text:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return a.getLAISOfromSPRAS(s)}}}),new sap.ui.core.Icon({src:"sap-icon://decline",press:this.deleteEntry})],visible:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return s!=a._oModel.getData()["CURRENT_LANGUAGE"]}}}));this.AdditionalLanguagesDialog.open();return;},closeAdditionalLanguagesDialog_OK:function(e){this.copyConfigSnapshot();this.AdditionalLanguagesDialog.close();return;},closeAdditionalLanguagesDialog_Cancel:function(e){this.restorePrevConfig();this.AdditionalLanguagesDialog.close();return;},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},deleteEntry:function(e){var b=e.getSource().getParent().getBindingContextPath();var i=parseInt(b.split("/").pop());var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.getModel("SB_DDACONFIG").getData()["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES=A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES-1;A.getModel("SB_DDACONFIG").refresh();return;},addEntry:function(){var n=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").getValue();var a=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitleLanguage").getSelectedKey();if(n&&a){}else return;var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");var t=A.getModel("SB_DDACONFIG").getData();var b={EVALUATION_ID:this.DDA_MODEL.getConfigurator().evaluationId,CONFIGURATION_ID:this._oModel.getData().SELECTED_VIEW||this._oModel.getData().ID,SAP_LANGUAGE_KEY:a,TEXT:n,IS_ACTIVE:this._oModel.getData()["IS_ACTIVE"]||1};var i;if((i=this.getIndexOfDuplicate(t["ADDITIONAL_LANGUAGE_TITLES"],a))==-1)t["ADDITIONAL_LANGUAGE_TITLES"].push(b);else{t["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);t["ADDITIONAL_LANGUAGE_TITLES"].push(b);}A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES=A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES+1;A.getModel("SB_DDACONFIG").refresh();return;},formatName:function(a,b){return a+" "+b;},formatColorForMap:function(m,t){var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_vbox");var g,m,t=null;this.canSave=false;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var b=this._oModel.getData();this.dda_config={};this.dda_config.chartConfig={mode:b.DATA_MODE||"DUMMY",title:"",dataLimit:b.DATA_LIMIT||null,dataLimitations:b.DATA_LIMITATIONS||false,type:(b.CHART_TYPE).toUpperCase()||"BAR",axis:b.AXIS_TYPE||"SINGLE",value:b.VALUE_TYPE||"ABSOLUTE",colorScheme:b.COLOR_SCHEME||"NONE",thresholdMeasure:b.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<b.items.length;i++){this.dda_config.columnsConfig.push({name:b.items[i].NAME,type:b.items[i].TYPE,selected:b.items[i].SELECTED||false,visibility:b.items[i].VISIBILITY||"BOTH",sortOrder:b.items[i].SORT_ORDER||"NONE",sortBy:b.items[i].SORT_BY||"",axis:b.items[i].AXIS||2,stacking:b.items[i].STACKING||0,color:b.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?b.items[i].COLOR1:b.COLOR_SCHEME=="MANUAL_SEMANTIC"?b.items[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){if(this.dda_config.columnsConfig[i].selected){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.getData().QUERY_SERVICE_URI,this._oModel.getData().QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_vbox");var g,m,t=null;if(this.chartMeasures.length<2){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("CHOROPLETH_CHART_MIN_MEASURE"),{onClose:function(){if(c._config){c.restorePrevConfig();}else{c.restoreFromConfigMasterSnapShot();}c.onChartTypeChange();c.refreshChart();}});return;}else if(this.chartDimensions.length>1){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("CHOROPLETH_CHART_MIN_DIMENSION"),{onClose:function(){if(c._config){c.restorePrevConfig();}else{c.restoreFromConfigMasterSnapShot();}c.onChartTypeChange();c.refreshChart();}});return;}v.setVisible(false);a.setVisible(true);a.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var b=this.getView().getModel("SB_DDACONFIG").getData().items;var d=b.length;var e=[];for(var i=0;i<d;i++){if(b[i].TYPE=='MEASURE'&&b[i].SELECTED==true){if(b[i].MAIN_MEASURE){this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=b[i].NAME;}e.push(b[i]);}else if(b[i].TYPE=='DIMENSION'&&b[i].SELECTED==true){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=b[i].NAME;}}for(var i=0;i<d;i++){if(b[i].TYPE=='DIMENSION'){b[i].COLUMNS_ORDER=4}else if(b[i].TYPE='MEASURE'){if(b[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE){b[i].COLUMNS_ORDER=1}else if(b[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE){b[i].COLUMNS_ORDER=2}else{b[i].COLUMNS_ORDER=3}}}this._updateMeasureDimensionBindings();if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}a.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"700px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},dualStackValue:function(c){var a=1;for(var i=0;i<c.length;i++){if(c[i].axis===1){a++}if(c.length===a){c[c.length-1].axis=2;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},getAxisOfMsr:function(m){var a=1;for(var i=0;i<this.chartMeasures.length;i++){if((this.chartMeasures[i]).name===m){a=(this.chartMeasures[i]).axis;break;}}return a;},getSelectedMeasuresCount:function(m){var c=0;for(var i=0;i<m.length;i++){if((m[i].TYPE).toUpperCase()=="MEASURE"&&(m[i].SELECTED))++c;}return c;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCellFormatter:function(o,i,a){var t=this;var f;var c=this.dda_config.chartConfig.type;var v=this.dda_config.chartConfig.value;var b=this.dda_config.chartConfig.axis;if(i){if(c.toUpperCase()=="TABLE"){if(t._isEvaluationThresholdMeasure(o))f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true);}else if((b=='DUAL')&&(v=="ABSOLUTE")&&(c=='BAR'||c=='COLUMN')){if(a[(t.getAxisOfMsr(o))-1])f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true);}else{f=this.getChartPercentFormatter(true);}}else f=this.getChartNumberFormatter(true);return f;},_getTableCell:function(o,t,i,a){var b=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o,formatter:b._getTableCellFormatter(o,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,c){try{m=window.parseFloat(m);c=window.parseFloat(c);return b._getValueState(m,c);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o,formatter:b._getTableCellFormatter(o,i,a)}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},get_hana_client:function(){var a;var c=sap.suite.ui.smartbusiness.lib.Util.cache.getCacheHanaClient();if(c){a=c;return a;}jQuery.ajax({type:"GET",async:false,dataType:"json",url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters("/sap/hba/r/sb/core/logic/GetSessionClient.xsjs"),success:function(d,s,x){a=d.sessionClient;},error:function(j,t,e){jQuery.sap.log.error(j.responseText);}});sap.suite.ui.smartbusiness.lib.Util.cache.setCacheHanaClient(a);return a;},getRuntimeChartData:function(d,m,b,c){var t=this;var e=this.getView().byId("vizChartContainer");e.setBusy(true);var D=[];var M=[];d.forEach(function(x){D.push(x)});m.forEach(function(x){M.push(x)});this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase()=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});if(t.oColumns[i].sortBy!=t.oColumns[i].name){if((t.oColumns[i].type).toUpperCase()=="DIMENSION"){if((D.indexOf(t.oColumns[i].sortBy))==-1){D.push(t.oColumns[i].sortBy);}}else if((t.oColumns[i].type).toUpperCase()=="MEASURE"){if((M.indexOf(t.oColumns[i].sortBy))==-1){M.push(t.oColumns[i].sortBy);}}}}}}try{var f=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");if(!(this.isCDS)){var H=t.get_hana_client();this.DDA_MODEL.EVALUATION_DATA.FILTERS.results.forEach(function(r,i,a){if(r["NAME"]==="P_SAPClient"&&r["VALUE_1"]==="$$$"){r["VALUE_1"]=H;}});}var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.getData().QUERY_SERVICE_URI,entitySet:this._oModel.getData().QUERY_ENTITY_SET,dimension:D,measure:M,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}e.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});e.setBusy(false);});}catch(g){jQuery.sap.log.error(g.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});e.setBusy(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(Number(s)):s;};},getChartNumberFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getFloatInstance(f);return function(s){return a(s)?c.format(Number(s)):s;};},getIsPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}var a=false;if(t&&t.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){a=true;break;}}}return a;},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME);}}}}return t;},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length){if(t.indexOf(m)!=-1){return true;}}return false;},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},validateChartId:function(e){var c=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[1];var a=c.getValue();if(/^[\w\d\.\_]+$/.test(a)){if(this.DDA_MODEL.getConfigurator().findViewById(a)){if(!this._oModel.getData().ID_EDITABLE){c.setValueState(sap.ui.core.ValueState.None);return true;}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false;}}else{c.setValueState(sap.ui.core.ValueState.None);return true;}}else{c.setValueState(sap.ui.core.ValueState.Error);return false;}},validateChartName:function(){var c=this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[3];var a=c.getValue();if(a){c.setValueState(sap.ui.core.ValueState.None);return true;}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false;}},validateDataLimit:function(e){var d=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[7];var a=d.getValue();if(/^\d+$/gi.test(a)){var p=parseInt(a,10);if(p>0){d.setValueState(sap.ui.core.ValueState.None);return true;}}else{d.setValueState(sap.ui.core.ValueState.Error);return false;}},onSave:function(){var t=this;if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}if(this.validateChartName()&&this.validateDataLimit()){var s=this;if(this.currentViewId==this.DDA_MODEL.NEW_VIEWID){this.oApplicationFacade.__newViewAdded=true;this.oApplicationFacade.createdViewId=this.getView().getModel("SB_DDACONFIG").getData().SELECTED_VIEW;}this.busyIndicator.open()&&this.getView().setBusy(true);var m=this.getView().getModel("SB_DDACONFIG").getData();var a=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");a.saveViewConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("CHART_CONFIG_SAVE_SUCCESS"));s.oApplicationFacade.__refreshModel=1;s.oApplicationFacade.__contextViewId=s.getView().getModel("SB_DDACONFIG").getData()["SELECTED_VIEW"];try{if(sap.suite&&sap.suite.ui&&sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration){sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration(s.evaluationId);}}catch(e){}if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.getView().getModel("SB_DDACONFIG").getData().SELECTED_VIEW});s.takeConfigMasterSnapShot();}else{window.history.back();}},function(){jQuery.sap.log.error(x+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"));});}},formatMeasureName:function(s){var l=this.COLUMN_LABEL_MAPPING[s];if(s==this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME){l+="("+this.getView().getModel("i18n").getProperty("KPI_MEASURE")+")";}return l;},formatMeasureNameInList:function(n,t){var a=null;var k=this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME;var m=this.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;var b=this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;if(t=="DIMENSION"){a=this.getView().getModel("i18n").getProperty("DIMENSION");}if(t=="MEASURE"){a=this.getView().getModel("i18n").getProperty("MEASURE");if(n==k){a=this.getView().getModel("i18n").getProperty("KPI_MEASURE");}if(n==b){if(n===k){a=this.getView().getModel("i18n").getProperty("KPI_MEASURE_THRESHOLD_MEASURE");}else{a=this.getView().getModel("i18n").getProperty("THRESHOLD_MEASURE");}}}if((this.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=="CHOROPLETH"){if(t=="DIMENSION"){a=this.getView().getModel("i18n").getProperty("GEO_DIMENSION");}if(t=="MEASURE"){if(n==m){a=this.getView().getModel("i18n").getProperty("MAIN_MEASURE");}}}return a;},formatType:function(t){if(t=="MEASURE")t=this.getView().getModel("i18n").getProperty("MEASURE");if(t=="DIMENSION")t=this.getView().getModel("i18n").getProperty("DIMENSION");return t;},sortDimensionsAndMeasures:function(){var c=this;new sap.suite.ui.smartbusiness.lib.ListPersona({title:this.getView().getModel("i18n").getProperty("CHANGE_ORDER"),view:this.getView(),context:'/items',listItemContext:'LABEL',formatter:jQuery.proxy(this.formatMeasureName,this),namedModel:'SB_DDACONFIG',filter:{property:'SELECTED',value:true},callback:function(){c.refreshChart();}}).start();},onBack:function(){var s=this;var r={};if(s.DDA_MODEL.getConfigurator().getAllViews().length){r={action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.oApplicationFacade.configuratorViewId};}else{r={action:"configureSBKPIDrilldown",route:"noDataView",context:"EVALUATIONS_MODELER(ID='"+s.DDA_MODEL.EVALUATION_DATA.ID+"',IS_ACTIVE=1)"};}if(this.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.restoreFromConfigMasterSnapShot();this.getParent().close();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{s.restoreFromConfigMasterSnapShot();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}},onCancel:function(){var s=this;var r={};if(s.DDA_MODEL.getConfigurator().getAllViews().length){r={action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.oApplicationFacade.configuratorViewId};}else{r={action:"configureSBKPIDrilldown",route:"noDataView",context:"EVALUATIONS_MODELER(ID='"+s.DDA_MODEL.EVALUATION_DATA.ID+"',IS_ACTIVE=1)"};}if(this.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.restoreFromConfigMasterSnapShot();this.getParent().close();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{s.restoreFromConfigMasterSnapShot();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}},onExit:function(){this.restoreFromConfigMasterSnapShot();},enableOrDisableSave:function(){var m=this._config.items.filter(function(s){return s.SELECTED});if(this.dda_config.chartConfig.type.toUpperCase()=="TABLE")this.canSave=true;if(this.dda_config.chartConfig.type.toUpperCase()=="CHOROPLETH")this.canSave=true;if(m.length&&this.canSave){this.getView().byId("save-btn").setEnabled(true);}else{this.getView().byId("save-btn").setEnabled(false);}},isModelChanged:function(){this.currentCopy=this._oModel.getJSON();if(this.initCopy.length==this.currentCopy.length){if(this.initCopy===this.currentCopy){return false;}}return true;},createVizChart:function(d,m){var t=this;var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b=this.dda_config.chartConfig.mode;var e=this.getView().byId("vizChartContainer");e.removeAllContent();if(c.toUpperCase()==="BAR"||c.toUpperCase()==="COLUMN"||c.toUpperCase()==="TABLE"){if(this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey()==="AUTO_SEMANTIC"){if(this.chartMeasures.length<2){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("AUTO_SEMANTICS_CHART_MIN_MEASURE"),{onClose:function(){if(t._config){t.restorePrevConfig();}else{t.restoreFromConfigMasterSnapShot();}t.refreshChart();}});return;}}}var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if(c.toUpperCase()=="TABLE"){e.addContent(T);setTimeout(function(){e.rerender();},0);}else{var V=this.getVizTypeAndIcon();var f=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,formatString:"dataLabelFormatter",hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,},valueAxis:{label:{formatString:"yValueAxisFormatter"}}});o.addEventDelegate({onBeforeRendering:function(){var s=t.byId('splitContainer');var H=s.$().css("height");o.setHeight(H);}});if((!(this.chartDimensions.length))||(!(this.chartMeasures.length))){o.setDataset(new sap.viz.ui5.data.FlattenedDataset({}));f.setContent(o);e.addContent(f);e.addContent(T);return;}if((c.toUpperCase()==="BUBBLE")&&(this.chartMeasures.length<3)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("BUBBLE_CHART_MEASURE_COUNT"),{onClose:function(){if(t._config&&(((t._config.CHART_TYPE).toUpperCase()!="BUBBLE")||(t.getSelectedMeasuresCount(t._config.COLUMNS)>=3)))t.restorePrevConfig();else t.restoreFromConfigMasterSnapShot();t.onChartTypeChange();t.refreshChart();}});return;}if((c.toUpperCase()==="COMBINATION")&&(this.chartMeasures.length<2)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("COMBINATION_CHART_MEASURE_COUNT"),{onClose:function(){if(t._config&&(((t._config.CHART_TYPE).toUpperCase()!="COMBINATION")||(t.getSelectedMeasuresCount(t._config.COLUMNS)>=2))){t.restorePrevConfig();}else{t.restoreFromConfigMasterSnapShot();}t.onChartTypeChange();t.refreshChart();}});return;}if((c.toUpperCase()==="BAR"||c.toUpperCase()==="COLUMN")&&(a==="DUAL")){var g=false,h=false,i;for(i=0;i<this.chartMeasures.length;i++){if(this.chartMeasures[i].axis===1)g=true;else if(this.chartMeasures[i].axis===2)h=true;}if(!(g)||!(h)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_REMOVE_MSG"),{onClose:function(){t.restorePrevConfig();t._updateMeasureDimensionBindings();t.refreshChart();}});return;}}this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var j=new sap.viz.ui5.controls.Popover().setFormatString("vizPopOver");j.connect(o.getVizUid());this.setAllVizFormatters();if(a==="DUAL"||c.toUpperCase()==="BUBBLE"){var p=o.getVizProperties();p.valueAxis2={label:{formatString:"y2ValueAxisFormatter"}};o.setVizProperties(p);if((b==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&(v==="ABSOLUTE")&&(c==="BAR"||c==="COLUMN")){this._handleVizDualAxisWhenPercentScale(o,j);}}this.applyColorToViz(o);f.setContent(o);e.addContent(f);e.addContent(T);this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);}this.canSave=true;this.copyConfigSnapshot();},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var t=this;sap.viz.api.env.Format.useDefaultFormatter(false);jQuery.sap.require("sap.ui.core.format.NumberFormat");var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var m=this.dda_config.chartConfig.mode;if(m==="RUNTIME"){var i=this.getIsPercentScaled(this.chartMsrNames);if((this.EVALUATION.getScaling()==-2)&&(a==="DUAL")&&(v==="ABSOLUTE")&&(c==="BAR"||c==="COLUMN")){var b=this.getMeasuresByAxis(this.chartMeasures);var d=this.getIsPercentScaled(b.axis1.nameArr);var e=this.getIsPercentScaled(b.axis2.nameArr);}}var f={locale:function(){},format:function(g,p){if(p=="yValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&(a==="DUAL")&&(c==="BAR"||c==="COLUMN")){if(d){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(g));}else if(p=="y2ValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&(a==="DUAL")&&(c==="BAR"||c==="COLUMN")){if(e){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(g));}else if(p=="dataLabelFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&!((v==="PERCENTAGE"||a==="DUAL")&&(c==="BAR"||c==="COLUMN"))){n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);}return n.format(Number(g));}else if(p=="dataLabelPercentFormatter"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else if(p=="vizPopOver"){if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&!((v==="PERCENTAGE"||a==="DUAL")&&(c==="BAR"||c==="COLUMN"))){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else{var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);return n.format(Number(g));}}else if(p=="vizPercentPopOver"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(f);},_handleVizDualAxisWhenPercentScale:function(c,v){var t=this;var p=c.getVizProperties();var f={};var a={};var b=this.getMeasuresByAxis(this.chartMeasures);var d=this.getIsPercentScaled(b.axis1.nameArr);var e=this.getIsPercentScaled(b.axis2.nameArr);if(d){for(var i=0;i<b.axis1.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="dataLabelPercentFormatter";a[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis1.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="dataLabelFormatter";a[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="vizPopOver";}}if(e){for(var i=0;i<b.axis2.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="dataLabelPercentFormatter";a[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis2.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="dataLabelFormatter";a[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="vizPopOver";}}p.plotArea.dataLabel={visible:true,formatString:f};c.setVizProperties(p);v.setFormatString(a);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=this._oModel.getData()["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if(this._oModel.getData()["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},generateViewId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateViewId(x);var i;p.done(function(I){i=I;c.getView().getModel("SB_DDACONFIG").setProperty("/SELECTED_VIEW",i);c.bindUiToModel();c.copyConfigSnapshot();});},openChoroplethSettingsDialog:function(){this.choroplethSettingsDialog.open();},onChoroplethSettingsOk:function(){if(!this.choroplethSettingsDialog){this._choroplethSettingsDialog=sap.ui.xmlfragment("choroplethSettingsDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.choroplethSettingsDialog",this);}var c=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var a=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethThresholdMeasure").getSelectedKey();this.updateMeasuresAndDimensionsInmodel(c,a);this.copyConfigSnapshot();this.refreshChart();this.enableOrDisableSave();this.choroplethSettingsDialog.close();},onChoroplethSettingsCancel:function(){this.restorePrevConfig();this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType")).fireChange();this.choroplethSettingsDialog.close();},chooseMeasureForThreshold:function(){var t=this;sap.ui.core.Fragment.byId("choroplethSettingsDialog","displaySelectedParametersGrid").setVisible(false);var a=sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList");this.choroplethSettingsDialog.setTitle(this.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));this.choroplethSettingsDialog.destroyBeginButton();a.bindItems({path:"SB_DDACONFIG>/items",template:new sap.m.StandardListItem({title:"{SB_DDACONFIG>NAME}",type:"Active",press:jQuery.proxy(t.selectedThresholdMeasure,t)})});var c=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true),new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,c)];var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.getCore().byId("choroplethSettingsDialog--thresholdMeasureList").getBinding("items").filter(new sap.ui.model.Filter(f,true));sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList").setVisible(true);},selectedThresholdMeasure:function(e){var t=this;sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList").setVisible(false);sap.ui.core.Fragment.byId("choroplethSettingsDialog","displaySelectedParametersGrid").setVisible(true);this.choroplethSettingsDialog.setTitle(this.oApplicationFacade.getResourceBundle().getText("CHOROPLETH_MAP_SETTING"));if(!(this.choroplethSettingsDialog.getBeginButton())){this.choroplethSettingsDialog.setBeginButton(new sap.m.Button({text:"{i18n>OK}",press:jQuery.proxy(t.onChoroplethSettingsOk,t)}));}this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE=e.getSource().getTitle();this.getView().getModel('SB_DDACONFIG').updateBindings();},handleMainMeasureChange:function(){var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true),new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").getSelectedKey())];sap.ui.getCore().byId("choroplethSettingsDialog--choroplethThresholdMeasure").getBinding("items").filter(new sap.ui.model.Filter(f,true));},handleMainMeasureChangechartsettings:function(){var f=[];sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","choroplethKpiMeasurechartsetting")).rerender();var s=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","thresholdMeasureChart"));var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"name":(new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getSelectedKey())),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};for(var i in a){f.push(a[i]);}var b=s.getItems()?s.getItems():[];if(b.length&&s.getBinding('items')){s.getBinding('items').filter(f);}},helpPopOver:function(e){var t=this;var a=null;var c=null;if(e.getSource().getId()=="choroplethSettingsDialog--kpiMeasureHelp"){a=t.oApplicationFacade.getResourceBundle().getText("MAIN_MEASURE");c=t.oApplicationFacade.getResourceBundle().getText("MAIN_MEASURE_HELP_CONTENT");}else if(e.getSource().getId()=="choroplethSettingsDialog--thresholdMeasureHelp"){a=t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_MEASURE");c=t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_MEASURE_HELP_CONTENT");}this.helpPopOver=new sap.m.ResponsivePopover({contentWidth:'15%',contentHeight:'10%',placement:sap.m.PlacementType.Right,content:new sap.m.Text({text:c,width:"100%"}),title:a,verticalScrolling:true,horizontalScrolling:false});this.helpPopOver.openBy(e.getSource());},updateMeasuresAndDimensionsInmodel:function(m,t){var a=this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().items;var b=a.length;for(var i=0;i<b;i++){if(a[i].NAME==m){a[i].MAIN_MEASURE=true;a[i].SELECTED=true;delete a[i].THRESHOLD_MEASURE;this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().MAIN_MEASURE=m;}else if(a[i].NAME==t){a[i].THRESHOLD_MEASURE=true;a[i].SELECTED=true;delete a[i].MAIN_MEASURE;this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE=t;}else{delete a[i].MAIN_MEASURE;delete a[i].THRESHOLD_MEASURE;}}for(var i=0;i<b;i++){if(a[i].TYPE=='DIMENSION'&&a[i].SELECTED){a[i].COLUMNS_ORDER=4;a[i].GEO_DIMENSION=true;}else if(a[i].TYPE=='MEASURE'){if(a[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE){a[i].COLUMNS_ORDER=1}else if(a[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE){a[i].COLUMNS_ORDER=2}else{a[i].COLUMNS_ORDER=3}}}this._updateMeasureDimensionBindings();},onThresholdMeasureChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},genericSelectTooltipChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.evaluation.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/evaluationParameters.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.evaluation.view.S1",{onAfterRendering:function(){var t=this;t.initialModel=t._cloneObj(t.getView().getModel().getData());if(t.showDataSourceError){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;}if(t.inputParameterSapClientCheckBox){t.inputParameterSapClientCheckBox.fireSelect();}if(t.mandatoryFilterSapClientCheckBox){t.mandatoryFilterSapClientCheckBox.fireSelect();}t.byId("scaleFactorSelect").setTooltip(t.byId("scaleFactorSelect").getSelectedItem().getText());t.byId("decimalPrecisionSelect").setTooltip(t.byId("decimalPrecisionSelect").getSelectedItem().getText());},navigateBack:function(){var t=this;var a;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("NAVIGATION_DATA_LOSS")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close();}})});var u=false;if(t.getView().getModel().getData().mode==="create"){var c={};c.oldPayload=t.getEvalParamPayload(t.initialModel);c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.objectType="Evaluations";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true;}}else{var t=this,i=0;var c={};t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());c.oldPayload=t.getEvalParamPayload(t.evalDetails);c.oldPayload.DATA_SPECIFICATION="";a=c.oldPayload.IS_ACTIVE;c.oldPayload.IS_ACTIVE=0;c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.newPayload.DATA_SPECIFICATION="";c.objectType="Evaluations";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.FILTERS;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.evalFiltersPayload;c.objectType="EVALUATION_FILTERS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}for(i=0;i<t.evalDetails.VALUES.length;i++){if(t.evalDetails.VALUES[i].COLUMN_NAME){delete t.evalDetails.VALUES[i].FIXED;}else{delete t.evalDetails.VALUES[i].COLUMN_NAME;}}c.oldPayload=t.evalDetails.VALUES;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.valuesPayload;c.objectType="EVALUATION_VALUES";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.TAGS;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.tagsPayload;c.objectType="TAGS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.PROPERTIES;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.propPayload;c.objectType="PROPERTIES";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.languagesPayload;c.objectType="EVALUATION_TEXTS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}}if(u){b.open();}else{window.history.back();}},onInit:function(){var t=this;t.hasSapClient=false;t.userSessionClient="";this.showDataSourceError=false;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");sap.suite.ui.smartbusiness.sb_createevaluation=this;this.RESERVED_EVAL_ID_NAMESPACE=".sap.sample";this.errorMessages=[];this.errorState=false;this.CDS="cds";this.HANA="hana";this.VIEW_MODE=this.HANA;var u;var c="/sap/hba/r/sb/core/logic/GetSessionClient.xsjs";jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("evalId"),controllerReference:this,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateEvalId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");if(u=jQuery.sap.getUriParameters().get("viewmode")){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}t.fromHome=false;this.oOptionsForCreate={onBack:function(){t.navigateBack();},bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(a){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_CONFIGURE",onBtnPressed:function(a){t.activateAndAddTiles();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsForEdit={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(a){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsOnErrorForCreate={onBack:function(){t.navigateBack();},bSuppressBookmarkButton:{},oNegativeAction:{sIcon:"sap-icon://alert",sId:"errorBtn",sControlId:"errorBtn",onBtnPressed:function(a){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(a,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(a){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_CONFIGURE",onBtnPressed:function(a){t.activateAndAddTiles();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsOnErrorForEdit={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack();},oNegativeAction:{sIcon:"sap-icon://alert",sId:"errorBtn",sControlId:"errorBtn",onBtnPressed:function(a){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(a,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(a){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.setHeaderFooterOptions(t.oOptionsForCreate);this.busyDialog=new sap.m.BusyDialog();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var m=new sap.ui.model.json.JSONModel({NO_OF_ADDITIONAL_LANGUAGES:0,VIEW_MODE:this.VIEW_MODE});this.getView().setModel(m);this.oDataModel=this.oApplicationFacade.getODataModel();if(t.VIEW_MODE!="cds"){$.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c),async:false,success:function(d){t.userSessionClient=d.sessionClient;},error:function(j,a,b){if(j.status==404){t.sessionClientXsjsMissing=true;}else{t.sessionClientFetchError=true;t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}});}if(this.VIEW_MODE==this.CDS){this.oDataModelCDS=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SSB/CDS_ODATA_ENTITY_FETCH_SRV_01");this.oDataModelCDS.attachMetadataFailed(function(s){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_CDS_MODE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_MODE")});t.errorState=true;});this.byId("evalId").setMaxLength(40);}else if(this.VIEW_MODE==this.HANA){this.byId("evalId").setMaxLength(512);}this.editDraft=false;this.oModelForInputParameters=new sap.ui.model.json.JSONModel();this.oModelForDimensions=new sap.ui.model.json.JSONModel();var e=this.evalContext||"";t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(d){t.removeProperty(d);}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");;});var l=function(o,a,b){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=a;t.localLanguage=b;};this.metadataRef.getAllLanguages({async:false,success:l,model:this.oDataModel});this.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);this.setInputParameterAndFilterLayout();this.decideMode();this.valid_maxlength={};this.valid_maxlength.hana={id:512,title:128,};this.valid_maxlength.cds={id:40,title:40,};},decideMode:function(){var t=this;this.oRouter.attachRouteMatched(function(a){this.showDataSourceError=false;this.getView().getModel().setProperty("/SCALING","0");if(a.getParameter("name")==="duplicateEvaluation"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","create");t.generateEvalId(t);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"));t.byId("evalId").setEditable(true);t.populateEvalDetails();t.duplicateEval=true;t.fromHome=false;}else if(a.getParameter("name")==="editEvaluationDraft"){t.setHeaderFooterOptions(t.oOptionsForEdit);try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");this.editDraft=true;t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));t.byId("evalId").setEditable(false);t.fromHome=false;}else if(a.getParameter("arguments").indicatorContext&&a.getParameter("arguments").evaluationContext){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));t.byId("evalId").setEditable(false);t.fromHome=false;}else if(a.getParameter("arguments").indicatorContext){t.getView().getModel().setProperty("/mode","create");t.generateEvalId(t);t.busyDialog.open();this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/DECIMAL_PRECISION",-1);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));t.byId("indicatorId").setEditable(false);t.fromHome=false;}else{t.byId("selectKpi").setText(t.oResourceBundle.getText("SELECT_KPI_OPI"));t.generateEvalId(t);t.getView().getModel().setProperty("/mode","create");t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/DECIMAL_PRECISION",-1);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));t.fromHome=true;}},this);},populateEvalDetails:function(){var t=this;t.busyDialog.open();var a=function(k){k=k.INDICATOR;t.getView().getModel().setProperty("/INDICATOR",k.ID);t.byId("indicatorId").setEditable(false);t.getView().getModel().setProperty("/INDICATORTITLE",k.TITLE);t.getView().getModel().setProperty("/GOAL_TYPE",k.GOAL_TYPE);if(k.DATA_SPECIFICATION){t.getView().getModel().setProperty("/DATA_SPECIFICATION",k.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true);}else{t.byId("additionalInfo").setVisible(false);}t.getView().getModel().setProperty("/INDICATOR_TYPE",k.TYPE);};var b=function(d,s,x){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;};var c=new sap.ui.model.Context(t.getView().getModel(),'/'+t.indicatorContext);t.metadataRef.getKPIById({context:c,success:a,error:b,async:false,model:t.oDataModel});var f=function(d,s,x){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST")});t.errorState=true;};var g=function(d){var l=d.EVALUATION;t.evalDetails={};t.evalDetails=jQuery.extend(true,l,d);delete t.evalDetails.EVALUATION;t.getView().getModel().setProperty("/ID",l.ID);t.getView().getModel().setProperty("/TITLE",l.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",l.DESCRIPTION);t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",l.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",l.ACTION);if(l.GOAL_TYPE){t.getView().getModel().setProperty("/GOAL_TYPE",l.GOAL_TYPE);}t.getView().getModel().setProperty("/INDICATOR_TYPE",l.INDICATOR_TYPE);t.getView().getModel().setProperty("/OWNER_NAME",l.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",l.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",l.OWNER_E_MAIL);t.getView().getModel().setProperty("/VIEW_NAME",l.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",l.ODATA_URL);t.getView().getModel().setProperty("/COLUMN_NAME",l.COLUMN_NAME);t.getView().getModel().setProperty("/SCALING",l.SCALING);t.getView().getModel().setProperty("/DECIMAL_PRECISION",l.DECIMAL_PRECISION);t.getView().getModel().setProperty("/VALUES_SOURCE",l.VALUES_SOURCE);t.createTargetThresholdLayout();if(l.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",l.ODATA_ENTITYSET);try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){t.showDataSourceError=true;t.resetDimensionsAndInputParameters();}}t.getView().getModel().updateBindings();languageData=d.TEXTS||[];var m=[];t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY=[];for(i=0;i<languageData.length;i++){var n={};n.TITLE=languageData[i].TITLE;n.DESCRIPTION=languageData[i].DESCRIPTION;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+languageData[i].LANGUAGE+"'",null,null,false,function(z){n.LANGUAGE_KEY=z.results[0].SPRAS;n.LANGUAGE=z.results[0].LAISO;n.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;n.ID=t.getView().getModel().getData().ID;});if(n.LANGUAGE_KEY!=t.localLanguage){m.push(n);}}t.getView().getModel().setProperty("/ADDITIONAL_LANGUAGE_ARRAY",m);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",m.length);for(var i=0;i<m.length;i++){var o={};o.ID=m[i].ID;o.IS_ACTIVE=m[i].IS_ACTIVE;o.LANGUAGE=m[i].LANGUAGE_KEY;o.TITLE=m[i].TITLE;o.DESCRIPTION=m[i].DESCRIPTION;t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY.push(o);}t.evalDetails.NO_OF_ADDITIONAL_LANGUAGES=m.length;var p=d.TAGS||[];if(p.length>0){var q="";for(var i=0;i<p.length;i++){q+=p[i].TAG+",";}q=q.substring(0,q.length-1);t.getView().getModel().setProperty("/TAG",q);}var r=d.FILTERS||[];if(r.length){var s=[],u=[],j=0,k=0;for(var i=0;i<r.length;i++){if(r[i].TYPE==="PA"){s[j]={};s[j++]=r[i];}else if(r[i].TYPE==="FI"){u[k]={};u[k++]=r[i];}}if(s.length>0){var v={};v.inputParameters=[];v.inputParameters=t.formObjectForFilters(s);if(t.oModelForInputParameters.getData().inputParameters&&t.oModelForInputParameters.getData().inputParameters.length){for(var i=0;i<t.oModelForInputParameters.getData().inputParameters.length;i++){for(var j=0;j<v.inputParameters.length;j++){if(t.oModelForInputParameters.getData().inputParameters[i].name===v.inputParameters[j].name){t.oModelForInputParameters.getData().inputParameters[i].value_1=v.inputParameters[j].value_1;t.oModelForInputParameters.getData().inputParameters[i].value_2=v.inputParameters[j].value_2;}}}t.oModelForInputParameters.updateBindings();}}if(u.length>0){var w={};w.selectedDimensions=[];w.selectedDimensions=t.formObjectForFilters(u);t.oModelForDimensions.getData().selectedDimensions=w.selectedDimensions;t.oModelForDimensions.updateBindings();}}var x=d.PROPERTIES||[];if(x.length>0){t.getView().getModel().setProperty("/PROPERTIES",x);t.getView().getModel().updateBindings();}var y=d.VALUES||[];if(y.length>0){for(i=0;i<y.length;i++){if(y[i].FIXED){t.populateTargetAndTresholds(y[i].TYPE,y[i].FIXED);}else{t.populateTargetAndTresholds(y[i].TYPE,y[i].COLUMN_NAME);}}}t.busyDialog.close();};var h=new sap.ui.model.Context(t.getView().getModel(),'/'+t.evalContext);t.metadataRef.getEvaluationById({context:h,success:g,error:f,async:false,filters:true,values:true,properties:true,tags:true,texts:true,model:t.oDataModel});},populateAdditionalMeasures:function(t,v){var a=this;var m=a.getView().byId("additionalMeasures");m.addToken(new sap.m.Token({text:v}));a.getView().byId("additionalMeasures").setVisible(true);a.getView().byId("additionalMeasureLabel").setVisible(true);a.getView().byId("selectedLabel").setVisible(true);a.getView().byId("selectedadditionalMeasures").setVisible(true);a.selectedMeasure();},populateTargetAndTresholds:function(t,v){var a=this;switch(t){case"CL":a.getView().getModel().setProperty("/CRITICALLOW",v);break;case"WL":a.getView().getModel().setProperty("/WARNINGLOW",v);break;case"TA":a.getView().getModel().setProperty("/TARGET",v);break;case"CH":a.getView().getModel().setProperty("/CRITICALHIGH",v);break;case"WH":a.getView().getModel().setProperty("/WARNINGHIGH",v);break;case"TC":a.getView().getModel().setProperty("/TREND",v);break;case"RE":a.getView().getModel().setProperty("/REFERENCE_VALUE",v);break;default:a.populateAdditionalMeasures(t,v);}},formObjectForFilters:function(a){var i=0,j=0,k=0,l=0,t=[],b;var d=this.evalDetails.ODATA_URL;var e=this.evalDetails.ODATA_ENTITYSET;var q=sap.suite.ui.smartbusiness.lib.OData.filter(d,e).getAsObject();var c=null;var r=false;var f=null;for(i=0;i<a.length;i++){r=false;f=null;if(q&&q[a[i].NAME]&&q[a[i].NAME].getKeyProperty()&&q[a[i].NAME].getKeyProperty().extensions){c=q[a[i].NAME].getKeyProperty().extensions;for(l=0;l<c.length;l++){if(c[l].name=="required-in-filter"&&c[l].value=="true"){r=true;}if(c[l].name=="filter-restriction"){f=c[l].value;}}}if(a[i].OPERATOR=="BT"){b={};b={"name":a[i].NAME,"operator":a[i].OPERATOR,"value_1":a[i].VALUE_1,"value_2":a[i].VALUE_2};b.required=r;b.filterRestriction=f;t[j++]=b;}else{for(k=0;k<t.length;k++){if((t[k].name==a[i].NAME)&&(t[k].operator==a[i].OPERATOR)){break;}}if(k==t.length){b={};b={"name":a[i].NAME,"operator":a[i].OPERATOR,"value_1":a[i].VALUE_1,"value_2":a[i].VALUE_2};b.required=r;b.filterRestriction=f;t[j++]=b;}else{t[k].value_1+=","+a[i].VALUE_1;}}}return t;},getKpiDetails:function(){var t=this;if(!t.indicatorContext){t.busyDialog.close();t.indicatorContext="INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}var a=new sap.ui.model.Context(t.getView().getModel(),'/'+t.indicatorContext);var b=function(d){var f=d.INDICATOR;if(f.IS_ACTIVE==0){sap.m.MessageToast.show(t.oResourceBundle.getText("ERROR_INACTIVE_KPI_CANNOT_HAVE_EVALUATION"));window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=0)";return;}t.getView().byId("indicatorId").setValueState("None");t.getView().getModel().setProperty("/INDICATOR",f.ID);t.getView().getModel().setProperty("/INDICATORTITLE",f.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",f.DESCRIPTION);t.getView().getModel().setProperty("/OWNER_NAME",f.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",f.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",f.OWNER_E_MAIL);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",f.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",f.ACTION);t.getView().getModel().setProperty("/INDICATOR_TYPE",f.TYPE);t.getView().getModel().setProperty("/VIEW_NAME",f.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",f.ODATA_URL);t.getView().getModel().setProperty("/COLUMN_NAME",f.COLUMN_NAME);t.getView().getModel().setProperty("/GOAL_TYPE",f.GOAL_TYPE);t.getView().getModel().setProperty("/DATA_SPECIFICATION",f.DATA_SPECIFICATION);if(f.DATA_SPECIFICATION!=""){t.byId("additionalInfo").setVisible(true);}else{t.byId("additionalInfo").setVisible(false);}t.createTargetThresholdLayout();if(f.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",f.ODATA_ENTITYSET);t.resetDimensionsAndInputParameters();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));if(t.inputParameterSapClientCheckBox){t.inputParameterSapClientCheckBox.fireSelect();}}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}}var g=d.TAGS||[];if(g.length>0){var h="";for(var i=0;i<g.length;i++){h+=g[i].TAG+",";}h=h.substring(0,h.length-1);t.getView().getModel().setProperty("/TAG",h);}var p=d.PROPERTIES||[];if(p.length>0){t.getView().getModel().setProperty("/PROPERTIES",p);t.getView().getModel().updateBindings();}t.busyDialog.close();};var c=function(d,s,k){t.busyDialog.close();t.getView().byId("indicatorId").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;};t.metadataRef.getKPIById({context:a,async:false,texts:true,tags:true,properties:true,success:b,error:c,model:t.oDataModel});},getEvalParamPayload:function(f){var e={};e.ID=f.ID;e.DESCRIPTION=f.DESCRIPTION;e.INDICATOR=f.INDICATOR;e.ODATA_URL=f.ODATA_URL;e.VIEW_NAME=f.VIEW_NAME;e.COLUMN_NAME=f.COLUMN_NAME;e.OWNER_NAME=f.OWNER_NAME;e.OWNER_E_MAIL=f.OWNER_E_MAIL;e.OWNER_ID=f.OWNER_ID;e.CREATED_BY="";e.CHANGED_BY="";e.IS_ACTIVE=f.IS_ACTIVE;e.SCALING=parseInt(f.SCALING)||0;e.TITLE=f.TITLE;e.ENTITY_TYPE="";e.ODATA_ENTITYSET=f.ODATA_ENTITYSET;e.ODATA_PROPERTY="";e.SEMANTIC_OBJECT=f.SEMANTIC_OBJECT;e.ACTION=f.ACTION;e.DATA_SPECIFICATION=f.DATA_SPECIFICATION;e.GOAL_TYPE=f.GOAL_TYPE;e.INDICATOR_TYPE=f.INDICATOR_TYPE;e.VALUES_SOURCE=f.VALUES_SOURCE;e.DECIMAL_PRECISION=parseInt(f.DECIMAL_PRECISION)||0;return e;},setFilterPayload:function(i,t,n,o,v,a){var b={};b.ID=i;b.IS_ACTIVE=this.getView().getModel().getData().IS_ACTIVE;b.TYPE=t;b.NAME=n;b.OPERATOR=o;b.VALUE_1=v;if(a)b.VALUE_2=a;else b.VALUE_2="";return b;},getInputParamPayload:function(f){var e={},j=0;var a=f.getModel().getData();if(f.getController().oModelForInputParameters){e=f.getController().oModelForInputParameters.getData();if(e.inputParameters){if(e.inputParameters.length>0){var i=0,b=[],c;while(i<e.inputParameters.length){if(e.inputParameters[i].operator==="BT"){if((e[i].value_1!=="")||(e[i].value_2!=="")){b=e.inputParameters[i].value_1.split(",");c=e.inputParameters[i].value_2.split(",");if((c.length===1)&&(!b.length===1)){e.inputParameters[i].value_1=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_1).toJSON():e.inputParameters[i].value_1;e.inputParameters[i].value_2=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_2).toJSON():e.inputParameters[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,e.inputParameters[i].value_1,e.inputParameters[i].value_2);j++;}}}else{b=e.inputParameters[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!==""){b[k]=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,b[k]);j++;}}}}i++;}}}}},getFiltersPayload:function(f){var a=f.getModel().getData();var e={},j=this.evalFiltersPayload.length;if(f.getController().oModelForDimensions){e=f.getController().oModelForDimensions.getData();if(e.selectedDimensions){if(e.selectedDimensions.length>0){var i=0,b=[],c;while(i<e.selectedDimensions.length){if(e.selectedDimensions[i].operator==="BT"){if((e.selectedDimensions[i].value_1!=="")&&(e.selectedDimensions[i].value_2!=="")){b=e.selectedDimensions[i].value_1.split(",");c=e.selectedDimensions[i].value_2.split(",");if((c.length===1)||(!b.length===1)){e.selectedDimensions[i].value_1=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_1).toJSON():e.selectedDimensions[i].value_1;e.selectedDimensions[i].value_2=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_2).toJSON():e.selectedDimensions[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,e.selectedDimensions[i].value_1,e.selectedDimensions[i].value_2);j++;}}}else{b=e.selectedDimensions[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!=""){b[k]=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,b[k]);j++;}}}}i++;}}}}},getThresholdValue:function(i,t,s,v){var o={};o.ID=i;o.TYPE=t;o.IS_ACTIVE=s;var f=this.getView();var a=f.getModel().getData();var b=a.VALUES_SOURCE;if(b==="MEASURE"){o.COLUMN_NAME=v;}if(b==="FIXED"){o.FIXED=v;}if(b==="RELATIVE"){if(t=="TA"||t=="TC"||t=="RE"){o.COLUMN_NAME=v;}else{o.FIXED=v;}}o.ODATA_PROPERTY="";return o;},getRangePayload:function(f){var a=f.getModel().getData();var i=0;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++;}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++;}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++;}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++;}},getMaximizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++;}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++;}},getMinimizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++;}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++;}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}},saveFilters:function(f){this.evalFiltersPayload=[];this.getInputParamPayload(f);this.getFiltersPayload(f);},saveValues:function(f){var t=this;this.valuesPayload=[];var a=f.getModel().getData();switch(a.GOAL_TYPE){case"RA":t.getRangePayload(f);break;case"MA":t.getMaximizingPayload(f);break;case"MI":t.getMinimizingPayload(f);break;}if(a.TREND&&a.TREND!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"TC",a.IS_ACTIVE,a.TREND);i++;}if(a.REFERENCE_VALUE&&a.REFERENCE_VALUE!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"RE",a.IS_ACTIVE,a.REFERENCE_VALUE);i++;}if(t.getView().byId("additionalMeasures").getTokens().length){var b=t.getView().byId("additionalMeasures").getTokens();for(var i=0,j=this.valuesPayload.length;i<b.length;i++){var c="0";if(i.toString().length===1){c="0"+i;}else{c=i.toString();}this.valuesPayload[j++]={ID:a.ID,IS_ACTIVE:a.IS_ACTIVE,TYPE:c,COLUMN_NAME:b[i].getText(),ODATA_PROPERTY:""}}}},saveTags:function(f){var a=f.getModel().getData();this.tagsPayload=[];if(a.TAG){var t=[];t=a.TAG.split(",");for(var i=0;i<t.length;i++){this.tagsPayload[i]={};this.tagsPayload[i].ID=a.ID;this.tagsPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.tagsPayload[i].TYPE="EV";this.tagsPayload[i].TAG=t[i];}}},saveProperties:function(f){var a=f.getModel().getData();this.propPayload=[];if(a.PROPERTIES){for(var i=0;i<a.PROPERTIES.length;i++){this.propPayload[i]={};this.propPayload[i].ID=a.ID;this.propPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.propPayload[i].TYPE="EV";this.propPayload[i].NAME=a.PROPERTIES[i].NAME;this.propPayload[i].VALUE=a.PROPERTIES[i].VALUE;}}},saveAdditionalLanguages:function(f){var t=this;var a=f.getModel().getData();this.languagesPayload=[];if(a.NO_OF_ADDITIONAL_LANGUAGES>0){var i=0,j=0,k=0,b;for(i=0;i<a.ADDITIONAL_LANGUAGE_ARRAY.length;i++){this.languagesPayload[i]={};this.languagesPayload[i].ID=a.ID;this.languagesPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.languagesPayload[i].LANGUAGE=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;this.languagesPayload[i].TITLE=a.ADDITIONAL_LANGUAGE_ARRAY[i].TITLE;this.languagesPayload[i].DESCRIPTION=a.ADDITIONAL_LANGUAGE_ARRAY[i].DESCRIPTION;}}},createBatchForEvalCreateMode:function(e){var t=this;t.evalPayload={};t.evalPayload.ID=t.evalParamPayload.ID;t.evalPayload.IS_ACTIVE=t.evalParamPayload.IS_ACTIVE;t.evalPayload.EVALUATION=t.evalParamPayload;delete t.evalPayload.EVALUATION.ID;delete t.evalPayload.EVALUATION.IS_ACTIVE;t.evalPayload.FILTERS=[];t.evalPayload.FILTERS=t.evalFiltersPayload;for(var i=0;i<t.evalPayload.FILTERS.length;i++){delete t.evalPayload.FILTERS[i].ID;delete t.evalPayload.FILTERS[i].IS_ACTIVE;}t.evalPayload.VALUES=[];t.evalPayload.VALUES=t.valuesPayload;for(var i=0;i<t.evalPayload.VALUES.length;i++){delete t.evalPayload.VALUES[i].ID;delete t.evalPayload.VALUES[i].IS_ACTIVE;}t.evalPayload.TAGS=[];t.evalPayload.TAGS=t.tagsPayload;for(var i=0;i<t.evalPayload.TAGS.length;i++){delete t.evalPayload.TAGS[i].ID;delete t.evalPayload.TAGS[i].IS_ACTIVE;}t.evalPayload.PROPERTIES=[];t.evalPayload.PROPERTIES=t.propPayload;for(var i=0;i<t.evalPayload.PROPERTIES.length;i++){delete t.evalPayload.PROPERTIES[i].ID;delete t.evalPayload.PROPERTIES[i].IS_ACTIVE;}t.evalPayload.TEXTS=[];t.evalPayload.TEXTS=t.languagesPayload;for(var i=0;i<t.evalPayload.TEXTS.length;i++){delete t.evalPayload.TEXTS[i].ID;delete t.evalPayload.TEXTS[i].IS_ACTIVE;}var a={payload:t.evalPayload};a.keys={};a.keys.ID=t.evalPayload.ID;a.keys.IS_ACTIVE=t.evalPayload.IS_ACTIVE;delete a.ID;delete a.IS_ACTIVE;var u="EVALUATION";t.metadataRef.create(u,a,null,function(d){t.saveSuccessHandling(e);},function(b){t.saveErrorHandling(b);});},createBatchPayload:function(e){var t=this,i=0;var p,u=false;var a={};var b={};var f=t.getView().getModel().getData();a.ID=f.ID;a.IS_ACTIVE=f.IS_ACTIVE;b.oldPayload=t.getEvalParamPayload(t.evalDetails);b.newPayload=t.evalParamPayload;b.objectType="Evaluations";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);if(b.updates.length>0){a.EVALUATION={};a.EVALUATION.update={};a.EVALUATION.update=t.evalParamPayload;delete a.EVALUATION.update.ID;delete a.EVALUATION.update.IS_ACTIVE;u=true;}b.oldPayload=t.evalDetails.FILTERS;b.newPayload=t.evalFiltersPayload;b.objectType="EVALUATION_FILTERS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.FILTERS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.FILTERS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.FILTERS.create=b.updates;u=true;}for(i=0;i<t.evalDetails.VALUES.length;i++){if(t.evalDetails.VALUES[i].COLUMN_NAME){delete t.evalDetails.VALUES[i].FIXED;}else{delete t.evalDetails.VALUES[i].COLUMN_NAME;}}b.oldPayload=t.evalDetails.VALUES;b.newPayload=t.valuesPayload;b.objectType="EVALUATION_VALUES";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.VALUES={};if(b.deletes.length>0){for(var i=0;i<b.deletes;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.VALUES.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.VALUES.create=b.updates;u=true;}b.oldPayload=t.evalDetails.TAGS;b.newPayload=t.tagsPayload;b.objectType="TAGS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.TAGS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.TAGS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.TAGS.create=b.updates;u=true;}b.oldPayload=t.evalDetails.PROPERTIES;b.newPayload=t.propPayload;b.objectType="PROPERTIES";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.PROPERTIES={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.PROPERTIES.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.PROPERTIES.create=b.updates;u=true;}b.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;b.newPayload=t.languagesPayload;b.objectType="EVALUATION_TEXTS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.TEXTS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.TEXTS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.TEXTS.create=b.updates;u=true;}if(!u){t.busyDialog.close();t.saveSuccessHandling(e);return;}else{var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;var d="EVALUATION";t.metadataRef.update(d,c,null,function(g){t.saveSuccessHandling(e);},function(g){t.saveErrorHandling(g);});}},saveErrorHandling:function(e){var t=this;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVAL_SAVE")});t.errorState=true;t.busyDialog.close();},saveSuccessHandling:function(e){var t=this;sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_SAVE"));if(e==="activate"||e==="saveActivate"||e==="activateAndCreateNew"){var o={};o.ID=t.getView().getModel().getData().ID;var u="ACTIVATE_EVALUATION";t.metadataRef.create(u,o,null,function(d){t.busyDialog.close();sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_ACTIVATE"));if(e==="activate"){window.location.hash="FioriApplication-configureSBKPITile?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(e==="saveActivate"&&!t.fromHome){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(e==="activateAndCreateNew"){t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext;}else if(t.fromHome){window.location.hash="";}},function(a){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION")});t.errorState=true;});}else if(e=="create"){t.busyDialog.close();if(t.fromHome){window.location.hash="";}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(t.duplicateEval){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)";}else if(t.evalDetails){var i=t.evalDetails.IS_ACTIVE;window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+i+")";}else{window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)";}}}else if(e=="createNew"){t.busyDialog.close();t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext;}t.busyDialog.close();},setFooterOnError:function(){if(this.editDraft===true){if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oOptionsOnErrorForEdit);}else{this.setHeaderFooterOptions(this.oOptionsForEdit);}}else{if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oOptionsOnErrorForCreate);}else{this.setHeaderFooterOptions(this.oOptionsForCreate);}}},saveAndExit:function(e){var t=this;t.createBatch=[];t.deleteBatch=[];this.errorMessages=[];this.errorState=false;var a=false;var f=t.getView().getModel().getData();var d={errorMsg:[]};if(this.VIEW_MODE==="hana"){t.byId("odataServiceInput").setValueState("None");}else{t.byId("odataServiceInputCDS").setValueState("None");}t.byId("entitySetInput").setValueState("None");t.byId("valueMeasureInput").setValueState("None");if(!(f.INDICATOR)||f.INDICATOR.trim()===""){t.byId("indicatorId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_SELECT_KPI"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_SELECT_KPI")});t.errorState=true;a=true;}if(!(f.ID)){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(!(f.TITLE)||f.TITLE.trim()===""){t.byId("evalTitle").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE")});t.errorState=true;a=true;}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(a){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(t.byId("indicatorId").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;a=true;}if(t.byId("evalOwnerEmail").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL")});t.errorState=true;a=true;}if(t.byId("semanticObject").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});t.errorState=true;a=true;}if(t.byId("action").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});t.errorState=true;a=true;}if(t.byId("evalTitle").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVALUATION_TITLE")});t.errorState=true;a=true;}if(f.mode==="edit"){if(!f.ID){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(t.byId("evalId").getValueState()==="Error"){if(t.evalIdEval_reason=="NOT_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else if(t.evalIdEval_reason=="_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else{d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;a=true;}}}else{if(!t.validateEvalId()){if(!f.ID){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(t.byId("evalId").getValueState()==="Error"){if(t.evalIdEval_reason=="NOT_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else if(t.evalIdEval_reason=="_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else{d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;a=true;}}}else{return;}}if(f.VALUES_SOURCE==="FIXED"){var n=this._areEvaluationValuesNumber(this.getView().getModel().getData());if(n.length){var b="";for(i=0;i<n.length;i++){b=b+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_"+n[i])+"\n";}d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}else{var v=this.validateEvaluationValues(this.getView().getModel().getData());if(v.length){var b=this.oResourceBundle.getText("ERROR_ENTER_VALID_THRESHOLD_VALUES");var i;for(i=0;i<v.length;i++){if(v[i]==="CL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("CRITICAL_LOW");}else{b=b+"\n"+this.oResourceBundle.getText("CRITICAL");}}if(v[i]==="WL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("WARNING_LOW");}else{b=b+"\n"+this.oResourceBundle.getText("WARNING");}}if(v[i]==="TA"){b=b+"\n"+this.oResourceBundle.getText("TARGET");}if(v[i]==="CH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("CRITICAL_HIGH");}else{b=b+"\n"+this.oResourceBundle.getText("CRITICAL");}}if(v[i]==="WH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("WARNING_HIGH");}else{b=b+"\n"+this.oResourceBundle.getText("WARNING");}}}d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}}}if(f.VALUES_SOURCE==="RELATIVE"){var c=this.getView().getModel().getData();var p=/^(?=.*\d)\d*(?:\.\d\d)?$/;var b="";if(c.GOAL_TYPE==="MA"){if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&parseInt(c.WARNINGLOW)<=parseInt(c.CRITICALLOW)){b+=this.oResourceBundle.getText("CRITICAL_SHOULD_BE_LESS_THAN_WARNING");}if(c.WARNINGLOW>=100&&(c.WARNINGLOW!=""&&c.WARNINGLOW!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_SHOULD_BE_LESS_THAN_100");}if(c.CRITICALLOW!=""&&(c.CRITICALLOW>=100&&c.CRITICALLOW!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_SHOULD_BE_LESS_THAN_100");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&!p.test(c.WARNINGLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING");}if((c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&!p.test(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}}if(c.GOAL_TYPE==="MI"){if((c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)&&parseInt(c.CRITICALHIGH)<=parseInt(c.WARNINGHIGH)){b+=this.oResourceBundle.getText("CRITICAL_SHOULD_BE_MORE_THAN_WARNING");}if(c.CRITICALHIGH<=100&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_SHOULD_BE_MORE_THAN_100");}if(c.WARNINGHIGH<=100&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_SHOULD_BE_MORE_THAN_100");}if(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null&&!p.test(c.CRITICALHIGH)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}if((c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null&&!p.test(c.WARNINGHIGH))){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING");}}if(c.GOAL_TYPE==="RA"){if((c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&parseInt(c.CRITICALHIGH)<=parseInt(c.WARNINGHIGH)){b+=this.oResourceBundle.getText("CRITICAL_HIGH_MORE_THAN_WARNING_HIGH");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&parseInt(c.WARNINGLOW)<=parseInt(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("WARNING_LOW_MORE_THAN_CRITICAL_LOW");}if(c.CRITICALHIGH<=100&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_HIGH_SHOULD_BE_MORE_THAN_100");}if(c.WARNINGHIGH<=100&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_HIGH_SHOULD_BE_MORE_THAN_100");}if(c.CRITICALLOW>=100&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_LOW_SHOULD_BE_LESS_THAN_100");}if(c.WARNINGLOW>=100&&(c.WARNINGLOW!=""&&c.WARNINGLOW!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_LOW_SHOULD_BE_LESS_THAN_100");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&!p.test(c.WARNINGLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING_LOW");}if((c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&!p.test(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL_LOW");}if(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null&&!p.test(c.CRITICALHIGH)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL_HIGH");}if((c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null&&!p.test(c.WARNINGHIGH))){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING_HIGH");}}if(b!=""){d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}}if(!t.indicatorContext){t.indicatorContext="INDICATORS_MODELER(ID='"+f.INDICATOR+"',IS_ACTIVE=1)";}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(a){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}t.isPropertyAdded=true;if(t.getView().byId("propertyName").getValue()||t.getView().byId("propertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}t.busyDialog.open();t.evalParamPayload={};t.evalParamPayload=t.getEvalParamPayload(t.getView().getModel().getData());t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());if(!e){e="create";}if(f.mode==="create"){t.createBatch=t.createBatchForEvalCreateMode(e);}else if(f.mode==="edit"){if(t.evalDetails.IS_ACTIVE===0&&f.IS_ACTIVE===0){t.createBatchPayload(e);}else if(t.evalDetails.IS_ACTIVE===1&&f.IS_ACTIVE===0){t.getView().getModel().setProperty("/mode","create");t.createBatch=t.createBatchForEvalCreateMode(e);}}},saveAndCreateNew:function(e){this.saveAndExit("createNew");},saveAndActivate:function(){var t=this;t.checkForActivation("saveActivate");},activateAndCreateNew:function(){this.checkForActivation("activateAndCreateNew")},checkForActivation:function(p){var t=this;var e=false;var f=t.getView().getModel().getData();this.errorMessages=[];this.errorState=false;var d={errorMsg:[]};if(!(f.INDICATOR)||f.INDICATOR.trim()===""){t.byId("indicatorId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_SELECT_KPI"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_SELECT_KPI")});t.errorState=true;e=true;}if(!(f.ID)){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;e=true;}if(!(f.TITLE)||f.TITLE.trim()===""){t.byId("evalTitle").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE")});t.errorState=true;e=true;}var a=t.validateDimensionsAndInputParameters();if(a.error){if(a.errorType==="mandatoryFieldEmpty"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS")});t.errorState=true;e=true;}if(a.errorType==="fieldEmpty"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES")});t.errorState=true;e=true;}if(a.errorType==="invalidEntry"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",a.errorDimension.name),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",a.errorDimension.name)});t.errorState=true;e=true;}}if(f.ODATA_URL===""){if(this.VIEW_MODE==="hana"){t.byId("odataServiceInput").setValueState("Error");}else{t.byId("odataServiceInputCDS").setValueState("Error");}d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL")});t.errorState=true;e=true;}if(!f.ODATA_ENTITYSET||f.ODATA_ENTITYSET===""){t.byId("entitySetInput").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;e=true;}if(!f.COLUMN_NAME||f.COLUMN_NAME===""){t.byId("valueMeasureInput").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_MEASURE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_MEASURE")});t.errorState=true;e=true;}if(this.inputParameterSapClientCheckBox&&this.inputParameterSapClientCheckBox.getSelected()){if(this.sessionClientFetchError&&this.VIEW_MODE!="cds"){d.errorMsg.push({text:t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED")});t.errorState=true;e=true;}}if(t.getView().byId("additionalMeasures").getTokens().length){var b=t.getView().byId("additionalMeasures").getTokens();for(var i=0,l=b.length;i<l;i++){if(b[i].getText()==f.COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE")});t.errorState=true;e=true;}}}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADER")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(e){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(!f.TARGET||f.TARGET==""){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ERROR_TARGET_NOT_ENTERED")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();t.saveAndExit(p);}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{t.saveAndExit(p);}},activateAndAddTiles:function(){var t=this;t.checkForActivation("activate");},cancel:function(){this.navigateBack();},deleteDraft:function(){var t=this;var o={};o.ID=t.getView().getModel().getData().ID;o.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;var u="EVALUATION";t.metadataRef.remove(u,o,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_DELETING_DRAFT"));window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)";},function(e){sap.suite.ui.smartbusiness.lib.Utlib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_DELETING_DRAFT"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_DELETING_DRAFT")});t.errorState=true;});},validateEvalId:function(){var t=this;var e=this.getView().byId('evalId');var i=0;var a=e.getValue();if(this.VIEW_MODE==this.CDS){e.setValue(a.toUpperCase());}if(a){if(a.lastIndexOf(this.RESERVED_EVAL_ID_NAMESPACE,0)===0){e.setValueState("Error");return false;}else if(this.VIEW_MODE==this.CDS&&a[0]!='.'){this.evalIdEval_reason="NOT_START_WITH_PERIOD";e.setValueState("Error");return false;}else if(this.VIEW_MODE==this.HANA&&a[0]=='.'){this.evalIdEval_reason="_START_WITH_PERIOD";e.setValueState("Error");return false;}else if(!(/^[a-zA-Z0-9.]*$/.test(a))||a.length>this.valid_maxlength[this.VIEW_MODE].id){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;e.setValueState("Error");return true;}else{e.setValueState("None");var b=function(d){if(d.length>0){if(d[0].ID){e.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a)});t.errorState=true;return true;}else{e.setValueState("None");}}else{e.setValueState("None");}};var c=function(){e.setValueState("None");};this.metadataRef.getDataByEntity({entity:"EVALUATIONS",filter:"ID eq '"+a+"'",async:false,success:b,error:c,model:this.oDataModel});}}return false;},validateEvalTitle:function(){var e=this.getView().byId('evalTitle');var a=e.getValue();if(!a){e.setValueState("Error");return false;}if(a.length>this.valid_maxlength[this.VIEW_MODE].title){e.setValueState("Error");return false}else{e.setValueState("None");return true;}},validateEmailAddress:function(){var t=this;var e=this.getView().byId('evalOwnerEmail');var a=e.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){e.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL")});t.errorState=true;}else{e.setValueState("None");}}else{e.setValueState("None");}},listAllKpis:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_KPI"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{EVALUATION_COUNT}",firstStatus:new sap.m.ObjectStatus({text:"Evaluations",}),attributes:[new sap.m.ObjectAttribute({text:"{ID}",visible:"{SB_APP_SETTING>/ID_VISIBLE}"})]})},confirm:function(e){t.busyDialog.open();t.indicatorContext="INDICATORS_MODELER(ID='"+e.getParameter("selectedItem").getBindingContext().getProperty("ID")+"',IS_ACTIVE=1)";t.getKpiDetails();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var b=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a],true);b.filter(new sap.ui.model.Filter([c,d],true));}});h.setModel(t.oDataModel);var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));h.getBinding("items").filter(new sap.ui.model.Filter(f,true));h.open();},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o;}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var v=t.VIEW_MODE==t.CDS?"viewInputCDS":"viewInput";t.getView().byId(v).setValueState("None");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject();t.byId('viewInput').fireChange();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(this.oDataModel);h.open();},handleCDSViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"PackName",type:new sap.ui.model.type.String()},{path:"CdsName",type:new sap.ui.model.type.String()}],formatter:function(p,c){return p+"::"+c;}}})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/VIEW_NAME_CdsName",e.getParameter("selectedItem").getBindingContext().getProperty("CdsName"));t.getView().getModel().setProperty("/VIEW_NAME_PackName",e.getParameter("selectedItem").getBindingContext().getProperty("PackName"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var v=t.VIEW_MODE==t.CDS?"viewInputCDS":"viewInput";t.getView().byId(v).setValueState("None");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject();},liveChange:function(e){var i,s,a,b,c;s=a=b=e.getParameter("value").toUpperCase();c=false;if((i=s.lastIndexOf("::"))!==-1){a=s.substring(0,i);b=s.substring(i+2,s.length);c=true;}var f=new sap.ui.model.Filter("PackName",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("CdsName",sap.ui.model.FilterOperator.Contains,b);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f,F],c));}});this.oDataModelCDS.read("/CDSViewSet",null,null,false,function(d){var d=d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);h.setModel(c);});h.open();},hanaViewChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var a=this.VIEW_MODE==this.CDS?"viewInputCDS":"viewInput";if(!(v.getSource().getValue()==="")){t.getView().byId(a).setValueState("None");}var o=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters();},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW"));t.getView().byId("viewInput").setValueState("Error");t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW")});t.errorState=true;}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata";}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.currentSelectedODataUrlObject=e.getParameter("selectedItem").getBindingContext().getObject();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oDataModel);h.open();}},handleOdataServiceValueHelpCDS:function(){var t=this;if(!t.byId("viewInputCDS").getValue()){var r="/PackOdataSet";var e=null;}else{var s=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_PackName"));var r="/CDSViewSet(CdsName='"+s+"')/?$expand=ODATAnameSet";var e="ODATAnameSet";}var b=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"OdataURL",type:new sap.ui.model.type.String()}],formatter:function(o){return(function(h){return jQuery("<a>").attr("href",h)[0]["pathname"]})(o);}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_URL",E.getParameter("selectedItem").getProperty("title"));var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");},liveChange:function(E){var c=E.getParameter("value");var f=new sap.ui.model.Filter("OdataURL",sap.ui.model.FilterOperator.Contains,c);var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});this.oDataModelCDS.read(r,null,null,false,function(d){var d=e?d[e].results:d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);b.setModel(c);});b.open();},oDataUrlChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var o=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!(v.getSource().getValue()==="")){t.getView().byId(o).setValueState("None");}t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters();},handleEntitySetValueHelp:function(){var t=this;var a=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!t.byId(a).getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL")});t.errorState=true;}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.getView().byId("entitySetInput").setValueState("None");t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});var C=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"EntityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});try{if(t.getView().getModel().getData().VIEW_NAME){if(this.VIEW_MODE!=this.CDS){t.populateRelevantEntitySet(h);}else{t.populateRelevantEntitySet_CDS(C);}}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId(a).getValue());h.setModel(t.oModelForEntity);h.open();}}catch(b){}}},entitySetChange:function(v){var t=this;t.resetAdditionalMeasures();if(t.getView().getModel().getProperty("/ODATA_URL")&&t.getView().getModel().getProperty("/ODATA_ENTITYSET")){try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.getView().byId("entitySetInput").setValueState("None");}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}}else{t.resetDimensionsAndInputParameters();t.getView().byId("entitySetInput").setValueState("None");t.getView().getModel().setProperty("/COLUMN_NAME","");}},handleMeasureValueHelp:function(){var t=this;var t=this;if(!t.byId("entitySetInput").getValue()){t.byId("entitySetInput").setValueState("Error");t.byId("valueMeasureInput").setValueState("None");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var m=t.mProperties.getLabelMappingObject();var a=t.oModelForMeasure.getData().measures;for(var i=0,l=a.length;i<l;i++){a[i].measureLabel=m[a[i].measureName];}t.oModelForMeasure.setData({measures:a});}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureLabel",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},description:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}}})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getBindingContext().getProperty("measureName"));t.getView().byId("valueMeasureInput").setValueState("None");},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("measureLabel",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oModelForMeasure);h.open();}},measureChange:function(v){var t=this;if(!t.byId("entitySetInput").getValue()){t.byId("entitySetInput").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.getView().byId("valueMeasureInput").setValueState("None");}catch(e){}}},validateSemantic:function(e){var t=this;if(e.getParameter("value").indexOf(' ')===-1){this.byId(e.getParameter("id")).setValueState("None");}else{this.byId(e.getParameter("id")).setValueState("Error");}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"));},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();t.metadataRef.populateRelevantEntitySet(d,m,t);},populateRelevantEntitySet_CDS:function(d){var s=encodeURIComponent(this.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(this.getView().getModel().getProperty("/ODATA_URL"));var e="EntityTypeSet";var u="/ODATAnameSet(CdsName='"+s+"\',OdataName='',OdataURL='"+a+"',SrvName='',SrvVersion='',SrvNamespace='')/?$expand="+e;this.oDataModelCDS.read(u,null,null,false,function(b){var b=b[e].results;var c=new sap.ui.model.json.JSONModel();c.setData(b);d.setModel(c);d.open();});},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.ui.smartbusiness.lib.Util.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o);}m.setData({entitySet:e});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o);}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M;},additionalInformationForKpi:function(e){var t=this;t.dialogAdditionalInfo=new sap.m.Dialog({type:"Message",title:t.oResourceBundle.getText("ADDITIONAL_INFO_FROM_KPI"),content:[new sap.m.Label({text:{path:'/DATA_SPECIFICATION',formatter:function(v){if(t.getView().getModel().getData().DATA_SPECIFICATION){return t.getView().getModel().getData().DATA_SPECIFICATION;}else{return t.oResourceBundle.getText("ERROR_NO_DATA_TO_DISPLAY");}}}})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CLOSE"),press:function(E){E.getSource().getParent().close();}})});t.dialogAdditionalInfo.setModel(t.getView().getModel());t.dialogAdditionalInfo.open();},openDecimalInfo:function(e){var t=this;var c=new sap.m.Bar({width:"100%",contentMiddle:[new sap.m.Label({text:t.oResourceBundle.getText("DECIMAL_PRECISION")})],contentRight:[new sap.m.Button({icon:"sap-icon://decline",press:function(){i.close();}})]});var i=new sap.m.ResponsivePopover({showHeader:true,customHeader:c,contentWidth:"15%",contentHeight:"20%",verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Right,content:[new sap.m.Text({width:"100%",textAlign:"Left",text:t.oResourceBundle.getText("INFO_TEXT_DECIMAL_PRECISION")}).addStyleClass("evaluationThresholdInfoHeader")]});i.openBy(e.getSource());},addNewProperty:function(){var t=this;if(this.getView().byId("propertyName").getValue()){this.getView().byId("propertyName").setValueState("None");if(this.getView().byId("propertyValue").getValue()){this.getView().byId("propertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("propertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("propertyValue").getValue())){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS")});t.errorState=true;}}p.getData().PROPERTIES.push({NAME:this.getView().byId("propertyName").getValue(),VALUE:this.getView().byId("propertyValue").getValue()});p.updateBindings();this.getView().byId("propertyName").setValue("");this.getView().byId("propertyValue").setValue("");}else{t.isPropertyAdded=false;this.getView().byId("propertyValue").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE")});t.errorState=true;}}else{t.isPropertyAdded=false;this.getView().byId("propertyName").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME")});t.errorState=true;}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings();},_appendSystemAlias:function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s);}}return u;},populateDimensionsAndInputParameters:function(d,e){var t=this;d=this._appendSystemAlias(d);var a=[];var b=[];var m=[];var c=[];this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(d),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e);this.queryResultFilters=sap.suite.ui.smartbusiness.lib.OData.filter(d,e);var q=this.queryResultFilters.getAsObject();for(l in q){var n=q[l].getName();var p=q[l].getKeyProperty().type;var f=q[l].getKeyProperty().extensions;var r=false;var g=null;var h=this.queryResultFilters.getMandatoryList().length;for(var i=0;i<f.length;i++){if(f[i].name=="required-in-filter"&&f[i].value=="true"){r=true;}if(f[i].name=="filter-restriction"){g=f[i].value;}}var j={name:n,propertyType:p,required:r,filterRestriction:g};a.push(j);}var k=this.oModelForDimensions.getData();k.dimensions=a;k.dimensions.sort();k.dataSource=d;k.entitySet=e;if(k.selectedDimensions){for(var l in k.selectedDimensions){k.selectedDimensions[l].propertyType=this.queryResultObj.findDimensionByName(k.selectedDimensions[l].name)?this.queryResultObj.findDimensionByName(k.selectedDimensions[l].name).getKeyProperty().type:"";if(k.selectedDimensions[l].propertyType=="Edm.DateTime"){var v=k.selectedDimensions[l].value_1.split(",");for(i in v){if(v[i]!=""){var o=new Date(v[i]);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}k.selectedDimensions[l].value_1=v.join(",");v=null;v=k.selectedDimensions[l].value_2.split(",");for(var i in v){if(v[i]!=""){var o=new Date(k.selectedDimensions[l].value_2);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}k.selectedDimensions[l].value_2=v.join(",");this.dimensionValue[k.selectedDimensions[l].name]=this.dimensionValue[k.selectedDimensions[l].name]?this.dimensionValue[k.selectedDimensions[l].name]:{};this.dimensionValue[k.selectedDimensions[l].name]["value_1"]=k.selectedDimensions[l].value_1;this.dimensionValue[k.selectedDimensions[l].name]["value_2"]=k.selectedDimensions[l].value_2;}}}else{if(h){k.selectedDimensions=[];for(var i=0;i<k.dimensions.length;i++){if(k.dimensions[i].required==true){var z=this._cloneObj(k.dimensions[i]);z.value_1="";z.value_2="";if(k.dimensions[i].filterRestriction=="interval"){z.operator="BT";}else if(k.dimensions[i].filterRestriction=="single-value"){z.operator="EQ";}else{z.operator="EQ";}k.selectedDimensions.push(z);}}}}if(h){this.byId("mandatoryFiltersDataGrid").setVisible(true);if(t.VIEW_MODE!="cds"){var A;for(l in k.selectedDimensions){if((t.sessionClientXsjsMissing!==true)&&(k.selectedDimensions[l].name==="P_SAPClient"||k.selectedDimensions[l].name==="V_SAPClient"||k.selectedDimensions[l].name==="SAPClient")&&k.selectedDimensions[l].required){A=k.selectedDimensions.splice(l,1);if(this.getView().getModel().getData().mode==="create"&&(!this.evalDetails||this.evalDetails.IS_ACTIVE===0)){A[0].value_1="$$$";t.hasSapClient=true;}k.selectedDimensions.push(A[0]);break;}}}}else{this.byId("mandatoryFiltersDataGrid").setVisible(false);}this.oModelForDimensions.setData(k);var B=this.queryResultObj.getParameterization();if(B){if(this.oModelForInputParameters.getData().inputParameters){var b=this.oModelForInputParameters.getData().inputParameters;for(var l in b){b[l].propertyType=B.findParameterByName(b[l].name).getProperty().type;if(b[l].propertyType=="Edm.DateTime"){var v=b[l].value_1.split(",");for(i in v){if(v[i]!=""){var o=new Date(v[i]);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}b[l].value_1=v.join(",");v=null;v=b[l].value_2.split(",");for(var i in v){if(v[i]!=""){var o=new Date(k.selectedDimensions[l].value_2);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}b[l].value_2=v.join(",");}}}else{var C=B.getAllParameters();for(var l in C){var n=C[l].getName();var p=C[l].getProperty().type;var D=C[l].isOptional();var j={name:n,propertyType:p,operator:"EQ",value_1:"",value_2:""};b.push(j);}}if(b.length>0){this.byId("noInputParameterGrid").setVisible(false);this.byId("inputParameterDataGrid").setVisible(true);}else{this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);}k=this.oModelForInputParameters.getData();k.inputParameters=b;var E;if(k.inputParameters.length>0){if(t.VIEW_MODE!="cds"){for(l in k.inputParameters){if((t.sessionClientXsjsMissing!==true)&&k.inputParameters[l].name==="P_SAPClient"||k.inputParameters[l].name==="V_SAPClient"||k.inputParameters[l].name==="SAPClient"){E=k.inputParameters.splice(l,1);if(this.getView().getModel().getData().mode==="create"&&(!this.evalDetails||this.evalDetails.IS_ACTIVE===0)){E[0].value_1="$$$";}k.inputParameters.push(E[0]);break;}}}}this.oModelForInputParameters.setData(k);}},setInputParameterAndFilterLayout:function(){var t=this;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);this.byId("mandatoryFiltersDataGrid").setVisible(false);this.byId("inputParameterBaseLayout").setModel(this.oModelForInputParameters);this.byId("inputParameterBaseLayout").bindAggregation("items","/inputParameters",function(i,c){t.inputParameterOperator=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.inputParameterValue=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});if((t.VIEW_MODE!="cds")&&(c.getProperty().name==="P_SAPClient"||c.getProperty().name==="V_SAPClient"||c.getProperty().name==="SAPClient")&&(t.sessionClientXsjsMissing!==true)){t.inputParameterSapClientCheckBox=new sap.m.CheckBox({text:t.oResourceBundle.getText("PICK_FROM_HANA_SESSION_CLIENT"),selected:{path:"value_1",formatter:function(v){if(v==="$$$"){return true;}else{return false;}}},select:function(){var l=this.getModel().getData().inputParameters.length;if(this.getSelected()===true){if(t.sessionClientFetchError){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED"));}t.inputParameterValue.setVisible(false);this.getModel().getData().inputParameters[l-1].value_1="$$$";}else{t.inputParameterValue.setVisible(true);if(this.getModel().getData().inputParameters[l-1].value_1==="$$$"){t.inputParameterValue.setValue("");}}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.inputParameterOperator=t.inputParameterSapClientCheckBox;if(t.getView().getModel().getData().mode==="create"){t.inputParameterValue.setVisible(false);}}t.inputParameterGrid=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),t.inputParameterOperator,t.inputParameterValue]});return t.inputParameterGrid;});this.byId("mandatoryFilterBaseLayout").setModel(this.oModelForDimensions);this.byId("mandatoryFilterBaseLayout").bindAggregation("items","/selectedDimensions",function(i,c){t.mandatoryFilterOperator=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:(c.getObject().filterRestriction!="interval")?t.oResourceBundle.getText("EQUAL_TO"):t.oResourceBundle.getText("BETWEEN"),key:(c.getObject().filterRestriction!="interval")?"EQ":"BT"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterValue=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterValueTo=new sap.m.Input({value:"{value_2}",visible:(c.getObject().filterRestriction!="interval")?false:true,customData:[{key:"valueType",value:"value_2"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});if((t.VIEW_MODE!="cds")&&(c.getProperty().name==="P_SAPClient"||c.getProperty().name==="V_SAPClient"||c.getProperty().name==="SAPClient")&&(t.sessionClientXsjsMissing!==true)){t.mandatoryFilterSapClientCheckBox=new sap.m.CheckBox({text:t.oResourceBundle.getText("PICK_FROM_HANA_SESSION_CLIENT"),selected:{path:"value_1",formatter:function(v){if(v==="$$$"){return true;}else{return false;}}},select:function(){var l=this.getModel().getData().selectedDimensions.length;if(this.getSelected()===true){t.mandatoryFilterValue.setVisible(false);this.getModel().getData().selectedDimensions[l-1].value_1="$$$";}else{t.mandatoryFilterValue.setVisible(true);if(this.getModel().getData().selectedDimensions[l-1].value_1==="$$$"){t.mandatoryFilterValue.setValue("");}}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterOperator=t.mandatoryFilterSapClientCheckBox;if(t.getView().getModel().getData().mode==="create"){t.mandatoryFilterValue.setVisible(false);}}t.mandatoryFilterGrid=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),t.mandatoryFilterOperator,t.mandatoryFilterValue,t.mandatoryFilterValueTo]});return t.mandatoryFilterGrid;});var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.EQ,true);this.byId("mandatoryFilterBaseLayout").getBinding("items").filter(f);this.byId("dimensionLayoutHeaders").setVisible(false);this.byId("baseDimensionLayout").setModel(this.oModelForDimensions);this.byId("baseDimensionLayout").bindAggregation("items","/selectedDimensions",function(i,c){var d=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:t.formatOptionalFiltersOperators(c),selectedKey:"{operator}",change:jQuery.proxy(t.handleOperatorChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var a=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],showValueHelp:true,valueState:{path:"error_1",formatter:function(k){if(k)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var b=new sap.m.Input({value:"{value_2}",customData:[{key:"valueType",value:"value_2"}],showValueHelp:true,visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}},valueState:{path:"error_2",formatter:function(k){if(k)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueToHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var e=new sap.m.Label({text:"To",visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}}});var g=new sap.m.VBox({items:[a,e,b],layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var h=new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L1 M1 S1"}),press:function(k){var p=k.getSource().getBindingContext().getPath();if(t.dimensionValue){if(t.dimensionValue[k.getSource().getBindingContext().getObject().name]){delete t.dimensionValue[k.getSource().getBindingContext().getObject().name];}}k.getSource().getBindingContext().getModel().getData().selectedDimensions.splice(p.substring(p.lastIndexOf("/")+1),1);k.getSource().getBindingContext().getModel().updateBindings();if(k.getSource().getBindingContext().getModel().getData().selectedDimensions.length==0){t.byId("dimensionLayoutHeaders").setVisible(false);}}});var j=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),d,g,h]});return j;});var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.NE,true);this.byId("baseDimensionLayout").getBinding("items").filter(f);},formatOptionalFiltersOperators:function(c){var p=c.getPath().replace(/\D/g,'');var f=c.getModel().oData.selectedDimensions[p].filterRestriction||null;switch(f){case"single-value":return[new sap.ui.core.Item({text:this.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})];break;default:return[new sap.ui.core.Item({text:this.oResourceBundle.getText("EQUAL_TO"),key:"EQ"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("GREATER_THAN"),key:"GT"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("LESS_THAN"),key:"LT"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("NOT_EQUAL_TO"),key:"NE"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("BETWEEN"),key:"BT"})];break;}},openInputParameterValueHelpDialog:function(n){var t=this;var i=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",template:new sap.m.StandardListItem({title:"{"+n+"}",})},confirm:function(e){},liveChange:function(e){}});i.setGrowingThreshold(100);i.open();},openDimensionDialog:function(){var t=this;var s=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"P_SAPClient");var a=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"V_SAPClient");var b=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"SAPClient");var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.NE,true);var c=new sap.ui.model.Filter([s,a,b],true);if(!this.dimensionDialog){var S=new sap.ui.model.Sorter("label",false);this.dimensionDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_DIMENSION_TO_ADD_FILTERS"),multiSelect:true,items:{path:"/dimensions",sorter:S,template:new sap.m.StandardListItem({title:"{label}",description:"{name}"})},confirm:function(E){var j=t.oModelForDimensions.getData().selectedDimensions||[];var k=E.getParameter("selectedItems");var C=[];for(var m in k){C[m]=k[m].getBindingContext();}for(var m in C){var n=t._cloneObj(C[m].getObject());n.value_1="";n.value_2="";n.operator="EQ";j.unshift(n);}if(C.length>0)t.byId("dimensionLayoutHeaders").setVisible(true);else t.byId("dimensionLayoutHeaders").setVisible(false);t.oModelForDimensions.setProperty("/selectedDimensions",j);},liveChange:function(E){var j=E.getParameter("value");var k;var F=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,j);var o=new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,j);var m=new sap.ui.model.Filter([F,o],false);var n=new sap.ui.model.Filter([f],true);if(t.hasSapClient===true){k=new sap.ui.model.Filter([c,n],true);}else{k=new sap.ui.model.Filter([n],true);}var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([m,k],true));}});this.dimensionDialog.setGrowingThreshold(100);try{t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var d=t.mProperties.getLabelMappingObject();var g=t.oModelForDimensions.getData();var h=t.oModelForDimensions.getData().dimensions;for(var i=0,l=h.length;i<l;i++){h[i].label=d[h[i].name];}g.dimensions=h;t.oModelForDimensions.setData(g);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.dimensionDialog.setModel(this.oModelForDimensions);}if(t.hasSapClient===true){this.dimensionDialog.getBinding("items").filter([c,f],false);}this.dimensionDialog.open();},handleDimensionValueHelp:function(e){this.openDimensionValueHelpDialog(e,"value_1");},handleDimensionValueToHelp:function(e){this.openDimensionValueHelpDialog(e,"value_2");},getMandatoryFilters:function(){var t=this;var m=[];var s=this.oModelForDimensions.getData().selectedDimensions;for(var i in s){if(s[i].required==true){if(s[i].value_1==="$$$"){if(t.VIEW_MODE!="cds"){m.push({OPERATOR:s[i].operator,NAME:s[i].name,VALUE_1:t.userSessionClient,VALUE_2:s[i].value_2,TYPE:"FI"});}}else{m.push({OPERATOR:s[i].operator,NAME:s[i].name,VALUE_1:s[i].value_1,VALUE_2:s[i].value_2,TYPE:"FI"});}}}return m;},openDimensionValueHelpDialog:function(e,v){var t=this;var p=e.getSource();var b=this.getView().getModel();var d=new sap.ui.model.json.JSONModel();var a=[];this.dimensionContext=e.getSource().getBindingContext();var c=e.getSource().getBindingContext().getProperty("name");var f=e.getSource().getBindingContext().getProperty("operator");var g=e.getSource().getBindingContext().getProperty("propertyType");var h=this.oModelForInputParameters.getData().inputParameters;for(var l in h){if(h[l].value_1==="$$$"){if(t.VIEW_MODE!="cds"){a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:t.userSessionClient,VALUE_2:h[l].value_2,TYPE:"PA"});}}else{a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:h[l].value_1,VALUE_2:h[l].value_2,TYPE:"PA"});}}var m=this.allMandatoryFiltersEntered();if(!m){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_MANDATORY_FILTERS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_MANDATORY_FILTERS")});t.errorState=true;}var q=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:b.getProperty("/ODATA_URL"),entitySet:b.getProperty("/ODATA_ENTITYSET"),filter:a.concat(t.getMandatoryFilters()),dimension:c});q.model.read(q.uri,null,null,false,function(u){if(t.dimensionValue[c]){t.dimensionValue[c][v]=t.dimensionValue[c][v]?t.dimensionValue[c][v]:"";var w=t.dimensionValue[c][v]===""?null:t.dimensionValue[c][v].split(",");for(l in w){var x=true;for(var i in u.results){if(g=="Edm.DateTime"){var y=new Date(w[l]).toJSON();var z=new Date(u.results[i][c]).toJSON();if(y==z){x=false;break;}}else if(w[l]===u.results[i][c]){x=false;break;}}if(x){var A={};A[c]=w[l];A.userInput=true;A.selected=true;u.results.push(A);}else u.results[i].selected=true;}}d.setData(u);},function(u){});var s=new sap.ui.model.Sorter(c,false,function(u){if(u.getProperty("userInput")===true)return{key:"USER_VALUES",text:t.oResourceBundle.getText("VALUES_ENTERED_BY_USER")};else return{key:"SERVICE_VALUES",text:t.oResourceBundle.getText("VALUES_FETCHED_FROM_SERVICE")};});this.dimensionValueHelpDialogs=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",sorter:s,template:new sap.m.StandardListItem({title:"{"+c+"}",selected:"{selected}"})},confirm:function(e){var u="";var C=e.getParameter("selectedContexts");for(var l in C){if(g=="Edm.DateTime"){var w=new Date(C[l].getProperty(t.dimensionContext.getProperty("name")));var x=w.getMonth()+1;x=/^\d$/.test(x)?"0"+x:x;var y=w.getDate();y=/^\d$/.test(y)?"0"+y:y;var z=w.getHours();z=/^\d$/.test(z)?"0"+z:z;var A=w.getMinutes();A=/^\d$/.test(A)?"0"+A:A;var B=w.getSeconds();B=/^\d$/.test(B)?"0"+B:B;u=u+w.getFullYear()+"-"+x+"-"+y+" "+z+":"+A+":"+B+"."+w.getMilliseconds()+",";}else u=u+C[l].getProperty(t.dimensionContext.getProperty("name"))+",";}u=u.substring(0,u.length-1);t.oModelForDimensions.setProperty(t.dimensionContext.getPath()+"/"+v,u);p.fireChange({value:u});t.dimensionValue[c]=t.dimensionValue[c]?t.dimensionValue[c]:{};t.dimensionValue[c][v]=u;},liveChange:function(e){var u=e.getParameter("value");var F=new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,u);var B=e.getSource().getBinding("items");B.filter([F]);}});this.dimensionValueHelpDialogs.setGrowingThreshold(100);this.dimensionValueHelpDialogs.setModel(d);var n=this.oModelForDimensions.getData().selectedDimensions;var o=this.dimensionValueHelpDialogs.getItems();for(var i=0;i<n.length;i++){if((c===n[i].name)&&(f===n[i].operator)){var r;if(n[i].operator==="BT"){if(v==="value_1")r=n[i].value_1.split(",");else r=n[i].value_2.split(",");}else{r=n[i].value_1.split(",");}for(var j=0;j<r.length;j++){for(var k=1;k<o.length;k++){if(r[j]===o[k].getTitle()){o[k].setSelected(true);}}}}}this.dimensionValueHelpDialogs.open();for(var i=1;i<o.length;i++){if(!o[i].getSelected()){this.dimensionValueHelpDialogs.getItems()[i].setSelected(true);this.dimensionValueHelpDialogs.getItems()[i].setSelected(false);}}},allMandatoryFiltersEntered:function(){var d=this.getView().getModel().getData().ODATA_URL;var e=this.getView().getModel().getData().ODATA_ENTITYSET;if(d&&e){this.queryResultFilters=sap.suite.ui.smartbusiness.lib.OData.filter(d,e);var m=this.queryResultFilters.getMandatoryList();var a=m.length;var i=0;j=0,l=0;var s=0;var b=this.oModelForDimensions.getData().selectedDimensions;if(b){s=b.length;if(s){for(i=0;i<a;i++){for(j=0;j<s;j++){if(m[i]===b[j].name){if(!b[j].value_1){return false;}}}}}}}return true;},handleDimensionValueChange:function(e){this.validateValue(e,"dimensionValue");var v=e.getSource().getCustomData()[0].getValue();var d=e.getSource().getBindingContext().getProperty("name");if(!this.dimensionValue[d])this.dimensionValue[d]={};this.dimensionValue[d][v]=e.getParameter("value");},validateValue:function(e,s){var t=this,r;var d=e.getSource().getBindingContext().getProperty("name");var v=e.getSource().getCustomData()[0].getValue();var a=(s==="dimensionValue")?e.getParameter("value").split(","):e.getSource().getBindingContext().getProperty("value_1");var o=e.getSource().getBindingContext().getProperty("operator");if(o==="BT"){if(a.length>1){r=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d)});t.errorState=true;var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}var b=e.getSource().getBindingContext().getProperty("propertyType");var c,f;for(var k in a){r=true;var g=/<(script)(.*)\/?>/i;var j=/function\s*[^\(]*\(\s*([^\)]*)\)/;var h=/[^\(]*\(\s*([^\)]*)\)\s*{/;if(g.test(a[k])||j.test(a[k])||h.test(a[k])){r=false;c=t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",d);}if(b=="Edm.Int32"||b=="Edm.Int16"||b=="Edm.Int64"){f=/^[-+]?\d+$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_INTEGER",d);}else if(b=="Edm.Decimal"){f=/^[-+]?\d+(\.\d+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DECIMAL",d);}else if(b=="Edm.DateTime"){f=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s([0-1][0-9]|2[0-3]):[0-5][0-9]:([0-9]|[0-5][0-9])[.][0-9]+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DATE",d);}if(!r){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(c);t.errorMessages.push({"type":"Error","title":c});t.errorState=true;var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}},handleOperatorChange:function(e){var c=e.getSource().getBindingContext();c.getObject().value_1="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_1="";}}if(c.getProperty("operator")==="BT"){c.getObject().value_2="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_2="";}}}c.getModel().updateBindings();},validateDimensionsAndInputParameters:function(){var i=this.oModelForInputParameters.getData().inputParameters;var d=this.oModelForDimensions.getData().selectedDimensions;var e=false;var a="";var b="";for(var k in i){if(i[k].error_1===true||i[k].error_2===true)e=true;if(i[k].value_1===""){e=true;a="mandatoryFieldEmpty";i[k].error_1=true;}}this.oModelForInputParameters.updateBindings();for(var k in d){if(d[k].error_1===true||d[k].error_2===true){e=true;a="invalidEntry";b=d[k];}if(d[k].value_1===""){e=true;a="fieldEmpty";d[k].error_1=true;}if(d[k].operator==="BT"&&d[k].value_2===""){e=true;a="fieldEmpty";d[k].error_2=true;}}this.oModelForDimensions.updateBindings();return{error:e,errorType:a,errorDimension:b};},resetDimensionsAndInputParameters:function(){this.oModelForDimensions.setData({});this.oModelForInputParameters.setData({});this.dimensionDialog=null;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);this.byId("mandatoryFiltersDataGrid").setVisible(false);},createTargetThresholdLayout:function(){var t=this;var a=this.getView().getModel().getData().TREND;var r=this.getView().getModel().getData().REFERENCE_VALUE;if(this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(true);this.getView().byId("additionalMeasures").setVisible(true);this.getView().byId("additionalMeasureLabel").setVisible(true);this.getView().byId("selectedLabel").setVisible(true);this.getView().byId("selectedadditionalMeasures").setVisible(true);this.selectedMeasure();this.getView().byId('targetThresholdPanel').getContent()[0].destroy();if(this.getView().getModel().getData().mode!=="edit"){delete this.getView().getModel().getData().CRITICALHIGH;delete this.getView().getModel().getData().WARNINGHIGH;delete this.getView().getModel().getData().TARGET;delete this.getView().getModel().getData().WARNINGLOW;delete this.getView().getModel().getData().CRITICALLOW;delete this.getView().getModel().getData().TREND;delete this.getView().getModel().getData().REFERENCE_VALUE;}t.getView().byId('targetThresholdPanel').addContent(new sap.ui.core.mvc.XMLView({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",viewData:{controller:t}}));}if(!this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(false);this.getView().byId("additionalMeasures").setVisible(false);this.getView().byId("additionalMeasureLabel").setVisible(false);this.getView().byId("selectedLabel").setVisible(true);this.getView().byId("selectedadditionalMeasures").setVisible(true);}this.getView().getModel().setProperty("TREND",a);this.getView().getModel().setProperty("REFERENCE_VALUE",r);},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=jQuery.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.Table({showNoData:true,columns:[new sap.m.Column({}),new sap.m.Column({}),new sap.m.Column({})],layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){a.getBeginButton().setEnabled(false);}else{a.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.ColumnListItem({cells:[new sap.m.ObjectIdentifier({title:"{additionalLanguageListModel>TITLE}",text:"{additionalLanguageListModel>DESCRIPTION}",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),}),new sap.m.Label({text:"{additionalLanguageListModel>LANGUAGE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.setEnable();},})]}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),required:true,layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){var s=t.languageTextInput.getValue().replace(/\s+/g,'');if(s===""){t.languageTextInput.setValueState(sap.ui.core.ValueState.Error);}else{t.languageTextInput.setValueState(sap.ui.core.ValueState.None);}if(t.languageTextInput.getValue()&&s!==""){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getKey()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"TITLE":t.languageTextInput.getValue(),"DESCRIPTION":t.languageDescriptionInput.getValue(),"LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getKey(),"LANGUAGE":t.languageKeySelect.getSelectedItem().getText()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}t.setEnable();}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close();}})});var d=jQuery.extend(true,[],t.SAP_LANGUAGE_ARRAY,[]);for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));this.setEnable();a.open();},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},formatLangCount:function(v){if(!this.getView().getModel().getData()){v=0;}else v=this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES;return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},convert:function(v){jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");var a=sap.ca.ui.model.format.NumberFormat.getInstance({style:"standard",decimals:v});var n=a.format(0);return n;},validateEvaluationValues:function(d){d=d||this.getView().getModel().getData();var v=[];var e=[];var s=0;var c={};if(d.CRITICALLOW||d.CRITICALLOW===0){v.push({key:"CL",value:d.CRITICALLOW,score:s++});}if(d.WARNINGLOW||d.WARNINGLOW===0){v.push({key:"WL",value:d.WARNINGLOW,score:s++});}if(d.TARGET||d.TARGET===0){v.push({key:"TA",value:d.TARGET,score:s++});}if(d.WARNINGHIGH||d.WARNINGHIGH===0){v.push({key:"WH",value:d.WARNINGHIGH,score:s++});}if(d.CRITICALHIGH||d.CRITICALHIGH===0){v.push({key:"CH",value:d.CRITICALHIGH,score:s++});}v.sort(function(a,b){return(a.value-b.value)});for(var i=0,l=v.length;i<l;i++){if(v[i].score!=i){e.push(v[i].key);}if(v[i]&&v[i-1]){if(v[i].value==v[i-1].value){c[v[i-1].key]=v[i-1].value;c[v[i].key]=v[i].value;}}}if(!(e.length)){e=Object.keys(c);}return e;},resetAdditionalMeasures:function(){var t=this;if(t.getView().getModel().getData().ODATA_URL&&t.getView().getModel().getData().ODATA_ENTITYSET){if(t.measureDialog){var m=t.populateMeasure(t.getView().getModel().getData().ODATA_URL,t.getView().getModel().getData().ODATA_ENTITYSET);t.measuresDialog.setModel(m);}}else{if(t.measureDialog){var m=new sap.ui.model.json.JSONModel({});t.measuresDialog.setModel(m);}}t.getView().byId("additionalMeasures").removeAllTokens();},isCDSMode:function(m){return m==this.CDS;},isHANAMode:function(m){return m!=this.CDS;},createMeasuresDialog:function(){this.parentController=this.getView().getController();var t=this;var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET")});t.errorState=true;return;}var m=this.populateMeasure(d,D);t.measuresDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),multiSelect:true,items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){var s=e.getParameter("selectedItems");for(var k in s){t.byId("additionalMeasures").addToken(new sap.m.Token({text:s[k].getTitle()}));t.measuresDialog.removeItem(s[k]);}t.selectedMeasure();}});t.measuresDialog.setModel(m);},selectedMeasure:function(){var t=this;t.byId("selectedadditionalMeasures").setVisible(true);t.byId("selectedLabel").setVisible(true);var m=[];m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("selectedadditionalMeasures").setVisible(false);t.byId("selectedLabel").setVisible(false);t.byId("selectedadditionalMeasures").setText("");}else{var s="";for(var i=0;i<m.length;i++){if(i==0){s=s+m[i].getText();}else{s=s+", "+m[i].getText();}}t.byId("selectedadditionalMeasures").setText(s);}},multiMeasureTokenChange:function(e){var t=this;if(e.getParameter("type")=="removed"){if(!t.measuresDialog){t.createMeasuresDialog();}var a=e.getParameter("token");var m=[];m=t.measuresDialog.getModel().getData().measures;for(var i=0;i<m.length;i++){if(m[i].measureName===a.getText()){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a.getText(),}));}}t.selectedMeasure();}var m=[];m=t.byId("additionalMeasures").getTokens();for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return;}else{t.byId("additionalMeasures").setValueState("None");}}},openAdditionalMeasures:function(e){var t=this;var m=this.getView().getModel().getData().COLUMN_NAME;if(!m||m===""){t.byId("valueMeasureInput").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("SELECT_VALUE_MEASURE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SELECT_VALUE_MEASURE")});t.errorState=true;return;}if(!t.measuresDialog){t.createMeasuresDialog();}var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.NE,m);t.measuresDialog.getBinding("items").filter([f],false);var a=t.measuresDialog.getItems();var b=t.byId("additionalMeasures").getTokens();for(var i=0;i<b.length;i++){for(var j=0;j<a.length;j++){if(b[i].getText()===a[j].getTitle()){t.measuresDialog.removeItem(a[j]);}}}t.measuresDialog.open();},generateEvalId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateEvaluationId(x);var i;p.done(function(e){i=e;c.getView().getModel().getData().ID=i;c.getView().getModel().updateBindings();});},multiMeasureChange:function(v){var t=this;var m=[];m=t.byId("additionalMeasures").getValue().split(",");for(var i=0;i<m.length;i++){t.byId("additionalMeasures").setValue("");t.byId("additionalMeasures").addToken(new sap.m.Token({text:m[i]}));}m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("additionalMeasures").setValueState("None");}for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return;}else{t.byId("additionalMeasures").setValueState("None");}}},_areEvaluationValuesNumber:function(d){var e=[];if((d.CRITICALLOW&&isNaN(d.CRITICALLOW))||(d.CRITICALHIGH&&isNaN(d.CRITICALHIGH))){e.push("CRITICAL");}if((d.WARNINGLOW&&isNaN(d.WARNINGLOW))||(d.WARNINGHIGH&&isNaN(d.WARNINGHIGH))){e.push("WARNING");}if(d.TARGET&&isNaN(d.TARGET)){e.push("TARGET");}return e;},scaleFactorChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},decimalPrecisionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.view.S1.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.kpi.view.S1.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/kpi/view/KpiParametersCss.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.kpi.view.S1",{onInit:function(){var t=this;this.RESERVED_KPI_ID_NAMESPACE=".sap.sample";this.HANA="hana";this.CDS="cds";this.VIEW_MODE=this.HANA;var u;this.errorMessages=[];this.errorState=false;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:t.byId("kpiId"),controllerReference:t,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateKpiId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");if(u=jQuery.sap.getUriParameters().get("viewmode")){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}this.getView().getModel().oData["VIEW_MODE"]=this.VIEW_MODE;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");sap.suite.ui.smartbusiness.sb_createkpi=this;this.kpiCreateModel=new sap.ui.model.json.JSONModel();this.oDataModel=this.oApplicationFacade.getODataModel();if(this.VIEW_MODE==this.CDS){this.oDataModelCDS=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SSB/CDS_ODATA_ENTITY_FETCH_SRV_01");this.oDataModelCDS.attachMetadataFailed(function(s){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_CDS_MODE"))});this.byId("kpiId").setMaxLength(40);}else if(this.VIEW_MODE==this.HANA){this.byId("kpiId").setMaxLength(512);}this.viewData={};this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var l=function(o,a,b){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=a;t.localLanguage=b;};this.metadataRef.getAllLanguages({async:false,success:l,model:this.oDataModel});this.oOptions={bSuppressBookmarkButton:{},onBack:function(){t.cancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(e){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.oErrorOptions={bSuppressBookmarkButton:{},onBack:function(){t.cancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(e){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.editDraftOptions={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.oErrorOptionsForDraft={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.valid_maxlength={};this.valid_maxlength.hana={id:512,title:128,};this.valid_maxlength.cds={id:40,title:40,};this.setHeaderFooterOptions(this.oOptions);this.byId("kpiGoalTypeSelect").attachChange(function goalTypeChange(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());});this.oRouter.attachRouteMatched(function(c){t.route=c.getParameter("name");if(c.getParameter("name")=="editKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(g)};if(t.viewData.IS_ACTIVE==1){t.viewData.IS_DRAFT=true;}t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(c.getParameter("name")=="editDraftKpi"){t.editDraft=true;t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(g),IS_DRAFT:true};t.setHeaderFooterOptions(t.editDraftOptions);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(c.getParameter("name")=="duplicateKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"DUPLICATE",ID:k,IS_ACTIVE:parseInt(g)};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));}else{t.viewData={mode:"CREATE",};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));}if(t.viewData.mode=="CREATE"){var h={};h.MODE="CREATE";h.TYPE="KPI";h.KPITYPE=true;h.OPITYPE=false;h.NO_OF_ADDITIONAL_LANGUAGES=0;h.ADDITIONAL_LANGUAGE_ARRAY=[];h.GOAL_TYPE="MA";h.VIEW_MODE=t.VIEW_MODE;t.kpiModelDataForDirtyBitCheck=$.extend(true,{},h);t.kpiCreateModel.setData(h);t.getView().setModel(t.kpiCreateModel);t.generateKpiId(t);}else if(t.viewData.mode=="EDIT"||t.viewData.mode=="DUPLICATE"){var j=function(a){var b=a.INDICATOR;t.indicatorPayloadForDirtyBitTest=$.extend(true,{},b);var o=a.TAGS;var p=a.PROPERTIES;var q=a.TEXTS;b.MODE=t.viewData.mode;b.VIEW_MODE=t.VIEW_MODE;if(b.TYPE=="KPI"){b.KPITYPE=true;b.OPITYPE=false;}else if(b.TYPE=="OPI"){b.KPITYPE=false;b.OPITYPE=true;}o=(o.results)?o.results:o;var r=[];var i;for(i=0;i<o.length;i++){r.push(o[i].TAG);}b.TAGS=r;b.TAG=b.TAGS.toString(",");t.OLD_TAGS=r;p=(p.results)?p.results:p;var s=[];var i;for(i=0;i<p.length;i++){var v={};v.NAME=p[i].NAME,v.VALUE=p[i].VALUE;s.push(v);}b.PROPERTIES=s;t.OLD_PROPERTIES=$.extend(true,[],s);q=(q.results)?q.results:q;var w=[];var i;for(i=0;i<q.length;i++){if(q[i].LANGUAGE!=t.localLanguage){w.push(q[i]);}}var x=[];var i;for(i=0;i<w.length;i++){var y={};y.ADDITIONAL_LANGUAGE_TITLE=w[i].TITLE;y.ADDITIONAL_LANGUAGE_DESCRIPTION=w[i].DESCRIPTION;y.ADDITIONAL_LANGUAGE_SPRAS_KEY=w[i].LANGUAGE;if(t.SAP_LANGUAGES){y.ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[w[i].LANGUAGE];}else{y.ADDITIONAL_LANGUAGE_KEY="";}x.push(y);}b.ADDITIONAL_LANGUAGE_ARRAY=x;b.NO_OF_ADDITIONAL_LANGUAGES=b.ADDITIONAL_LANGUAGE_ARRAY.length;t.OLD_ADDITIONAL_LANGUAGE_ARRAY=x;t.kpiCreateModel.setData(b);t.getView().setModel(t.kpiCreateModel);if(b.MODE=="EDIT"){t.getView().byId("kpiId").setEditable(false);}if(b.MODE=="DUPLICATE"){t.generateKpiId(t);}};var m=function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};t.metadataRef.getKPIById({ID:t.viewData.ID,IS_ACTIVE:t.viewData.IS_ACTIVE,texts:true,tags:true,properties:true,async:false,entity:"INDICATORS",success:j,error:m,model:t.oDataModel});}var n=t.getView().byId('kpiParameterInputForm');n.addContent(new sap.m.Label({text:t.oResourceBundle.getText("PROPERTY_NAME_VALUE")}));if(t.viewData.mode==="EDIT"||t.viewData.mode==="DUPLICATE"){t.byId("odataServiceInput").fireChange();}t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(c){t.removeProperty(c);}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");});});},onAfterRendering:function(){this.byId("kpiGoalTypeSelect").setTooltip(this.byId("kpiGoalTypeSelect").getSelectedItem().getText());},setFooterOnError:function(){var t=this;if(this.editDraft===true){if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oErrorOptionsForDraft);}else{this.setHeaderFooterOptions(this.editDraftOptions);}}else{if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oErrorOptions);}else{this.setHeaderFooterOptions(this.oOptions);}}},save:function(){var t=this;t.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){if(this.viewData.IS_DRAFT){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}else{if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=0)"});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({});}}}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}},activateAndAddEvaluation:function(){var t=this;var s=false;var a=false;t.errorMessages=[];t.errorState=false;s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}a=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_OPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}a=false;});}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}if(a){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}},saveAndCreateNew:function(){var t=this;this.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI"});t.generateKpiId(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}},activateAndCreateNew:function(){var t=this;this.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}activationStatus=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}activationStatus=false;});}if(activationStatus){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI"});t.generateKpiId(t);}},saveAndActivate:function(){var t=this;var s=false;var a=false;this.errorMessages=[];this.errorState=false;s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}a=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_OPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}a=false;});}if(a){if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({});}}},deleteDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_DELETE_DRAFT_KPI_OPI")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){b.close();t.callDeleteDraft();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close();}})});b.open();},callDeleteDraft:function(){var t=this;var p={};p.ID=t.viewData.ID;p.IS_ACTIVE=t.viewData.IS_ACTIVE;t.metadataRef.remove('INDICATOR',p,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_DELETE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_DELETE"));}sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DELETE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DELETE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_DELETE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_DELETE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}});},cancel:function(){var t=this;var i=false;var l=false;var a=false;var p=false;if(this.route==="createKpi"){if(t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY&&t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length){l=true;}if((t.kpiCreateModel.getData().TAGS&&t.kpiCreateModel.getData().TAGS.length)||t.kpiCreateModel.getData().TAG){a=true;}if(t.kpiCreateModel.getData().PROPERTIES&&t.kpiCreateModel.getData().PROPERTIES.length){p=true;}delete t.kpiModelDataForDirtyBitCheck.ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiModelDataForDirtyBitCheck.TAG;delete t.kpiModelDataForDirtyBitCheck.TAGS;delete t.kpiModelDataForDirtyBitCheck.PROPERTIES;delete t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiCreateModel.getData().TAG;delete t.kpiCreateModel.getData().TAGS;delete t.kpiCreateModel.getData().PROPERTIES;var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.kpiModelDataForDirtyBitCheck,newPayload:t.kpiCreateModel.getData(),objectType:"INDICATORS"});if(b&&b.updates.length){i=true;}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{window.history.back();}}else{var d=t.getIndicatorChanges();var e=t.getTagChanges();var f=t.getPropertiesChanges();var g=t.getLanguageChanges();if(d&&(d.updates.length)){i=true;}if(g&&(g.updates.length||g.deletes.length)){l=true;}if(e&&(e.updates.length||e.deletes.length)){a=true;}if(f&&(f.updates.length||f.deletes.length)){p=true;}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{window.history.back();}}},saveKpiDetails:function(){var t=this;var k=this.kpiCreateModel.getData();var s=true;var d={errorMsg:[]};t.isPropertyAdded=true;if(t.getView().byId("kpiPropertyName").getValue()||t.getView().byId("kpiPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var a={"ID":k.ID||"","IS_ACTIVE":0,"INDICATOR":{"DESCRIPTION":k.DESCRIPTION||"","GOAL_TYPE":k.GOAL_TYPE||"","TITLE":k.TITLE||"","TYPE":k.TYPE||"","OWNER_E_MAIL":k.OWNER_E_MAIL||"","OWNER_ID":k.OWNER_ID||"","OWNER_NAME":k.OWNER_NAME||"","COLUMN_NAME":k.COLUMN_NAME||"","DATA_SPECIFICATION":k.DATA_SPECIFICATION||"","ODATA_URL":k.ODATA_URL||"","ODATA_ENTITYSET":k.ODATA_ENTITYSET||"","VIEW_NAME":k.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":k.SEMANTIC_OBJECT||"","ACTION":k.ACTION||""}};if(!a.ID){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_KPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_KPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}s=false;}if(t.byId("kpiId").getValueState()==="Error"){if(t.kpiIdEval_reason=="NOT_START_WITH_PERIOD"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_KPI_ID_BEGIN_WITH_PERIOD")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_KPI_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;t.kpiIdEval_reason=null;}else if(t.kpiIdEval_reason=="_START_WITH_PERIOD"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_KPI_ID_BEGIN_WITH_PERIOD")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_KPI_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;t.kpiIdEval_reason=null;}else{if(t.byId("kpiId").getValue()){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}}s=false;}if(!this.validateKpiTitle()){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}}if(!a.INDICATOR.TITLE){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_KPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_KPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}this.getView().byId('kpiTitle').setValueState("Error");s=false;}if(t.byId("kpiOwnerEmail").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;s=false;}if(t.byId("semanticObject").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}if(t.byId("action").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(this.errorState){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(!t.errorState){if(this.viewData.mode=="DUPLICATE"){if(!this.validateKpiId()){return;}}if(t.viewData.mode=="CREATE"||t.viewData.mode=="DUPLICATE"||(t.viewData.mode=="EDIT"&&this.viewData.IS_ACTIVE==1)){a.TEXTS=[];a.TAGS=[];a.PROPERTIES=[];var l=t.insertLanguagePayload();var p=t.insertPropertiesPayload();var b=t.insertTagPayload();if(l.length){a.TEXTS=l;}if(p.length){a.PROPERTIES=p;}if(b.length){a.TAGS=b;}var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;t.metadataRef.create('INDICATOR',c,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"));}s=true;},function(u){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}s=false;});}else if(t.viewData.mode=="EDIT"){a.TEXTS={};a.TAGS={};a.PROPERTIES={};var e=false;var f=false;var g=false;var h=false;var j=t.getIndicatorChanges();if(j){if(j.updates.length){e=true;a.INDICATOR={};for(var i=0;i<j.updates.length;i++){a.INDICATOR.update=j.updates[i];}}}var n=t.getLanguageChanges();if(n){if(n.deletes.length){f=true;for(var i=0;i<n.deletes.length;i++){a.TEXTS.remove=n.deletes;}}if(n.updates.length){f=true;for(var i=0;i<n.updates.length;i++){a.TEXTS.create=n.updates;}}}var q=t.getTagChanges();if(q){if(q.deletes.length){g=true;for(var i=0;i<q.deletes.length;i++){a.TAGS.remove=q.deletes;}}if(q.updates.length){g=true;for(var i=0;i<q.updates.length;i++){a.TAGS.create=q.updates;}}}var r=t.getPropertiesChanges();if(r){if(r.deletes.length){h=true;for(var i=0;i<r.deletes.length;i++){a.PROPERTIES.remove=r.deletes;}}if(r.updates.length){h=true;for(var i=0;i<r.updates.length;i++){a.PROPERTIES.create=r.updates;}}}if(e||g||h||f){var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;t.metadataRef.update('INDICATOR',c,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"));}s=true;},function(u){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}s=false;});}}}return s;},getIndicatorChanges:function(){var o=this.indicatorPayloadForDirtyBitTest;var n=this.kpiCreateModel.getData();var a={"DESCRIPTION":o.DESCRIPTION||"","GOAL_TYPE":o.GOAL_TYPE||"","TITLE":o.TITLE||"","TYPE":o.TYPE||"","OWNER_E_MAIL":o.OWNER_E_MAIL||"","OWNER_ID":o.OWNER_ID||"","OWNER_NAME":o.OWNER_NAME||"","COLUMN_NAME":o.COLUMN_NAME||"","DATA_SPECIFICATION":o.DATA_SPECIFICATION||"","ODATA_URL":o.ODATA_URL||"","ODATA_ENTITYSET":o.ODATA_ENTITYSET||"","VIEW_NAME":o.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":o.SEMANTIC_OBJECT||"","ACTION":o.ACTION||""};var b={"DESCRIPTION":n.DESCRIPTION||"","GOAL_TYPE":n.GOAL_TYPE||"","TITLE":n.TITLE||"","TYPE":n.TYPE||"","OWNER_E_MAIL":n.OWNER_E_MAIL||"","OWNER_ID":n.OWNER_ID||"","OWNER_NAME":n.OWNER_NAME||"","COLUMN_NAME":n.COLUMN_NAME||"","DATA_SPECIFICATION":n.DATA_SPECIFICATION||"","ODATA_URL":n.ODATA_URL||"","ODATA_ENTITYSET":n.ODATA_ENTITYSET||"","VIEW_NAME":n.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":n.SEMANTIC_OBJECT||"","ACTION":n.ACTION||""};var i=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:a,newPayload:b,objectType:"INDICATORS"});return i;},getLanguageChanges:function(){var t=this;this.languagePayloadForDirtyBitTest=[];var n=this.insertLanguagePayload();for(var i=0;i<this.OLD_ADDITIONAL_LANGUAGE_ARRAY.length;i++){var l={};l.LANGUAGE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;this.languagePayloadForDirtyBitTest.push(l);}var a=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:n,objectType:"INDICATOR_TEXTS"});return a;},getTagChanges:function(){var t=this;this.tagPayloadForDirtyBitTest=[];var n=this.insertTagPayload();var o=[];for(var i=0;i<t.OLD_TAGS.length;i++){var a={};a.TAG=t.OLD_TAGS[i];a.TYPE="IN";this.tagPayloadForDirtyBitTest.push(a);}var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.tagPayloadForDirtyBitTest,newPayload:n,objectType:"TAGS"});return b;},getPropertiesChanges:function(){var t=this;this.propertiesPayloadForDirtyBitTest=[];var n=this.insertPropertiesPayload();for(var i=0;i<this.OLD_PROPERTIES.length;i++){var p={};p.TYPE="IN";p.NAME=t.OLD_PROPERTIES[i].NAME;p.VALUE=t.OLD_PROPERTIES[i].VALUE;this.propertiesPayloadForDirtyBitTest.push(p);}var a=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.propertiesPayloadForDirtyBitTest,newPayload:n,objectType:"PROPERTIES"});return a;},insertLanguagePayload:function(){var k=this.kpiCreateModel.getData();var l={};var a=[];if(k.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<k.NO_OF_ADDITIONAL_LANGUAGES;i++){l={};l.LANGUAGE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;a.push(l);}}return a;},insertTagPayload:function(){var k=this.kpiCreateModel.getData();var t={};var a=[];if(k.TAG){var b=k.TAG.split(",");var i;for(i=0;i<b.length;i++){t={};t.TYPE="IN";t.TAG=b[i];a.push(t);}}return a;},insertPropertiesPayload:function(){var k=this.kpiCreateModel.getData();var p={};var a=[];if(k.PROPERTIES){var i;for(i=0;i<k.PROPERTIES.length;i++){p={};p.TYPE="IN";p.NAME=k.PROPERTIES[i].NAME;p.VALUE=k.PROPERTIES[i].VALUE;a.push(p);}}return a;},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({showNoData:false,layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){a.getBeginButton().setEnabled(false);}else{a.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oResourceBundle.getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),textAlign:"Right",required:true,layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()==""){t.languageTextInput.setValueState(sap.ui.core.ValueState.Error);}else{t.languageTextInput.setValueState(sap.ui.core.ValueState.None);}if(t.languageTextInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_LANGUAGE_SPRAS_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}t.setEnable();}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close();}})});var d=jQuery.extend(true,[],t.SAP_LANGUAGE_ARRAY,[]);for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));this.setEnable();a.open();},addNewProperty:function(){var t=this;if(this.getView().byId("kpiPropertyName").getValue()){this.getView().byId("kpiPropertyName").setValueState("None");if(this.getView().byId("kpiPropertyValue").getValue()){this.getView().byId("kpiPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("kpiPropertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("kpiPropertyValue").getValue())){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);return;}}p.getData().PROPERTIES.push({NAME:this.getView().byId("kpiPropertyName").getValue(),VALUE:this.getView().byId("kpiPropertyValue").getValue()});p.updateBindings();this.getView().byId("kpiPropertyName").setValue("");this.getView().byId("kpiPropertyValue").setValue("");}else{t.isPropertyAdded=false;this.getView().byId("kpiPropertyValue").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_VALUE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ENTER_PROPERTY_VALUE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}else{t.isPropertyAdded=false;this.getView().byId("kpiPropertyName").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_NAME"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ENTER_PROPERTY_NAME")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings();},kpiOpiRadioButtonChange:function(e){if(this.getView().byId('KPI').getSelected()==true){this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;}else{this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true;}if(this.getView().byId('OPI').getSelected()==true){this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true;}else{this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;}},validateKpiId:function(){var k=this.getView().byId('kpiId');var t=this;var s=false;var a=k.getValue();if(this.VIEW_MODE==this.CDS){k.setValue(a.toUpperCase());}if(a){if(a.lastIndexOf(this.RESERVED_KPI_ID_NAMESPACE,0)===0){k.setValueState("Error");s=false;}else if(this.VIEW_MODE==this.CDS&&a[0]!='.'){this.kpiIdEval_reason="NOT_START_WITH_PERIOD";k.setValueState("Error");s=false;}else if(this.VIEW_MODE==this.HANA&&a[0]=='.'){this.kpiIdEval_reason="_START_WITH_PERIOD";k.setValueState("Error");s=false;}else if(!(/^[a-zA-Z0-9.]*$/.test(a))||a.length>this.valid_maxlength[this.VIEW_MODE].id){k.setValueState("Error");s=false;}else{k.setValueState("None");var i=function(c){if(c[0]){k.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ID_ALREADY_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ID_ALREADY_EXISTS")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);s=false;}else{k.setValueState("None");s=true;}};var b=function(){k.setValueState("None");s=true;};this.metadataRef.getDataByEntity({entity:"INDICATORS",filter:"ID eq '"+a+"'",async:false,success:i,error:b,model:this.oDataModel});}}return s;},validateKpiTitle:function(){var k=this.getView().byId('kpiTitle');var a=k.getValue();if(!a){k.setValueState("None");return true;}if(a.length>this.valid_maxlength[this.VIEW_MODE].title){k.setValueState("Error");return false}else{k.setValueState("None");return true;}},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},formatSemanticActionLabel:function(v){return v+"/"+this.oApplicationFacade.getResourceBundle().getText("ACTION");},validateEmailAddress:function(){var k=this.getView().byId('kpiOwnerEmail');var a=k.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){k.setValueState("Error");}else{k.setValueState("None");}}else{k.setValueState("None");}},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();t.metadataRef.populateRelevantEntitySet(d,m,t);},populateRelevantEntitySet_CDS:function(d){var s=encodeURIComponent(this.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(this.getView().getModel().getProperty("/ODATA_URL"));var e="EntityTypeSet";var u="/ODATAnameSet(CdsName='"+s+"\',OdataName='',OdataURL='"+a+"',SrvName='',SrvVersion='',SrvNamespace='')/?$expand="+e;this.oDataModelCDS.read(u,null,null,false,function(b){var b=b[e].results;var c=new sap.ui.model.json.JSONModel();c.setData(b);d.setModel(c);d.open();});},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o;}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.byId("viewInput").fireChange();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(this.oDataModel);h.open();},handleCDSViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"PackName",type:new sap.ui.model.type.String()},{path:"CdsName",type:new sap.ui.model.type.String()}],formatter:function(p,c){return p+"::"+c;}}})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/VIEW_NAME_CdsName",e.getParameter("selectedItem").getBindingContext().getProperty("CdsName"));t.getView().getModel().setProperty("/VIEW_NAME_PackName",e.getParameter("selectedItem").getBindingContext().getProperty("PackName"));t.byId("viewInputCDS").fireChange();},liveChange:function(e){var i,s,a,b,c;s=a=b=e.getParameter("value").toUpperCase();c=false;if((i=s.lastIndexOf("::"))!==-1){a=s.substring(0,i);b=s.substring(i+2,s.length);c=true;}var f=new sap.ui.model.Filter("PackName",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("CdsName",sap.ui.model.FilterOperator.Contains,b);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f,F],c));}});this.oDataModelCDS.read("/CDSViewSet",null,null,false,function(d){var d=d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);h.setModel(c);});h.open();},handleHanaViewInputChange:function(){this.getView().getModel().getData().ODATA_URL="";this.getView().getModel().getData().ODATA_ENTITYSET="";this.getView().getModel().getData().COLUMN_NAME="";this.getView().getModel().updateBindings();},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata";}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oDataModel);h.open();}},handleOdataServiceValueHelpCDS:function(){var t=this;if(!t.byId("viewInputCDS").getValue()){var r="/PackOdataSet";var e=null;}else{var s=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_PackName"));var r="/CDSViewSet(CdsName='"+s+"')/?$expand=ODATAnameSet";var e="ODATAnameSet";}var b=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"OdataURL",type:new sap.ui.model.type.String()}],formatter:function(o){return(function(h){return jQuery("<a>").attr("href",h)[0]["pathname"]})(o);}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_URL",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var c=E.getParameter("value");var f=new sap.ui.model.Filter("OdataURL",sap.ui.model.FilterOperator.Contains,c);var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});this.oDataModelCDS.read(r,null,null,false,function(d){var d=e?d[e].results:d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);b.setModel(c);});b.open();},handleEntitySetValueHelp:function(){var t=this;var a=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!t.byId(a).getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});var C=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"EntityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});try{if(t.getView().getModel().getData().VIEW_NAME){if(this.VIEW_MODE!=this.CDS){t.populateRelevantEntitySet(h);}else{t.populateRelevantEntitySet_CDS(C);}}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId(a).getValue());h.setModel(t.oModelForEntity);h.open();}}catch(e){}}},handleMeasureValueHelp:function(){var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var m=t.mProperties.getLabelMappingObject();var a=t.oModelForMeasure.getData().measures;for(var i=0,l=a.length;i<l;i++){a[i].measureLabel=m[a[i].measureName];}t.oModelForMeasure.setData({measures:a});}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureLabel",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},description:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}}})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getBindingContext().getProperty("measureName"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("measureLabel",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oModelForMeasure);h.open();}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"));},validateSemantic:function(e){var t=this;var s=t.getView().byId("semanticObject");if(e.getParameter("value").indexOf(' ')===-1){this.byId(e.getParameter("id")).setValueState("None");}else{this.byId(e.getParameter("id")).setValueState("Error");}},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.ui.smartbusiness.lib.Util.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o);}m.setData({entitySet:e});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o);}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M;},onODataServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_URL",t.getView().byId("odataServiceSelect").getSelectedItem().getText());t.getView().byId("odataServiceSelect").fireChange();},0);this.oDataModel.detachRequestCompleted(t.onODataServiceLoad,t);},onEntitySetServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_ENTITYSET",t.getView().byId("entitySetSelect").getSelectedItem().getText());t.getView().byId("entitySetSelect").fireChange();},0);},onMeasureServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/COLUMN_NAME",t.getView().byId("valueMeasureSelect").getSelectedItem().getText());t.getView().byId("valueMeasureSelect").fireChange();},0);},isCDSMode:function(m){return m==this.CDS;},isHANAMode:function(m){return m!=this.CDS;},generateKpiId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateKpiId(x);var i;p.done(function(k){i=k;c.getView().getModel().getData().ID=i;c.getView().getModel().updateBindings();});},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.ui.smartbusiness.lib.Util.utils.backToHome();}if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){delete sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace;}}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.visualization.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S2",{onInit:function(){var t=this;t.selectedGroupItemKey="workspace";t.selectedGroupItemIndex=0;t.lastSavedIndex=0;this.oApplicationFacade.masterListControllerRef=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;t.oApplicationFacade.getODataModel().setSizeLimit(100000);jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("list"),hideElement:"list",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");t.lastGroupingOption=new sap.ui.model.Sorter("MANUAL_ENTRY",true,function(d){var i=d.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}});t.lastSortingOrder={indicatorTextOrder:null,order:new sap.ui.model.Sorter("CHANGED_ON",true,null)};this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.env=0;function a(d){t.env=d;}function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);}this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});if(this.env){this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("IS_ACTIVE","EQ",1)]);}else{this.byId("list").getBinding("items").filter([new sap.ui.model.Filter("NAMESPACE",sap.ui.model.FilterOperator.NE,"."),new sap.ui.model.Filter("IS_ACTIVE","EQ",1)],false);}if(!(t.oApplicationFacade.currentLogonHanaUser)){var c=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var e=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);};this.metadataRef.getSessionUser({async:true,success:c,error:e,model:this.oApplicationFacade.getODataModel()});}this.setSorting("changedate",true);},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVORITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText();}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c];}}t.byId("filterToolbar").setVisible(true);t.byId("visualizationInfo").setText(a);}else{t.byId("visualizationInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});return f;},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_CHANGE_DATE"),key:"changedate"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NAME"),key:"name"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_ID"),key:"id"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});s.setSelectedSortItem("changedate");s.setSortDescending(true);return s;},createGroupOptions:function(){var t=this;var j={groupItems:[{text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace",index:0},{text:t.oApplicationFacade.getResourceBundle().getText("BY_INDICATOR"),key:"indicator",index:1},{text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner",index:2},{text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none",index:3},]};var m=new sap.ui.model.json.JSONModel(j);var g=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("GROUP_BY"),id:this.createId("groupOptionsDialog"),content:[new sap.m.List({items:{path:"/groupItems",template:new sap.m.ObjectListItem({type:"Active",title:"{text}"})},itemPress:function(e){e.getParameter("listItem").setSelected(true);t.selectedGroupItemKey=e.getParameter("listItem").getBindingContext().getProperty("key");t.selectedGroupItemIndex=e.getParameter("listItem").getBindingContext().getProperty("index");if(t.selectedGroupItemKey=="workspace"){t.setGrouping(t.selectedGroupItemKey,true);}else{t.setGrouping(t.selectedGroupItemKey,false);}t.lastSavedIndex=t.selectedGroupItemIndex;this.getParent().close();}})],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(e){t.selectedGroupItemIndex=t.lastSavedIndex;this.getParent().close();}})});g.setModel(m);return g;},getHeaderFooterOptions:function(){var t=this;var o={sI18NMasterTitle:t.metadataRef.getPlatform()==t.constantsRef.Platform.ABAP?"ALL_EVALUATIONS":"MASTER_TITLE",onBack:function(){window.history.back();},oFilterOptions:{onFilterPressed:function(e){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open();}},oSortOptions:{onSortPressed:function(e){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open();}},oGroupOptions:{onGroupPressed:function(e){if(t.byId("groupOptionsDialog")){t.byId("groupOptionsDialog").destroy();}t.getView().groupOptionDialog=t.createGroupOptions();t.getView().groupOptionDialog.open();t.byId("groupOptionsDialog").getContent()[0].getItems()[t.selectedGroupItemIndex].setSelected(true);}},};if(t.metadataRef.getPlatform()==t.constantsRef.Platform.ABAP){o.onAddPress=function(e){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addEvaluation",context:""});}}return o;},formatEvaluationHeader:function(i,e){var t=this;if(i==null&&e!=null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+"- "+e);}else if(i!=null&&e==null){return(i+" -"+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else if(i==null&&e==null){return(t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE")+" - "+t.oApplicationFacade.getResourceBundle().getText("TITLE_UNAVAILABLE"));}else{return(i+" - "+e);}},formatGroupName:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var a;if(k=="workspace"){a=new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var b="";switch(i){case 1:b=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:b=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:b=t.oApplicationFacade.getResourceBundle().getText("ALL_EVALUATIONS");}return{key:b,text:b}})}else if(k=="indicator"){a=new sap.ui.model.Sorter("INDICATOR",g,function(c){return{key:c.getProperty("INDICATOR"),text:("KPI: "+c.getProperty("INDICATOR"))}});}else if(k=="owner"){a=new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var b="";switch(o){case null:b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:b=o;}return{key:b,text:b}});}else if(k=="none"){a=null;}if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order,t.lastSortingOrder.indicatorTextOrder],true);}else if(!t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder.order],true);}else{if(t.lastSortingOrder.indicatorTextOrder&&t.lastSortingOrder.order){l.getBinding("items").sort([t.lastSortingOrder.indicatorTextOrder,t.lastSortingOrder.order]);}else{l.getBinding("items").sort([t.lastSortingOrder.order]);}}this.lastGroupingOption=a;},setFiltering:function(i){var f=[];var l=this.getView().byId("list");var a={"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,this.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var s,a;if(k=="changedate"){s=new sap.ui.model.Sorter("CHANGED_ON",g,null);}else if(k=="name"){s=new sap.ui.model.Sorter("TITLE",g,null);a=new sap.ui.model.Sorter("INDICATOR_TITLE",g,null);}else if(k=="id"){s=new sap.ui.model.Sorter("ID",g,null);}if(t.lastGroupingOption){if(a){l.getBinding("items").sort([t.lastGroupingOption,a,s],true);}else{l.getBinding("items").sort([t.lastGroupingOption,s],true);}}else{if(a){l.getBinding("items").sort([a,s]);}else{l.getBinding("items").sort([s]);}}this.lastSortingOrder={indicatorTextOrder:a,order:s};},formatChipCount:function(c){return c||0;},formatTile:function(c){if(c==1)return this.oApplicationFacade.getResourceBundle().getText("Tile");else return this.oApplicationFacade.getResourceBundle().getText("Tiles");},applySearchPatternToListItem:function(i,s){return sap.suite.ui.smartbusiness.lib.Util.utils.applySearchPatternToListItem.apply(this,arguments);},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,true);},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.ui.smartbusiness.lib.Util.utils.backToHome();}}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S2.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S2.controller');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S2",{onInit:function(){var t=this;this.errorMessages=[];this.errorModel=new sap.ui.model.json.JSONModel();this.errorModel.setData(this.errorMessages);this.errorState=false;this.oApplicationFacade.masterListControllerRef=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;t.selectedGroupItemKey="workspace";t.selectedGroupItemIndex=0;t.lastSavedIndex=0;t.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");t.oApplicationFacade.getODataModel().setSizeLimit(100000);jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("list"),hideElement:"list",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");t.lastGroupingOption=new sap.ui.model.Sorter("MANUAL_ENTRY",true,function(c){var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}});t.lastSortingOrder=new sap.ui.model.Sorter("CHANGED_ON",true,null);if(!(t.oApplicationFacade.currentLogonHanaUser)){var a=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var b=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":d.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};this.metadataRef.getSessionUser({async:true,success:a,error:b,model:this.oApplicationFacade.getODataModel()});}this.defaultHeaderFooterOptions={sI18NMasterTitle:"MASTER_TITLE",sI18NSearchFieldPlaceholder:"SEARCHFIELD_PLACEHOLDER",onEditPress:function(i){t.toggleListSelection(i);},oFilterOptions:{onFilterPressed:function(c){t.getView().filterOptionDialog=t.getView().filterOptionDialog||t.createFilterOptions();t.getView().filterOptionDialog.open();}},oSortOptions:{onSortPressed:function(c){t.getView().sortOptionDialog=t.getView().sortOptionDialog||t.createSortOptions();t.getView().sortOptionDialog.open();}},oGroupOptions:{onGroupPressed:function(c){if(t.byId("groupOptionsDialog")){t.byId("groupOptionsDialog").destroy();}t.getView().groupOptionDialog=t.createGroupOptions();t.getView().groupOptionDialog.open();t.byId("groupOptionsDialog").getContent()[0].getItems()[t.selectedGroupItemIndex].setSelected(true);}},onAddPress:function(c){sap.suite.ui.smartbusiness=sap.suite.ui.smartbusiness||{};sap.suite.ui.smartbusiness.modelerAppCache=sap.suite.ui.smartbusiness.modelerAppCache||{};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI=sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI||{};sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace=true;sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI"});},buttonList:[]};this.multiSelectHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({});},onEditPress:function(i){t.toggleListSelection(i);},buttonList:[{sId:"favouriteButton",sI18nBtnTxt:"FAVOURITE_BUTTON_TEXT",onBtnPressed:function(c){t.errorMessages=[];if(t.byId("list").getSelectedContexts().length){var s=t.byId("list").getSelectedContexts();var p={};var d=[];var f=null;var g=true;var D=t.oApplicationFacade.getODataModel();var h=[];for(var i=0,l=s.length;i<l;i++){if(!(s[i].getProperty("MANUAL_ENTRY"))){h.push({ID:s[i].getProperty("ID"),TYPE:s[i].getProperty("ENTITY_TYPE"),USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null});}}if(h.length){t.metadataRef.update("INDICATOR_FAVOURITE",h,null,function(j){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_IN_SUCCESS_KPI_OPI"));t.refreshMasterList();},function(j){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_KPI_OPI_ERROR"),"description":j.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"));}}},{sId:"removeFavouriteButton",sI18nBtnTxt:"REMOVE_FAV_BUTTON_TEXT",onBtnPressed:function(c){t.errorMessages=[];if(t.byId("list").getSelectedContexts().length){var s=t.byId("list").getSelectedContexts();var d=[];var p=null;var f=true;var D=t.oApplicationFacade.getODataModel();var g=[];for(var i=0,l=s.length;i<l;i++){if(s[i].getProperty("MANUAL_ENTRY")){g.push({ID:s[i].getProperty("ID"),TYPE:s[i].getProperty("ENTITY_TYPE"),USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null});}}if(g.length){t.metadataRef.remove("INDICATOR_FAVOURITE",g,function(h){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("REM_FAVOURITE_BATCH_SAVE_SUCCESS_KPI_OPI"));t.refreshMasterList();},function(h){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_BATCH_SAVE_ERROR_KPI_OPI"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_BATCH_SAVE_ERROR_KPI_OPI"),"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"));}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(c){t.errorMessages=[];if(t.byId("list").getSelectedContexts().length){sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_INDICATOR_DELETE_KPI_OPI"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("INDICATOR_DELETE_ALERT_TITLE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(c){if(c=="OK"){var s=t.byId("list").getSelectedContexts();var p={};var d=[];var f=true;var D=t.oApplicationFacade.getODataModel();var g=[];for(var i=0,l=s.length;i<l;i++){g.push({ID:s[i].getProperty("ID"),IS_ACTIVE:s[i].getProperty("IS_ACTIVE")});}if(g.length){t.metadataRef.remove("INDICATOR",g,function(h){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_BATCH_SAVE_SUCCESS_KPI_OPI"));t.refreshMasterList();},function(h){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_BATCH_SAVE_ERROR_KPI_OPI"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("DELETE_BATCH_SAVE_ERROR_KPI_OPI"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{}}if(c=="CANCEL"){}});}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"));}}}]};if(jQuery.sap.getUriParameters().get("sap-sb-enable-export")=="true"){var e={sI18nBtnTxt:"EXPORT_INDICATORS_KPI_OPI",onBtnPressed:function(c){if(t.byId("list").getSelectedContexts().length){t.exportIndicators();}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_SELECTED"));}}};this.multiSelectHeaderFooterOptions.buttonList.unshift(e);}this.currentHeaderFooterOptions=this.defaultHeaderFooterOptions;},jsonForTestData:function(){return{"indicatorData":{"ID":"sample.sap.kpi","IS_ACTIVE":0,"INDICATOR":{"TITLE":"Sample KPI","DESCRIPTION":"This is a Sample KPI","TYPE":"KPI","GOAL_TYPE":"RA"},"TEXTS":[{"TITLE":"sample kpi from sap","DESCRIPTION":"Sample KPI for understanding KPI creation","LANGUAGE":"D"}],"TAGS":[{"TYPE":"EV","TAG":"a"}],"PROPERTIES":[{"TYPE":"EV","NAME":"p1","VALUE":"v1"}]},"evaluationData":{"ID":"sample.sap.kpi.evaluation1","IS_ACTIVE":0,"EVALUATION":{"DESCRIPTION":"Sample SAP Evaluation","INDICATOR":"sample.sap.kpi","ODATA_URL":"/sap/hba/r/sb/core/odata/SALESORDER_TEST.xsodata","VIEW_NAME":"","COLUMN_NAME":"TotalNetAmount","OWNER_NAME":"hewhomustnotbenamed","OWNER_E_MAIL":"hewhomustnotbenamed@sap.com","OWNER_ID":"hewhomustnotbenamed","CREATED_BY":"","CHANGED_BY":"","SCALING":3,"TITLE":"Sample SAP Evaluation","ENTITY_TYPE":"","ODATA_ENTITYSET":"Sales","ODATA_PROPERTY":"","SEMANTIC_OBJECT":"","ACTION":"","DATA_SPECIFICATION":"","GOAL_TYPE":"RA","INDICATOR_TYPE":"KPI","VALUES_SOURCE":"FIXED"},"FILTERS":[{"TYPE":"FI","NAME":"CompanyCode","OPERATOR":"EQ","VALUE_1":"1000","VALUE_2":""},{"TYPE":"FI","NAME":"CompanyCode","OPERATOR":"EQ","VALUE_1":"3000","VALUE_2":""}],"VALUES":[{"TYPE":"CH","FIXED":"160000050","ODATA_PROPERTY":""},{"TYPE":"WH","FIXED":"160000040","ODATA_PROPERTY":""},{"TYPE":"TA","FIXED":"160000030","ODATA_PROPERTY":""},{"TYPE":"CL","FIXED":"160000010","ODATA_PROPERTY":""},{"TYPE":"WL","FIXED":"160000020","ODATA_PROPERTY":""},{"TYPE":"TC","FIXED":"160000030","ODATA_PROPERTY":""}],"TEXTS":[{"LANGUAGE":"D","TITLE":"sample kpi evaluation","DESCRIPTION":"sample KPI evaluation"}],"TAGS":[{"TYPE":"EV","TAG":"a"}],"PROPERTIES":[{"TYPE":"EV","NAME":"p1","VALUE":"v1"}]},"chipsData":{"id":"","isActive":0,"CHIP":{"catalogId":"HANA_CATALOG","title":"Sample SAP KPI","description":"Sample SAP KPI","tileType":"NT","evaluationId":"sample.sap.kpi.evaluation1","url":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","keywords":"","configuration":"{\"tileConfiguration\":\"{\\\"ADDITIONAL_APP_PARAMETERS\\\":\\\"{}\\\",\\\"TILE_PROPERTIES\\\":\\\"{\\\\\\\"id\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"evaluationId\\\\\\\":\\\\\\\"sample.sap.kpi.evaluation1\\\\\\\",\\\\\\\"tileType\\\\\\\":\\\\\\\"NT\\\\\\\",\\\\\\\"frameType\\\\\\\":\\\\\\\"OneByOne\\\\\\\",\\\\\\\"navType\\\\\\\":\\\\\\\"0\\\\\\\",\\\\\\\"semanticObject\\\\\\\":\\\\\\\"TotalNetAmount\\\\\\\",\\\\\\\"semanticAction\\\\\\\":\\\\\\\"analyzeSBKPIDetails\\\\\\\"}\\\",\\\"EVALUATION_FILTERS\\\":\\\"[{\\\\\\\"TYPE\\\\\\\":\\\\\\\"FI\\\\\\\",\\\\\\\"NAME\\\\\\\":\\\\\\\"CompanyCode\\\\\\\",\\\\\\\"VALUE_1\\\\\\\":\\\\\\\"1000\\\\\\\",\\\\\\\"OPERATOR\\\\\\\":\\\\\\\"EQ\\\\\\\",\\\\\\\"VALUE_2\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"FI\\\\\\\",\\\\\\\"NAME\\\\\\\":\\\\\\\"CompanyCode\\\\\\\",\\\\\\\"VALUE_1\\\\\\\":\\\\\\\"3000\\\\\\\",\\\\\\\"OPERATOR\\\\\\\":\\\\\\\"EQ\\\\\\\",\\\\\\\"VALUE_2\\\\\\\":\\\\\\\"\\\\\\\"}]\\\",\\\"EVALUATION_VALUES\\\":\\\"[{\\\\\\\"TYPE\\\\\\\":\\\\\\\"CH\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000050\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"CL\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000010\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"TA\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000030\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"TC\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000030\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"WH\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000040\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"},{\\\\\\\"TYPE\\\\\\\":\\\\\\\"WL\\\\\\\",\\\\\\\"FIXED\\\\\\\":\\\\\\\"160000020\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"ODATA_PROPERTY\\\\\\\":\\\\\\\"\\\\\\\"}]\\\",\\\"EVALUATION\\\":\\\"{\\\\\\\"ID\\\\\\\":\\\\\\\"sample.sap.kpi.evaluation1\\\\\\\",\\\\\\\"INDICATOR\\\\\\\":\\\\\\\"sample.sap.kpi\\\\\\\",\\\\\\\"INDICATOR_TYPE\\\\\\\":\\\\\\\"KPI\\\\\\\",\\\\\\\"INDICATOR_TITLE\\\\\\\":\\\\\\\"Sample KPI\\\\\\\",\\\\\\\"GOAL_TYPE\\\\\\\":\\\\\\\"RA\\\\\\\",\\\\\\\"TITLE\\\\\\\":\\\\\\\"Sample SAP Evaluation\\\\\\\",\\\\\\\"SCALING\\\\\\\":0,\\\\\\\"ODATA_URL\\\\\\\":\\\\\\\"/sap/hba/r/sb/core/odata/SALESORDER_TEST.xsodata\\\\\\\",\\\\\\\"ODATA_ENTITYSET\\\\\\\":\\\\\\\"Sales\\\\\\\",\\\\\\\"VIEW_NAME\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"COLUMN_NAME\\\\\\\":\\\\\\\"TotalNetAmount\\\\\\\",\\\\\\\"OWNER_NAME\\\\\\\":\\\\\\\"hewhomustnotbenamed\\\\\\\",\\\\\\\"VALUES_SOURCE\\\\\\\":\\\\\\\"FIXED\\\\\\\"}\\\"}\",\"isSufficient\":\"1\",\"timeStamp\":\"1410946294748\"}"},"TEXTS":[{"title":"sample","description":"sample","id":"<dynamic>","language":"D","isActive":0}]},"authorizationData":{"ID":"sample.sap.kpi.evaluation1","REVOKE":[],"GRANT":["BPRI","sap.hba.apps.kpi.s.roles::SAP_SMART_BUSINESS_MODELER","sap.hba.r.sb.core.roles::SAP_SMART_BUSINESS_MODELER"]},"payload":{"DDA_COLUMNS":[{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","NAME":"CompanyCode","TYPE":"DIMENSION","SORT_BY":"CompanyCode","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":1,"SORT_ORDER":"none","COLUMNS_ORDER":0,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","NAME":"SalesOrder","TYPE":"DIMENSION","SORT_BY":"SalesOrder","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":1,"SORT_ORDER":"none","COLUMNS_ORDER":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","NAME":"ActualCost","TYPE":"MEASURE","SORT_BY":"ActualCost","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":2,"SORT_ORDER":"none","COLUMNS_ORDER":2,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","NAME":"CompanyCode","TYPE":"DIMENSION","SORT_BY":"CompanyCode","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":1,"SORT_ORDER":"none","COLUMNS_ORDER":0,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","NAME":"TotalNetAmount","TYPE":"MEASURE","SORT_BY":"TotalNetAmount","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":2,"SORT_ORDER":"none","COLUMNS_ORDER":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","NAME":"ActualCost","TYPE":"MEASURE","SORT_BY":"ActualCost","VISIBILITY":"BOTH","COLOR":"","STACKING":0,"AXIS":2,"SORT_ORDER":"none","COLUMNS_ORDER":2,"IS_ACTIVE":1}],"DDA_CHART":[{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","VALUE_TYPE":"ABSOLUTE","AXIS_TYPE":"SINGLE","CHART_TYPE":"Column","DATA_LIMIT":-1,"COLOR_SCHEME":"NONE","IS_ACTIVE":1,"THRESHOLD_MEASURE":""},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","VALUE_TYPE":"ABSOLUTE","AXIS_TYPE":"SINGLE","CHART_TYPE":"Column","DATA_LIMIT":-1,"COLOR_SCHEME":"AUTO_SEMANTIC","IS_ACTIVE":1,"THRESHOLD_MEASURE":"ActualCost"}],"DDA_MASTER_TEXT":[{"CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","EVALUATION_ID":"sample.sap.kpi.evaluation1","SAP_LANGUAGE_KEY":"E","TEXT":"view1","IS_ACTIVE":1},{"CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","EVALUATION_ID":"sample.sap.kpi.evaluation1","SAP_LANGUAGE_KEY":"E","TEXT":"view2","IS_ACTIVE":1}],"DDA_MASTER":[{"CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view1","EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIG_ORDER":0,"IS_ACTIVE":1},{"CONFIGURATION_ID":"sample.sap.kpi.evaluation1.view2","EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIG_ORDER":1,"IS_ACTIVE":1}],"DDA_FILTERS":[{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","DIMENSION":"SalesGroup","VISIBILITY":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","DIMENSION":"TransactionCurrency","VISIBILITY":1,"IS_ACTIVE":1}],"DDA_HEADER":[{"CONFIGURATION_ID":"view1","EVALUATION_ID":"sample.sap.kpi.evaluation1","VISUALIZATION_TYPE":"NT","VISIBILITY":1,"REFERENCE_EVALUATION_ID":"sample.sap.kpi.evaluation1","VISUALIZATION_ORDER":0,"DIMENSION":"CompanyCode","IS_ACTIVE":1}],"DDA_CONFIGURATION":[{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","PROPERTY_TYPE":"SAP_FILTER","PROPERTY_VALUE":"","VISIBILITY":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","PROPERTY_TYPE":"SAP_AGGREGATE_VALUE","PROPERTY_VALUE":"","VISIBILITY":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","PROPERTY_TYPE":"SAP_HEADER","PROPERTY_VALUE":"","VISIBILITY":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","PROPERTY_TYPE":"QUERY_SERVICE_URI","PROPERTY_VALUE":"/sap/hba/r/sb/core/odata/SALESORDER_TEST.xsodata","VISIBILITY":1,"IS_ACTIVE":1},{"EVALUATION_ID":"sample.sap.kpi.evaluation1","CONFIGURATION_ID":"view1","PROPERTY_TYPE":"QUERY_ENTITY_SET","PROPERTY_VALUE":"Sales","VISIBILITY":1,"IS_ACTIVE":1}]}};},createTestData:function(){var t=this;var p=t.jsonForTestData();jQuery.ajax({type:"POST",async:false,dataType:"json",data:JSON.stringify(p),url:"/sap/hba/r/sb/core/logic/testData.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){t.refreshMasterList();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("GENERATE_TEST_ENTITIES_SUCCESS"));},error:function(e){t.exportBusyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("GENERATE_TEST_ENTITIES_ERROR"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("GENERATE_TEST_ENTITIES_ERROR"),"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);},});},createFilterOptions:function(){var t=this;var f=new sap.m.ViewSettingsDialog({id:this.createId("filterOptionsDialog"),filterItems:[new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("DRAFTS"),key:"drafts"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVATED"),key:"activated"}),]}),new sap.m.ViewSettingsFilterItem({text:t.oApplicationFacade.getResourceBundle().getText("ACTIVITY"),key:"activity",items:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("SELF_CREATED"),key:"self_created"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("RECENTLY_WORKED_UPON"),key:"recently_worked_upon"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("FAVOURITE"),key:"favorite"}),]})],confirm:function(e){var a="";var s=e.getParameter("filterItems");t.setFiltering(e.getParameter("filterItems"));if(s&&s.length){var b={};for(var i=0,l=s.length;i<l;i++){b[s[i].getParent().getKey()]=b[s[i].getParent().getKey()]||"";b[s[i].getParent().getKey()]+=(b[s[i].getParent().getKey()])?(","):"";b[s[i].getParent().getKey()]+=s[i].getText();}for(var c in b){if(b.hasOwnProperty(c)){a+=(a)?" ; ":"";a+=b[c];}}t.byId("filterToolbar").setVisible(true);t.byId("workspaceInfo").setText(a);}else{t.byId("workspaceInfo").setText("");t.byId("filterToolbar").setVisible(false);}}});return f;},createSortOptions:function(){var t=this;var s=new sap.m.ViewSettingsDialog({id:this.createId("sortOptionsDialog"),sortItems:[new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_CHANGE_DATE"),key:"changedate"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_NAME"),key:"name"}),new sap.m.ViewSettingsItem({text:t.oApplicationFacade.getResourceBundle().getText("BY_ID"),key:"id"})],confirm:function(e){if(e.getParameter("sortItem")){t.setSorting(e.getParameter("sortItem").getKey(),e.getParameter("sortDescending"));}}});s.setSelectedSortItem("changedate");s.setSortDescending(true);return s;},createGroupOptions:function(){var t=this;var j={groupItems:[{text:t.oApplicationFacade.getResourceBundle().getText("BY_WORKSPACE"),key:"workspace",index:0},{text:t.oApplicationFacade.getResourceBundle().getText("BY_TYPE"),key:"type",index:1},{text:t.oApplicationFacade.getResourceBundle().getText("BY_STATUS"),key:"status",index:2},{text:t.oApplicationFacade.getResourceBundle().getText("BY_OWNER"),key:"owner",index:3},{text:t.oApplicationFacade.getResourceBundle().getText("NONE"),key:"none",index:4}]};var m=new sap.ui.model.json.JSONModel(j);var g=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("GROUP_BY"),id:this.createId("groupOptionsDialog"),content:[new sap.m.List({items:{path:"/groupItems",template:new sap.m.ObjectListItem({type:"Active",title:"{text}"})},itemPress:function(e){e.getParameter("listItem").setSelected(true);t.selectedGroupItemKey=e.getParameter("listItem").getBindingContext().getProperty("key");t.selectedGroupItemIndex=e.getParameter("listItem").getBindingContext().getProperty("index");if(t.selectedGroupItemKey=="workspace"){t.setGrouping(t.selectedGroupItemKey,true);}else{t.setGrouping(t.selectedGroupItemKey,false);}t.lastSavedIndex=t.selectedGroupItemIndex;this.getParent().close();}})],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(e){t.selectedGroupItemIndex=t.lastSavedIndex;this.getParent().close();}})});g.setModel(m);return g;},getHeaderFooterOptions:function(){var t=this;var t=this;var p=t.jsonForTestData();if(jQuery.sap.getUriParameters().mParams.createTestData){if(this.currentHeaderFooterOptions.buttonList){var a=false;for(var k in this.currentHeaderFooterOptions.buttonList){if(this.currentHeaderFooterOptions.buttonList[k].sId=="testDataButton")a=true;}if(!a){var o={sId:"testDataButton",sI18nBtnTxt:"GENERATE_TEST_ENTITIES",onBtnPressed:function(e){t.createTestData();}};this.currentHeaderFooterOptions.buttonList.push(o);}}else{this.currentHeaderFooterOptions.buttonList=[{sId:"testDataButton",sI18nBtnTxt:"GENERATE_TEST_ENTITIES",onBtnPressed:function(e){t.createTestData();}}]}}return this.currentHeaderFooterOptions;},formatTitle:function(t){return(t||"");},formatEvaluationCount:function(e){return(e||0);},formatID:function(i){var t=this;return(t.oApplicationFacade.getResourceBundle().getText("KPI_MASTER_ID_TEXT")+": "+(i||""));},formatGroupName:function(c){var t=this;var i=c.getProperty("MANUAL_ENTRY");var g="";switch(i){case 1:g=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:g=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:g=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:g,text:g}},setGrouping:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var a;if(k=="type"){a=new sap.ui.model.Sorter("TYPE",g,function(c){return{key:c.getProperty("TYPE"),text:(c.getProperty("TYPE")+"S")}});}else if(k=="status"){a=new sap.ui.model.Sorter("IS_ACTIVE",g,function(c){return{key:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"):t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"),text:c.getProperty("IS_ACTIVE")?t.oApplicationFacade.getResourceBundle().getText("ACTIVE_KPI_OPI"):t.oApplicationFacade.getResourceBundle().getText("DRAFT_KPI_OPI"),}});}else if(k=="owner"){a=new sap.ui.model.Sorter("OWNER_NAME",g,function(c){var o=c.getProperty("OWNER_NAME");var b="";switch(o){case null:b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;case"":b=t.oApplicationFacade.getResourceBundle().getText("NO_OWNER");break;default:b=o;}return{key:b,text:b}});}else if(k=="workspace"){a=new sap.ui.model.Sorter("MANUAL_ENTRY",g,function(c){var i=c.getProperty("MANUAL_ENTRY");var b="";switch(i){case 1:b=t.oApplicationFacade.getResourceBundle().getText("MY_FAVOURITES");break;case 0:b=t.oApplicationFacade.getResourceBundle().getText("MY_LAST_WORKED_UPON");break;default:b=t.oApplicationFacade.getResourceBundle().getText("ALL_KPI_OPI");}return{key:b,text:b}});}else if(k=="none"){a=null;}if(t.lastSortingOrder&&k!="none"){l.getBinding("items").sort([a,t.lastSortingOrder],true);}else{l.getBinding("items").sort([t.lastSortingOrder]);}this.lastGroupingOption=a;},setFiltering:function(i){var t=this;var f=[];var l=t.getView().byId("list");var a={"drafts":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,0)),"activated":(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1)),"self_created":(new sap.ui.model.Filter("CREATED_BY",sap.ui.model.FilterOperator.EQ,t.oApplicationFacade.currentLogonHanaUser)),"recently_worked_upon":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,0)),"favorite":(new sap.ui.model.Filter("MANUAL_ENTRY",sap.ui.model.FilterOperator.EQ,1))};f=sap.suite.ui.smartbusiness.lib.Util.utils.getFilterArray(i,a);if(f.length){l.getBinding("items").filter(new sap.ui.model.Filter(f,true));}else{l.getBinding("items").filter(f);}},setSorting:function(k,g){var t=this;g=g||false;var l=t.getView().byId("list");var s;if(k=="changedate"){s=new sap.ui.model.Sorter("CHANGED_ON",g,null);}else if(k=="type"){s=new sap.ui.model.Sorter("TYPE",g,null);}else if(k=="name"){s=new sap.ui.model.Sorter("TITLE",g,null);}else if(k=="id"){s=new sap.ui.model.Sorter("ID",g,null);}if(t.lastGroupingOption){l.getBinding("items").sort([t.lastGroupingOption,s],true);}else{l.getBinding("items").sort([s]);}this.lastSortingOrder=s;},toggleListSelection:function(i){if(i){this.byId("list").detachSelectionChange(this._handleSelect,this);this.byId("list").setMode("MultiSelect");this.currentHeaderFooterOptions=this.multiSelectHeaderFooterOptions;this.refreshHeaderFooterForEditToggle();this.oRouter.navTo("multiSelect",{});this.showEmptyView("DETAIL_TITLE",sap.ui.getCore().getConfiguration().getLanguage()," ");}else{this.byId("list").attachSelectionChange(this._handleSelect,this);this.byId("list").setMode("SingleSelectMaster");this.currentHeaderFooterOptions=this.defaultHeaderFooterOptions;this.refreshHeaderFooterForEditToggle();this.oRouter.navTo("detail",{contextPath:this.oApplicationFacade.currentContextPath});}},exportIndicators:function(){var t=this;var d=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_PACKAGES"),items:{path:"/HANA_PACKAGES",template:new sap.m.StandardListItem({title:"{OBJECT}"})},confirm:function(e){var p=e.getParameter("selectedItem").getProperty("title");if(p){var a=t.getExportObject();a=a.replace("<Hana Package Here>",e.getParameter("selectedItem").getProperty("title"));var s=t.byId("list").getSelectedContexts();var b="";var c=[];var f="";for(var i=0,l=s.length;i<l;i++){if(s[i].getProperty("IS_ACTIVE")==1){b+=(b)?',':'';b+='{"value":"'+s[i].getProperty("ID")+'","operator":"="}';}else{f+=(f)?' , ':'';f+='"'+s[i].getProperty("TITLE")+'"';c.push(s[i]);}}a=a.replace(/"<Indicators Here>"/g,b);if(b){if(c.length){sap.m.MessageBox.show(f+" "+t.oApplicationFacade.getResourceBundle().getText("INACTIVE_KPI_OPI_FOR_EXPORT"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("EXPORT_ALERT_TITLE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(g){if(g=="OK"){t.callExportService(a);}else{}});}else{t.callExportService(a);}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_KPI_OPI_FOR_EXPORT"))}}else{sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("NO_HANA_PACKAGE_SELECTED"));}},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});d.setModel(this.oApplicationFacade.getODataModel());d.open();},getExportObject:function(){var e={"data":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"]},{"tableName":"sap.hba.r.sb.core.db::INDICATOR_TEXTS","schema":"SAP_HBA","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[]},{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","customKeys":["ID"],"keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"INDICATOR","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_TEXTS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_VALUES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::EVALUATION_FILTERS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"dependentKey":"INDICATOR","mappingKey":"ID","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"keys":{},"dependentKey":"ID","mappingKey":"ID"}]},{"tableName":"sap.hba.r.sb.core.db::PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"IN","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"ID","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"EV","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"mappingKey":"ID","dependentKey":"INDICATOR","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"dependentKey":"ID","mappingKey":"ID"}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::TAGS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"IN","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"ID","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::TAGS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"TYPE":[{"value":"EV","operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentOn":[],"mappingKey":"ID","dependentKey":"INDICATOR","keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"dependentKey":"ID","mappingKey":"ID"}],"customKeys":["ID","TYPE"]},{"tableName":"sap.hba.r.sb.core.db::ASSOCIATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"SOURCE_INDICATOR","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["SOURCE_INDICATOR"]},{"tableName":"sap.hba.r.sb.core.db::ASSOCIATION_PROPERTIES","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"SOURCE_INDICATOR","mappingKey":"ID","dependentOn":[],"keys":{"ID":["<Indicators Here>"],"IS_ACTIVE":[{"value":1,"operator":"="}]}}],"customKeys":["SOURCE_INDICATOR"]},{"tableName":"sap.hba.r.sb.core.db::DDA_MASTER","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_MASTER_TEXT","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_FILTERS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_HEADER","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_COLUMNS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_CHART","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::DDA_CONFIGURATION","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"customKeys":["EVALUATION_ID"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"EVALUATION_ID","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::CHIPS","schema":"SAP_HBA","keys":{"isActive":[{"value":1,"operator":"="}]},"customKeys":["id"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"evaluationId","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}]},{"tableName":"sap.hba.r.sb.core.db::CHIP_TEXTS","schema":"SAP_HBA","keys":{"isActive":[{"operator":"=","value":1}]},"customKeys":["id"],"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::CHIPS","schema":"SAP_HBA","keys":{"isActive":[{"value":1,"operator":"="}]},"dependentOn":[{"tableName":"sap.hba.r.sb.core.db::EVALUATIONS","schema":"SAP_HBA","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}]},"dependentKey":"evaluationId","mappingKey":"ID","dependentOn":[{"tableName":"sap.hba.r.sb.core.db::INDICATORS","schema":"SAP_HBA","dependentKey":"INDICATOR","mappingKey":"ID","keys":{"IS_ACTIVE":[{"value":1,"operator":"="}],"ID":["<Indicators Here>"]},"dependentOn":[]}]}],"mappingKey":"id","dependentKey":"id"}]}],"file":{"package_name":"<Hana Package Here>"}};return JSON.stringify(e);},callExportService:function(p){var t=this;jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/__token.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){t.exportBusyDialog=t.exportBusyDialog||new sap.m.BusyDialog({text:t.oApplicationFacade.getResourceBundle().getText("EXPORT_KPI_OPI_BUSY_DIALOG_TEXT"),title:t.oApplicationFacade.getResourceBundle().getText("EXPORT_KPI_OPI_BUSY_DIALOG_TITLE")});t.exportBusyDialog.open();jQuery.ajax({url:"/sap/hba/r/sb/core/logic/transferToHanaRepo.xsjs",type:"POST",data:p,headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token")},async:true,success:function(d){t.exportBusyDialog.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("EXPORT_SUCCESS"));},error:function(e){t.exportBusyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("EXPORT_ERROR"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("EXPORT_ERROR"),"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}});},error:function(){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERR_FETCH_AUTH_TOKEN"));$.sap.log.error("ERR_FETCH_AUTH_TOKEN");t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERR_FETCH_AUTH_TOKEN"),"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}});},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.ui.smartbusiness.lib.Util.utils.backToHome();}},applySearchPatternToListItem:function(i,s){return sap.suite.ui.smartbusiness.lib.Util.utils.applySearchPatternToListItem.apply(this,arguments);},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,true);}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.view.S4.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.workspace.view.S4.controller');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/workspace/view/workspaceStyling.css");sap.ui.getCore().loadLibrary("sap.suite.ui.commons");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S4",{onInit:function(){var t=this;this.errorMessages=[];this.errorModel=new sap.ui.model.json.JSONModel();this.errorModel.setData(this.errorMessages);this.errorState=false;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.oApplicationFacade.evaluationDetails=[];this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");if(this.metadataRef.getPlatform()==sap.suite.ui.smartbusiness.Configuration.Constants.Platform.ABAP){this.isPlatformABAP=true;}else{this.isPlatformABAP=false;}this.initializeDrillDownViewPopover();this._addColumnsToTable();this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="evalDetail"){t.byId("tilePanel").setExpanded(false);t.byId("drilldownPanel").setExpanded(false);var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));var a=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.context=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.evalContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.evalPath=e.getParameter("arguments").evalPath;t.contextPath=e.getParameter("arguments").contextPath;var m=new sap.ui.model.json.JSONModel();var b=null;if(!(t.oApplicationFacade.evaluationData)||!(t.oApplicationFacade.evaluationIndex)){var d=t.metadataRef.getKPIById({context:t.context,evaluations:true,noIndicator:true,model:t.oApplicationFacade.getODataModel()});t.oApplicationFacade.evaluationData=d.EVALUATIONS;var f=t.evalPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var g=((t.evalPath.indexOf("IS_ACTIVE=0")!=-1)||(t.evalPath.indexOf("IS_ACTIVE=1")!=-1))?((t.evalPath.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;for(var i=0,l=d.EVALUATIONS.length;i<l;i++){if(d.EVALUATIONS[i].ID==f&&d.EVALUATIONS[i].IS_ACTIVE==g){t.oApplicationFacade.evaluationIndex=i;break;}}}if(t.oApplicationFacade.evaluationDetails&&t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex]){b=t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex];}else{b=t.metadataRef.getEvaluationById({context:t.evalContext,tags:true,properties:true,filters:true,values:true,noEvaluation:true,texts:true,texts_for_chips:true,model:t.oApplicationFacade.getODataModel()});b.EVALUATION=t.oApplicationFacade.evaluationData[t.oApplicationFacade.evaluationIndex];b.FILTERS_IP=t.formObjectForInputParametersAndFilters({results:b.FILTERS}).EVALUATION_FILTERS;b.VALUES_OBJ=t.formObjectForTrendThreshold(b.EVALUATION,b.VALUES);t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex]=b;}b.CHIPS=[];b.DRILLDOWN={ISLOADED:false};m.setData(b);t.getView().setModel(m,"evaluation");t.modelRef=m;t.hideShow(m.getData().EVALUATION.GOAL_TYPE);}},this);},formObjectForTrendThreshold:function(e,a){var o={TA:null,TC:null,RE:null,CL:null,CH:null,WL:null,WH:null};for(var i=0,l=a.length;i<l;i++){if((e.VALUES_SOURCE=="FIXED")||(!(e.VALUES_SOURCE))){o[a[i]["TYPE"]]=a[i]["FIXED"];}else if(e.VALUES_SOURCE=="MEASURE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"];}else if(e.VALUES_SOURCE=="RELATIVE"){if(a[i]["TYPE"]=="TA"||a[i]["TYPE"]=="TC"||a[i]["TYPE"]=="RE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"];}else{o[a[i]["TYPE"]]=a[i]["FIXED"]+"%";}}}if(e){o.GOAL_TYPE=e.GOAL_TYPE;}else{o.GOAL_TYPE=null;}o.VALUES_SOURCE=e.VALUES_SOURCE||"FIXED";return o;},formObjectForInputParametersAndFilters:function(l){var o={EVALUATION_FILTERS:[]},f=0,a=0;var b={};var c=[];var d=[];var i,j,v='',t={};var e,g;var h=new Array(l.results.length);for(i=0;i<l.results.length;i++){h[i]=0;}for(i=0;i<l.results.length;i++){f=0;v='';e=(l.results&&l.results.length)?l.results[i].NAME:"";g=(l.results&&l.results.length)?l.results[i].OPERATOR:"";for(j=i;j<l.results.length;j++){if(l.results[j].NAME==e&&l.results[j].OPERATOR==g&&g!="BT"){t={};v+=l.results[j].VALUE_1+",";t={"ID":l.results[j].ID,"IS_ACTIVE":l.results[j].IS_ACTIVE,"NAME":l.results[j].NAME,"OPERATOR":l.results[j].OPERATOR,"TYPE":l.results[j].TYPE,"VALUES":v,"VALUE_2":null};h[j]=1;}else if(l.results[j].NAME==e&&l.results[j].OPERATOR==g&&g=="BT"){t={};t={"ID":l.results[j].ID,"IS_ACTIVE":l.results[j].IS_ACTIVE,"NAME":l.results[j].NAME,"OPERATOR":l.results[j].OPERATOR,"TYPE":l.results[j].TYPE,"VALUES":l.results[j].VALUE_1,"VALUE_2":l.results[j].VALUE_2};h[j]=1;}else{if(f==0&&h[j]==0){i=j-1;h[j]=1;f=1;}}}if(t.VALUES){if(t.OPERATOR!="BT"){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);}o.EVALUATION_FILTERS.push(t);}}try{var k=this.oApplicationFacade.evaluationData[this.oApplicationFacade.evaluationIndex];var m=k.ODATA_ENTITYSET;var n=this._appendSystemAlias(k.ODATA_URL);this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(n),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(m);var p=this.queryResultObj.getParameterization();var q=[];var r=p.getAllParameters();var s={};for(var u in r){var w=r[u].getName();var x=r[u].getProperty().type;var y=r[u].isOptional();if(w==="P_SAPClient"||w==="V_SAPClient"||w==="SAPClient"){s={name:w}}else{var z={name:w};q.push(z);}}if(s){q.push(s);}for(i=0;i<o.EVALUATION_FILTERS.length;i++){if(o.EVALUATION_FILTERS[i].TYPE=="PA"){b[o.EVALUATION_FILTERS[i].NAME]=o.EVALUATION_FILTERS[i];}else{d.push(o.EVALUATION_FILTERS[i]);}}for(i=0;i<q.length;i++){c.push(b[q[i].name]);}}catch(A){for(i=0;i<o.EVALUATION_FILTERS.length;i++){if(o.EVALUATION_FILTERS[i].TYPE=="PA"){c.push(o.EVALUATION_FILTERS[i]);}else{d.push(o.EVALUATION_FILTERS[i]);}}}o.EVALUATION_FILTERS=c;o.EVALUATION_FILTERS=o.EVALUATION_FILTERS.concat(d);return o;},_appendSystemAlias:function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s);}}return u;},formatOwnerName:function(o){var t=this;if(o==null||o==""){return"";}else{return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"OWNER",o);}},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdCriticalHigh:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_HIGH");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdWarningHigh:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_HIGH");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdWarningLow:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_LOW");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdCriticalLow:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_LOW");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v));},formatOperator:function(o){var t=this;var a=null;switch(o){case'EQ':a=t.oApplicationFacade.getResourceBundle().getText("EQUAL_TO");break;case'GT':a=t.oApplicationFacade.getResourceBundle().getText("GREATER_THAN");break;case'LT':a=t.oApplicationFacade.getResourceBundle().getText("LESS_THAN");break;case'NE':a=t.oApplicationFacade.getResourceBundle().getText("NOT_EQUAL_TO");break;case'BT':a=t.oApplicationFacade.getResourceBundle().getText("BETWEEN");break;case undefined:a=null;break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatTypeOfFilter:function(i){var t=this;var p=null;switch(i){case'FI':p=t.oApplicationFacade.getResourceBundle().getText("FILTER");break;case'PA':p=t.oApplicationFacade.getResourceBundle().getText("INPUT_PARAMETER");break;case undefined:operatorTypeText=null;break;default:p=t.oApplicationFacade.getResourceBundle().getText("NONE");}return p;},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){var h=window.location.hash.replace("evalDetail","detail");sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true);},oUpDownOptions:{sI18NDetailTitle:"ITEM_DETAIL_HEADER",iPosition:0,iCount:0,fSetPosition:function(n){t.oApplicationFacade.evaluationIndex=n;var a="EVALUATIONS_MODELER(ID='"+t.oApplicationFacade.evaluationData[n].ID+"',IS_ACTIVE="+t.oApplicationFacade.evaluationData[n].IS_ACTIVE+")";var v=t.getView();t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationData.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.getHeaderFooterOptions();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(t.contextPath+"/"+a)});}},buttonList:t.getAllFooterButtons()};t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationData.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.updateFooterButtons(t.oApplicationFacade.evaluationData[t.oApplicationFacade.evaluationIndex]);return this.oHeaderFooterOptions;},formatEvalStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"));}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE");}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW");}return i;},hideShow:function(g){var t=this;if(g=="MA"){t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false);t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);}else if(g=="MI"){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true);}else{t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true);}},onAfterAllEvaluationContexts:function(){var t=this;},formatFavoriteMark:function(f){return((f)?true:false);},getAllFooterButtons:function(){var t=this;return[{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){t.errorMessages=[];var a=t.checkForMandatoryParametersForEvaluation();var b=function(g){if(!(g&&g.length)){a.error.push(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_EVALUATION_TITLE"));}};var c=function(g){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),g.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":g.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};t.metadataRef.getDataByEntity({entity:"EVALUATION_TEXTS",filter:"ID eq '"+t.getView().getModel("evaluation").getData().EVALUATION.ID+"' and IS_ACTIVE eq 0 and TITLE ne ''",async:false,success:b,error:c,model:t.oApplicationFacade.getODataModel()});if(a.error.length){var d="";for(var i=0,l=a.error.length;i<l;i++){d+=d?"\n":"";d+=t.oApplicationFacade.getResourceBundle().getText(a.error[i]);}sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),d);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":d});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{if(a.warning.length){var w="";for(var i=0,l=a.warning.length;i<l;i++){w+=w?"\n":"";w+=t.oApplicationFacade.getResourceBundle().getText(a.warning[i]);}var f=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:w+"\n\n"+t.oApplicationFacade.getResourceBundle().getText("WARNING_EV_ACTIVATE")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){f.close();t.activateEvaluation();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){f.close();}})});f.open();}else{t.activateEvaluation();}}}},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){t.errorMessages=[];var p="/FAVOURITES";var c=t.getView().getModel("evaluation").getData().EVALUATION;var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){t.metadataRef.remove("EVALUATION_FAVOURITE",a,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_SUCCESS"));c.MANUAL_ENTRY=null;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==0){t.metadataRef.update("EVALUATION_FAVOURITE",a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==null){t.metadataRef.update("EVALUATION_FAVOURITE",a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}c.MANUAL_ENTRY?e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")):e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"));}},{sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){t.errorMessages=[];var a="/"+t.evalPath;a=(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==2)?a.replace("IS_ACTIVE=1","IS_ACTIVE=0"):a;if(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==2){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluationDraft",context:(t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))});}else if(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==1){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluation",context:(t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))});}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){t.errorMessages=[];if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox");}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var O=t.oApplicationFacade.getODataModel();var p=[];p.push({ID:t.getView().getModel("evaluation").getData().EVALUATION.ID,IS_ACTIVE:t.getView().getModel("evaluation").getData().EVALUATION.IS_ACTIVE});t.metadataRef.remove("EVALUATION",p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_SUCCESS"));t.refreshMasterList();var h=window.location.hash.replace("evalDetail","detail");sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true);},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),a.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),"description":a.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}if(e=="CANCEL"){}});}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){t.errorMessages=[];this.duplicateEvalDialog=this.duplicateEvalDialog||t.createDuplicateDialog();this.duplicateEvalDialog.setContentHeight("350px");t.vBoxForIdPrefixText.setVisible(true);t.prefixInput.setValue();t.prefixInput.setValueState("None");t.prefixForm.setVisible(true);if(!t.settingModel.getData().ID_VISIBLE){t.vBoxForIdPrefixText.setVisible(false);t.prefixForm.setVisible(false);this.duplicateEvalDialog.setContentHeight("200px");}this.duplicateEvalDialog.open();}},{sId:"addTileButton",sI18nBtnTxt:"CONFIGURE_TILE",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPITile",route:"detail",context:("EVALUATIONS_MODELER"+t.evalPath.substr(t.evalPath.indexOf("(")))});}},{sId:"drilldownButton",sI18nBtnTxt:"DRILLDOWN_CONFIG",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_MODELER"+t.evalPath.substr(t.evalPath.indexOf("(")))});}},{sId:"authUsersButton",sI18nBtnTxt:"AUTH_USERS",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"authorizeSBEvaluation",route:"detail",context:(t.evalPath)});}}];},createDuplicateDialog:function(){var t=this;var e=new sap.m.RadioButton({groupName:"DuplicateEval",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_ONLY"),selected:true});var a=new sap.m.RadioButton({groupName:"DuplicateEval",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_AND_ENTITIES")});var b=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("EVAL_ONLY_TEXT")});var c=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("EVAL_AND_ENTITIES_TEXT")});var g=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("GENERATED_ID_INFO")});var d=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_ID_SAMPLE")});var p=new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("ID_PREFIX")});this.prefixInput=new sap.m.Input({type:"Text",maxLength:4,placeholder:t.oApplicationFacade.getResourceBundle().getText("PREFIX_PLACEHOLDER"),showValueHelp:false}).attachLiveChange(function(){t.validatePrefix();});var f=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("CHAR_LIMIT"),});var B=new sap.m.VBox({items:[e,b]});var v=new sap.m.VBox({items:[a,c]});this.vBoxForIdPrefixText=new sap.m.VBox({items:[g,d]});var o=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_OK"),press:function(){if(e.getSelected()){if(t.prefixInput.getVisible()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION-ONLY",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:t.prefixInput.getValue()},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION-ONLY",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:""},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}else if(a.getSelected()){if(t.validatePrefix()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:t.prefixInput.getValue()},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:""},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}}});var h=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_CANCEL"),press:function(){i.close();}});this.prefixForm=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",maxContainerCols:12,labelSpanL:3,labelSpanM:3,labelSpanS:3,columnsL:4,columnsM:4,columnsS:4,content:[p,t.prefixInput,f]});var i=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_DIALOG_TITLE"),contentWidth:"100px",verticalScrolling:false,horizontalScrolling:false,content:[new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",content:[B,v,t.vBoxForIdPrefixText,t.prefixForm]})],beginButton:o,endButton:h});return i;},validatePrefix:function(){var t=this;this.HANA="hana";this.CDS="cds";this.VIEW_MODE=this.HANA;var s=true;var u;if((u=jQuery.sap.getUriParameters().get("viewmode"))){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}var p=t.prefixInput.getValue();if(!p){t.prefixInput.setValueState("None");}if(this.VIEW_MODE==this.CDS){t.prefixInput.setValue(p.toUpperCase());}if(p){if(this.VIEW_MODE==this.CDS&&p[0]!='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"));s=false;}else if(this.VIEW_MODE==this.HANA&&p[0]=='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"));s=false;}else if(!(/^[a-zA-Z0-9.]*$/.test(p))){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_ID_PREFIX_NO_SPL_CHAR"));s=false;}else{t.prefixInput.setValueState("None");t.prefixInput.setValueStateText();}}return s;},updateFooterButtons:function(e){e=e||this.getView().getModel("evaluation").getData().EVALUATION;var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(e.IS_ACTIVE){this.oHeaderFooterOptions.oEditBtn=f[5];this.oHeaderFooterOptions.buttonList.push(f[6]);this.oHeaderFooterOptions.buttonList.push(f[7]);}else{this.oHeaderFooterOptions.oEditBtn=f[0];}if(e.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE");}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE");}this.oHeaderFooterOptions.buttonList.push(f[1]);if(e.IS_ACTIVE){this.oHeaderFooterOptions.buttonList.push(f[4]);}if(e.COUNTER==2){f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT");}else{f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT");}this.oHeaderFooterOptions.buttonList.push(f[2]);this.oHeaderFooterOptions.buttonList.push(f[3]);this.setHeaderFooterOptions(this.oHeaderFooterOptions);},getConstructorParamForTile:function(t){var c;switch(t){case"NT":c={size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:this.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:this.oApplicationFacade.getResourceBundle().getText("ACTUAL")};break;case"CT":c={scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]};break;case"AT":c={scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]};break;case"TT":c={size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),};break;case"CM":c={scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]};break;case"HT":c={total:100,size:"S",scale:"M",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:30,color:"Good"})]};break;}return c;},getPreviewTile:function(t,c){var f="OneByOne";var a,b;switch(t){case'NT':a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile(t));break;case'CT':a=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile(t));break;case'AT':a=new sap.suite.ui.commons.BulletChart(this.getConstructorParamForTile(t));break;case'TT':a=new sap.suite.ui.commons.MicroAreaChart(this.getConstructorParamForTile(t));break;case'CM':a=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile(t));break;case'HT':a=new sap.suite.ui.commons.HarveyBallMicroChart(this.getConstructorParamForTile(t));break;case'DT-AT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.BulletChart(this.getConstructorParamForTile("AT"));break;case'DT-CT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile("CT"));break;case'DT-CM':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile("CM"));break;case'DT-TT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.MicroAreaChart(this.getConstructorParamForTile("TT"));break;}var d=new sap.suite.ui.commons.GenericTile({size:"S",frameType:f,header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:t})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S"}),press:function(e){}});d.addStyleClass("sbTile");if(b){d.addTileContent(new sap.suite.ui.commons.TileContent({content:b,size:"S"}));}return d;},getChipRow:function(i,c){var t=this;var a,b;var d={};try{d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);}catch(e){jQuery.sap.log.error("parsing of Chip Failed");}var n=d.navType=="0"?"GENERIC_DRILLDOWN":"OTHER_DRILLDOWN";var s="STATUS_ACTIVE_DRAFT";var f="Success";var g=false;var h=Number(d.navType)?true:false;if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s="STATUS_ACTIVE";}else{s="STATUS_NEW";f="None";}}var j=new sap.m.ObjectNumber({number:t.oApplicationFacade.getResourceBundle().getText(s),state:f});var b=t.getPreviewTile(c.getProperty('tileType'),c);if(c.getProperty("isAffected")){b.addStyleClass("affectedTile");l.setEnabled(false);g=true;}var k=function(r){var u=this.getBindingContext("evaluation");var v=u.getObject();var w="CHIPS";var x=(v.isActive&&v.COUNTER!=2)?1:0;w=w+"("+q.id+"='"+v.id+"',"+q.isActive+"="+x+")";sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPITile",route:q.editTileRoute,context:(t.evalContext.sPath.substr(1)+"/"+w)});};var l=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Transparent,press:k});var m=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(r){t.handleDelete(this);}});var o=[];if(t.isPlatformABAP){o=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:c.getObject().catalogName,visible:true}),new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("TILE_REMOVED_FROM_CATALOG"),state:"Error",visible:g})]}).addStyleClass("navigationVLayout"),l];}else{o=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText(n)}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:h}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:h}),]}).addStyleClass("navigationVLayout"),j,l];}var p=new sap.m.ColumnListItem({cells:o});if(!(t.isPlatformABAP)){var q={id:"id",isActive:'isActive',editTileRoute:'editTile'};l.attachPress(k);p.attachPress(k);}else if(t.isPlatformABAP&&!(c.getProperty("isAffected"))){var q={id:"ID",isActive:'IS_ACTIVE',editTileRoute:'editTileModelS'};l.attachPress(k);p.attachPress(k);}else{p.setType("Inactive");}return p;},checkForMandatoryParametersForEvaluation:function(){var t=this;var e=t.getView().getModel("evaluation").getData().EVALUATION;var a=[];var w=[];var b={};var c=t.getView().getModel("evaluation").getData().FILTERS;var d=t.getView().getModel("evaluation").getData().VALUES;var f=false;e.ODATA_URL?true:a.push("ERROR_ENTER_ODATA_URL");e.ODATA_ENTITYSET?true:a.push("ERROR_ENTER_ENTITY_SET");e.COLUMN_NAME?true:a.push("ERROR_ENTER_MEASURE");if(e.ODATA_URL&&e.ODATA_ENTITYSET){this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(t._appendSystemAlias(e.ODATA_URL)),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e.ODATA_ENTITYSET);if(this.queryResultObj.getParameterization()){b=this.queryResultObj.getParameterization().getAllParameters();}for(var i=0,l=d.length;i<l;i++){if(d[i].TYPE=="TA"){f=true;}else if(d[i].TYPE&&(d[i].TYPE.toString().search(/^\d\d$/)==0)){if(d[i].COLUMN_NAME==e.COLUMN_NAME){a.push("ADDI_MEASURE_HAS_MAIN_MEASURE");}}}if(!f){w.push("ERROR_ENTER_TARGET");}for(var i=0,l=c.length;i<l;i++){if(c[i].TYPE=='PA'){if(b[c[i].NAME]&&(c[i].VALUE_1!==undefined)&&(c[i].VALUE_1!==null)){delete b[c[i].NAME];}}}if(Object.keys(b).length){a.push("ERROR_ENTER_ALL_INPUT_PARAMETERS");}}return{error:a,warning:w};},formatFilterValue:function(v){if(!v)return v;var a=v.split(",");pattern=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([0-1][0-9]|2[0-3])(:[0-5][0-9]){2}[.][0-9]{3}Z$/;if(!pattern.test(a[0]))return v;var d=[];for(var k in a)d.push(new Date(a[k]).toString());return d.join(",");},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t));},formatScalingFactor:function(s){var t=this;var a=null;switch(s){case 0:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");break;case-2:a=t.oApplicationFacade.getResourceBundle().getText("PERCENT");break;default:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");}return a;},formatDecimalPrecision:function(d){var t=this;var a=null;switch(d){case-1:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");break;case 0:a=t.oApplicationFacade.getResourceBundle().getText("NO_DECIMAL");break;case 1:a=t.convert(1);break;case 2:a=t.convert(2);break;case 3:a=t.convert(3);break;default:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");}return a;},convert:function(v){jQuery.sap.require("sap.ui.core.format.NumberFormat");var a=sap.ui.core.format.NumberFormat.getFloatInstance({style:'standard',minFractionDigits:v,maxFractionDigits:v,});var n=a.format(0);return n;},activateEvaluation:function(){var t=this;var p={};var e="ACTIVE_EVALUATIONS";p.ID=t.getView().getModel("evaluation").getData().EVALUATION.ID;p=p;var O=t.oApplicationFacade.getODataModel();t.metadataRef.create("ACTIVATE_EVALUATION",p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_SUCCESS"));t.refreshMasterList();t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex].EVALUATION.IS_ACTIVE=1;t.byId("evalStatus").setText(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));t.byId("evalStatus").setState(sap.ui.core.ValueState.Success);sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);t.updateFooterButtons(t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex].EVALUATION);},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),a.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":a.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},_addColumnsToTable:function(){var t=this.byId("tileGrid");t.removeAllColumns();if(this.isPlatformABAP){t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("CATALOGUE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}else{t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("NAVIGATION")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("STATUS")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}},onTilePanelExpanded:function(e){if(e.getParameter("expand")){var t=this;var m=this.getView().getModel("evaluation");if(m.getProperty("/CHIPS").length==0){this.metadataRef.getChipByEvaluation({context:this.evalContext,success:function(d){m.setProperty("/CHIPS",d.CHIPS);},error:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),err.responseText);t.errorMessages.push({"type":"Error","title":this.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);},model:this.oApplicationFacade.getODataModel()});}}},initializeDrillDownViewPopover:function(){var t=this;var r=this.oApplicationFacade.getResourceBundle();this.drillDownViewPopover=new sap.m.ResponsivePopover({title:"{/TITLE}",content:[new sap.ui.layout.form.SimpleForm({labelSpanL:2,labelSpanM:2,emptySpanL:0,emptySpanM:0,columnsL:1,columnsM:1,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:r.getText("CHART_TYPE"),design:"Bold"}),new sap.m.Text({text:"{/CHART_TYPE}"}),new sap.m.Label({text:r.getText("MEASURES"),design:"Bold"}),new sap.m.Text({text:{path:"/MEASURES",formatter:function(m){return m?m.join():"";}}}),new sap.m.Label({text:r.getText("DIMENSIONS"),design:"Bold"}),new sap.m.Text({text:{path:"/DIMENSIONS",formatter:function(d){return d?d.join():"";}}})]})],beginButton:new sap.m.Button({text:r.getText("OPEN_IN_DRILLDOWN"),press:function(){var v=this.getModel().getProperty("/ID");var e=this.getModel().getProperty("/EVALID");sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"configureChart",context:e+"/"+v});}})});this.drillDownViewPopover.setModel(new sap.ui.model.json.JSONModel());},onViewPressed:function(e){var d=e.getSource().getBindingContext("evaluation").getObject();this.drillDownViewPopover.getModel().setData(d);this.drillDownViewPopover.openBy(e.getSource());},openAdditionalLanguageDialog:function(e){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=[];this.additionalLanguageListModelData=t.getView().getModel('evaluation').getData().TEXTS;var a=function(o,c,d){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=c;t.localLanguage=d;};var i=0;var l=this.additionalLanguageListModelData.length;sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getAllLanguages({async:false,success:a,model:this.oDataModel});for(i=0;i<l;i++){this.additionalLanguageListModelData[i].ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[this.additionalLanguageListModelData[i].LANGUAGE];}this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.addedLanguagesList=new sap.m.List({showNoData:false,layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){b.getBeginButton().setEnabled(false);}else{b.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L7 M7 S7",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"}),editable:false}),]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var b=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGES"),content:[t.addedLanguagesList],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){b.close();}})});b.open();},onDrillDownPanelExpanded:function(e){if(e.getParameter('expand')){var m=this.getView().getModel("evaluation");if(!(m.getProperty("/DRILLDOWN/ISLOADED"))){var a=this.oApplicationFacade.evaluationDetails[this.oApplicationFacade.evaluationIndex].EVALUATION.ID;var c=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration(a);var v=c.getDefaultView();var h=v?(v.getHeaders()||[]):[];var f=v?(v.getFilters()||[]):[];var d={FILTERS:f.join(", "),VIEWS:[],ISLOADED:true,HEADERS_COUNT:h.length};var b=c.getAllViews()||[];b.forEach(function(g){var i=c.findViewById(g.ID);d.VIEWS.push({ID:g.ID,EVALID:a,MEASURES:i.getMeasures(),DIMENSIONS:i.getDimensions(),TITLE:i.getTitle(),CHART_TYPE:i.getChartConfiguration()[0].oChart.CHART_TYPE,});});d.VIEW_COUNT=d.VIEWS.length;m.setProperty("/DRILLDOWN",d);}}}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.Chip')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.Chip");sap.suite.ui.smartbusiness.lib.Chip=(function(){var d=false;var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml"};var g=function(k,t){var u="ATH";try{if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var l=sap.ushell.Container.getService("UserInfo");if(l&&l.getId){u=l.getId()||"ATH";}}}catch(e){}return k.ID+"_"+u+"_"+t;};var a=function(e,t,s,k){return{"tileType":t,"frameType":"OneByOne","navType":0,"semanticObject":s||e.COLUMN_NAME,"semanticAction":k||"analyzeSBKPIDetails","appParameters":{}};};var E=["ID","INDICATOR","INDICATOR_TITLE","INDICATOR_TYPE","GOAL_TYPE","TITLE","SCALING","ODATA_URL","ODATA_ENTITYSET","VIEW_NAME","COLUMN_NAME","OWNER_NAME","VALUES_SOURCE"];var b=function(e){var k=[];e.FILTERS["results"].forEach(function(l){delete l.__metadata;var o={};for(var m in l){if(l.hasOwnProperty(m)){o[m]=l[m];}}k.push(o);});return k;};var f=function(e,o){if(o){return o.evaluationValues;}else{var v=[];e.VALUES["results"].forEach(function(k){delete k.__metadata;var l={};for(var m in k){if(k.hasOwnProperty(m)){l[m]=k[m];}}v.push(l);});return v;}};var _=function(e){var k=[];if(e&&e.length){e.forEach(function(l){var o={};o["NAME"]=l[0];o["OPERATOR"]=l[1];o["VALUE_1"]=l[2];o["VALUE_2"]=l[3];o["TYPE"]="FI";k.push(o);});}return k;};var h=function(e){var k={};E.forEach(function(l){k[l]=e[l];});return k;};var i=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var e=sap.ushell.Container.getService("URLParsing");if(e){u=e.addSystemToServiceUrl(u,s);}}return u;};var p=function(e,s,C,k){var l="/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";l=i(l,s);var O=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(l);O.create("/CHIPS_USER",e,null,function(){C.call();},function(m){k.call(null,m);},false);};var j=function(e,s,C,k){var l="/sap/hba/r/sb/core/logic/__token.xsjs";l=i(l,s);jQuery.ajax({url:l,type:"HEAD",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(m,n,x){l="/sap/hba/r/sb/core/logic/addToCatalog.xsjs";l=i(l,s);var t=x.getResponseHeader("x-csrf-token");jQuery.ajax({url:l,type:"POST",async:false,data:encodeURIComponent(JSON.stringify(e)),dataType:"json",headers:{"x-csrf-token":t},success:function(m){C.call(null,m);},error:function(o){k.call(null,o);}});},error:function(m){k.call(null,m);}});};return{savePersonalizedTile:function(P){var r={};if(P.evaluationId&&P.tileType){var e=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:P.evaluationId,cache:true,filters:true,thresholds:true,useRuntimeService:true,sapSystem:P.sapSystem});if(e&&e.ID){var T=Date.now()+"";var C=g(e,T);var M={};M["id"]=C;M["tileType"]=P.tileType;M["url"]=c[P.tileType];M["description"]=P.title||e.TITLE;M["title"]=e.INDICATOR_TITLE;M["catalogId"]="HANA_CATALOG";M["configuration"]={tileConfiguration:{}};var k=a(e,P.tileType,P.semanticObject,P.semanticAction);k["id"]=C;k["dimension"]=P.dimension;var l=JSON.stringify(b(e));var m=f(e,P.evaluationValues);var n=JSON.stringify(h(e));M.configuration.tileConfiguration["TILE_PROPERTIES"]=JSON.stringify(k);M.configuration.tileConfiguration["EVALUATION_VALUES"]=JSON.stringify(m);M.configuration.tileConfiguration["EVALUATION"]=n;M.configuration.tileConfiguration["ADDITIONAL_FILTERS"]=JSON.stringify(_(P.additionalFilters));M.configuration.tileConfiguration["ADDITIONAL_APP_PARAMETERS"]=JSON.stringify(P.additionalAppParameters||{});M.configuration.tileConfiguration["timestamp"]=T;M.configuration["isSufficient"]="0";M["evaluationId"]=e.ID;M["keywords"]=P.keywords||null;var o=JSON.stringify(M.configuration).length;if(o>4096){M.configuration.tileConfiguration["EVALUATION_FILTERS"]=JSON.stringify([]);M.configuration["isSufficient"]="0";}M["configuration"].tileConfiguration=JSON.stringify(M["configuration"].tileConfiguration);M["configuration"]=JSON.stringify(M["configuration"]);j(M,P.sapSystem,function(q){r.status="Success",r.chipId=q.chipId,r.message="Tile Created Successfully";},function(q){r.status="Failed",r.message="Error Creating Tile";r.errorDescription=q;});}else{r.status="Failed",r.message="Invalid Evaluation Id : "+P.evaluationId;}}else{r.status="Failed",r.message="Mandatory Param evaluationId or TileType is Missing";}return r;}};})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.DrilldownModel')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownModel");sap.suite.ui.smartbusiness.lib.DrilldownModel=sap.suite.ui.smartbusiness.lib.DrilldownModel||{};sap.suite.ui.smartbusiness.lib.DrilldownModel.Model=function(e,v,i){this.ddaConfigurator=null;this.viewId=v;this.selectedView=null;this.i18nModel=i;this.evaluationId=e;if(this.evaluationId){this._init();}};sap.suite.ui.smartbusiness.lib.DrilldownModel.Model._instances={};sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts={ALL_LANGUAGES:[],CURRENT_LANGUAGE:[],isLoaded:false};sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance=function(e,f,i){function g(a){var m=new sap.suite.ui.smartbusiness.lib.DrilldownModel.Model(a,null,i);sap.suite.ui.smartbusiness.lib.DrilldownModel.Model._instances[a]=m;return sap.suite.ui.smartbusiness.lib.DrilldownModel.Model._instances[a];}if(f){return g(e,null,i);}if(sap.suite.ui.smartbusiness.lib.DrilldownModel.Model._instances[e]){return sap.suite.ui.smartbusiness.lib.DrilldownModel.Model._instances[e];}else{return g(e,null,i);}};sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.prototype={_init:function(e){this.ddaConfigurator=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration(this.evaluationId);this.EVALUATION_DATA=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:this.evaluationId,cache:true,filters:true,thresholds:true});this._setModel();},NEW_VIEWID:"~NA~",_setModel:function(){this._oModel=new sap.ui.model.json.JSONModel(this.getModelDataForDDAConfiguration());try{this._oModel.setSizeLimit(9999);}catch(e){}},removeAllViews:function(){this.getConfigurator().removeAllViews();this._oModel.setData(this.getModelDataForDDAConfiguration());},bindModel:function(c,n){if(n){c.setModel(this._oModel,n);}else{c.setModel(this._oModel);}this._oModel.refresh();},getConfigurator:function(){return this.ddaConfigurator;},setEvaluationId:function(e){this.evaluationId=e;this._init()},setViewId:function(v){this.viewId=v;this.selectedView=this.ddaConfigurator.findViewById(this.viewId);this._setModel();},fetchLanguageData:function(n,s){if(sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.isLoaded){s({ALL_LANGUAGES:sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.ALL_LANGUAGES,CURRENT_LANGUAGE:sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.CURRENT_LANGUAGE});}else{var l=sap.ui.getCore().getConfiguration().getLocale().getLanguage().toUpperCase();new sap.ui.model.odata.ODataModel(sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters("/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata"),true).read("/LANGUAGE?$select=SPRAS,LAISO&orderby=LAISO",null,null,true,function(d){sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.isLoaded=true;var a={ALL_LANGUAGES:[],CURRENT_LANGUAGE:[]};for(var i=0;i<d.results.length;++i){if(d.results[i]["LAISO"]==l){a["CURRENT_LANGUAGE"]=d.results[i]["SPRAS"];d.results.splice(i,1);break;}}a["ALL_LANGUAGES"]=d.results;sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.ALL_LANGUAGES=a["ALL_LANGUAGES"];sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.languageTexts.CURRENT_LANGUAGE=a["CURRENT_LANGUAGE"];s(a);});}},_getEvalData:function(i){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:i,cache:true,filters:false,thresholds:false,getDDAEvaluation:true});return a;}catch(e){return{};}},getDefaultModelData:function(){var t=this;try{var d=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var s=sap.suite.ui.smartbusiness.lib.Util.odata.getSortableProperties(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var f=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET)||[];var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this.EVALUATION_DATA.ODATA_URL,this.EVALUATION_DATA.ODATA_ENTITYSET);var C=p.getLabelMappingObject();}catch(e){var d=[];var m=[];}function _(i){return t._getEvalData(i).INDICATOR_TITLE;}function a(i){return t._getEvalData(i).TITLE;}function b(i){return t._getEvalData(i).INDICATOR;}function g(){var j=[];for(var i=0;i<m.length;i++){j.push({NAME:m[i],LABEL:C[m[i]]})}return j;}function c(){var j=[];var k=["NT","AT","CT","TT","CM"];for(var i=0,l=k.length;i<l;i++){j.push({EVALUATION_ID:t.evaluationId,CONFIGURATION_ID:t.NEW_VIEWID,REFERENCE_EVALUATION_ID:t.evaluationId,VISUALIZATION_TYPE:k[i],VISUALIZATION_TYPE_INDEX:4,VISUALIZATION_ORDER:1,DIMENSION:d[0],DIMENSION_COLOR:"Neutral",SORT_BY:"",SORT_ORDER:"MD",MEASURE1:m[0],MEASURE2:m[1]||m[0],MEASURE3:"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",ALL_MEASURES:m,ALL_DIMENSIONS:d,HARVEY_FILTERS:[{NAME:f[0],OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}],HARVEY_TOTAL_MEASURE:m[0],FILTERABLE_DIMENSIONS:f,IS_HARVEY_FRACTION_KPIMEASURE:true,IS_HARVEYMEASURE_KPIMEASURE:false,VISIBILITY:1,visible:false,TITLE:_(t.evaluationId),SUBTITLE:a(t.evaluationId),GROUPING_TITLE:_(t.evaluationId)+" "+a(t.evaluationId),INDICATOR:b(t.evaluationId)})}return j;}var h={CONFIG:{SAP_AGGREGATE_VALUE:true},ID_EDITABLE:true,INDICATOR:this.EVALUATION_DATA.INDICATOR,ID:"",TITLE:"",EVALUATION_TITLE:this.EVALUATION_DATA.TITLE,QUERY_SERVICE_URI:this.EVALUATION_DATA.ODATA_URL,QUERY_ENTITY_SET:this.EVALUATION_DATA.ODATA_ENTITYSET,TEXT:"",MAIN_MEASURE:"",THRESHOLD_MEASURE:"",ALL_DIMENSIONS:d,ALL_SORTABLE_DIMENSIONS:s,ALL_MEASURES:m,ALL_MEASURES_LABELS:g(),VALUE_TYPES:[{key:"ABSOLUTE",text:this.i18nModel.getProperty("ABSOLUTE_VALUES")},{key:"PERCENTAGE",text:this.i18nModel.getProperty("PERCENTAGE_VALUES")}],AXIS_TYPES:[{key:"SINGLE",text:this.i18nModel.getProperty("SINGLE_AXIS")},{key:"DUAL",text:this.i18nModel.getProperty("DUAL_AXIS")}],AXIS_TYPE:"SINGLE",VALUE_TYPE:"ABSOLUTE",CHART_TYPE:"Column",CHART_TYPES:[{key:"Bar",text:this.i18nModel.getProperty("BARS")},{key:"Column",text:this.i18nModel.getProperty("COLUMNS")},{key:"Line",text:this.i18nModel.getProperty("LINES")},{key:"Combination",text:this.i18nModel.getProperty("COLUMNS_AND_LINES")},{key:"Bubble",text:this.i18nModel.getProperty("BUBBLES")},{key:"Table",text:this.i18nModel.getProperty("TABLE")}],GEO_MAP_TYPE:"Pie",GEO_MAP_TYPES:[{key:"Pie",text:this.i18nModel.getProperty("PIE")},{key:"Bubble",text:this.i18nModel.getProperty("BUBBLES")},{key:"Pin",text:this.i18nModel.getProperty("PIN")},],DATA_MODES:[{key:"DUMMY",text:this.i18nModel.getProperty("DUMMY_DATA")},{key:"RUNTIME",text:this.i18nModel.getProperty("ACTUAL_BACKEND_DATA")}],DATA_MODE:"DUMMY",DATA_LIMIT:200,DATA_LIMITATIONS:false,COLOR_SCHEME:"NONE",COLOR_SCHEMES:[{key:"NONE",text:this.i18nModel.getProperty("DEFAULT_COLORS")},{key:"AUTO_SEMANTIC",text:this.i18nModel.getProperty("AUTO_SEMANTIC_COLORS")},{key:"MANUAL_SEMANTIC",text:this.i18nModel.getProperty("MANUAL_SEMANTIC_COLORS")},{key:"MANUAL_NON_SEMANTIC",text:this.i18nModel.getProperty("MANUAL_COLORS")}],"MANUAL_NON_SEMANTIC":[{color:"sapUiChartPaletteQualitativeHue1",index:0},{color:"sapUiChartPaletteQualitativeHue2",index:1},{color:"sapUiChartPaletteQualitativeHue3",index:2},{color:"sapUiChartPaletteQualitativeHue4",index:3},{color:"sapUiChartPaletteQualitativeHue5",index:4},{color:"sapUiChartPaletteQualitativeHue6",index:5},{color:"sapUiChartPaletteQualitativeHue7",index:6},{color:"sapUiChartPaletteQualitativeHue8",index:7},{color:"sapUiChartPaletteQualitativeHue9",index:8},{color:"sapUiChartPaletteQualitativeHue10",index:9},{color:"sapUiChartPaletteQualitativeHue11",index:10}],"MANUAL_SEMANTIC":[{color:"sapUiChartPaletteSemanticNeutralDark1",index:0},{color:"sapUiChartPaletteSemanticNeutral",index:1},{color:"sapUiChartPaletteSemanticNeutralLight1",index:2},{color:"sapUiChartPaletteSemanticGoodDark1",index:3},{color:"sapUiChartPaletteSemanticGood",index:4},{color:"sapUiChartPaletteSemanticGoodLight1",index:5},{color:"sapUiChartPaletteSemanticCriticalDark1",index:6},{color:"sapUiChartPaletteSemanticCritical",index:7},{color:"sapUiChartPaletteSemanticCriticalLight1",index:8},{color:"sapUiChartPaletteSemanticBadDark1",index:9},{color:"sapUiChartPaletteSemanticBad",index:10},{color:"sapUiChartPaletteSemanticBadLight1",index:11}],COLUMNS:[],SIBLING_EVALUATIONS:[],ASSOCIATED_EVALUATIONS:[],ADDITIONAL_LANGUAGE_TITLES:[],FILTERS:[],HEADER_EVALUATIONID:{},HEADERS_VISIBLE:[],HEADERS:c(),SELECTED_VIEW:"",ALL_VIEWS:this.ddaConfigurator.getAllViews(),ALL_LANGUAGES:[],CURRENT_LANGUAGE:"E"};h.HEADER_EVALUATIONID[this.evaluationId]=true;this.fetchLanguageData("SB_DDACONFIG_LANG",function(o){h.ALL_LANGUAGES=o.ALL_LANGUAGES;h.CURRENT_LANGUAGE=o.CURRENT_LANGUAGE;});return h;},getModelDataForDDAConfiguration:function(){function g(n){return(n==-1||!n)?200:n;}function _(I){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:I,cache:true,filters:true,thresholds:true});return sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(a.ODATA_URL,a.ODATA_ENTITYSET);}catch(e){return[];}}function c(I){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:I,cache:true,filters:true,thresholds:true});return sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(a.ODATA_URL,a.ODATA_ENTITYSET);}catch(e){return[];}}function d(I){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:I,cache:true,filters:true,thresholds:true});return sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(a.ODATA_URL,a.ODATA_ENTITYSET);}catch(e){return[];}}function f(I){var e=t._getEvalData(I);return(e&&e.INDICATOR_TITLE)?e.INDICATOR_TITLE:"";}function h(I){var e=t._getEvalData(I);return(e&&e.TITLE)?e.TITLE:"";}function j(I){var e=t._getEvalData(I);return(e&&e.INDICATOR)?e.INDICATOR:"";}var t=this;var k=["NT","AT","CT","TT","CM"];var m=this.getDefaultModelData();var l,o,p;if(this.selectedView){var t=this;m.ALL_VIEWS=this.ddaConfigurator.getAllViews();m.SELECTED_VIEW=this.selectedView.getId();m.ID=this.selectedView.getId();m.TITLE=this.selectedView.getTitle();m.ADDITIONAL_LANGUAGE_TITLES=this.selectedView.getAdditionalLanguageTitles();m.ID_EDITABLE=false;var q=this.selectedView.getChartConfiguration()[0];m.THRESHOLD_MEASURE=q?q.getThresholdMeasure():"";m.AXIS_TYPE=q?q.getAxisType():"SINGLE";m.VALUE_TYPE=q?q.getValueType():"ABSOLUTE";m.CHART_TYPE=q?q.getChartType().getText():"Bar";m.DATA_LIMIT=q?g(q.getDataLimit()):200;m.DATA_LIMITATIONS=this.getDataLimitations();m.CONFIG.SAP_AGGREGATE_VALUE=this.selectedView.isAggregateValueEnabled();m.COLOR_SCHEME=q?q.getColorScheme().getText():"AUTO_SEMANTIC";if(this.selectedView.getHeaders().length){var r=this.selectedView.getHeaders();m.HEADERS=[];m.HEADERS_VISIBLE=[];var u={};m.HEADER_EVALUATIONID={};r.forEach(function(H){if(H.getVisualizationType()=="HT"){return;}m.HEADER_EVALUATIONID[H.getReferenceEvaluationId()]=true;u[H.getReferenceEvaluationId()]=u[H.getReferenceEvaluationId()]||{};var p=c(H.getReferenceEvaluationId());var o=_(H.getReferenceEvaluationId());var l=d(H.getReferenceEvaluationId());var a=H.getConfiguration();m.HEADERS_VISIBLE.push({EVALUATION_ID:t.evaluationId,CONFIGURATION_ID:m.SELECTED_VIEW,REFERENCE_EVALUATION_ID:H.getReferenceEvaluationId(),VISUALIZATION_TYPE:H.getVisualizationType(),VISUALIZATION_ORDER:H.getVisualizationOrder(),DIMENSION:H.getDimension()||o[0],SORT_BY:"",SORT_ORDER:a.SORTING.by+(a.SORTING.order=="desc"?+"D":"A"),MEASURE1:a.MEASURES[0].name||p[0],MEASURE2:a.MEASURES[1].name||p[1]||p[0],MEASURE3:a.MEASURES[2]?a.MEASURES[2].name:"",COLOR1:a.MEASURES[0].color||"Neutral",COLOR2:a.MEASURES[1].color||"Neutral",COLOR3:a.MEASURES[2]?a.MEASURES[2].color:"Neutral",DIMENSION_COLOR:a.SORTING.dimension_color||"Neutral",FILTERABLE_DIMENSIONS:l,HARVEY_TOTAL_MEASURE:a.HARVEY_TOTAL_MEASURE||p[0],HARVEY_FILTERS:a.HARVEY_FILTERS||[{NAME:l[0],OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}],IS_HARVEY_FRACTION_KPIMEASURE:!!a.IS_HARVEY_FRACTION_KPIMEASURE,IS_HARVEYMEASURE_KPIMEASURE:!a.IS_HARVEY_FRACTION_KPIMEASURE,ALL_MEASURES:p,ALL_DIMENSIONS:o,VISIBILITY:H.getVisibility(),visible:true,TITLE:f(H.getReferenceEvaluationId()),SUBTITLE:h(H.getReferenceEvaluationId()),INDICATOR:j(H.getReferenceEvaluationId())});});m.HEADERS_VISIBLE.sort(function(a,b){return a.VISUALIZATION_ORDER>b.VISUALIZATION_ORDER?1:-1;});m.HEADER_EVALUATIONID[this.evaluationId]=true;u[this.evaluationId]=u[this.evaluationId]||{};var t=this;for(var v in u){var p=c(v);var o=_(v);var l=d(v);k.forEach(function(s){m.HEADERS.push({EVALUATION_ID:t.evaluationId,CONFIGURATION_ID:m.SELECTED_VIEW,REFERENCE_EVALUATION_ID:v,VISUALIZATION_TYPE:s,VISUALIZATION_TYPE_INDEX:k.indexOf(s),VISUALIZATION_ORDER:1,DIMENSION:o[0],SORT_BY:"",SORT_ORDER:"MD",MEASURE1:p[0],MEASURE2:p[1]||p[0],MEASURE3:"",DIMENSION_COLOR:"Neutral",HARVEY_TOTAL_MEASURE:p[0],FILTERABLE_DIMENSIONS:l,HARVEY_FILTERS:[{NAME:l[0],OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}],IS_HARVEY_FRACTION_KPIMEASURE:true,IS_HARVEYMEASURE_KPIMEASURE:false,COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",ALL_MEASURES:p,ALL_DIMENSIONS:_(v),VISIBILITY:1,visible:false,TITLE:f(v),SUBTITLE:h(v),GROUPING_TITLE:f(v)+" "+h(v),INDICATOR:j(v)});});}}var w=this.selectedView.getColumns();for(var i=0;i<w.length;i++){var x=this.selectedView.findColumnByName(w[i]);m.COLUMNS.push({NAME:x.getName(),TYPE:x.getType(),COLOR1:m.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?x.getColor():"",COLOR2:m.COLOR_SCHEME=="MANUAL_SEMANTIC"?x.getColor():"",AXIS:x.getAxis(),SORT_ORDER:x.getSortOrder(),SORT_BY:x.getSortBy(),COLUMNS_ORDER:x.getColumnOrder(),VISIBILITY:x.getVisibility(),STACKING:x.getStacking()});}var y=this.selectedView.getFilters();for(var i=0;i<y.length;i++){var z=y[i];m.FILTERS.push({name:z});}}return m;},getDataLimitations:function(){var c=this.selectedView.getChartConfiguration()[0];if(c&&c.getDataLimit()!=-1){return true;}else if(c&&c.getDataLimit()==-1){return false;}}};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.lib.ModelerReadServices')){jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.ModelerReadServices");sap.suite.ui.smartbusiness.lib.ModelerReadServices=(function(){return{_encodeURL:function(u){return jQuery.sap.encodeURL(u);},getDesigntimeServiceUrl:function(){return"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";},getAllKPIs:function(o){var t=this;var u=this.getDesigntimeServiceUrl();var m=o.model||new sap.ui.model.odata.ODataModel(u,true);var e="";var f="";var a=null;var b=o.success||function(d,s,x){a=(d&&d.results)?d.results:d;};var c=o.error||function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);};var g=o.entity||"/INDICATORS_MODELER";g=(g.indexOf("/")==0)?g:("/"+g);if(o.tags){e+=(e)?",":"";e+="TAGS";}if(o.properties){e+=(e)?",":"";e+="PROPERTIES";}if(o.texts){e+=(e)?",":"";e+="TEXTS";}if(o.evaluations){e+=(e)?",":"";e+="EVALUATIONS";}if(o.associations){e+=(e)?",":"";e+="ASSOCIATION_SOURCE";e+="ASSOCIATION_TARGET";}if(o.filter){f=o.filter;}o.async=(o.async)?true:false;m.read(g,null,(f||null),o.async,b,c);return a;},getKPIMasterDetailsById:function(o){var t=this;if(!(o.ID&&o.IS_ACTIVE!==null&&o.IS_ACTIVE!==undefined)&&!(o.context)){throw new Error("Failed to get Indicator Id or Status for data fetch");return null;}var c=null;var a=o.context||null;var u=this.getDesigntimeServiceUrl();var m=o.model||new sap.ui.model.odata.ODataModel(u,true);var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;o.IS_ACTIVE=o.context.getObject().IS_ACTIVE;}else{o.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');o.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(o.ID&&o.IS_ACTIVE!==null&&o.IS_ACTIVE!==undefined){o.ENTITY=o.ENTITY||"/INDICATORS_MODELER";o.ENTITY=(o.ENTITY.indexOf("/")!=0)?("/"+o.ENTITY):o.ENTITY;c=o.ENTITY+"(ID='"+o.ID+"',IS_ACTIVE="+o.IS_ACTIVE+")";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noIndicator)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.INDICATOR=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("INDICATOR");}}if(o.tags){b.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){b.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}if(o.texts){b.push(m.createBatchOperation(c+"/TEXTS","GET"));r.push("TEXTS");}if(o.evaluations){b.push(m.createBatchOperation(c+"/EVALUATIONS","GET"));r.push("EVALUATIONS");}if(o.associations&&o.associationProperties){b.push(m.createBatchOperation("/ASSOCIATIONS_MODELER?$filter="+t._encodeURL("SOURCE_INDICATOR eq '"+o.ID+"' or TARGET_INDICATOR eq '"+o.ID+"'")+"&$expand=PROPERTIES","GET"));r.push("ASSOCIATIONS");}else if(o.associations){b.push(m.createBatchOperation(c+"/ASSOCIATION_SOURCE","GET"));b.push(m.createBatchOperation(c+"/ASSOCIATION_TARGET","GET"));r.push("ASSOCIATION_SOURCE");r.push("ASSOCIATION_TARGET");}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,g){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Indicator details");},o.async);if(o.associations&&o.associationProperties){for(var i=0,l=d.ASSOCIATIONS.length;i<l;i++){if(d.ASSOCIATIONS[i].PROPERTIES){if(d.ASSOCIATIONS[i].PROPERTIES.results&&d.ASSOCIATIONS[i].PROPERTIES.results.length){d.ASSOCIATIONS[i].PROPERTIES=d.ASSOCIATIONS[i].PROPERTIES.results;}else{d.ASSOCIATIONS[i].PROPERTIES=[];}}else{d.ASSOCIATIONS[i].PROPERTIES=[];}}}else{d.ASSOCIATIONS=[].concat(d.ASSOCIATION_SOURCE).concat(d.ASSOCIATION_TARGET);}return d;},getEvaluationMasterDetailsById:function(o){var t=this;if(!(o.ID&&o.IS_ACTIVE!==null&&o.IS_ACTIVE!==undefined)&&!(o.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var a=o.context||null;var u=this.getDesigntimeServiceUrl();var m=o.model||new sap.ui.model.odata.ODataModel(u,true);var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.ID=o.context.getObject().ID;o.IS_ACTIVE=o.context.getObject().IS_ACTIVE;}else{o.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');o.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(o.ID&&o.IS_ACTIVE!==null&&o.IS_ACTIVE!==undefined){o.ENTITY=o.ENTITY||"/EVALUATIONS_MODELER";o.ENTITY=(o.ENTITY.indexOf("/")!=0)?("/"+o.ENTITY):o.ENTITY;c=o.ENTITY+"(ID='"+o.ID+"',IS_ACTIVE="+o.IS_ACTIVE+")";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noEvaluation)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.EVALUATION=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("EVALUATION");}}if(o.tags){b.push(m.createBatchOperation(c+"/TAGS","GET"));r.push("TAGS");}if(o.properties){b.push(m.createBatchOperation(c+"/PROPERTIES","GET"));r.push("PROPERTIES");}if(o.texts){b.push(m.createBatchOperation(c+"/TEXTS","GET"));r.push("TEXTS");}if(o.filters){b.push(m.createBatchOperation(c+"/FILTERS","GET"));r.push("FILTERS");}if(o.values){b.push(m.createBatchOperation(c+"/VALUES","GET"));r.push("VALUES");}if(o.chips){b.push(m.createBatchOperation(c+"/CHIPS","GET"));r.push("CHIPS");}if(o.dda_configurations){b.push(m.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));r.push("DDA_CONFIGURATIONS");}if(o.dda_header_tiles){b.push(m.createBatchOperation(c+"/DDA_HEADER_TILES","GET"));r.push("DDA_HEADER_TILES");}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,g){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Evaluation details");},o.async);return d;},getChipMasterDetailsById:function(o){var t=this;if(!(o.id&&o.isActive!==null&&o.isActive!==undefined)&&!(o.context)){throw new Error("Failed to get Chip Id or Status for data fetch");return null;}var c=null;var a=o.context||null;var u=this.getDesigntimeServiceUrl();var m=o.model||new sap.ui.model.odata.ODataModel(u,true);var d={};if(o.context){c=o.context.sPath;if(o.context.getObject()){o.id=o.context.getObject().id;o.isActive=o.context.getObject().isActive;}else{o.id=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');o.isActive=((c.indexOf("isActive=0")!=-1)||(c.indexOf("isActive=1")!=-1))?((c.indexOf("isActive=0")!=-1)?0:1):null;}}else if(o.id&&o.isActive!==null&&o.isActive!==undefined){o.ENTITY=o.ENTITY||"/CHIPS_MODELER";o.ENTITY=(o.ENTITY.indexOf("/")!=0)?("/"+o.ENTITY):o.ENTITY;c=o.ENTITY+"(id='"+o.ID+"',isActive="+o.isActive+")";a=new sap.ui.model.Context(m,c);}var s=o.success;var e=o.error;var b=[];var r=[];if(!(o.noChip)){if(a&&a.getObject()&&Object.keys(a.getObject())&&Object.keys(a)){d.CHIP=a.getObject();}else{b.push(m.createBatchOperation(c,"GET"));r.push("CHIP");}}if(o.evaluation){b.push(m.createBatchOperation(c+"/EVALUATION_INFO","GET"));r.push("EVALUATION_INFO");}if(o.texts){b.push(m.createBatchOperation(c+"/TEXTS","GET"));r.push("TEXTS");}if(o.dda_configurations){b.push(m.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));r.push("DDA_CONFIGURATIONS");}o.async=(o.async)?true:false;m.addBatchReadOperations(b);m.submitBatch(function(f,g){var A=f.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(r[i]+" : "+JSON.stringify(A[i]));d[r[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(d);}},function(f){if(e){e(f);}throw new Error("Failed to fetch Chip details");},o.async);return d;}};})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.AreaChart')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.AreaChart");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.AreaChart",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"TT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}});};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"});};this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}});};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"});};this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"",size:this.getSize(),footer:"",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}));}};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.getEvalValueMeasureName=function(c,t,r){var e=c.VALUES.results;for(var i=0;i<e.length;i++){if(e[i].TYPE==t)if(r==="FIXED")return e[i].FIXED;else return e[i].COLUMN_NAME;}};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doProcess=function(){var t=this;this._fetchDataForAreaChartTile(function(m){var d={};if(true||t.isAssociatedKpi()){d.subheader=this.oConfig.TITLE;d.header=this.oConfig.INDICATOR_TITLE;}d=jQuery.extend({},d,m);t.jsonModel.setData(d);t.setDoneState();},this.logError);};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._fetchDataForAreaChartTile=function(s,e){var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.oConfig.ODATA_URL,this.getSapSystem());p.entitySet=this.oConfig.ODATA_ENTITYSET;p.measure=this.oConfig.COLUMN_NAME;p.dimension=this.getDimension();if(!this.getDimension()){this.logError("Dimension is Missing : Can't Render Area Chart");return;}p.filter=this.getAllFilters();if(this.oConfig.VALUES_SOURCE=="MEASURE"){var f=t.oConfig.COLUMN_NAME;switch(t.oConfig.GOAL_TYPE){case"MI":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"MA":t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"RA":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");break;}var _=[t.sWarningHigh,t.sCriticalHigh,t.sTarget,t.sTrend,t.sWarningLow,t.sCriticalLow];_.forEach(function(c){if(c){f+=","+c;}},this);p.measure=f;}var a=sap.suite.ui.smartbusiness.lib.Util.odata.getUri(p);var U=this.UOM_PROPERTY_MAPPING[this.oConfig.COLUMN_NAME];var b="";this.areaChartODataRef=a.model.read(a.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){if(U){b=d.results[0][U];}p.dimension=t.TEXT_PROPERTY_MAPPING[t.getDimension()];t.UOM=b;var m=t._processDataForAreaChart(d,t.oConfig.VALUES_SOURCE,p.dimension,t.oConfig.COLUMN_NAME);m.unit=b;s.call(t,m);}else{t.setNoData();}},function(c){if(c&&c.response){jQuery.sap.log.error(c.message+" : "+c.request.requestUri);}});};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._processDataForAreaChart=function(d,t,c,m){var f=this;var g=f.oConfig.VALUES.results;var h=[];var j=[];var w=[];var l=[];var n=[];var o=[];var p=d.results.length;var s=f.oConfig.SCALING;var q=d.results[0][c];var r,u,v,y,z;var A=d.results[d.results.length-1][c];var B=Number(d.results[0][m]);var C=Number(d.results[d.results.length-1][m]);var D=f.oConfig.GOAL_TYPE;for(i in d.results){d.results[i][c]=Number(i);d.results[i][m]=Number(d.results[i][m]);f.sWarningHigh?d.results[i][f.sWarningHigh]=Number(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?d.results[i][f.sCriticalHigh]=Number(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?d.results[i][f.sCriticalLow]=Number(d.results[i][f.sCriticalLow]):"";f.sWarningLow?d.results[i][f.sWarningLow]=Number(d.results[i][f.sWarningLow]):"";f.sTarget?d.results[i][f.sTarget]=Number(d.results[i][f.sTarget]):"";f.sWarningHigh?w.push(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?l.push(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?n.push(d.results[i][f.sCriticalLow]):"";f.sWarningLow?o.push(d.results[i][f.sWarningLow]):"";h.push(d.results[i][c]);j.push(d.results[i][m]);}this.FINAL_MEASURE_VALUE=d.results[i][m];this.FINAL_DIMENSION_NAME=this.TEXT_PROPERTY_MAPPING[c]||c;this.FINAL_DIMENSION_VALUE=A;if(t=="MEASURE"){this.TARGET_VALUE=d.results[i][f.sTarget];this.CRITICAL_LOW_VALUE=d.results[i][f.sCriticalLow];this.WARNING_LOW_VALUE=d.results[i][f.sWarningLow];this.CRITICAL_HIGH_VALUE=d.results[i][f.sCriticalHigh];this.WARNING_HIGH_VALUE=d.results[i][f.sWarningHigh];}else{var E=function(e){var x={};for(var k in e){x[e[k].TYPE]=e[k].FIXED};return x;};var F=E(g);this.TARGET_VALUE=F.TA;this.CRITICAL_LOW_VALUE=F.CL;this.WARNING_LOW_VALUE=F.WL;this.CRITICAL_HIGH_VALUE=F.CH;this.WARNING_HIGH_VALUE=F.WH;}this.initTTPopup();try{q=f.formatOdataObjectToString(q);A=f.formatOdataObjectToString(A);}catch(e){f.logError(e);}var G=Math.min.apply(Math,j);var S="";var H=B;var I=this.isACurrencyMeasure(this.oConfig.COLUMN_NAME);var J=this.libFormat(H,I,this.UOM);var K=J.toString();var L=Math.max.apply(Math,j);H=C;sap.ui.getCore().byId("m1e1 title");var M=this.libFormat(H,I,this.UOM);var N=M.toString();try{var O=f.formatOdataObjectToString(Math.min.apply(Math,h));var P=f.formatOdataObjectToString(Math.max.apply(Math,h));}catch(e){f.logError(e);}if(t=="MEASURE"){(w.length!=0)?(f.firstwH=w[O])&&(f.lastwH=w[P]):"";(l.length!=0)?(f.firstcH=l[O])&&(f.lastcH=l[P]):"";(n.length!=0)?(f.firstcL=n[O])&&(f.lastcL=n[P]):"";(o.length!=0)?(f.firstwL=o[O])&&(f.lastwL=o[P]):"";}var Q={width:"100%",height:"100%",unit:f.unit||"",chart:{color:"Neutral",data:d.results},minXValue:O,maxXValue:P,minYValue:G,maxYValue:L,firstXLabel:{label:q+"",color:"Neutral"},lastXLabel:{label:A+"",color:"Neutral"},firstYLabel:{label:K+"",color:"Neutral"},lastYLabel:{label:N+"",color:"Neutral"},minLabel:{},maxLabel:{}};switch(D){case"MA":for(i in g){if(g[i].TYPE=="CL"){Q.minThreshold={color:"Error",};var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sCriticalLow:m;}else if(g[i].TYPE=="WL"){Q.maxThreshold={color:"Good"};var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sWarningLow:m;f.wl=Number(g[i].FIXED);}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}Q.innerMinThreshold={data:[]};Q.innerMaxThreshold={data:[]};if(t=="FIXED"){Q.firstYLabel.color=B<f.cl?"Error":((f.cl<=B)&&(B<=f.wl))?"Critical":(B>f.wl)?"Good":"Neutral";Q.lastYLabel.color=C<f.cl?"Error":((f.cl<=C)&&(C<=f.wl))?"Critical":(C>f.wl)?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL){Q.firstYLabel.color=B<f.firstcL?"Error":((f.firstcL<=B)&&(B<=f.firstwL))?"Critical":(B>f.firstwL)?"Good":"Neutral";Q.lastYLabel.color=C<f.lastcL?"Error":((f.lastcL<=C)&&(C<=f.lastwL))?"Critical":(C>f.lastwL)?"Good":"Neutral";}break;case"MI":for(i in g){if(g[i].TYPE=="CH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);Q.maxThreshold={color:"Error",};Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sCriticalHigh:m;}else if(g[i].TYPE=="WH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);Q.minThreshold={color:"Good",};Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sWarningHigh:m;}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}if(t=="FIXED"){Q.firstYLabel.color=B>f.ch?"Error":((f.wh<=B)&&(B<=f.ch))?"Critical":(B<f.wh)?"Good":"Neutral";Q.lastYLabel.color=C>f.ch?"Error":((f.wh<=C)&&(C<=f.ch))?"Critical":(C<f.wh)?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){Q.firstYLabel.color=B>f.firstcH?"Error":((f.firstwH<=B)&&(B<=f.firstcH))?"Critical":(B<f.firstwH)?"Good":"Neutral";Q.lastYLabel.color=C>f.lastcH?"Error":((f.lastwH<=C)&&(C<=f.lastcH))?"Critical":(C<f.lastwH)?"Good":"Neutral";}Q.innerMaxThreshold={data:[]};Q.innerMinThreshold={data:[]};break;case"RA":for(i in g){if(g[i].TYPE=="CH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);Q.maxThreshold={color:"Error",};Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sCriticalHigh:m;}else if(g[i].TYPE=="WH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);Q.innerMaxThreshold={color:"Good",};Q.innerMaxThreshold.data=(t=="MEASURE")?d.results:[R];y=(t=="MEASURE")?f.sWarningHigh:m;}else if(g[i].TYPE=="WL"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wl=Number(g[i].FIXED);Q.innerMinThreshold={color:"Good",};Q.innerMinThreshold.data=(t=="MEASURE")?d.results:[R];v=(t=="MEASURE")?f.sWarningLow:m;}else if(g[i].TYPE=="CL"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);Q.minThreshold={color:"Error",};Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sCriticalLow:m;}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}if(t=="FIXED"){Q.firstYLabel.color=(B>f.ch||B<f.cl)?"Error":((f.wh<=B)&&(B<=f.ch))||((f.cl<=B)&&(B<=f.wl))?"Critical":((B>=f.wl)&&(B<=f.wh))?"Good":"Neutral";Q.lastYLabel.color=(C>f.ch||C<f.cl)?"Error":((f.wh<=C)&&(C<=f.ch))||((f.cl<=C)&&(C<=f.wl))?"Critical":((C>=f.wl)&&(C<=f.wh))?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){Q.firstYLabel.color=(B>f.firstcH||B<f.firstcL)?"Error":((f.firstwH<=B)&&(B<=f.firstcH))||((f.firstcL<=B)&&(B<=f.firstwL))?"Critical":((B>=f.firstwL)&&(B<=f.firstwH))?"Good":"Neutral";Q.lastYLabel.color=(C>f.lastcH||C<f.lastcL)?"Error":((f.lastwH<=C)&&(C<=f.lastcH))||((f.lastcL<=C)&&(C<=f.lastwL))?"Critical":((C>=f.lastwL)&&(C<=f.lastwH))?"Good":"Neutral";}break;}var T=function(k,a,b,t){return new sap.suite.ui.commons.MicroAreaChartItem({color:"{/"+k+"/color}",points:{path:"/"+k+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{"+a+"}",y:"{"+b+"}"})}});};var U=null;if(this.getContentOnly()){U=f.getTileControl();}else{U=f.getTileControl().getTileContent()[0].getContent();}U.setTarget(T("target",c,z));U.setInnerMinThreshold(T("innerMinThreshold",c,v));U.setInnerMaxThreshold(T("innerMaxThreshold",c,y));U.setMinThreshold(T("minThreshold",c,r));U.setMaxThreshold(T("maxThreshold",c,u));U.setChart(T("chart",c,m));return Q;};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForAreaChartTile());};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.showTTPopup=function(){this._TTpopOver.openBy(this);};sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.initTTPopup=function(){var s=this;var m=new sap.ui.model.json.JSONModel();var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:sap.ui.core.ValueState.None}));t.setModel(m);var b={};b.targetVal=this.TARGET_VALUE;b.critLowVal=this.CRITICAL_LOW_VALUE;b.warnLowVal=this.WARNING_LOW_VALUE;b.critHighVal=this.CRITICAL_HIGH_VALUE;b.warnHighVal=this.WARNING_HIGH_VALUE;if(this.evaluationApi.getScaling()==-2){this.FINAL_MEASURE_VALUE=(this.FINAL_MEASURE_VALUE*100)+" %";for(var e in b){if(b[e]){b[e]=(b[e]*100)+" %";}}}a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("ACTUAL"),value:this.VALUE_FORMATTER.format(this.FINAL_MEASURE_VALUE)});if(this.evaluationApi.isMaximizingKpi()){if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}else if(this.evaluationApi.isMinimizingKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});}else if(this.evaluationApi.isTargetKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.FINAL_DIMENSION_NAME&&this.FINAL_DIMENSION_VALUE?this.FINAL_DIMENSION_NAME+" ("+this.FINAL_DIMENSION_VALUE+")":this.getModel("i18n").getProperty("THRESHOLD_LABEL")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){if(this._TTpopOver.isOpen()){this._TTpopOver.close();}},this)})]});this._TTpopOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var S=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());S.addContent(this._TTpopOver,true);};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Bullet')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Bullet");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Bullet",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:true},tileType:{type:"string",defaultValue:"AT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Bullet.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.BulletChart({size:this.getSize(),state:"{/state}",scale:"{/scale}",actual:{value:"{/actual/value}",color:"{/actual/color}"},actualValueLabel:"{/actualValueLabel}",targetValue:"{/targetValue}",targetValueLabel:"{/targetValueLabel}",thresholds:{template:new sap.suite.ui.commons.BulletChartData({value:"{value}",color:"{color}"}),path:"/thresholds"},showActualValue:"{/showActualValue}",showTargetValue:"{/showTargetValue}",})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.BulletChart({size:this.getSize(),state:"{/state}",scale:"{/scale}",actual:{value:"{/actual/value}",color:"{/actual/color}"},actualValueLabel:"{/actualValueLabel}",targetValue:"{/targetValue}",targetValueLabel:"{/targetValueLabel}",thresholds:{template:new sap.suite.ui.commons.BulletChartData({value:"{value}",color:"{color}"}),path:"/thresholds"},showActualValue:"{/showActualValue}",showTargetValue:"{/showTargetValue}",})}));}};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.doProcess=function(){var d={};var t=this.getThresholdsObjAndColor(this.KPI_VALUE,this.EVALUATION_DATA.GOAL_TYPE,this.WARNING_LOW_VALUE,this.WARNING_HIGH_VALUE,this.CRITICAL_LOW_VALUE,this.CRITICAL_HIGH_VALUE);var a={value:Number(this.KPI_VALUE),color:t.returnColor};var c=Number(this.KPI_VALUE);var i=this.isACurrencyMeasure(this.EVALUATION_DATA.COLUMN_NAME);var f=this.libFormat(c,i,this.UOM);c=Number(this.TARGET_VALUE);var b=this.libFormat(c,i,this.UOM);if(true||this.isAssociatedKpi()){d.subheader=this.EVALUATION_DATA.TITLE;d.header=this.EVALUATION_DATA.INDICATOR_TITLE;}d.actual=a;d.thresholds=[];d.thresholds=t.arrObj;d.targetValue=Number(this.TARGET_VALUE);d.unit=this.UOM;d.actualValueLabel=f.toString();d.targetValueLabel=b.toString();this.jsonModel.setData(d);this.setDoneState();};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForBulletTile());this.setDoneState();};sap.suite.ui.smartbusiness.tiles.Bullet.prototype.getThresholdsObjAndColor=function(k,g,w,a,c,b){var t={};t.arrObj=[];t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Neutral;if(g==="MI"){if(this.hasSomeValue(b,a)){b=window.parseFloat(b);a=window.parseFloat(a);t.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:a,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(k<a){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}else if(k<=b){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}}else{jQuery.sap.log.warning("One of the threshold values for Minimizing type KPI is missing");}}else if(g==="MA"){if(this.hasSomeValue(c,w)){c=window.parseFloat(c);w=window.parseFloat(w);t.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(k<c){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}else if(k<=w){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}}else{jQuery.sap.log.warning("One of the threshold values for Maximizing type KPI is missing");}}else{if(this.hasSomeValue(w,a,c,b)){b=window.parseFloat(b);a=window.parseFloat(a);w=window.parseFloat(w);c=window.parseFloat(c);t.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});t.arrObj.push({value:a,color:sap.suite.ui.commons.InfoTileValueColor.Critical});t.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});t.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});if(k<c||k>b){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}else if((k>=c&&k<=w)||(k>=a&&k<=b)){t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{t.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}}else{jQuery.sap.log.warning("One of the threshold values for Range type KPI is missing");}}return t;};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.tiles.Comparison')){jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.Comparison");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.Comparison",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"CT"}}},renderer:{}});sap.suite.ui.smartbusiness.tiles.Comparison.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.ComparisonChart({scale:"{/scale}",size:this.getSize(),state:"{/state}",data:{template:new sap.suite.ui.commons.ComparisonData({title:"{title}",value:"{value}",color:"{color}",displayValue:"{displayValue}"}),path:"/data"}})}));}};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.doProcess=function(){var t=this;this._fetchDataForComparisonTile(function(k){var d={};d.data=k.kpiData;if(k.unitPrefix){d.unit=k.unitPrefix;}if(true||t.isAssociatedKpi()){d.subheader=this.evaluationApi.getTitle();d.header=this.evaluationApi.getKpiName();}t.jsonModel.setData(d);t.setDoneState();},this.logError);};sap.suite.ui.smartbusiness.tiles.Comparison.prototype._fetchDataForComparisonTile=function(s,e){var _=function(a){var b=[{name:this.EVALUATION_DATA.COLUMN_NAME,order:"desc"}];if(a&&a.SORTING){var c=a.SORTING;if((c.order=='asc'||c.order=='desc')&&(c.by=='M'||c.by=='D')){var r=[];r.push({name:(c.by=='M'?this.evaluationApi.getKpiMeasureName():this.getDimension()),order:c.order});return r;}}return b;};var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.evaluationApi.getODataUrl(),this.getSapSystem());p.entitySet=this.evaluationApi.getEntitySet();p.measure=this.evaluationApi.getKpiMeasureName();p.dimension=this.getDimension();p.filter=this.getAllFilters();p.sort=_.apply(this,[this.getTileConfiguration()]);p.dataLimit=3;t.oConfig.FINALVALUE={};p.sortingColumn=this.evaluationApi.getKpiMeasureName();var f=sap.suite.ui.smartbusiness.lib.Util.odata.getUri(p);var u=this.UOM_PROPERTY_MAPPING[this.evaluationApi.getKpiMeasureName()];var d=this.TEXT_PROPERTY_MAPPING;this.comparisionChartODataRef=f.model.read(f.uri,null,null,true,function(a){if(a&&a.results&&a.results.length){if(u){t.oConfig.FINALVALUE.unitPrefix=a.results[0][u];}t.oConfig.FINALVALUE.kpiData=a;p.dimension=d[t.getDimension()];t.oConfig.FINALVALUE.kpiData=t._processDataForComparisonChart(t.oConfig.FINALVALUE.kpiData,p.measure,p.dimension);s.call(t,t.oConfig.FINALVALUE);t.initCTPopup();}else{t.setNoData();}},function(a){if(a&&a.response){jQuery.sap.log.error(a.message+" : "+a.request.requestUri);}});};sap.suite.ui.smartbusiness.tiles.Comparison.prototype._processDataForComparisonChart=function(d,m,a){var b=true;var t=this.getTileConfiguration();var s=(t&&t.SORTING&&t.SORTING.dimension_color)||(function(){b=false;return sap.suite.ui.commons.ValueStatus.Neutral;})();var f=[];var c;var g=this;if(!b){jQuery.sap.log.error("No Tile Configuration available for tile - "+this.getId());}for(var i=0;i<d.results.length;i++){var h=d.results[i];var j={};try{j.title=h[a].toString();}catch(e){j.title="";};j.value=Number(h[m]);var k=Number(h[m]);var l=this.isACurrencyMeasure(m);var u=this.oConfig.FINALVALUE.unitPrefix;var c=this.libFormat(k,l,u);j.displayValue=c.toString();if(s==void(0)){j.color=sap.suite.ui.commons.ValueStatus.Neutral;}else{j.color=s;}f.push(j);}return f;};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForComparisonTile());};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.showCTPopup=function(){this._CTpopOver.openBy(this);};sap.suite.ui.smartbusiness.tiles.Comparison.prototype.initCTPopup=function(){var s=this;var m=new sap.ui.model.json.JSONModel();var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});var g=function(f){return{"Error":sap.ui.core.ValueState.Error,"Neutral":sap.ui.core.ValueState.None,"Good":sap.ui.core.ValueState.Success,"Warning":sap.ui.core.ValueState.Warning,"Critical":sap.ui.core.ValueState.Warning}[f]||sap.ui.core.ValueState.None;};t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:{path:"color",formatter:g}}));t.setModel(m);var b=this.oConfig.FINALVALUE.kpiData;if(this.evaluationApi.getScaling()==-2){for(var e in b){if(b[e]){b[e].value=(b[e].value*100)+" %";}}}for(var j in b){a.THRESHOLDS.push({name:b[j].title,value:this.VALUE_FORMATTER.format(b[j].value),color:b[j].color});}m.setData(a);var d=this.TEXT_PROPERTY_MAPPING[this.getDimension()]||this.getDimension();var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:d})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){if(this._CTpopOver.isOpen()){this._CTpopOver.close();}},this)})]});this._CTpopOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var S=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());S.addContent(this._CTpopOver,true);};};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.Adapter')){jQuery.sap.declare("sap.suite.ui.smartbusiness.Adapter");(function(){var S={"Navigation":{func:"getNavigationServicePath"},"ModelerServices":{func:"getMetadataPath"},"CatalogServices":{func:"getCatalogServicePath"},"DrilldownServices":{func:"getMetadataPath"},"RuntimeServices":{func:"getMetadataPath"}};var c=sap.suite.ui.smartbusiness.Configuration;var _={};var g=function(c,s){return c[S[s]["func"]]()+"."+s;};var A=function(){this.getService=function(s,p){p=p||{};var m,a,b,t,d;if(!S[s]){throw new Error("Service '"+s+"' Not Supported!");}m=c.getLibraryModulePath()+"."+s;d=m+"_"+JSON.stringify(p);if(_[d]){return _[d];}jQuery.sap.require(m);b=jQuery.sap.getObject(m);if(b.hasAdapter){a=g(c,s)+"Adapter";jQuery.sap.require(a);b=jQuery.sap.getObject(a);}if(b instanceof Function){var t=new b(p);}else{t=b;}t=jQuery.sap.newObject(t);_[d]=t;return _[d]};this.getCache=function(){return _;}};sap.suite.ui.smartbusiness.Adapter=new A();})();};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.association.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.association.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS_MODELER",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.authorization.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.authorization.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"EVALUATIONS",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.drilldown.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.drilldown.Configuration",{oServiceParams:{serviceList:[{name:"smart_business_runtime_services",masterCollection:"EVALUATIONS",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,mockedDataSource:"/ddaconfig/model/metadata.xml"}]},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["ID","IS_ACTIVE"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getDefaultEmptyMessageKey:function(){return this.oApplicationFacade.getResourceBundle().getText("MULTI_EMPTY_TEXT");}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.S3.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.S3.controller');sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.ui.core.format.NumberFormat');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.S3",{onInit:function(){this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");this.initializeTileHeader();this.defineHeaderFooterOptions();this.navigatingWithinDrilldown=true;this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog();},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison",HT:"HarveyBall"},headerNumberFormatter:function(s){return s?"12,345.67":"";},headerNumberUnitFormatter:function(s){return s?"EUR":"";},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles");},});},lauchConfigurator:function(){var r=null;var c=this.evaluationId+"/"+this.viewId;this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;if(this.DDA_MODEL.getConfigurator().getAllViews().length==0){r="configureChart";}else{r="configurator";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:r,context:c});},onRoutePatternMatched:function(E){var v=this.getView();var t=this;if(E.getParameter("name")==="detail"){t.errorState=undefined;t.errorMsg=undefined;try{if(this.oApplicationFacade.__refreshModel&&this.oApplicationFacade.__refreshModel===1){this.getView().getModel()&&this.getView().getModel().refresh();}this.isPasteEnabled=false;var a=E.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+a);this.evalContext=c;v.setBindingContext(c);if(!(this.oApplicationFacade.__refreshModel)&&c.getObject()&&(c.getObject()["VIEWS_COUNT"]===null)){this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:c.sPath.substr(1)});return;}this.oApplicationFacade.__refreshModel=undefined;try{this.evaluationId=v.getBindingContext().getObject()["ID"];}catch(e){try{this.evaluationId=a.match(/ID=[^,]+/g)[0].replace(/(ID=')|(')/g,"");}catch(e){this.evaluationId=a.replace(/EVALUATIONS_MODELER\('|'\)/g,"")}}var b=E.getParameter("arguments")["evaluationId"];if(b!==this.evaluationId){this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;var d=this.DDA_MODEL.getConfigurator().getDefaultViewId();if(this.DDA_MODEL.getConfigurator().getAllViews().length==0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:c.sPath.substr(1)});}if(d!=null){this.viewId=d;this.DDA_MODEL.setViewId(d);}else{this.viewId=n;}this.oApplicationFacade.configuratorViewId=this.DDA_MODEL.NEW_VIEWID;this.bindUiToModel();this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name);});this.ddaFilter.setDimensions(f);}else{this.bindUiToModel();if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=this.getView().getModel("SB_DDACONFIG").getData()["HEADERS"].length;this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;this._oTextsModel=this.getView().getModel("i18n");var o=this.getView().byId("vizViewSelector");o.bindProperty("selectedKey","SB_DDACONFIG>/ID");this.getView().byId("choroplethViewSelect").bindProperty("selectedKey","SB_DDACONFIG>/ID");this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();if(this.copyClipboard&&Object.keys(this.copyClipboard)&&Object.keys(this.copyClipboard).length){this.checkEvaluationForPaste();}else{if(this._oControlStore&&this._oControlStore.oButtonListHelper){this.updateHeaderFooterOptions(false);}}if(this.getPage().getFooter()){this.checkForCopy();}}catch(e){t.errorState=true;t.errorMsg=e.message;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{if(this.byId("choroplethViewSelect")&&this.byId("choroplethViewSelect").getSelectedItem()){this.byId("choroplethViewSelect").setTooltip(this.byId("choroplethViewSelect").getSelectedItem().getText());}if(this.byId("vizViewSelector")&&this.byId("vizViewSelector").getSelectedItem()){this.byId("vizViewSelector").setTooltip(this.byId("vizViewSelector").getSelectedItem().getText());}}}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:true,sI18NDetailTitle:"DRILLDOWN_CONFIG_DETAILS",oEditBtn:{sI18nBtnTxt:"CONFIGURE",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.lauchConfigurator()},bEnabled:false,},buttonList:[{sId:"Copy",sI18nBtnTxt:"COPY",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyEvaluationToClipboard();}},{sId:"Paste",sI18nBtnTxt:"PASTE",bDisabled:(!(t.isPasteEnabled)),onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyDDAConfiguration();}},{sId:"Delete",sI18nBtnTxt:"DELETE",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.onDeleteConfiguration();}}]};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},formatColorForMap:function(m,t){var s=this.dda_config.chartConfig.colorScheme.toUpperCase();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var d=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:d.DATA_MODE||"DUMMY",title:"",dataLimit:d.DATA_LIMIT||null,dataLimitations:d.DATA_LIMITATIONS||false,type:(d.CHART_TYPE).toUpperCase()||"BAR",axis:d.AXIS_TYPE||"SINGLE",value:d.VALUE_TYPE||"ABSOLUTE",colorScheme:d.COLOR_SCHEME||"NONE",thresholdMeasure:d.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<d.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:d.COLUMNS[i].NAME,type:d.COLUMNS[i].TYPE,visibility:d.COLUMNS[i].VISIBILITY||"BOTH",columns_order:d.COLUMNS[i].COLUMNS_ORDER,sortOrder:d.COLUMNS[i].SORT_ORDER||"NONE",sortBy:d.COLUMNS[i].SORT_BY||"",axis:d.COLUMNS[i].AXIS||1,stacking:d.COLUMNS[i].STACKING||0,color:d.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?d.COLUMNS[i].COLOR1:d.COLOR_SCHEME=="MANUAL_SEMANTIC"?d.COLUMNS[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;v.setVisible(false);a.setVisible(true);b.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var d=this.getView().getModel("SB_DDACONFIG").getData().COLUMNS;var e=d.length;var f=[];for(i=0;i<e;i++){if(d[i].TYPE=='MEASURE'){f.push(d[i]);}else if(d[i].TYPE=='DIMENSION'){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=d[i].NAME;}}this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=f[0].NAME;if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}jQuery.sap.require("sap.ui.vbm.AnalyticMap");b.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"600px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isisStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(s):s;};},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("vizChartContainer");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});}}}try{var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}c.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);});}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);}},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},onDeleteConfiguration:function(){var t=this;var s=t;this.confirmDialog=new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){t.busyIndicator.open()&&t.getView().setBusy(true);s.deleteMaster();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})});this.confirmDialog.open();},deleteMaster:function(){var t=this;var m=this.getView().getModel("SB_DDACONFIG").getData();this.busyIndicator.open()&&this.getView().setBusy(true);var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.confirmDialog.close();t.DDA_MODEL.removeAllViews();t.DDA_MODEL.setViewId("");t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:t.evalContext.sPath.substr(1)});t.getView().getModel().refresh();},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});},updateHeaderFooterOptions:function(p){this.isPasteEnabled=p;this.defineHeaderFooterOptions();this.setHeaderFooterOptions(this.getHeaderFooterOptions());},checkEvaluationForPaste:function(){var c=this.EVALUATION.evaluationData;var a=this.getView().getModel("SB_DDACONFIG").getData();if((this.copyClipboard.evaluationData.ID==c.ID)||this.checkEvaluationForPaste1()){this.updateHeaderFooterOptions(false);}else{this.updateHeaderFooterOptions(true);}},checkEvaluationForPaste1:function(){var b=this.copyClipboard.masterData;var d={};var f={};if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length==1){d[this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES[0]]="M";}else{d=this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.reduce(function(p,c,i,a){d=d||{};if(i==1){d[a[0]]="M";}d[a[i]]="M";return d;});}}if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length==1){f[this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS[0]]="D";}else{f=this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.reduce(function(p,c,i,a){f=f||{};if(i==1){f[a[0]]="D";}f[a[i]]="D";return f;});}}var g=null;this.diffHeaders=[];for(var i=0,l=b.FILTERS.length;i<l;i++){delete b.FILTERS[i].__metadata;if(f[b.FILTERS[i].DIMENSION]!="D"){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.FILTERS[i].DIMENSION]==undefined){g.DIMENSIONS[b.FILTERS[i].DIMENSION]=[];}b.FILTERS[i].entityType="FILTER";g.DIMENSIONS[b.FILTERS[i].DIMENSION].push(b.FILTERS[i]);}}for(var i=0,l=b.CHART.length;i<l;i++){delete b.CHART[i].__metadata;if(b.CHART[i].THRESHOLD_MEASURE){if(d[b.CHART[i].THRESHOLD_MEASURE]!="M"){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]==undefined){g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]=[];}b.CHART[i].entityType="THRESHOLD_MEASURE";g.MEASURES[b.CHART[i].THRESHOLD_MEASURE].push(b.CHART[i]);}}}for(var i=0,l=b.COLUMNS.length;i<l;i++){delete b.COLUMNS[i].__metadata;var h=null;var k=null;if(b.COLUMNS[i].TYPE=="MEASURE"){if((d[b.COLUMNS[i].NAME]!="M")){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.COLUMNS[i].NAME]==undefined){g.MEASURES[b.COLUMNS[i].NAME]=[];}b.COLUMNS[i].entityType="MEASURE";g.MEASURES[b.COLUMNS[i].NAME].push(b.COLUMNS[i]);}if((d[b.COLUMNS[i].SORT_BY]!="M")){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.COLUMNS[i].SORT_BY]==undefined){g.MEASURES[b.COLUMNS[i].SORT_BY]=[];}h=jQuery.extend(true,{},b.COLUMNS[i],{});h.entityType="SORT_BY";g.MEASURES[b.COLUMNS[i].SORT_BY].push(h);}}else if(b.COLUMNS[i].TYPE=="DIMENSION"){if((f[b.COLUMNS[i].NAME]!="D")){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.COLUMNS[i].NAME]==undefined){g.DIMENSIONS[b.COLUMNS[i].NAME]=[];}b.COLUMNS[i].entityType="DIMENSION";g.DIMENSIONS[b.COLUMNS[i].NAME].push(b.COLUMNS[i]);}if((f[b.COLUMNS[i].SORT_BY]!="D")){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.COLUMNS[i].SORT_BY]==undefined){g.DIMENSIONS[b.COLUMNS[i].SORT_BY]=[];}k=jQuery.extend(true,{},b.COLUMNS[i],{});k.entityType="SORT_BY";g.DIMENSIONS[b.COLUMNS[i].SORT_BY].push(k);}}}for(var i=0,l=b.HEADER.length;i<l;i++){if(b.HEADER[i].EVALUATION_ID!==b.HEADER[i].REFERENCE_EVALUATION_ID){this.diffHeaders.push(b.HEADER[i]);}else{if((b.HEADER[i].VISUALIZATION_TYPE!="NT")&&(b.HEADER[i].VISUALIZATION_TYPE!="AT")){if((b.HEADER[i].VISUALIZATION_TYPE==="CM")){var n=undefined;try{n=JSON.parse(JSON.parse(b.HEADER[i].CONFIGURATION).MEASURES);}catch(e){throw new Error("Failed to parse multiple measures of Comparison Chart Multiple Measures");}for(var j=0,m=n.length;i<m;i++){if(d[n[j]["name"]]!="M"){b.HEADER[i].entityType="HEADERS";if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[n[j]["name"]]==undefined){g.MEASURES[n[j]["name"]]=[];}g.MEASURES[n[j]["name"]].push(b.HEADER[i]);break;}}}else{if(f[b.HEADER[i].DIMENSION]!="D"){b.HEADER[i].entityType="HEADERS";if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.HEADER[i].DIMENSION]==undefined){g.DIMENSIONS[b.HEADER[i].DIMENSION]=[];}g.DIMENSIONS[b.HEADER[i].DIMENSION].push(b.HEADER[i]);}}}}}return g;},copyEvaluationToClipboard:function(){var t=this;var c=function(){t.copyClipboard={};t.copyClipboard.MasterData=t.getView().getModel("SB_DDACONFIG").getData();t.copyClipboard.masterData=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData;t.copyClipboard.evaluationData=t.EVALUATION.evaluationData;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("COPY_DDA_TO_CLIPBOARD",t.EVALUATION.evaluationData.TITLE||(t.EVALUATION.evaluationData.ID+"*")));t.oApplicationFacade.copyClipboard=t.copyClipboard;t.updateHeaderFooterOptions(false);};if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER.length){var d=[];for(var i=0,l=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER.length;i<l;i++){if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i].EVALUATION_ID!=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i].REFERENCE_EVALUATION_ID){d.push(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i]);}}if(d&&d.length){t.warnDialog=t.warnDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("RELATED_KPIS_HEADER_TILES_EXIST_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnDialog.close();c();}})});t.warnDialog.open();}else{c();}}else{c();}},copyDDAConfiguration:function(){var t=this;if(this.copyClipboard&&this.copyClipboard.evaluationData){var p={sourceEvaluationId:this.copyClipboard.evaluationData.ID,targetEvaluationId:this.EVALUATION.evaluationData.ID};var c=function(){sap.suite.ui.smartbusiness.lib.Util.utils.create(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("COPY_DDA_CONFIGURATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_SUCCESS"));t.getView().getModel().refresh();var e={getParameter:function(a){var b={name:"detail",arguments:{contextPath:"EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)"}};return b[a];}};t.onRoutePatternMatched(e);},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_ERROR"),e.responseText);});};if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER.length){this.warnOverwriteDialog=this.warnOverwriteDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DDA_CONFIG_EXISTING_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnOverwriteDialog.close();c();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){t.warnOverwriteDialog.close();}})});this.warnOverwriteDialog.open();}else{c();}}},checkForCopy:function(){if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER.length){this.setBtnEnabled("Copy",true);}else{this.setBtnEnabled("Copy",false);}},onAfterRendering:function(){this.checkForCopy();},createVizChart:function(d,m){var t=this;var v=this.getView().byId("vizChartContainer");v.removeAllContent();var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if((this.dda_config.chartConfig.type).toUpperCase()=="TABLE"){v.addContent(T);setTimeout(function(){v.rerender();},0);}else{var V=this.getVizTypeAndIcon();var a=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,}});this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var b=new sap.viz.ui5.controls.Popover();b.connect(o.getVizUid());this.setAllVizFormatters();this.applyColorToViz(o);a.setContent(o);v.addContent(a);v.addContent(T);}},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b={locale:function(){},format:function(d,p){var e=sap.ui.core.format.NumberFormat.getInstance();return e.format(d);}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(b);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=(this._oModel)["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if((this._oModel)["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},onVizViewChange:function(e){var k=e.getParameters().selectedItem.getProperty("key");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.bindUiToModel();this.refreshChart();e.getSource().setTooltip(e.getParameters().selectedItem.getText());},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator.controller')){jQuery.sap.declare('sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator.controller');sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.ui.vbm.AnalyticMap');jQuery.sap.require('sap.ui.core.format.NumberFormat');sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configurator",{onInit:function(){this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");try{if(sap.ui.core.Fragment.byId("addTileDialog","addTileDialog")){sap.ui.core.Fragment.byId("addTileDialog","addTileDialog").destroy();}if(sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList")){sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList").getParent().destroy();}if(sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog")){sap.ui.core.Fragment.byId("configureTileDialog","multipleMeasureDialog").destroy();}}catch(e){}this._addTileDialog=sap.ui.xmlfragment("addTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addTileDialog",this);this._addRelatedTilesDialog=sap.ui.xmlfragment("addRelatedTilesDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addRelatedTilesDialog",this);this._configureTileDialog=sap.ui.xmlfragment("configureTileDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.multipleMeasureDialog",this);this.initializeTileHeader();this.initializeAddTileDialog();this.initialiazeValueHelpDialog();this.defineHeaderFooterOptions();this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.viewsReordered=false;this.busyIndicator=new sap.m.BusyDialog();var h=this.byId("headerRibbon");this.HeaderRibbonModel=new sap.ui.model.json.JSONModel();h.setModel(this.HeaderRibbonModel);var s=this;if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}},leftArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject();}catch(e){s=null;}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i-1,0,a[0]);break;}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index-1);},rightArrowAction:function(){var t=this;var i,a;var h=t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;var v=t.byId("tileContainer").getAggregation("scrollContainer").getAggregation("content");try{var s=this._getSelectedTile().tile.getBindingContext("SB_DDACONFIG").getObject();}catch(e){s=null;}for(i=0;i<h.length;i++){if(h[i]==s){a=h.splice(i,1);h.splice(i+1,0,a[0]);break;}}t.getView().getModel("SB_DDACONFIG").setProperty("/HEADERS_VISIBLE",h);t.getView().getModel("SB_DDACONFIG").updateBindings();t._setSelectedTile(t._getSelectedTile().index+1);},selectedTilesFormatter:function(c,a){var b="";var t={NT:"Numeric",CT:"Comparison",AT:"Bullet",TT:"Trend"};a.forEach(function(s){if(s.REFERENCE_EVALUATION_ID==c&&s.visible)b+=t[s.VISUALIZATION_TYPE]+", ";});return b?"Selected: "+b.replace(/, $/g,""):"";},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},_cache:{},setApplicationCache:function(k,v){this._cache[k]=v;},getApplicationCache:function(k){return this._cache[k];},takeConfigSnapShot:function(){this._configSnapShot=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());},restoreFromConfigSnapShot:function(){this.getView().getModel("SB_DDACONFIG").setData(this._configSnapShot);},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addTileDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._addRelatedTilesDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._configureTileDialog,"SB_DDACONFIG");},onRoutePatternMatched:function(E){var t=this;if(E.getParameter("name")==="configurator"){try{t.errorState=undefined;t.errorMsg=undefined;var a=E.getParameter("arguments")["evaluationId"];var v=E.getParameter("arguments")["viewId"];if(t.oApplicationFacade.__newViewAdded&&t.oApplicationFacade.createdViewId){v=t.oApplicationFacade.createdViewId;t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+v);}t.oApplicationFacade.createdViewId=null;t.oApplicationFacade.__newViewAdded=false;t._setSelectedTile(-1);if(a!==this.evaluationId||t.viewsReordered){t.viewsReordered=false;this.evaluationId=a;this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;if(!v){v=this.DDA_MODEL.getConfigurator().getDefaultViewId();}this._oTextsModel=this.getView().getModel("i18n");this._addTileDialog.setModel(this._oTextsModel,"i18n");this._addRelatedTilesDialog.setModel(this._oTextsModel,"i18n");this._configureTileDialog.setModel(this._oTextsModel,"i18n");if(v!=null){this.viewId=v;this.DDA_MODEL.setViewId(v);}else{this.viewId=n;}this.bindUiToModel();this.initCopy=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name);});this.ddaFilter.setDimensions(f);try{this.ddaFilter.rerender();}catch(e){};}else{if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=function(){h=t.getView().getModel("SB_DDACONFIG").getData()["HEADERS"];var c=0;for(var i=0;i<h.length;++i){if(h[i]["visible"]==true)++c;}return c;}();this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;if(!this.init_filters){this.init_filters=[];this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].forEach(function(x){t.init_filters.push(x.name)});}var o=this.getView().byId("vizViewSelector");o.bindProperty("selectedKey","SB_DDACONFIG>/ID");this.getView().byId("choroplethViewSelect").bindProperty("selectedKey","SB_DDACONFIG>/ID");this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();this.displayAggregate();}catch(e){t.errorState=true;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{if(this.byId("choroplethViewSelect")&&this.byId("choroplethViewSelect").getSelectedItem()){this.byId("choroplethViewSelect").setTooltip(this.byId("choroplethViewSelect").getSelectedItem().getText());}if(this.byId("vizViewSelector")&&this.byId("vizViewSelector").getSelectedItem()){this.byId("vizViewSelector").setTooltip(this.byId("vizViewSelector").getSelectedItem().getText());}}}},changeViewOrder:function(){var t=this;new sap.suite.ui.smartbusiness.lib.ListPersona({view:this.getView(),context:'/ALL_VIEWS',listItemContext:'TITLE',namedModel:'SB_DDACONFIG',callback:function(){var c=t.DDA_MODEL.selectedView.getId();t.byId('vizViewSelector').setSelectedItem(t.byId('vizViewSelector').getItemByKey(c));t.byId('choroplethViewSelect').setSelectedItem(t.byId('choroplethViewSelect').getItemByKey(c));t.viewsReordered=true;}}).start();},SaveConfig:function(i){var s=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();m.CURRENT_FILTERS=this.getView().byId("ddaFilter").getActiveDimensions();var a=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");if(m.ALL_VIEWS.length>0){this.busyIndicator.open()&&this.getView().setBusy(true);a.saveEvalConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_SAVE_SUCCESS"));if(i==false){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:"EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)"});}s.oApplicationFacade.__refreshModel=1;try{if(sap.suite&&sap.suite.ui&&sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration){sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration(s.evaluationId);}}catch(e){}},function(e){jQuery.sap.log.error(e+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"));});}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR_NO_VIEW_CONFIGURED"));jQuery.sap.log.error("No Views Configured. Please configure Views before adding filters/headers");}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={onBack:function(){if(t.isModelChanged()){var s=t;new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";s.evaluationId=null;this.getParent().close();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{var c="EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)";t.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}},sI18NDetailTitle:"SB_GENERIC_DRILLDOWN",bSuppressBookmarkButton:true,buttonList:[{sI18nBtnTxt:"Save Configuration",onBtnPressed:function(e){jQuery.sap.log.info("Save button pressed");if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.SaveConfig(false);},},{sId:"Delete",sI18nBtnTxt:"Delete",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}new sap.m.Dialog({icon:"sap-icon://warning2",title:t._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("OK"),press:function(){this.getParent().close();t.busyIndicator.open()&&t.getView().setBusy(true);t.deleteMaster();}}),endButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}},{sId:"cancel",sI18nBtnTxt:"Cancel",onBtnPressed:function(e){var s=t;if(t.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";this.getParent().close();s.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{var c="EVALUATIONS_MODELER(ID='"+s.evaluationId+"',IS_ACTIVE=1)";s.evaluationId=null;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:c});}}},]};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},onBeforeRendering:function(){},navigateToConfigureChart:function(){var c=this.evaluationId+"/"+this.viewId;this.evaluationId=null;if(this.navigatingWithinDrilldown){this.oApplicationFacade.navigatingWithinDrilldown=true;}else{this.oApplicationFacade.navigatingWithinDrilldown=undefined;}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configureChart",context:c});},onAddView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();this.oApplicationFacade.configuratorViewId=this.viewId||this.DDA_MODEL.NEW_VIEWID;if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE_TO_SAVE_CONFIGURATION")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("SAVE_AND_CONTINUE"),press:function(){var i=true;s.warn_header=false;s.SaveConfig(i);s.viewId=s.DDA_MODEL.NEW_VIEWID;s.DDA_MODEL.setViewId(s.viewId);s.bindUiToModel();this.getParent().close();s.navigateToConfigureChart();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{this.oApplicationFacade.__contextViewId=this.viewId;this.viewId=this.DDA_MODEL.NEW_VIEWID;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this.navigateToConfigureChart();}},onEditView:function(){var s=this;var c=this.getView().byId("ddaFilter").getActiveDimensions();this.oApplicationFacade.configuratorViewId=this.viewId||this.DDA_MODEL.NEW_VIEWID;if(this.warn_header||String(this.init_filters)!=String(c)){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE_TO_SAVE_CONFIGURATION")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("SAVE_AND_CONTINUE"),press:function(){var i=true;s.warn_header=false;this.getParent().close();s.SaveConfig(i);s.navigateToConfigureChart();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{this.navigateToConfigureChart();}},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison"},_getSelectedTile:function(){var t=this.byId("tileContainer").getItems()||[];return{tile:t[this._selectedTileIndex],index:this._selectedTileIndex}},_setSelectedTile:function(i){this._selectedTileIndex=i;var t=this.byId("tileContainer").getItems()||[];for(j=0;j<t.length;j++){t[j].getTileControl().removeStyleClass("mySelectedStyle");}this.byId("deleteTile").setEnabled(i!=-1);if(i!=-1){t[i].getTileControl().addStyleClass("mySelectedStyle");}this.byId("leftMoveArrow").setEnabled((i!=-1)&&i!=0);this.byId("rightMoveArrow").setEnabled((i!=-1)&&i!=t.length-1);},deleteTile:function(){var t=this;var c=new sap.m.Dialog({title:"Delete",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DELETE_CONFIRMATION")})],beginButton:new sap.m.Button({text:"Ok",press:function(e){c.close();var a=t._getSelectedTile().tile;var v=a.getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE;v.splice(t._getSelectedTile().index,1);t._setSelectedTile(-1);t.refreshTileBindings();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){c.close();}})});c.open();},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles").attachBrowserEvent("click",function(e){var v=this.getParent().getAggregation("content");t._setSelectedTile(v.indexOf(this));});},});},initializeAddTileDialog:function(){var t=this;this._tileEvaluationList=sap.ui.core.Fragment.byId("addRelatedTilesDialog","evaluationTilesList");var a={NT:"NUMBER_TILE",AT:"ACTUAL_VS_TARGET_TILE",CT:"COMPARISON_TILE",TT:"TREND_TILE",CM:"COMPARISON_MM_TILE",HT:"HARVEY_BALL_TILE"};var b=new sap.ui.model.Sorter('SB_DDACONFIG>GROUPING_TITLE',false,function(C){return C.getProperty('GROUPING_TITLE');});var c=new sap.ui.model.Sorter('SB_DDACONFIG>VISUALIZATION_TYPE_INDEX',false);this._tileEvaluationList.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS",factory:function(i,B){var d=B.getProperty("VISUALIZATION_TYPE");var m=new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true});var f=new sap.m.HBox({width:"100%",justifyContent:"SpaceAround",items:[new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[d]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"TITLE",subheader:"SUBTITLE",contentOnly:true})]});var g=new sap.m.HBox({justifyContent:"Start",width:"98%",items:[m,new sap.m.Label({text:{path:"SB_DDACONFIG>VISUALIZATION_TYPE",formatter:function(s){return t._oTextsModel.getResourceBundle().getText(a[s]);}}})]});return new sap.m.CustomListItem({type:(d=='NT'||d=='AT')?'Active':'Navigation',press:function(){var o=this.getBindingContext('SB_DDACONFIG').getObject();var v=o.VISUALIZATION_TYPE;o['visible']=true;if(v=='NT'||v=='AT'){t.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(t._cloneObj(o));t.onAddTileOk();t.refreshTileBindings();}else{t._addRelatedTilesDialog.close();try{var h=v=='CM'?1:(v=="HT")?2:0;t._configureTileDialog.getContent()[h].getItems()[1].removeAllContent();t._configureTileDialog.getContent()[h].getItems()[1].addContent(f);}catch(e){}t._configureTileDialog.bindElement('SB_DDACONFIG>'+this.getBindingContextPath());t._configureTileDialog.open();var I=t.getView().getModel("i18n");var j=new sap.ui.core.Item({key:"_none^",text:I.getResourceBundle().getText("SELECT_NONE"),});if(!sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").getItemByKey("_none^"))sap.ui.core.Fragment.byId("configureTileDialog","measuresForTile3").insertItem(j,"0");}},content:[new sap.m.HBox({justifyContent:"SpaceAround",items:[g]})]});},sorter:[b,c]});},onMiniChartConfigureOk:function(){var b=this._configureTileDialog.getBindingContext("SB_DDACONFIG").getObject();b['visible']=true;this.getView().getModel("SB_DDACONFIG").getData().HEADERS_VISIBLE.push(this._cloneObj(b));this.onAddTileOk();this.refreshTileBindings();},showConfigureTileMeasure:function(v){return v=='CM';},showConfigureTileDimension:function(v){return v=='CT'||v=='TT';},showConfigureTileSortOrder:function(v){return v=='CT';},showThirdMeasure:function(v){return!!v;},showHarveyConfigurator:function(t){return t=="HT";},harveyTotalMeasureVisibility:function(t,i){return t=="HT"&&i;},harveyFilterVisibility:function(t,i){return t=="HT"&&i;},harveyFilterOptionVisibility:function(t,i,s){return t=="HT"&&i&&s;},betweenOperatorLabelVisibility:function(o){return o=="BT";},refreshTileBindings:function(){try{var t=this.byId("tileContainer");t.getModel("SB_DDACONFIG").refresh();}catch(e){}},_refreshEvaluationsBinding:function(){},onAddTileOk:function(E){this.takeConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close();}catch(e){}this._refreshEvaluationsBinding();this.warn_header=true;},onAddTileCancel:function(E){this.restoreFromConfigSnapShot();this._setSelectedTile(-1);this.refreshTileBindings();try{this._configureTileDialog.close();this._addRelatedTilesDialog.close();}catch(e){}this._refreshEvaluationsBinding();},_getEvalData:function(i){try{var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getEvaluationById({id:i,cache:true,filters:false,thresholds:false,getDDAEvaluation:true});return a;}catch(e){return{};}},createTileMenuForCurrentEvaluation:function(e){var t=this;var a=['NT','AT','CT','TT','CM'];var b=this._getEvalData(e);var m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var d=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var f=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensions(b.ODATA_URL,b.ODATA_ENTITYSET)||[];var c=this.getView().getModel("SB_DDACONFIG");if(!c.getProperty("/HEADER_EVALUATIONID")[e]){c.getProperty("/HEADER_EVALUATIONID")[e]=true;var h=c.getProperty("/HEADERS");for(var g in this.tileTypeMapping){h.push({EVALUATION_ID:this.evaluationId,CONFIGURATION_ID:this.viewId,REFERENCE_EVALUATION_ID:e,VISUALIZATION_TYPE:g,VISUALIZATION_TYPE_INDEX:a.indexOf(g),VISUALIZATION_ORDER:1,ALL_DIMENSIONS:d,DIMENSION:d[0]||'',SORT_BY:'',SORT_ORDER:'MD',MEASURE1:m[0],MEASURE2:m[1]||m[0],MEASURE3:m[2]||"",COLOR1:"Good",COLOR2:"Critical",COLOR3:"Error",DIMENSION_COLOR:"Neutral",HARVEY_FILTERS:[{NAME:f[0],OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}],HARVEY_TOTAL_MEASURE:m[0],FILTERABLE_DIMENSIONS:f,IS_HARVEY_FRACTION_KPIMEASURE:true,IS_HARVEYMEASURE_KPIMEASURE:false,ALL_MEASURES:m,VISIBILITY:1,visible:false,TITLE:b.INDICATOR_TITLE,SUBTITLE:b.TITLE,INDICATOR:b.INDICATOR});}}},openEvaluationsDialog:function(){this._addRelatedTilesDialog.open();sap.ui.core.Fragment.byId('addRelatedTilesDialog','showCurrentKpiEvals').firePress();},evaluationGroupTextFormatter:function(c){return{text:c.getProperty("GROUPING_TEXT"),key:c.getProperty("GROUPING_TEXT")};},relatedEvalGroupTextFormatter:function(c){var r=this.getView().getModel("i18n").getResourceBundle();return{text:(r.getText("KPI")+": "+c.getProperty("INDICATOR")),key:c.getProperty("INDICATOR")};},showCurrentKPIEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');var r=this.getView().getModel("i18n").getResourceBundle();if(!m.getProperty('/SIBLING_EVALUATIONS').length){var a=sap.suite.ui.smartbusiness.lib.Util.kpi.getSiblingEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:false,filters:false,thresholds:false,getDDAEvaluation:true});a.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID);});m.getData().SIBLING_EVALUATIONS=a;m.getData().HEADERS.forEach(function(s){var p=s.REFERENCE_EVALUATION_ID==s.EVALUATION_ID?'('+t._oTextsModel.getResourceBundle().getText('CURRENT_EVALUATION')+')':'';s.GROUPING_TITLE=p+s.TITLE+" "+s.SUBTITLE;});}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.EQ,c));m.refresh();},showAssociatedEvals:function(){var t=this;var m=this.getView().getModel('SB_DDACONFIG');if(!m.getProperty('/ASSOCIATED_EVALUATIONS').length){m.getData().ASSOCIATED_EVALUATIONS=sap.suite.ui.smartbusiness.lib.Util.kpi.getAssociatedEvaluations({indicator:m.getProperty('/INDICATOR'),id:this.evaluationId,cache:true});m.getData().ASSOCIATED_EVALUATIONS.forEach(function(s){t.createTileMenuForCurrentEvaluation(s.ID);});m.getData().HEADERS.forEach(function(s){s.GROUPING_TITLE=s.TITLE+" "+s.SUBTITLE;});}this.takeConfigSnapShot();var b=this._tileEvaluationList.getBinding("items");var c=this.getView().getModel("SB_DDACONFIG").getProperty("/INDICATOR");b.filter(new sap.ui.model.Filter("INDICATOR",sap.ui.model.FilterOperator.NE,c));m.refresh();},formatColorForMap:function(m,t){var s=this.dda_config.chartConfig.colorScheme.toUpperCase();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var d=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:d.DATA_MODE||"DUMMY",title:"",dataLimit:d.DATA_LIMIT||null,dataLimitations:d.DATA_LIMITATIONS||false,type:(d.CHART_TYPE).toUpperCase()||"BAR",axis:d.AXIS_TYPE||"SINGLE",value:d.VALUE_TYPE||"ABSOLUTE",colorScheme:d.COLOR_SCHEME||"NONE",thresholdMeasure:d.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<d.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:d.COLUMNS[i].NAME,type:d.COLUMNS[i].TYPE,visibility:d.COLUMNS[i].VISIBILITY||"BOTH",sortOrder:d.COLUMNS[i].SORT_ORDER||"NONE",sortBy:d.COLUMNS[i].SORT_BY||"",axis:d.COLUMNS[i].AXIS||1,stacking:d.COLUMNS[i].STACKING||0,color:d.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?d.COLUMNS[i].COLOR1:d.COLOR_SCHEME=="MANUAL_SEMANTIC"?d.COLUMNS[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;v.setVisible(false);a.setVisible(true);b.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var d=this.getView().getModel("SB_DDACONFIG").getData().COLUMNS;var e=d.length;var f=[];for(i=0;i<e;i++){if(d[i].TYPE=='MEASURE'){f.push(d[i]);}else if(d[i].TYPE=='DIMENSION'){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=d[i].NAME;}}this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=f[0].NAME;if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}b.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"550px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(s):s;};},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("vizChartContainer");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});}}}try{var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}c.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);});}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);}},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},onDeleteView:function(){var t=this;new sap.m.Dialog({icon:"sap-icon://warning2",title:t._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t._oTextsModel.getResourceBundle().getText("VIEW_WILL_BE_DELETED")})],beginButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("OK"),press:function(){t.warn_header=false;var a=t.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");if(a.ALL_VIEWS.length>0){t.busyIndicator.open()&&t.getView().setBusy(true);s.saveViewConfiguration(t.evaluationId,a,"delete",function(){jQuery.sap.log.info("view delete success");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("CHART_CONFIG_DELETE_SUCCESS"));for(var i=0,b;i<a.ALL_VIEWS.length;i++){if(a.ALL_VIEWS[i].ID==t.viewId){b=i;break;}}if(b||(b==0)){a.ALL_VIEWS.splice(b,1);}t.viewId=(a.ALL_VIEWS.length<=0?"":(a.ALL_VIEWS.length==(b)?a.ALL_VIEWS[0].ID:a.ALL_VIEWS[b].ID));t.DDA_MODEL.getConfigurator().removeViewById(a.ID);t.DDA_MODEL.setViewId(t.viewId);t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart();},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});}this.getParent().close();}}),endButton:new sap.m.Button({text:t._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();},enableDisableButton:function(a){if(a.length<1){return false;}else{return true;}},deleteMaster:function(){var t=this;this.warn_header=false;var m=this.getView().getModel("SB_DDACONFIG").getData();var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");this.busyIndicator.open()&&this.getView().setBusy(true);s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);t.DDA_MODEL.removeAllViews();sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.oRouter.navTo("detail",{"contextPath":"EVALUATIONS_MODELER(ID='"+self.evaluationId+"',IS_ACTIVE=1)"});t.evaluationId=null;t.oApplicationFacade.__refreshModel=1;},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});},fetchAndRenderHeaderRibbon:function(f){var s=this;var E=this.DDA_MODEL.EVALUATION_DATA;var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(E.ODATA_URL,E.ODATA_ENTITYSET);var M=p.getUnitPropertyMappingObject();var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:E.ODATA_URL,entitySet:E.ODATA_ENTITYSET,measure:E.COLUMN_NAME,filter:E.FILTERS["results"]});u.model.read(u.uri,null,null,true,function(d){if(d){s.HeaderRibbonModel.setData({data:d.results[0]});}else{jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri);}});var k=M[E.COLUMN_NAME];var i=this.getView().getModel("i18n");this.byId("aggregate_number").bindProperty("text","/data/"+E.COLUMN_NAME,function(v){if(v==""||v==null){v=i.getResourceBundle().getText("NO_DATA");}return v;});if(k){this.byId("aggregate_number_unit").bindProperty("text","/data/"+k,function(v){return v;});}},displayAggregate:function(){var i=this.getView().getModel("i18n");if(this.byId("enableAggregate").getSelected()===false){this.byId("enableAggregate").setText(i.getResourceBundle().getText("ENABLE_KPI_AGGREGATE"));this.byId("enableAggregate").invalidate();}else if(this.byId("enableAggregate").getSelected()===true){this.byId("enableAggregate").setText("");this.byId("aggregate_number").setText("12,345.67");this.byId("aggregate_number_unit").setText("EUR");}},isModelChanged:function(){this.currentCopy=this._cloneObj(this.getView().getModel("SB_DDACONFIG").getData());if(this.initCopy.CONFIG.SAP_AGGREGATE_VALUE!=this.currentCopy.CONFIG.SAP_AGGREGATE_VALUE){return true;}var c=this.getView().byId("ddaFilter").getActiveDimensions();if(c.length==this.initCopy.FILTERS.length){for(var i=0;i<c.length;i++){if(c[i]!=this.initCopy.FILTERS[i].name){return true;}}}else{return true;}if(this.initCopy.HEADERS_VISIBLE.length==this.currentCopy.HEADERS_VISIBLE.length){for(var i=0;i<this.initCopy.HEADERS_VISIBLE.length;i++){delete this.initCopy.HEADERS_VISIBLE[i].ALL_MEASURES;delete this.initCopy.HEADERS_VISIBLE[i].ALL_DIMENSIONS;delete this.currentCopy.HEADERS_VISIBLE[i].ALL_MEASURES;delete this.currentCopy.HEADERS_VISIBLE[i].ALL_DIMENSIONS;response=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:this.initCopy.HEADERS_VISIBLE[i],newPayload:this.currentCopy.HEADERS_VISIBLE[i]});if((response.updates&&response.updates.length)||(response.deletes&&response.deletes.length)){return true;}}}else{return true;}return false;},createVizChart:function(d,m){var t=this;var v=this.getView().byId("vizChartContainer");v.removeAllContent();var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if((this.dda_config.chartConfig.type).toUpperCase()=="TABLE"){v.addContent(T);setTimeout(function(){v.rerender();},0);}else{var V=this.getVizTypeAndIcon();var a=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,}});this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var b=new sap.viz.ui5.controls.Popover();b.connect(o.getVizUid());this.setAllVizFormatters();this.applyColorToViz(o);a.setContent(o);v.addContent(a);v.addContent(T);}},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b={locale:function(){},format:function(d,p){var e=sap.ui.core.format.NumberFormat.getInstance();return e.format(d);}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(b);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=(this._oModel)["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if((this._oModel)["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},onVizViewChange:function(e){var k=e.getParameters().selectedItem.getProperty("key");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this.bindUiToModel();this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.refreshChart();e.getSource().setTooltip(e.getParameters().selectedItem.getText());window.location.replace(window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/"+this.viewId);},initialiazeValueHelpDialog:function(){var t=this;this.filterValueHelpDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("SELECT_FILTERS"),multiSelect:true,items:{path:"/filterValues",template:new sap.m.StandardListItem({title:"{value}",selected:"{selected}"})},growingThreshold:999,confirm:function(e){var s=e.mParameters.selectedContexts;var v=[];s.forEach(function(c){v.push(c.getProperty("value"));});t.getView().getModel("SB_DDACONFIG").setProperty(this.ownerBindingPath+"/HARVEY_FILTERS/0/VALUE_1",v);},cancel:function(e){},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f,F],true);}});this.filterValueHelpDialog.setModel(new sap.ui.model.json.JSONModel({filterValues:[]}));return this.filterValueHelpDialog;},fetchFilterValuesForDimension:function(D,v,s,e){var t=this;var c;var m=this.getView().getModel("SB_DDACONFIG");var a=m.getProperty("/QUERY_SERVICE_URI");var V={};v.forEach(function(d){V[d]=true;});var b=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:a,entitySet:m.getProperty("/QUERY_ENTITY_SET"),filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS?this.DDA_MODEL.EVALUATION_DATA.FILTERS.results:[],dimension:D});if((c=this.getApplicationCache(a+"/"+b.uri))){s(c);}else{b.model.read(b.uri,null,null,false,function(f){var d=[];f.results.forEach(function(o){d.push({value:o[D],selected:!!V[o[D]]});});t.setApplicationCache(a+"/"+b.uri,d);s(d);},e);}},openFilterValueHelp:function(E){var t=this;var v=t.getView().getModel("SB_DDACONFIG");this.filterValueHelpDialog.open();this.filterValueHelpDialog.setBusy(true);this.filterValueHelpDialog.ownerBindingPath=E.getSource().getBindingContext("SB_DDACONFIG").getPath();var d=E.getSource().getBindingContext("SB_DDACONFIG").getProperty("HARVEY_FILTERS/0/NAME");var s=E.getSource().getBindingContext("SB_DDACONFIG").getProperty("HARVEY_FILTERS/0/VALUE_1");t.fetchFilterValuesForDimension(d,s,function fetchFilterValuesForDimensionCallBack(a){t.filterValueHelpDialog.getModel().setProperty("/filterValues",a);t.filterValueHelpDialog.setBusy(false);},function(e){t.filterValueHelpDialog.setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),e);});},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.evaluation.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.evaluation.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.evaluation.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,mockedDataSource:"",useBatch:false}]},getAppConfig:function(){return this.oAppConfig;},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.kpi.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.kpi.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.kpi.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,}]},getAppConfig:function(){return this.oAppConfig;},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.visualization.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.visualization.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"EVALUATIONS",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,refreshAfterChange:true,useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},getDefaultEmptyMessageKey:function(){return this.oApplicationFacade.getResourceBundle().getText("MULTI_EMPTY_TEXT");}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.workspace.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.designtime.workspace.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"INDICATORS_MODELER",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl(),isDefault:true,mockedDataSource:"",useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getDesigntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.drilldown.lib.AllLibrary')){jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.AllLibrary");jQuery.sap.require('sap.ca.ui.model.type.Date');};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.mpt.Configuration')){jQuery.sap.declare("sap.suite.ui.smartbusiness.mpt.Configuration");jQuery.sap.require('sap.ca.scfld.md.ConfigurationBase');jQuery.sap.require('sap.ca.scfld.md.app.Application');sap.ca.scfld.md.ConfigurationBase.extend("sap.suite.ui.smartbusiness.mpt.Configuration",{oServiceParams:{serviceList:[{name:"SMART_BUSINESS",masterCollection:"CHIPS_USER",serviceUrl:sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices").getRuntimeServiceUrl(),isDefault:true,refreshAfterChange:true,useBatch:false}]},getServiceList:function(){return this.getServiceParams().serviceList;},getMasterKeyAttributes:function(){return["Id"];},getExcludedQueryStringParameters:function(){return["sap-client","sap-language"];},getHanaSystem:function(){var h=hasher||window.hasher;var a=h.getHashAsArray();if(a&&a.length&&a[0]){var b=a[0].substr(a[0].indexOf("?")+1).split("&");for(var i=0,l=b.length;i<l;i++){if(b[i]&&(b[i].indexOf("sap-system")!=-1)){return b[i].split("=")[1];}}}return"";},getServiceParams:function(){var s=this.oServiceParams.serviceList[0].serviceUrl;if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.Adapter){s=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices").getRuntimeServiceUrl();this.oServiceParams.serviceList[0].serviceUrl=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices").addSystemToServiceUrl(s);}else if(sap.ushell&&sap.ushell.Container){this.oServiceParams.serviceList[0].serviceUrl=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(s,this.getHanaSystem());}return this.oServiceParams;},getDefaultEmptyMessageKey:function(){return this.oApplicationFacade.getResourceBundle().getText("MULTI_EMPTY_TEXT");}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.association.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.association.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.association.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.association","includes":["../../lib/formatters.js","../../lib/Util.js","../../Adapter.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0821","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0821_Edit_KPI_Relationships.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0821_Edit_KPI_Relationships/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.association.view",detailPageRoutes:{"associationCreate":{"pattern":"associationCreate/{contextPath}","view":"S4"},"associationEdit":{"pattern":"associationEdit/{contextPath}/{associationPath}","view":"S4"}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.association.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.authorization.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.authorization.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.authorization.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.authorization","includes":["../../lib/formatters.js","../../lib/Util.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0816","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0816_Manage_Authorizations.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0816_Manage_Authorizations/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.authorization.view",fullScreenPageRoutes:{"subDetail":{"pattern":"subDetail/{contextPath}","view":"S4",}}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.authorization.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.drilldown.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.drilldown.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.drilldown.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.1.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.drilldown","includes":["css/style.css","../../lib/Util.js","../../lib/DrilldownModel.js","../../lib/DrilldownWriteService.js","../../lib/ListPersona.js","../../Adapter.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0819","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0819_Edit_Drill_Down_Confs.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0819_Edit_DrillDown_Configs/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.drilldown.view",detailPageRoutes:{"noDataView":{pattern:"noDataView/{contextPath}",view:"emptyView",}},fullScreenPageRoutes:[{"pattern":"configureChart/{evaluationId}/{viewId}","view":"configureNewView","name":"configureChart"},{"pattern":"configurator/{evaluationId}/{viewId}","view":"configurator","name":"configurator"}]}),createContent:function(){var v={component:this};jQuery.sap.require("sap.ca.ui.utils.Lessifier");sap.ca.ui.utils.Lessifier.lessifyCSS("sap.suite.ui.smartbusiness.designtime.drilldown","css/borderStyle.css");sap.ca.ui.utils.Lessifier.lessifyCSS("sap.suite.ui.smartbusiness.designtime.drilldown","css/style.css");if(jQuery.browser.msie){if(jQuery.browser.fVersion=="9"){jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.designtime.drilldown/css")+"/ie9.css");}if(jQuery.browser.fVersion=="10"){jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("sap.suite.ui.smartbusiness.designtime.drilldown/css")+"/ie10.css");}}return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.drilldown.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.visualization.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.visualization.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.visualization.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.visualization","includes":["../../lib/Util.js","themes/visualization.css","../../lib/ModelerReadServices.js","../../Adapter.js"],"dependencies":{"libs":["sap.m","sap.suite.ui.commons"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0820","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0820_Edit_Tiles.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0820_Edit_Tiles/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.visualization.view",detailPageRoutes:{"noDataView":{pattern:"noDataView/{contextPath}",view:"emptyView",}},fullScreenPageRoutes:{"addTile":{"pattern":"addTile/{contextPath}","view":"S4",},"editTile":{"pattern":"editTile/{contextPath}/{chipContextPath}","view":"S4",},"addEvaluation":{"pattern":"addEvaluation","view":"addEvaluation"},"editEvaluation":{"pattern":"editEvaluation/{contextPath}","view":"addEvaluation"},"addTileModelS":{"pattern":"addTileModelS/{contextPath}","view":"AddTileModelS"},"editTileModelS":{"pattern":"editTileModelS/{contextPath}/{chipContextPath}","view":"AddTileModelS",},}}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.visualization.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};if(!jQuery.sap.isDeclared('sap.suite.ui.smartbusiness.designtime.workspace.Component')){jQuery.sap.declare("sap.suite.ui.smartbusiness.designtime.workspace.Component");jQuery.sap.require('sap.ca.scfld.md.ComponentBase');sap.ca.scfld.md.ComponentBase.extend("sap.suite.ui.smartbusiness.designtime.workspace.Component",{metadata:sap.ca.scfld.md.ComponentBase.createMetaData("MD",{"name":"Master Detail Sample","version":"1.0.0-SNAPSHOT","library":"sap.suite.ui.smartbusiness.designtime.workspace","includes":["../../lib/formatters.js","../../lib/Util.js","../../Adapter.js"],"dependencies":{"libs":["sap.m"],"components":[]},"config":{"resourceBundle":"i18n/i18n.properties","titleResource":"SHELL_TITLE","icon":"sap-icon://Fiori5/F0818","favIcon":"../../../../../../../resources/sap/ca/ui/themes/base/img/favicon/F0818_KPI_Workspace.ico","homeScreenIconPhone":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/57_iPhone_Desktop_Launch.png","homeScreenIconPhone@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/114_iPhone-Retina_Web_Clip.png","homeScreenIconTablet":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/72_iPad_Desktop_Launch.png","homeScreenIconTablet@2":"../../../../../../../resources/sap/ca/ui/themes/base/img/launchicon/F0818_KPI_Workspace/144_iPad_Retina_Web_Clip.png","startupImage320x460":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/320_x_460.png","startupImage640x920":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_920.png","startupImage640x1096":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/640_x_1096.png","startupImage768x1004":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/768_x_1004.png","startupImage748x1024":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/748_x_1024.png","startupImage1536x2008":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1536_x_2008.png","startupImage1496x2048":"../../../../../../../resources/sap/ca/ui/themes/base/img/splashscreen/1496_x_2048.png"},viewPath:"sap.suite.ui.smartbusiness.designtime.workspace.view",detailPageRoutes:{"evalDetail":{"pattern":"evalDetail/{contextPath}/{evalPath}","view":"S4"},"multiSelect":{"pattern":"multiSelect","view":"S3"},"detail":{"pattern":"detail/{contextPath}","view":"S3"}},}),createContent:function(){var v={component:this};return sap.ui.view({viewName:"sap.suite.ui.smartbusiness.designtime.workspace.Main",type:sap.ui.core.mvc.ViewType.XML,viewData:v});}});};
