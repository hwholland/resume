/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.tiles.AreaChart");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Generic");sap.suite.ui.smartbusiness.tiles.Generic.extend("sap.suite.ui.smartbusiness.tiles.AreaChart",{metadata:{properties:{kpiValueRequired:{type:"boolean",defaultValue:false},tileType:{type:"string",defaultValue:"TT"}}},renderer:{}});
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.init=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.init.apply(this);var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}});};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"});};this.setAggregation("_tile",new sap.suite.ui.commons.GenericTile({header:"{/header}",subheader:"{/subheader}",size:this.getSize(),frameType:this.getFrameType(),tileContent:new sap.suite.ui.commons.TileContent({unit:"{/unit}",size:this.getSize(),footer:"{/footerNum}",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}),press:jQuery.proxy(this.tilePressed,this)}));this.jsonModel=new sap.ui.model.json.JSONModel();this.setModel(this.jsonModel);};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.onBeforeRendering=function(){sap.suite.ui.smartbusiness.tiles.Generic.prototype.onBeforeRendering.apply(this);if(this.getContentOnly()){var b=function(n){return new sap.suite.ui.commons.MicroAreaChartItem({color:"Neutral",points:{path:"/"+n+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{day}",y:"{balance}"})}});};var a=function(n){return new sap.suite.ui.commons.MicroAreaChartLabel({label:"{/"+n+"/label}",color:"{/"+n+"/color}"});};this.setAggregation("_tile",new sap.suite.ui.commons.TileContent({unit:"",size:this.getSize(),footer:"",content:new sap.suite.ui.commons.MicroAreaChart({width:"{/width}",height:"{/height}",size:this.getSize(),target:b("target"),innerMinThreshold:b("innerMinThreshold"),innerMaxThreshold:b("innerMaxThreshold"),minThreshold:b("minThreshold"),maxThreshold:b("maxThreshold"),chart:b("chart"),minXValue:"{/minXValue}",maxXValue:"{/maxXValue}",minYValue:"{/minYValue}",maxYValue:"{/maxYValue}",firstXLabel:a("firstXLabel"),lastXLabel:a("lastXLabel"),firstYLabel:a("firstYLabel"),lastYLabel:a("lastYLabel"),minLabel:a("minLabel"),maxLabel:a("maxLabel"),})}));}};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.getEvalValueMeasureName=function(c,t,r){var e=c.VALUES.results;for(var i=0;i<e.length;i++){if(e[i].TYPE==t)if(r==="FIXED")return e[i].FIXED;else return e[i].COLUMN_NAME;}};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doProcess=function(){var t=this;this._fetchDataForAreaChartTile(function(m){var d={};if(true||t.isAssociatedKpi()){d.subheader=this.oConfig.TITLE;d.header=this.oConfig.INDICATOR_TITLE;}d=jQuery.extend({},d,m);t.jsonModel.setData(d);t.setDoneState();},this.logError);};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._fetchDataForAreaChartTile=function(s,e){var t=this;var p={};this.oConfig=this.EVALUATION_DATA;p.serviceUri=this._addSystemAliasToUri(this.oConfig.ODATA_URL,this.getSapSystem());p.entitySet=this.oConfig.ODATA_ENTITYSET;p.measure=this.oConfig.COLUMN_NAME;p.dimension=this.getDimension();if(!this.getDimension()){this.logError("Dimension is Missing : Can't Render Area Chart");return;}p.filter=this.getAllFilters();if(this.oConfig.VALUES_SOURCE=="MEASURE"){var f=t.oConfig.COLUMN_NAME;switch(t.oConfig.GOAL_TYPE){case"MI":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"MA":t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");break;case"RA":t.sWarningHigh=t.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=t.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=t.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=t.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=t.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=t.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");break;}var _=[t.sWarningHigh,t.sCriticalHigh,t.sTarget,t.sTrend,t.sWarningLow,t.sCriticalLow];_.forEach(function(c){if(c){f+=","+c;}},this);p.measure=f;}var a=sap.suite.ui.smartbusiness.lib.Util.odata.getUri(p);var U=this.UOM_PROPERTY_MAPPING[this.oConfig.COLUMN_NAME];var b="";this.areaChartODataRef=a.model.read(a.uri,null,null,true,function(d){if(d&&d.results&&d.results.length){if(U){b=d.results[0][U];}p.dimension=t.TEXT_PROPERTY_MAPPING[t.getDimension()];t.UOM=b;var m=t._processDataForAreaChart(d,t.oConfig.VALUES_SOURCE,p.dimension,t.oConfig.COLUMN_NAME);m.unit=b;s.call(t,m);}else{t.setNoData();}},function(c){if(c&&c.response){jQuery.sap.log.error(c.message+" : "+c.request.requestUri);}});};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype._processDataForAreaChart=function(d,t,c,m){var f=this;var g=f.oConfig.VALUES.results;var h=[];var j=[];var w=[];var l=[];var n=[];var o=[];var p=d.results.length;var s=f.oConfig.SCALING;var q=d.results[0][c];var r,u,v,y,z;var A=d.results[d.results.length-1][c];var B=Number(d.results[0][m]);var C=Number(d.results[d.results.length-1][m]);var D=f.oConfig.GOAL_TYPE;for(i in d.results){d.results[i][c]=Number(i);d.results[i][m]=Number(d.results[i][m]);f.sWarningHigh?d.results[i][f.sWarningHigh]=Number(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?d.results[i][f.sCriticalHigh]=Number(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?d.results[i][f.sCriticalLow]=Number(d.results[i][f.sCriticalLow]):"";f.sWarningLow?d.results[i][f.sWarningLow]=Number(d.results[i][f.sWarningLow]):"";f.sTarget?d.results[i][f.sTarget]=Number(d.results[i][f.sTarget]):"";f.sWarningHigh?w.push(d.results[i][f.sWarningHigh]):"";f.sCriticalHigh?l.push(d.results[i][f.sCriticalHigh]):"";f.sCriticalLow?n.push(d.results[i][f.sCriticalLow]):"";f.sWarningLow?o.push(d.results[i][f.sWarningLow]):"";h.push(d.results[i][c]);j.push(d.results[i][m]);}this.FINAL_MEASURE_VALUE=d.results[i][m];this.FINAL_DIMENSION_NAME=this.TEXT_PROPERTY_MAPPING[c]||c;this.FINAL_DIMENSION_VALUE=A;if(t=="MEASURE"){this.TARGET_VALUE=d.results[i][f.sTarget];this.CRITICAL_LOW_VALUE=d.results[i][f.sCriticalLow];this.WARNING_LOW_VALUE=d.results[i][f.sWarningLow];this.CRITICAL_HIGH_VALUE=d.results[i][f.sCriticalHigh];this.WARNING_HIGH_VALUE=d.results[i][f.sWarningHigh];}else{var E=function(e){var x={};for(var k in e){x[e[k].TYPE]=e[k].FIXED};return x;};var F=E(g);this.TARGET_VALUE=F.TA;this.CRITICAL_LOW_VALUE=F.CL;this.WARNING_LOW_VALUE=F.WL;this.CRITICAL_HIGH_VALUE=F.CH;this.WARNING_HIGH_VALUE=F.WH;}this.initTTPopup();try{q=f.formatOdataObjectToString(q);A=f.formatOdataObjectToString(A);}catch(e){f.logError(e);}var G=Math.min.apply(Math,j);var S="";var H=B;var I=this.isACurrencyMeasure(this.oConfig.COLUMN_NAME);var J=this.libFormat(H,I,this.UOM);var K=J.toString();var L=Math.max.apply(Math,j);H=C;sap.ui.getCore().byId("m1e1 title");var M=this.libFormat(H,I,this.UOM);var N=M.toString();try{var O=f.formatOdataObjectToString(Math.min.apply(Math,h));var P=f.formatOdataObjectToString(Math.max.apply(Math,h));}catch(e){f.logError(e);}if(t=="MEASURE"){(w.length!=0)?(f.firstwH=w[O])&&(f.lastwH=w[P]):"";(l.length!=0)?(f.firstcH=l[O])&&(f.lastcH=l[P]):"";(n.length!=0)?(f.firstcL=n[O])&&(f.lastcL=n[P]):"";(o.length!=0)?(f.firstwL=o[O])&&(f.lastwL=o[P]):"";}var Q={width:"100%",height:"100%",unit:f.unit||"",chart:{color:"Neutral",data:d.results},minXValue:O,maxXValue:P,minYValue:G,maxYValue:L,firstXLabel:{label:q+"",color:"Neutral"},lastXLabel:{label:A+"",color:"Neutral"},firstYLabel:{label:K+"",color:"Neutral"},lastYLabel:{label:N+"",color:"Neutral"},minLabel:{},maxLabel:{}};switch(D){case"MA":for(i in g){if(g[i].TYPE=="CL"){Q.minThreshold={color:"Error",};var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sCriticalLow:m;}else if(g[i].TYPE=="WL"){Q.maxThreshold={color:"Good"};var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sWarningLow:m;f.wl=Number(g[i].FIXED);}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}Q.innerMinThreshold={data:[]};Q.innerMaxThreshold={data:[]};if(t=="FIXED"){Q.firstYLabel.color=B<f.cl?"Error":((f.cl<=B)&&(B<=f.wl))?"Critical":(B>f.wl)?"Good":"Neutral";Q.lastYLabel.color=C<f.cl?"Error":((f.cl<=C)&&(C<=f.wl))?"Critical":(C>f.wl)?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL){Q.firstYLabel.color=B<f.firstcL?"Error":((f.firstcL<=B)&&(B<=f.firstwL))?"Critical":(B>f.firstwL)?"Good":"Neutral";Q.lastYLabel.color=C<f.lastcL?"Error":((f.lastcL<=C)&&(C<=f.lastwL))?"Critical":(C>f.lastwL)?"Good":"Neutral";}break;case"MI":for(i in g){if(g[i].TYPE=="CH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);Q.maxThreshold={color:"Error",};Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sCriticalHigh:m;}else if(g[i].TYPE=="WH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);Q.minThreshold={color:"Good",};Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sWarningHigh:m;}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}if(t=="FIXED"){Q.firstYLabel.color=B>f.ch?"Error":((f.wh<=B)&&(B<=f.ch))?"Critical":(B<f.wh)?"Good":"Neutral";Q.lastYLabel.color=C>f.ch?"Error":((f.wh<=C)&&(C<=f.ch))?"Critical":(C<f.wh)?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){Q.firstYLabel.color=B>f.firstcH?"Error":((f.firstwH<=B)&&(B<=f.firstcH))?"Critical":(B<f.firstwH)?"Good":"Neutral";Q.lastYLabel.color=C>f.lastcH?"Error":((f.lastwH<=C)&&(C<=f.lastcH))?"Critical":(C<f.lastwH)?"Good":"Neutral";}Q.innerMaxThreshold={data:[]};Q.innerMinThreshold={data:[]};break;case"RA":for(i in g){if(g[i].TYPE=="CH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.ch=Number(g[i].FIXED);Q.maxThreshold={color:"Error",};Q.maxThreshold.data=(t=="MEASURE")?d.results:[R];u=(t=="MEASURE")?f.sCriticalHigh:m;}else if(g[i].TYPE=="WH"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wh=Number(g[i].FIXED);Q.innerMaxThreshold={color:"Good",};Q.innerMaxThreshold.data=(t=="MEASURE")?d.results:[R];y=(t=="MEASURE")?f.sWarningHigh:m;}else if(g[i].TYPE=="WL"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.wl=Number(g[i].FIXED);Q.innerMinThreshold={color:"Good",};Q.innerMinThreshold.data=(t=="MEASURE")?d.results:[R];v=(t=="MEASURE")?f.sWarningLow:m;}else if(g[i].TYPE=="CL"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);f.cl=Number(g[i].FIXED);Q.minThreshold={color:"Error",};Q.minThreshold.data=(t=="MEASURE")?d.results:[R];r=(t=="MEASURE")?f.sCriticalLow:m;}else if(g[i].TYPE=="TA"){var R=new Object();R[c]="";R[m]=Number(g[i].FIXED);Q.target={color:"Neutral",};Q.target.data=(t=="MEASURE")?d.results:[R];z=(t=="MEASURE")?f.sTarget:m;}}if(t=="FIXED"){Q.firstYLabel.color=(B>f.ch||B<f.cl)?"Error":((f.wh<=B)&&(B<=f.ch))||((f.cl<=B)&&(B<=f.wl))?"Critical":((B>=f.wl)&&(B<=f.wh))?"Good":"Neutral";Q.lastYLabel.color=(C>f.ch||C<f.cl)?"Error":((f.wh<=C)&&(C<=f.ch))||((f.cl<=C)&&(C<=f.wl))?"Critical":((C>=f.wl)&&(C<=f.wh))?"Good":"Neutral";}else if(t=="MEASURE"&&f.firstwL&&f.lastwL&&f.firstcL&&f.lastcL&&f.firstwH&&f.lastwH&&f.firstcH&&f.lastcH){Q.firstYLabel.color=(B>f.firstcH||B<f.firstcL)?"Error":((f.firstwH<=B)&&(B<=f.firstcH))||((f.firstcL<=B)&&(B<=f.firstwL))?"Critical":((B>=f.firstwL)&&(B<=f.firstwH))?"Good":"Neutral";Q.lastYLabel.color=(C>f.lastcH||C<f.lastcL)?"Error":((f.lastwH<=C)&&(C<=f.lastcH))||((f.lastcL<=C)&&(C<=f.lastwL))?"Critical":((C>=f.lastwL)&&(C<=f.lastwH))?"Good":"Neutral";}break;}var T=function(k,a,b,t){return new sap.suite.ui.commons.MicroAreaChartItem({color:"{/"+k+"/color}",points:{path:"/"+k+"/data",template:new sap.suite.ui.commons.MicroAreaChartPoint({x:"{"+a+"}",y:"{"+b+"}"})}});};var U=null;if(this.getContentOnly()){U=f.getTileControl();}else{U=f.getTileControl().getTileContent()[0].getContent();}U.setTarget(T("target",c,z));U.setInnerMinThreshold(T("innerMinThreshold",c,v));U.setInnerMaxThreshold(T("innerMaxThreshold",c,y));U.setMinThreshold(T("minThreshold",c,r));U.setMaxThreshold(T("maxThreshold",c,u));U.setChart(T("chart",c,m));return Q;};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.doDummyProcess=function(){this.jsonModel.setData(this.getDummyDataForAreaChartTile());};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.showTTPopup=function(){this._TTpopOver.openBy(this);};
sap.suite.ui.smartbusiness.tiles.AreaChart.prototype.initTTPopup=function(){var s=this;var m=new sap.ui.model.json.JSONModel();var a={"THRESHOLDS":[]};var l=new sap.ui.core.Locale(sap.ui.getCore().getConfiguration().getLanguage());jQuery.sap.require("sap.ui.core.format.NumberFormat");this.VALUE_FORMATTER=sap.ui.core.format.NumberFormat.getFloatInstance({style:"standard"},l);var t=new sap.m.List({});t.bindItems("/THRESHOLDS",new sap.m.ObjectListItem({title:"{name}",number:"{value}",numberState:sap.ui.core.ValueState.None}));t.setModel(m);var b={};b.targetVal=this.TARGET_VALUE;b.critLowVal=this.CRITICAL_LOW_VALUE;b.warnLowVal=this.WARNING_LOW_VALUE;b.critHighVal=this.CRITICAL_HIGH_VALUE;b.warnHighVal=this.WARNING_HIGH_VALUE;if(this.evaluationApi.getScaling()==-2){this.FINAL_MEASURE_VALUE=(this.FINAL_MEASURE_VALUE*100)+" %";for(var e in b){if(b[e]){b[e]=(b[e]*100)+" %";}}}a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("ACTUAL"),value:this.VALUE_FORMATTER.format(this.FINAL_MEASURE_VALUE)});if(this.evaluationApi.isMaximizingKpi()){if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}else if(this.evaluationApi.isMinimizingKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});}else if(this.evaluationApi.isTargetKpi()){if(b.critHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.critHighVal)});if(b.warnHighVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_HIGH_LABEL"),value:this.VALUE_FORMATTER.format(b.warnHighVal)});if(b.targetVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("TARGET_LABEL"),value:this.VALUE_FORMATTER.format(b.targetVal)});if(b.warnLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("WARNING_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.warnLowVal)});if(b.critLowVal!=undefined)a.THRESHOLDS.push({name:this.getModel("i18n").getProperty("CRITICAL_LOW_LABEL"),value:this.VALUE_FORMATTER.format(b.critLowVal)});}m.setData(a);var c=new sap.m.Bar({contentMiddle:[new sap.m.Label({text:this.FINAL_DIMENSION_NAME&&this.FINAL_DIMENSION_VALUE?this.FINAL_DIMENSION_NAME+" ("+this.FINAL_DIMENSION_VALUE+")":this.getModel("i18n").getProperty("THRESHOLD_LABEL")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button({icon:"sap-icon://decline",width:"2.375rem",press:jQuery.proxy(function(){if(this._TTpopOver.isOpen()){this._TTpopOver.close();}},this)})]});this._TTpopOver=new sap.m.ResponsivePopover({modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"18rem",customHeader:c,content:[t]});var S=sap.ui.getCore().getUIArea(sap.ui.getCore().getStaticAreaRef());S.addContent(this._TTpopOver,true);};
