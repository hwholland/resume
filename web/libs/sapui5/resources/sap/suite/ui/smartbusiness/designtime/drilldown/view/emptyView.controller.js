/*
 * Copyright (C) 2009-2013 SAP AG or an SAP affiliate company. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.images.images");jQuery.sap.includeStyleSheet(jQuery.sap.getModulePath("/")+"/sap/ca/scfld/md/css/flower.css");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.emptyView",{onInit:function(){var i=this.byId("flower");this.errorState=false;if(i){i.setSrc(sap.ca.ui.images.images.Flower);}this.getView().addEventDelegate(this,this);this.getView().addEventDelegate({onBeforeShow:jQuery.proxy(function(e){if(e.data&&(e.data.viewTitle||e.data.languageKey||e.data.infoText)){this.setTitleAndMessage(e.data.viewTitle,e.data.languageKey,e.data.infoText);}},this)});var v=this.getView();var t=this;if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}this.oRouter.attachRouteMatched(function(E){if(E.getParameter("name")==="noDataView"){if(this.oApplicationFacade.copyClipboard){this.copyClipboard=this.oApplicationFacade.copyClipboard;}this.isPasteEnabled=false;var s=E.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+s);v.setBindingContext(c);this.context=c;try{this.evaluationId=v.getBindingContext().getObject()["ID"];}catch(e){try{this.evaluationId=s.match(/ID=[^,]+/g)[0].replace(/(ID=')|(')/g,"");}catch(e){this.evaluationId=s.replace(/EVALUATIONS_MODELER\('|'\)/g,"")}}var a=E.getParameter("arguments");this.setTitleAndMessage(a.viewTitle,a.languageKey);if(this.copyClipboard&&Object.keys(this.copyClipboard)&&Object.keys(this.copyClipboard).length){this.checkEvaluationForPaste();}else{if(this._oControlStore&&this._oControlStore.oButtonListHelper){this.updateHeaderFooterOptions(false);}}}},this);},lauchConfigurator:function(){this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));var c=this.evaluationId+"/"+this.DDA_MODEL.NEW_VIEWID;this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configureChart",context:c});},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:true,sI18NDetailTitle:"DRILLDOWN_CONFIG_DETAILS",oEditBtn:{sI18nBtnTxt:"CONFIGURE",onBtnPressed:function(e){t.lauchConfigurator()},bEnabled:false,},buttonList:[{sId:"Paste",sI18nBtnTxt:"PASTE",bDisabled:(!(t.isPasteEnabled)),onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyDDAConfiguration();}}]};return this.oHeaderFooterOptions;},setTitleAndMessage:function(v,l,i){var p=this.byId("sap.ca.scfld.md.view.empty");var t=this.oApplicationFacade.oApplicationImplementation.getResourceBundle().getText(v);if(!t||t===v){if(!i){t=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());}else{t=i;}};p.setTitle(t);var L=this.byId("emptyLabel");if(!i){var m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(l);if(!m||m===l){m=this.oApplicationFacade.oApplicationImplementation.getUiLibResourceBundle().getText(this.oApplicationFacade.oApplicationImplementation.oConfiguration.getDefaultEmptyMessageKey());};L.setText(m);}else{L.setText(i);}},updateHeaderFooterOptions:function(p){this.isPasteEnabled=p;this.setHeaderFooterOptions(this.getHeaderFooterOptions());},checkEvaluationForPaste:function(){var c=this.context.getObject();if((this.copyClipboard.evaluationData.ID==c.ID)||this.checkEvaluationForPaste1()){this.updateHeaderFooterOptions(false);}else{this.updateHeaderFooterOptions(true);}},checkEvaluationForPaste1:function(){var b=this.context.getObject();var d=this.copyClipboard.masterData;var f={};var g={};var h=sap.suite.ui.smartbusiness.lib.Util.odata.getAllDimensions(b.ODATA_URL,b.ODATA_ENTITYSET);var k=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(b.ODATA_URL,b.ODATA_ENTITYSET);if(k.length){if(k.length==1){f[k[0]]="M";}else{f=k.reduce(function(p,c,i,a){f=f||{};if(i==1){f[a[0]]="M";}f[a[i]]="M";return f;});}}if(h.length){if(h.length==1){g[h[0]]="D";}else{g=h.reduce(function(p,c,i,a){g=g||{};if(i==1){g[a[0]]="D";}g[a[i]]="D";return g;});}}var n=null;this.diffHeaders=[];for(var i=0,l=d.FILTERS.length;i<l;i++){delete d.FILTERS[i].__metadata;if(g[d.FILTERS[i].DIMENSION]!="D"){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.FILTERS[i].DIMENSION]==undefined){n.DIMENSIONS[d.FILTERS[i].DIMENSION]=[];}d.FILTERS[i].entityType="FILTER";n.DIMENSIONS[d.FILTERS[i].DIMENSION].push(d.FILTERS[i]);}}for(var i=0,l=d.CHART.length;i<l;i++){delete d.CHART[i].__metadata;if(d.CHART[i].THRESHOLD_MEASURE){if(f[d.CHART[i].THRESHOLD_MEASURE]!="M"){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.CHART[i].THRESHOLD_MEASURE]==undefined){n.MEASURES[d.CHART[i].THRESHOLD_MEASURE]=[];}d.CHART[i].entityType="THRESHOLD_MEASURE";n.MEASURES[d.CHART[i].THRESHOLD_MEASURE].push(d.CHART[i]);}}}for(var i=0,l=d.COLUMNS.length;i<l;i++){delete d.COLUMNS[i].__metadata;var o=null;var q=null;if(d.COLUMNS[i].TYPE=="MEASURE"){if((f[d.COLUMNS[i].NAME]!="M")){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.COLUMNS[i].NAME]==undefined){n.MEASURES[d.COLUMNS[i].NAME]=[];}d.COLUMNS[i].entityType="MEASURE";n.MEASURES[d.COLUMNS[i].NAME].push(d.COLUMNS[i]);}if((f[d.COLUMNS[i].SORT_BY]!="M")){if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[d.COLUMNS[i].SORT_BY]==undefined){n.MEASURES[d.COLUMNS[i].SORT_BY]=[];}o=jQuery.extend(true,{},d.COLUMNS[i],{});o.entityType="SORT_BY";n.MEASURES[d.COLUMNS[i].SORT_BY].push(o);}}else if(d.COLUMNS[i].TYPE=="DIMENSION"){if((g[d.COLUMNS[i].NAME]!="D")){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.COLUMNS[i].NAME]==undefined){n.DIMENSIONS[d.COLUMNS[i].NAME]=[];}d.COLUMNS[i].entityType="DIMENSION";n.DIMENSIONS[d.COLUMNS[i].NAME].push(d.COLUMNS[i]);}if((g[d.COLUMNS[i].SORT_BY]!="D")){if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.COLUMNS[i].SORT_BY]==undefined){n.DIMENSIONS[d.COLUMNS[i].SORT_BY]=[];}q=jQuery.extend(true,{},d.COLUMNS[i],{});q.entityType="SORT_BY";n.DIMENSIONS[d.COLUMNS[i].SORT_BY].push(q);}}}for(var i=0,l=d.HEADER.length;i<l;i++){if(d.HEADER[i].EVALUATION_ID!==d.HEADER[i].REFERENCE_EVALUATION_ID){this.diffHeaders.push(d.HEADER[i]);}else{if((d.HEADER[i].VISUALIZATION_TYPE!="NT")&&(d.HEADER[i].VISUALIZATION_TYPE!="AT")){if((d.HEADER[i].VISUALIZATION_TYPE==="CM")){var r=undefined;try{r=JSON.parse(JSON.parse(d.HEADER[i].CONFIGURATION).MEASURES);}catch(e){throw new Error("Failed to parse multiple measures of Comparison Chart Multiple Measures");}for(var j=0,m=r.length;i<m;i++){if(f[r[j]["name"]]!="M"){d.HEADER[i].entityType="HEADERS";if(n==null){n={};}if(n.MEASURES==undefined){n.MEASURES={};}if(n.MEASURES[r[j]["name"]]==undefined){n.MEASURES[r[j]["name"]]=[];}n.MEASURES[r[j]["name"]].push(d.HEADER[i]);break;}}}else{if(g[d.HEADER[i].DIMENSION]!="D"){d.HEADER[i].entityType="HEADERS";if(n==null){n={};}if(n.DIMENSIONS==undefined){n.DIMENSIONS={};}if(n.DIMENSIONS[d.HEADER[i].DIMENSION]==undefined){n.DIMENSIONS[d.HEADER[i].DIMENSION]=[];}n.DIMENSIONS[d.HEADER[i].DIMENSION].push(d.HEADER[i]);}}}}}return n;},copyDDAConfiguration:function(){var t=this;if(this.copyClipboard&&this.copyClipboard.evaluationData){var p={sourceEvaluationId:this.copyClipboard.evaluationData.ID,targetEvaluationId:t.evaluationId};var c=function(){sap.suite.ui.smartbusiness.lib.Util.utils.create(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("COPY_DDA_CONFIGURATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_SUCCESS"));t.oApplicationFacade.__refreshModel=1;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"detail",context:"EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)"});},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_ERROR"),e.responseText);});};c();}},onAfterRendering:function(){}});
