/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.hana.ModelerServicesAdapter");
sap.suite.ui.smartbusiness.adapter.hana.ModelerServicesAdapter=function(){var t=this;this.cache=this.cache||{};function g(c){var a=[];for(var i=0,l=(c?c.length:0);i<l;i++){if(c[i].tileType!="HT"){a.push(c[i]);}}return a;}function b(e){var a={"INDICATORS":{"indicator":{"entity":"INDICATORS","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"INDICATORS_MODELER":{"indicator":{"entity":"INDICATORS_MODELER","type":"INDICATOR"},"texts":{"entity":"TEXTS","type":"INDICATOR_TEXT"},"evaluations":{"entity":"EVALUATIONS","type":"EVALUATION"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"associations":{"entity":"ASSOCIATIONS","type":"ASSOCIATION"},"association_source":{"entity":"ASSOCIATION_SOURCE","type":"ASSOCIATION"},"association_target":{"entity":"ASSOCIATION_TARGET","type":"ASSOCIATION"}},"EVALUATIONS":{"evaluation":{"entity":"EVALUATIONS","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"}},"EVALUATIONS_MODELER":{"evaluation":{"entity":"EVALUATIONS_MODELER","type":"EVALUATION"},"texts":{"entity":"TEXTS","type":"EVALUATION_TEXT"},"chips":{"entity":"CHIPS","type":"CHIP"},"tags":{"entity":"TAGS","type":"TAG"},"properties":{"entity":"PROPERTIES","type":"PROPERTY"},"indicator":{"entity":"INDICATOR_INFO","type":"INDICATOR"},"filters":{"entity":"FILTERS","type":"FILTER"},"values":{"entity":"VALUES","type":"VALUE"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"},"dda_header_tiles":{"entity":"DDA_HEADER_TILES","type":"DDA_HEADER"},"texts_for_chip":{"entity":"TEXTS_FOR_CHIP","type":"EVALUATION_TEXT"}},"CHIPS":{"texts":{"entity":"TEXTS","type":"CHIP_TEXT"},"evaluation":{"entity":"EVALUATION_INFO","type":"EVALUATION"},"dda_configurations":{"entity":"DDA_CONFIGURATIONS","type":"DDA_MASTER"}}};return a[e];};function f(e){return beans={"INDICATOR":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","TYPE":"TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","EVALUATION_COUNT":"EVALUATION_COUNT","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","ASSOCIATION_SOURCE_COUNT":"ASSOCIATION_SOURCE_COUNT","ASSOCIATION_TARGET_COUNT":"ASSOCIATION_TARGET_COUNT"}},"EVALUATION":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT","DECIMAL_PRECISION":"DECIMAL_PRECISION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION","INDICATOR":"INDICATOR","SCALING":"SCALING","ODATA_URL":"ODATA_URL","ODATA_ENTITYSET":"ODATA_ENTITYSET","VIEW_NAME":"VIEW_NAME","COLUMN_NAME":"COLUMN_NAME","OWNER_NAME":"OWNER_NAME","OWNER_E_MAIL":"OWNER_E_MAIL","OWNER_ID":"OWNER_ID","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","ENTITY_TYPE":"ENTITY_TYPE","ODATA_PROPERTY":"ODATA_PROPERTY","SEMANTIC_OBJECT":"SEMANTIC_OBJECT","ACTION":"ACTION","VALUES_SOURCE":"VALUES_SOURCE","INDICATOR_TYPE":"INDICATOR_TYPE","DATA_SPECIFICATION":"DATA_SPECIFICATION","GOAL_TYPE":"GOAL_TYPE","MANUAL_ENTRY":"MANUAL_ENTRY","LAST_WORKED_ON":"LAST_WORKED_ON","CHIPS_COUNT":"CHIPS_COUNT","INDICATOR_TITLE":"INDICATOR_TITLE","VIEWS_COUNT":"VIEWS_COUNT","DECIMAL_PRECISION":"DECIMAL_PRECISION"}},"CHIP":{"bean":{"id":"id","isActive":"isActive","evaluationId":"evaluationId","catalogId":"catalogId","tileType":"tileType","COUNTER":"COUNTER","createdBy":"createdBy","changedBy":"changedBy","createdOn":"createdOn","changedOn":"changedOn"},"reverseBean":{"id":"id","isActive":"isActive","evaluationId":"evaluationId","catalogId":"catalogId","tileType":"tileType","COUNTER":"COUNTER","createdBy":"createdBy","changedBy":"changedBy","createdOn":"createdOn","changedOn":"changedOn"}},"ASSOCIATION":{"bean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"},"reverseBean":{"NAMESPACE":"NAMESPACE","TYPE":"TYPE","SOURCE_INDICATOR":"SOURCE_INDICATOR","TARGET_INDICATOR":"TARGET_INDICATOR","IS_ACTIVE":"IS_ACTIVE","COUNTER":"COUNTER","CREATED_BY":"CREATED_BY","CREATED_ON":"CREATED_ON","CHANGED_BY":"CHANGED_BY","CHANGED_ON":"CHANGED_ON","SOURCE_INDICATOR_TITLE":"SOURCE_INDICATOR_TITLE","TARGET_INDICATOR_TITLE":"TARGET_INDICATOR_TITLE"}},"TAG":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","TAG":"TAG"}},"PROPERTY":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE":"VALUE"}},"FILTER":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","NAME":"NAME","VALUE_1":"VALUE_1","OPERATOR":"OPERATOR","VALUE_2":"VALUE_2"}},"VALUE":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","TYPE":"TYPE","FIXED":"FIXED","COLUMN_NAME":"COLUMN_NAME","ODATA_PROPERTY":"ODATA_PROPERTY"}},"DDA_MASTER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","CONFIG_ORDER":"CONFIG_ORDER","TEXT":"TEXT","IS_ACTIVE":"IS_ACTIVE"}},"DDA_HEADER":{"bean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"},"reverseBean":{"EVALUATION_ID":"EVALUATION_ID","CONFIGURATION_ID":"CONFIGURATION_ID","REFERENCE_EVALUATION_ID":"REFERENCE_EVALUATION_ID","VISUALIZATION_TYPE":"VISUALIZATION_TYPE","VISUALIZATION_ORDER":"VISUALIZATION_ORDER","VISIBILITY":"VISIBILITY","DIMENSION":"DIMENSION","IS_ACTIVE":"IS_ACTIVE","CONFIGURATION":"CONFIGURATION"}},"LANGUAGE":{"bean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"},"reverseBean":{"SPRAS":"SPRAS","LAISO":"LAISO","SPTXT":"SPTXT"}},"INDICATOR_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"EVALUATION_TEXT":{"bean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"},"reverseBean":{"ID":"ID","IS_ACTIVE":"IS_ACTIVE","LANGUAGE":"LANGUAGE","TITLE":"TITLE","DESCRIPTION":"DESCRIPTION"}},"CHIP_TEXT":{"bean":{"id":"id","isActive":"isActive","language":"language","catalogId":"catalogId","title":"title","description":"description"},"reverseBean":{"id":"id","isActive":"isActive","language":"language","catalogId":"catalogId","title":"title","description":"description"}}};};this.formBean=function(d,e,a){var c={};var p=[];var s={};var v={};var w=false;if(a){c=beans[e].bean;}else{c=beans[e].reverseBean;}if(d instanceof Array){w=true;}else{d=[d];}for(var i=0,l=d.length;i<l;i++){s={};v=d[i];for(var x in c){if(c.hasOwnProperty(x)){if(v[x]!==undefined&&v[x]!==null){s[c[x]]=v[x];}}}p.push(s);}if(!w){p=p[0];}return p;};function h(){t.cache.designtimeModel=t.cache.designtimeModel||new sap.ui.model.odata.ODataModel(t.getDesigntimeServiceUrl(),true);return t.cache.designtimeModel;};function j(){t.cache.runtimeModel=t.cache.runtimeModel||new sap.ui.model.odata.ODataModel(t.getRuntimeServiceUrl(),true);return t.cache.runtimeModel;};function k(){return"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";};this.getDesigntimeServiceUrl=function(){jQuery.sap.log.info("Hana Adapter --> Designtime Service URI");return"/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";};this.getRuntimeServiceUrl=function(){jQuery.sap.log.info("Hana Adapter --> Runtime Service URI");return"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";};function _(a){return jQuery.sap.encodeURL(a);};this.getSessionUser=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Session User");var c=null;var e=a.success;var i=a.error;var l=function(d){if(d instanceof Array){if(d&&d.length&&d[0]){c=d[0].LOGON_USER;}}else{c=d.LOGON_USER;}t.cache.sessionUser=c;jQuery.sap.log.info("Hana Adapter --> Current Session User - "+t.cache.sessionUser);if(e){e(c);}};var p=function(d,s,x){if(i){i(d,s,x);}};if(t.cache.sessionUser){c=t.cache.sessionUser;jQuery.sap.log.info("Hana Adapter --> Current Session User From Cache - "+t.cache.sessionUser);e(c);}else{this.getDataByEntity({entity:"SESSION_USER",async:(a.async||false),success:l,error:p,model:a.model});}return t.cache.sessionUser;};this.getSystemInfo=function(a){jQuery.sap.log.info("Hana Adapter --> Fetching System Info");var s=a.success;t.cache.env=1;jQuery.sap.log.info("Hana Adapter --> System Environment - "+((t.cache.env)?"SAP HANA":"Non-SAP"));s(1);return t.cache.env;};this.getAllLanguages=function(e){var l=undefined;var v=e.success;var w=e.error;var y=function(d){d=(d.results)?d.results:d;if(d.length){if(d.length==1){var S={LAISO:{},SPRAS:{}};S.LAISO[d[0]["LAISO"]]=d[0]["SPRAS"];S.SPRAS[d[0]["SPRAS"]]=d[0]["LAISO"];}else{S=d.reduce(function(p,c,i,a){S=S||{};S.LAISO=S.LAISO||{};S.SPRAS=S.SPRAS||{};if(i==1){S.LAISO[a[0]["LAISO"]]=a[0]["SPRAS"];S.SPRAS[a[0]["SPRAS"]]=a[0]["LAISO"];}S.LAISO[a[i]["LAISO"]]=a[i]["SPRAS"];S.SPRAS[a[i]["SPRAS"]]=a[i]["LAISO"];return S;});}var s=d;t.cache.SAP_LANGUAGES=S;t.cache.SAP_LANGUAGE_ARRAY=s;t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();l=S.LAISO[t.cache.localeIsoLanguage];t.cache.localLanguage=l;t.cache.localeSapLanguage=l;jQuery.sap.log.info("Hana Adapter --> Logon Language - "+t.cache.localeIsoLanguage+" - "+t.cache.localeSapLanguage);}if(v){v(S,s,l);}};var z=function(d,s,x){if(w){w(d,s,x);}};if(t.cache.SAP_LANGUAGE_ARRAY&&t.cache.SAP_LANGUAGES){t.cache.localeIsoLanguage=sap.ui.getCore().getConfiguration().getLocale().getLanguage().split("-")[0].toUpperCase();t.cache.localLanguage=t.cache.SAP_LANGUAGES.LAISO[t.cache.localeIsoLanguage];t.cache.localeSapLanguage=t.cache.localLanguage;jQuery.sap.log.info("Hana Adapter --> Picking All Languages from cache");jQuery.sap.log.info("Hana Adapter --> Logon Language - "+t.cache.localeIsoLanguage+" - "+t.cache.localeSapLanguage);if(v){v(t.cache.SAP_LANGUAGES,t.cache.SAP_LANGUAGE_ARRAY,t.cache.localLanguage);}}else{jQuery.sap.log.info("Hana Adapter --> Calling All Languages");this.getDataByEntity({entity:"LANGUAGE",async:(e.async||false),success:y,error:z,model:e.model});}};this.getKPIById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling KPI Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Indicator Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/INDICATORS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noIndicator)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.INDICATOR=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("INDICATOR");}}if(a.tags){x.push(v.createBatchOperation(c+"/TAGS","GET"));y.push("TAGS");}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.evaluations){x.push(v.createBatchOperation(c+"/EVALUATIONS","GET"));y.push("EVALUATIONS");}if(a.associations&&a.associationProperties){x.push(v.createBatchOperation("/ASSOCIATIONS_MODELER?$filter="+_("SOURCE_INDICATOR eq '"+a.ID+"' or TARGET_INDICATOR eq '"+a.ID+"'")+"&$expand=PROPERTIES","GET"));y.push("ASSOCIATIONS");}else if(a.associations){x.push(v.createBatchOperation(c+"/ASSOCIATION_SOURCE","GET"));x.push(v.createBatchOperation(c+"/ASSOCIATION_TARGET","GET"));y.push("ASSOCIATION_SOURCE");y.push("ASSOCIATION_TARGET");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(z){if(e){e(z);}throw new Error("Failed to fetch Indicator details");},a.async);if(a.associations&&a.associationProperties){for(var i=0,l=w.ASSOCIATIONS.length;i<l;i++){if(w.ASSOCIATIONS[i].PROPERTIES){if(w.ASSOCIATIONS[i].PROPERTIES.results&&w.ASSOCIATIONS[i].PROPERTIES.results.length){w.ASSOCIATIONS[i].PROPERTIES=w.ASSOCIATIONS[i].PROPERTIES.results;}else{w.ASSOCIATIONS[i].PROPERTIES=[];}}else{w.ASSOCIATIONS[i].PROPERTIES=[];}}}else{w.ASSOCIATIONS=[].concat(w.ASSOCIATION_SOURCE).concat(w.ASSOCIATION_TARGET);}return w;};this.getEvaluationById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Evaluation Data");var t=this;if(!(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined)&&!(a.context)){throw new Error("Failed to get Evaluation Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.ID=a.context.getObject().ID;a.IS_ACTIVE=a.context.getObject().IS_ACTIVE;}else{a.ID=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.IS_ACTIVE=((c.indexOf("IS_ACTIVE=0")!=-1)||(c.indexOf("IS_ACTIVE=1")!=-1))?((c.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;}}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){a.entity=a.entity||"/EVALUATIONS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(ID='"+a.ID+"',IS_ACTIVE="+a.IS_ACTIVE+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noEvaluation)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.EVALUATION=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("EVALUATION");}}if(a.tags){x.push(v.createBatchOperation(c+"/TAGS","GET"));y.push("TAGS");}if(a.indicator_tags){x.push(v.createBatchOperation(c+"/INDICATOR_TAGS","GET"));y.push("INDICATOR_TAGS");}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.texts_for_chip){x.push(v.createBatchOperation(c+"/TEXTS_FOR_CHIP","GET"));y.push("TEXTS_FOR_CHIP");}if(a.filters){x.push(v.createBatchOperation(c+"/FILTERS","GET"));y.push("FILTERS");}if(a.values){x.push(v.createBatchOperation(c+"/VALUES","GET"));y.push("VALUES");}if(a.chips){x.push(v.createBatchOperation(c+"/CHIPS","GET"));y.push("CHIPS");}if(a.dda_configurations){x.push(v.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));y.push("DDA_CONFIGURATIONS");}if(a.dda_header_tiles){x.push(v.createBatchOperation(c+"/DDA_HEADER_TILES","GET"));y.push("DDA_HEADER_TILES");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(w.CHIPS){w.CHIPS=g(w.CHIPS);}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Evaluation details");},a.async);return w;};this.getAssociationById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Association Data");var t=this;var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;}else if(a.ID&&a.IS_ACTIVE!==null&&a.IS_ACTIVE!==undefined){}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noAssociation)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.ASSOCIATION=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("ASSOCIATION");}}if(a.properties){x.push(v.createBatchOperation(c+"/PROPERTIES","GET"));y.push("PROPERTIES");}if(a.source){x.push(v.createBatchOperation(c+"/SOURCE_INDICATOR_INFO","GET"));y.push("SOURCE_INDICATOR_INFO");}if(a.target){x.push(v.createBatchOperation(c+"/TARGET_INDICATOR_INFO","GET"));y.push("TARGET_INDICATOR_INFO");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Association details");},a.async);return w;};this.getChipById=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Chip Data");var t=this;if(!(a.id&&a.isActive!==null&&a.isActive!==undefined)&&!(a.context)){throw new Error("Failed to get Chip Id or Status for data fetch");return null;}var c=null;var d=a.context||null;var p=k();var v=a.model||new sap.ui.model.odata.ODataModel(p,true);var w={};if(a.context){c=a.context.sPath;if(a.context.getObject()){a.id=a.context.getObject().id;a.isActive=a.context.getObject().isActive;}else{a.id=c.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');a.isActive=((c.indexOf("isActive=0")!=-1)||(c.indexOf("isActive=1")!=-1))?((c.indexOf("isActive=0")!=-1)?0:1):null;}}else if(a.id&&a.isActive!==null&&a.isActive!==undefined){a.entity=a.entity||"/CHIPS_MODELER";a.entity=(a.entity.indexOf("/")!=0)?("/"+a.entity):a.entity;c=a.entity+"(id='"+a.id+"',isActive="+a.isActive+")";d=new sap.ui.model.Context(v,c);}var s=a.success;var e=a.error;var x=[];var y=[];if(!(a.noChip)){if(d&&d.getObject()&&Object.keys(d.getObject())&&Object.keys(d)){w.CHIP=d.getObject();}else{x.push(v.createBatchOperation(c,"GET"));y.push("CHIP");}}if(a.evaluation){x.push(v.createBatchOperation(c+"/EVALUATION_INFO","GET"));y.push("EVALUATION_INFO");}if(a.texts){x.push(v.createBatchOperation(c+"/TEXTS","GET"));y.push("TEXTS");}if(a.dda_configurations){x.push(v.createBatchOperation(c+"/DDA_CONFIGURATIONS","GET"));y.push("DDA_CONFIGURATIONS");}a.async=(a.async)?true:false;v.addBatchReadOperations(x);v.submitBatch(function(z,B){var A=z.__batchResponses;for(var i=0,l=A.length;i<l;i++){jQuery.sap.log.info(y[i]+" : "+JSON.stringify(A[i]));w[y[i]]=(A[i].data.results)?A[i].data.results:A[i].data;}if(s){s(w);}},function(i){if(e){e(i);}throw new Error("Failed to fetch Chip details");},a.async);return w;};this.getChipByEvaluation=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Chips for Evaluation");a.async=false;a.chips=true;if(a.success){var s=a.success;s(this.getEvaluationById(a));return null;}else{return this.getEvaluationById(a);}};this.getDataByEntity=function(a){jQuery.sap.log.info("Hana Adapter --> Calling Entity Data");var t=this;var c=a.uri;var e=a.model||(c?new sap.ui.model.odata.ODataModel(c,true):h());var p="";var v=[];var w="";var y="";var z="";var A=a.top||null;var B=a.skip||null;var C=null;var D=a.success;var E=a.error;if(!(a.entity)){jQuery.sap.log.error("Entity or Context is missing for getDataByEntity call");throw Error("Entity or Context is missing for getDataByEntity call");}jQuery.sap.log.info("Hana Adapter --> Calling Entity Data - "+a.entity);entity=a.entity;entity=(entity.indexOf("/")==0)?entity:("/"+entity);if(a.select){if(typeof(a.select)=="string"){y=a.select;}else{y=a.select;}}if(a.expand){if(a.expand instanceof Array){for(var i=0,l=a.expand.length;i<l;i++){p+=(p)?",":"";p+=a.expand[i];}v=a.expand;}else if(typeof(a.expand)=="string"){p=a.expand;v=a.expand.split(",");}}if(a.filter){if(typeof(a.filter)=="string"){w=a.filter;}else{w=a.filter;}}if(a.orderby){if(typeof(a.orderby)=="string"){z=a.orderby;}else{z=a.orderby;}}a.async=(a.async)?true:false;if(entity.indexOf("$select")==-1){if(y){entity+=(entity.indexOf("?")==-1)?("?$select="+y):("&$select="+y);}}if(entity.indexOf("$expand")==-1){if(p){entity+=(entity.indexOf("?")==-1)?("?$expand="+p):("&$expand="+p);}}if(entity.indexOf("$filter")==-1){if(w){entity+=(entity.indexOf("?")==-1)?("?$filter="+w):("&$filter="+w);}}if(entity.indexOf("$orderby")==-1){if(z){entity+=(entity.indexOf("?")==-1)?("?$orderby="+z):("&$orderby="+z);}}if(entity.indexOf("$top")==-1){if(Number(A)){entity+=(entity.indexOf("?")==-1)?("?$top="+Number(A)):("&$top="+Number(A));}}if(entity.indexOf("$skip")==-1){if(Number(B)){entity+=(entity.indexOf("?")==-1)?("?$skip="+Number(B)):("&$skip="+Number(B));}}var F=function(d,s,x){C=(d&&d.results)?d.results:d;if(D){D(C);}};var G=function(d,s,x){jQuery.sap.log.error(d);jQuery.sap.log.error(s);jQuery.sap.log.error(x);if(E){C={d:d,s:s,x:x};E(d,s,x);}};e.read(entity,null,null,a.async,F,G);return C;};this.getDataByBatch=function(){jQuery.sap.log.info("Hana Adapter --> Calling Entity Batch Data");};this.populateRelevantEntitySet=function(c,e,p){jQuery.sap.log.info("Hana Adapter --> Calling for Relevant Entity Sets");var t=p;var v=e.ODATA_URL.substr(0,e.ODATA_URL.lastIndexOf("/"));v=v.replace(/\//g,'.').replace(".","");var w=e.ODATA_URL.substr(e.ODATA_URL.lastIndexOf("/")+1);w=w.split(".")[0];var y="/ODATA_FOR_ENTITY(P_PACKAGE='"+e.VIEW_NAME.split("/")[0]+"',P_OBJECT='"+e.VIEW_NAME.split("/")[1]+"')/Results";var z="PACKAGE eq '"+v+"' and OBJECT eq '"+w+"'";var A=function(d){if(d&&d.length){var s=d[0].CDATA_STR;c.open();if(s){var x=s.split("\n");for(var i=0,l=x.length;i<l;i++){if(x[i].indexOf("//")!=-1){x[i]=x[i].substr(0,x[i].indexOf("//"));}}s=x.join("\n");while(s.indexOf("/*")!=-1){var C=s.indexOf("/*");var D=s.indexOf("*/");D=(D==-1)?s.length:(D+2);s=s.substr(0,C)+s.substr(D);}}var E=[];var M=new sap.ui.model.json.JSONModel();var a=s.split(e.VIEW_NAME.split("/")[0]+'::'+e.VIEW_NAME.split("/")[1]);if(a.length==1){a=s.split(e.VIEW_NAME.split("/")[0]+'/'+e.VIEW_NAME.split("/")[1]);}if(a.length==1){sap.m.MessageToast.show("OData Document not compatible");M=t.populateEntitySet(t.getView().byId("odataServiceInput").getValue());c.setModel(M);return;}for(var i=1,l=a.length;i<l;i++){var F={};F.entityName=a[i].split('"')[2];E.push(F);}M.setData({entitySet:E});c.setModel(M);return;}};var B=function(d,s,x){};this.getDataByEntity({entity:y,filter:z,async:false,success:A,error:B,model:t.oDataModel});};this.getAllViews=function(a){jQuery.sap.log.info("Hana Adapter --> Calling for All Views");return this.getDataByEntity({entity:"HANA_VIEWS",async:(a.async||false),model:a.model});};this.getPlatform=function(){jQuery.sap.log.info("Hana Adapter --> Fetching Platform");t.cache.platform=t.cache.platform||"hana";jQuery.sap.log.info("Hana Adapter --> Platform - "+t.cache.platform);return t.cache.platform;};this.create=function(e,p,a,c,i,l,v){jQuery.sap.log.info("Hana Adapter --> Calling Create Service");var w=q(e);var t=this;l=l?true:false;n().done(function(d,s,x){jQuery.ajax({type:"POST",async:l,url:o(w,v),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage()},success:c,error:i});});};this.update=function(e,p,a,c,i,l,v,w,y){jQuery.sap.log.info("Hana Adapter --> Calling Update Service");var z=q(e);var t=this;w=w?true:false;n().done(function(d,s,x){jQuery.ajax({type:"PUT",async:w,url:o(z,y),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage(),"If-None-Match":(v||"")},success:c,error:i});});};this.remove=function(e,p,a,c,i,l,v,w){jQuery.sap.log.info("Hana Adapter --> Calling Delete Service");var y=q(e);var t=this;v=v?true:false;n().done(function(d,s,x){jQuery.ajax({type:"DELETE",async:v,url:o(y,w),data:encodeURIComponent(JSON.stringify(m(p))),headers:{"X-CSRF-Token":x.getResponseHeader("X-CSRF-Token"),"Accept-Language":sap.suite.ui.smartbusiness.lib.Util.utils.getLocaleLanguage(),"If-None-Match":(i||"")},success:a,error:c});});};function m(p){var x;if(p instanceof Array){x=[];for(var i=0,l=p.length;i<l;i++){obj=p[i];if(!(obj.keys)&&!(obj.payload)){x.push(obj);}else{obj.keys=obj.keys||{};obj.payload=obj.payload||{};x.push(jQuery.extend(true,obj.keys,obj.payload,{}));}}}else if(p instanceof Object){x={};obj=p;if(!(obj.keys)&&!(obj.payload)){x=obj;}else{obj.keys=obj.keys||{};obj.payload=obj.payload||{};x=jQuery.extend(true,obj.keys,obj.payload,{});}}else{x=p;}return x;};function n(){var a="/sap/hba/r/sb/core/logic/__token.xsjs";a=t.addSystemToServiceUrl(a);return jQuery.ajax({type:"HEAD",async:false,dataType:"json",url:a,headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){},error:function(){}});};this.addSystemToServiceUrl=function(a,s){jQuery.sap.log.info("Hana Adapter --> Add System to Service Url");if(sap.ushell&&sap.ushell.Container){if(s){a=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(a,s);}else{a=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(a);}}return a;};this.getHanaSystem=function(){var a=hasher||window.hasher;var c=a.getHashAsArray();if(c&&c.length&&c[0]){var d=c[0].substr(c[0].indexOf("?")+1).split("&");for(var i=0,l=d.length;i<l;i++){if(d[i]&&(d[i].indexOf("sap-system")!=-1)){return d[i].split("=")[1];}}}return"";};function o(a,c){var d=a.split("?");if(d.length>2){throw new Error("Url not formed properly");}d[0]=t.addSystemToServiceUrl(d[0]);a=d[0];if(d.length==2){a+="?"+d[1];}if(c&&Object.keys(c)&&Object.keys(c).length){a=a+"?"+jQuery.param(c);}return a;};function q(e){var C={INDICATOR:"/sap/hba/r/sb/core/logic/indicators.xsjs",EVALUATION:"/sap/hba/r/sb/core/logic/evaluations.xsjs",CHIP:"/sap/hba/r/sb/core/logic/chips.xsjs",ACTIVATE_INDICATOR:"/sap/hba/r/sb/core/logic/activateIndicator.xsjs",ACTIVATE_EVALUATION:"/sap/hba/r/sb/core/logic/activateEvaluation.xsjs",INDICATOR_FAVOURITE:"/sap/hba/r/sb/core/logic/favouriteIndicator.xsjs",EVALUATION_FAVOURITE:"/sap/hba/r/sb/core/logic/favouriteEvaluation.xsjs",ASSOCIATION:"/sap/hba/r/sb/core/logic/associations_cud.xsjs",ACTIVATE_ASSOCIATION:"/sap/hba/r/sb/core/logic/activateAssociation.xsjs",ACTIVATE_CHIP:"/sap/hba/r/sb/core/logic/activateChip.xsjs",AUTHORIZATION:"/sap/hba/r/sb/core/logic/authorization.xsjs",COPY_DDA_CONFIGURATION:"/sap/hba/r/sb/core/logic/copyDrilldownConfiguration.xsjs",DUPLICATE_ENTITY:"/sap/hba/r/sb/core/logic/deepCopy.xsjs",CHIP_USER:"/sap/hba/r/sb/core/logic/addToCatalog.xsjs"};return C[e];};function r(p,c,s,e){t.create("CHIP",p,null,s,e);};function u(p,c,s,e){t.update("CHIP",p,null,s,e);};this.removeTile=function(p,c,s,e){this.remove("CHIP",{id:p.id,isActive:p.isActive},s,e);};this.publishChip=function(p,a,c,s,e){var d=true;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;var l=[];var v=[];if(c.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<c.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var w={};w.title=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;w.description=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;w.id=p.id;w.language=c.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;w.isActive=0;l.push(w);}}if(a=="create"){v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:l}});r(v,c,s,e);}else{if(c.currentContextState){v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:l}});r(v,c,s,e);}else{var x=[];for(var i=0;i<c.initialData.ADDITIONAL_LANGUAGE_ARRAY.length;i++){var y={};y.id=p.id;y.language=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].language;y.isActive=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].isActive;y.description=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].description;y.title=c.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].title;x.push(y);}var z=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:x,newPayload:l,objectType:"CHIP_TEXTS"});var A={remove:[],create:[]};if(z){if(z.deletes.length){for(var i=0;i<z.deletes.length;i++){A.remove.push(z.deletes[i]);}}if(z.updates.length){for(var i=0;i<z.updates.length;i++){A.create.push(z.updates[i]);}}}v.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:{update:p},TEXTS:A}});u(v,c,s,e);}}};this.isTokenHandlingEnabledForODataRead=function(){return false;};};
