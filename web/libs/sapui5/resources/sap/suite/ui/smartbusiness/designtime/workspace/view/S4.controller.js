/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/workspace/view/workspaceStyling.css");sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.DrilldownConfiguration");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.workspace.view.S4",{onInit:function(){var t=this;this.errorMessages=[];this.errorModel=new sap.ui.model.json.JSONModel();this.errorModel.setData(this.errorMessages);this.errorState=false;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.oApplicationFacade.evaluationDetails=[];this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");if(this.metadataRef.getPlatform()==sap.suite.ui.smartbusiness.Configuration.Constants.Platform.ABAP){this.isPlatformABAP=true;}else{this.isPlatformABAP=false;}this.initializeDrillDownViewPopover();this._addColumnsToTable();this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="evalDetail"){t.byId("tilePanel").setExpanded(false);t.byId("drilldownPanel").setExpanded(false);var c=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));var a=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.context=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").contextPath));t.evalContext=new sap.ui.model.Context(v.getModel(),'/'+(e.getParameter("arguments").evalPath));t.evalPath=e.getParameter("arguments").evalPath;t.contextPath=e.getParameter("arguments").contextPath;var m=new sap.ui.model.json.JSONModel();var b=null;if(!(t.oApplicationFacade.evaluationData)||!(t.oApplicationFacade.evaluationIndex)){var d=t.metadataRef.getKPIById({context:t.context,evaluations:true,noIndicator:true,model:t.oApplicationFacade.getODataModel()});t.oApplicationFacade.evaluationData=d.EVALUATIONS;var f=t.evalPath.split("(")[1].split(",")[0].split("=")[1].replace(/'/g,'');var g=((t.evalPath.indexOf("IS_ACTIVE=0")!=-1)||(t.evalPath.indexOf("IS_ACTIVE=1")!=-1))?((t.evalPath.indexOf("IS_ACTIVE=0")!=-1)?0:1):null;for(var i=0,l=d.EVALUATIONS.length;i<l;i++){if(d.EVALUATIONS[i].ID==f&&d.EVALUATIONS[i].IS_ACTIVE==g){t.oApplicationFacade.evaluationIndex=i;break;}}}if(t.oApplicationFacade.evaluationDetails&&t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex]){b=t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex];}else{b=t.metadataRef.getEvaluationById({context:t.evalContext,tags:true,properties:true,filters:true,values:true,noEvaluation:true,texts:true,texts_for_chips:true,model:t.oApplicationFacade.getODataModel()});b.EVALUATION=t.oApplicationFacade.evaluationData[t.oApplicationFacade.evaluationIndex];b.FILTERS_IP=t.formObjectForInputParametersAndFilters({results:b.FILTERS}).EVALUATION_FILTERS;b.VALUES_OBJ=t.formObjectForTrendThreshold(b.EVALUATION,b.VALUES);t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex]=b;}b.CHIPS=[];b.DRILLDOWN={ISLOADED:false};m.setData(b);t.getView().setModel(m,"evaluation");t.modelRef=m;t.hideShow(m.getData().EVALUATION.GOAL_TYPE);}},this);},formObjectForTrendThreshold:function(e,a){var o={TA:null,TC:null,RE:null,CL:null,CH:null,WL:null,WH:null};for(var i=0,l=a.length;i<l;i++){if((e.VALUES_SOURCE=="FIXED")||(!(e.VALUES_SOURCE))){o[a[i]["TYPE"]]=a[i]["FIXED"];}else if(e.VALUES_SOURCE=="MEASURE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"];}else if(e.VALUES_SOURCE=="RELATIVE"){if(a[i]["TYPE"]=="TA"||a[i]["TYPE"]=="TC"||a[i]["TYPE"]=="RE"){o[a[i]["TYPE"]]=a[i]["COLUMN_NAME"];}else{o[a[i]["TYPE"]]=a[i]["FIXED"]+"%";}}}if(e){o.GOAL_TYPE=e.GOAL_TYPE;}else{o.GOAL_TYPE=null;}o.VALUES_SOURCE=e.VALUES_SOURCE||"FIXED";return o;},formObjectForInputParametersAndFilters:function(l){var o={EVALUATION_FILTERS:[]},f=0,a=0;var b={};var c=[];var d=[];var i,j,v='',t={};var e,g;var h=new Array(l.results.length);for(i=0;i<l.results.length;i++){h[i]=0;}for(i=0;i<l.results.length;i++){f=0;v='';e=(l.results&&l.results.length)?l.results[i].NAME:"";g=(l.results&&l.results.length)?l.results[i].OPERATOR:"";for(j=i;j<l.results.length;j++){if(l.results[j].NAME==e&&l.results[j].OPERATOR==g&&g!="BT"){t={};v+=l.results[j].VALUE_1+",";t={"ID":l.results[j].ID,"IS_ACTIVE":l.results[j].IS_ACTIVE,"NAME":l.results[j].NAME,"OPERATOR":l.results[j].OPERATOR,"TYPE":l.results[j].TYPE,"VALUES":v,"VALUE_2":null};h[j]=1;}else if(l.results[j].NAME==e&&l.results[j].OPERATOR==g&&g=="BT"){t={};t={"ID":l.results[j].ID,"IS_ACTIVE":l.results[j].IS_ACTIVE,"NAME":l.results[j].NAME,"OPERATOR":l.results[j].OPERATOR,"TYPE":l.results[j].TYPE,"VALUES":l.results[j].VALUE_1,"VALUE_2":l.results[j].VALUE_2};h[j]=1;}else{if(f==0&&h[j]==0){i=j-1;h[j]=1;f=1;}}}if(t.VALUES){if(t.OPERATOR!="BT"){t.VALUES=t.VALUES.substring(0,t.VALUES.length-1);}o.EVALUATION_FILTERS.push(t);}}try{var k=this.oApplicationFacade.evaluationData[this.oApplicationFacade.evaluationIndex];var m=k.ODATA_ENTITYSET;var n=this._appendSystemAlias(k.ODATA_URL);this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(n),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(m);var p=this.queryResultObj.getParameterization();var q=[];var r=p.getAllParameters();var s={};for(var u in r){var w=r[u].getName();var x=r[u].getProperty().type;var y=r[u].isOptional();if(w==="P_SAPClient"||w==="V_SAPClient"||w==="SAPClient"){s={name:w}}else{var z={name:w};q.push(z);}}if(s){q.push(s);}for(i=0;i<o.EVALUATION_FILTERS.length;i++){if(o.EVALUATION_FILTERS[i].TYPE=="PA"){b[o.EVALUATION_FILTERS[i].NAME]=o.EVALUATION_FILTERS[i];}else{d.push(o.EVALUATION_FILTERS[i]);}}for(i=0;i<q.length;i++){c.push(b[q[i].name]);}}catch(A){for(i=0;i<o.EVALUATION_FILTERS.length;i++){if(o.EVALUATION_FILTERS[i].TYPE=="PA"){c.push(o.EVALUATION_FILTERS[i]);}else{d.push(o.EVALUATION_FILTERS[i]);}}}o.EVALUATION_FILTERS=c;o.EVALUATION_FILTERS=o.EVALUATION_FILTERS.concat(d);return o;},_appendSystemAlias:function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s);}}return u;},formatOwnerName:function(o){var t=this;if(o==null||o==""){return"";}else{return sap.suite.ui.smartbusiness.lib.formatters.getBundleText(undefined,"OWNER",o);}},formatGoalType:function(g){var t=this;var a=null;switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("MAXIMIZING");break;case'MI':a=t.oApplicationFacade.getResourceBundle().getText("MINIMIZING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("RANGE");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdCriticalHigh:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_HIGH");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdWarningHigh:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MI':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_HIGH");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdWarningLow:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("WARNING_LOW");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatThresholdCriticalLow:function(g){var t=this;var a=null;g=g||'RA';switch(g){case'MA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL");break;case'RA':a=t.oApplicationFacade.getResourceBundle().getText("CRITICAL_LOW");break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatProperties:function(n,v){return((this.getView().byId("properties").getItems().length>1)?(', '+n+' : '+v):(n+' : '+v));},formatOperator:function(o){var t=this;var a=null;switch(o){case'EQ':a=t.oApplicationFacade.getResourceBundle().getText("EQUAL_TO");break;case'GT':a=t.oApplicationFacade.getResourceBundle().getText("GREATER_THAN");break;case'LT':a=t.oApplicationFacade.getResourceBundle().getText("LESS_THAN");break;case'NE':a=t.oApplicationFacade.getResourceBundle().getText("NOT_EQUAL_TO");break;case'BT':a=t.oApplicationFacade.getResourceBundle().getText("BETWEEN");break;case undefined:a=null;break;default:a=t.oApplicationFacade.getResourceBundle().getText("NONE");}return a;},formatTypeOfFilter:function(i){var t=this;var p=null;switch(i){case'FI':p=t.oApplicationFacade.getResourceBundle().getText("FILTER");break;case'PA':p=t.oApplicationFacade.getResourceBundle().getText("INPUT_PARAMETER");break;case undefined:operatorTypeText=null;break;default:p=t.oApplicationFacade.getResourceBundle().getText("NONE");}return p;},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){var h=window.location.hash.replace("evalDetail","detail");sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true);},oUpDownOptions:{sI18NDetailTitle:"ITEM_DETAIL_HEADER",iPosition:0,iCount:0,fSetPosition:function(n){t.oApplicationFacade.evaluationIndex=n;var a="EVALUATIONS_MODELER(ID='"+t.oApplicationFacade.evaluationData[n].ID+"',IS_ACTIVE="+t.oApplicationFacade.evaluationData[n].IS_ACTIVE+")";var v=t.getView();t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationData.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.getHeaderFooterOptions();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"SBWorkspace",route:"evalDetail",context:(t.contextPath+"/"+a)});}},buttonList:t.getAllFooterButtons()};t.oHeaderFooterOptions.oUpDownOptions.iPosition=t.oApplicationFacade.evaluationIndex;t.oHeaderFooterOptions.oUpDownOptions.iCount=t.oApplicationFacade.evaluationData.length;t.setHeaderFooterOptions(t.oHeaderFooterOptions);t.updateFooterButtons(t.oApplicationFacade.evaluationData[t.oApplicationFacade.evaluationIndex]);return this.oHeaderFooterOptions;},formatEvalStatus:function(s,c){var t=this;var i="";if(c>1){i=(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE")+","+t.oApplicationFacade.getResourceBundle().getText("STATUS_DRAFT"));}else if(s){i=t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE");}else{i=t.oApplicationFacade.getResourceBundle().getText("STATUS_NEW");}return i;},hideShow:function(g){var t=this;if(g=="MA"){t.byId("CHlabel").setVisible(false);t.byId("CHinput").setVisible(false);t.byId("WHlabel").setVisible(false);t.byId("WHinput").setVisible(false);t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);}else if(g=="MI"){t.byId("WLlabel").setVisible(false);t.byId("WLinput").setVisible(false);t.byId("CLlabel").setVisible(false);t.byId("CLinput").setVisible(false);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true);}else{t.byId("WLlabel").setVisible(true);t.byId("WLinput").setVisible(true);t.byId("CLlabel").setVisible(true);t.byId("CLinput").setVisible(true);t.byId("CHlabel").setVisible(true);t.byId("CHinput").setVisible(true);t.byId("WHlabel").setVisible(true);t.byId("WHinput").setVisible(true);}},onAfterAllEvaluationContexts:function(){var t=this;},formatFavoriteMark:function(f){return((f)?true:false);},getAllFooterButtons:function(){var t=this;return[{sId:"activateButton",sI18nBtnTxt:"ACTIVATE",onBtnPressed:function(e){t.errorMessages=[];var a=t.checkForMandatoryParametersForEvaluation();var b=function(g){if(!(g&&g.length)){a.error.push(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_EVALUATION_TITLE"));}};var c=function(g){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),g.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":g.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};t.metadataRef.getDataByEntity({entity:"EVALUATION_TEXTS",filter:"ID eq '"+t.getView().getModel("evaluation").getData().EVALUATION.ID+"' and IS_ACTIVE eq 0 and TITLE ne ''",async:false,success:b,error:c,model:t.oApplicationFacade.getODataModel()});if(a.error.length){var d="";for(var i=0,l=a.error.length;i<l;i++){d+=d?"\n":"";d+=t.oApplicationFacade.getResourceBundle().getText(a.error[i]);}sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),d);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":d});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{if(a.warning.length){var w="";for(var i=0,l=a.warning.length;i<l;i++){w+=w?"\n":"";w+=t.oApplicationFacade.getResourceBundle().getText(a.warning[i]);}var f=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:w+"\n\n"+t.oApplicationFacade.getResourceBundle().getText("WARNING_EV_ACTIVATE")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){f.close();t.activateEvaluation();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){f.close();}})});f.open();}else{t.activateEvaluation();}}}},{sId:"favouriteToggleButton",sI18nBtnTxt:"ADD_FAVOURITE",onBtnPressed:function(e){t.errorMessages=[];var p="/FAVOURITES";var c=t.getView().getModel("evaluation").getData().EVALUATION;var d=t.oApplicationFacade.getODataModel();var a={ID:c.ID,TYPE:c.ENTITY_TYPE,USER_ID:t.oApplicationFacade.currentLogonHanaUser,MANUAL_ENTRY:1,LAST_WORKED_ON:null};if(c.MANUAL_ENTRY){t.metadataRef.remove("EVALUATION_FAVOURITE",a,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_SUCCESS"));c.MANUAL_ENTRY=null;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==0){t.metadataRef.update("EVALUATION_FAVOURITE",a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_DELETE_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(c.MANUAL_ENTRY==null){t.metadataRef.update("EVALUATION_FAVOURITE",a,null,function(b){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_SUCCESS"));c.MANUAL_ENTRY=1;t.updateFooterButtons(c);t.getView().getModel("evaluation").getData().EVALUATION=c;t.getView().getModel("evaluation").setData(t.getView().getModel("evaluation").getData());t.refreshMasterList();t.setBtnText("favouriteToggleButton",t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE"));},function(b){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),b.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAVOURITE_EV_ERROR"),"description":b.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}c.MANUAL_ENTRY?e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE")):e.getSource().setText(t.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE"));}},{sId:"editButton",sI18nBtnTxt:"EDIT",onBtnPressed:function(e){t.errorMessages=[];var a="/"+t.evalPath;a=(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==2)?a.replace("IS_ACTIVE=1","IS_ACTIVE=0"):a;if(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==2){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluationDraft",context:(t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))});}else if(t.getView().getModel("evaluation").getData().EVALUATION.COUNTER==1){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"editEvaluation",context:(t.contextPath.replace("INDICATORS_MODELER","INDICATORS")+a.replace("EVALUATIONS_MODELER","EVALUATIONS"))});}}},{sId:"deleteButton",sI18nBtnTxt:"DELETE_BUTTON_TEXT",onBtnPressed:function(e){t.errorMessages=[];if(!(sap.m.MessageBox)){jQuery.sap.require("sap.m.MessageBox");}sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WARNING_SINGLE_EVALUATION_DELETE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE_BUTTON_TEXT"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){var O=t.oApplicationFacade.getODataModel();var p=[];p.push({ID:t.getView().getModel("evaluation").getData().EVALUATION.ID,IS_ACTIVE:t.getView().getModel("evaluation").getData().EVALUATION.IS_ACTIVE});t.metadataRef.remove("EVALUATION",p,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_SUCCESS"));t.refreshMasterList();var h=window.location.hash.replace("evalDetail","detail");sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:h.substr(0,h.lastIndexOf("/"))},true);},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),a.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("DELETE_EV_ERROR"),"description":a.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}if(e=="CANCEL"){}});}},{sId:"duplicateButton",sI18nBtnTxt:"DUPLICATE",onBtnPressed:function(e){t.errorMessages=[];this.duplicateEvalDialog=this.duplicateEvalDialog||t.createDuplicateDialog();this.duplicateEvalDialog.setContentHeight("350px");t.vBoxForIdPrefixText.setVisible(true);t.prefixInput.setValue();t.prefixInput.setValueState("None");t.prefixForm.setVisible(true);if(!t.settingModel.getData().ID_VISIBLE){t.vBoxForIdPrefixText.setVisible(false);t.prefixForm.setVisible(false);this.duplicateEvalDialog.setContentHeight("200px");}this.duplicateEvalDialog.open();}},{sId:"addTileButton",sI18nBtnTxt:"CONFIGURE_TILE",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPITile",route:"detail",context:("EVALUATIONS_MODELER"+t.evalPath.substr(t.evalPath.indexOf("(")))});}},{sId:"drilldownButton",sI18nBtnTxt:"DRILLDOWN_CONFIG",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:("EVALUATIONS_MODELER"+t.evalPath.substr(t.evalPath.indexOf("(")))});}},{sId:"authUsersButton",sI18nBtnTxt:"AUTH_USERS",onBtnPressed:function(e){t.errorMessages=[];sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"authorizeSBEvaluation",route:"detail",context:(t.evalPath)});}}];},createDuplicateDialog:function(){var t=this;var e=new sap.m.RadioButton({groupName:"DuplicateEval",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_ONLY"),selected:true});var a=new sap.m.RadioButton({groupName:"DuplicateEval",text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_AND_ENTITIES")});var b=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("EVAL_ONLY_TEXT")});var c=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("EVAL_AND_ENTITIES_TEXT")});var g=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("GENERATED_ID_INFO")});var d=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_ID_SAMPLE")});var p=new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("ID_PREFIX")});this.prefixInput=new sap.m.Input({type:"Text",maxLength:4,placeholder:t.oApplicationFacade.getResourceBundle().getText("PREFIX_PLACEHOLDER"),showValueHelp:false}).attachLiveChange(function(){t.validatePrefix();});var f=new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("CHAR_LIMIT"),});var B=new sap.m.VBox({items:[e,b]});var v=new sap.m.VBox({items:[a,c]});this.vBoxForIdPrefixText=new sap.m.VBox({items:[g,d]});var o=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_OK"),press:function(){if(e.getSelected()){if(t.prefixInput.getVisible()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION-ONLY",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:t.prefixInput.getValue()},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION-ONLY",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:""},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}else if(a.getSelected()){if(t.validatePrefix()){t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:t.prefixInput.getValue()},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{t.metadataRef.create("DUPLICATE_ENTITY",{flag:"EVALUATION",id:t.getView().getModel("evaluation").getData().EVALUATION.ID,prefix:""},null,function(s){i.close();sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_SUCCESS"));t.refreshMasterList();},function(j){i.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(JSON.parse(j.responseText).errorMessage);t.errorMessages.push({"type":"Error","title":JSON.parse(j.responseText).errorMessage,"description":""});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}}});var h=new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_KPI_CANCEL"),press:function(){i.close();}});this.prefixForm=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",maxContainerCols:12,labelSpanL:3,labelSpanM:3,labelSpanS:3,columnsL:4,columnsM:4,columnsS:4,content:[p,t.prefixInput,f]});var i=new sap.m.Dialog({title:t.oApplicationFacade.getResourceBundle().getText("DUPLICATE_EVAL_DIALOG_TITLE"),contentWidth:"100px",verticalScrolling:false,horizontalScrolling:false,content:[new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",content:[B,v,t.vBoxForIdPrefixText,t.prefixForm]})],beginButton:o,endButton:h});return i;},validatePrefix:function(){var t=this;this.HANA="hana";this.CDS="cds";this.VIEW_MODE=this.HANA;var s=true;var u;if((u=jQuery.sap.getUriParameters().get("viewmode"))){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}var p=t.prefixInput.getValue();if(!p){t.prefixInput.setValueState("None");}if(this.VIEW_MODE==this.CDS){t.prefixInput.setValue(p.toUpperCase());}if(p){if(this.VIEW_MODE==this.CDS&&p[0]!='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"));s=false;}else if(this.VIEW_MODE==this.HANA&&p[0]=='.'){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"));s=false;}else if(!(/^[a-zA-Z0-9.]*$/.test(p))){t.prefixInput.setValueState("Error");t.prefixInput.setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_HANA_ID_PREFIX_NO_SPL_CHAR"));s=false;}else{t.prefixInput.setValueState("None");t.prefixInput.setValueStateText();}}return s;},updateFooterButtons:function(e){e=e||this.getView().getModel("evaluation").getData().EVALUATION;var f=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];if(e.IS_ACTIVE){this.oHeaderFooterOptions.oEditBtn=f[5];this.oHeaderFooterOptions.buttonList.push(f[6]);this.oHeaderFooterOptions.buttonList.push(f[7]);}else{this.oHeaderFooterOptions.oEditBtn=f[0];}if(e.MANUAL_ENTRY){f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("REMOVE_FAVOURITE");}else{f[1].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("ADD_FAVOURITE");}this.oHeaderFooterOptions.buttonList.push(f[1]);if(e.IS_ACTIVE){this.oHeaderFooterOptions.buttonList.push(f[4]);}if(e.COUNTER==2){f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT_DRAFT");}else{f[2].sI18nBtnTxt=this.oApplicationFacade.getResourceBundle().getText("EDIT");}this.oHeaderFooterOptions.buttonList.push(f[2]);this.oHeaderFooterOptions.buttonList.push(f[3]);this.setHeaderFooterOptions(this.oHeaderFooterOptions);},getConstructorParamForTile:function(t){var c;switch(t){case"NT":c={size:"S",value:"0.0",scale:"M",valueColor:"Good",unit:this.oApplicationFacade.getResourceBundle().getText("TILE_CURRENCY"),footer:this.oApplicationFacade.getResourceBundle().getText("ACTUAL")};break;case"CT":c={scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_1"),value:1550}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_2"),value:219.2}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("VALUE_3"),value:66.46})]};break;case"AT":c={scale:"M",size:"S",minValue:0,maxvalue:312,targetValue:150,actual:new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),thresholds:[new sap.suite.ui.commons.BulletChartData({value:312,color:"Error"}),new sap.suite.ui.commons.BulletChartData({value:200,color:"Critical"})]};break;case"TT":c={size:"S",width:"130px",height:"59px",minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 1",color:"Neutral"}),lastXLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"Jan 31",color:"Neutral"}),firstYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"3 M",color:"Error"}),lastYLabel:new sap.suite.ui.commons.MicroAreaChartLabel({label:"23 M",color:"Good"}),target:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:90})]}),innerMinThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),innerMaxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Good"}),minThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),maxThreshold:new sap.suite.ui.commons.MicroAreaChartItem({color:"Error",points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:20}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:30}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:70})]}),chart:new sap.suite.ui.commons.MicroAreaChartItem({points:[new sap.suite.ui.commons.MicroAreaChartPoint({x:0,y:0}),new sap.suite.ui.commons.MicroAreaChartPoint({x:30,y:40}),new sap.suite.ui.commons.MicroAreaChartPoint({x:60,y:50}),new sap.suite.ui.commons.MicroAreaChartPoint({x:100,y:100})]}),};break;case"CM":c={scale:"M",size:"S",data:[new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_1"),value:34,color:"Good"}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_2"),value:125,color:"Error"}),new sap.suite.ui.commons.ComparisonData({title:this.oApplicationFacade.getResourceBundle().getText("MEASURE_3"),value:97,color:"Critical"})]};break;case"HT":c={total:100,size:"S",scale:"M",items:[new sap.suite.ui.commons.HarveyBallMicroChartItem({fraction:30,color:"Good"})]};break;}return c;},getPreviewTile:function(t,c){var f="OneByOne";var a,b;switch(t){case'NT':a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile(t));break;case'CT':a=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile(t));break;case'AT':a=new sap.suite.ui.commons.BulletChart(this.getConstructorParamForTile(t));break;case'TT':a=new sap.suite.ui.commons.MicroAreaChart(this.getConstructorParamForTile(t));break;case'CM':a=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile(t));break;case'HT':a=new sap.suite.ui.commons.HarveyBallMicroChart(this.getConstructorParamForTile(t));break;case'DT-AT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.BulletChart(this.getConstructorParamForTile("AT"));break;case'DT-CT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile("CT"));break;case'DT-CM':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.ComparisonChart(this.getConstructorParamForTile("CM"));break;case'DT-TT':f="TwoByOne";a=new sap.suite.ui.commons.NumericContent(this.getConstructorParamForTile("NT"));b=new sap.suite.ui.commons.MicroAreaChart(this.getConstructorParamForTile("TT"));break;}var d=new sap.suite.ui.commons.GenericTile({size:"S",frameType:f,header:c.getProperty("title"),subheader:c.getProperty("description"),customData:[new sap.ui.core.CustomData({key:"tileType",value:t})],tileContent:new sap.suite.ui.commons.TileContent({content:a,size:"S"}),press:function(e){}});d.addStyleClass("sbTile");if(b){d.addTileContent(new sap.suite.ui.commons.TileContent({content:b,size:"S"}));}return d;},getChipRow:function(i,c){var t=this;var a,b;var d={};try{d=JSON.parse(JSON.parse(JSON.parse(c.getObject().configuration).tileConfiguration).TILE_PROPERTIES);}catch(e){jQuery.sap.log.error("parsing of Chip Failed");}var n=d.navType=="0"?"GENERIC_DRILLDOWN":"OTHER_DRILLDOWN";var s="STATUS_ACTIVE_DRAFT";var f="Success";var g=false;var h=Number(d.navType)?true:false;if(c.getObject().COUNTER=="1"){if(c.getObject().isActive){s="STATUS_ACTIVE";}else{s="STATUS_NEW";f="None";}}var j=new sap.m.ObjectNumber({number:t.oApplicationFacade.getResourceBundle().getText(s),state:f});var b=t.getPreviewTile(c.getProperty('tileType'),c);if(c.getProperty("isAffected")){b.addStyleClass("affectedTile");l.setEnabled(false);g=true;}var k=function(r){var u=this.getBindingContext("evaluation");var v=u.getObject();var w="CHIPS";var x=(v.isActive&&v.COUNTER!=2)?1:0;w=w+"("+q.id+"='"+v.id+"',"+q.isActive+"="+x+")";sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPITile",route:q.editTileRoute,context:(t.evalContext.sPath.substr(1)+"/"+w)});};var l=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Transparent,press:k});var m=new sap.m.Button({icon:"sap-icon://sys-cancel",type:sap.m.ButtonType.Transparent,press:function(r){t.handleDelete(this);}});var o=[];if(t.isPlatformABAP){o=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:c.getObject().catalogName,visible:true}),new sap.m.ObjectStatus({text:t.oApplicationFacade.getResourceBundle().getText("TILE_REMOVED_FROM_CATALOG"),state:"Error",visible:g})]}).addStyleClass("navigationVLayout"),l];}else{o=[b,new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText(n)}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("SEMANTIC_OBJECT")+': '+d.semanticObject,visible:h}),new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ACTION")+': '+d.semanticAction,visible:h}),]}).addStyleClass("navigationVLayout"),j,l];}var p=new sap.m.ColumnListItem({cells:o});if(!(t.isPlatformABAP)){var q={id:"id",isActive:'isActive',editTileRoute:'editTile'};l.attachPress(k);p.attachPress(k);}else if(t.isPlatformABAP&&!(c.getProperty("isAffected"))){var q={id:"ID",isActive:'IS_ACTIVE',editTileRoute:'editTileModelS'};l.attachPress(k);p.attachPress(k);}else{p.setType("Inactive");}return p;},checkForMandatoryParametersForEvaluation:function(){var t=this;var e=t.getView().getModel("evaluation").getData().EVALUATION;var a=[];var w=[];var b={};var c=t.getView().getModel("evaluation").getData().FILTERS;var d=t.getView().getModel("evaluation").getData().VALUES;var f=false;e.ODATA_URL?true:a.push("ERROR_ENTER_ODATA_URL");e.ODATA_ENTITYSET?true:a.push("ERROR_ENTER_ENTITY_SET");e.COLUMN_NAME?true:a.push("ERROR_ENTER_MEASURE");if(e.ODATA_URL&&e.ODATA_ENTITYSET){this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(t._appendSystemAlias(e.ODATA_URL)),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e.ODATA_ENTITYSET);if(this.queryResultObj.getParameterization()){b=this.queryResultObj.getParameterization().getAllParameters();}for(var i=0,l=d.length;i<l;i++){if(d[i].TYPE=="TA"){f=true;}else if(d[i].TYPE&&(d[i].TYPE.toString().search(/^\d\d$/)==0)){if(d[i].COLUMN_NAME==e.COLUMN_NAME){a.push("ADDI_MEASURE_HAS_MAIN_MEASURE");}}}if(!f){w.push("ERROR_ENTER_TARGET");}for(var i=0,l=c.length;i<l;i++){if(c[i].TYPE=='PA'){if(b[c[i].NAME]&&(c[i].VALUE_1!==undefined)&&(c[i].VALUE_1!==null)){delete b[c[i].NAME];}}}if(Object.keys(b).length){a.push("ERROR_ENTER_ALL_INPUT_PARAMETERS");}}return{error:a,warning:w};},formatFilterValue:function(v){if(!v)return v;var a=v.split(",");pattern=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T([0-1][0-9]|2[0-3])(:[0-5][0-9]){2}[.][0-9]{3}Z$/;if(!pattern.test(a[0]))return v;var d=[];for(var k in a)d.push(new Date(a[k]).toString());return d.join(",");},formatTags:function(t){return((this.getView().byId("tags").getItems().length>1)?(', '+t):(t));},formatScalingFactor:function(s){var t=this;var a=null;switch(s){case 0:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");break;case-2:a=t.oApplicationFacade.getResourceBundle().getText("PERCENT");break;default:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");}return a;},formatDecimalPrecision:function(d){var t=this;var a=null;switch(d){case-1:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");break;case 0:a=t.oApplicationFacade.getResourceBundle().getText("NO_DECIMAL");break;case 1:a=t.convert(1);break;case 2:a=t.convert(2);break;case 3:a=t.convert(3);break;default:a=t.oApplicationFacade.getResourceBundle().getText("AUTO");}return a;},convert:function(v){jQuery.sap.require("sap.ui.core.format.NumberFormat");var a=sap.ui.core.format.NumberFormat.getFloatInstance({style:'standard',minFractionDigits:v,maxFractionDigits:v,});var n=a.format(0);return n;},activateEvaluation:function(){var t=this;var p={};var e="ACTIVE_EVALUATIONS";p.ID=t.getView().getModel("evaluation").getData().EVALUATION.ID;p=p;var O=t.oApplicationFacade.getODataModel();t.metadataRef.create("ACTIVATE_EVALUATION",p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_SUCCESS"));t.refreshMasterList();t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex].EVALUATION.IS_ACTIVE=1;t.byId("evalStatus").setText(t.oApplicationFacade.getResourceBundle().getText("STATUS_ACTIVE"));t.byId("evalStatus").setState(sap.ui.core.ValueState.Success);sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:window.location.hash.replace("IS_ACTIVE=0","IS_ACTIVE=1")},true);t.updateFooterButtons(t.oApplicationFacade.evaluationDetails[t.oApplicationFacade.evaluationIndex].EVALUATION);},function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),a.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":a.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},_addColumnsToTable:function(){var t=this.byId("tileGrid");t.removeAllColumns();if(this.isPlatformABAP){t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("CATALOGUE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}else{t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("TILE_TYPE")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("NAVIGATION")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:this.oApplicationFacade.getResourceBundle().getText("STATUS")}),visible:true}));t.addColumn(new sap.m.Column({header:new sap.m.Label({text:""}),visible:true}));}},onTilePanelExpanded:function(e){if(e.getParameter("expand")){var t=this;var m=this.getView().getModel("evaluation");if(m.getProperty("/CHIPS").length==0){this.metadataRef.getChipByEvaluation({context:this.evalContext,success:function(d){m.setProperty("/CHIPS",d.CHIPS);},error:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),err.responseText);t.errorMessages.push({"type":"Error","title":this.oApplicationFacade.getResourceBundle().getText("ACTIVATE_EV_ERROR"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);},model:this.oApplicationFacade.getODataModel()});}}},initializeDrillDownViewPopover:function(){var t=this;var r=this.oApplicationFacade.getResourceBundle();this.drillDownViewPopover=new sap.m.ResponsivePopover({title:"{/TITLE}",content:[new sap.ui.layout.form.SimpleForm({labelSpanL:2,labelSpanM:2,emptySpanL:0,emptySpanM:0,columnsL:1,columnsM:1,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:r.getText("CHART_TYPE"),design:"Bold"}),new sap.m.Text({text:"{/CHART_TYPE}"}),new sap.m.Label({text:r.getText("MEASURES"),design:"Bold"}),new sap.m.Text({text:{path:"/MEASURES",formatter:function(m){return m?m.join():"";}}}),new sap.m.Label({text:r.getText("DIMENSIONS"),design:"Bold"}),new sap.m.Text({text:{path:"/DIMENSIONS",formatter:function(d){return d?d.join():"";}}})]})],beginButton:new sap.m.Button({text:r.getText("OPEN_IN_DRILLDOWN"),press:function(){var v=this.getModel().getProperty("/ID");var e=this.getModel().getProperty("/EVALID");sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"configureChart",context:e+"/"+v});}})});this.drillDownViewPopover.setModel(new sap.ui.model.json.JSONModel());},onViewPressed:function(e){var d=e.getSource().getBindingContext("evaluation").getObject();this.drillDownViewPopover.getModel().setData(d);this.drillDownViewPopover.openBy(e.getSource());},openAdditionalLanguageDialog:function(e){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=[];this.additionalLanguageListModelData=t.getView().getModel('evaluation').getData().TEXTS;var a=function(o,c,d){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=c;t.localLanguage=d;};var i=0;var l=this.additionalLanguageListModelData.length;sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices").getAllLanguages({async:false,success:a,model:this.oDataModel});for(i=0;i<l;i++){this.additionalLanguageListModelData[i].ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[this.additionalLanguageListModelData[i].LANGUAGE];}this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.addedLanguagesList=new sap.m.List({showNoData:false,layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){b.getBeginButton().setEnabled(false);}else{b.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L7 M7 S7",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"}),editable:false}),]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var b=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGES"),content:[t.addedLanguagesList],endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){b.close();}})});b.open();},onDrillDownPanelExpanded:function(e){if(e.getParameter('expand')){var m=this.getView().getModel("evaluation");if(!(m.getProperty("/DRILLDOWN/ISLOADED"))){var a=this.oApplicationFacade.evaluationDetails[this.oApplicationFacade.evaluationIndex].EVALUATION.ID;var c=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration(a);var v=c.getDefaultView();var h=v?(v.getHeaders()||[]):[];var f=v?(v.getFilters()||[]):[];var d={FILTERS:f.join(", "),VIEWS:[],ISLOADED:true,HEADERS_COUNT:h.length};var b=c.getAllViews()||[];b.forEach(function(g){var i=c.findViewById(g.ID);d.VIEWS.push({ID:g.ID,EVALID:a,MEASURES:i.getMeasures(),DIMENSIONS:i.getDimensions(),TITLE:i.getTitle(),CHART_TYPE:i.getChartConfiguration()[0].oChart.CHART_TYPE,});});d.VIEW_COUNT=d.VIEWS.length;m.setProperty("/DRILLDOWN",d);}}}});
