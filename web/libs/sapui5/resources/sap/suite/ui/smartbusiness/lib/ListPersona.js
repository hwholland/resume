/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.ListPersona");
sap.suite.ui.smartbusiness.lib.ListPersona=function(p){this.oParam=p;this.init();};
sap.suite.ui.smartbusiness.lib.ListPersona.prototype={init:function(){this.CHANGE_STATE=false;this.oContext=this.oParam.context;if(jQuery.sap.startsWith(this.oContext,"/")){this.oContext=this.oContext.substring(1);}this.oView=this.oParam.view;this.namedModel=this.oParam.namedModel;this.oModel=this.oView.getModel();if(this.namedModel){this.oModel=this.oView.getModel(this.namedModel);}var v=this.oModel.getContext("/"+this.oContext).getObject();this.oData=[];this.oBackupData=[];jQuery.extend(true,this.oData,v);jQuery.extend(true,this.oBackupData,v);this.iLength=this.oData.length;if(this.oParam.filter){this.iLength=this._getArrayIndex(this.oData.length-1)+1;}this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this._initializeDialogView();this.oDialog.setModel(this.oTempModel);if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value));}},_getArrayIndex:function(I){var a=-1;for(var i=0;i<=I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){a++;}}return a;},handleListSelection:function(e){if(this.iLength>1){this._oSelectedItemIndex=+((e.getParameter("listItem").getBindingContext().getPath()).split('/').pop());var i=this._oSelectedItemIndex;if(this.oParam.filter){i=this._getArrayIndex(this._oSelectedItemIndex);}this.setSelectedIndex(i);}},setSelectedIndex:function(i,c){this.selectedIndex=i;if(this.selectedIndex==0){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(false);}else if(this.selectedIndex>0&&this.selectedIndex<this.iLength-1){this.moveDownButton.setEnabled(true);this.moveUpButton.setEnabled(true);}else if(this.selectedIndex==this.iLength-1){this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(true);}else{jQuery.sap.log.error("Invalid Selected Index");}if(c){this.oList.setSelectedItem(this.oList.getItems()[this.selectedIndex],true);}},_getPreviousIndex:function(I){var r=-1;for(var i=0;i<I;i++){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i;}}return r;},_getNextIndex:function(I){var r=-1;for(var i=this.oData.length-1;i>I;i--){var e=this.oData[i];if(e[this.oParam.filter.property]==this.oParam.filter.value){r=i;}}return r;},moveItemUp:function(){var t=this.oData[this._oSelectedItemIndex];var p=this._oSelectedItemIndex-1;if(this.oParam.filter){p=this._getPreviousIndex(this._oSelectedItemIndex);}this.oData[this._oSelectedItemIndex]=this.oData[p];this.oData[p]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex-1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=p;},moveItemDown:function(){var t=this.oData[this._oSelectedItemIndex];var n=this._oSelectedItemIndex+1;if(this.oParam.filter){n=this._getNextIndex(this._oSelectedItemIndex);}this.oData[this._oSelectedItemIndex]=this.oData[n];this.oData[n]=t;this.oTempModel.updateBindings();this.setSelectedIndex(this.selectedIndex+1,true);this.CHANGE_STATE=true;this._oSelectedItemIndex=n;},resetEverything:function(){if(this.CHANGE_STATE){this.oData=[];jQuery.extend(true,this.oData,this.oBackupData);this.oList.removeSelections();this.oTempModel=new sap.ui.model.json.JSONModel({data:this.oData});this.oDialog.setModel(this.oTempModel);this.oTempModel.updateBindings();if(this.oParam.filter){this.oList.getBinding("items").filter(new sap.ui.model.Filter(this.oParam.filter.property,sap.ui.model.FilterOperator.EQ,this.oParam.filter.value));}this.moveDownButton.setEnabled(false);this.moveUpButton.setEnabled(false);this.CHANGE_STATE=false;}},_initializeDialogView:function(){var t=this;this.oList=new sap.m.List({mode:"SingleSelectMaster",selectionChange:jQuery.proxy(this.handleListSelection,this)}).bindAggregation("items","/data",new sap.m.StandardListItem({title:{path:this.oParam.listItemContext}}));this.moveUpButton=new sap.m.Button({icon:"sap-icon://arrow-top",enabled:false,press:function(){t.moveItemUp();}});this.moveDownButton=new sap.m.Button({icon:"sap-icon://arrow-bottom",enabled:false,press:function(){t.moveItemDown();}});this.undoButton=new sap.m.Button({icon:"sap-icon://undo",press:function(){t.resetEverything();}});this.oDialog=new sap.m.Dialog({title:this.oParam.title||"Change Order of List Item",content:[this.oList,new sap.m.Bar({design:"Header",contentLeft:[this.moveUpButton,this.moveDownButton],contentRight:[this.undoButton]})],beginButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("OK"),press:jQuery.proxy(this.okDialog,this)}),endButton:new sap.m.Button({text:this.oView.getModel("i18n").getProperty("CANCEL"),press:jQuery.proxy(this.closeDialog,this)})});},start:function(){this.oDialog.open();},closeDialog:function(){this.oDialog.close();},okDialog:function(){if(this.CHANGE_STATE){this.oModel.getData()[this.oContext]=this.oData;this.oModel.updateBindings();}this.oDialog.close();if(this.oParam.callback){this.oParam.callback.call(null);}}};
