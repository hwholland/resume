/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.adapter.abap.CatalogServicesAdapter");
sap.suite.ui.smartbusiness.adapter.abap.CatalogServicesAdapter=function(){var t=this;var c={};var a={'NT':'X-SAP-UI2-CHIP:/SSB/NUMERIC_TILE','CT':'X-SAP-UI2-CHIP:/SSB/COMPARISON_TILE','TT':'X-SAP-UI2-CHIP:/SSB/TREND_TILE','AT':'X-SAP-UI2-CHIP:/SSB/DEVIATION_TILE','CM':'X-SAP-UI2-CHIP:/SSB/COMPARISON_MM_TILE','DT-CT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON','DT-CM':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_COMPARISON_MM','DT-AT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_DEVIATION','DT-TT':'X-SAP-UI2-CHIP:/SSB/DUAL_NUMERIC_TREND'};var g=function(e,E){if(E){return E.evaluationValues;}else{var v=[];e.VALUES.forEach(function(j){delete j.__metadata;var o={};for(var p in j){if(j.hasOwnProperty(p)){o[p]=j[p];}}v.push(o);});return v;}};var _=function(d){var e=[];if(d&&d.length){d.forEach(function(i){var o={};o["NAME"]=i[0];o["OPERATOR"]=i[1];o["VALUE_1"]=i[2];o["VALUE_2"]=i[3];o["TYPE"]="FI";e.push(o);});}return e;};var b=function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var d=sap.ushell.Container.getService("URLParsing");if(d){u=d.addSystemToServiceUrl(u,s);}}return u;};var f=function(){if(!(c.ui2Factory)){var s="PERS";jQuery.sap.log.info("Abap Adapter --> Creating UI2 Factory with Scope - "+s);if(sap.ushell&&sap.ushell.Container){c.ui2Factory=sap.ushell.Container.getService("PageBuilding",s).getFactory();}}else{jQuery.sap.log.info("Abap Adapter --> Picking UI2 Factory from cache");}return c.ui2Factory;};function h(p,e,i){if(!(sap.ushell&&sap.ushell.Container)){jQuery.sap.require(sap.ushell.Container);}var F=f();var P=f().getPageBuildingService();var j=a[p.tileType];p.id=j;p.chipId=j;var C=new sap.ui2.srvc.Chip(p,F);var o=new sap.ui2.srvc.Page(F,p.catalogId);var k=null;var l=null;var n=null;function w(d){jQuery.sap.log.info("Abap Adapter --> Bag updated successfully for the Chip Instance");}function m(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing into the Bag of the Chip Instance");i(d,s,x);}function q(d){jQuery.sap.log.info("Abap Adapter --> Configuration updated successfully for the Chip Instance");if(e){e({response:{chipId:n}});}}function r(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while writing Configuration to the Chip Instance");i(d,s,x);}function u(d){jQuery.sap.log.info("Abap Adapter --> Chip Instance created successfully");var U='X-SAP-UI2-PAGE';var s=d;var x=s.getId();p.ID=x;p.configuration=p.configuration.replace(/___CHIPINSTID______CHIPINSTID___/g,x);p.configuration=p.configuration.replace(/_____CHIPID__________CHIPID_____/g,U+":"+p.catalogId+":"+x);n=U+":"+p.catalogId+":"+x;s.getApi().writeConfiguration.setParameterValues(p.configuration,q,r);s.setTitle(p.title);var D=s.getBag("sb_tileProperties");D.setText("title",p.title);D.setText("description",p.description);D.save(w,m);}function v(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error in creating a Chip Instance in the UI2 Catalog");i(d,s,x);}function y(){jQuery.sap.log.info("Abap Adapter --> Chip Stub loaded successfully");k=C;l.addChipInstance(k,u,v);}function z(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Chip Stub");i(d,s,x);}function A(){jQuery.sap.log.info("Abap Adapter --> Page Stub loaded successfully");l=o;C.load(y,z);}function B(d,s,x){jQuery.sap.log.error("Abap Adapter --> Error while loading the Page Stub");i(d,s,x);}o.load(A,B);};this.publishChip=function(p,m,s,e){if(m=="create"){jQuery.sap.log.info("Abap Adapter --> Calling Chip create");h(p,s,e);}else{jQuery.sap.log.info("Abap Adapter --> Calling Chip update");}};this.savePersonalizedTile=function(p){var r={},R,S,C,o;if(p.evaluationId&&p.tileType){R=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");var i=R.getEvaluationById({id:p.evaluationId,ID:p.evaluationId,cache:true,filters:true,values:true,thresholds:true,useRuntimeService:true,sapSystem:p.sapSystem});if(i.EVALUATION&&i.EVALUATION.ID){var T=Date.now()+"";var M={};function j(o){var d=JSON.parse(o.configuration);d.isSufficient="1";d.timestamp=T;var l=JSON.parse(d.tileConfiguration);var m=JSON.parse(l.TILE_PROPERTIES);m.id="_____CHIPID__________CHIPID_____";m.instanceId="___CHIPINSTID______CHIPINSTID___";m.catalogId="/UI2/Fiori2LaunchpadHome";l.TILE_PROPERTIES=JSON.stringify(m);l.ADDITIONAL_FILTERS=JSON.stringify(_(p.additionalFilters));l.EVALUATION_VALUES=JSON.stringify(g(i,p.evaluationValues));d.tileConfiguration=JSON.stringify(l);d=JSON.stringify(d);o.configuration=d;o.tileType=p.tileType;o.catalogId="/UI2/Fiori2LaunchpadHome";o.title=o.title||i.INDICATOR_TITLE;o.description=p.title||i.TITLE;t.publishChip(o,"create",p.success,p.error);};function k(d,s,x){};try{S=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();C=S["chipId"][0];C=decodeURIComponent(C);C=decodeURIComponent(C);o=R.getChipById({id:C,success:j,error:k});}catch(e){return{status:"Failed",message:e.message};}}else{r.status="Failed",r.message="Invalid Evaluation Id : "+p.evaluationId;}}else{r.status="Failed",r.message="Mandatory Param evaluationId or TileType is Missing";}return r;};};
