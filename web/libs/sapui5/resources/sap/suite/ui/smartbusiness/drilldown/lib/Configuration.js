/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.drilldown.lib.Configuration");sap.suite.ui.smartbusiness.drilldown.lib.Configuration=(function(){var _={};var b=function(u){return jQuery.sap.encodeURL(u);};var t=function(s){if(s){return s.trim();}return s;};var H=function(o){this.oHeader=o;this.oHeader.CONFIGURATION=t(this.oHeader.CONFIGURATION);if(this.oHeader.CONFIGURATION){var a=this.oHeader.CONFIGURATION;try{tempObject=JSON.parse(a);for(var i in tempObject){try{tempObject[i]=JSON.parse(tempObject[i]);}catch(e){tempObject[i]=tempObject[i];}}this.oHeader.PARSED_CONFIGURATION=tempObject;}catch(e){jQuery.sap.log.error("Error Parsing Drilldown Header Configuration");this.oHeader.PARSED_CONFIGURATION=null;}}else{this.oHeader.PARSED_CONFIGURATION=null;}};H.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE;},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID;},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID;},getEvaluationId:function(){return this.oHeader.EVALUATION_ID;},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER;},isVisible:function(){return this.oHeader.VISIBILITY==1;},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true;}}return false;},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION";},getDimension:function(){return this.oHeader.DIMENSION;},getTileConfiguration:function(){return this.oHeader.PARSED_CONFIGURATION;},getVisibility:function(){return this.oHeader.VISIBILITY;}};var C=function(o){this.oChart=o;};C.prototype={getValueType:function(){return this.oChart.VALUE_TYPE;},getAxisType:function(){return this.oChart.AXIS_TYPE;},getChartType:function(){var a=this;return{isBar:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BAR";},isColumn:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COLUMN";},isLine:function(){return a.oChart.CHART_TYPE.toUpperCase()=="LINE";},isCombination:function(){return a.oChart.CHART_TYPE.toUpperCase()=="COMBINATION";},isTable:function(){return a.oChart.CHART_TYPE.toUpperCase()=="TABLE";},isBubble:function(){return a.oChart.CHART_TYPE.toUpperCase()=="BUBBLE";},isGeoMap:function(){return a.oChart.CHART_TYPE.toUpperCase()=="GEOMAP";},isAnalyticalMap:function(){return a.oChart.CHART_TYPE.toUpperCase()=="CHOROPLETH";},getText:function(){return a.oChart.CHART_TYPE;}};},getColorScheme:function(){var a=this;return{getText:function(){return a.oChart.COLOR_SCHEME;},isManual:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualSemantic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualNonSematic:function(){return a.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC";},isAutoSemantic:function(){return a.oChart.COLOR_SCHEME=='AUTO_SEMANTIC';}};},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE;},getDataLimit:function(){return this.oChart.DATA_LIMIT;},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE";},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE";},isSingleAxis:function(){return this.getAxisType()=="SINGLE";},isDualAxis:function(){return this.getAxisType()=="DUAL";},isStackingEnabled:function(v){var a=false;var e=v.getColumns();e.forEach(function(i){var o=v.findColumnByName(i);if(o.isStacked()){a=true;return false;}});return a;}};var c=function(){};c.prototype={getName:function(){return this.oParam.NAME;},getSortBy:function(){return this.oParam.SORT_BY;},getSortOrder:function(){return this.oParam.SORT_ORDER;},getType:function(){return this.oParam.TYPE;},getVisibility:function(){return this.oParam.VISIBILITY;},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART";},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE";},getColor:function(){return this.oParam.COLOR;},isStacked:function(){return this.oParam.STACKING==1;},getStacking:function(){return this.oParam.STACKING;},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION";},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE";},getAxis:function(){return this.oParam.AXIS;}};var D=function(p){this.oParam=p;};D.prototype=new c();var M=function(p){this.oParam=p;};M.prototype=new c();var F=function(p){this.oFilter=p;};F.prototype={getName:function(){return this.oFilter.DIMENSION;},isVisible:function(){return this.oFilter.VISIBILITY==1;}};var V=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._dimensionMap={};this._measureMap={};this._chartConfig=[];};V.prototype={getTitle:function(){return this._title;},getId:function(){return this._viewId;},getEvaluationId:function(){return this._evaluationId;},getViewOrder:function(){return this._order;},getColumns:function(){return this._columns;},getDimensions:function(){return this._dimensions;},getDimensionCount:function(){return this._dimensions.length;},getMeasures:function(){return this._measures;},getMeasureCount:function(){return this._measures.length;},findDimensionByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a];}else{throw new Error("Invalid Dimension Name : "+a);}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m];}else{throw new Error("Invalid Dimension Name : "+m);}},findColumnByName:function(a){if(this._dimensionMap[a]){return this._dimensionMap[a];}else if(this._measureMap[a]){return this._measureMap[a];}else{throw new Error("Invalid Column Name : "+a);}},getChartConfiguration:function(){return this._chartConfig;}};var d=function(e,j){this.evaluationId=e;this._batchResponse=j;var k=null;var m={};var n=[];var o=-1;this._filters=[];this._filterMap={};this._headers=[];var p=function(q,r,s,u,w,x){q.forEach(function(v,i,a){var A=v.CONFIGURATION_ID;if(A){o++;n.push(A);var O=new V(v);m[A]=O;if(o==0){k=A;}V.setDimensionAndMeasures(w,O);V.setChart(x,O);}});var S=d.Constants;for(var y in S){var z=S[y].func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return true;};}else{d.prototype[z]=function(){return null;};}}r.forEach(function(v,i,a){var A=S[v.PROPERTY_TYPE];if(A){var z=A.func;if(jQuery.sap.startsWith(z,"is")){d.prototype[z]=function(){return v.VISIBILITY==1;};}else{d.prototype[z]=function(){return v.PROPERTY_VALUE;};}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE);}},this);if(u.length){u.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new F(v);},this);}if(s.length){s.forEach(function(v,i,a){this.getHeaders().push(new H(v));},this);}};this.getFilters=function(){return this._filters;};this.getHeaders=function(){return this._headers;};this.getMaxViewOrder=function(){var a=0;for(var v in m){a=Math.max(a,m[v].getViewOrder());}return a;};this.findViewById=function(i){if(m[i]){return m[i];}return null;},this.getDefaultViewId=function(){return k;},this.getDefaultView=function(){if(k){return m[k];}return null;};this.removeViewById=function(v){delete m[v];};this.getAllViews=function(){var v=[];n.forEach(function(a){v.push({ID:a,TITLE:this.findViewById(a).getTitle()||"-NA- ("+a+")"})},this);return v;};p.call(this,this._batchResponse[0].data.results,this._batchResponse[1].data.results,this._batchResponse[2].data.results,this._batchResponse[3].data.results,this._batchResponse[4].data.results,this._batchResponse[5].data.results);};d.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};V.setDimensionAndMeasures=function(o,T){o.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new M(v);this._measures.push(v.NAME);}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new D(v);this._dimensions.push(v.NAME);}}},T);};V.setChart=function(o,T){if(o.length){o.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new C(v));}},T);}};var f=function(e){var T={TT:"Area Chart Tile",CT:"Comparison Tile",NT:"Numeric Tile",AT:"Bullet Tile"};var a={name:e,children:[]};var i=this.getAllViews();for(var j in i){var k={name:i[j].TITLE||"NA",children:[]};var v=this.findViewById(i[j].ID);var m={name:"*Configuration",children:[]};k.children.push(m);m.children.push({name:"Filter Enabled : "+this.isFilterEnabled()});m.children.push({name:"Kpi Aggregate Value Enabled: "+this.isAggregateValueEnabled()});m.children.push({name:"Header Enabled : "+this.isHeaderEnabled()});m.children.push({name:"OData Service Uri : "+this.getQueryServiceUri()});m.children.push({name:"Entity Set : "+this.getEntitySet()});var n=this.getFilters();var o={name:"*Filters("+n.length+")",children:[]};k.children.push(o);n.forEach(function(z){o.children.push({name:z});});var p=v.getChartConfiguration().length?v.getChartConfiguration()[0]:null;var q={name:"*Chart",children:[]};k.children.push(q);if(p){q.children.push({name:"Type : "+p.getChartType().getText()});q.children.push({name:"Color Scheme : "+p.getColorScheme().getText()});q.children.push({name:"Value Type : "+p.getValueType()});q.children.push({name:"Axis Type : "+p.getAxisType()});q.children.push({name:"Data Limit : "+(p.getDataLimit()||"NA")});q.children.push({name:"Stacking Enabled : "+p.isStackingEnabled(v)});q.children.push({name:"Threshold Measure : "+p.getThresholdMeasure()});}else{q.children.push({name:"Oops!!!NO Chart Configuration"});}var r=v.getMeasures();var s={name:"*Measures("+r.length+")",children:[]};k.children.push(s);r.forEach(function(z,A,B){var E={name:z,children:[]};s.children.push(E);var G=v.findMeasureByName(z);E.children.push({name:"Color : "+(G.getColor()||"NA")});E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis : "+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()});},this);var u=v.getDimensions();var w={name:"*Dimensions("+u.length+")",children:[]};k.children.push(w);u.forEach(function(z,A,B){var E={name:z,children:[]};w.children.push(E);var G=v.findDimensionByName(z);E.children.push({name:"Sort By : "+G.getSortBy()});E.children.push({name:"Sort Order : "+G.getSortOrder()});E.children.push({name:"Visible in Table : "+G.isVisibleInTable()});E.children.push({name:"Axis :"+G.getAxis()});E.children.push({name:"Is Stacked :"+G.isStacked()});},this);var x=this.getHeaders();var y={name:"*Kpi_Headers("+x.length+")",children:[]};k.children.push(y);x.forEach(function(j,z){var A={name:z+1+"",children:[]};y.children.push(A);A.children.push({name:"Type : "+T[j.getVisualizationType()],});A.children.push({name:"Reference Evaluation : "+j.getReferenceEvaluationId(),});A.children.push({name:"Dimension : "+(j.getDimension()||"NA"),});A.children.push({name:"isAssociatedOrOtherEvaluation : "+j.isAssociated(),});});a.children.push(k);}return a;};var g=function(p){var k=p.id;return k;};var h=function(e){var a=[];var m=[];var v=[];var n=parseInt(e.results[0].FILTERS_COUNT)||1;var o=parseInt(e.results[0].VALUES_COUNT)||1;var p=n*o;for(var i=0;i<e.results.length;i+=p){var q=parseInt(e.results[i].FILTERS_COUNT)||1;var o=parseInt(e.results[i].VALUES_COUNT)||1;var p=q*o;var r={};r.keys={};r.keys.VALUES={};r.keys.VALUES.results=[];r.keys.FILTERS={};r.keys.FILTERS.results=[];r.keys.ID=e.results[i].ID;r.keys.DESCRIPTION=e.results[i].DESCRIPTION;r.keys.ACTION=e.results[i].ACTION;r.keys.INDICATOR=e.results[i].INDICATOR;r.keys.INDICATOR_TITLE=e.results[i].INDICATOR_TITLE;r.keys.TITLE=e.results[i].TITLE;r.keys.NAME=e.results[i].NAME;r.keys.SCALING=e.results[i].SCALING;r.keys.ODATA_URL=e.results[i].ODATA_URL;r.keys.ODATA_ENTITYSET=e.results[i].ODATA_ENTITYSET;r.keys.VIEW_NAME=e.results[i].VIEW_NAME;r.keys.COLUMN_NAME=e.results[i].COLUMN_NAME;r.keys.OWNER_NAME=e.results[i].OWNER_NAME;r.keys.OWNER_E_MAIL=e.results[i].OWNER_E_MAIL;r.keys.OWNER_ID=e.results[i].OWNER_ID;r.keys.PROPERTIES=e.results[i].PROPERTIES||{};r.keys.ODATA_PROPERTY=e.results[i].ODATA_PROPERTY;r.keys.SEMANTIC_OBJECT=e.results[i].SEMANTIC_OBJECT;r.keys.VALUES_SOURCE=e.results[i].VALUES_SOURCE;r.keys.INDICATOR_TYPE=e.results[i].INDICATOR_TYPE;r.keys.GOAL_TYPE=e.results[i].GOAL_TYPE;r.keys.DECIMAL_PRECISION=e.results[i].DECIMAL_PRECISION;for(var j=i;j<o+i;j++){if(parseInt(e.results[i].VALUES_COUNT)){var s={};s.TYPE=e.results[j].TYPE;s.FIXED=e.results[j].FIXED;s.COLUMN_NAME=e.results[j].COLUMN_NAME_1;s.ODATA_PROPERTY=e.results[j].ODATA_PROPERTY_1;s.ID=e.results[j].ID;r.keys.VALUES.results.push(s);}}for(var k=i;k<p+i;k+=o){if(parseInt(e.results[i].FILTERS_COUNT)){var u={};u.ID=e.results[k].ID;u.NAME=e.results[k].NAME;u.OPERATOR=e.results[k].OPERATOR;u.TYPE=e.results[k].TYPE_1;u.VALUE_1=e.results[k].VALUE_1;u.VALUE_2=e.results[k].VALUE_2;r.keys.FILTERS.results.push(u);}}a.push(r.keys);}return a;};var l=function(s,a){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var u=sap.ushell.Container.getService("URLParsing");s=u.addSystemToServiceUrl(s,a);}return s;};return{getConfigurationTree:function(e,s,a){this.loadConfiguration({evaluationId:e,cache:true,success:function(i){var d=this.parse(e,i);s.call(null,f.apply(d,["Evaluation"]));},error:function(i){jQuery.sap.log.error("Error Fetching Drilldown Configuration")},context:this});},parse:function(e,a){return new d(e,a);},getConfigurationFromCache:function(e){return _[e];},resetDrilldownConfiguration:function(e){if(e){_[e]=null;}},_getModelerServicesAdapter:function(){return sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");},_getRuntimeServiceUrl:function(){return this._getModelerServicesAdapter().getRuntimeServiceUrl();},loadConfiguration:function(p,a){var e=this;var i=p.evaluationId;var j=!!p.cache;if(_[i]&&j){p.success.call(p.context||null,_[i]);}else{var o=null;var s=this._getRuntimeServiceUrl();s=l(s,p.sapSystem);var k=function(m){e.loadConfigurationBatch(m,a,p);};if(sap.suite.ui.smartbusiness.lib.Util.odata){o=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s,k);}else{o=new sap.ui.model.odata.ODataModel(s,{json:true,loadMetadataAsync:true});o.attachMetadataLoaded(function(){k(o)});}}},loadConfigurationBatch:function(o,a,p){var e=p.evaluationId;o.setTokenHandlingEnabled(this._getModelerServicesAdapter().isTokenHandlingEnabledForODataRead());var m="/DDA_MASTER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=CONFIG_ORDER";var i="/DDA_CONFIG?$filter="+b("EVALUATION_ID eq '"+e+"'");var j="/DDA_HEADER?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=VISUALIZATION_ORDER";var k="/DDA_FILTERS?$filter="+b("EVALUATION_ID eq '"+e+"'");var n="/DDA_COLUMNS?$filter="+b("EVALUATION_ID eq '"+e+"'")+"&$orderby=COLUMNS_ORDER";var q="/DDA_CHART?$filter="+b("EVALUATION_ID eq '"+e+"'");var r=o.createBatchOperation(m,"GET");var s=o.createBatchOperation(i,"GET");var u=o.createBatchOperation(j,"GET");var v=o.createBatchOperation(k,"GET");var w=o.createBatchOperation(n,"GET");var x=o.createBatchOperation(q,"GET");o.addBatchReadOperations([r,s,u,v,w,x]);var y=o.submitBatch(function(z,A){var B=z.__batchResponses;_[e]=B;p.success.call(p.context||null,B);},function(z){jQuery.sap.log.error("Failed to fetch DDA Configuration");if(p.error){p.error.call(p.context||null,z);}},true);a(y);return y;},setEvaluationsCache:function(p,a){var e=this;if(!p.evalIdArray){throw new Error("Evaluation Id Not Found")}var j=g(p);var m=null;var s=this._getModelerServicesAdapter().addSystemToServiceUrl(this._getRuntimeServiceUrl(),p.sapSystem);if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{m=new sap.ui.model.odata.ODataModel(s,true);}var k="";p.evalIdArray.forEach(function(i){var j=i;var q=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(j);if(!q)k+="ID eq '#EVALUATION_ID' or ".replace("#EVALUATION_ID",j);});if(k){k=k.slice(0,-4);var o={};o["$filter"]=k;o["$orderby"]="ID,NAME,OPERATOR,VALUE_1,VALUE_2";var n=m.read("/EVALUATIONS_CORE",null,o,true,function(q){if(q.results&&q.results.length){var r=h(q);for(var i=0;i<r.length;i++)sap.suite.ui.smartbusiness.lib.Util.cache.setEvaluationById(r[i].ID,r[i]);p.success.call(p.context||null);}else{jQuery.sap.log.error("Empty Evaluation returned");p.success.call(p.context||null);}},function(){jQuery.sap.log.error("Error fetching Evaluations");p.success.call(p.context||null);});return n;}else{p.success.call(p.context||null);return null;}},getEvaluationById:function(p){if(!p.id){throw new Error("Evaluation Id Not Found")}var a=g(p);if(p.cache){var e=sap.suite.ui.smartbusiness.lib.Util.cache.getEvaluationById(a);if(e){if(p.success){p.success.call(p.context||null,e);return null;}}}var m=null;var s=this._getModelerServicesAdapter().addSystemToServiceUrl(this._getRuntimeServiceUrl(),p.sapSystem);if(sap.suite.ui.smartbusiness.lib.Util.odata){m=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{m=new sap.ui.model.odata.ODataModel(s,true);}var i="ID eq '#EVALUATION_ID'".replace("#EVALUATION_ID",p.id);var j=null;var o={};o["$filter"]=i;var k="";if(p.filters){k+="FILTERS,";}if(p.thresholds){k+="VALUES,";}if(k){o["$expand"]=k.substring(0,k.length-1);}var n=m.read("/EVALUATIONS",null,o,true,function(q){if(q.results&&q.results.length){j=q.results[0];sap.suite.ui.smartbusiness.lib.Util.cache.setEvaluationById(a,j);p.success.call(p.context||null,j);}else{p.error.call(p.context||null,"Empty Results with EvaluationID : "+p.id);}},function(){jQuery.sap.log.error("Error fetching Evaluation : ",p.id);if(p.error){p.error.apply(p.context||null,arguments);}});return n;}};})();
