/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.declare("sap.suite.ui.smartbusiness.lib.DrilldownConfiguration");sap.suite.ui.smartbusiness.lib.DrilldownConfiguration=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration||{};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header=function(h){this.oHeader=h;};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header.prototype={getVisualizationType:function(){return this.oHeader.VISUALIZATION_TYPE;},getReferenceEvaluationId:function(){return this.oHeader.REFERENCE_EVALUATION_ID;},getConfigurationId:function(){return this.oHeader.CONFIGURATION_ID;},getEvaluationId:function(){return this.oHeader.EVALUATION_ID;},getVisualizationOrder:function(){return this.oHeader.VISUALIZATION_ORDER;},isVisible:function(){return this.oHeader.VISIBILITY==1;},getEvaluation:function(){var t=this;var D=this.oHeader.REFERENCE_EVALUATION_INFO;return{getTitle:function(){if(D&&D.TITLE){return D.TITLE;}else{return"";}},getSubtitle:function(){if(D&&D.INDICATOR_TITLE){return D.INDICATOR_TITLE;}else{return"";}}};},isAssociated:function(){if(this.getReferenceEvaluationId()){if(this.getReferenceEvaluationId()!==this.getEvaluationId()){return true;}}return false;},isDimensionRequired:function(){return this.getVisualizationType()=="TREND"||this.getVisualizationType()=="COMPARISION";},getDimension:function(){return this.oHeader.DIMENSION;},getMeasure:function(){return this.oHeader.MEASURE;},getVisibility:function(){return this.oHeader.VISIBILITY;},getConfiguration:function(){var d=[{name:"",color:"Good"},{name:"",color:"Critical"},{name:"",color:"Error"}];var a={order:"desc",by:"M",};var b=[{NAME:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];var c={MEASURES:d,SORTING:a,DIMENSION_COLOR:"Neutral",HARVEY_FILTERS:b,HARVEY_MEASURE:"",IS_HARVEY_FRACTION_KPIMEASURE:true};if(this.oHeader.CONFIGURATION){try{c=JSON.parse(this.oHeader.CONFIGURATION);c.MEASURES=c.MEASURES?JSON.parse(c.MEASURES):d;c.SORTING=c.SORTING?JSON.parse(c.SORTING):a;c.HARVEY_FILTERS=c.HARVEY_FILTERS?JSON.parse(c.HARVEY_FILTERS):b;c.HARVEY_MEASURE=c.HARVEY_MEASURE||"";c.IS_HARVEY_FRACTION_KPIMEASURE=(c.IS_HARVEY_FRACTION_KPIMEASURE===false)?false:true}catch(e){};}return c;}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart=function(c){this.oChart=c;};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart.prototype={getValueType:function(){return this.oChart.VALUE_TYPE;},getAxisType:function(){return this.oChart.AXIS_TYPE;},getThresholdMeasure:function(){return this.oChart.THRESHOLD_MEASURE;},getChartType:function(){var _=this;return{isBar:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BAR";},isColumn:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COLUMN";},isLine:function(){return _.oChart.CHART_TYPE.toUpperCase()=="LINE";},isCombinationChart:function(){return _.oChart.CHART_TYPE.toUpperCase()=="COMBINATION";},isTable:function(){return _.oChart.CHART_TYPE.toUpperCase()=="TABLE";},isBubble:function(){return _.oChart.CHART_TYPE.toUpperCase()=="BUBBLE";},getText:function(){return _.oChart.CHART_TYPE;}};},getColorScheme:function(){var t=this;return{getText:function(){return t.oChart.COLOR_SCHEME;},isManual:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"||t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualSemantic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_SEMANTIC";},isManualNonSematic:function(){return t.oChart.COLOR_SCHEME=="MANUAL_NON_SEMANTIC";},isAutoSemantic:function(){return t.oChart.COLOR_SCHEME=='AUTO_SEMANTIC';}};},getDataLimit:function(){return this.oChart.DATA_LIMIT;},isAbsoluteValue:function(){return this.getValueType()=="ABSOLUTE";},isPercentageValue:function(){return this.getValueType()=="PERCENTAGE";},isSingleAxis:function(){return this.getAxisType()=="SINGLE";},isDualAxis:function(){return this.getAxisType()=="DUAL";},isStackingEnabled:function(){return false;}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column=function(){};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column.prototype={getName:function(){return this.oParam.NAME;},getSortBy:function(){return this.oParam.SORT_BY;},getColumnOrder:function(){return this.oParam.COLUMNS_ORDER;},getSortOrder:function(){return this.oParam.SORT_ORDER;},getType:function(){return this.oParam.TYPE;},getVisibility:function(){return this.oParam.VISIBILITY;},isVisibleInChart:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="CHART";},isVisibleInTable:function(){return this.oParam.VISIBILITY=="BOTH"||this.oParam.VISIBILITY=="TABLE";},getColor:function(){return this.oParam.COLOR;},isStacked:function(){return this.oParam.STACKING==1;},getStacking:function(){return this.oParam.STACKING;},isDimension:function(){return this.getType().toUpperCase()=="DIMENSION";},isMeasure:function(){return this.getType().toUpperCase()=="MEASURE";},getAxis:function(){return this.oParam.AXIS;}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension=function(p){this.oParam=p;};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension.prototype=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column();
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure=function(p){this.oParam=p;};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure.prototype=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Column();
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter=function(p){this.oFilter=p;};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter.prototype={getName:function(){return this.oFilter.DIMENSION;},isVisible:function(){return this.oFilter.VISIBILITY==1;}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View=function(p){this._viewId=p.CONFIGURATION_ID;this._evaluationId=p.EVALUATION_ID;this._title=p.TEXT;this._order=p.CONFIG_ORDER;this._columns=[];this._dimensions=[];this._measures=[];this._filters=[];this._dimensionMap={};this._measureMap={};this._filterMap={};this._headers=[],this._chartConfig=[];this._additionalLanguageTitles=[];};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype={getTitle:function(){return this._title;},getId:function(){return this._viewId;},getEvaluationId:function(){return this._evaluationId;},getViewOrder:function(){return this._order;},getFilters:function(){return this._filters;},getColumns:function(){return this._columns;},getDimensions:function(){return this._dimensions;},getMeasures:function(){return this._measures;},findDimensionByName:function(d){if(this._dimensionMap[d]){return this._dimensionMap[d];}else{throw new Error("Invalid Dimension Name : "+d);}},findMeasureByName:function(m){if(this._measureMap[m]){return this._measureMap[m];}else{throw new Error("Invalid Dimension Name : "+m);}},findColumnByName:function(c){if(this._dimensionMap[c]){return this._dimensionMap[c];}else if(this._measureMap[c]){return this._measureMap[c];}else{throw new Error("Invalid Column Name : "+c);}},getHeaders:function(){return this._headers;},getChartConfiguration:function(){return this._chartConfig;},getAdditionalLanguageTitles:function(){return this._additionalLanguageTitles;}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setDimensionAndMeasures=function(c,t){c.forEach(function(v,i,a){if(v.CONFIGURATION_ID==this.getId()){this._columns.push(v.NAME);if(v.TYPE.toUpperCase()=="MEASURE"){this._measureMap[v.NAME]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Measure(v);this._measures.push(v.NAME);}else if(v.TYPE.toUpperCase()=="DIMENSION"){this._dimensionMap[v.NAME]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Dimension(v);this._dimensions.push(v.NAME);}}},t);};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setFilters=function(f,t){f.forEach(function(v,i,a){this._filters.push(v.DIMENSION);this._filterMap[v.DIMENSION]=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Filter(v);},t);};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setConfig=function(c,t){var S=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration.Constants;for(var e in S){var f=S[e].func;if(jQuery.sap.startsWith(f,"is")){sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return true;};}else{sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return null;};}}c.forEach(function(v,i,a){var b=S[v.PROPERTY_TYPE];if(b){var f=b.func;if(jQuery.sap.startsWith(f,"is")){sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return v.VISIBILITY==1;};}else{sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.prototype[f]=function(){return v.PROPERTY_VALUE;};}}else{jQuery.sap.log.error("Unknown Property_Name : "+v.PROPERTY_TYPE);}},t);};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setHeader=function(h,t){if(h.length){h.forEach(function(v,i,a){this.getHeaders().push(new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Header(v));},t);t.getHeaders().sort(function(o,a){if(o.VISUALIZATION_ORDER>a.VISUALIZTION_ORDER){return 1;}return-1;});}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setChart=function(c,t){if(c.length){c.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getChartConfiguration().push(new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Chart(v));}},t);}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setAdditionalLanguageTitles=function(m,t){if(m.length){m.forEach(function(v,i,a){if(this.getId()==v.CONFIGURATION_ID){this.getAdditionalLanguageTitles().push(v);}},t);}};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration=function(e,M){this.evaluationId=e;var d=null;this.MODE=!!M;var b={};var _=true;var c=jQuery.sap.getUriParameters().get("debug_ddaconfig")=="true";var f=-1;var g=function(m,C,H,F,o,k,l){m.forEach(function(v,i,a){var n=v.CONFIGURATION_ID;if(n){f++;var O=new sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View(v);b[n]=O;if(f==0){d=n;}sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setConfig(C,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setDimensionAndMeasures(o,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setFilters(F,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setHeader(H,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setChart(k,O);sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.View.setAdditionalLanguageTitles(l,O);_=false;}});};this.getMaxViewOrder=function(){var m=0;for(var v in b){m=Math.max(m,b[v].getViewOrder());}return m;};this.hasNoConfiguration=function(){return _;};this.findViewById=function(i){if(b[i]){return b[i];}return null;},this.getDefaultViewId=function(){return d;},this.getDefaultView=function(){if(d){return b[d];}return null;};this.removeViewById=function(v){delete b[v];};this.removeAllViews=function(v){b={};};this.getAllViews=function(){var v=[];for(var a in b){var t={};t["ID"]=a;t["TITLE"]=b[a].getTitle()||"-NA- ("+a+")";v.push(t);}return v;};this.getTree=function(){var t={name:"Evaluation",children:[]};var a=this.getAllViews();for(var i in a){var k={name:a[i].TITLE||"NA",children:[]};var v=this.findViewById(a[i].ID);var m=v.getMeasures();var l={name:"measures",children:[]};k.children.push(l);m.forEach(function(r,s,u){l.children.push({name:r,children:[]});},this);var n=v.getDimensions();var o={name:"dimensions",children:[]};k.children.push(o);n.forEach(function(r,s,u){o.children.push({name:r,children:[]});},this);var p=v.getHeaders();var q={name:"header",children:[]};k.children.push(q);p.forEach(function(i){var r={name:"1",children:[]};q.children.push(r);r.children.push({name:"Visualization Type = "+i.getVisualizationType(),children:[]});r.children.push({name:"Reference Evaluation = "+i.getReferenceEvaluationId(),children:[]});});t.children.push(k);}return t;};var h=function(u){return jQuery.sap.encodeURL(u);};var j=function(){var t=this;var D=null;var s="/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata";if(sap.suite.ui.smartbusiness.lib.Util.odata){D=sap.suite.ui.smartbusiness.lib.Util.odata.getModelByServiceUri(s);}else{D=new sap.ui.model.odata.ODataModel(s,true);}var m="/DDA_MASTER?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=CONFIG_ORDER";var a="/DDA_CONFIG?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var i="/DDA_HEADER?$expand=REFERENCE_EVALUATION_INFO&$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var k="/DDA_FILTERS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var l="/DDA_COLUMNS?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'")+"&$orderby=COLUMNS_ORDER";var n="/DDA_CHART?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var o="/DDA_MASTER_TEXT?$filter="+h("EVALUATION_ID eq '"+this.evaluationId+"'");var r=D.createBatchOperation(m,"GET");var p=D.createBatchOperation(a,"GET");var q=D.createBatchOperation(i,"GET");var u=D.createBatchOperation(k,"GET");var v=D.createBatchOperation(l,"GET");var w=D.createBatchOperation(n,"GET");var x=D.createBatchOperation(o,"GET");D.addBatchReadOperations([r,p,q,u,v,w,x]);D.submitBatch(function(y,z){var A=y.__batchResponses;if(c){jQuery.sap.log.info("DDA-MASTER : ",JSON.stringify(A[0]));jQuery.sap.log.info("DDA-CONFIG : ",JSON.stringify(A[1]));jQuery.sap.log.info("DDA-HEADER : ",JSON.stringify(A[2]));jQuery.sap.log.info("DDA-FILTERS : ",JSON.stringify(A[3]));jQuery.sap.log.info("DDA-COLUMNS : ",JSON.stringify(A[4]));jQuery.sap.log.info("DDA-CHART : ",JSON.stringify(A[5]));jQuery.sap.log.info("DDA-MASTER-TEXT : ",JSON.stringify(A[6]));}sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData={};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER=A[0].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.CONFIG=A[1].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER=A[2].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.FILTERS=A[3].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.COLUMNS=A[4].data.results;sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.CHART=A[5].data.results;g.call(t,A[0].data.results,A[1].data.results,A[2].data.results,A[3].data.results,A[4].data.results,A[5].data.results,A[6].data.results);},function(y){throw new Error("Failed to fetch DDA Configuration");},false);};j.call(this);};
sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.Configuration.Constants={SAP_FILTER:{desc:"Flag whether filter is enabled",func:"isFilterEnabled"},SAP_HEADER:{desc:"Flag whether header is enabled",func:"isHeaderEnabled"},SAP_AGGREGATE_VALUE:{desc:"Flag whether aggregate kpi value is enabled",func:"isAggregateValueEnabled"},QUERY_SERVICE_URI:{desc:"Evaluation Query Service Uri",func:"getQueryServiceUri"},QUERY_ENTITY_SET:{desc:"Result path for the query service uri",func:"getEntitySet"}};sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.writeservices=(function(){var _=null;return{getInstance:function(f){jQuery.sap.require("sap.suite.ui.smartbusiness.lib.DrilldownWriteService");if(_&&!f){return _;}else{_=new sap.suite.ui.smartbusiness.lib.DrilldownWriteService();}return _;}}})();
