/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.IDGenerator");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Util");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/evaluation/view/evaluationParameters.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.evaluation.view.S1",{onAfterRendering:function(){var t=this;t.initialModel=t._cloneObj(t.getView().getModel().getData());if(t.showDataSourceError){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;}if(t.inputParameterSapClientCheckBox){t.inputParameterSapClientCheckBox.fireSelect();}if(t.mandatoryFilterSapClientCheckBox){t.mandatoryFilterSapClientCheckBox.fireSelect();}t.byId("scaleFactorSelect").setTooltip(t.byId("scaleFactorSelect").getSelectedItem().getText());t.byId("decimalPrecisionSelect").setTooltip(t.byId("decimalPrecisionSelect").getSelectedItem().getText());},navigateBack:function(){var t=this;var a;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("NAVIGATION_DATA_LOSS")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){b.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close();}})});var u=false;if(t.getView().getModel().getData().mode==="create"){var c={};c.oldPayload=t.getEvalParamPayload(t.initialModel);c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.objectType="Evaluations";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true;}}else{var t=this,i=0;var c={};t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());c.oldPayload=t.getEvalParamPayload(t.evalDetails);c.oldPayload.DATA_SPECIFICATION="";a=c.oldPayload.IS_ACTIVE;c.oldPayload.IS_ACTIVE=0;c.newPayload=t.getEvalParamPayload(t.getView().getModel().getData());c.newPayload.DATA_SPECIFICATION="";c.objectType="Evaluations";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.FILTERS;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.evalFiltersPayload;c.objectType="EVALUATION_FILTERS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}for(i=0;i<t.evalDetails.VALUES.length;i++){if(t.evalDetails.VALUES[i].COLUMN_NAME){delete t.evalDetails.VALUES[i].FIXED;}else{delete t.evalDetails.VALUES[i].COLUMN_NAME;}}c.oldPayload=t.evalDetails.VALUES;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.valuesPayload;c.objectType="EVALUATION_VALUES";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.TAGS;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.tagsPayload;c.objectType="TAGS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.PROPERTIES;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.propPayload;c.objectType="PROPERTIES";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}c.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;for(var k in c.oldPayload){c.oldPayload[k].IS_ACTIVE=0;}c.newPayload=t.languagesPayload;c.objectType="EVALUATION_TEXTS";c=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(c);if(c.deletes.length>0){u=true;}if(c.updates.length>0){u=true;}}if(u){b.open();}else{window.history.back();}},onInit:function(){var t=this;t.hasSapClient=false;t.userSessionClient="";this.showDataSourceError=false;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");sap.suite.ui.smartbusiness.sb_createevaluation=this;this.RESERVED_EVAL_ID_NAMESPACE=".sap.sample";this.errorMessages=[];this.errorState=false;this.CDS="cds";this.HANA="hana";this.VIEW_MODE=this.HANA;var u;var c="/sap/hba/r/sb/core/logic/GetSessionClient.xsjs";jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("evalId"),controllerReference:this,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateEvalId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");if(u=jQuery.sap.getUriParameters().get("viewmode")){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}t.fromHome=false;this.oOptionsForCreate={onBack:function(){t.navigateBack();},bSuppressBookmarkButton:{},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(a){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_CONFIGURE",onBtnPressed:function(a){t.activateAndAddTiles();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsForEdit={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},buttonList:[{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(a){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsOnErrorForCreate={onBack:function(){t.navigateBack();},bSuppressBookmarkButton:{},oNegativeAction:{sIcon:"sap-icon://alert",sId:"errorBtn",sControlId:"errorBtn",onBtnPressed:function(a){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(a,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(a){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_CONFIGURE",onBtnPressed:function(a){t.activateAndAddTiles();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.oOptionsOnErrorForEdit={bSuppressBookmarkButton:{},onBack:function(){t.navigateBack();},oNegativeAction:{sIcon:"sap-icon://alert",sId:"errorBtn",sControlId:"errorBtn",onBtnPressed:function(a){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(a,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(a){t.saveAndExit();}},{sI18nBtnTxt:"SAVE_AND_ACTIVATE",onBtnPressed:function(a){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE",onBtnPressed:function(a){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(a){t.navigateBack();}}]};this.setHeaderFooterOptions(t.oOptionsForCreate);this.busyDialog=new sap.m.BusyDialog();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var m=new sap.ui.model.json.JSONModel({NO_OF_ADDITIONAL_LANGUAGES:0,VIEW_MODE:this.VIEW_MODE});this.getView().setModel(m);this.oDataModel=this.oApplicationFacade.getODataModel();if(t.VIEW_MODE!="cds"){$.ajax({url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters(c),async:false,success:function(d){t.userSessionClient=d.sessionClient;},error:function(j,a,b){if(j.status==404){t.sessionClientXsjsMissing=true;}else{t.sessionClientFetchError=true;t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}});}if(this.VIEW_MODE==this.CDS){this.oDataModelCDS=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SSB/CDS_ODATA_ENTITY_FETCH_SRV_01");this.oDataModelCDS.attachMetadataFailed(function(s){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_CDS_MODE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_MODE")});t.errorState=true;});this.byId("evalId").setMaxLength(40);}else if(this.VIEW_MODE==this.HANA){this.byId("evalId").setMaxLength(512);}this.editDraft=false;this.oModelForInputParameters=new sap.ui.model.json.JSONModel();this.oModelForDimensions=new sap.ui.model.json.JSONModel();var e=this.evalContext||"";t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(d){t.removeProperty(d);}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");;});var l=function(o,a,b){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=a;t.localLanguage=b;};this.metadataRef.getAllLanguages({async:false,success:l,model:this.oDataModel});this.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);this.setInputParameterAndFilterLayout();this.decideMode();this.valid_maxlength={};this.valid_maxlength.hana={id:512,title:128,};this.valid_maxlength.cds={id:40,title:40,};},decideMode:function(){var t=this;this.oRouter.attachRouteMatched(function(a){this.showDataSourceError=false;this.getView().getModel().setProperty("/SCALING","0");if(a.getParameter("name")==="duplicateEvaluation"){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","create");t.generateEvalId(t);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_DUPLICATE"));t.byId("evalId").setEditable(true);t.populateEvalDetails();t.duplicateEval=true;t.fromHome=false;}else if(a.getParameter("name")==="editEvaluationDraft"){t.setHeaderFooterOptions(t.oOptionsForEdit);try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");this.editDraft=true;t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));t.byId("evalId").setEditable(false);t.fromHome=false;}else if(a.getParameter("arguments").indicatorContext&&a.getParameter("arguments").evaluationContext){try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"))}this.evalContext=a.getParameter("arguments").evaluationContext;this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/mode","edit");t.populateEvalDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE_EDIT"));t.byId("evalId").setEditable(false);t.fromHome=false;}else if(a.getParameter("arguments").indicatorContext){t.getView().getModel().setProperty("/mode","create");t.generateEvalId(t);t.busyDialog.open();this.indicatorContext=a.getParameter("arguments").indicatorContext;t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/DECIMAL_PRECISION",-1);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));t.byId("indicatorId").setEditable(false);t.fromHome=false;}else{t.byId("selectKpi").setText(t.oResourceBundle.getText("SELECT_KPI_OPI"));t.generateEvalId(t);t.getView().getModel().setProperty("/mode","create");t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/DECIMAL_PRECISION",-1);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));t.fromHome=true;}},this);},populateEvalDetails:function(){var t=this;t.busyDialog.open();var a=function(k){k=k.INDICATOR;t.getView().getModel().setProperty("/INDICATOR",k.ID);t.byId("indicatorId").setEditable(false);t.getView().getModel().setProperty("/INDICATORTITLE",k.TITLE);t.getView().getModel().setProperty("/GOAL_TYPE",k.GOAL_TYPE);if(k.DATA_SPECIFICATION){t.getView().getModel().setProperty("/DATA_SPECIFICATION",k.DATA_SPECIFICATION);t.byId("additionalInfo").setVisible(true);}else{t.byId("additionalInfo").setVisible(false);}t.getView().getModel().setProperty("/INDICATOR_TYPE",k.TYPE);};var b=function(d,s,x){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;};var c=new sap.ui.model.Context(t.getView().getModel(),'/'+t.indicatorContext);t.metadataRef.getKPIById({context:c,success:a,error:b,async:false,model:t.oDataModel});var f=function(d,s,x){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVALUATION_DOES_NOT_EXIST")});t.errorState=true;};var g=function(d){var l=d.EVALUATION;t.evalDetails={};t.evalDetails=jQuery.extend(true,l,d);delete t.evalDetails.EVALUATION;t.getView().getModel().setProperty("/ID",l.ID);t.getView().getModel().setProperty("/TITLE",l.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",l.DESCRIPTION);t.getView().getModel().setProperty("/IS_ACTIVE",0);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",l.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",l.ACTION);if(l.GOAL_TYPE){t.getView().getModel().setProperty("/GOAL_TYPE",l.GOAL_TYPE);}t.getView().getModel().setProperty("/INDICATOR_TYPE",l.INDICATOR_TYPE);t.getView().getModel().setProperty("/OWNER_NAME",l.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",l.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",l.OWNER_E_MAIL);t.getView().getModel().setProperty("/VIEW_NAME",l.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",l.ODATA_URL);t.getView().getModel().setProperty("/COLUMN_NAME",l.COLUMN_NAME);t.getView().getModel().setProperty("/SCALING",l.SCALING);t.getView().getModel().setProperty("/DECIMAL_PRECISION",l.DECIMAL_PRECISION);t.getView().getModel().setProperty("/VALUES_SOURCE",l.VALUES_SOURCE);t.createTargetThresholdLayout();if(l.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",l.ODATA_ENTITYSET);try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){t.showDataSourceError=true;t.resetDimensionsAndInputParameters();}}t.getView().getModel().updateBindings();languageData=d.TEXTS||[];var m=[];t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY=[];for(i=0;i<languageData.length;i++){var n={};n.TITLE=languageData[i].TITLE;n.DESCRIPTION=languageData[i].DESCRIPTION;t.oDataModel.read("/LANGUAGE?$filter=SPRAS eq '"+languageData[i].LANGUAGE+"'",null,null,false,function(z){n.LANGUAGE_KEY=z.results[0].SPRAS;n.LANGUAGE=z.results[0].LAISO;n.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;n.ID=t.getView().getModel().getData().ID;});if(n.LANGUAGE_KEY!=t.localLanguage){m.push(n);}}t.getView().getModel().setProperty("/ADDITIONAL_LANGUAGE_ARRAY",m);t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",m.length);for(var i=0;i<m.length;i++){var o={};o.ID=m[i].ID;o.IS_ACTIVE=m[i].IS_ACTIVE;o.LANGUAGE=m[i].LANGUAGE_KEY;o.TITLE=m[i].TITLE;o.DESCRIPTION=m[i].DESCRIPTION;t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY.push(o);}t.evalDetails.NO_OF_ADDITIONAL_LANGUAGES=m.length;var p=d.TAGS||[];if(p.length>0){var q="";for(var i=0;i<p.length;i++){q+=p[i].TAG+",";}q=q.substring(0,q.length-1);t.getView().getModel().setProperty("/TAG",q);}var r=d.FILTERS||[];if(r.length){var s=[],u=[],j=0,k=0;for(var i=0;i<r.length;i++){if(r[i].TYPE==="PA"){s[j]={};s[j++]=r[i];}else if(r[i].TYPE==="FI"){u[k]={};u[k++]=r[i];}}if(s.length>0){var v={};v.inputParameters=[];v.inputParameters=t.formObjectForFilters(s);if(t.oModelForInputParameters.getData().inputParameters&&t.oModelForInputParameters.getData().inputParameters.length){for(var i=0;i<t.oModelForInputParameters.getData().inputParameters.length;i++){for(var j=0;j<v.inputParameters.length;j++){if(t.oModelForInputParameters.getData().inputParameters[i].name===v.inputParameters[j].name){t.oModelForInputParameters.getData().inputParameters[i].value_1=v.inputParameters[j].value_1;t.oModelForInputParameters.getData().inputParameters[i].value_2=v.inputParameters[j].value_2;}}}t.oModelForInputParameters.updateBindings();}}if(u.length>0){var w={};w.selectedDimensions=[];w.selectedDimensions=t.formObjectForFilters(u);t.oModelForDimensions.getData().selectedDimensions=w.selectedDimensions;t.oModelForDimensions.updateBindings();}}var x=d.PROPERTIES||[];if(x.length>0){t.getView().getModel().setProperty("/PROPERTIES",x);t.getView().getModel().updateBindings();}var y=d.VALUES||[];if(y.length>0){for(i=0;i<y.length;i++){if(y[i].FIXED){t.populateTargetAndTresholds(y[i].TYPE,y[i].FIXED);}else{t.populateTargetAndTresholds(y[i].TYPE,y[i].COLUMN_NAME);}}}t.busyDialog.close();};var h=new sap.ui.model.Context(t.getView().getModel(),'/'+t.evalContext);t.metadataRef.getEvaluationById({context:h,success:g,error:f,async:false,filters:true,values:true,properties:true,tags:true,texts:true,model:t.oDataModel});},populateAdditionalMeasures:function(t,v){var a=this;var m=a.getView().byId("additionalMeasures");m.addToken(new sap.m.Token({text:v}));a.getView().byId("additionalMeasures").setVisible(true);a.getView().byId("additionalMeasureLabel").setVisible(true);a.getView().byId("selectedLabel").setVisible(true);a.getView().byId("selectedadditionalMeasures").setVisible(true);a.selectedMeasure();},populateTargetAndTresholds:function(t,v){var a=this;switch(t){case"CL":a.getView().getModel().setProperty("/CRITICALLOW",v);break;case"WL":a.getView().getModel().setProperty("/WARNINGLOW",v);break;case"TA":a.getView().getModel().setProperty("/TARGET",v);break;case"CH":a.getView().getModel().setProperty("/CRITICALHIGH",v);break;case"WH":a.getView().getModel().setProperty("/WARNINGHIGH",v);break;case"TC":a.getView().getModel().setProperty("/TREND",v);break;case"RE":a.getView().getModel().setProperty("/REFERENCE_VALUE",v);break;default:a.populateAdditionalMeasures(t,v);}},formObjectForFilters:function(a){var i=0,j=0,k=0,l=0,t=[],b;var d=this.evalDetails.ODATA_URL;var e=this.evalDetails.ODATA_ENTITYSET;var q=sap.suite.ui.smartbusiness.lib.OData.filter(d,e).getAsObject();var c=null;var r=false;var f=null;for(i=0;i<a.length;i++){r=false;f=null;if(q&&q[a[i].NAME]&&q[a[i].NAME].getKeyProperty()&&q[a[i].NAME].getKeyProperty().extensions){c=q[a[i].NAME].getKeyProperty().extensions;for(l=0;l<c.length;l++){if(c[l].name=="required-in-filter"&&c[l].value=="true"){r=true;}if(c[l].name=="filter-restriction"){f=c[l].value;}}}if(a[i].OPERATOR=="BT"){b={};b={"name":a[i].NAME,"operator":a[i].OPERATOR,"value_1":a[i].VALUE_1,"value_2":a[i].VALUE_2};b.required=r;b.filterRestriction=f;t[j++]=b;}else{for(k=0;k<t.length;k++){if((t[k].name==a[i].NAME)&&(t[k].operator==a[i].OPERATOR)){break;}}if(k==t.length){b={};b={"name":a[i].NAME,"operator":a[i].OPERATOR,"value_1":a[i].VALUE_1,"value_2":a[i].VALUE_2};b.required=r;b.filterRestriction=f;t[j++]=b;}else{t[k].value_1+=","+a[i].VALUE_1;}}}return t;},getKpiDetails:function(){var t=this;if(!t.indicatorContext){t.busyDialog.close();t.indicatorContext="INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)"}var a=new sap.ui.model.Context(t.getView().getModel(),'/'+t.indicatorContext);var b=function(d){var f=d.INDICATOR;if(f.IS_ACTIVE==0){sap.m.MessageToast.show(t.oResourceBundle.getText("ERROR_INACTIVE_KPI_CANNOT_HAVE_EVALUATION"));window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=0)";return;}t.getView().byId("indicatorId").setValueState("None");t.getView().getModel().setProperty("/INDICATOR",f.ID);t.getView().getModel().setProperty("/INDICATORTITLE",f.TITLE);t.getView().getModel().setProperty("/DESCRIPTION",f.DESCRIPTION);t.getView().getModel().setProperty("/OWNER_NAME",f.OWNER_NAME);t.getView().getModel().setProperty("/OWNER_ID",f.OWNER_ID);t.getView().getModel().setProperty("/OWNER_E_MAIL",f.OWNER_E_MAIL);t.getView().getModel().setProperty("/SEMANTIC_OBJECT",f.SEMANTIC_OBJECT);t.getView().getModel().setProperty("/ACTION",f.ACTION);t.getView().getModel().setProperty("/INDICATOR_TYPE",f.TYPE);t.getView().getModel().setProperty("/VIEW_NAME",f.VIEW_NAME);t.getView().getModel().setProperty("/ODATA_URL",f.ODATA_URL);t.getView().getModel().setProperty("/COLUMN_NAME",f.COLUMN_NAME);t.getView().getModel().setProperty("/GOAL_TYPE",f.GOAL_TYPE);t.getView().getModel().setProperty("/DATA_SPECIFICATION",f.DATA_SPECIFICATION);if(f.DATA_SPECIFICATION!=""){t.byId("additionalInfo").setVisible(true);}else{t.byId("additionalInfo").setVisible(false);}t.createTargetThresholdLayout();if(f.ODATA_ENTITYSET){t.getView().getModel().setProperty("/ODATA_ENTITYSET",f.ODATA_ENTITYSET);t.resetDimensionsAndInputParameters();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));if(t.inputParameterSapClientCheckBox){t.inputParameterSapClientCheckBox.fireSelect();}}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}}var g=d.TAGS||[];if(g.length>0){var h="";for(var i=0;i<g.length;i++){h+=g[i].TAG+",";}h=h.substring(0,h.length-1);t.getView().getModel().setProperty("/TAG",h);}var p=d.PROPERTIES||[];if(p.length>0){t.getView().getModel().setProperty("/PROPERTIES",p);t.getView().getModel().updateBindings();}t.busyDialog.close();};var c=function(d,s,k){t.busyDialog.close();t.getView().byId("indicatorId").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;};t.metadataRef.getKPIById({context:a,async:false,texts:true,tags:true,properties:true,success:b,error:c,model:t.oDataModel});},getEvalParamPayload:function(f){var e={};e.ID=f.ID;e.DESCRIPTION=f.DESCRIPTION;e.INDICATOR=f.INDICATOR;e.ODATA_URL=f.ODATA_URL;e.VIEW_NAME=f.VIEW_NAME;e.COLUMN_NAME=f.COLUMN_NAME;e.OWNER_NAME=f.OWNER_NAME;e.OWNER_E_MAIL=f.OWNER_E_MAIL;e.OWNER_ID=f.OWNER_ID;e.CREATED_BY="";e.CHANGED_BY="";e.IS_ACTIVE=f.IS_ACTIVE;e.SCALING=parseInt(f.SCALING)||0;e.TITLE=f.TITLE;e.ENTITY_TYPE="";e.ODATA_ENTITYSET=f.ODATA_ENTITYSET;e.ODATA_PROPERTY="";e.SEMANTIC_OBJECT=f.SEMANTIC_OBJECT;e.ACTION=f.ACTION;e.DATA_SPECIFICATION=f.DATA_SPECIFICATION;e.GOAL_TYPE=f.GOAL_TYPE;e.INDICATOR_TYPE=f.INDICATOR_TYPE;e.VALUES_SOURCE=f.VALUES_SOURCE;e.DECIMAL_PRECISION=parseInt(f.DECIMAL_PRECISION)||0;return e;},setFilterPayload:function(i,t,n,o,v,a){var b={};b.ID=i;b.IS_ACTIVE=this.getView().getModel().getData().IS_ACTIVE;b.TYPE=t;b.NAME=n;b.OPERATOR=o;b.VALUE_1=v;if(a)b.VALUE_2=a;else b.VALUE_2="";return b;},getInputParamPayload:function(f){var e={},j=0;var a=f.getModel().getData();if(f.getController().oModelForInputParameters){e=f.getController().oModelForInputParameters.getData();if(e.inputParameters){if(e.inputParameters.length>0){var i=0,b=[],c;while(i<e.inputParameters.length){if(e.inputParameters[i].operator==="BT"){if((e[i].value_1!=="")||(e[i].value_2!=="")){b=e.inputParameters[i].value_1.split(",");c=e.inputParameters[i].value_2.split(",");if((c.length===1)&&(!b.length===1)){e.inputParameters[i].value_1=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_1).toJSON():e.inputParameters[i].value_1;e.inputParameters[i].value_2=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(e.inputParameters[i].value_2).toJSON():e.inputParameters[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,e.inputParameters[i].value_1,e.inputParameters[i].value_2);j++;}}}else{b=e.inputParameters[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!==""){b[k]=(e.inputParameters[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"PA",e.inputParameters[i].name,e.inputParameters[i].operator,b[k]);j++;}}}}i++;}}}}},getFiltersPayload:function(f){var a=f.getModel().getData();var e={},j=this.evalFiltersPayload.length;if(f.getController().oModelForDimensions){e=f.getController().oModelForDimensions.getData();if(e.selectedDimensions){if(e.selectedDimensions.length>0){var i=0,b=[],c;while(i<e.selectedDimensions.length){if(e.selectedDimensions[i].operator==="BT"){if((e.selectedDimensions[i].value_1!=="")&&(e.selectedDimensions[i].value_2!=="")){b=e.selectedDimensions[i].value_1.split(",");c=e.selectedDimensions[i].value_2.split(",");if((c.length===1)||(!b.length===1)){e.selectedDimensions[i].value_1=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_1).toJSON():e.selectedDimensions[i].value_1;e.selectedDimensions[i].value_2=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(e.selectedDimensions[i].value_2).toJSON():e.selectedDimensions[i].value_2;this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,e.selectedDimensions[i].value_1,e.selectedDimensions[i].value_2);j++;}}}else{b=e.selectedDimensions[i].value_1.split(",");if(b.length>0){for(var k=0;k<b.length;k++){if(b[k]!=""){b[k]=(e.selectedDimensions[i].propertyType=="Edm.DateTime")?new Date(b[k]).toJSON():b[k];this.evalFiltersPayload[j]={};this.evalFiltersPayload[j]=this.setFilterPayload(a.ID,"FI",e.selectedDimensions[i].name,e.selectedDimensions[i].operator,b[k]);j++;}}}}i++;}}}}},getThresholdValue:function(i,t,s,v){var o={};o.ID=i;o.TYPE=t;o.IS_ACTIVE=s;var f=this.getView();var a=f.getModel().getData();var b=a.VALUES_SOURCE;if(b==="MEASURE"){o.COLUMN_NAME=v;}if(b==="FIXED"){o.FIXED=v;}if(b==="RELATIVE"){if(t=="TA"||t=="TC"||t=="RE"){o.COLUMN_NAME=v;}else{o.FIXED=v;}}o.ODATA_PROPERTY="";return o;},getRangePayload:function(f){var a=f.getModel().getData();var i=0;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++;}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++;}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++;}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++;}},getMaximizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}if(a.CRITICALLOW&&a.CRITICALLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CL",a.IS_ACTIVE,a.CRITICALLOW);i++;}if(a.WARNINGLOW&&a.WARNINGLOW!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WL",a.IS_ACTIVE,a.WARNINGLOW);i++;}},getMinimizingPayload:function(f){var a=f.getModel().getData();var i=this.valuesPayload.length;if(a.CRITICALHIGH&&a.CRITICALHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"CH",a.IS_ACTIVE,a.CRITICALHIGH);i++;}if(a.WARNINGHIGH&&a.WARNINGHIGH!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"WH",a.IS_ACTIVE,a.WARNINGHIGH);i++;}if(a.TARGET&&a.TARGET!==""){this.valuesPayload[i]=this.getThresholdValue(a.ID,"TA",a.IS_ACTIVE,a.TARGET);i++;}},saveFilters:function(f){this.evalFiltersPayload=[];this.getInputParamPayload(f);this.getFiltersPayload(f);},saveValues:function(f){var t=this;this.valuesPayload=[];var a=f.getModel().getData();switch(a.GOAL_TYPE){case"RA":t.getRangePayload(f);break;case"MA":t.getMaximizingPayload(f);break;case"MI":t.getMinimizingPayload(f);break;}if(a.TREND&&a.TREND!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"TC",a.IS_ACTIVE,a.TREND);i++;}if(a.REFERENCE_VALUE&&a.REFERENCE_VALUE!==""){var i=this.valuesPayload.length;this.valuesPayload[i]=this.getThresholdValue(a.ID,"RE",a.IS_ACTIVE,a.REFERENCE_VALUE);i++;}if(t.getView().byId("additionalMeasures").getTokens().length){var b=t.getView().byId("additionalMeasures").getTokens();for(var i=0,j=this.valuesPayload.length;i<b.length;i++){var c="0";if(i.toString().length===1){c="0"+i;}else{c=i.toString();}this.valuesPayload[j++]={ID:a.ID,IS_ACTIVE:a.IS_ACTIVE,TYPE:c,COLUMN_NAME:b[i].getText(),ODATA_PROPERTY:""}}}},saveTags:function(f){var a=f.getModel().getData();this.tagsPayload=[];if(a.TAG){var t=[];t=a.TAG.split(",");for(var i=0;i<t.length;i++){this.tagsPayload[i]={};this.tagsPayload[i].ID=a.ID;this.tagsPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.tagsPayload[i].TYPE="EV";this.tagsPayload[i].TAG=t[i];}}},saveProperties:function(f){var a=f.getModel().getData();this.propPayload=[];if(a.PROPERTIES){for(var i=0;i<a.PROPERTIES.length;i++){this.propPayload[i]={};this.propPayload[i].ID=a.ID;this.propPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.propPayload[i].TYPE="EV";this.propPayload[i].NAME=a.PROPERTIES[i].NAME;this.propPayload[i].VALUE=a.PROPERTIES[i].VALUE;}}},saveAdditionalLanguages:function(f){var t=this;var a=f.getModel().getData();this.languagesPayload=[];if(a.NO_OF_ADDITIONAL_LANGUAGES>0){var i=0,j=0,k=0,b;for(i=0;i<a.ADDITIONAL_LANGUAGE_ARRAY.length;i++){this.languagesPayload[i]={};this.languagesPayload[i].ID=a.ID;this.languagesPayload[i].IS_ACTIVE=a.IS_ACTIVE;this.languagesPayload[i].LANGUAGE=a.ADDITIONAL_LANGUAGE_ARRAY[i].LANGUAGE_KEY;this.languagesPayload[i].TITLE=a.ADDITIONAL_LANGUAGE_ARRAY[i].TITLE;this.languagesPayload[i].DESCRIPTION=a.ADDITIONAL_LANGUAGE_ARRAY[i].DESCRIPTION;}}},createBatchForEvalCreateMode:function(e){var t=this;t.evalPayload={};t.evalPayload.ID=t.evalParamPayload.ID;t.evalPayload.IS_ACTIVE=t.evalParamPayload.IS_ACTIVE;t.evalPayload.EVALUATION=t.evalParamPayload;delete t.evalPayload.EVALUATION.ID;delete t.evalPayload.EVALUATION.IS_ACTIVE;t.evalPayload.FILTERS=[];t.evalPayload.FILTERS=t.evalFiltersPayload;for(var i=0;i<t.evalPayload.FILTERS.length;i++){delete t.evalPayload.FILTERS[i].ID;delete t.evalPayload.FILTERS[i].IS_ACTIVE;}t.evalPayload.VALUES=[];t.evalPayload.VALUES=t.valuesPayload;for(var i=0;i<t.evalPayload.VALUES.length;i++){delete t.evalPayload.VALUES[i].ID;delete t.evalPayload.VALUES[i].IS_ACTIVE;}t.evalPayload.TAGS=[];t.evalPayload.TAGS=t.tagsPayload;for(var i=0;i<t.evalPayload.TAGS.length;i++){delete t.evalPayload.TAGS[i].ID;delete t.evalPayload.TAGS[i].IS_ACTIVE;}t.evalPayload.PROPERTIES=[];t.evalPayload.PROPERTIES=t.propPayload;for(var i=0;i<t.evalPayload.PROPERTIES.length;i++){delete t.evalPayload.PROPERTIES[i].ID;delete t.evalPayload.PROPERTIES[i].IS_ACTIVE;}t.evalPayload.TEXTS=[];t.evalPayload.TEXTS=t.languagesPayload;for(var i=0;i<t.evalPayload.TEXTS.length;i++){delete t.evalPayload.TEXTS[i].ID;delete t.evalPayload.TEXTS[i].IS_ACTIVE;}var a={payload:t.evalPayload};a.keys={};a.keys.ID=t.evalPayload.ID;a.keys.IS_ACTIVE=t.evalPayload.IS_ACTIVE;delete a.ID;delete a.IS_ACTIVE;var u="EVALUATION";t.metadataRef.create(u,a,null,function(d){t.saveSuccessHandling(e);},function(b){t.saveErrorHandling(b);});},createBatchPayload:function(e){var t=this,i=0;var p,u=false;var a={};var b={};var f=t.getView().getModel().getData();a.ID=f.ID;a.IS_ACTIVE=f.IS_ACTIVE;b.oldPayload=t.getEvalParamPayload(t.evalDetails);b.newPayload=t.evalParamPayload;b.objectType="Evaluations";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);if(b.updates.length>0){a.EVALUATION={};a.EVALUATION.update={};a.EVALUATION.update=t.evalParamPayload;delete a.EVALUATION.update.ID;delete a.EVALUATION.update.IS_ACTIVE;u=true;}b.oldPayload=t.evalDetails.FILTERS;b.newPayload=t.evalFiltersPayload;b.objectType="EVALUATION_FILTERS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.FILTERS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.FILTERS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.FILTERS.create=b.updates;u=true;}for(i=0;i<t.evalDetails.VALUES.length;i++){if(t.evalDetails.VALUES[i].COLUMN_NAME){delete t.evalDetails.VALUES[i].FIXED;}else{delete t.evalDetails.VALUES[i].COLUMN_NAME;}}b.oldPayload=t.evalDetails.VALUES;b.newPayload=t.valuesPayload;b.objectType="EVALUATION_VALUES";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.VALUES={};if(b.deletes.length>0){for(var i=0;i<b.deletes;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.VALUES.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.VALUES.create=b.updates;u=true;}b.oldPayload=t.evalDetails.TAGS;b.newPayload=t.tagsPayload;b.objectType="TAGS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.TAGS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.TAGS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.TAGS.create=b.updates;u=true;}b.oldPayload=t.evalDetails.PROPERTIES;b.newPayload=t.propPayload;b.objectType="PROPERTIES";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.PROPERTIES={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.PROPERTIES.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.PROPERTIES.create=b.updates;u=true;}b.oldPayload=t.evalDetails.ADDITIONAL_LANGUAGE_ARRAY;b.newPayload=t.languagesPayload;b.objectType="EVALUATION_TEXTS";b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(b);a.TEXTS={};if(b.deletes.length>0){for(i=0;i<b.deletes.length;i++){delete b.deletes[i].ID;delete b.deletes[i].IS_ACTIVE;}a.TEXTS.remove=b.deletes;u=true;}if(b.updates.length>0){for(var i=0;i<b.updates.length;i++){delete b.updates[i].ID;delete b.updates[i].IS_ACTIVE;}a.TEXTS.create=b.updates;u=true;}if(!u){t.busyDialog.close();t.saveSuccessHandling(e);return;}else{var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;var d="EVALUATION";t.metadataRef.update(d,c,null,function(g){t.saveSuccessHandling(e);},function(g){t.saveErrorHandling(g);});}},saveErrorHandling:function(e){var t=this;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVAL_SAVE")});t.errorState=true;t.busyDialog.close();},saveSuccessHandling:function(e){var t=this;sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_SAVE"));if(e==="activate"||e==="saveActivate"||e==="activateAndCreateNew"){var o={};o.ID=t.getView().getModel().getData().ID;var u="ACTIVATE_EVALUATION";t.metadataRef.create(u,o,null,function(d){t.busyDialog.close();sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_EVAL_ACTIVATE"));if(e==="activate"){window.location.hash="FioriApplication-configureSBKPITile?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(e==="saveActivate"&&!t.fromHome){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(e==="activateAndCreateNew"){t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext;}else if(t.fromHome){window.location.hash="";}},function(a){t.busyDialog.close();sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ACTIVATING_EVALUATION")});t.errorState=true;});}else if(e=="create"){t.busyDialog.close();if(t.fromHome){window.location.hash="";}else{if(this.editDraft){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)";}else if(t.duplicateEval){window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)";}else if(t.evalDetails){var i=t.evalDetails.IS_ACTIVE;window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE="+i+")";}else{window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/evalDetail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)/EVALUATIONS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=0)";}}}else if(e=="createNew"){t.busyDialog.close();t.byId("evalId").setEditable(true);t.getView().getModel().setData({});t.getView().getModel().setProperty("/NO_OF_ADDITIONAL_LANGUAGES",0);t.getKpiDetails();window.location.hash="FioriApplication-createSBKPIEvaluation&/addEvaluation/"+t.indicatorContext;}t.busyDialog.close();},setFooterOnError:function(){if(this.editDraft===true){if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oOptionsOnErrorForEdit);}else{this.setHeaderFooterOptions(this.oOptionsForEdit);}}else{if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oOptionsOnErrorForCreate);}else{this.setHeaderFooterOptions(this.oOptionsForCreate);}}},saveAndExit:function(e){var t=this;t.createBatch=[];t.deleteBatch=[];this.errorMessages=[];this.errorState=false;var a=false;var f=t.getView().getModel().getData();var d={errorMsg:[]};if(this.VIEW_MODE==="hana"){t.byId("odataServiceInput").setValueState("None");}else{t.byId("odataServiceInputCDS").setValueState("None");}t.byId("entitySetInput").setValueState("None");t.byId("valueMeasureInput").setValueState("None");if(!(f.INDICATOR)||f.INDICATOR.trim()===""){t.byId("indicatorId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_SELECT_KPI"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_SELECT_KPI")});t.errorState=true;a=true;}if(!(f.ID)){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(!(f.TITLE)||f.TITLE.trim()===""){t.byId("evalTitle").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE")});t.errorState=true;a=true;}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(a){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(t.byId("indicatorId").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DOES_NOT_EXIST")});t.errorState=true;a=true;}if(t.byId("evalOwnerEmail").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL")});t.errorState=true;a=true;}if(t.byId("semanticObject").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});t.errorState=true;a=true;}if(t.byId("action").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});t.errorState=true;a=true;}if(t.byId("evalTitle").getValueState()==="Error"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVALUATION_TITLE")});t.errorState=true;a=true;}if(f.mode==="edit"){if(!f.ID){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(t.byId("evalId").getValueState()==="Error"){if(t.evalIdEval_reason=="NOT_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else if(t.evalIdEval_reason=="_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else{d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;a=true;}}}else{if(!t.validateEvalId()){if(!f.ID){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;a=true;}if(t.byId("evalId").getValueState()==="Error"){if(t.evalIdEval_reason=="NOT_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else if(t.evalIdEval_reason=="_START_WITH_PERIOD"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_EVAL_ID_BEGIN_WITH_PERIOD")});t.errorState=true;a=true;t.evalIdEval_reason=null;}else{d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;a=true;}}}else{return;}}if(f.VALUES_SOURCE==="FIXED"){var n=this._areEvaluationValuesNumber(this.getView().getModel().getData());if(n.length){var b="";for(i=0;i<n.length;i++){b=b+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_"+n[i])+"\n";}d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}else{var v=this.validateEvaluationValues(this.getView().getModel().getData());if(v.length){var b=this.oResourceBundle.getText("ERROR_ENTER_VALID_THRESHOLD_VALUES");var i;for(i=0;i<v.length;i++){if(v[i]==="CL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("CRITICAL_LOW");}else{b=b+"\n"+this.oResourceBundle.getText("CRITICAL");}}if(v[i]==="WL"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("WARNING_LOW");}else{b=b+"\n"+this.oResourceBundle.getText("WARNING");}}if(v[i]==="TA"){b=b+"\n"+this.oResourceBundle.getText("TARGET");}if(v[i]==="CH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("CRITICAL_HIGH");}else{b=b+"\n"+this.oResourceBundle.getText("CRITICAL");}}if(v[i]==="WH"){if(this.getView().getModel().getData().GOAL_TYPE==="RA"){b=b+"\n"+this.oResourceBundle.getText("WARNING_HIGH");}else{b=b+"\n"+this.oResourceBundle.getText("WARNING");}}}d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}}}if(f.VALUES_SOURCE==="RELATIVE"){var c=this.getView().getModel().getData();var p=/^(?=.*\d)\d*(?:\.\d\d)?$/;var b="";if(c.GOAL_TYPE==="MA"){if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&parseInt(c.WARNINGLOW)<=parseInt(c.CRITICALLOW)){b+=this.oResourceBundle.getText("CRITICAL_SHOULD_BE_LESS_THAN_WARNING");}if(c.WARNINGLOW>=100&&(c.WARNINGLOW!=""&&c.WARNINGLOW!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_SHOULD_BE_LESS_THAN_100");}if(c.CRITICALLOW!=""&&(c.CRITICALLOW>=100&&c.CRITICALLOW!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_SHOULD_BE_LESS_THAN_100");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&!p.test(c.WARNINGLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING");}if((c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&!p.test(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}}if(c.GOAL_TYPE==="MI"){if((c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)&&parseInt(c.CRITICALHIGH)<=parseInt(c.WARNINGHIGH)){b+=this.oResourceBundle.getText("CRITICAL_SHOULD_BE_MORE_THAN_WARNING");}if(c.CRITICALHIGH<=100&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_SHOULD_BE_MORE_THAN_100");}if(c.WARNINGHIGH<=100&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_SHOULD_BE_MORE_THAN_100");}if(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null&&!p.test(c.CRITICALHIGH)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL");}if((c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null&&!p.test(c.WARNINGHIGH))){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING");}}if(c.GOAL_TYPE==="RA"){if((c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)&&parseInt(c.CRITICALHIGH)<=parseInt(c.WARNINGHIGH)){b+=this.oResourceBundle.getText("CRITICAL_HIGH_MORE_THAN_WARNING_HIGH");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&parseInt(c.WARNINGLOW)<=parseInt(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("WARNING_LOW_MORE_THAN_CRITICAL_LOW");}if(c.CRITICALHIGH<=100&&(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_HIGH_SHOULD_BE_MORE_THAN_100");}if(c.WARNINGHIGH<=100&&(c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_HIGH_SHOULD_BE_MORE_THAN_100");}if(c.CRITICALLOW>=100&&(c.CRITICALLOW!=""&&c.CRITICALLOW!=null)){b+="\n"+this.oResourceBundle.getText("CRITICAL_LOW_SHOULD_BE_LESS_THAN_100");}if(c.WARNINGLOW>=100&&(c.WARNINGLOW!=""&&c.WARNINGLOW!=null)){b+="\n"+this.oResourceBundle.getText("WARNING_LOW_SHOULD_BE_LESS_THAN_100");}if((c.WARNINGLOW!=""&&c.WARNINGLOW!=null)&&!p.test(c.WARNINGLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING_LOW");}if((c.CRITICALLOW!=""&&c.CRITICALLOW!=null)&&!p.test(c.CRITICALLOW)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL_LOW");}if(c.CRITICALHIGH!=""&&c.CRITICALHIGH!=null&&!p.test(c.CRITICALHIGH)){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_CRITICAL_HIGH");}if((c.WARNINGHIGH!=""&&c.WARNINGHIGH!=null&&!p.test(c.WARNINGHIGH))){b+="\n"+this.oResourceBundle.getText("ENTER_NUMERIC_VALUE_FOR_WARNING_HIGH");}}if(b!=""){d.errorMsg.push({text:b,icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":b});t.errorState=true;a=true;}}if(!t.indicatorContext){t.indicatorContext="INDICATORS_MODELER(ID='"+f.INDICATOR+"',IS_ACTIVE=1)";}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(a){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}t.isPropertyAdded=true;if(t.getView().byId("propertyName").getValue()||t.getView().byId("propertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}t.busyDialog.open();t.evalParamPayload={};t.evalParamPayload=t.getEvalParamPayload(t.getView().getModel().getData());t.saveFilters(t.getView());t.saveValues(t.getView());t.saveTags(t.getView());t.saveProperties(t.getView());t.saveAdditionalLanguages(t.getView());if(!e){e="create";}if(f.mode==="create"){t.createBatch=t.createBatchForEvalCreateMode(e);}else if(f.mode==="edit"){if(t.evalDetails.IS_ACTIVE===0&&f.IS_ACTIVE===0){t.createBatchPayload(e);}else if(t.evalDetails.IS_ACTIVE===1&&f.IS_ACTIVE===0){t.getView().getModel().setProperty("/mode","create");t.createBatch=t.createBatchForEvalCreateMode(e);}}},saveAndCreateNew:function(e){this.saveAndExit("createNew");},saveAndActivate:function(){var t=this;t.checkForActivation("saveActivate");},activateAndCreateNew:function(){this.checkForActivation("activateAndCreateNew")},checkForActivation:function(p){var t=this;var e=false;var f=t.getView().getModel().getData();this.errorMessages=[];this.errorState=false;var d={errorMsg:[]};if(!(f.INDICATOR)||f.INDICATOR.trim()===""){t.byId("indicatorId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_SELECT_KPI"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_SELECT_KPI")});t.errorState=true;e=true;}if(!(f.ID)){t.byId("evalId").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_ID")});t.errorState=true;e=true;}if(!(f.TITLE)||f.TITLE.trim()===""){t.byId("evalTitle").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_EVALUATION_TITLE")});t.errorState=true;e=true;}var a=t.validateDimensionsAndInputParameters();if(a.error){if(a.errorType==="mandatoryFieldEmpty"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_INPUT_PARAMETERS")});t.errorState=true;e=true;}if(a.errorType==="fieldEmpty"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_DIMENSION_VALUES")});t.errorState=true;e=true;}if(a.errorType==="invalidEntry"){d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",a.errorDimension.name),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",a.errorDimension.name)});t.errorState=true;e=true;}}if(f.ODATA_URL===""){if(this.VIEW_MODE==="hana"){t.byId("odataServiceInput").setValueState("Error");}else{t.byId("odataServiceInputCDS").setValueState("Error");}d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL")});t.errorState=true;e=true;}if(!f.ODATA_ENTITYSET||f.ODATA_ENTITYSET===""){t.byId("entitySetInput").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;e=true;}if(!f.COLUMN_NAME||f.COLUMN_NAME===""){t.byId("valueMeasureInput").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_MEASURE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_MEASURE")});t.errorState=true;e=true;}if(this.inputParameterSapClientCheckBox&&this.inputParameterSapClientCheckBox.getSelected()){if(this.sessionClientFetchError&&this.VIEW_MODE!="cds"){d.errorMsg.push({text:t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED")});t.errorState=true;e=true;}}if(t.getView().byId("additionalMeasures").getTokens().length){var b=t.getView().byId("additionalMeasures").getTokens();for(var i=0,l=b.length;i<l;i++){if(b[i].getText()==f.COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");d.errorMsg.push({text:t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ADDI_MEASURE_HAS_MAIN_MEASURE")});t.errorState=true;e=true;}}}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADER")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(e){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(!f.TARGET||f.TARGET==""){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("ERROR_TARGET_NOT_ENTERED")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();t.saveAndExit(p);}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{t.saveAndExit(p);}},activateAndAddTiles:function(){var t=this;t.checkForActivation("activate");},cancel:function(){this.navigateBack();},deleteDraft:function(){var t=this;var o={};o.ID=t.getView().getModel().getData().ID;o.IS_ACTIVE=t.getView().getModel().getData().IS_ACTIVE;var u="EVALUATION";t.metadataRef.remove(u,o,function(d){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_DELETING_DRAFT"));window.location.hash="FioriApplication-SBWorkspace?sap-system="+sap.suite.ui.smartbusiness.lib.Util.utils.getHanaSystem()+"&/detail/INDICATORS_MODELER(ID='"+t.getView().getModel().getData().INDICATOR+"',IS_ACTIVE=1)";},function(e){sap.suite.ui.smartbusiness.lib.Utlib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_DELETING_DRAFT"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_DELETING_DRAFT")});t.errorState=true;});},validateEvalId:function(){var t=this;var e=this.getView().byId('evalId');var i=0;var a=e.getValue();if(this.VIEW_MODE==this.CDS){e.setValue(a.toUpperCase());}if(a){if(a.lastIndexOf(this.RESERVED_EVAL_ID_NAMESPACE,0)===0){e.setValueState("Error");return false;}else if(this.VIEW_MODE==this.CDS&&a[0]!='.'){this.evalIdEval_reason="NOT_START_WITH_PERIOD";e.setValueState("Error");return false;}else if(this.VIEW_MODE==this.HANA&&a[0]=='.'){this.evalIdEval_reason="_START_WITH_PERIOD";e.setValueState("Error");return false;}else if(!(/^[a-zA-Z0-9.]*$/.test(a))||a.length>this.valid_maxlength[this.VIEW_MODE].id){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_ID")});t.errorState=true;e.setValueState("Error");return true;}else{e.setValueState("None");var b=function(d){if(d.length>0){if(d[0].ID){e.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_EVAL_WITH_ID_EXISTS",a)});t.errorState=true;return true;}else{e.setValueState("None");}}else{e.setValueState("None");}};var c=function(){e.setValueState("None");};this.metadataRef.getDataByEntity({entity:"EVALUATIONS",filter:"ID eq '"+a+"'",async:false,success:b,error:c,model:this.oDataModel});}}return false;},validateEvalTitle:function(){var e=this.getView().byId('evalTitle');var a=e.getValue();if(!a){e.setValueState("Error");return false;}if(a.length>this.valid_maxlength[this.VIEW_MODE].title){e.setValueState("Error");return false}else{e.setValueState("None");return true;}},validateEmailAddress:function(){var t=this;var e=this.getView().byId('evalOwnerEmail');var a=e.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){e.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_EVAL_E_MAIL")});t.errorState=true;}else{e.setValueState("None");}}else{e.setValueState("None");}},listAllKpis:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_KPI"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/INDICATORS_MODELER",template:new sap.m.ObjectListItem({title:"{TITLE}",number:"{EVALUATION_COUNT}",firstStatus:new sap.m.ObjectStatus({text:"Evaluations",}),attributes:[new sap.m.ObjectAttribute({text:"{ID}",visible:"{SB_APP_SETTING>/ID_VISIBLE}"})]})},confirm:function(e){t.busyDialog.open();t.indicatorContext="INDICATORS_MODELER(ID='"+e.getParameter("selectedItem").getBindingContext().getProperty("ID")+"',IS_ACTIVE=1)";t.getKpiDetails();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var F=new sap.ui.model.Filter("tolower(ID)",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("tolower(TITLE)",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1);var b=e.getSource().getBinding("items");var c=new sap.ui.model.Filter([F,o],false);var d=new sap.ui.model.Filter([a],true);b.filter(new sap.ui.model.Filter([c,d],true));}});h.setModel(t.oDataModel);var f=[];f.push(new sap.ui.model.Filter("IS_ACTIVE",sap.ui.model.FilterOperator.EQ,1));h.getBinding("items").filter(new sap.ui.model.Filter(f,true));h.open();},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o;}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var v=t.VIEW_MODE==t.CDS?"viewInputCDS":"viewInput";t.getView().byId(v).setValueState("None");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject();t.byId('viewInput').fireChange();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(this.oDataModel);h.open();},handleCDSViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"PackName",type:new sap.ui.model.type.String()},{path:"CdsName",type:new sap.ui.model.type.String()}],formatter:function(p,c){return p+"::"+c;}}})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/VIEW_NAME_CdsName",e.getParameter("selectedItem").getBindingContext().getProperty("CdsName"));t.getView().getModel().setProperty("/VIEW_NAME_PackName",e.getParameter("selectedItem").getBindingContext().getProperty("PackName"));t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var v=t.VIEW_MODE==t.CDS?"viewInputCDS":"viewInput";t.getView().byId(v).setValueState("None");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.currentSelectedHanaViewObject=e.getParameter("selectedItem").getBindingContext().getObject();},liveChange:function(e){var i,s,a,b,c;s=a=b=e.getParameter("value").toUpperCase();c=false;if((i=s.lastIndexOf("::"))!==-1){a=s.substring(0,i);b=s.substring(i+2,s.length);c=true;}var f=new sap.ui.model.Filter("PackName",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("CdsName",sap.ui.model.FilterOperator.Contains,b);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f,F],c));}});this.oDataModelCDS.read("/CDSViewSet",null,null,false,function(d){var d=d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);h.setModel(c);});h.open();},hanaViewChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_URL","");t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var a=this.VIEW_MODE==this.CDS?"viewInputCDS":"viewInput";if(!(v.getSource().getValue()==="")){t.getView().byId(a).setValueState("None");}var o=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters();},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW"));t.getView().byId("viewInput").setValueState("Error");t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_A_HANA_VIEW")});t.errorState=true;}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata";}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.currentSelectedODataUrlObject=e.getParameter("selectedItem").getBindingContext().getObject();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oDataModel);h.open();}},handleOdataServiceValueHelpCDS:function(){var t=this;if(!t.byId("viewInputCDS").getValue()){var r="/PackOdataSet";var e=null;}else{var s=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_PackName"));var r="/CDSViewSet(CdsName='"+s+"')/?$expand=ODATAnameSet";var e="ODATAnameSet";}var b=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"OdataURL",type:new sap.ui.model.type.String()}],formatter:function(o){return(function(h){return jQuery("<a>").attr("href",h)[0]["pathname"]})(o);}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_URL",E.getParameter("selectedItem").getProperty("title"));var o=t.VIEW_MODE==t.CDS?"odataServiceInputCDS":"odataServiceInput";t.getView().byId(o).setValueState("None");t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");},liveChange:function(E){var c=E.getParameter("value");var f=new sap.ui.model.Filter("OdataURL",sap.ui.model.FilterOperator.Contains,c);var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});this.oDataModelCDS.read(r,null,null,false,function(d){var d=e?d[e].results:d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);b.setModel(c);});b.open();},oDataUrlChange:function(v){var t=this;t.getView().getModel().setProperty("/ODATA_ENTITYSET","");t.getView().getModel().setProperty("/COLUMN_NAME","");var o=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!(v.getSource().getValue()==="")){t.getView().byId(o).setValueState("None");}t.getView().byId("entitySetInput").setValueState("None");t.getView().byId("valueMeasureInput").setValueState("None");t.resetAdditionalMeasures();t.resetDimensionsAndInputParameters();},handleEntitySetValueHelp:function(){var t=this;var a=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!t.byId(a).getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_URL")});t.errorState=true;}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.getView().byId("entitySetInput").setValueState("None");t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});var C=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"EntityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));t.resetDimensionsAndInputParameters();t.resetAdditionalMeasures();try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});try{if(t.getView().getModel().getData().VIEW_NAME){if(this.VIEW_MODE!=this.CDS){t.populateRelevantEntitySet(h);}else{t.populateRelevantEntitySet_CDS(C);}}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId(a).getValue());h.setModel(t.oModelForEntity);h.open();}}catch(b){}}},entitySetChange:function(v){var t=this;t.resetAdditionalMeasures();if(t.getView().getModel().getProperty("/ODATA_URL")&&t.getView().getModel().getProperty("/ODATA_ENTITYSET")){try{t.populateDimensionsAndInputParameters(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.getView().byId("entitySetInput").setValueState("None");}catch(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"),"description":t.oResourceBundle.getText("ERROR_ODATA_ANALYTICS")});t.errorState=true;t.resetDimensionsAndInputParameters();}}else{t.resetDimensionsAndInputParameters();t.getView().byId("entitySetInput").setValueState("None");t.getView().getModel().setProperty("/COLUMN_NAME","");}},handleMeasureValueHelp:function(){var t=this;var t=this;if(!t.byId("entitySetInput").getValue()){t.byId("entitySetInput").setValueState("Error");t.byId("valueMeasureInput").setValueState("None");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var m=t.mProperties.getLabelMappingObject();var a=t.oModelForMeasure.getData().measures;for(var i=0,l=a.length;i<l;i++){a[i].measureLabel=m[a[i].measureName];}t.oModelForMeasure.setData({measures:a});}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureLabel",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},description:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}}})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getBindingContext().getProperty("measureName"));t.getView().byId("valueMeasureInput").setValueState("None");},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("measureLabel",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oModelForMeasure);h.open();}},measureChange:function(v){var t=this;if(!t.byId("entitySetInput").getValue()){t.byId("entitySetInput").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});t.errorState=true;}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.getView().byId("valueMeasureInput").setValueState("None");}catch(e){}}},validateSemantic:function(e){var t=this;if(e.getParameter("value").indexOf(' ')===-1){this.byId(e.getParameter("id")).setValueState("None");}else{this.byId(e.getParameter("id")).setValueState("Error");}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"));},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();t.metadataRef.populateRelevantEntitySet(d,m,t);},populateRelevantEntitySet_CDS:function(d){var s=encodeURIComponent(this.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(this.getView().getModel().getProperty("/ODATA_URL"));var e="EntityTypeSet";var u="/ODATAnameSet(CdsName='"+s+"\',OdataName='',OdataURL='"+a+"',SrvName='',SrvVersion='',SrvNamespace='')/?$expand="+e;this.oDataModelCDS.read(u,null,null,false,function(b){var b=b[e].results;var c=new sap.ui.model.json.JSONModel();c.setData(b);d.setModel(c);d.open();});},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.ui.smartbusiness.lib.Util.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o);}m.setData({entitySet:e});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o);}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M;},additionalInformationForKpi:function(e){var t=this;t.dialogAdditionalInfo=new sap.m.Dialog({type:"Message",title:t.oResourceBundle.getText("ADDITIONAL_INFO_FROM_KPI"),content:[new sap.m.Label({text:{path:'/DATA_SPECIFICATION',formatter:function(v){if(t.getView().getModel().getData().DATA_SPECIFICATION){return t.getView().getModel().getData().DATA_SPECIFICATION;}else{return t.oResourceBundle.getText("ERROR_NO_DATA_TO_DISPLAY");}}}})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CLOSE"),press:function(E){E.getSource().getParent().close();}})});t.dialogAdditionalInfo.setModel(t.getView().getModel());t.dialogAdditionalInfo.open();},openDecimalInfo:function(e){var t=this;var c=new sap.m.Bar({width:"100%",contentMiddle:[new sap.m.Label({text:t.oResourceBundle.getText("DECIMAL_PRECISION")})],contentRight:[new sap.m.Button({icon:"sap-icon://decline",press:function(){i.close();}})]});var i=new sap.m.ResponsivePopover({showHeader:true,customHeader:c,contentWidth:"15%",contentHeight:"20%",verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Right,content:[new sap.m.Text({width:"100%",textAlign:"Left",text:t.oResourceBundle.getText("INFO_TEXT_DECIMAL_PRECISION")}).addStyleClass("evaluationThresholdInfoHeader")]});i.openBy(e.getSource());},addNewProperty:function(){var t=this;if(this.getView().byId("propertyName").getValue()){this.getView().byId("propertyName").setValueState("None");if(this.getView().byId("propertyValue").getValue()){this.getView().byId("propertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("propertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("propertyValue").getValue())){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS")});t.errorState=true;}}p.getData().PROPERTIES.push({NAME:this.getView().byId("propertyName").getValue(),VALUE:this.getView().byId("propertyValue").getValue()});p.updateBindings();this.getView().byId("propertyName").setValue("");this.getView().byId("propertyValue").setValue("");}else{t.isPropertyAdded=false;this.getView().byId("propertyValue").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_VALUE")});t.errorState=true;}}else{t.isPropertyAdded=false;this.getView().byId("propertyName").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_PROPERTY_NAME")});t.errorState=true;}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings();},_appendSystemAlias:function(u,s){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("URLParsing");if(a){u=a.addSystemToServiceUrl(u,s);}}return u;},populateDimensionsAndInputParameters:function(d,e){var t=this;d=this._appendSystemAlias(d);var a=[];var b=[];var m=[];var c=[];this.oData4SAPAnalyticsModel=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByURI(d),null);this.queryResultObj=this.oData4SAPAnalyticsModel.findQueryResultByName(e);this.queryResultFilters=sap.suite.ui.smartbusiness.lib.OData.filter(d,e);var q=this.queryResultFilters.getAsObject();for(l in q){var n=q[l].getName();var p=q[l].getKeyProperty().type;var f=q[l].getKeyProperty().extensions;var r=false;var g=null;var h=this.queryResultFilters.getMandatoryList().length;for(var i=0;i<f.length;i++){if(f[i].name=="required-in-filter"&&f[i].value=="true"){r=true;}if(f[i].name=="filter-restriction"){g=f[i].value;}}var j={name:n,propertyType:p,required:r,filterRestriction:g};a.push(j);}var k=this.oModelForDimensions.getData();k.dimensions=a;k.dimensions.sort();k.dataSource=d;k.entitySet=e;if(k.selectedDimensions){for(var l in k.selectedDimensions){k.selectedDimensions[l].propertyType=this.queryResultObj.findDimensionByName(k.selectedDimensions[l].name)?this.queryResultObj.findDimensionByName(k.selectedDimensions[l].name).getKeyProperty().type:"";if(k.selectedDimensions[l].propertyType=="Edm.DateTime"){var v=k.selectedDimensions[l].value_1.split(",");for(i in v){if(v[i]!=""){var o=new Date(v[i]);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}k.selectedDimensions[l].value_1=v.join(",");v=null;v=k.selectedDimensions[l].value_2.split(",");for(var i in v){if(v[i]!=""){var o=new Date(k.selectedDimensions[l].value_2);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}k.selectedDimensions[l].value_2=v.join(",");this.dimensionValue[k.selectedDimensions[l].name]=this.dimensionValue[k.selectedDimensions[l].name]?this.dimensionValue[k.selectedDimensions[l].name]:{};this.dimensionValue[k.selectedDimensions[l].name]["value_1"]=k.selectedDimensions[l].value_1;this.dimensionValue[k.selectedDimensions[l].name]["value_2"]=k.selectedDimensions[l].value_2;}}}else{if(h){k.selectedDimensions=[];for(var i=0;i<k.dimensions.length;i++){if(k.dimensions[i].required==true){var z=this._cloneObj(k.dimensions[i]);z.value_1="";z.value_2="";if(k.dimensions[i].filterRestriction=="interval"){z.operator="BT";}else if(k.dimensions[i].filterRestriction=="single-value"){z.operator="EQ";}else{z.operator="EQ";}k.selectedDimensions.push(z);}}}}if(h){this.byId("mandatoryFiltersDataGrid").setVisible(true);if(t.VIEW_MODE!="cds"){var A;for(l in k.selectedDimensions){if((t.sessionClientXsjsMissing!==true)&&(k.selectedDimensions[l].name==="P_SAPClient"||k.selectedDimensions[l].name==="V_SAPClient"||k.selectedDimensions[l].name==="SAPClient")&&k.selectedDimensions[l].required){A=k.selectedDimensions.splice(l,1);if(this.getView().getModel().getData().mode==="create"&&(!this.evalDetails||this.evalDetails.IS_ACTIVE===0)){A[0].value_1="$$$";t.hasSapClient=true;}k.selectedDimensions.push(A[0]);break;}}}}else{this.byId("mandatoryFiltersDataGrid").setVisible(false);}this.oModelForDimensions.setData(k);var B=this.queryResultObj.getParameterization();if(B){if(this.oModelForInputParameters.getData().inputParameters){var b=this.oModelForInputParameters.getData().inputParameters;for(var l in b){b[l].propertyType=B.findParameterByName(b[l].name).getProperty().type;if(b[l].propertyType=="Edm.DateTime"){var v=b[l].value_1.split(",");for(i in v){if(v[i]!=""){var o=new Date(v[i]);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}b[l].value_1=v.join(",");v=null;v=b[l].value_2.split(",");for(var i in v){if(v[i]!=""){var o=new Date(k.selectedDimensions[l].value_2);var s=o.getMonth()+1;s=/^\d$/.test(s)?"0"+s:s;var u=o.getDate();u=/^\d$/.test(u)?"0"+u:u;var w=o.getHours();w=/^\d$/.test(w)?"0"+w:w;var x=o.getMinutes();x=/^\d$/.test(x)?"0"+x:x;var y=o.getSeconds();y=/^\d$/.test(y)?"0"+y:y;v[i]=o.getFullYear()+"-"+s+"-"+u+" "+w+":"+x+":"+y+"."+o.getMilliseconds();}}b[l].value_2=v.join(",");}}}else{var C=B.getAllParameters();for(var l in C){var n=C[l].getName();var p=C[l].getProperty().type;var D=C[l].isOptional();var j={name:n,propertyType:p,operator:"EQ",value_1:"",value_2:""};b.push(j);}}if(b.length>0){this.byId("noInputParameterGrid").setVisible(false);this.byId("inputParameterDataGrid").setVisible(true);}else{this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);}k=this.oModelForInputParameters.getData();k.inputParameters=b;var E;if(k.inputParameters.length>0){if(t.VIEW_MODE!="cds"){for(l in k.inputParameters){if((t.sessionClientXsjsMissing!==true)&&k.inputParameters[l].name==="P_SAPClient"||k.inputParameters[l].name==="V_SAPClient"||k.inputParameters[l].name==="SAPClient"){E=k.inputParameters.splice(l,1);if(this.getView().getModel().getData().mode==="create"&&(!this.evalDetails||this.evalDetails.IS_ACTIVE===0)){E[0].value_1="$$$";}k.inputParameters.push(E[0]);break;}}}}this.oModelForInputParameters.setData(k);}},setInputParameterAndFilterLayout:function(){var t=this;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);this.byId("mandatoryFiltersDataGrid").setVisible(false);this.byId("inputParameterBaseLayout").setModel(this.oModelForInputParameters);this.byId("inputParameterBaseLayout").bindAggregation("items","/inputParameters",function(i,c){t.inputParameterOperator=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:t.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.inputParameterValue=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});if((t.VIEW_MODE!="cds")&&(c.getProperty().name==="P_SAPClient"||c.getProperty().name==="V_SAPClient"||c.getProperty().name==="SAPClient")&&(t.sessionClientXsjsMissing!==true)){t.inputParameterSapClientCheckBox=new sap.m.CheckBox({text:t.oResourceBundle.getText("PICK_FROM_HANA_SESSION_CLIENT"),selected:{path:"value_1",formatter:function(v){if(v==="$$$"){return true;}else{return false;}}},select:function(){var l=this.getModel().getData().inputParameters.length;if(this.getSelected()===true){if(t.sessionClientFetchError){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("SESSION_CLIENT_FETCH_FAILED"));}t.inputParameterValue.setVisible(false);this.getModel().getData().inputParameters[l-1].value_1="$$$";}else{t.inputParameterValue.setVisible(true);if(this.getModel().getData().inputParameters[l-1].value_1==="$$$"){t.inputParameterValue.setValue("");}}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.inputParameterOperator=t.inputParameterSapClientCheckBox;if(t.getView().getModel().getData().mode==="create"){t.inputParameterValue.setVisible(false);}}t.inputParameterGrid=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),t.inputParameterOperator,t.inputParameterValue]});return t.inputParameterGrid;});this.byId("mandatoryFilterBaseLayout").setModel(this.oModelForDimensions);this.byId("mandatoryFilterBaseLayout").bindAggregation("items","/selectedDimensions",function(i,c){t.mandatoryFilterOperator=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:[new sap.ui.core.Item({text:(c.getObject().filterRestriction!="interval")?t.oResourceBundle.getText("EQUAL_TO"):t.oResourceBundle.getText("BETWEEN"),key:(c.getObject().filterRestriction!="interval")?"EQ":"BT"})],selectedKey:"{operator}",layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterValue=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterValueTo=new sap.m.Input({value:"{value_2}",visible:(c.getObject().filterRestriction!="interval")?false:true,customData:[{key:"valueType",value:"value_2"}],valueHelpRequest:jQuery.proxy(t.openInputParameterValueHelpDialog,t),change:jQuery.proxy(t.handleDimensionValueChange,t),valueState:{path:"error_1",formatter:function(e){if(e)return"Error";else return"None";}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});if((t.VIEW_MODE!="cds")&&(c.getProperty().name==="P_SAPClient"||c.getProperty().name==="V_SAPClient"||c.getProperty().name==="SAPClient")&&(t.sessionClientXsjsMissing!==true)){t.mandatoryFilterSapClientCheckBox=new sap.m.CheckBox({text:t.oResourceBundle.getText("PICK_FROM_HANA_SESSION_CLIENT"),selected:{path:"value_1",formatter:function(v){if(v==="$$$"){return true;}else{return false;}}},select:function(){var l=this.getModel().getData().selectedDimensions.length;if(this.getSelected()===true){t.mandatoryFilterValue.setVisible(false);this.getModel().getData().selectedDimensions[l-1].value_1="$$$";}else{t.mandatoryFilterValue.setVisible(true);if(this.getModel().getData().selectedDimensions[l-1].value_1==="$$$"){t.mandatoryFilterValue.setValue("");}}},layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});t.mandatoryFilterOperator=t.mandatoryFilterSapClientCheckBox;if(t.getView().getModel().getData().mode==="create"){t.mandatoryFilterValue.setVisible(false);}}t.mandatoryFilterGrid=new sap.ui.layout.Grid({defaultSpan:"L9 M9",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),t.mandatoryFilterOperator,t.mandatoryFilterValue,t.mandatoryFilterValueTo]});return t.mandatoryFilterGrid;});var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.EQ,true);this.byId("mandatoryFilterBaseLayout").getBinding("items").filter(f);this.byId("dimensionLayoutHeaders").setVisible(false);this.byId("baseDimensionLayout").setModel(this.oModelForDimensions);this.byId("baseDimensionLayout").bindAggregation("items","/selectedDimensions",function(i,c){var d=new sap.m.Select({width:"100%",customData:[{key:"valueType",value:"value_1"}],items:t.formatOptionalFiltersOperators(c),selectedKey:"{operator}",change:jQuery.proxy(t.handleOperatorChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var a=new sap.m.Input({value:"{value_1}",customData:[{key:"valueType",value:"value_1"}],showValueHelp:true,valueState:{path:"error_1",formatter:function(k){if(k)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var b=new sap.m.Input({value:"{value_2}",customData:[{key:"valueType",value:"value_2"}],showValueHelp:true,visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}},valueState:{path:"error_2",formatter:function(k){if(k)return"Error";else return"None";}},valueHelpRequest:jQuery.proxy(t.handleDimensionValueToHelp,t),change:jQuery.proxy(t.handleDimensionValueChange,t),layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var e=new sap.m.Label({text:"To",visible:{path:"operator",formatter:function(o){return(o==="BT")?true:false;}}});var g=new sap.m.VBox({items:[a,e,b],layoutData:new sap.ui.layout.GridData({span:"L3 M3"})});var h=new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L1 M1 S1"}),press:function(k){var p=k.getSource().getBindingContext().getPath();if(t.dimensionValue){if(t.dimensionValue[k.getSource().getBindingContext().getObject().name]){delete t.dimensionValue[k.getSource().getBindingContext().getObject().name];}}k.getSource().getBindingContext().getModel().getData().selectedDimensions.splice(p.substring(p.lastIndexOf("/")+1),1);k.getSource().getBindingContext().getModel().updateBindings();if(k.getSource().getBindingContext().getModel().getData().selectedDimensions.length==0){t.byId("dimensionLayoutHeaders").setVisible(false);}}});var j=new sap.ui.layout.Grid({defaultSpan:"L12 M12",content:[new sap.m.Input({value:"{name}",width:"100%",textAlign:sap.ui.core.TextAlign.End,editable:false,layoutData:new sap.ui.layout.GridData({span:"L3 M3"})}),d,g,h]});return j;});var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.NE,true);this.byId("baseDimensionLayout").getBinding("items").filter(f);},formatOptionalFiltersOperators:function(c){var p=c.getPath().replace(/\D/g,'');var f=c.getModel().oData.selectedDimensions[p].filterRestriction||null;switch(f){case"single-value":return[new sap.ui.core.Item({text:this.oResourceBundle.getText("EQUAL_TO"),key:"EQ"})];break;default:return[new sap.ui.core.Item({text:this.oResourceBundle.getText("EQUAL_TO"),key:"EQ"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("GREATER_THAN"),key:"GT"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("LESS_THAN"),key:"LT"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("NOT_EQUAL_TO"),key:"NE"}),new sap.ui.core.Item({text:this.oResourceBundle.getText("BETWEEN"),key:"BT"})];break;}},openInputParameterValueHelpDialog:function(n){var t=this;var i=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",template:new sap.m.StandardListItem({title:"{"+n+"}",})},confirm:function(e){},liveChange:function(e){}});i.setGrowingThreshold(100);i.open();},openDimensionDialog:function(){var t=this;var s=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"P_SAPClient");var a=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"V_SAPClient");var b=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.NE,"SAPClient");var f=new sap.ui.model.Filter("required",sap.ui.model.FilterOperator.NE,true);var c=new sap.ui.model.Filter([s,a,b],true);if(!this.dimensionDialog){var S=new sap.ui.model.Sorter("label",false);this.dimensionDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_DIMENSION_TO_ADD_FILTERS"),multiSelect:true,items:{path:"/dimensions",sorter:S,template:new sap.m.StandardListItem({title:"{label}",description:"{name}"})},confirm:function(E){var j=t.oModelForDimensions.getData().selectedDimensions||[];var k=E.getParameter("selectedItems");var C=[];for(var m in k){C[m]=k[m].getBindingContext();}for(var m in C){var n=t._cloneObj(C[m].getObject());n.value_1="";n.value_2="";n.operator="EQ";j.unshift(n);}if(C.length>0)t.byId("dimensionLayoutHeaders").setVisible(true);else t.byId("dimensionLayoutHeaders").setVisible(false);t.oModelForDimensions.setProperty("/selectedDimensions",j);},liveChange:function(E){var j=E.getParameter("value");var k;var F=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,j);var o=new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,j);var m=new sap.ui.model.Filter([F,o],false);var n=new sap.ui.model.Filter([f],true);if(t.hasSapClient===true){k=new sap.ui.model.Filter([c,n],true);}else{k=new sap.ui.model.Filter([n],true);}var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([m,k],true));}});this.dimensionDialog.setGrowingThreshold(100);try{t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var d=t.mProperties.getLabelMappingObject();var g=t.oModelForDimensions.getData();var h=t.oModelForDimensions.getData().dimensions;for(var i=0,l=h.length;i<l;i++){h[i].label=d[h[i].name];}g.dimensions=h;t.oModelForDimensions.setData(g);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.dimensionDialog.setModel(this.oModelForDimensions);}if(t.hasSapClient===true){this.dimensionDialog.getBinding("items").filter([c,f],false);}this.dimensionDialog.open();},handleDimensionValueHelp:function(e){this.openDimensionValueHelpDialog(e,"value_1");},handleDimensionValueToHelp:function(e){this.openDimensionValueHelpDialog(e,"value_2");},getMandatoryFilters:function(){var t=this;var m=[];var s=this.oModelForDimensions.getData().selectedDimensions;for(var i in s){if(s[i].required==true){if(s[i].value_1==="$$$"){if(t.VIEW_MODE!="cds"){m.push({OPERATOR:s[i].operator,NAME:s[i].name,VALUE_1:t.userSessionClient,VALUE_2:s[i].value_2,TYPE:"FI"});}}else{m.push({OPERATOR:s[i].operator,NAME:s[i].name,VALUE_1:s[i].value_1,VALUE_2:s[i].value_2,TYPE:"FI"});}}}return m;},openDimensionValueHelpDialog:function(e,v){var t=this;var p=e.getSource();var b=this.getView().getModel();var d=new sap.ui.model.json.JSONModel();var a=[];this.dimensionContext=e.getSource().getBindingContext();var c=e.getSource().getBindingContext().getProperty("name");var f=e.getSource().getBindingContext().getProperty("operator");var g=e.getSource().getBindingContext().getProperty("propertyType");var h=this.oModelForInputParameters.getData().inputParameters;for(var l in h){if(h[l].value_1==="$$$"){if(t.VIEW_MODE!="cds"){a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:t.userSessionClient,VALUE_2:h[l].value_2,TYPE:"PA"});}}else{a.push({OPERATOR:h[l].operator,NAME:h[l].name,VALUE_1:h[l].value_1,VALUE_2:h[l].value_2,TYPE:"PA"});}}var m=this.allMandatoryFiltersEntered();if(!m){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ALL_MANDATORY_FILTERS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ALL_MANDATORY_FILTERS")});t.errorState=true;}var q=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:b.getProperty("/ODATA_URL"),entitySet:b.getProperty("/ODATA_ENTITYSET"),filter:a.concat(t.getMandatoryFilters()),dimension:c});q.model.read(q.uri,null,null,false,function(u){if(t.dimensionValue[c]){t.dimensionValue[c][v]=t.dimensionValue[c][v]?t.dimensionValue[c][v]:"";var w=t.dimensionValue[c][v]===""?null:t.dimensionValue[c][v].split(",");for(l in w){var x=true;for(var i in u.results){if(g=="Edm.DateTime"){var y=new Date(w[l]).toJSON();var z=new Date(u.results[i][c]).toJSON();if(y==z){x=false;break;}}else if(w[l]===u.results[i][c]){x=false;break;}}if(x){var A={};A[c]=w[l];A.userInput=true;A.selected=true;u.results.push(A);}else u.results[i].selected=true;}}d.setData(u);},function(u){});var s=new sap.ui.model.Sorter(c,false,function(u){if(u.getProperty("userInput")===true)return{key:"USER_VALUES",text:t.oResourceBundle.getText("VALUES_ENTERED_BY_USER")};else return{key:"SERVICE_VALUES",text:t.oResourceBundle.getText("VALUES_FETCHED_FROM_SERVICE")};});this.dimensionValueHelpDialogs=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VALUES"),multiSelect:true,rememberSelections:true,items:{path:"/results",sorter:s,template:new sap.m.StandardListItem({title:"{"+c+"}",selected:"{selected}"})},confirm:function(e){var u="";var C=e.getParameter("selectedContexts");for(var l in C){if(g=="Edm.DateTime"){var w=new Date(C[l].getProperty(t.dimensionContext.getProperty("name")));var x=w.getMonth()+1;x=/^\d$/.test(x)?"0"+x:x;var y=w.getDate();y=/^\d$/.test(y)?"0"+y:y;var z=w.getHours();z=/^\d$/.test(z)?"0"+z:z;var A=w.getMinutes();A=/^\d$/.test(A)?"0"+A:A;var B=w.getSeconds();B=/^\d$/.test(B)?"0"+B:B;u=u+w.getFullYear()+"-"+x+"-"+y+" "+z+":"+A+":"+B+"."+w.getMilliseconds()+",";}else u=u+C[l].getProperty(t.dimensionContext.getProperty("name"))+",";}u=u.substring(0,u.length-1);t.oModelForDimensions.setProperty(t.dimensionContext.getPath()+"/"+v,u);p.fireChange({value:u});t.dimensionValue[c]=t.dimensionValue[c]?t.dimensionValue[c]:{};t.dimensionValue[c][v]=u;},liveChange:function(e){var u=e.getParameter("value");var F=new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,u);var B=e.getSource().getBinding("items");B.filter([F]);}});this.dimensionValueHelpDialogs.setGrowingThreshold(100);this.dimensionValueHelpDialogs.setModel(d);var n=this.oModelForDimensions.getData().selectedDimensions;var o=this.dimensionValueHelpDialogs.getItems();for(var i=0;i<n.length;i++){if((c===n[i].name)&&(f===n[i].operator)){var r;if(n[i].operator==="BT"){if(v==="value_1")r=n[i].value_1.split(",");else r=n[i].value_2.split(",");}else{r=n[i].value_1.split(",");}for(var j=0;j<r.length;j++){for(var k=1;k<o.length;k++){if(r[j]===o[k].getTitle()){o[k].setSelected(true);}}}}}this.dimensionValueHelpDialogs.open();for(var i=1;i<o.length;i++){if(!o[i].getSelected()){this.dimensionValueHelpDialogs.getItems()[i].setSelected(true);this.dimensionValueHelpDialogs.getItems()[i].setSelected(false);}}},allMandatoryFiltersEntered:function(){var d=this.getView().getModel().getData().ODATA_URL;var e=this.getView().getModel().getData().ODATA_ENTITYSET;if(d&&e){this.queryResultFilters=sap.suite.ui.smartbusiness.lib.OData.filter(d,e);var m=this.queryResultFilters.getMandatoryList();var a=m.length;var i=0;j=0,l=0;var s=0;var b=this.oModelForDimensions.getData().selectedDimensions;if(b){s=b.length;if(s){for(i=0;i<a;i++){for(j=0;j<s;j++){if(m[i]===b[j].name){if(!b[j].value_1){return false;}}}}}}}return true;},handleDimensionValueChange:function(e){this.validateValue(e,"dimensionValue");var v=e.getSource().getCustomData()[0].getValue();var d=e.getSource().getBindingContext().getProperty("name");if(!this.dimensionValue[d])this.dimensionValue[d]={};this.dimensionValue[d][v]=e.getParameter("value");},validateValue:function(e,s){var t=this,r;var d=e.getSource().getBindingContext().getProperty("name");var v=e.getSource().getCustomData()[0].getValue();var a=(s==="dimensionValue")?e.getParameter("value").split(","):e.getSource().getBindingContext().getProperty("value_1");var o=e.getSource().getBindingContext().getProperty("operator");if(o==="BT"){if(a.length>1){r=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_MULTIPLE_VALUES_FOR_BETWEEN",d)});t.errorState=true;var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}var b=e.getSource().getBindingContext().getProperty("propertyType");var c,f;for(var k in a){r=true;var g=/<(script)(.*)\/?>/i;var j=/function\s*[^\(]*\(\s*([^\)]*)\)/;var h=/[^\(]*\(\s*([^\)]*)\)\s*{/;if(g.test(a[k])||j.test(a[k])||h.test(a[k])){r=false;c=t.oResourceBundle.getText("ERROR_INVALID_TEXT_FOR",d);}if(b=="Edm.Int32"||b=="Edm.Int16"||b=="Edm.Int64"){f=/^[-+]?\d+$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_INTEGER",d);}else if(b=="Edm.Decimal"){f=/^[-+]?\d+(\.\d+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DECIMAL",d);}else if(b=="Edm.DateTime"){f=/^[1-9][0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s([0-1][0-9]|2[0-3]):[0-5][0-9]:([0-9]|[0-5][0-9])[.][0-9]+)?$/;r=f.test(a[k])?true:false;c=t.oResourceBundle.getText("ERROR_INVALID_ENTRY_ENTER_DATE",d);}if(!r){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(c);t.errorMessages.push({"type":"Error","title":c});t.errorState=true;var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,true);return;}else{var p=v==="value_1"?e.getSource().getBindingContext().getPath()+"/error_1":e.getSource().getBindingContext().getPath()+"/error_2";e.getSource().getModel().setProperty(p,false);}}},handleOperatorChange:function(e){var c=e.getSource().getBindingContext();c.getObject().value_1="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_1="";}}if(c.getProperty("operator")==="BT"){c.getObject().value_2="";if(this.dimensionValue){if(this.dimensionValue[c.getObject().name]){this.dimensionValue[c.getObject().name].value_2="";}}}c.getModel().updateBindings();},validateDimensionsAndInputParameters:function(){var i=this.oModelForInputParameters.getData().inputParameters;var d=this.oModelForDimensions.getData().selectedDimensions;var e=false;var a="";var b="";for(var k in i){if(i[k].error_1===true||i[k].error_2===true)e=true;if(i[k].value_1===""){e=true;a="mandatoryFieldEmpty";i[k].error_1=true;}}this.oModelForInputParameters.updateBindings();for(var k in d){if(d[k].error_1===true||d[k].error_2===true){e=true;a="invalidEntry";b=d[k];}if(d[k].value_1===""){e=true;a="fieldEmpty";d[k].error_1=true;}if(d[k].operator==="BT"&&d[k].value_2===""){e=true;a="fieldEmpty";d[k].error_2=true;}}this.oModelForDimensions.updateBindings();return{error:e,errorType:a,errorDimension:b};},resetDimensionsAndInputParameters:function(){this.oModelForDimensions.setData({});this.oModelForInputParameters.setData({});this.dimensionDialog=null;this.dimensionValueHelpDialogs={};this.dimensionValue={};this.byId("noInputParameterGrid").setVisible(true);this.byId("inputParameterDataGrid").setVisible(false);this.byId("mandatoryFiltersDataGrid").setVisible(false);},createTargetThresholdLayout:function(){var t=this;var a=this.getView().getModel().getData().TREND;var r=this.getView().getModel().getData().REFERENCE_VALUE;if(this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(true);this.getView().byId("additionalMeasures").setVisible(true);this.getView().byId("additionalMeasureLabel").setVisible(true);this.getView().byId("selectedLabel").setVisible(true);this.getView().byId("selectedadditionalMeasures").setVisible(true);this.selectedMeasure();this.getView().byId('targetThresholdPanel').getContent()[0].destroy();if(this.getView().getModel().getData().mode!=="edit"){delete this.getView().getModel().getData().CRITICALHIGH;delete this.getView().getModel().getData().WARNINGHIGH;delete this.getView().getModel().getData().TARGET;delete this.getView().getModel().getData().WARNINGLOW;delete this.getView().getModel().getData().CRITICALLOW;delete this.getView().getModel().getData().TREND;delete this.getView().getModel().getData().REFERENCE_VALUE;}t.getView().byId('targetThresholdPanel').addContent(new sap.ui.core.mvc.XMLView({viewName:"sap.suite.ui.smartbusiness.designtime.evaluation.view.createEvalTargetThresholdTrendInput",viewData:{controller:t}}));}if(!this.getView().getModel().getData().INDICATOR){this.getView().byId('targetThresholdPanel').setVisible(false);this.getView().byId("additionalMeasures").setVisible(false);this.getView().byId("additionalMeasureLabel").setVisible(false);this.getView().byId("selectedLabel").setVisible(true);this.getView().byId("selectedadditionalMeasures").setVisible(true);}this.getView().getModel().setProperty("TREND",a);this.getView().getModel().setProperty("REFERENCE_VALUE",r);},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=jQuery.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.Table({showNoData:true,columns:[new sap.m.Column({}),new sap.m.Column({}),new sap.m.Column({})],layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){a.getBeginButton().setEnabled(false);}else{a.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.ColumnListItem({cells:[new sap.m.ObjectIdentifier({title:"{additionalLanguageListModel>TITLE}",text:"{additionalLanguageListModel>DESCRIPTION}",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),}),new sap.m.Label({text:"{additionalLanguageListModel>LANGUAGE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.setEnable();},})]}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),required:true,layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){var s=t.languageTextInput.getValue().replace(/\s+/g,'');if(s===""){t.languageTextInput.setValueState(sap.ui.core.ValueState.Error);}else{t.languageTextInput.setValueState(sap.ui.core.ValueState.None);}if(t.languageTextInput.getValue()&&s!==""){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getKey()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"TITLE":t.languageTextInput.getValue(),"DESCRIPTION":t.languageDescriptionInput.getValue(),"LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getKey(),"LANGUAGE":t.languageKeySelect.getSelectedItem().getText()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}t.setEnable();}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close();}})});var d=jQuery.extend(true,[],t.SAP_LANGUAGE_ARRAY,[]);for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));this.setEnable();a.open();},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},formatLangCount:function(v){if(!this.getView().getModel().getData()){v=0;}else v=this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES;return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},convert:function(v){jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");var a=sap.ca.ui.model.format.NumberFormat.getInstance({style:"standard",decimals:v});var n=a.format(0);return n;},validateEvaluationValues:function(d){d=d||this.getView().getModel().getData();var v=[];var e=[];var s=0;var c={};if(d.CRITICALLOW||d.CRITICALLOW===0){v.push({key:"CL",value:d.CRITICALLOW,score:s++});}if(d.WARNINGLOW||d.WARNINGLOW===0){v.push({key:"WL",value:d.WARNINGLOW,score:s++});}if(d.TARGET||d.TARGET===0){v.push({key:"TA",value:d.TARGET,score:s++});}if(d.WARNINGHIGH||d.WARNINGHIGH===0){v.push({key:"WH",value:d.WARNINGHIGH,score:s++});}if(d.CRITICALHIGH||d.CRITICALHIGH===0){v.push({key:"CH",value:d.CRITICALHIGH,score:s++});}v.sort(function(a,b){return(a.value-b.value)});for(var i=0,l=v.length;i<l;i++){if(v[i].score!=i){e.push(v[i].key);}if(v[i]&&v[i-1]){if(v[i].value==v[i-1].value){c[v[i-1].key]=v[i-1].value;c[v[i].key]=v[i].value;}}}if(!(e.length)){e=Object.keys(c);}return e;},resetAdditionalMeasures:function(){var t=this;if(t.getView().getModel().getData().ODATA_URL&&t.getView().getModel().getData().ODATA_ENTITYSET){if(t.measureDialog){var m=t.populateMeasure(t.getView().getModel().getData().ODATA_URL,t.getView().getModel().getData().ODATA_ENTITYSET);t.measuresDialog.setModel(m);}}else{if(t.measureDialog){var m=new sap.ui.model.json.JSONModel({});t.measuresDialog.setModel(m);}}t.getView().byId("additionalMeasures").removeAllTokens();},isCDSMode:function(m){return m==this.CDS;},isHANAMode:function(m){return m!=this.CDS;},createMeasuresDialog:function(){this.parentController=this.getView().getController();var t=this;var d=this.parentController.getView().getModel().getData().ODATA_URL;var D=this.parentController.getView().getModel().getData().ODATA_ENTITYSET;if(!(d&&D)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_WRONG_ENTITY_SET")});t.errorState=true;return;}var m=this.populateMeasure(d,D);t.measuresDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),multiSelect:true,items:{path:"/measures",template:new sap.m.StandardListItem({title:"{measureName}",})},confirm:function(e){var s=e.getParameter("selectedItems");for(var k in s){t.byId("additionalMeasures").addToken(new sap.m.Token({text:s[k].getTitle()}));t.measuresDialog.removeItem(s[k]);}t.selectedMeasure();}});t.measuresDialog.setModel(m);},selectedMeasure:function(){var t=this;t.byId("selectedadditionalMeasures").setVisible(true);t.byId("selectedLabel").setVisible(true);var m=[];m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("selectedadditionalMeasures").setVisible(false);t.byId("selectedLabel").setVisible(false);t.byId("selectedadditionalMeasures").setText("");}else{var s="";for(var i=0;i<m.length;i++){if(i==0){s=s+m[i].getText();}else{s=s+", "+m[i].getText();}}t.byId("selectedadditionalMeasures").setText(s);}},multiMeasureTokenChange:function(e){var t=this;if(e.getParameter("type")=="removed"){if(!t.measuresDialog){t.createMeasuresDialog();}var a=e.getParameter("token");var m=[];m=t.measuresDialog.getModel().getData().measures;for(var i=0;i<m.length;i++){if(m[i].measureName===a.getText()){t.measuresDialog.addItem(new sap.m.StandardListItem({title:a.getText(),}));}}t.selectedMeasure();}var m=[];m=t.byId("additionalMeasures").getTokens();for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return;}else{t.byId("additionalMeasures").setValueState("None");}}},openAdditionalMeasures:function(e){var t=this;var m=this.getView().getModel().getData().COLUMN_NAME;if(!m||m===""){t.byId("valueMeasureInput").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("SELECT_VALUE_MEASURE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("SELECT_VALUE_MEASURE")});t.errorState=true;return;}if(!t.measuresDialog){t.createMeasuresDialog();}var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.NE,m);t.measuresDialog.getBinding("items").filter([f],false);var a=t.measuresDialog.getItems();var b=t.byId("additionalMeasures").getTokens();for(var i=0;i<b.length;i++){for(var j=0;j<a.length;j++){if(b[i].getText()===a[j].getTitle()){t.measuresDialog.removeItem(a[j]);}}}t.measuresDialog.open();},generateEvalId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateEvaluationId(x);var i;p.done(function(e){i=e;c.getView().getModel().getData().ID=i;c.getView().getModel().updateBindings();});},multiMeasureChange:function(v){var t=this;var m=[];m=t.byId("additionalMeasures").getValue().split(",");for(var i=0;i<m.length;i++){t.byId("additionalMeasures").setValue("");t.byId("additionalMeasures").addToken(new sap.m.Token({text:m[i]}));}m=t.byId("additionalMeasures").getTokens();if(m.length==0){t.byId("additionalMeasures").setValueState("None");}for(var i=0,l=m.length;i<l;i++){if(m[i].getText()==t.getView().getModel().getData().COLUMN_NAME){t.byId("additionalMeasures").setValueState("Error");return;}else{t.byId("additionalMeasures").setValueState("None");}}},_areEvaluationValuesNumber:function(d){var e=[];if((d.CRITICALLOW&&isNaN(d.CRITICALLOW))||(d.CRITICALHIGH&&isNaN(d.CRITICALHIGH))){e.push("CRITICAL");}if((d.WARNINGLOW&&isNaN(d.WARNINGLOW))||(d.WARNINGHIGH&&isNaN(d.WARNINGHIGH))){e.push("WARNING");}if(d.TARGET&&isNaN(d.TARGET)){e.push("TARGET");}return e;},scaleFactorChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},decimalPrecisionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());}});
