/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.IDGenerator");jQuery.sap.includeStyleSheet("../../resources/sap/suite/ui/smartbusiness/designtime/kpi/view/KpiParametersCss.css");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.kpi.view.S1",{onInit:function(){var t=this;this.RESERVED_KPI_ID_NAMESPACE=".sap.sample";this.HANA="hana";this.CDS="cds";this.VIEW_MODE=this.HANA;var u;this.errorMessages=[];this.errorState=false;jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:t.byId("kpiId"),controllerReference:t,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateKpiId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");if(u=jQuery.sap.getUriParameters().get("viewmode")){if(u.toLowerCase&&u.toLowerCase()==this.CDS)this.VIEW_MODE=this.CDS;}this.getView().getModel().oData["VIEW_MODE"]=this.VIEW_MODE;this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");sap.suite.ui.smartbusiness.sb_createkpi=this;this.kpiCreateModel=new sap.ui.model.json.JSONModel();this.oDataModel=this.oApplicationFacade.getODataModel();if(this.VIEW_MODE==this.CDS){this.oDataModelCDS=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SSB/CDS_ODATA_ENTITY_FETCH_SRV_01");this.oDataModelCDS.attachMetadataFailed(function(s){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_CDS_MODE"))});this.byId("kpiId").setMaxLength(40);}else if(this.VIEW_MODE==this.HANA){this.byId("kpiId").setMaxLength(512);}this.viewData={};this.oResourceBundle=this.oApplicationFacade.getResourceBundle();var l=function(o,a,b){t.SAP_LANGUAGES=o;t.SAP_LANGUAGE_ARRAY=a;t.localLanguage=b;};this.metadataRef.getAllLanguages({async:false,success:l,model:this.oDataModel});this.oOptions={bSuppressBookmarkButton:{},onBack:function(){t.cancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},buttonList:[{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(e){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.oErrorOptions={bSuppressBookmarkButton:{},onBack:function(){t.cancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(e){t.saveAndCreateNew();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"ACTIVATE_CREATE_NEW",onBtnPressed:function(e){t.activateAndCreateNew();}},{sI18nBtnTxt:"ACTIVATE_ADD_EVAL",onBtnPressed:function(e){t.activateAndAddEvaluation();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.editDraftOptions={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},buttonList:[{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.oErrorOptionsForDraft={bSuppressBookmarkButton:{},sI18NFullscreenTitle:"FULLSCREEN_EDIT_TITLE",onBack:function(){t.cancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.save();}},{sI18nBtnTxt:"SAVE_ACTIVATE",onBtnPressed:function(e){t.saveAndActivate();}},{sI18nBtnTxt:"DELETE_DRAFT",onBtnPressed:function(e){t.deleteDraft();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.cancel();}}]};this.valid_maxlength={};this.valid_maxlength.hana={id:512,title:128,};this.valid_maxlength.cds={id:40,title:40,};this.setHeaderFooterOptions(this.oOptions);this.byId("kpiGoalTypeSelect").attachChange(function goalTypeChange(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());});this.oRouter.attachRouteMatched(function(c){t.route=c.getParameter("name");if(c.getParameter("name")=="editKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(g)};if(t.viewData.IS_ACTIVE==1){t.viewData.IS_DRAFT=true;}t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(c.getParameter("name")=="editDraftKpi"){t.editDraft=true;t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"EDIT",ID:k,IS_ACTIVE:parseInt(g),IS_DRAFT:true};t.setHeaderFooterOptions(t.editDraftOptions);t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"));}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+t.oResourceBundle.getText("FULLSCREEN_EDIT_TITLE"))}}else if(c.getParameter("name")=="duplicateKpi"){t.context=new sap.ui.model.Context(t.getView().getModel(),'/'+(c.getParameter("arguments").contextPath));var d=(/ID=\'.*\'/).exec(c.getParameter("arguments").contextPath)[0];var k=d.slice(d.indexOf("'")+1,d.lastIndexOf("'"));var f=(/IS_ACTIVE=.*/).exec(c.getParameter("arguments").contextPath)[0];var g=f.slice(f.indexOf("=")+1,f.lastIndexOf(")"));t.viewData={mode:"DUPLICATE",ID:k,IS_ACTIVE:parseInt(g)};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));}else{t.viewData={mode:"CREATE",};t._oControlStore.oTitle.setText(t.oResourceBundle.getText("FULLSCREEN_TITLE"));}if(t.viewData.mode=="CREATE"){var h={};h.MODE="CREATE";h.TYPE="KPI";h.KPITYPE=true;h.OPITYPE=false;h.NO_OF_ADDITIONAL_LANGUAGES=0;h.ADDITIONAL_LANGUAGE_ARRAY=[];h.GOAL_TYPE="MA";h.VIEW_MODE=t.VIEW_MODE;t.kpiModelDataForDirtyBitCheck=$.extend(true,{},h);t.kpiCreateModel.setData(h);t.getView().setModel(t.kpiCreateModel);t.generateKpiId(t);}else if(t.viewData.mode=="EDIT"||t.viewData.mode=="DUPLICATE"){var j=function(a){var b=a.INDICATOR;t.indicatorPayloadForDirtyBitTest=$.extend(true,{},b);var o=a.TAGS;var p=a.PROPERTIES;var q=a.TEXTS;b.MODE=t.viewData.mode;b.VIEW_MODE=t.VIEW_MODE;if(b.TYPE=="KPI"){b.KPITYPE=true;b.OPITYPE=false;}else if(b.TYPE=="OPI"){b.KPITYPE=false;b.OPITYPE=true;}o=(o.results)?o.results:o;var r=[];var i;for(i=0;i<o.length;i++){r.push(o[i].TAG);}b.TAGS=r;b.TAG=b.TAGS.toString(",");t.OLD_TAGS=r;p=(p.results)?p.results:p;var s=[];var i;for(i=0;i<p.length;i++){var v={};v.NAME=p[i].NAME,v.VALUE=p[i].VALUE;s.push(v);}b.PROPERTIES=s;t.OLD_PROPERTIES=$.extend(true,[],s);q=(q.results)?q.results:q;var w=[];var i;for(i=0;i<q.length;i++){if(q[i].LANGUAGE!=t.localLanguage){w.push(q[i]);}}var x=[];var i;for(i=0;i<w.length;i++){var y={};y.ADDITIONAL_LANGUAGE_TITLE=w[i].TITLE;y.ADDITIONAL_LANGUAGE_DESCRIPTION=w[i].DESCRIPTION;y.ADDITIONAL_LANGUAGE_SPRAS_KEY=w[i].LANGUAGE;if(t.SAP_LANGUAGES){y.ADDITIONAL_LANGUAGE_KEY=t.SAP_LANGUAGES.SPRAS[w[i].LANGUAGE];}else{y.ADDITIONAL_LANGUAGE_KEY="";}x.push(y);}b.ADDITIONAL_LANGUAGE_ARRAY=x;b.NO_OF_ADDITIONAL_LANGUAGES=b.ADDITIONAL_LANGUAGE_ARRAY.length;t.OLD_ADDITIONAL_LANGUAGE_ARRAY=x;t.kpiCreateModel.setData(b);t.getView().setModel(t.kpiCreateModel);if(b.MODE=="EDIT"){t.getView().byId("kpiId").setEditable(false);}if(b.MODE=="DUPLICATE"){t.generateKpiId(t);}};var m=function(a){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("YMSG_ERROR_RETRIEVING_DATA")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};t.metadataRef.getKPIById({ID:t.viewData.ID,IS_ACTIVE:t.viewData.IS_ACTIVE,texts:true,tags:true,properties:true,async:false,entity:"INDICATORS",success:j,error:m,model:t.oDataModel});}var n=t.getView().byId('kpiParameterInputForm');n.addContent(new sap.m.Label({text:t.oResourceBundle.getText("PROPERTY_NAME_VALUE")}));if(t.viewData.mode==="EDIT"||t.viewData.mode==="DUPLICATE"){t.byId("odataServiceInput").fireChange();}t.getView().byId("propertyNameValueBox").bindAggregation("items","/PROPERTIES",function(a,b){return new sap.ui.layout.Grid({content:[new sap.m.Input({value:"{NAME}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Input({value:"{VALUE}",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"})}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(c){t.removeProperty(c);}})],defaultSpan:"L12 M12 S12"}).addStyleClass("propertyEntryGrid");});});},onAfterRendering:function(){this.byId("kpiGoalTypeSelect").setTooltip(this.byId("kpiGoalTypeSelect").getSelectedItem().getText());},setFooterOnError:function(){var t=this;if(this.editDraft===true){if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oErrorOptionsForDraft);}else{this.setHeaderFooterOptions(this.editDraftOptions);}}else{if(this.errorMessages.length>1){this.setHeaderFooterOptions(this.oErrorOptions);}else{this.setHeaderFooterOptions(this.oOptions);}}},save:function(){var t=this;t.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){if(this.viewData.IS_DRAFT){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}else{if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=0)"});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({});}}}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}},activateAndAddEvaluation:function(){var t=this;var s=false;var a=false;t.errorMessages=[];t.errorState=false;s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}a=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_OPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}a=false;});}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}if(a){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPIEvaluation",route:"addEvaluation",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}},saveAndCreateNew:function(){var t=this;this.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI"});t.generateKpiId(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(this);}},activateAndCreateNew:function(){var t=this;this.errorMessages=[];this.errorState=false;var s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}activationStatus=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}activationStatus=false;});}if(activationStatus){var k={};k.MODE="CREATE";k.NO_OF_ADDITIONAL_LANGUAGES=0;k.ADDITIONAL_LANGUAGE_ARRAY=[];k.GOAL_TYPE="MA";k.KPITYPE=true;k.OPITYPE=false;k.TYPE="KPI";this.kpiCreateModel.setData(k);this.getView().setModel(this.kpiCreateModel);this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;this.getView().getModel().getData().TYPE="KPI";this.getView().byId("KPI").setSelected(true);this.getView().byId("OPI").setSelected(false);this.getView().getModel().updateBindings();this.getView().byId('kpiId').setEditable(true);this.getView().byId('viewInput').fireChange();this.kpiModelDataForDirtyBitCheck=$.extend(true,{},k);sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"createSBKPI"});t.generateKpiId(t);}},saveAndActivate:function(){var t=this;var s=false;var a=false;this.errorMessages=[];this.errorState=false;s=this.saveKpiDetails();if(s){var p={ID:this.getView().getModel().getData().ID};t.metadataRef.create('ACTIVATE_INDICATOR',p,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_KPI_SUCCESS"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("ACTIVATE_OPI_SUCCESS"));}a=true;},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_KPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_KPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ACTIVATE_OPI_ERROR"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ACTIVATE_OPI_ERROR")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}a=false;});}if(a){if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+this.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({});}}},deleteDraft:function(){var t=this;var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_DELETE_DRAFT_KPI_OPI")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){b.close();t.callDeleteDraft();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){b.close();}})});b.open();},callDeleteDraft:function(){var t=this;var p={};p.ID=t.viewData.ID;p.IS_ACTIVE=t.viewData.IS_ACTIVE;t.metadataRef.remove('INDICATOR',p,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_DELETE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_DELETE"));}sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"SBWorkspace",route:"detail",context:"INDICATORS_MODELER(ID='"+t.getView().getModel().getData().ID+"',IS_ACTIVE=1)"});},function(e){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_DELETE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_DELETE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_DELETE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_DELETE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}});},cancel:function(){var t=this;var i=false;var l=false;var a=false;var p=false;if(this.route==="createKpi"){if(t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY&&t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY.length){l=true;}if((t.kpiCreateModel.getData().TAGS&&t.kpiCreateModel.getData().TAGS.length)||t.kpiCreateModel.getData().TAG){a=true;}if(t.kpiCreateModel.getData().PROPERTIES&&t.kpiCreateModel.getData().PROPERTIES.length){p=true;}delete t.kpiModelDataForDirtyBitCheck.ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiModelDataForDirtyBitCheck.TAG;delete t.kpiModelDataForDirtyBitCheck.TAGS;delete t.kpiModelDataForDirtyBitCheck.PROPERTIES;delete t.kpiCreateModel.getData().ADDITIONAL_LANGUAGE_ARRAY;delete t.kpiCreateModel.getData().TAG;delete t.kpiCreateModel.getData().TAGS;delete t.kpiCreateModel.getData().PROPERTIES;var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.kpiModelDataForDirtyBitCheck,newPayload:t.kpiCreateModel.getData(),objectType:"INDICATORS"});if(b&&b.updates.length){i=true;}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{window.history.back();}}else{var d=t.getIndicatorChanges();var e=t.getTagChanges();var f=t.getPropertiesChanges();var g=t.getLanguageChanges();if(d&&(d.updates.length)){i=true;}if(g&&(g.updates.length||g.deletes.length)){l=true;}if(e&&(e.updates.length||e.deletes.length)){a=true;}if(f&&(f.updates.length||f.deletes.length)){p=true;}if(i||l||a||p){var c=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oResourceBundle.getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oResourceBundle.getText("WARNING_UNSAVED_MESSAGE")})],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("CONTINUE"),press:function(){c.close();window.history.back();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){c.close();}})});c.open();}else{window.history.back();}}},saveKpiDetails:function(){var t=this;var k=this.kpiCreateModel.getData();var s=true;var d={errorMsg:[]};t.isPropertyAdded=true;if(t.getView().byId("kpiPropertyName").getValue()||t.getView().byId("kpiPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var a={"ID":k.ID||"","IS_ACTIVE":0,"INDICATOR":{"DESCRIPTION":k.DESCRIPTION||"","GOAL_TYPE":k.GOAL_TYPE||"","TITLE":k.TITLE||"","TYPE":k.TYPE||"","OWNER_E_MAIL":k.OWNER_E_MAIL||"","OWNER_ID":k.OWNER_ID||"","OWNER_NAME":k.OWNER_NAME||"","COLUMN_NAME":k.COLUMN_NAME||"","DATA_SPECIFICATION":k.DATA_SPECIFICATION||"","ODATA_URL":k.ODATA_URL||"","ODATA_ENTITYSET":k.ODATA_ENTITYSET||"","VIEW_NAME":k.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":k.SEMANTIC_OBJECT||"","ACTION":k.ACTION||""}};if(!a.ID){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_KPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_KPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}s=false;}if(t.byId("kpiId").getValueState()==="Error"){if(t.kpiIdEval_reason=="NOT_START_WITH_PERIOD"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_CDS_KPI_ID_BEGIN_WITH_PERIOD")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_CDS_KPI_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;t.kpiIdEval_reason=null;}else if(t.kpiIdEval_reason=="_START_WITH_PERIOD"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_HANA_KPI_ID_BEGIN_WITH_PERIOD")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_HANA_KPI_ID_BEGIN_WITH_PERIOD"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;t.kpiIdEval_reason=null;}else{if(t.byId("kpiId").getValue()){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_ID"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}}s=false;}if(!this.validateKpiTitle()){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}}if(!a.INDICATOR.TITLE){if(this.getView().getModel().getData().TYPE==="KPI"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_KPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_KPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}else{t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_OPI_TITLE"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}this.getView().byId('kpiTitle').setValueState("Error");s=false;}if(t.byId("kpiOwnerEmail").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_KPI_EMAIL"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;s=false;}if(t.byId("semanticObject").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}if(t.byId("action").getValueState()==="Error"){t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT")});d.errorMsg.push({text:t.oResourceBundle.getText("ERROR_ENTER_VALID_SEMANTIC_OBJECT"),icon:"sap-icon://error",state:sap.ui.core.ValueState.Error});this.errorState=true;}var T=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Text({text:t.oResourceBundle.getText("ERRORHEADERSAVE")})})]});var o=new sap.m.ColumnListItem({cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{text}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.setFooterOnError();var m=new sap.ui.model.json.JSONModel();m.setData(d);T.setModel(m);T.bindAggregation("items","/errorMsg",o);if(this.errorState){var D=new sap.m.Dialog({icon:"sap-icon://error",content:[T],contentWidth:"25%",title:t.oResourceBundle.getText("ERRORCOUNT",d.errorMsg.length),state:"Error",buttons:[new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){D.close();}})]});D.open();return;}if(!t.errorState){if(this.viewData.mode=="DUPLICATE"){if(!this.validateKpiId()){return;}}if(t.viewData.mode=="CREATE"||t.viewData.mode=="DUPLICATE"||(t.viewData.mode=="EDIT"&&this.viewData.IS_ACTIVE==1)){a.TEXTS=[];a.TAGS=[];a.PROPERTIES=[];var l=t.insertLanguagePayload();var p=t.insertPropertiesPayload();var b=t.insertTagPayload();if(l.length){a.TEXTS=l;}if(p.length){a.PROPERTIES=p;}if(b.length){a.TAGS=b;}var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;t.metadataRef.create('INDICATOR',c,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"));}s=true;},function(u){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}s=false;});}else if(t.viewData.mode=="EDIT"){a.TEXTS={};a.TAGS={};a.PROPERTIES={};var e=false;var f=false;var g=false;var h=false;var j=t.getIndicatorChanges();if(j){if(j.updates.length){e=true;a.INDICATOR={};for(var i=0;i<j.updates.length;i++){a.INDICATOR.update=j.updates[i];}}}var n=t.getLanguageChanges();if(n){if(n.deletes.length){f=true;for(var i=0;i<n.deletes.length;i++){a.TEXTS.remove=n.deletes;}}if(n.updates.length){f=true;for(var i=0;i<n.updates.length;i++){a.TEXTS.create=n.updates;}}}var q=t.getTagChanges();if(q){if(q.deletes.length){g=true;for(var i=0;i<q.deletes.length;i++){a.TAGS.remove=q.deletes;}}if(q.updates.length){g=true;for(var i=0;i<q.updates.length;i++){a.TAGS.create=q.updates;}}}var r=t.getPropertiesChanges();if(r){if(r.deletes.length){h=true;for(var i=0;i<r.deletes.length;i++){a.PROPERTIES.remove=r.deletes;}}if(r.updates.length){h=true;for(var i=0;i<r.updates.length;i++){a.PROPERTIES.create=r.updates;}}}if(e||g||h||f){var c={payload:a};c.keys={};c.keys.ID=a.ID;c.keys.IS_ACTIVE=a.IS_ACTIVE;delete c.ID;delete c.IS_ACTIVE;t.metadataRef.update('INDICATOR',c,null,function(d){if(t.getView().getModel().getData().TYPE=="KPI"){sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_KPI_SAVE"));}else{sap.m.MessageToast.show(t.oResourceBundle.getText("SUCCESS_OPI_SAVE"));}s=true;},function(u){if(t.getView().getModel().getData().TYPE=="KPI"){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_KPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_KPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_OPI_SAVE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_OPI_SAVE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}s=false;});}}}return s;},getIndicatorChanges:function(){var o=this.indicatorPayloadForDirtyBitTest;var n=this.kpiCreateModel.getData();var a={"DESCRIPTION":o.DESCRIPTION||"","GOAL_TYPE":o.GOAL_TYPE||"","TITLE":o.TITLE||"","TYPE":o.TYPE||"","OWNER_E_MAIL":o.OWNER_E_MAIL||"","OWNER_ID":o.OWNER_ID||"","OWNER_NAME":o.OWNER_NAME||"","COLUMN_NAME":o.COLUMN_NAME||"","DATA_SPECIFICATION":o.DATA_SPECIFICATION||"","ODATA_URL":o.ODATA_URL||"","ODATA_ENTITYSET":o.ODATA_ENTITYSET||"","VIEW_NAME":o.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":o.SEMANTIC_OBJECT||"","ACTION":o.ACTION||""};var b={"DESCRIPTION":n.DESCRIPTION||"","GOAL_TYPE":n.GOAL_TYPE||"","TITLE":n.TITLE||"","TYPE":n.TYPE||"","OWNER_E_MAIL":n.OWNER_E_MAIL||"","OWNER_ID":n.OWNER_ID||"","OWNER_NAME":n.OWNER_NAME||"","COLUMN_NAME":n.COLUMN_NAME||"","DATA_SPECIFICATION":n.DATA_SPECIFICATION||"","ODATA_URL":n.ODATA_URL||"","ODATA_ENTITYSET":n.ODATA_ENTITYSET||"","VIEW_NAME":n.VIEW_NAME||"","ENTITY_TYPE":"","SEMANTIC_OBJECT":n.SEMANTIC_OBJECT||"","ACTION":n.ACTION||""};var i=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:a,newPayload:b,objectType:"INDICATORS"});return i;},getLanguageChanges:function(){var t=this;this.languagePayloadForDirtyBitTest=[];var n=this.insertLanguagePayload();for(var i=0;i<this.OLD_ADDITIONAL_LANGUAGE_ARRAY.length;i++){var l={};l.LANGUAGE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=this.OLD_ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;this.languagePayloadForDirtyBitTest.push(l);}var a=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:n,objectType:"INDICATOR_TEXTS"});return a;},getTagChanges:function(){var t=this;this.tagPayloadForDirtyBitTest=[];var n=this.insertTagPayload();var o=[];for(var i=0;i<t.OLD_TAGS.length;i++){var a={};a.TAG=t.OLD_TAGS[i];a.TYPE="IN";this.tagPayloadForDirtyBitTest.push(a);}var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.tagPayloadForDirtyBitTest,newPayload:n,objectType:"TAGS"});return b;},getPropertiesChanges:function(){var t=this;this.propertiesPayloadForDirtyBitTest=[];var n=this.insertPropertiesPayload();for(var i=0;i<this.OLD_PROPERTIES.length;i++){var p={};p.TYPE="IN";p.NAME=t.OLD_PROPERTIES[i].NAME;p.VALUE=t.OLD_PROPERTIES[i].VALUE;this.propertiesPayloadForDirtyBitTest.push(p);}var a=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.propertiesPayloadForDirtyBitTest,newPayload:n,objectType:"PROPERTIES"});return a;},insertLanguagePayload:function(){var k=this.kpiCreateModel.getData();var l={};var a=[];if(k.NO_OF_ADDITIONAL_LANGUAGES>0){var i;for(i=0;i<k.NO_OF_ADDITIONAL_LANGUAGES;i++){l={};l.LANGUAGE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_SPRAS_KEY;l.TITLE=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_TITLE;l.DESCRIPTION=k.ADDITIONAL_LANGUAGE_ARRAY[i].ADDITIONAL_LANGUAGE_DESCRIPTION;a.push(l);}}return a;},insertTagPayload:function(){var k=this.kpiCreateModel.getData();var t={};var a=[];if(k.TAG){var b=k.TAG.split(",");var i;for(i=0;i<b.length;i++){t={};t.TYPE="IN";t.TAG=b[i];a.push(t);}}return a;},insertPropertiesPayload:function(){var k=this.kpiCreateModel.getData();var p={};var a=[];if(k.PROPERTIES){var i;for(i=0;i<k.PROPERTIES.length;i++){p={};p.TYPE="IN";p.NAME=k.PROPERTIES[i].NAME;p.VALUE=k.PROPERTIES[i].VALUE;a.push(p);}}return a;},addAdditionalLanguageDialog:function(){var t=this;this.additionalLanguageListModel=new sap.ui.model.json.JSONModel();this.additionalLanguageListModelData=$.extend([],t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY);this.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=this.additionalLanguageListModelData.length;this.additionalLanguageListModel.setData(this.additionalLanguageListModelData);this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.TextArea({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({showNoData:false,layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),});this.setEnable=function(){if(this.addedLanguagesList.getItems().length==0){a.getBeginButton().setEnabled(false);}else{a.getBeginButton().setEnabled(true);}};this.addedLanguagesList.bindItems("additionalLanguageListModel>/",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_TITLE}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_DESCRIPTION}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{additionalLanguageListModel>ADDITIONAL_LANGUAGE_KEY}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var b=e.getSource().getBindingContext("additionalLanguageListModel").getPath().substr(1);var n=t.addedLanguagesList.getModel("additionalLanguageListModel").getData().splice(b,1);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));this.addedLanguagesList.setModel(t.additionalLanguageListModel,"additionalLanguageListModel");var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oResourceBundle.getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oResourceBundle.getText("TITLE"),textAlign:"Right",required:true,layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oResourceBundle.getText("DESCRIPTION"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oResourceBundle.getText("LANGUAGE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()==""){t.languageTextInput.setValueState(sap.ui.core.ValueState.Error);}else{t.languageTextInput.setValueState(sap.ui.core.ValueState.None);}if(t.languageTextInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("additionalLanguageListModel").getData().length;i++){if(t.addedLanguagesList.getModel("additionalLanguageListModel").getData()[i].ADDITIONAL_LANGUAGE_KEY===t.languageKeySelect.getSelectedItem().getText()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"ADDITIONAL_LANGUAGE_TITLE":t.languageTextInput.getValue(),"ADDITIONAL_LANGUAGE_DESCRIPTION":t.languageDescriptionInput.getValue(),"ADDITIONAL_LANGUAGE_KEY":t.languageKeySelect.getSelectedItem().getText(),"ADDITIONAL_LANGUAGE_SPRAS_KEY":t.languageKeySelect.getSelectedItem().getKey()};t.addedLanguagesList.getModel("additionalLanguageListModel").getData().push(b);t.addedLanguagesList.getModel("additionalLanguageListModel").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}t.setEnable();}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oResourceBundle.getText("OK"),press:function(){a.close();t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY=t.addedLanguagesList.getModel("additionalLanguageListModel").getData();t.getView().getModel().getData().NO_OF_ADDITIONAL_LANGUAGES=t.getView().getModel().getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.getView().getModel().updateBindings();}}),endButton:new sap.m.Button({text:t.oResourceBundle.getText("CANCEL"),press:function(){a.close();}})});var d=jQuery.extend(true,[],t.SAP_LANGUAGE_ARRAY,[]);for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}var m=new sap.ui.model.json.JSONModel();m.setData(d);t.languageKeySelect.setModel(m,"otherLanguageKey");t.languageKeySelect.bindItems("otherLanguageKey>/",new sap.ui.core.Item({text:"{otherLanguageKey>LAISO}",key:"{otherLanguageKey>SPRAS}"}));this.setEnable();a.open();},addNewProperty:function(){var t=this;if(this.getView().byId("kpiPropertyName").getValue()){this.getView().byId("kpiPropertyName").setValueState("None");if(this.getView().byId("kpiPropertyValue").getValue()){this.getView().byId("kpiPropertyValue").setValueState("None");var p=this.getView().byId('propertyNameValueBox').getModel();p.getData().PROPERTIES=p.getData().PROPERTIES||[];for(var i=0;i<p.getData().PROPERTIES.length;i++){if((p.getData().PROPERTIES[i].NAME===this.getView().byId("kpiPropertyName").getValue())&&(p.getData().PROPERTIES[i].VALUE===this.getView().byId("kpiPropertyValue").getValue())){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_PROPERTY_VALUE_PAIR_EXISTS")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);return;}}p.getData().PROPERTIES.push({NAME:this.getView().byId("kpiPropertyName").getValue(),VALUE:this.getView().byId("kpiPropertyValue").getValue()});p.updateBindings();this.getView().byId("kpiPropertyName").setValue("");this.getView().byId("kpiPropertyValue").setValue("");}else{t.isPropertyAdded=false;this.getView().byId("kpiPropertyValue").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_VALUE"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ENTER_PROPERTY_VALUE")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}else{t.isPropertyAdded=false;this.getView().byId("kpiPropertyName").setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ENTER_PROPERTY_NAME"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ENTER_PROPERTY_NAME")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}},removeProperty:function(e){var p=e.getSource().getBindingContext().getPath();e.getSource().getBindingContext().getModel().getData().PROPERTIES.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext().getModel().updateBindings();},kpiOpiRadioButtonChange:function(e){if(this.getView().byId('KPI').getSelected()==true){this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;}else{this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true;}if(this.getView().byId('OPI').getSelected()==true){this.getView().getModel().getData().TYPE="OPI";this.getView().getModel().getData().KPITYPE=false;this.getView().getModel().getData().OPITYPE=true;}else{this.getView().getModel().getData().TYPE="KPI";this.getView().getModel().getData().KPITYPE=true;this.getView().getModel().getData().OPITYPE=false;}},validateKpiId:function(){var k=this.getView().byId('kpiId');var t=this;var s=false;var a=k.getValue();if(this.VIEW_MODE==this.CDS){k.setValue(a.toUpperCase());}if(a){if(a.lastIndexOf(this.RESERVED_KPI_ID_NAMESPACE,0)===0){k.setValueState("Error");s=false;}else if(this.VIEW_MODE==this.CDS&&a[0]!='.'){this.kpiIdEval_reason="NOT_START_WITH_PERIOD";k.setValueState("Error");s=false;}else if(this.VIEW_MODE==this.HANA&&a[0]=='.'){this.kpiIdEval_reason="_START_WITH_PERIOD";k.setValueState("Error");s=false;}else if(!(/^[a-zA-Z0-9.]*$/.test(a))||a.length>this.valid_maxlength[this.VIEW_MODE].id){k.setValueState("Error");s=false;}else{k.setValueState("None");var i=function(c){if(c[0]){k.setValueState("Error");sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ID_ALREADY_EXISTS"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ID_ALREADY_EXISTS")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);s=false;}else{k.setValueState("None");s=true;}};var b=function(){k.setValueState("None");s=true;};this.metadataRef.getDataByEntity({entity:"INDICATORS",filter:"ID eq '"+a+"'",async:false,success:i,error:b,model:this.oDataModel});}}return s;},validateKpiTitle:function(){var k=this.getView().byId('kpiTitle');var a=k.getValue();if(!a){k.setValueState("None");return true;}if(a.length>this.valid_maxlength[this.VIEW_MODE].title){k.setValueState("Error");return false}else{k.setValueState("None");return true;}},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},formatSemanticActionLabel:function(v){return v+"/"+this.oApplicationFacade.getResourceBundle().getText("ACTION");},validateEmailAddress:function(){var k=this.getView().byId('kpiOwnerEmail');var a=k.getValue();if(a){if(!(/^\w+[\w-\.]*\@\w+((-\w+)|(\w*))\.[a-z]/.test(a))){k.setValueState("Error");}else{k.setValueState("None");}}else{k.setValueState("None");}},populateRelevantEntitySet:function(d){var t=this;var m=this.getView().getModel().getData();t.metadataRef.populateRelevantEntitySet(d,m,t);},populateRelevantEntitySet_CDS:function(d){var s=encodeURIComponent(this.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(this.getView().getModel().getProperty("/ODATA_URL"));var e="EntityTypeSet";var u="/ODATAnameSet(CdsName='"+s+"\',OdataName='',OdataURL='"+a+"',SrvName='',SrvVersion='',SrvNamespace='')/?$expand="+e;this.oDataModelCDS.read(u,null,null,false,function(b){var b=b[e].results;var c=new sap.ui.model.json.JSONModel();c.setData(b);d.setModel(c);d.open();});},handleHanaViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/HANA_VIEWS",template:new sap.m.StandardListItem({title:{parts:[{path:"OBJECT",type:new sap.ui.model.type.String()},{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"SUFFIX",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){if(s.indexOf("view")!=-1)return p+"/"+o;else return p+"::"+o;}},description:"{SUFFIX}"})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.byId("viewInput").fireChange();},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(this.oDataModel);h.open();},handleCDSViewValueHelp:function(){var t=this;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_VIEW"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"PackName",type:new sap.ui.model.type.String()},{path:"CdsName",type:new sap.ui.model.type.String()}],formatter:function(p,c){return p+"::"+c;}}})},confirm:function(e){t.getView().getModel().setProperty("/VIEW_NAME",e.getParameter("selectedItem").getProperty("title"));t.getView().getModel().setProperty("/VIEW_NAME_CdsName",e.getParameter("selectedItem").getBindingContext().getProperty("CdsName"));t.getView().getModel().setProperty("/VIEW_NAME_PackName",e.getParameter("selectedItem").getBindingContext().getProperty("PackName"));t.byId("viewInputCDS").fireChange();},liveChange:function(e){var i,s,a,b,c;s=a=b=e.getParameter("value").toUpperCase();c=false;if((i=s.lastIndexOf("::"))!==-1){a=s.substring(0,i);b=s.substring(i+2,s.length);c=true;}var f=new sap.ui.model.Filter("PackName",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("CdsName",sap.ui.model.FilterOperator.Contains,b);var B=e.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f,F],c));}});this.oDataModelCDS.read("/CDSViewSet",null,null,false,function(d){var d=d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);h.setModel(c);});h.open();},handleHanaViewInputChange:function(){this.getView().getModel().getData().ODATA_URL="";this.getView().getModel().getData().ODATA_ENTITYSET="";this.getView().getModel().getData().COLUMN_NAME="";this.getView().getModel().updateBindings();},handleOdataServiceValueHelp:function(){var t=this;if(!t.byId("viewInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_HANA_VIEW")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{var a=t.getView().getModel().getProperty("/VIEW_NAME");a=(a.indexOf("/")!=-1?a.split("/"):a.split("::"));var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/ODATA_FOR_ENTITY(P_PACKAGE='"+a[0]+"',P_OBJECT='"+a[1]+"')/Results",template:new sap.m.StandardListItem({title:{parts:[{path:"PACKAGE",type:new sap.ui.model.type.String()},{path:"OBJECT",type:new sap.ui.model.type.String()}],formatter:function(o,p,s){o=o.replace(/\./g,'/');return"/"+o+"/"+p+".xsodata";}},})},confirm:function(e){t.getView().getModel().setProperty("/ODATA_URL",e.getParameter("selectedItem").getProperty("title"));},liveChange:function(e){var s="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(PACKAGE)",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("tolower(OBJECT)",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oDataModel);h.open();}},handleOdataServiceValueHelpCDS:function(){var t=this;if(!t.byId("viewInputCDS").getValue()){var r="/PackOdataSet";var e=null;}else{var s=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_CdsName"));var a=encodeURIComponent(t.getView().getModel().getProperty("/VIEW_NAME_PackName"));var r="/CDSViewSet(CdsName='"+s+"')/?$expand=ODATAnameSet";var e="ODATAnameSet";}var b=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ODATA_SERVICE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"OdataURL",type:new sap.ui.model.type.String()}],formatter:function(o){return(function(h){return jQuery("<a>").attr("href",h)[0]["pathname"]})(o);}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_URL",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var c=E.getParameter("value");var f=new sap.ui.model.Filter("OdataURL",sap.ui.model.FilterOperator.Contains,c);var B=E.getSource().getBinding("items");B.filter(new sap.ui.model.Filter([f],false));}});this.oDataModelCDS.read(r,null,null,false,function(d){var d=e?d[e].results:d.results;var c=new sap.ui.model.json.JSONModel();c.setData(d);b.setModel(c);});b.open();},handleEntitySetValueHelp:function(){var t=this;var a=this.VIEW_MODE==this.CDS?"odataServiceInputCDS":"odataServiceInput";if(!t.byId(a).getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ODATA_SERVICE_URL")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{var t=this;t.oModelForEntity;var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/entitySet",template:new sap.m.StandardListItem({title:{parts:[{path:"entityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});var C=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_ENTITY_SET"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/",template:new sap.m.StandardListItem({title:{parts:[{path:"EntityName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},})},confirm:function(E){t.getView().getModel().setProperty("/ODATA_ENTITYSET",E.getParameter("selectedItem").getProperty("title"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("entityName",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});try{if(t.getView().getModel().getData().VIEW_NAME){if(this.VIEW_MODE!=this.CDS){t.populateRelevantEntitySet(h);}else{t.populateRelevantEntitySet_CDS(C);}}else{t.oModelForEntity=t.populateEntitySet(t.getView().byId(a).getValue());h.setModel(t.oModelForEntity);h.open();}}catch(e){}}},handleMeasureValueHelp:function(){var t=this;if(!t.byId("entitySetInput").getValue()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET"));t.errorMessages.push({"type":"Error","title":t.oResourceBundle.getText("ERROR_ENTER_ENTITY_SET")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{try{t.oModelForMeasure=t.populateMeasure(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));t.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(t.getView().getModel().getProperty("/ODATA_URL"),t.getView().getModel().getProperty("/ODATA_ENTITYSET"));var m=t.mProperties.getLabelMappingObject();var a=t.oModelForMeasure.getData().measures;for(var i=0,l=a.length;i<l;i++){a[i].measureLabel=m[a[i].measureName];}t.oModelForMeasure.setData({measures:a});}catch(e){}var h=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_MEASURE"),noDataText:t.oResourceBundle.getText("NO_DATA_FOUND"),items:{path:"/measures",template:new sap.m.StandardListItem({title:{parts:[{path:"measureLabel",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}},description:{parts:[{path:"measureName",type:new sap.ui.model.type.String()}],formatter:function(o,s){return o;}}})},confirm:function(E){t.getView().getModel().setProperty("/COLUMN_NAME",E.getParameter("selectedItem").getBindingContext().getProperty("measureName"));},liveChange:function(E){var s=E.getParameter("value");var f=new sap.ui.model.Filter("measureName",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("measureLabel",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f,F],false));}});h.setModel(t.oModelForMeasure);h.open();}},handleChangeAdditionalInfo:function(e){var t=this;t.getView().getModel().setProperty("info",t.getView().byId("additionalInfoId"));},validateSemantic:function(e){var t=this;var s=t.getView().byId("semanticObject");if(e.getParameter("value").indexOf(' ')===-1){this.byId(e.getParameter("id")).setValueState("None");}else{this.byId(e.getParameter("id")).setValueState("Error");}},populateEntitySet:function(d){var c=this;var m=new sap.ui.model.json.JSONModel();var r=[],e=[],o={};var i;r=sap.suite.ui.smartbusiness.lib.Util.odata.getAllEntitySet(d);for(i=0;i<r.length;i++){o={};o.entityName=r[i];e.push(o);}m.setData({entitySet:e});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},populateMeasure:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var m=[],a=[],o={};var i;m=sap.suite.ui.smartbusiness.lib.Util.odata.getAllMeasures(d,e);for(i=0;i<m.length;i++){o={};o.measureName=m[i];a.push(o);}var M=new sap.ui.model.json.JSONModel();M.setData({measures:a});return M;},onODataServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_URL",t.getView().byId("odataServiceSelect").getSelectedItem().getText());t.getView().byId("odataServiceSelect").fireChange();},0);this.oDataModel.detachRequestCompleted(t.onODataServiceLoad,t);},onEntitySetServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/ODATA_ENTITYSET",t.getView().byId("entitySetSelect").getSelectedItem().getText());t.getView().byId("entitySetSelect").fireChange();},0);},onMeasureServiceLoad:function(){var t=this;setTimeout(function(){t.getView().getModel().setProperty("/COLUMN_NAME",t.getView().byId("valueMeasureSelect").getSelectedItem().getText());t.getView().byId("valueMeasureSelect").fireChange();},0);},isCDSMode:function(m){return m==this.CDS;},isHANAMode:function(m){return m!=this.CDS;},generateKpiId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateKpiId(x);var i;p.done(function(k){i=k;c.getView().getModel().getData().ID=i;c.getView().getModel().updateBindings();});},onExit:function(){var h=hasher||window.hasher;if(!(h.getHash())){sap.suite.ui.smartbusiness.lib.Util.utils.backToHome();}if(sap.suite.ui.smartbusiness.modelerAppCache&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI&&sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace){delete sap.suite.ui.smartbusiness.modelerAppCache.createSBKPI.appFromWorkspace;}}});
