/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.designtime.visualization.view.S4",{onInit:function(){var t=this;this.utilsRef=sap.suite.ui.smartbusiness.lib.Util.utils;var v=this.getView();this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.errorMessages=[];this.errorState=false;this.LUMIRA_SEMANTIC_OBECT="LumiraAnalytics";this.LUMIRA_ACTION="openStory";this.lumiraSemanticObject="LumiraAnalytics";this.lumiraAction="openStory";this.apfSemanticObject="FioriApplication";this.apfAction="executeAPFConfiguration";this.APF_SEMANTIC_OBECT="FioriApplication";this.APF_ACTION="executeAPFConfiguration";this.adhocAnalysisSemanticObject="AdhocAnalysis";this.adhocAnalysisAction="analyze";this.ADHOC_ANALYSIS_SEMANTIC_OBECT="AdhocAnalysis";this.ADHOC_ANALYSIS_ACTION="analyze";this.sbAction="analyzeSBKPIDetails";this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.confRef=sap.suite.ui.smartbusiness.Configuration;this.constantsRef=this.confRef.Constants;this.tileTypeConst=this.constantsRef.TileType;this.oDataModel=this.oApplicationFacade.getODataModel();this.PLATFORM=this.metadataRef.getPlatform();this.initialiazeDialogs();if(!(this.oApplicationFacade.env)){function a(d){if(d===null||d===undefined){d={};d.SYS_FLAG=1;}t.env=d.SYS_FLAG;t.sScope=d.SYS_FLAG?"CONF":"CUST";};function b(d,s,x){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),d.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_SYS_INFO"),"description":d.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};this.metadataRef.getSystemInfo({async:false,success:a,error:b,model:this.oDataModel});}if(!(t.oApplicationFacade.currentLogonHanaUser)){var c=function(u){t.oApplicationFacade.currentLogonHanaUser=u;};var f=function(d,s,x){t.oApplicationFacade.currentLogonHanaUser=null;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),d.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":d.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};this.metadataRef.getSessionUser({async:true,success:c,error:f,model:this.oApplicationFacade.getODataModel()});}this.oRouter.attachRouteMatched(function(E){if(E.getParameter("name")=="addTile"){this.createMode=true;this.editMode=false;}else if(E.getParameter("name")=="editTile"){this.createMode=false;this.editMode=true;}else{this.createMode=false;this.editMode=false;}if(this.createMode||this.editMode){this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");t.inSufficientAdditionalMeasureAlerted=false;t.inSufficientAdditionalMeasure=false;var d=new sap.ui.model.json.JSONModel();d.setSizeLimit(100000);this.getView().setModel(d,"tileConfig");this.modelRef=this.getView().getModel("tileConfig");var i=this.getInitialModelData();this.getView().getModel("tileConfig").setData(i);var p=this.fetchChipData({evalContextPath:E.getParameter("arguments").contextPath,chipContextPath:E.getParameter("arguments").chipContextPath});if(E.getParameter("arguments").contextPath){this.context=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").contextPath);}if(E.getParameter("arguments").chipContextPath){this.chipContext=new sap.ui.model.Context(v.getModel(),'/'+E.getParameter("arguments").chipContextPath);}this.appMode=E.getParameter("name");t.byId("tileSubtitle").setValueState("None");t.byId("appPropertyName").setValueState("None");t.byId("semanticObjectText").setValueState("None");t.byId("selectODD").setValueState("None");t.byId("tileTitle").setValueState("None");t.byId("appPropertyValue").setValueState("None");t.byId("selectStoryId").setValueState("None");t.byId("apfConfId").setValueState("None");}},this);try{if(sap.ui.core.Fragment.byId("tiles","compchart")){sap.ui.core.Fragment.byId("tiles","compchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","compchartmul")){sap.ui.core.Fragment.byId("tiles","compchartmul").destroy();}if(sap.ui.core.Fragment.byId("tiles","bulletchart")){sap.ui.core.Fragment.byId("tiles","bulletchart").destroy();}if(sap.ui.core.Fragment.byId("tiles","areachart")){sap.ui.core.Fragment.byId("tiles","areachart").destroy();}}catch(e){};sap.ui.xmlfragment("tiles","sap.suite.ui.smartbusiness.designtime.visualization.view.tiles",this);},getHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel();},oEditBtn:{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveTile();}},buttonList:[]};return this.oHeaderFooterOptions;},getHeaderFooterOptionsForError:function(){var t=this;this.oErrorOptions={bSuppressBookmarkButton:{},onBack:function(){t.handleBackAndCancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){t.utilsRef.handleMessagePopover(e,t);}},buttonList:[{sI18nBtnTxt:"SAVE",onBtnPressed:function(e){t.saveTile();}}]};return this.oErrorOptions;},setFooterOnError:function(){var t=this;if(t.errorMessages.length>1){switch(t.mode){case"create":t.setHeaderFooterOptions(t.oErrorOptions);break;case"edit":t.updateFooterButtons(this.modelRef.getData());t.setHeaderFooterOptions(t.oErrorOptionsForDraft);break;}}else{switch(t.mode){case"create":t.setHeaderFooterOptions(t.oHeaderFooterOptions);break;case"edit":t.updateFooterButtons(this.modelRef.getData());t.setHeaderFooterOptions(t.oHeaderFooterOptionsForDraft);break;}}},initialiazeDialogs:function(){var t=this;this.filterValueHelpDialog=new sap.m.SelectDialog({title:t.oResourceBundle.getText("SELECT_FILTERS"),multiSelect:true,items:{path:"/filterValues",template:new sap.m.StandardListItem({title:"{value}",selected:"{selected}"})},growingThreshold:999,confirm:function(e){var s=e.mParameters.selectedContexts;var v=[];s.forEach(function(c){v.push(c.getProperty("value"));});t.getView().getModel("tileConfig").setProperty("/CHIP/harveyFilters/0/VALUE_1",v);},cancel:function(e){},liveChange:function(e){var s=e.getParameter("value");var f=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var F=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,s);var b=e.getSource().getBinding("items");b.filter([f,F],true);}});this.filterValueHelpDialog.setModel(new sap.ui.model.json.JSONModel({filterValues:[]}));return this.filterValueHelpDialog;},fetchFilterValuesForDimension:function(D,v,s,e){var t=this;var c;var m=this.getView().getModel("tileConfig");var a=m.getProperty("/EVALUATION/ODATA_URL");var V={};v.forEach(function(d){V[d]=true;});var b=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:a,entitySet:m.getProperty("/EVALUATION/ODATA_ENTITYSET"),filter:m.getProperty("/FILTERS"),dimension:D});if((c=this.getApplicationCache(a+"/"+b.uri))){s(c);}else{b.model.read(b.uri,null,null,false,function(f){var d=[];f.results.forEach(function(o){d.push({value:o[D],selected:!!V[o[D]]});});t.setApplicationCache(a+"/"+b.uri,d);s(d);},e);}},openFilterValueHelp:function(){var t=this;var v=t.getView().getModel("tileConfig");this.filterValueHelpDialog.open();this.filterValueHelpDialog.setBusy(true);var d=v.getProperty("/CHIP/harveyFilters/0/NAME");var s=v.getProperty("/CHIP/harveyFilters/0/VALUE_1");t.fetchFilterValuesForDimension(d,s,function fetchFilterValuesForDimensionCallBack(a){t.filterValueHelpDialog.getModel().setProperty("/filterValues",a);t.filterValueHelpDialog.setBusy(false);},function(e){t.filterValueHelpDialog.setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),e);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_FETCHING_FILTERS"),"description":e});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});},initializeDimensionsForHarveyFilters:function(t){var d=t.EVALUATION.ODATA_URL;var e=t.EVALUATION.ODATA_ENTITYSET;var D=sap.suite.ui.smartbusiness.lib.Util.odata.dimensions(d,e).getAsObjectArrayWithLabel();var a=sap.suite.ui.smartbusiness.lib.Util.odata.getAllFilterableDimensionsWithProperty(d,e);var h=[];var b={};h.forEach(function(o){b[o.name]=true;});for(var c in a){if(!b[c]){h.push({name:c,label:a[c]._sLabelText||c});}}t.CHIP.HARVEY_DIMENSION=h;if(!t.CHIP.harveyFilters[0].NAME){t.CHIP.harveyFilters[0].NAME=h[0].label;}},harveyTotalMeasureVisibility:function(i,I){return i&&I;},harveyFilterVisibility:function(i,I){return i&&I;},harveyFilterOptionVisibility:function(i,I,s){return i&&I&&s;},betweenOperatorLabelVisible:function(o){return o=="BT";},_cache:{},setApplicationCache:function(k,v){this._cache[k]=v;},getApplicationCache:function(k){return this._cache[k];},onKpiMeasureAsHarveyTotalMeasure:function(e){},getSelectedRadioButton:function(e,c){var b=this.getView().getBindingContext();var d=this.modelRef.getData();if((e&&e.mParameters.selected)||c||true){this.confirmationType=(e)?e.getSource().data("drilldownType"):c;if(this.confirmationType==='GDD'){d.CHIP.navType="0";d.CONTROL=this.getControlObject(d);d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject;d.CHIP.semanticAction=this.sbAction;this.updateFooterButtons(d);this.modelRef.setData(d);}else if(this.confirmationType==='ODD'){d.CHIP.navType=(Number(d.CHIP.navType))?d.CHIP.navType:"4";d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);this.selectNavType(null,d.CHIP.navType);}}},selectTileType:function(e){this.selectTile(e.getSource().getSelectedItem().getKey());},onTileSelect:function(e){this.selectTile(e.getSource().data("tileType"));},selectTile:function(k){var d=this.modelRef.getData();d.CHIP.tileType=k;d.CONTROL=this.getControlObject(d);this.modelRef.setData(d);if(k=="CM"){if(this.inSufficientAdditionalMeasure&&!(this.inSufficientAdditionalMeasureAlerted)){sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("INSUFFICIENT_ADDL_MEASURES"));this.inSufficientAdditionalMeasureAlerted=true;}}this.getView().byId(d.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));this.byId("selectTileType").setTooltip(this.byId("selectTileType").getSelectedItem().getText());},selectSortOrder:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},multiMeasureSelect:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},semanticColorContributionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},selectNavType:function(e,k){var d=this.modelRef.getData();if(e){k=e.getSource().getSelectedKey();e.getSource().setTooltip(e.getParameters().selectedItem.getText());}d.CHIP.navType=k;d.CONTROL=this.getControlObject(d);switch(Number(k)){case 1:d.CHIP.semanticObject=this.lumiraSemanticObject;d.CHIP.semanticAction=this.lumiraAction;break;case 2:d.CHIP.semanticObject=this.apfSemanticObject;d.CHIP.semanticAction=this.apfAction;break;case 3:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;case 4:d.CHIP.semanticObject=this.tempSemanticObject||this.onLoadSemanticObject||"";d.CHIP.semanticAction=this.tempAction||this.onLoadSemanticAction||"";break;case 5:d.CHIP.semanticObject=this.adhocAnalysisSemanticObject;d.CHIP.semanticAction=this.adhocAnalysisAction;break;default:break;}this.updateFooterButtons(d);this.modelRef.setData(d);},formChipConfiguration:function(){var t=this;var p={};var d=this.modelRef.getData();var a=d.CHIP;var c=null;var b={};var e={};var h=a.harveyFilters||[];p.id=a.id||"";this.currentChipId=p.id;p.isActive=0;p.catalogId='HANA_CATALOG';p.title=a.title;p.description=a.description;if(a.tileType=="DT"){p.tileType=a.tileType+"-"+a.dualTileType;}else{p.tileType=a.tileType;}p.evaluationId=a.evaluationId;p.url=this.getChipUrl(p.tileType);p.keywords=a.keywords;if(a.changedOn){p.changedOn=a.changedOn;}e.id=a.id||"";e.evaluationId=a.evaluationId;if(a.tileType=="DT"){e.tileType=a.tileType+"-"+a.dualTileType;}else{e.tileType=a.tileType;}if(a.tileType=='CT'||(a.tileType=='DT'&&a.dualTileType=='CT')){e.dimension=a.dimension;e.sortOrder=a.sortOrder;e.semanticColorContribution=a.semanticColorContribution;}if(a.tileType=='TT'||(a.tileType=='DT'&&a.dualTileType=='TT')){e.dimension=a.dimension;}var f=d.EVALUATION;if(a.tileType=='NT'||a.tileType=='TT'||a.tileType=='CT'||a.tileType=='AT'||a.tileType=='CM'||a.tileType=="HT"){e.frameType='OneByOne';}else{e.frameType='TwoByOne';}e.navType=a.navType;if(e.navType=="0"){e.semanticObject=(a.semanticObject&&(a.semanticObject.length!=(a.semanticObject.split(" ").length-1)))?a.semanticObject:f.COLUMN_NAME;e.semanticAction=this.sbAction;}else if(e.navType=="1"){e.storyId=a.storyId;e.semanticObject=a.semanticObject||this.lumiraSemanticObject||this.LUMIRA_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.lumiraAction||this.LUMIRA_ACTION;}else if(e.navType=="2"){e.apfConfId=a.apfConfId;e.semanticObject=a.semanticObject||this.apfSemanticObject||this.APF_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.apfAction||this.APF_ACTION;}else if(e.navType=="5"){e.semanticObject=a.semanticObject||this.adhocAnalysisSemanticObject||this.ADHOC_ANALYSIS_SEMANTIC_OBECT;e.semanticAction=a.semanticAction||this.adhocAnalysisAction||this.ADHOC_ANALYSIS_ACTION;}else{e.semanticObject=a.semanticObject;e.semanticAction=a.semanticAction;}if(a.tileType=='CM'||(a.tileType=='DT'&&a.dualTileType=='CM')){e.COLUMN_NAMES=[];var g=a.MULTI_MEASURE;var j=[];for(var i=0,l=g.length;i<l;i++){if(g[i].COLUMN_NAME){e.COLUMN_NAMES.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});j.push({COLUMN_NAME:g[i].COLUMN_NAME,semanticColor:g[i].semanticColor});}else{j.push({COLUMN_NAME:null,semanticColor:null});}}}if(a.tileType=='HT'){e.isFractionMeasure=d.CHIP.isKPIMeasureFractionMeasureHarvey;if(e.isFractionMeasure){e.harveyTotalMeasure=a.totalValueMeasure;}else{e.harveyFilters=[];if(h[0]&&h[0].VALUE_1){h[0].VALUE_1.forEach(function(v){e.harveyFilters.push({NAME:h[0].NAME,OPERATOR:h[0].OPERATOR,VALUE_1:v,VALUE_2:"",TYPE:"FI"});});}}}b.ADDITIONAL_APP_PARAMETERS={};var k=d.CHIP.APP_PARAMETERS;if(k&&k.length){for(var i=0,l=k.length;i<l;i++){b.ADDITIONAL_APP_PARAMETERS[k[i].NAME]=k[i].VALUE;}}b.ADDITIONAL_APP_PARAMETERS=Object.keys(b.ADDITIONAL_APP_PARAMETERS).length?JSON.stringify(b.ADDITIONAL_APP_PARAMETERS):JSON.stringify({});b.TILE_PROPERTIES=JSON.stringify(e);b.EVALUATION_FILTERS=d.FILTERS.length?JSON.stringify(d.FILTERS):JSON.stringify([]);b.EVALUATION_VALUES=d.VALUES.length?JSON.stringify(d.VALUES):JSON.stringify([]);b.TAGS=d.TAGS?JSON.stringify(Object.keys(d.TAGS)):JSON.stringify([]);var m={};m.ID=f.ID;m.INDICATOR=f.INDICATOR;m.INDICATOR_TYPE=f.INDICATOR_TYPE;m.INDICATOR_TITLE=f.INDICATOR_TITLE;m.GOAL_TYPE=f.GOAL_TYPE;m.TITLE=f.TITLE;m.SCALING=f.SCALING;m.ODATA_URL=f.ODATA_URL;m.ODATA_ENTITYSET=f.ODATA_ENTITYSET;m.VIEW_NAME=f.VIEW_NAME;m.COLUMN_NAME=f.COLUMN_NAME;m.OWNER_NAME=f.OWNER_NAME;m.VALUES_SOURCE=f.VALUES_SOURCE;m.DECIMAL_PRECISION=f.DECIMAL_PRECISION;b.EVALUATION=m?JSON.stringify(m):JSON.stringify({});var n=Date.now().toString();c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"1",timeStamp:n});var o=4050;if(p.id){o=4096;}if(c.length>o){b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});if(c.length>o){b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});if(c.length>o){b.EVALUATION_VALUES=JSON.stringify([]);b.EVALUATION_FILTERS=JSON.stringify([]);b.TAGS=JSON.stringify([]);c=JSON.stringify({tileConfiguration:JSON.stringify(b),isSufficient:"0",timeStamp:n});}}}p.configuration=c;return p;},publishChip:function(p){var s=true;var t=this;p.keywords=p.keywords||"";delete p.navType;delete p.semanticObject;delete p.action;this.chipTextPayload=[];var b=[];this.deleteBatch=[];this.createBatch=[];var a=true;var d=this.oApplicationFacade.getODataModel();if(this.createMode){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:t.chipTextPayload}});t.metadataRef.create("CHIP",f,null,function(h){s=true;t.currentChipId=JSON.parse(h).response[0].id;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else if(this.editMode){if(this.currentContextState){var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:p,TEXTS:t.chipTextPayload}});t.metadataRef.create("CHIP",f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}else{var f=[];if(t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<t.modelRef.getData().NO_OF_ADDITIONAL_LANGUAGES;i++){var c={};c.title=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].description;c.id=p.id;c.language=t.modelRef.getData().ADDITIONAL_LANGUAGE_ARRAY[i].language;c.isActive=0;t.chipTextPayload.push(c);}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<t.initialData.ADDITIONAL_LANGUAGE_ARRAY.length;i++){var e={};e.id=p.id;e.language=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].language;e.isActive=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].isActive;e.description=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].description;e.title=t.initialData.ADDITIONAL_LANGUAGE_ARRAY[i].title;t.languagePayloadForDirtyBitTest.push(e);}var l=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});var g={remove:[],create:[]};if(l){if(l.deletes.length){for(var i=0;i<l.deletes.length;i++){g.remove.push(l.deletes[i]);}}if(l.updates.length){for(var i=0;i<l.updates.length;i++){t.createBatch.push(d.createBatchOperation("/CHIP_TEXTS","POST",l.updates[i]));g.create.push(l.updates[i]);}}}f.push({keys:{id:p.id,isActive:p.isActive},payload:{CHIP:{update:p},TEXTS:g}});t.metadataRef.update("CHIP",f,null,function(h){s=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));},function(h){s=false;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),h.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":h.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}}return s;},getChipUrl:function(t){var c={"NT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatornumeric/NumericTileChip.xml","CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcontribution/ContributionTileChip.xml","HT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorHarveyBall/HarveyBallTileChip.xml","TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorArea/AreaChartTileChip.xml","AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatordeviation/DeviationTileChip.xml","CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorcomparison/ComparisonTileChip.xml","DT-CT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-CM":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-AT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml","DT-TT":"/sap/bc/ui5_ui5/ui2/ushell/resources/sap/ushell/components/tiles/indicatorDual/DualTileChip.xml"};return c[t];},populateDimension:function(d,e){d=this.validateQueryServiceURI(d)+"";e=e+"";var a=[],b=[],o={};var i;a=sap.suite.ui.smartbusiness.lib.Util.odata.dimensions(d,e).getAsStringArray();for(i=0;i<a.length;i++){o={};o.dimensionName=a[i];b.push(o);}var m=new sap.ui.model.json.JSONModel();m.setData({dimensions:b});return m;},validateQueryServiceURI:function(d){d=jQuery.trim(d);if(!jQuery.sap.startsWith(d,"/")){d="/"+d;}if(jQuery.sap.endsWith(d,"/")){d=d.substring(0,d.length-1);}return d;},handleDimensionSelectionChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},setGenericDrillDown:function(n){return(n==0)?true:false;},setOtherDrillDown:function(n){return(n>0)?true:false;},onAfterContextData:function(c){var t=this;this.evaluationObj=c;if(this.customMeasuresModel&&this.customMeasuresModel.getData()){var a=this.customMeasuresModel.getData();a.Measures.unshift({COLUMN_NAME:this.evaluationObj.COLUMN_NAME});this.customMeasuresModel.setData(a);}try{this.oModelForEntity=this.populateDimension(c.ODATA_URL,c.ODATA_ENTITYSET);this.tileConfigurationModel.getData().dimension=this.oModelForEntity.getData().dimensions[0].dimensionName;this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});}catch(e){}finally{if(this.oModelForEntity&&this.oModelForEntity.getData()&&this.oModelForEntity.getData().dimensions&&this.oModelForEntity.getData().dimensions.length){this.getView().byId("selectDimension").setModel(this.oModelForEntity,"populateDimension");}else{sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}if(this.appMode=="addTile"){t.selectTile('NT');t.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));t.currentLocaleLanguage=t.languagesObject.LAISO[sap.ui.getCore().getConfiguration().getLanguage().split("-")[0].toUpperCase()];var b="/EVALUATIONS_CHIP_TEXTS?$filter=ID eq '"+c.ID+"' and IS_ACTIVE eq 1";t.oApplicationFacade.getODataModel().read(b,null,null,true,function(d){t.evaluationDetails=t.evaluationDetails||{};t.evaluationDetails.TEXTS=[];var o={};for(var i=0,l=d.results.length;i<l;i++){o={};o.language=d.results[i].LANGUAGE;o.title=d.results[i].TITLE;o.description=d.results[i].DESCRIPTION;t.evaluationDetails.TEXTS.push(o);}},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),e.response.body);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("YMSG_ERROR_RETRIEVING_DATA"),"description":e.response.body});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});this.updateFooterButtons(null);this.tileConfigurationModel.setData({evaluationId:c.ID,title:c.INDICATOR_TITLE,description:c.TITLE,semanticObject:(c.SEMANTIC_OBJECT||''),action:(c.ACTION||''),storyId:'',tileType:'NT',navType:0});this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});this.tempSemanticObject=c.SEMANTIC_OBJECT||"";this.onLoadSemanticObject=this.tempSemanticObject;this.tempAction=c.ACTION||"";var m=new sap.ui.model.json.JSONModel();m.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(m,"multiMeasures");}},onAfterChipContextData:function(c){var t=this;this.currentContextState=c.isActive;this.currentChipId=c.id;this.updateFooterButtons(c);if(this.appMode=="editTile"){var a=JSON.parse(c.configuration);var b=[];if(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS){b=JSON.parse(JSON.parse(a.tileConfiguration).ADDITIONAL_APP_PARAMETERS);}var e={};var m={MULTI_MEASURE:[]};if(JSON.parse(a.tileConfiguration).EVALUATION){e=JSON.parse(JSON.parse(a.tileConfiguration).EVALUATION);var d=new sap.ui.model.json.JSONModel();if(e.COLUMN_NAMES&&e.COLUMN_NAMES.length){for(var i=0,l=e.COLUMN_NAMES.length;i<l;i++){m.MULTI_MEASURE.push({COLUMN_NAME:e.COLUMN_NAMES[i].COLUMN_NAME,semanticColor:e.COLUMN_NAMES[i].semanticColor});}if(m.MULTI_MEASURE&&m.MULTI_MEASURE.length==2){m.MULTI_MEASURE.push({COLUMN_NAME:"",semanticColor:"Good"});}d.setData(m);this.getView().setModel(d,"multiMeasures");}else{d.setData({MULTI_MEASURE:[{COLUMN_NAME:t.evaluationObj.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}]});this.getView().setModel(d,"multiMeasures");}}var f=JSON.parse(JSON.parse(a.tileConfiguration).TILE_PROPERTIES);c.semanticObject=f.semanticObject;t.onLoadSemanticObject=c.semanticObject;c.action=f.semanticAction;this.tempSemanticObject=c.semanticObject||"";this.tempAction=c.action||"";c.navType=f.navType||"0";c.sortOrder=f.sortOrder||undefined;c.dimension=f.dimension||undefined;if(c.navType.toString()=="1"){this.lumiraSemanticObject=c.semanticObject;this.lumiraAction=c.action;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}else if(c.navType.toString()=="2"){this.apfSemanticObject=c.semanticObject;this.apfAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}else if(c.navType.toString()=="5"){this.adhocAnalysisSemanticObject=c.semanticObject;this.adhocAnalysisAction=c.action;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;}else{this.apfSemanticObject=this.APF_SEMANTIC_OBECT;this.apfAction=this.APF_ACTION;this.lumiraSemanticObject=this.LUMIRA_SEMANTIC_OBECT;this.lumiraAction=this.LUMIRA_ACTION;this.adhocAnalysisSemanticObject=this.ADHOC_ANALYSIS_SEMANTIC_OBECT;this.adhocAnalysisAction=this.ADHOC_ANALYSIS_ACTION;}this.byId('selectTileType').setSelectedKey(c.tileType);this.selectTile(c.tileType);if(Number(c.navType)==1){c.storyId=f.storyId;}else{c.storyId="";}this.tileConfigurationModel.setData(c);this.initialData=jQuery.extend(true,{},this.tileConfigurationModel.getData(),{});if(Number(c.navType)){this.byId("selectNavType").setSelectedKey(c.navType);this.getSelectedRadioButton(null,"ODD");}else{this.getSelectedRadioButton(null,"GDD");}var p=[];if(b&&Object.keys(b).length){for(var k in b){if(b.hasOwnProperty(k)){p.push({NAME:k,VALUE:b[k]});}}}this.byId("propertyNameValueBox").getModel("appParameters").setData({PROPERTIES:p});this.initialAppParameters=jQuery.extend(true,[],(this.appParametersModel.getData().PROPERTIES||[]));}},addNewProperty:function(){var t=this;if(this.getView().byId("appPropertyName").getValue()){this.getView().byId("appPropertyName").setValueState("None");if(this.getView().byId("appPropertyValue").getValue()){this.getView().byId("appPropertyValue").setValueState("None");var p=this.modelRef.getData().CHIP.APP_PARAMETERS;p=p||[];if(this.checkForDuplicateProperty()){p.push({NAME:this.getView().byId("appPropertyName").getValue(),VALUE:this.getView().byId("appPropertyValue").getValue()});this.getView().byId("appPropertyName").setValue("");this.getView().byId("appPropertyValue").setValue("");var d=this.modelRef.getData();d.CHIP.APP_PARAMETERS=p;this.modelRef.setData(d);}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyValue").setValueState("Error");this.getView().byId("appPropertyValue").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_VALUE"));}}else{t.isPropertyAdded=false;this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));sap.m.MessageToast.show(this.oApplicationFacade.getResourceBundle().getText("ENTER_PROPERTY_NAME"));}},removeProperty:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();e.getSource().getBindingContext("tileConfig").getModel().getData().CHIP.APP_PARAMETERS.splice(p.substring(p.lastIndexOf("/")+1),1);e.getSource().getBindingContext("tileConfig").getModel().updateBindings();},getAllFooterButtons:function(){var t=this;var b=[{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("DELETE_DRAFT"),onBtnPressed:function(e){this.errorMessages=[];this.errorState=false;sap.m.MessageBox.show(t.oApplicationFacade.getResourceBundle().getText("WANT_TO_DELETE_SELECTED_TILE"),"sap-icon://hint",t.oApplicationFacade.getResourceBundle().getText("DELETE"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(e=="OK"){t.errorMessages=[];t.errorState=false;t.metadataRef.remove("CHIP",{payload:{id:t.currentChipId,isActive:t.currentContextState}},function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DELETION_SUCCESSFUL"));t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});},function(a){});}if(e=="CANCEL"){}});},},{sI18nBtnTxt:t.oApplicationFacade.getResourceBundle().getText("SAVE")+' and '+t.oApplicationFacade.getResourceBundle().getText("ACTIVATE"),onBtnPressed:function(a){t.errorMessages=[];t.errorState=false;var d=t.modelRef.getData();var c=d.CHIP;var f="";var g=null;f=t.checkForValidChipForActivation();if(f){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),f);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),"description":f});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}else{t.isPropertyAdded=true;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}g=t.formChipConfiguration();function p(c){try{t.currentChipId=JSON.parse(c).response[0].id;}catch(e){t.currentChipId=t.currentChipId||null;}finally{t.metadataRef.create("ACTIVATE_CHIP",{id:t.currentChipId},null,function(c){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_SUCCESSFUL"));t.oApplicationFacade.__tileModified=true;t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});},function(i){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),i.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ACTIVATION_ERROR"),"description":i.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);});}};function h(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);};mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(g,mode,t,p,h);}t.setFooterOnError();},},{sI18nBtnTxt:"SAVE_AND_CONFIG_DRILLDOWN",onBtnPressed:function(e){t.handleNavToDrillDown();}},{sI18nBtnTxt:"SAVE_CREATE_NEW",onBtnPressed:function(a){t.isPropertyAdded=true;t.errorMessages=[];t.errorState=false;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var c=t.formChipConfiguration();function p(f){try{t.currentChipId=JSON.parse(f).response[0].id;}catch(e){}sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));if(t.appMode=="addTile"){var h=hasher||window.hasher;var g=hasher.getHash();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile"});setTimeout(function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({hash:"#"+g},true);},0);}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"addTile",context:t.context.sPath.substr(1)});}}function d(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(c,mode,t,p,d);t.setFooterOnError();}},{sI18nBtnTxt:"CANCEL",onBtnPressed:function(e){t.handleBackAndCancel();}}];return b;},updateFooterButtons:function(c){var b=this.getAllFooterButtons();this.oHeaderFooterOptions.buttonList=[];this.oErrorOptionsForDraft={bSuppressBookmarkButton:{},onBack:function(){that.handleBackAndCancel();},oNegativeAction:{sControlId:"errorBtn",sId:"errorBtn",sIcon:"sap-icon://alert",bDisabled:false,onBtnPressed:function(e){that.utilsRef.handleMessagePopover(e,that);}},buttonList:[]};this.oErrorOptionsForDraft.buttonList.push({sI18nBtnTxt:"SAVE",onBtnPressed:function(e){that.saveTile();}});if(c&&c.CHIP){if((!(c.CHIP.isActive))&&(this.editMode)){this.oHeaderFooterOptions.buttonList.push(b[0]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[0]);}}for(var i=1,l=b.length;i<l;i++){if(i==2){if(c.CHIP&&(c.CHIP.navType=="2"||c.CHIP.navType=="0")){this.oHeaderFooterOptions.buttonList.push(b[i]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[i]);}}else{this.oHeaderFooterOptions.buttonList.push(b[i]);this.oErrorOptionsForDraft.buttonList.push(this.oHeaderFooterOptions.buttonList[i]);}}this.setHeaderFooterOptions(this.oHeaderFooterOptions);},checkForDuplicateProperty:function(){var t=this;var p=this.modelRef.getData().CHIP.APP_PARAMETERS;var a=this.getView().byId("appPropertyName").getValue();var v=this.getView().byId("appPropertyValue").getValue();if(!isNaN(Number(a))){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_PROPERTY_NOT_STRING"));return false;}for(var i=0,l=p.length;i<l;i++){if((p[i].NAME==a)){if(p[i].NAME==a){this.getView().byId("appPropertyName").setValueState("Error");this.getView().byId("appPropertyName").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));}return false;}}return true;},inputNameChange:function(e){var t=this;var p=e.getSource().getValue();var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_MULTIPLE_VALUES_FOR_PROPERTY"));return;}}e.getSource().setValueState("None");},inputValueChange:function(e){var t=this;var v=e.getSource().getValue();var p=e.getSource().getBindingContext("tileConfig").getObject().NAME;var a=Number(e.getSource().getBindingContext("tileConfig").sPath[e.getSource().getBindingContext("tileConfig").sPath.length-1]);var b=this.modelRef.getData().CHIP.APP_PARAMETERS;for(var i=0,l=b.length;i<l;i++){if(i==a){continue;}if(b[i].NAME==p&&b[i].VALUE==v){e.getSource().setValueState("Error");e.getSource().setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_PROPERTY_VALUE"));}}},onAfterRendering:function(){var t=this;},handleSemanticObjectChange:function(e){this.tempSemanticObject=e.getSource().getValue();if(this.tempSemanticObject){e.getSource().setValueState("None");}if(this.tempSemanticObject.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="5"){this.adhocAnalysisSemanticObject=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="0"||this.modelRef.getData().CHIP.navType.toString()=="4"){this.onLoadSemanticObject=e.getSource().getValue();}},setSemanticAction:function(e){this.tempAction=e.getSource().getValue();if(this.tempAction){e.getSource().setValueState("None");}if(this.tempAction.indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(this.modelRef.getData().CHIP.navType.toString()=="2"){this.apfAction=e.getSource().getValue();}if(this.modelRef.getData().CHIP.navType.toString()=="1"){this.lumiraAction=e.getSource().getValue();}},subTitleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},titleChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyNameChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},appPropertyValueChange:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},setStoryId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}if(e.getSource().getValue().indexOf(" ")>-1){e.getSource().setValueState("Error");e.getSource().setValueStateText(this.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}},setAPFConfId:function(e){if(e.getSource().getValue()){e.getSource().setValueState("None");}},handleStoryIdValueHelp:function(){var t=this;var v=this.modelRef.getData().EVALUATION.VIEW_NAME;var s=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("STORY_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/Stories",template:new sap.m.StandardListItem({title:"{NAME}",description:"{UUID}"})},confirm:function(e){t.modelRef.getData().CHIP.storyId=e.getParameter("selectedItem").getProperty("description");t.byId("selectStoryId").setValueState("None");t.getView().getModel("tileConfig").setData(t.modelRef.getData());},liveChange:function(e){var a="'"+e.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(NAME)",sap.ui.model.FilterOperator.Contains,a);var F=new sap.ui.model.Filter("tolower(UUID)",sap.ui.model.FilterOperator.Contains,a);var b=e.getSource().getBinding("items");var o=new sap.ui.model.Filter([f,F],false);if(v){var c=new sap.ui.model.Filter("VIEW_NAME",sap.ui.model.FilterOperator.EQ,v);b.filter(new sap.ui.model.Filter([o,c],true));}else{b.filter(o);}}});s.open();t.oDataStoryIdModel=t.oDataStoryIdModel||new sap.ui.model.odata.ODataModel("/sap/bi/launchpad/integration/smb.xsodata",true);s.setModel(t.oDataStoryIdModel);if(v){s.getBinding("items").filter([new sap.ui.model.Filter("VIEW_NAME",sap.ui.model.FilterOperator.EQ,v)]);t.getView().getModel("tileConfig").setData(t.modelRef.getData());}},handleAPFConfigIdValueHelp:function(){var t=this;var a=t.modelRef.getData().CHIP.semanticObject;var b=t.modelRef.getData().CHIP.semanticAction;t.jsonApfConfigIdModel=t.jsonApfConfigIdModel||new sap.ui.model.json.JSONModel();var c=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CONFIG_ID"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"/AnalyticalConfigForSemObjQueryResults",template:new sap.m.StandardListItem({title:"{AnalyticalConfigurationName}",description:"{AnalyticalConfiguration}"})},confirm:function(E){t.modelRef.getData().CHIP.apfConfId=E.getParameter("selectedItem").getBindingContext().getProperty("AnalyticalConfiguration");t.modelRef.getData().CHIP.apfConfName=E.getParameter("selectedItem").getBindingContext().getProperty("AnalyticalConfigurationName");t.modelRef.getData().CHIP.apfAppId=E.getParameter("selectedItem").getBindingContext().getProperty("Application");t.byId("apfConfId").setValueState("None");t.getView().getModel("tileConfig").setData(t.modelRef.getData());},liveChange:function(E){var s=E.getParameter("value");var F=new sap.ui.model.Filter("AnalyticalConfigurationName",sap.ui.model.FilterOperator.Contains,s);var o=new sap.ui.model.Filter("AnalyticalConfiguration",sap.ui.model.FilterOperator.Contains,s);var d=new sap.ui.model.Filter([F,o],false);var g=new sap.ui.model.Filter("SemanticObject",sap.ui.model.FilterOperator.EQ,a);var B=E.getSource().getBinding("items");if(a){B.filter(new sap.ui.model.Filter([d,g],true));}else{B.filter(new sap.ui.model.Filter(d));}}});c.open();t.oDataApfConfigIdModel=t.oDataApfConfigIdModel||new sap.ui.model.odata.ODataModel("/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata",true);function e(d){if((a!==t.APF_SEMANTIC_OBECT)||(b!==t.APF_ACTION)){d.unshift({AnalyticalConfigurationName:"",AnalyticalConfiguration:"",Application:""});}t.jsonApfConfigIdModel.setData({AnalyticalConfigForSemObjQueryResults:d});c.setModel(t.jsonApfConfigIdModel);}function f(d,s,x){var g=[];g.unshift({AnalyticalConfigurationName:"",AnalyticalConfiguration:"",Application:""});t.jsonApfConfigIdModel.setData({AnalyticalConfigForSemObjQueryResults:g});c.setModel(t.jsonApfConfigIdModel);}t.metadataRef.getDataByEntity({entity:"AnalyticalConfigForSemObjQueryResults",filter:a?"SemanticObject eq '"+a+"'":undefined,success:e,error:f,model:t.oDataApfConfigIdModel});},handleCustomMeasure:function(e){var t=this;var c=e.getSource();this.customMeasuresDialog=new sap.m.SelectDialog({title:t.oApplicationFacade.getResourceBundle().getText("CHOOSE_ADDL_MEASURE"),noDataText:t.oApplicationFacade.getResourceBundle().getText("NO_DATA_FOUND"),items:{path:"tileConfig>/ADDITIONAL_MEASURES/Measures",template:new sap.m.StandardListItem({title:"{tileConfig>COLUMN_NAME}"})},confirm:function(E){var v=E.getParameter("selectedItem").getProperty("title");c.setValue(v);},liveChange:function(E){var s="'"+E.getParameter("value").toLowerCase()+"'";var f=new sap.ui.model.Filter("tolower(COLUMN_NAME)",sap.ui.model.FilterOperator.Contains,s);var b=E.getSource().getBinding("items");b.filter(new sap.ui.model.Filter([f],false));}});this.customMeasuresDialog.open();this.customMeasuresDialog.setModel(this.modelRef,"tileConfig");},addAdditionalLanguageDialog:function(){var t=this;var m=this.getView().getModel("tileConfig").getData();this.languageTextInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageDescriptionInput=new sap.m.Input({layoutData:new sap.ui.layout.GridData({span:"L8 M8 S8"})});this.languageKeySelect=new sap.m.Select({layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6"})});this.addedLanguagesList=new sap.m.List({layoutData:new sap.ui.layout.GridData({span:"L5 M5 S5"}),}).setModel(t.getView().getModel("tileConfig"),"tileConfig");this.addedLanguagesList.bindItems("tileConfig>/ADDITIONAL_LANGUAGE_ARRAY",new sap.m.CustomListItem({content:new sap.ui.layout.Grid({hSpacing:1,vSpacing:0,defaultSpan:"L12 M12 S12",content:[new sap.m.Input({value:"{tileConfig>title}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L12 M12 S12",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>description}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L6 M6 S6",vAlign:"Middle"}),editable:false}),new sap.m.Input({value:"{tileConfig>isoLanguage}",design:"Bold",layoutData:new sap.ui.layout.GridData({span:"L4 M4 S4"}),editable:false}),new sap.m.Button({icon:"sap-icon://sys-cancel",type:"Transparent",press:function(e){var p=e.getSource().getBindingContext("tileConfig").getPath();var b=Number(p.substr(p.lastIndexOf("/")+1));var n=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.splice(b,1);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();},layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})})]})}));var a=new sap.m.Dialog({contentHeight:"50%",contentWidth:"25%",title:t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE"),content:[new sap.ui.layout.Grid({hSpacing:1,vSpacing:4,defaultSpan:"L12 M12 S12",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("TITLE"),textAlign:"Right",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageTextInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("SUB_TITLE"),layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3",})}),t.languageDescriptionInput,new sap.m.Label({text:t.oApplicationFacade.getResourceBundle().getText("LANGUAGE")+":",layoutData:new sap.ui.layout.GridData({span:"L3 M3 S3"})}),t.languageKeySelect,new sap.m.Button({icon:"sap-icon://add",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"}),press:function(){if(t.languageTextInput.getValue()||t.languageDescriptionInput.getValue()){for(var i=0;i<t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;i++){if(t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY[i].isoLanguage===t.languageKeySelect.getSelectedItem().getText()){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_LANGUAGE_EXISTS",t.languageKeySelect.getSelectedItem().getText()));return;}}var b={"title":t.languageTextInput.getValue(),"description":t.languageDescriptionInput.getValue(),"isoLanguage":t.languageKeySelect.getSelectedItem().getText(),"language":t.languageKeySelect.getSelectedKey()};t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.push(b);t.addedLanguagesList.getModel("tileConfig").getData().NO_OF_ADDITIONAL_LANGUAGES=t.addedLanguagesList.getModel("tileConfig").getData().ADDITIONAL_LANGUAGE_ARRAY.length;t.addedLanguagesList.getModel("tileConfig").updateBindings();t.languageTextInput.setValue("");t.languageDescriptionInput.setValue("");}}})]})]}).addStyleClass("languageGrid"),t.addedLanguagesList],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("OK"),press:function(){a.close();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){var b=t.modelRef.getData();b.ADDITIONAL_LANGUAGE_ARRAY=o.ADDITIONAL_LANGUAGE_ARRAY;b.NO_OF_ADDITIONAL_LANGUAGES=o.NO_OF_ADDITIONAL_LANGUAGES;t.modelRef.setData(b);a.close();}})});var d=m.SAP_LANGUAGE_ARRAY;for(var i=0;i<d.length;i++){if((d[i].LAISO).toUpperCase()==(sap.ui.getCore().getConfiguration().getLocale().getLanguage()).toUpperCase()){d.splice(i,1);}}t.languageKeySelect.setModel(this.getView().getModel("tileConfig"),"tileConfig");t.languageKeySelect.bindItems("tileConfig>/SAP_LANGUAGE_ARRAY",new sap.ui.core.Item({text:"{tileConfig>LAISO}",key:"{tileConfig>SPRAS}"}));a.open();var o=jQuery.extend(true,{},this.modelRef.getData(),{});},hasUIChanged:function(){var t=this;var o={};var a=t.initialData;var n=jQuery.extend(true,{},t.modelRef.getData(),{});if(JSON.stringify(a)==JSON.stringify(n)){return false;}var b=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:a.CHIP.APP_PARAMETERS,newPayload:n.CHIP.APP_PARAMETERS,objectType:"APP_PARAMETERS"});o.oldPayload=a.CHIP;delete o.oldPayload.APP_PARAMETERS;delete o.oldPayload.MULTI_MEASURE;delete o.oldPayload.appParameters;delete o.oldPayload.configurationObj;delete o.oldPayload.HARVEY_DIMENSION;delete o.oldPayload.harveyFilters;o.newPayload=n.CHIP;delete o.newPayload.APP_PARAMETERS;delete o.newPayload.MULTI_MEASURE;delete o.newPayload.appParameters;delete o.newPayload.configurationObj;delete o.newPayload.HARVEY_DIMENSION;delete o.newPayload.harveyFilters;o.objectType="Chips";o=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck(o);t.chipTextPayload=[];if(n.NO_OF_ADDITIONAL_LANGUAGES){for(var i=0;i<n.NO_OF_ADDITIONAL_LANGUAGES.length;i++){var c={};c.title=n.ADDITIONAL_LANGUAGE_ARRAY[i].title;c.description=n.ADDITIONAL_LANGUAGE_ARRAY[i].description;c.language=n.ADDITIONAL_LANGUAGE_ARRAY[i].language;t.chipTextPayload.push(c);}}t.languagePayloadForDirtyBitTest=[];for(var i=0;i<a.NO_OF_ADDITIONAL_LANGUAGES.length;i++){var d={};d.language=a.NO_OF_ADDITIONAL_LANGUAGES[i].language;d.description=a.NO_OF_ADDITIONAL_LANGUAGES[i].description;d.title=a.NO_OF_ADDITIONAL_LANGUAGES[i].title;t.languagePayloadForDirtyBitTest.push(d);}var l=sap.suite.ui.smartbusiness.lib.Util.utils.dirtyBitCheck({oldPayload:t.languagePayloadForDirtyBitTest,newPayload:t.chipTextPayload,objectType:"CHIP_TEXTS"});if((o&&o.updates&&o.updates.length)||(l&&l.deletes&&l.deletes.length)||(l&&l.updates&&l.updates.length)||(b&&b.deletes&&b.deletes.length)||(b&&b.updates&&b.updates.length)){return true;}else{return false;}},handleBackAndCancel:function(){var t=this;this.errorMessages=[];this.errorState=false;if(this.hasUIChanged()){var b=new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("ON_BACK_WARNING")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){b.close();}})});b.open();}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}},handleNavToDrillDown:function(){var t=this;this.errorMessages=[];this.errorState=false;var p=t.context.getPath();function n(){if(t.modelRef.getData().CHIP.navType=="2"){var c=t.modelRef.getData().CHIP;if(c.apfAppId&&c.apfConfId){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"editAPFConfiguration",route:"app",context:c.apfAppId+"/config/"+c.apfConfId});}else{sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"editAPFConfiguration"});}}else{sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:(p)});setTimeout(function(){sap.suite.ui.smartbusiness.lib.Util.utils.appToAppNavigation({action:"configureSBKPIDrilldown",route:"detail",context:(p)});},0);}}this.saveTile(n);},fetchChipData:function(o){var t=this;var f={};if(this.createMode){var e={};if(o.evalContextPath){var a=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.evalContextPath);e=this.metadataRef.getEvaluationById({context:a,texts_for_chip:true,entity:"EVALUATIONS_MODELER",model:t.oApplicationFacade.getODataModel()});f=this.formModelByEvaluation(e);}}else if(this.editMode){var c={};if(o.chipContextPath){var b=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+o.chipContextPath);c=this.metadataRef.getChipById({context:b,evaluation:true,texts:true,model:t.oApplicationFacade.getODataModel()});f=this.formModelByChip(c);}}else{f={CHIP:{}};}this.currentContextState=f.CHIP.isActive;this.currentChipId=f.CHIP.id;this.fetchOtherInfoAsync(f);return f;},formModelByEvaluation:function(e){var t=this;var o=e.EVALUATION;var c={CHIP:{}};if(e.TEXTS_FOR_CHIP&&e.TEXTS_FOR_CHIP.length){e.TEXTS=e.TEXTS_FOR_CHIP;}c.CHIP.id="";c.CHIP.isActive=0;c.CHIP.evaluationId=o.ID;c.CHIP.tileType="NT";c.CHIP.dualTileType="CT";c.CHIP.title=o.INDICATOR_TITLE||"";c.CHIP.description=o.TITLE||"";c.CHIP.url=c.url||this.getChipUrl(c.tileType);c.CHIP.keywords="";c.CHIP.configuration="";c.CHIP.storyId="";c.CHIP.navType=(!(o.ACTION)||(o.ACTION==this.sbAction))?"0":"4";if(c.CHIP.navType=="0"){c.CHIP.semanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";c.CHIP.semanticAction=o.ACTION||this.sbAction;}else{c.CHIP.semanticObject=this.lumiraSemanticObject;c.CHIP.semanticAction=this.lumiraAction;}this.onLoadSemanticObject=o.SEMANTIC_OBJECT||o.COLUMN_NAME||"";this.onLoadSemanticAction=o.ACTION||this.sbAction;c.CHIP.appParameters=[];c.CHIP.dimension="";c.CHIP.sortOrder="0";c.CHIP.semanticColorContribution="Neutral";c.CHIP.frameType='OneByOne';c.CHIP.totalValueMeasure='';c.CHIP.isKPIMeasureFractionMeasureHarvey=true;c.CHIP.isKPIMeasureTotalMeasureHarvey=false;c.CHIP.HARVEY_DIMENSION=[];c.CHIP.harveyFilters=[{NAME:"",LABEL:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];c.CHIP.MULTI_MEASURE=[{COLUMN_NAME:o.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];c.TEXTS=[];var C={};for(var i=0,l=e.TEXTS.length;i<l;i++){C={};C.id="";C.title=e.TEXTS[i].TITLE;C.description=e.TEXTS[i].DESCRIPTION;C.language=e.TEXTS[i].LANGUAGE;c.TEXTS.push(C);}c.EVALUATION=o;return c;},formModelByChip:function(c){var t=this;var o=c.CHIP;var a={CHIP:{}};var b;if(c.EVALUATION_INFO){a.EVALUATION=c.EVALUATION_INFO;}a.TEXTS=c.TEXTS;a.CHIP.id=o.id||"";a.CHIP.isActive=o.isActive;a.CHIP.evaluationId=o.evaluationId||"";a.CHIP.tileType=o.tileType||"NT";if(o.tileType=="DT-CT"){a.CHIP.dualTileType="CT";a.CHIP.tileType="DT";}else if(o.tileType=="DT-CM"){a.CHIP.dualTileType="CM";a.CHIP.tileType="DT";}else if(o.tileType=="DT-AT"){a.CHIP.dualTileType="AT";a.CHIP.tileType="DT";}else if(o.tileType=="DT-TT"){a.CHIP.dualTileType="TT";a.CHIP.tileType="DT";}a.CHIP.title=o.title||"";a.CHIP.description=o.description||"";a.CHIP.url=o.url||this.getChipUrl(a.tileType);a.CHIP.keywords=o.keywords||"";a.CHIP.configuration=o.configuration||"";var d=null;var f=null;var g=null;var h=null;try{a.CHIP.configurationObj=JSON.parse(a.CHIP.configuration);if(a.CHIP.configurationObj&&a.CHIP.configurationObj.tileConfiguration){d=JSON.parse(a.CHIP.configurationObj.tileConfiguration);if(d&&d.TILE_PROPERTIES){f=JSON.parse(d.TILE_PROPERTIES);if(f){a.CHIP.navType=f.navType||"0";a.CHIP.frameType=f.frameType||'OneByOne';a.CHIP.semanticObject=f.semanticObject||"";a.CHIP.semanticAction=f.semanticAction||"";this.onLoadSemanticObject=a.CHIP.semanticObject||"";this.onLoadSemanticAction=a.CHIP.semanticAction||"";a.CHIP.storyId=f.storyId||"";a.CHIP.apfConfId=f.apfConfId||"";a.CHIP.apfConfName=(f.apfConfId)?('-NA-'+f.apfConfId):"";a.CHIP.dimension=f.dimension||"";a.CHIP.HARVEY_DIMENSION=a.CHIP.HARVEY_DIMENSION||[];a.CHIP.harveyFilters=[{NAME:"",LABEL:"",OPERATOR:"EQ",VALUE_1:[],VALUE_2:[]}];if(f.harveyFilters&&f.harveyFilters.length){b={};a.CHIP.harveyFilters=[];f.harveyFilters.forEach(function(i){if(!b[i.NAME]){b[i.NAME]={NAME:i.NAME,OPERATOR:i.OPERATOR,VALUE_1:[i.VALUE_1],VALUE_2:[],LABEL:i.NAME};a.CHIP.harveyFilters.push(b[i.NAME]);}else{b[i.NAME].VALUE_1.push(i.VALUE_1);}});if(a.CHIP.HARVEY_DIMENSION.length==0){a.CHIP.HARVEY_DIMENSION.push({name:f.harveyFilters[0].NAME,label:f.harveyFilters[0].NAME});}}a.CHIP.totalValueMeasure=f.harveyTotalMeasure;a.CHIP.isKPIMeasureFractionMeasureHarvey=f.isFractionMeasure;a.CHIP.isKPIMeasureTotalMeasureHarvey=!f.isFractionMeasure;a.CHIP.sortOrder=f.sortOrder||"";a.CHIP.semanticColorContribution=f.semanticColorContribution||"Neutral";}g=JSON.parse(d.ADDITIONAL_APP_PARAMETERS);a.CHIP.appParameters=g||[];h=JSON.parse(d.EVALUATION);if(h){a.CHIP.MULTI_MEASURE=f.COLUMN_NAMES||h.COLUMN_NAMES||[{COLUMN_NAME:a.EVALUATION.COLUMN_NAME,semanticColor:"Error"},{COLUMN_NAME:"",semanticColor:"Critical"},{COLUMN_NAME:"",semanticColor:"Good"}];}}}}catch(e){jQuery.sap.log.error="Failed to parse chip";c.EVALUATION=c.EVALUATION_INFO;delete c.EVALUATION_INFO;a=t.formModelByEvaluation(c);a.CHIP.id=o.id;a.CHIP.isActive=o.isActive;this.errorConfigParse=true;}return a;},fetchOtherInfoAsync:function(o){var t=this;this.updateFooterButtons(o);var a=function(l,d,m){o.SAP_LANGUAGES=l;o.SAP_LANGUAGE_ARRAY=d;o.localLanguage=m;};this.metadataRef.getAllLanguages({async:false,success:a,model:this.oDataModel});var b=o.TEXTS;var c=[];var i;for(i=0;i<b.length;i++){if(b[i].language!=o.localLanguage){c.push(b[i]);}}var e=[];var i;for(i=0;i<c.length;i++){var f={};f.title=c[i].title;f.description=c[i].description;f.language=c[i].language;f.isoLanguage=o.SAP_LANGUAGES.SPRAS[f.language];f.isActive=o.isActive;e.push(f);}o.ADDITIONAL_LANGUAGE_ARRAY=e;o.NO_OF_ADDITIONAL_LANGUAGES=o.ADDITIONAL_LANGUAGE_ARRAY.length||0;t.byId('additionalLanguageLink').bindProperty("text","tileConfig>/NO_OF_ADDITIONAL_LANGUAGES",function(v){return t.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";});o.CONTROL=this.getControlObject(o);try{this.oModelForEntity=this.populateDimension(o.EVALUATION.ODATA_URL,o.EVALUATION.ODATA_ENTITYSET);o.CHIP.dimension=o.CHIP.dimension||this.oModelForEntity.getData().dimensions[0].dimensionName;}catch(g){}finally{if(this.oModelForEntity.getData().dimensions.length){o.DIMENSIONS=this.oModelForEntity.getData();}else{o.DIMENSIONS=[];sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("UNABLE_TO_FETCH_NAVIG")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}}var p=[];var h=o.CHIP.appParameters;if(h&&Object.keys(h).length){for(var k in h){if(h.hasOwnProperty(k)){p.push({NAME:k,VALUE:h[k]});}}}o.CHIP.APP_PARAMETERS=p;var j=function(m){var n={};o.TAGS={};if(m.TAGS){for(var i=0,l=m.TAGS.length;i<l;i++){o.TAGS[m.TAGS[i].TAG]=m.TAGS[i].TYPE;}}if(m.INDICATOR_TAGS){for(var i=0,l=m.INDICATOR_TAGS.length;i<l;i++){o.TAGS[m.INDICATOR_TAGS[i].TAG]="IN";}}o.FILTERS=[];if(m.FILTERS){for(var i=0,l=m.FILTERS.length;i<l;i++){n={};n.TYPE=m.FILTERS[i].TYPE;n.NAME=m.FILTERS[i].NAME;n.VALUE_1=m.FILTERS[i].VALUE_1;n.VALUE_2=m.FILTERS[i].VALUE_2;n.OPERATOR=m.FILTERS[i].OPERATOR;o.FILTERS.push(n);}}o.VALUES=[];var q={Measures:[]};q.Measures.push({COLUMN_NAME:"",COLUMN_TEXT:""});if(o.EVALUATION&&o.EVALUATION.COLUMN_NAME){q.Measures.push({COLUMN_NAME:o.EVALUATION.COLUMN_NAME,COLUMN_TEXT:o.EVALUATION.COLUMN_NAME});}if(m.VALUES){for(var i=0,l=m.VALUES.length;i<l;i++){n={};if(/^\d{2}/.test(m.VALUES[i].TYPE.toString())){q.Measures.push({COLUMN_NAME:m.VALUES[i].COLUMN_NAME,COLUMN_TEXT:m.VALUES[i].COLUMN_NAME});}else{n.TYPE=m.VALUES[i].TYPE;n.FIXED=m.VALUES[i].FIXED;n.COLUMN_NAME=m.VALUES[i].COLUMN_NAME;n.ODATA_PROPERTY=m.VALUES[i].ODATA_PROPERTY;o.VALUES.push(n);}}}if(q.Measures.length<3){t.inSufficientAdditionalMeasure=true;}var r=jQuery.extend(true,{},q,{});if(r&&r.Measures&&r.Measures.length){r.Measures[0].COLUMN_TEXT="("+t.oApplicationFacade.getResourceBundle().getText("NONE")+")";}o.ADDITIONAL_MEASURES=q;o.ADDITIONAL_MEASURES_OPT=r;if(m.TEXTS){o.TEXTS=m.TEXTS;}t.getView().getModel("tileConfig").setData(o);t.setTooltipForAllSelect();if(o.CHIP.apfConfId){var u=new sap.ui.model.odata.ODataModel("/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata",true);function v(d){if(d.length&&d[0]){t.modelRef.getData().CHIP.apfConfName=d[0].AnalyticalConfigurationName;t.modelRef.getData().CHIP.apfAppId=d[0].Application;t.getView().getModel("tileConfig").setData(t.modelRef.getData());t.initialData=jQuery.extend(true,{},t.modelRef.getData(),{});}};function w(d,s,x){};t.metadataRef.getDataByEntity({entity:"AnalyticalConfigForSemObjQueryResults",async:true,filter:("AnalyticalConfiguration eq '"+o.CHIP.apfConfId+"'"),success:v,error:w,model:u});}t.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(t.errorConfigParse){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_PARSE_CHIP_INFO"));t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_PARSE_CHIP_INFO")});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}t.errorConfigParse=false;t.initialData=jQuery.extend(true,{},o,{});if(o.CHIP.tileType&&o.CHIP.tileType=="DT"){var y=t.getView().byId("selectTileType").getSelectedKey();t.getView().byId("selectVizRight").fireChange(y);}};t.metadataRef.getEvaluationById({ID:o.CHIP.evaluationId,IS_ACTIVE:1,async:true,success:j,noEvaluation:true,tags:true,indicator_tags:true,values:true,filters:true,entity:"EVALUATIONS",model:t.oApplicationFacade.getODataModel()});this.initializeDimensionsForHarveyFilters(o);return o;},setTooltipForAllSelect:function(){this.byId("selectTileType").setTooltip(this.byId("selectTileType").getSelectedItem().getText());this.byId("selectNavType").setTooltip(this.byId("selectNavType").getSelectedItem().getText());this.byId("selectSortOrder").setTooltip(this.byId("selectSortOrder").getSelectedItem().getText());this.byId("selectDimension").setTooltip(this.byId("selectDimension").getSelectedItem().getText());this.byId("semanticColorContribution").setTooltip(this.byId("semanticColorContribution").getSelectedItem().getText());this.byId("selectVizRight").setTooltip(this.byId("selectVizRight").getSelectedItem().getText());this.byId("measure1").setTooltip(this.byId("measure1").getSelectedItem().getText());this.byId("measureColor1").setTooltip(this.byId("measureColor1").getSelectedItem().getText());this.byId("measure2").setTooltip(this.byId("measure2").getSelectedItem().getText());this.byId("measureColor2").setTooltip(this.byId("measureColor2").getSelectedItem().getText());this.byId("measure3").setTooltip(this.byId("measure3").getSelectedItem().getText());this.byId("measureColor3").setTooltip(this.byId("measureColor3").getSelectedItem().getText());},saveTile:function(c){var t=this;t.errorMessages=[];t.errorState=false;t.isPropertyAdded=true;if(t.getView().byId("appPropertyName").getValue()||t.getView().byId("appPropertyValue").getValue()){t.addNewProperty();}if(!t.isPropertyAdded){return;}var a=t.formChipConfiguration();function p(d){try{t.currentChipId=JSON.parse(d).response[0].id;}catch(e){t.currentChipId=t.currentChipId||null;}finally{t.oApplicationFacade.__tileModified=true;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("TILE_SAVED_SUCCESSFULLY"));if(c){c();}else{t.refreshMasterList();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPITile",route:"detail",context:t.context.sPath.substr(1)});}}}function b(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),e.responseText);t.errorMessages.push({"type":"Error","title":t.oApplicationFacade.getResourceBundle().getText("ERROR_SAVING_TILE"),"description":e.responseText});sap.suite.ui.smartbusiness.lib.Util.utils.setErrorState(t);}mode=t.createMode?"create":(t.editMode?"edit":"edit");t.mode=mode;t.metadataRef.publishChip(a,mode,t,p,b);t.setFooterOnError();},checkForValidChipForActivation:function(){var t=this;var d=t.modelRef.getData();var a=d.CHIP;var e="";var c=null;if(((!(a.semanticObject)||(a.semanticObject.length==(a.semanticObject.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_OBJECT"));}if(a.semanticObject.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT")+"\n";t.byId("semanticObjectText").setValueState("Error");t.byId("semanticObjectText").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_OBJECT"));}if(((!(a.semanticAction)||(a.semanticAction.length==(a.semanticAction.split(" ").length-1)))&&(Number(a.navType)!=0))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_SEMANTIC_ACTION"));}if(a.semanticAction.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION")+"\n";t.byId("selectODD").setValueState("Error");t.byId("selectODD").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_SEMANTIC_ACTION"));}if(((!(a.storyId)||(a.storyId.length==(a.storyId.split(" ").length-1)))&&(Number(a.navType)==1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_STORY_ID"));}if(a.storyId.indexOf(" ")>-1){e+=t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID")+"\n";t.byId("selectStoryId").setValueState("Error");t.byId("selectStoryId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("INVALID_STORY_ID"));}if(((!(a.apfConfId)||(a.apfConfId.length==(a.apfConfId.split(" ").length-1)))&&(Number(a.navType)==2))){if((a.semanticObject===t.APF_SEMANTIC_OBECT)&&(a.semanticAction===t.APF_ACTION)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID")+"\n";t.byId("apfConfId").setValueState("Error");t.byId("apfConfId").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_CONFIG_ID"));}}if(!(a.title)||(a.title.length==(a.title.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE")+"\n";t.byId("tileTitle").setValueState("Error");t.byId("tileTitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_TITLE"));}if(!(a.description)||(a.description.length==(a.description.split(" ").length-1))){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION");t.byId("tileSubtitle").setValueState("Error");t.byId("tileSubtitle").setValueStateText(t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_DESCRIPTION"));}if((a.tileType=="CM"||a.dualTileType=="CM")&&!(e)){c=t.formChipConfiguration();var b=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).EVALUATION);var f=JSON.parse(JSON.parse(JSON.parse(c.configuration).tileConfiguration).TILE_PROPERTIES);var g=f.COLUMN_NAMES||b.COLUMN_NAMES;if(!(g)||!(g.length)||(g.length<2)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");}else{for(var i=0,l=g.length;i<l;i++){if(!(g[i].COLUMN_NAME)||!(g[i].semanticColor)){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_ENTER_THREE_MEASURES");break;}}if(!e){if(g.length==2){if(g[0].COLUMN_NAME==g[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}else if(g.length==3){if(g[0].COLUMN_NAME==g[1].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(g.COLUMN_NAME==g[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}else if(g[1].COLUMN_NAME==g[2].COLUMN_NAME){e+=t.oApplicationFacade.getResourceBundle().getText("ERROR_DUPLICATE_MEASURE_THREE_MEASURES");}}}}}return e;},selectVizRight:function(o){var r;var d=this.modelRef.getData();d.CONTROL=d.CONTROL||{};if(o.CHIP){d=o;var a=o.CHIP.dualTileType;}else{var a=this.getView().byId("selectVizRight").getSelectedKey();}if(a=="CT"){r=sap.ui.core.Fragment.byId("tiles","compchart");d.CONTROL.vDimension=true;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=true;d.CONTROL.vSemanticColorContribution=true;}else if(a=="CM"){r=sap.ui.core.Fragment.byId("tiles","compchartmul");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=true;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}else if(a=="AT"){r=sap.ui.core.Fragment.byId("tiles","bulletchart");d.CONTROL.vDimension=false;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}else if(a=="TT"){r=sap.ui.core.Fragment.byId("tiles","areachart");d.CONTROL.vDimension=true;d.CONTROL.vMultiMeasure=false;d.CONTROL.vSortOrder=false;d.CONTROL.vSemanticColorContribution=false;}this.getView().byId("DT").getTileContent()[1].setContent(r);this.modelRef.setData(d);this.getView().byId("selectVizRight").setTooltip(this.getView().byId("selectVizRight").getSelectedItem().getText());return d;},getControlObject:function(o){var c=o.CONTROL||{};this.getView().byId('NT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('TT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('AT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('CM').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId('DT').$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiWhite"));this.getView().byId(o.CHIP.tileType).$().css("border","solid 2px "+sap.ui.core.theming.Parameters.get("sapUiHighlight"));if(o&&o.CHIP&&o.CHIP.tileType){c.isHarvey=false;switch(o.CHIP.tileType){case'NT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'AT':c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=false;c.vVizRight=false;break;case'TT':c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'CM':c.vDimension=false;c.vMultiMeasure=true;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;case'DT':c.vDimension=false;c.vDimension=true;c.vMultiMeasure=false;c.vSortOrder=true;c.vSemanticColorContribution=true;c.vVizLeft=true;c.vVizRight=true;o.CONTROL=c;o=this.selectVizRight(o);c=o.CONTROL;break;case'HT':c.isHarvey=true;c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;break;default:break;}}if(o&&o.CHIP&&o.CHIP.navType){switch(o.CHIP.navType.toString()){case'0':c.vSemanticObject=true;c.vAction=true;c.eAction=false;c.vStoryId=false;c.vSelectNavType=false;c.vAPFConfId=false;break;case'1':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=true;c.vSelectNavType=true;c.vAPFConfId=false;break;case'2':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=true;break;case'3':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;case'4':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;case'5':c.vSemanticObject=true;c.vAction=true;c.eAction=true;c.vStoryId=false;c.vSelectNavType=true;c.vAPFConfId=false;break;default:break;}}return c;},refreshMasterList:function(){var t=this;t.utilsRef.refreshMasterList(t,false);},getInitialModelData:function(){var c={};c.vStoryId=false;c.vAPFConfId=false;c.vDimension=false;c.vMultiMeasure=false;c.vSortOrder=false;c.vSemanticColorContribution=false;c.vVizLeft=false;c.vVizRight=false;return{CONTROL:c};},});
