/*!
* SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
* @deprecated since SAPUI 5 version 1.28.0
*/
sap.ui.getCore().loadLibrary("sap.suite.ui.commons");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Bullet");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Comparison");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.AreaChart");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.Numeric");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.MeasureComparison");jQuery.sap.require("sap.suite.ui.smartbusiness.tiles.HarveyBall");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.ui.core.format.NumberFormat");sap.ca.scfld.md.controller.BaseDetailController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.S3",{onInit:function(){this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.viewId=null;this.ddaFilter=this.byId("ddaFilter");this.initializeTileHeader();this.defineHeaderFooterOptions();this.navigatingWithinDrilldown=true;this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog();},tileTypeMapping:{NT:"Numeric",AT:"Bullet",CT:"Comparison",TT:"AreaChart",CM:"MeasureComparison",HT:"HarveyBall"},headerNumberFormatter:function(s){return s?"12,345.67":"";},headerNumberUnitFormatter:function(s){return s?"EUR":"";},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");},initializeTileHeader:function(){var t=this;var a=this.byId("tileContainer");a.bindAggregation("items",{path:"SB_DDACONFIG>/HEADERS_VISIBLE",factory:function(i,b){var c=b.getProperty("VISUALIZATION_TYPE");return new sap.suite.ui.smartbusiness.tiles[t.tileTypeMapping[c]]({evaluationId:t.evaluationId,mode:"DUMMY",header:"{SB_DDACONFIG>TITLE}",subheader:"{SB_DDACONFIG>SUBTITLE}"}).addStyleClass("drilldownKpiTiles");},});},lauchConfigurator:function(){var r=null;var c=this.evaluationId+"/"+this.viewId;this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;if(this.DDA_MODEL.getConfigurator().getAllViews().length==0){r="configureChart";}else{r="configurator";}sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:r,context:c});},onRoutePatternMatched:function(E){var v=this.getView();var t=this;if(E.getParameter("name")==="detail"){t.errorState=undefined;t.errorMsg=undefined;try{if(this.oApplicationFacade.__refreshModel&&this.oApplicationFacade.__refreshModel===1){this.getView().getModel()&&this.getView().getModel().refresh();}this.isPasteEnabled=false;var a=E.getParameter("arguments").contextPath;var c=new sap.ui.model.Context(v.getModel(),'/'+a);this.evalContext=c;v.setBindingContext(c);if(!(this.oApplicationFacade.__refreshModel)&&c.getObject()&&(c.getObject()["VIEWS_COUNT"]===null)){this.oApplicationFacade.navigatingWithinDrilldown=this.navigatingWithinDrilldown;sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:c.sPath.substr(1)});return;}this.oApplicationFacade.__refreshModel=undefined;try{this.evaluationId=v.getBindingContext().getObject()["ID"];}catch(e){try{this.evaluationId=a.match(/ID=[^,]+/g)[0].replace(/(ID=')|(')/g,"");}catch(e){this.evaluationId=a.replace(/EVALUATIONS_MODELER\('|'\)/g,"")}}var b=E.getParameter("arguments")["evaluationId"];if(b!==this.evaluationId){this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,true,this.getView().getModel("i18n"));this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);var n=this.DDA_MODEL.NEW_VIEWID;var d=this.DDA_MODEL.getConfigurator().getDefaultViewId();if(this.DDA_MODEL.getConfigurator().getAllViews().length==0){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:c.sPath.substr(1)});}if(d!=null){this.viewId=d;this.DDA_MODEL.setViewId(d);}else{this.viewId=n;}this.oApplicationFacade.configuratorViewId=this.DDA_MODEL.NEW_VIEWID;this.bindUiToModel();this.ddaFilter.setEvaluationData(this.EVALUATION);this.ddaFilter.setEvaluationId(this.evaluationId);var f=[];this.getView().getModel("SB_DDACONFIG").getProperty("/FILTERS").forEach(function(s){f.push(s.name);});this.ddaFilter.setDimensions(f);}else{this.bindUiToModel();if(this.viewId==n&&this.getView().getModel("SB_DDACONFIG").getProperty("/ID")!=n){}}this.INIT_COUNT_HEADERS=this.getView().getModel("SB_DDACONFIG").getData()["HEADERS"].length;this.INIT_COUNT_FILTERS=this.getView().getModel("SB_DDACONFIG").getData()["FILTERS"].length;this._oTextsModel=this.getView().getModel("i18n");var o=this.getView().byId("vizViewSelector");o.bindProperty("selectedKey","SB_DDACONFIG>/ID");this.getView().byId("choroplethViewSelect").bindProperty("selectedKey","SB_DDACONFIG>/ID");this._oModel=this.getView().getModel("SB_DDACONFIG").getData();this.refreshChart();if(this.copyClipboard&&Object.keys(this.copyClipboard)&&Object.keys(this.copyClipboard).length){this.checkEvaluationForPaste();}else{if(this._oControlStore&&this._oControlStore.oButtonListHelper){this.updateHeaderFooterOptions(false);}}if(this.getPage().getFooter()){this.checkForCopy();}}catch(e){t.errorState=true;t.errorMsg=e.message;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{if(this.byId("choroplethViewSelect")&&this.byId("choroplethViewSelect").getSelectedItem()){this.byId("choroplethViewSelect").setTooltip(this.byId("choroplethViewSelect").getSelectedItem().getText());}if(this.byId("vizViewSelector")&&this.byId("vizViewSelector").getSelectedItem()){this.byId("vizViewSelector").setTooltip(this.byId("vizViewSelector").getSelectedItem().getText());}}}},defineHeaderFooterOptions:function(){var t=this;this.oHeaderFooterOptions={bSuppressBookmarkButton:true,sI18NDetailTitle:"DRILLDOWN_CONFIG_DETAILS",oEditBtn:{sI18nBtnTxt:"CONFIGURE",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.lauchConfigurator()},bEnabled:false,},buttonList:[{sId:"Copy",sI18nBtnTxt:"COPY",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyEvaluationToClipboard();}},{sId:"Paste",sI18nBtnTxt:"PASTE",bDisabled:(!(t.isPasteEnabled)),onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.copyDDAConfiguration();}},{sId:"Delete",sI18nBtnTxt:"DELETE",onBtnPressed:function(e){if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}t.onDeleteConfiguration();}}]};},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},formatColorForMap:function(m,t){var s=this.dda_config.chartConfig.colorScheme.toUpperCase();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var d=this._oModel;this.dda_config={};this.dda_config.chartConfig={mode:d.DATA_MODE||"DUMMY",title:"",dataLimit:d.DATA_LIMIT||null,dataLimitations:d.DATA_LIMITATIONS||false,type:(d.CHART_TYPE).toUpperCase()||"BAR",axis:d.AXIS_TYPE||"SINGLE",value:d.VALUE_TYPE||"ABSOLUTE",colorScheme:d.COLOR_SCHEME||"NONE",thresholdMeasure:d.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<d.COLUMNS.length;i++){this.dda_config.columnsConfig.push({name:d.COLUMNS[i].NAME,type:d.COLUMNS[i].TYPE,visibility:d.COLUMNS[i].VISIBILITY||"BOTH",columns_order:d.COLUMNS[i].COLUMNS_ORDER,sortOrder:d.COLUMNS[i].SORT_ORDER||"NONE",sortBy:d.COLUMNS[i].SORT_BY||"",axis:d.COLUMNS[i].AXIS||1,stacking:d.COLUMNS[i].STACKING||0,color:d.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?d.COLUMNS[i].COLOR1:d.COLOR_SCHEME=="MANUAL_SEMANTIC"?d.COLUMNS[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.QUERY_SERVICE_URI,this._oModel.QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_select_vbox");var b=this.getView().byId("choropleth_vbox");var g,m,t=null;v.setVisible(false);a.setVisible(true);b.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var d=this.getView().getModel("SB_DDACONFIG").getData().COLUMNS;var e=d.length;var f=[];for(i=0;i<e;i++){if(d[i].TYPE=='MEASURE'){f.push(d[i]);}else if(d[i].TYPE=='DIMENSION'){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=d[i].NAME;}}this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=f[0].NAME;if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}jQuery.sap.require("sap.ui.vbm.AnalyticMap");b.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"600px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isisStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(s):s;};},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,t){var a=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o},state:{parts:[{path:o},{path:t}],formatter:function(m,b){try{m=window.parseFloat(m);b=window.parseFloat(b);return a._getValueState(m,b);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},getRuntimeChartData:function(d,m){var t=this;var c=this.getView().byId("vizChartContainer");c.setBusy(true);this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});}}}try{var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.QUERY_SERVICE_URI,entitySet:this._oModel.QUERY_ENTITY_SET,dimension:d,measure:m,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}c.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);});}catch(e){jQuery.sap.log.error(e.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});c.setBusy(false);}},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},onDeleteConfiguration:function(){var t=this;var s=t;this.confirmDialog=new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("DELETE_ALL_CONFIGURATIONS")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){t.busyIndicator.open()&&t.getView().setBusy(true);s.deleteMaster();}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})});this.confirmDialog.open();},deleteMaster:function(){var t=this;var m=this.getView().getModel("SB_DDACONFIG").getData();this.busyIndicator.open()&&this.getView().setBusy(true);var s=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");s.saveEvalConfiguration(this.evaluationId,m,"delete",function(){jQuery.sap.log.info("Deleted master configuration for the evaluation");t.busyIndicator.close()&&t.getView().setBusy(false);sap.m.MessageToast.show(t._oTextsModel.getResourceBundle().getText("EVAL_CONFIG_DELETE_SUCCESS"));t.confirmDialog.close();t.DDA_MODEL.removeAllViews();t.DDA_MODEL.setViewId("");t.bindUiToModel();t._oModel=t.DDA_MODEL.getModelDataForDDAConfiguration();t.refreshChart();sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"noDataView",context:t.evalContext.sPath.substr(1)});t.getView().getModel().refresh();},function(e){jQuery.sap.log.error(e+" failed");t.busyIndicator.close()&&t.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("DELETE_ERROR"));});},updateHeaderFooterOptions:function(p){this.isPasteEnabled=p;this.defineHeaderFooterOptions();this.setHeaderFooterOptions(this.getHeaderFooterOptions());},checkEvaluationForPaste:function(){var c=this.EVALUATION.evaluationData;var a=this.getView().getModel("SB_DDACONFIG").getData();if((this.copyClipboard.evaluationData.ID==c.ID)||this.checkEvaluationForPaste1()){this.updateHeaderFooterOptions(false);}else{this.updateHeaderFooterOptions(true);}},checkEvaluationForPaste1:function(){var b=this.copyClipboard.masterData;var d={};var f={};if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.length==1){d[this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES[0]]="M";}else{d=this.getView().getModel("SB_DDACONFIG").getData().ALL_MEASURES.reduce(function(p,c,i,a){d=d||{};if(i==1){d[a[0]]="M";}d[a[i]]="M";return d;});}}if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length){if(this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.length==1){f[this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS[0]]="D";}else{f=this.getView().getModel("SB_DDACONFIG").getData().ALL_DIMENSIONS.reduce(function(p,c,i,a){f=f||{};if(i==1){f[a[0]]="D";}f[a[i]]="D";return f;});}}var g=null;this.diffHeaders=[];for(var i=0,l=b.FILTERS.length;i<l;i++){delete b.FILTERS[i].__metadata;if(f[b.FILTERS[i].DIMENSION]!="D"){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.FILTERS[i].DIMENSION]==undefined){g.DIMENSIONS[b.FILTERS[i].DIMENSION]=[];}b.FILTERS[i].entityType="FILTER";g.DIMENSIONS[b.FILTERS[i].DIMENSION].push(b.FILTERS[i]);}}for(var i=0,l=b.CHART.length;i<l;i++){delete b.CHART[i].__metadata;if(b.CHART[i].THRESHOLD_MEASURE){if(d[b.CHART[i].THRESHOLD_MEASURE]!="M"){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]==undefined){g.MEASURES[b.CHART[i].THRESHOLD_MEASURE]=[];}b.CHART[i].entityType="THRESHOLD_MEASURE";g.MEASURES[b.CHART[i].THRESHOLD_MEASURE].push(b.CHART[i]);}}}for(var i=0,l=b.COLUMNS.length;i<l;i++){delete b.COLUMNS[i].__metadata;var h=null;var k=null;if(b.COLUMNS[i].TYPE=="MEASURE"){if((d[b.COLUMNS[i].NAME]!="M")){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.COLUMNS[i].NAME]==undefined){g.MEASURES[b.COLUMNS[i].NAME]=[];}b.COLUMNS[i].entityType="MEASURE";g.MEASURES[b.COLUMNS[i].NAME].push(b.COLUMNS[i]);}if((d[b.COLUMNS[i].SORT_BY]!="M")){if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[b.COLUMNS[i].SORT_BY]==undefined){g.MEASURES[b.COLUMNS[i].SORT_BY]=[];}h=jQuery.extend(true,{},b.COLUMNS[i],{});h.entityType="SORT_BY";g.MEASURES[b.COLUMNS[i].SORT_BY].push(h);}}else if(b.COLUMNS[i].TYPE=="DIMENSION"){if((f[b.COLUMNS[i].NAME]!="D")){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.COLUMNS[i].NAME]==undefined){g.DIMENSIONS[b.COLUMNS[i].NAME]=[];}b.COLUMNS[i].entityType="DIMENSION";g.DIMENSIONS[b.COLUMNS[i].NAME].push(b.COLUMNS[i]);}if((f[b.COLUMNS[i].SORT_BY]!="D")){if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.COLUMNS[i].SORT_BY]==undefined){g.DIMENSIONS[b.COLUMNS[i].SORT_BY]=[];}k=jQuery.extend(true,{},b.COLUMNS[i],{});k.entityType="SORT_BY";g.DIMENSIONS[b.COLUMNS[i].SORT_BY].push(k);}}}for(var i=0,l=b.HEADER.length;i<l;i++){if(b.HEADER[i].EVALUATION_ID!==b.HEADER[i].REFERENCE_EVALUATION_ID){this.diffHeaders.push(b.HEADER[i]);}else{if((b.HEADER[i].VISUALIZATION_TYPE!="NT")&&(b.HEADER[i].VISUALIZATION_TYPE!="AT")){if((b.HEADER[i].VISUALIZATION_TYPE==="CM")){var n=undefined;try{n=JSON.parse(JSON.parse(b.HEADER[i].CONFIGURATION).MEASURES);}catch(e){throw new Error("Failed to parse multiple measures of Comparison Chart Multiple Measures");}for(var j=0,m=n.length;i<m;i++){if(d[n[j]["name"]]!="M"){b.HEADER[i].entityType="HEADERS";if(g==null){g={};}if(g.MEASURES==undefined){g.MEASURES={};}if(g.MEASURES[n[j]["name"]]==undefined){g.MEASURES[n[j]["name"]]=[];}g.MEASURES[n[j]["name"]].push(b.HEADER[i]);break;}}}else{if(f[b.HEADER[i].DIMENSION]!="D"){b.HEADER[i].entityType="HEADERS";if(g==null){g={};}if(g.DIMENSIONS==undefined){g.DIMENSIONS={};}if(g.DIMENSIONS[b.HEADER[i].DIMENSION]==undefined){g.DIMENSIONS[b.HEADER[i].DIMENSION]=[];}g.DIMENSIONS[b.HEADER[i].DIMENSION].push(b.HEADER[i]);}}}}}return g;},copyEvaluationToClipboard:function(){var t=this;var c=function(){t.copyClipboard={};t.copyClipboard.MasterData=t.getView().getModel("SB_DDACONFIG").getData();t.copyClipboard.masterData=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData;t.copyClipboard.evaluationData=t.EVALUATION.evaluationData;sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("COPY_DDA_TO_CLIPBOARD",t.EVALUATION.evaluationData.TITLE||(t.EVALUATION.evaluationData.ID+"*")));t.oApplicationFacade.copyClipboard=t.copyClipboard;t.updateHeaderFooterOptions(false);};if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER.length){var d=[];for(var i=0,l=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER.length;i<l;i++){if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i].EVALUATION_ID!=sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i].REFERENCE_EVALUATION_ID){d.push(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.HEADER[i]);}}if(d&&d.length){t.warnDialog=t.warnDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("RELATED_KPIS_HEADER_TILES_EXIST_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnDialog.close();c();}})});t.warnDialog.open();}else{c();}}else{c();}},copyDDAConfiguration:function(){var t=this;if(this.copyClipboard&&this.copyClipboard.evaluationData){var p={sourceEvaluationId:this.copyClipboard.evaluationData.ID,targetEvaluationId:this.EVALUATION.evaluationData.ID};var c=function(){sap.suite.ui.smartbusiness.lib.Util.utils.create(sap.suite.ui.smartbusiness.lib.Util.utils.serviceUrl("COPY_DDA_CONFIGURATION_SERVICE_URI"),p,null,function(d){sap.m.MessageToast.show(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_SUCCESS"));t.getView().getModel().refresh();var e={getParameter:function(a){var b={name:"detail",arguments:{contextPath:"EVALUATIONS_MODELER(ID='"+t.evaluationId+"',IS_ACTIVE=1)"}};return b[a];}};t.onRoutePatternMatched(e);},function(e){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("DDA_COPY_ERROR"),e.responseText);});};if(sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER.length){this.warnOverwriteDialog=this.warnOverwriteDialog||new sap.m.Dialog({icon:"sap-icon://warning2",title:t.oApplicationFacade.getResourceBundle().getText("WARNING"),state:"Warning",type:"Message",content:[new sap.m.Text({text:t.oApplicationFacade.getResourceBundle().getText("DDA_CONFIG_EXISTING_WARN")})],beginButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CONTINUE"),press:function(){t.warnOverwriteDialog.close();c();}}),endButton:new sap.m.Button({text:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),press:function(){t.warnOverwriteDialog.close();}})});this.warnOverwriteDialog.open();}else{c();}}},checkForCopy:function(){if(sap.suite.ui.smartbusiness.lib.DrilldownConfiguration&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER&&sap.suite.ui.smartbusiness.lib.DrilldownConfiguration.MasterData.MASTER.length){this.setBtnEnabled("Copy",true);}else{this.setBtnEnabled("Copy",false);}},onAfterRendering:function(){this.checkForCopy();},createVizChart:function(d,m){var t=this;var v=this.getView().byId("vizChartContainer");v.removeAllContent();var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if((this.dda_config.chartConfig.type).toUpperCase()=="TABLE"){v.addContent(T);setTimeout(function(){v.rerender();},0);}else{var V=this.getVizTypeAndIcon();var a=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,}});this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var b=new sap.viz.ui5.controls.Popover();b.connect(o.getVizUid());this.setAllVizFormatters();this.applyColorToViz(o);a.setContent(o);v.addContent(a);v.addContent(T);}},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b={locale:function(){},format:function(d,p){var e=sap.ui.core.format.NumberFormat.getInstance();return e.format(d);}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(b);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=(this._oModel)["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if((this._oModel)["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},onVizViewChange:function(e){var k=e.getParameters().selectedItem.getProperty("key");this.viewId=k;this.DDA_MODEL.setViewId(this.viewId);this._oModel=this.DDA_MODEL.getModelDataForDDAConfiguration();this.bindUiToModel();this.refreshChart();e.getSource().setTooltip(e.getParameters().selectedItem.getText());},});
