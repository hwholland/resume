/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Util");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.IDGenerator");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.ui.vbm.AnalyticMap");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.suite.ui.smartbusiness.lib.Util");sap.ca.scfld.md.controller.ScfldMasterController.extend("sap.suite.ui.smartbusiness.designtime.drilldown.view.configureNewView",{onInit:function(){var t=this;this.chartDummyData={MEASURES:[[50,80,40,120,60,200,170,20,160,190],[30,40,20,90,130,150,200,50,70,90],[120,60,200,20,160,190,200,30,40,20],[100,160,20,120,60,80,150,130,80,90],[180,70,90,30,20,80,130,40,160,190],[70,20,190,40,80,120,130,10,60,60],[90,80,100,50,160,90,80,30,140,120],[80,90,120,200,50,150,140,20,150,130],[90,130,150,180,70,90,70,20,190,40],[20,160,190,10,160,20,100,50,160,90],[40,160,190,30,40,20,90,130,150,180]]};this.CDS="cds";var v=jQuery.sap.getUriParameters().get("viewmode");v=v?v.toUpperCase():null;if(v===this.CDS.toUpperCase()){this.isCDS=true;}this.errorState=false;this.DDA_MODEL=null;this.evaluationId=null;this.COLUMN_LABEL_MAPPING={};this.measureDimensionList=this.byId(sap.ui.core.Fragment.createId('measureDimensionsList','measureDimensionsList'));this._oDimensionList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);this._oMeasureList=sap.ui.xmlfragment("sap.suite.ui.smartbusiness.designtime.drilldown.view.list",this);try{if(sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog")){sap.ui.core.Fragment.byId("measureDimensionDialog","measureDimensionDialog").destroy();}if(sap.ui.core.Fragment.byId("thresholdDialog","dialogRef")){sap.ui.core.Fragment.byId("thresholdDialog","dialogRef").destroy();}if(sap.ui.core.Fragment.byId("editDialog","editDialog")){sap.ui.core.Fragment.byId("editDialog","editDialog").destroy();}if(sap.ui.core.Fragment.byId("editChartDialog","editChartDialog")){sap.ui.core.Fragment.byId("editChartDialog","editChartDialog").destroy();}if(sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig")){sap.ui.core.Fragment.byId("dualAxisConfig","dualAxisConfig").destroy();}if(sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog")){sap.ui.core.Fragment.byId("msrDialogForStack1","stack1SelectDialog").destroy();}if(sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog")){sap.ui.core.Fragment.byId("additionalLanguageDialog","additionalLanguageDialog").destroy();}if(sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig")){sap.ui.core.Fragment.byId("chartTypeConfig","chartTypeConfig").getParent().destroy();}if(sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethSettingsDialog")){sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethSettingsDialog").destroy();}}catch(e){};this._oShowMeasureDialog=sap.ui.xmlfragment("measureDimensionDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.measureDimensionDialog",this);this._oShowMeasureDialog.addStyleClass("dialog");this.addThresholdMeasureDialog=sap.ui.xmlfragment("thresholdDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.addThresholdMeasure",this);this._editMeasureDialog=sap.ui.xmlfragment("editDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.editDialog",this);this._editChartDialog=sap.ui.xmlfragment("editChartDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.editChartDialog",this);this._dualAxisConfig=sap.ui.xmlfragment("dualAxisConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.dualAxisConfig",this);this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this);this.AdditionalLanguagesDialog=new sap.ui.xmlfragment("additionalLanguageDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.additionalLanguagesDialog",this);this.choroplethSettingsDialog=new sap.ui.xmlfragment("choroplethSettingsDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.choroplethSettingsDialog",this);this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);this.oRouter.attachRoutePatternMatched(this.onRoutePatternMatched,this);this.busyIndicator=new sap.m.BusyDialog();if(this.oApplicationFacade.navigatingWithinDrilldown){this.navigatingWithinDrilldown=true;this.oApplicationFacade.navigatingWithinDrilldown=undefined;}else{this.navigatingWithinDrilldown=false;}this.choroplethSettingsDialog.attachAfterOpen(jQuery.proxy(t.afterChoroplethSettingsDialogOpen,t));},onError:function(e){sap.suite.ui.smartbusiness.lib.Util.utils.handleMessagePopover(e,this);},afterChoroplethSettingsDialogOpen:function(c){var t=this;var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").getBinding("items").filter(new sap.ui.model.Filter(f,true));sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").rerender();this.handleMainMeasureChange();},onRoutePatternMatched:function(E){var t=this;var n;if(E.getParameter("name")==="configureChart"){t.errorState=undefined;t.errorMsg=undefined;try{this.evaluationId=E.getParameter("arguments")["evaluationId"];this.currentViewId=E.getParameter("arguments")["viewId"];this.DDA_MODEL=sap.suite.ui.smartbusiness.lib.DrilldownModel.Model.getInstance(this.evaluationId,false,this.getView().getModel("i18n"));if(this.currentViewId!==this.DDA_MODEL.NEW_VIEWID){this.DDA_MODEL.setViewId(this.currentViewId);}else{this.DDA_MODEL.setViewId(this.DDA_MODEL.NEW_VIEWID);n=true;}this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(this.DDA_MODEL.EVALUATION_DATA);this.mProperties=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this.EVALUATION.getODataUrl(),this.EVALUATION.getEntitySet());this.COLUMN_LABEL_MAPPING=this.mProperties.getLabelMappingObject();this.bindUiToModel();this._oModel=this.getView().getModel("SB_DDACONFIG");this._oModel.getData().NO_OF_ADDITIONAL_LANGUAGES=this._oModel.getData().ADDITIONAL_LANGUAGE_TITLES.length?(this._oModel.getData().ADDITIONAL_LANGUAGE_TITLES.length-1):0;this._oTextsModel=this.getView().getModel("i18n");this._editMeasureDialog.setModel(this._oTextsModel,"i18n");this._editChartDialog.setModel(this._oTextsModel,"i18n");this._dualAxisConfig.setModel(this._oTextsModel,"i18n");this._msrDialogForStack1.setModel(this._oTextsModel,"i18n");this._oShowMeasureDialog.setModel(this._oTextsModel,"i18n");this.addThresholdMeasureDialog.setModel(this._oTextsModel,"i18n");this.prepareInitialModelData(this._oModel);this._updateMeasureDimensionBindings();this.choroplethSettingsDialog.setModel(this._oTextsModel,"i18n");this.choroplethSettingsDialog.setModel(this._oModel,"SB_DDACONFIG");this.nDecimal=this.EVALUATION.getDecimalPrecision();this.oFormatOptions_core={style:"short"};if(!(this.nDecimal===null||this.nDecimal===-1)){this.oFormatOptions_core.minFractionDigits=this.nDecimal;this.oFormatOptions_core.maxFractionDigits=this.nDecimal;}if(this.nDecimal===-1){this.oFormatOptions_core.minFractionDigits=2;this.oFormatOptions_core.maxFractionDigits=2;}this.refreshChart();this.chartTypeInit();jQuery.sap.require("sap.suite.ui.smartbusiness.lib.AppSetting");var v=this.getView().getModel("SB_DDACONFIG").getData();if(this.currentViewId==this.DDA_MODEL.NEW_VIEWID){this.generateViewId(this);}this.takeConfigMasterSnapShot();this.initCopy=this.getView().getModel("SB_DDACONFIG").getJSON();sap.suite.ui.smartbusiness.lib.AppSetting.init({oControl:this.byId("chartIdInput"),controllerReference:t,hideElement:"input",i18n:{checkBoxText:t.oApplicationFacade.getResourceBundle().getText("CHECKBOX_TEXT"),saveText:t.oApplicationFacade.getResourceBundle().getText("OK"),cancelText:t.oApplicationFacade.getResourceBundle().getText("CANCEL"),settingsText:t.oApplicationFacade.getResourceBundle().getText("SETTINGS"),settingInfoTitle:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TITLE"),settingInfoText:t.oApplicationFacade.getResourceBundle().getText("SETTING_INFO_TEXT")},title:t.oApplicationFacade.getResourceBundle().getText("SETTINGS_SB"),action:t.generateViewId});this.settingModel=sap.ui.getCore().getModel("SB_APP_SETTING")||new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(this.settingModel,"SB_APP_SETTING");this.getView().setModel(sap.ui.getCore().getModel("SB_APP_SETTING"),"SB_APP_SETTING");}catch(e){t.errorState=true;t.errorMsg=e.message;sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(this.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),e.message);}finally{this.setTooltipForAllSelect();}if(n){this.openAllMeasuresDimension();}}},setTooltipForAllSelect:function(){var s,t,i,l;var d=this.getView().getModel("SB_DDACONFIG").getData();s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));for(i=0,l=d.CHART_TYPES.length;i<l;i++){if(d.CHART_TYPES[i].key==d.CHART_TYPE){t=d.CHART_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual"));for(i=0,l=d.AXIS_TYPES.length;i<l;i++){if(d.AXIS_TYPES[i].key==d.AXIS_TYPE){t=d.AXIS_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute"));for(i=0,l=d.VALUE_TYPES.length;i<l;i++){if(d.VALUE_TYPES[i].key==d.VALUE_TYPE){t=d.VALUE_TYPES[i].text;}}s.setTooltip(t);s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));for(i=0,l=d.COLOR_SCHEMES.length;i<l;i++){if(d.COLOR_SCHEMES[i].key==d.COLOR_SCHEME){t=d.COLOR_SCHEMES[i].text;}}s.setTooltip(t);s=this.getView().byId("chartDataMode");t=d.DATA_MODES[0].text;s.setTooltip(t);},displayLabelsFormatter:function(s){return this.COLUMN_LABEL_MAPPING[s]||s;},bindUiToModel:function(){this.DDA_MODEL.bindModel(this.getView(),"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editMeasureDialog);this.DDA_MODEL.bindModel(this._editChartDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._editChartDialog);this.DDA_MODEL.bindModel(this._oShowMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this._oShowMeasureDialog);this.DDA_MODEL.bindModel(this.addThresholdMeasureDialog,"SB_DDACONFIG");this.DDA_MODEL.bindModel(this.AdditionalLanguagesDialog,"SB_DDACONFIG");},_cloneObj:function(e){var t;if(e instanceof Array){t=[];for(var i=0;i<e.length;i++){t[i]=this._cloneObj(e[i]);}}else if(e instanceof Object){t={};for(var a in e){if(e.hasOwnProperty(a)){t[a]=this._cloneObj(e[a]);}}}else{t=e;}return t;},takeConfigMasterSnapShot:function(){this._masterConfig=this._cloneObj(this._oModel.getData());},restoreFromConfigMasterSnapShot:function(){this._oModel.setData(this._cloneObj(this._masterConfig));},copyConfigSnapshot:function(){this._config=this._cloneObj(this._oModel.getData());this.enableOrDisableSave();},restorePrevConfig:function(){this._oModel.setData(this._cloneObj(this._config));},prepareInitialModelData:function(m){var t=m.getData();var a=(t.AXIS_TYPE==="SINGLE");var d=t.ALL_DIMENSIONS;var b=t.ALL_MEASURES;var c=[],e={};var f=t.COLUMNS;for(var i=0;i<f.length;i++){if(a&&f[i].TYPE==="MEASURE"){f[i].AXIS=1;}f[i].SELECTED=true;f[i].LABEL=this.COLUMN_LABEL_MAPPING[f[i].NAME];c.push(f[i]);e[f[i].NAME]=true;}for(var i=0;i<d.length;i++){if(e[d[i]])continue;c.push({AXIS:1,NAME:d[i],SORT_BY:d[i],SORT_ORDER:"none",STACKING:0,TYPE:"DIMENSION",VISIBILITY:"BOTH",SELECTED:false,LABEL:this.COLUMN_LABEL_MAPPING[d[i]]});}for(var i=0;i<b.length;i++){if(e[b[i]]){continue;}c.push({0:Object,AXIS:1,COLOR1:"",COLOR2:"",NAME:b[i],SORT_BY:b[i],SORT_ORDER:"none",STACKING:0,TYPE:"MEASURE",VISIBILITY:"BOTH",SELECTED:t.SELECTED_VIEW==""?this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME==b[i]:false,LABEL:this.COLUMN_LABEL_MAPPING[b[i]]});}t.items=c;m.setData(t);},_updateMeasureDimensionBindings:function(){var f=new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true);var s=new sap.ui.model.Sorter("COLUMNS_ORDER",false,null);var b=this.measureDimensionList.getBinding("items");b.filter(f);b.sort(s);},onChartTypeChange:function(e){var t=this;if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).setVisible(c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH");this.updateSemanticColorComboBox(c.getSelectedKey());this._updateMeasureDimensionBindings();this.getView().getModel('SB_DDACONFIG').setProperty("/AXIS_TYPE","SINGLE");this.getView().getModel('SB_DDACONFIG').setProperty("/VALUE_TYPE","ABSOLUTE");this.getView().getModel('SB_DDACONFIG').setProperty("/COLOR_SCHEME","NONE");if(c.getSelectedKey().toUpperCase()=="LINE"||c.getSelectedKey().toUpperCase()=="COMBINATION"||c.getSelectedKey().toUpperCase()=="BUBBLE"||c.getSelectedKey().toUpperCase()=="TABLE")this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","openchartsettings")).setEnabled(false);else this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","openchartsettings")).setEnabled(true);if(c.getSelectedKey().toUpperCase()=="CHOROPLETH"){if(this.chartMeasures.length<2){this.refreshChart();}else if(this.chartDimensions.length>1){this.refreshChart();}else{t.choroplethSettingsDialog.open();}}else{this.refreshChart();}this.enableOrDisableSave();c.setTooltip(c.getSelectedItem().getText());},chartTypeInit:function(e){var t=this;if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartTypeConfig"));var c=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()!="BUBBLE")this.copyConfigSnapshot();this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setVisible((c.getSelectedKey().toUpperCase()!="BUBBLE"&&c.getSelectedKey().toUpperCase()!="TABLE"&&c.getSelectedKey().toUpperCase().toUpperCase()!="LINE"&&c.getSelectedKey().toUpperCase()!="COMBINATION"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH")?true:false);this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).setVisible(c.getSelectedKey().toUpperCase()!="GEOMAP"&&c.getSelectedKey().toUpperCase()!="CHOROPLETH");this.setSemanticColorComboBox(c.getSelectedKey());this.refreshChart();this.enableOrDisableSave();},updateSemanticColorComboBox:function(c){if(!this._chartTypeConfig){this._chartTypeConfig=sap.ui.xmlfragment("chartTypeConfig","sap.suite.ui.smartbusiness.designtime.drilldown.view.chartTypeConfig",this);}c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}else if(c=="BUBBLE"){s.setSelectedKey("NONE");s.setVisible(false);}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);if(!(s.getSelectedKey().toUpperCase()=="NONE"||s.getSelectedKey().toUpperCase()=="AUTO_SEMANTIC"))s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}else if(c=="CHOROPLETH"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);if(this.dda_config.chartConfig.colorScheme=="AUTO_SEMANTIC"){s.setSelectedKey("AUTO_SEMANTIC");if(!(this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));return;}}else{s.setSelectedKey("NONE");}}else if(c=="LINE"||c=="COMBINATION"){s.setSelectedKey("MANUAL_NON_SEMANTIC");s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}},setSemanticColorComboBox:function(c){c=c.toUpperCase();var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));if(c=="BAR"||c=="COLUMN"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);if(this.isStackDim){s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}else if(c=="BUBBLE"){s.setVisible(false);}else if(c=="TABLE"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}else if(c=="CHOROPLETH"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);if(this.dda_config.chartConfig.colorScheme=="AUTO_SEMANTIC"){s.setSelectedKey("AUTO_SEMANTIC");if(!(this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(that.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));return;}}else{s.setSelectedKey("NONE");}}else if(c=="LINE"||c=="COMBINATION"){s.setVisible(true);s.setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}},formatcolor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"transparent";},formatEditColor:function(s){return s?sap.ui.core.theming.Parameters.get(s):"black";},sortByMeasureVisibility:function(s){return s?(s.toUpperCase()=="MEASURE"||s.toUpperCase()=="KPI MEASURE"):false;},sortByDimensionVisibility:function(s){return s?s.toUpperCase()=="DIMENSION":false;},openAllMeasuresDimension:function(){this.copyConfigSnapshot();this._oShowMeasureDialog.open();var b=this._oShowMeasureDialog.getContent()[0];b.getButtons()[1].firePress();if(b.getSelectedButton()==b.getButtons()[1].getId()){this.showDimensionList();}else{this.showMeasureList();}},_isAddDimensionMode:function(){var b=this._oShowMeasureDialog.getContent()[0];return b.getSelectedButton()==b.getButtons()[1].getId()},onMeasureDimensionSearch:function(e){var m=this._isAddDimensionMode()?"DIMENSION":"MEASURE";var c=this._isAddDimensionMode()?this._oDimensionList:this._oMeasureList;var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.Contains,m)];var k=e.getSource().getValue();if(k&&k.length>0){f.push(new sap.ui.model.Filter("LABEL",sap.ui.model.FilterOperator.StartsWith,k));}var b=c.getBinding("items");b.filter(f);},onMeasureDimensionAdded:function(){var c=this._oDimensionList.getSelectedItems().length;if(this.chartMeasures.length==0||c==0){if(this.chartMeasures.length==0){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel("i18n").getProperty("NO_MEASURES")});}if(c==0){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel("i18n").getProperty("SELECT_AT_LEAST_ONE_DIMENSION")});}}else{this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close();this.refreshChart();this.enableOrDisableSave();}},onMeasureDimensionCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._oShowMeasureDialog.close();},showDimensionList:function(){this._oShowMeasureDialog.removeContent(this._oMeasureList);this._oShowMeasureDialog.addContent(this._oDimensionList);this._oDimensionList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"));},showMeasureList:function(){this._oShowMeasureDialog.removeContent(this._oDimensionList);this._oShowMeasureDialog.addContent(this._oMeasureList);this._oMeasureList.getBinding("items").filter(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"));},formatSortOrder:function(s){if(s=="asc"){return"sap-icon://up"}else if(s=="desc"){return"sap-icon://down"}else{return"";}},colorButtonVisiblity:function(s,c){if(s)return(c=="MANUAL_SEMANTIC"||c=="MANUAL_NON_SEMANTIC")&&s.toLowerCase()=='measure';},colorButton1Visiblity:function(s){return s=="MANUAL_NON_SEMANTIC";},colorButton2Visiblity:function(s){return s=="MANUAL_SEMANTIC";},openChartSettings:function(e){var t=this;this.copyConfigSnapshot();if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(true);this.copyStackConfigSnapshot();this.setDualStackModel(this.chartMeasures);}else{sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(false);}var S=t.getStacking(t.chartMeasures,t.chartDimensions);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setEnabled(true);if(S.isEnabled){sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(true);if(S.type==="M"){sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}else if(S.type==="D"){sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").setSelected(false);sap.ui.core.Fragment.byId("editChartDialog","dimStack").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:{path:"name",formatter:jQuery.proxy(t.formatMeasureName,t),}});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name);}}}else{sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(false);sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&(((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")||((this.dda_config.chartConfig.value).toUpperCase()==="PERCENTAGE"))){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setSelected(true);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setEnabled(false);}if(!(((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setVisible(false);}else{sap.ui.core.Fragment.byId("editChartDialog","enableStacking").setVisible(true);}if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"||(this.dda_config.chartConfig.type).toUpperCase()==="CHOROPLETH"){var f=[];var a;if((this.dda_config.chartConfig.type).toUpperCase()==="CHOROPLETH"){sap.ui.core.Fragment.byId("editChartDialog","messageAddThresholdMeasure").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","Dual_config_2").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(true);sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(true);var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"name":(new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getSelectedKey())),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getBinding('items').filter(new sap.ui.model.Filter(F,true));}else{sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(true);var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};}for(var i in a){f.push(a[i]);}var s=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","thresholdMeasureChart"));var b=s.getItems()?s.getItems():[];if(b.length&&s.getBinding('items')){s.getBinding('items').filter(f);}if(this._oModel.getData().THRESHOLD_MEASURE)s.setSelectedKey(this._oModel.getData().THRESHOLD_MEASURE);s.setTooltip(this._oModel.getData().THRESHOLD_MEASURE);}else{sap.ui.core.Fragment.byId("editChartDialog","ThresholdMeasureSettings").setVisible(false);sap.ui.core.Fragment.byId("editChartDialog","MainMeasureSettings").setVisible(false);}this._editChartDialog.open();},onEditIconPress:function(e){var t=this;this.copyConfigSnapshot();var b=e.getSource().getBindingContext("SB_DDACONFIG");this.columnBeingEdited=b.getObject();this._editMeasureDialog.bindElement(b.getPath());if(b.getObject().TYPE.toLowerCase()=="kpi measure"){sap.ui.core.Fragment.byId("editDialog","typeOf").setText(this.getView().getModel("i18n").getProperty("KPI_MEASURE"));}if(b.getObject().VISIBILITY.toUpperCase()==="CHART")sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(true);else sap.ui.core.Fragment.byId("editDialog","hideInTable").setSelected(false);sap.ui.core.Fragment.byId("editDialog","allMeasures").setTooltip(sap.ui.core.Fragment.byId("editDialog","allMeasures").getSelectedItem().getText());sap.ui.core.Fragment.byId("editDialog","allDimensions").setTooltip(sap.ui.core.Fragment.byId("editDialog","allDimensions").getSelectedItem().getText());sap.ui.core.Fragment.byId("editDialog","sortOrder").setTooltip(sap.ui.core.Fragment.byId("editDialog","sortOrder").getSelectedItem().getText());this._editMeasureDialog.open();},onEnableStacking:function(){var i=sap.ui.core.Fragment.byId("editChartDialog","enableStacking").getSelected();if(i){sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(true);}else{sap.ui.core.Fragment.byId("editChartDialog","stackingOptions").setVisible(false);}},onMsrStacking:function(){if(sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").getSelected()){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}},onDimStacking:function(){var t=this;if(sap.ui.core.Fragment.byId("editChartDialog","dimStack").getSelected()){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(true);var j=new sap.ui.model.json.JSONModel();j.setData({STdata:t.chartDimensions});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setModel(j);var o=new sap.ui.core.Item({key:"{name}",text:{path:"name",formatter:jQuery.proxy(t.formatMeasureName,t),}});sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").bindItems("/STdata",o);if(t.getDimensionToBeStacked(t.chartDimensions)){sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setSelectedKey(t.getDimensionToBeStacked(t.chartDimensions).name);sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setTooltip(this.COLUMN_LABEL_MAPPING[t.getDimensionToBeStacked(t.chartDimensions).name]);}else{sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setTooltip(this.COLUMN_LABEL_MAPPING[t.chartDimensions[0].name]);}}else{sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").setVisible(false);}},onAfterRendering:function(){this._fixSplitterHeight();sap.ui.Device.resize.attachHandler(this._fixSplitterHeight,this);},_fixSplitterHeight:function(){var _=$(window).height();var a=48;var b=49;this.byId('splitContainer').$().css("height",(_-(a+b+a))+"px");},onEditChartDialogOk:function(e){var t=this;if(sap.ui.core.Fragment.byId("editChartDialog","enableStacking").getSelected()){if(sap.ui.core.Fragment.byId("editChartDialog","addMsrToStack").getSelected()){t.setStacking(true,"M",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}}else if(sap.ui.core.Fragment.byId("editChartDialog","dimStack").getSelected()){var d=sap.ui.core.Fragment.byId("editChartDialog","dimsToStack").getSelectedKey();t.setStacking(true,"D",t._oModel.getData().items);t.setDimensionToBeStacked(t._oModel.getData().items,d);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.setSelectedKey("NONE");s.getItemByKey("AUTO_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(false);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(false);}}}else{t.setStacking(false,"N",t._oModel.getData().items);var s=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));var c=t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType"));if(c.getSelectedKey().toUpperCase()=="BAR"||c.getSelectedKey().toUpperCase()=="COLUMN"){s.getItemByKey("AUTO_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_NON_SEMANTIC").setEnabled(true);s.getItemByKey("MANUAL_SEMANTIC").setEnabled(true);}}if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){var a=this._oModel.getData();for(var i=0;i<a.items.length;i++){if(a.items[i].TYPE.toUpperCase()==="MEASURE"){a.items[i].AXIS=1;for(var j=0;j<t.chartMeasures.length;j++){if(a.items[i].NAME===t.chartMeasures[j].name){a.items[i].AXIS=t.chartMeasures[j].axis;break;}}}}this._oModel.setData(a);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){var b=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var f=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethThresholdMeasure").getSelectedKey();this.updateMeasuresAndDimensionsInmodel(b,f);}this.copyConfigSnapshot();this._updateMeasureDimensionBindings();this.refreshChart();this._editChartDialog.close();},onEditChartDialogCancel:function(e){this.restorePrevConfig();if((((this.dda_config.chartConfig.type).toUpperCase()==="BAR")||((this.dda_config.chartConfig.type).toUpperCase()==="COLUMN"))&&((this.dda_config.chartConfig.axis).toUpperCase()==="DUAL")){this.restoreStackPrevConfig();}this._updateMeasureDimensionBindings();this._editChartDialog.close();},onEditDialogOk:function(e){var t=this;var b=e.getSource().getBindingContext("SB_DDACONFIG");if(sap.ui.core.Fragment.byId("editDialog","hideInTable").getSelected()){t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","CHART");}else{t.updateColumnProperty(t._oModel.getData().items,t.columnBeingEdited.NAME,"VISIBILITY","BOTH");}this._updateMeasureDimensionBindings();this._editMeasureDialog.close();this.refreshChart();},onEditDialogCancel:function(){this.restorePrevConfig();this._updateMeasureDimensionBindings();this._editMeasureDialog.close();},_getColorPaletteTemplate:function(b){var i=new sap.ui.core.Icon({color:{path:"SB_DDACONFIG>color",formatter:this.formatcolor},src:"sap-icon://color-fill",size:"32px",width:"5%",press:function(e){var a=b.getModel("SB_DDACONFIG").getProperty("/COLOR_SCHEME");a=(a=="MANUAL_NON_SEMANTIC")?"COLOR1":(a=="MANUAL_SEMANTIC")?"COLOR2":"";b.getBindingContext().getObject()[a]=this.getBindingContext("SB_DDACONFIG").getProperty("color");b.getModel().refresh();}});var c=new sap.m.Label({text:{path:"SB_DDACONFIG>index",formatter:function(a){var t="";switch(a){case 1:t="Neutral";break;case 4:t="Good";break;case 7:t="Warning";break;case 10:t="Bad";}return t;}},visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"}}});return new sap.m.HBox({items:[i,c]});},showColorPopUp:function(e){var c;var b=e.getSource();var a=this._oModel.getProperty("/COLOR_SCHEME");var d=new sap.m.VBox();d.bindAggregation("items","SB_DDACONFIG>/"+a,this._getColorPaletteTemplate(b));var f=new sap.m.Popover({visible:{path:"SB_DDACONFIG>/COLOR_SCHEME",formatter:function(s){return s=="MANUAL_SEMANTIC"||s=="MANUAL_NON_SEMANTIC";}},showHeader:false,content:[d],});f.setModel(this._oModel,"SB_DDACONFIG");f.openBy(b);},onEditDialogCloseButton:function(){this._editMeasureDialog.close();},onSingleDualChange:function(){var t=this;var s=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual"))).getSelectedKey()).toUpperCase();this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setTooltip(this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).getSelectedItem().getText());switch(s){case"SINGLE":if(!(this.prevStack&&this.prevStack.isEnabled)){this.setStacking(false,"N",t._oModel.getData().items);}this.refreshChart();break;case"DUAL":if(this.chartMeasures.length<2){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("DUAL_AXIS_CHART_MIN_MEASURE"),{onClose:function(){t.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE");}});}else{this.prevStack=this.getStacking(this.chartMeasures,this.chartDimensions);this.setStacking(true,"M",this._oModel.getData().items);this.copyStackConfigSnapshot();this.dualStackValue(this.chartMeasures);this.setDualStackModel(this.chartMeasures);this._dualAxisConfig.open();}break;default:break;}},setDualStackModel:function(m){var t=this;var d=this.getMeasuresByAxis(m);var D=new sap.ui.model.json.JSONModel();D.setData({DATA:d.axis1.objArr});this._dualAxisConfig.setModel(D,"DUAL_AXIS1");this._editChartDialog.setModel(D,"DUAL_AXIS1");var a=new sap.ui.model.json.JSONModel();a.setData({DATA:d.axis2.objArr});this._dualAxisConfig.setModel(a,"DUAL_AXIS2");this._editChartDialog.setModel(a,"DUAL_AXIS2");sap.ui.core.Fragment.byId("dualAxisConfig","stack1list").setText("");sap.ui.core.Fragment.byId("editChartDialog","stack1list_edit").setText("");sap.ui.core.Fragment.byId("dualAxisConfig","stack2list").setText("");sap.ui.core.Fragment.byId("editChartDialog","stack2list_edit").setText("");sap.ui.core.Fragment.byId("dualAxisConfig","stack1list").setText("("+d.axis1.objArr.length+")");sap.ui.core.Fragment.byId("editChartDialog","stack1list_edit").setText("("+d.axis1.objArr.length+")");sap.ui.core.Fragment.byId("dualAxisConfig","stack2list").setText("("+d.axis2.objArr.length+")");sap.ui.core.Fragment.byId("editChartDialog","stack2list_edit").setText("("+d.axis2.objArr.length+")");},copyStackConfigSnapshot:function(){this._stackConfig=this._cloneObj(this.chartMeasures);},restoreStackPrevConfig:function(){this.chartMeasures=this._stackConfig;this.setDualStackModel(this._stackConfig);},stack1removed:function(e){var r=new sap.ui.model.Context(this._dualAxisConfig.getModel("DUAL_AXIS1"),e.getSource().getBindingContextPath()).getProperty();var t=this;if(e.getSource().getModel("DUAL_AXIS1").getData().DATA.length===1){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_ERROR_MSG"));}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===r.name){t.chartMeasures[i].axis=2;}}this.setDualStackModel(this.chartMeasures);}},stack2removed:function(e){var r=new sap.ui.model.Context(this._dualAxisConfig.getModel("DUAL_AXIS2"),e.getSource().getBindingContextPath()).getProperty();var t=this;if(e.getSource().getModel("DUAL_AXIS2").getData().DATA.length===1){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_ERROR_MSG"));}else{for(var i=0;i<t.chartMeasures.length;i++){if(t.chartMeasures[i].name===r.name){t.chartMeasures[i].axis=1;}}this.setDualStackModel(this.chartMeasures);}},onDualAxisDialogOk:function(){var t=this;var a=this._oModel.getData();for(var i=0;i<a.items.length;i++){if(a.items[i].TYPE.toUpperCase()==="MEASURE"){a.items[i].AXIS=1;for(var j=0;j<t.chartMeasures.length;j++){if(a.items[i].NAME===t.chartMeasures[j].name){a.items[i].AXIS=t.chartMeasures[j].axis;break;}}}}this._oModel.setData(a);this.refreshChart();this._dualAxisConfig.close();},onDualAxisDialogCancel:function(){this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","singleDual")).setSelectedKey("SINGLE");this.restoreStackPrevConfig();this._dualAxisConfig.close();},formatAxisToBool:function(a){if(a===1)return true;else return false;},openMsrDialogForStack1:function(){var t=this;if(!this._msrDialogForStack1){this._msrDialogForStack1=sap.ui.xmlfragment("msrDialogForStack1","sap.suite.ui.smartbusiness.designtime.drilldown.view.msrDialogForStack1",this);}var S=new sap.ui.model.json.JSONModel();S.setData({DATA:t.chartMeasures});this._msrDialogForStack1.setModel(S);this._msrDialogForStack1.open();},onSearchInStack1SelectDialog:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},onStack1SelectDialogOK:function(e){var t=this;var c=e.getParameter("selectedItems");if(!(c.length)){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("SELECT_MEASURE_FOR_AXIS",1));}else if(c.length==t.chartMeasures.length){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t._oTextsModel.getResourceBundle().getText("STACK_ALL_MEASURES"));}else{for(var i=0;i<t.chartMeasures.length;i++){t.chartMeasures[i].axis=1;for(var j=0;j<c.length;j++){if(t.chartMeasures[i].name===c[j].getTitle()){t.chartMeasures[i].axis=2;break;}}}e.getSource().getBinding("items").filter([]);var d=this.getMeasuresByAxis(this.chartMeasures);sap.ui.core.Fragment.byId("dualAxisConfig","stack1MsrsLabel").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("dualAxisConfig","stack2MsrsLabel").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr1").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("dualAxisConfig","AxisMsr2").setSelectedKey(d.axis2.nameArr[0])};sap.ui.core.Fragment.byId("editChartDialog","stack1MsrsLabel_edit").setText(d.axis1.nameArr.join(","));sap.ui.core.Fragment.byId("editChartDialog","stack2MsrsLabel_edit").setText(d.axis2.nameArr.join(","));if(d.axis1.nameArr.length){sap.ui.core.Fragment.byId("editChartDialog","AxisMsr1_edit").setSelectedKey(d.axis1.nameArr[0])};if(d.axis2.nameArr.length){sap.ui.core.Fragment.byId("editChartDialog","AxisMsr2_edit").setSelectedKey(d.axis2.nameArr[0])};}},onStack1SelectDialogCancel:function(){},onDataModeChange:function(){this.refreshChart();var d=this.getView().byId("chartDataMode");d.setTooltip(d.getSelectedItem().getText());},onIsAbsoluteChange:function(){var v=((this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute"))).getSelectedKey()).toUpperCase();if(v==="PERCENTAGE")this.setStacking(true,"M",this._oModel.getData().items);this.refreshChart();this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).setTooltip(this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","isAbsolute")).getSelectedItem().getText());},onSemanticColorOptionChange:function(){var t=this;var s=this.byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors"));s.setTooltip(s.getSelectedItem().getText());if(this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey()=="AUTO_SEMANTIC"){if(this.chartMeasures.length>=2){if(!(this.dda_config.chartConfig.type.toUpperCase()=="CHOROPLETH"&&this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE)){var f=[];var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};for(var i in a){f.push(a[i]);}var b=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure"));var c=b.getItems()?b.getItems():[];if(c.length&&b.getBinding('items')){b.getBinding('items').filter(f);}if(this._oModel.getData().THRESHOLD_MEASURE)b.setSelectedKey(this._oModel.getData().THRESHOLD_MEASURE);this.addThresholdMeasureDialog.open();if(b&&b.getSelectedItem()){b.setTooltip(b.getSelectedItem().getText());}return;}}}this.refreshChart();},onThresholdMeasureAdded:function(){var t=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("thresholdDialog","thresholdMeasure")).getSelectedKey();this.updateMeasuresAndDimensionsInmodel(this.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE,t);this.copyConfigSnapshot();this.refreshChart();this.addThresholdMeasureDialog.close();},onThresholdMeasureCancel:function(){this.addThresholdMeasureDialog.close();},getLAISOfromSPRAS:function(k){var a=this.getView().getModel('SB_DDACONFIG').getData().ALL_LANGUAGES;for(var i=0;i<a.length;++i){if(a[i]["SPRAS"]==k)return a[i]["LAISO"];}},getIndexOfDuplicate:function(d,l){for(var i=0;i<d.length;++i){if(d[i]["SAP_LANGUAGE_KEY"]==l)return i;}return-1;},openAdditionalLanguagesDialog:function(){var a=this;this.AdditionalLanguagesDialog.setModel(this._oTextsModel,"i18n");this.copyConfigSnapshot();sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").setValue("");var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.bindAggregation("items","SB_DDACONFIG>/ADDITIONAL_LANGUAGE_TITLES",new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{SB_DDACONFIG>TEXT}"}),new sap.m.Label({text:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return a.getLAISOfromSPRAS(s)}}}),new sap.ui.core.Icon({src:"sap-icon://decline",press:this.deleteEntry})],visible:{path:"SB_DDACONFIG>SAP_LANGUAGE_KEY",formatter:function(s){return s!=a._oModel.getData()["CURRENT_LANGUAGE"]}}}));this.AdditionalLanguagesDialog.open();return;},closeAdditionalLanguagesDialog_OK:function(e){this.copyConfigSnapshot();this.AdditionalLanguagesDialog.close();return;},closeAdditionalLanguagesDialog_Cancel:function(e){this.restorePrevConfig();this.AdditionalLanguagesDialog.close();return;},formatAdditionalLanguageLink:function(v){return this.oApplicationFacade.getResourceBundle().getText("ADDITIONAL_LANGUAGE")+"("+v+")";},deleteEntry:function(e){var b=e.getSource().getParent().getBindingContextPath();var i=parseInt(b.split("/").pop());var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");A.getModel("SB_DDACONFIG").getData()["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES=A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES-1;A.getModel("SB_DDACONFIG").refresh();return;},addEntry:function(){var n=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitle").getValue();var a=sap.ui.core.Fragment.byId("additionalLanguageDialog","newTitleLanguage").getSelectedKey();if(n&&a){}else return;var A=sap.ui.core.Fragment.byId("additionalLanguageDialog","ALTable");var t=A.getModel("SB_DDACONFIG").getData();var b={EVALUATION_ID:this.DDA_MODEL.getConfigurator().evaluationId,CONFIGURATION_ID:this._oModel.getData().SELECTED_VIEW||this._oModel.getData().ID,SAP_LANGUAGE_KEY:a,TEXT:n,IS_ACTIVE:this._oModel.getData()["IS_ACTIVE"]||1};var i;if((i=this.getIndexOfDuplicate(t["ADDITIONAL_LANGUAGE_TITLES"],a))==-1)t["ADDITIONAL_LANGUAGE_TITLES"].push(b);else{t["ADDITIONAL_LANGUAGE_TITLES"].splice(i,1);t["ADDITIONAL_LANGUAGE_TITLES"].push(b);}A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES=A.getModel("SB_DDACONFIG").getData().NO_OF_ADDITIONAL_LANGUAGES+1;A.getModel("SB_DDACONFIG").refresh();return;},formatName:function(a,b){return a+" "+b;},formatColorForMap:function(m,t){var s=this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey();var g=this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE;if(s=="AUTO_SEMANTIC"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiPositive'));}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNegative'));}}}else if(s=="NONE"&&t){if(g=="MA"||g=="RA"){if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}else if(g=="MI"){if(m<t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"1");}else if(m==t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.60");}else if(m>t){return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'),"0.30");}}}else{return sap.suite.ui.smartbusiness.lib.Util.utils.convertHexToRgba(sap.ui.core.theming.Parameters.get('sapUiNeutral'));}},formatCode:function(c){return c;},refreshChart:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_vbox");var g,m,t=null;this.canSave=false;this.oChartDataModel=new sap.ui.model.json.JSONModel();this.oChartData=[];var b=this._oModel.getData();this.dda_config={};this.dda_config.chartConfig={mode:b.DATA_MODE||"DUMMY",title:"",dataLimit:b.DATA_LIMIT||null,dataLimitations:b.DATA_LIMITATIONS||false,type:(b.CHART_TYPE).toUpperCase()||"BAR",axis:b.AXIS_TYPE||"SINGLE",value:b.VALUE_TYPE||"ABSOLUTE",colorScheme:b.COLOR_SCHEME||"NONE",thresholdMeasure:b.THRESHOLD_MEASURE||""};this.dda_config.columnsConfig=[];for(var i=0;i<b.items.length;i++){this.dda_config.columnsConfig.push({name:b.items[i].NAME,type:b.items[i].TYPE,selected:b.items[i].SELECTED||false,visibility:b.items[i].VISIBILITY||"BOTH",sortOrder:b.items[i].SORT_ORDER||"NONE",sortBy:b.items[i].SORT_BY||"",axis:b.items[i].AXIS||2,stacking:b.items[i].STACKING||0,color:b.COLOR_SCHEME=="MANUAL_NON_SEMANTIC"?b.items[i].COLOR1:b.COLOR_SCHEME=="MANUAL_SEMANTIC"?b.items[i].COLOR2:""});}this.oColumns=[];this.oDimensions=[];this.oMeasures=[];this.dimNameArray=[];this.msrNameArray=[];this.chartDimensions=[];this.chartDimNames=[];this.chartMeasures=[];this.chartMsrNames=[];this.tableDimensions=[];this.tableDimNames=[];this.tableMeasures=[];this.tableMsrNames=[];for(var i=0;i<this.dda_config.columnsConfig.length;i++){if(this.dda_config.columnsConfig[i].selected){this.oColumns.push(this.dda_config.columnsConfig[i]);if((this.dda_config.columnsConfig[i].type).toUpperCase()==="DIMENSION"){this.oDimensions.push(this.dda_config.columnsConfig[i]);this.dimNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartDimensions.push(this.dda_config.columnsConfig[i]);this.chartDimNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableDimensions.push(this.dda_config.columnsConfig[i]);this.tableDimNames.push(this.dda_config.columnsConfig[i].name);}}else if((this.dda_config.columnsConfig[i].type).toUpperCase()==="MEASURE"){this.oMeasures.push(this.dda_config.columnsConfig[i]);this.msrNameArray.push(this.dda_config.columnsConfig[i].name);if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="CHART")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.chartMeasures.push(this.dda_config.columnsConfig[i]);this.chartMsrNames.push(this.dda_config.columnsConfig[i].name);}if(((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="TABLE")||((this.dda_config.columnsConfig[i].visibility).toUpperCase()==="BOTH")){this.tableMeasures.push(this.dda_config.columnsConfig[i]);this.tableMsrNames.push(this.dda_config.columnsConfig[i].name);}}}}this.stacking=this.getStacking(this.chartMeasures,this.chartDimensions);this.isStackMsr=false;this.isStackDim=false;if(this.stacking.isEnabled&&(this.stacking.type=="M"))this.isStackMsr=true;else if(this.stacking.isEnabled&&(this.stacking.type=="D"))this.isStackDim=true;try{var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this._oModel.getData().QUERY_SERVICE_URI,this._oModel.getData().QUERY_ENTITY_SET);}catch(e){jQuery.sap.log.error("Failed to instantiate the odata model");throw e;}this.column_labels_mapping=p.getLabelMappingObject();this.dimension_text_property_mapping=p.getTextPropertyMappingObject();this.measure_unit_property_mapping=p.getUnitPropertyMappingObject();v.setVisible(true);a.setVisible(false);if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){this.oChartData=this.getDummyDataForChart(this.dimNameArray,this.msrNameArray);this.oChartDataModel.setData({businessData:c.oChartData});}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}if((this.dda_config.chartConfig.type).toUpperCase()=="CHOROPLETH"){this.plotMapForChoropleth();}else{this.createVizChart(this.chartDimensions,this.chartMeasures);}},plotMapForChoropleth:function(){var c=this;var v=this.getView().byId("viz_vbox");var a=this.getView().byId("choropleth_vbox");var g,m,t=null;if(this.chartMeasures.length<2){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("CHOROPLETH_CHART_MIN_MEASURE"),{onClose:function(){if(c._config){c.restorePrevConfig();}else{c.restoreFromConfigMasterSnapShot();}c.onChartTypeChange();c.refreshChart();}});return;}else if(this.chartDimensions.length>1){sap.m.MessageBox.alert(c._oTextsModel.getResourceBundle().getText("CHOROPLETH_CHART_MIN_DIMENSION"),{onClose:function(){if(c._config){c.restorePrevConfig();}else{c.restoreFromConfigMasterSnapShot();}c.onChartTypeChange();c.refreshChart();}});return;}v.setVisible(false);a.setVisible(true);a.removeAllItems();this.oModelForMap=new sap.ui.model.json.JSONModel();var b=this.getView().getModel("SB_DDACONFIG").getData().items;var d=b.length;var e=[];for(var i=0;i<d;i++){if(b[i].TYPE=='MEASURE'&&b[i].SELECTED==true){if(b[i].MAIN_MEASURE){this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE=b[i].NAME;}e.push(b[i]);}else if(b[i].TYPE=='DIMENSION'&&b[i].SELECTED==true){this.getView().getModel("SB_DDACONFIG").getData().GEO_DIMENSION=b[i].NAME;}}for(var i=0;i<d;i++){if(b[i].TYPE=='DIMENSION'){b[i].COLUMNS_ORDER=4}else if(b[i].TYPE='MEASURE'){if(b[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE){b[i].COLUMNS_ORDER=1}else if(b[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE){b[i].COLUMNS_ORDER=2}else{b[i].COLUMNS_ORDER=3}}}this._updateMeasureDimensionBindings();if((this.dda_config.chartConfig.mode).toUpperCase()==="DUMMY"){g="CustomerCountry";m="DaysSalesOutstanding";t="BestPossibleDaysSalesOutstndng";var D={businessData:[{"CustomerCountry":"IT","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"IN","DaysSalesOutstanding":500,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"RU","DaysSalesOutstanding":40,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AU","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"BR","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"NO","DaysSalesOutstanding":200,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"AR","DaysSalesOutstanding":130,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"ZA","DaysSalesOutstanding":125,"BestPossibleDaysSalesOutstndng":125},{"CustomerCountry":"CA","DaysSalesOutstanding":75,"BestPossibleDaysSalesOutstndng":125}],};this.oModelForMap.setData(D);}else if((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME"){g=c.getView().getModel('SB_DDACONFIG').getData().GEO_DIMENSION;m=c.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;t=c.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;this.getRuntimeChartData(this.dimNameArray,this.msrNameArray,this.oDimensions,this.oMeasures);}a.addItem(new sap.ui.vbm.AnalyticMap({width:"100%",height:"700px",regions:{path:"mapModel>/businessData",template:new sap.ui.vbm.Region({code:{path:"mapModel>"+g,formatter:jQuery.proxy(c.formatCode,c)},color:{parts:[{path:"mapModel>"+m},{path:"mapModel>"+t}],formatter:jQuery.proxy(c.formatColorForMap,c)},})}}).addStyleClass('choroplethMap')).setModel(this.oModelForMap,"mapModel");return;},showChartLegendIfApplicable:function(d,m){var t=this;var o=this.getView().byId("vizChartContainer");var c=this.dda_config.chartConfig.type;var i=(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(this.getDimensionToBeStacked(t.chartDimensions))&&(d.length>1))?true:false;if((m.length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},getStacking:function(m,d){var s={};s.isEnabled=false;s.type="none";for(var i=0;i<m.length;i++){if(m[i].stacking===1){s.isEnabled=true;s.type="M";}}if(!(s.isEnabled)){for(var i=0;i<d.length;i++){if(d[i].stacking===1){s.isEnabled=true;s.type="D";}}}return s;},setStacking:function(a,t,c){var b=this;if(a){if(t=="M"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=1;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=0;}}}else if(t=="D"){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="MEASURE"){c[i].STACKING=0;}else if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].STACKING=1;}}}}else{for(var i=0;i<c.length;i++){c[i].STACKING=0;}}},getDimensionToBeStacked:function(d){var D=null;for(var i=0;i<d.length;i++){if(d[i].axis===2){D=d[i];break;}}return D;},setDimensionToBeStacked:function(c,s){if(s){for(var i=0;i<c.length;i++){if((c[i].TYPE).toUpperCase()==="DIMENSION"){c[i].AXIS=1;if(c[i].NAME===s){c[i].AXIS=2;}}}}},updateColumnProperty:function(c,n,p,v){for(var i=0;i<c.length;i++){if(c[i].NAME===n){(c[i])[p]=v;break;}}},dualStackValue:function(c){var a=1;for(var i=0;i<c.length;i++){if(c[i].axis===1){a++}if(c.length===a){c[c.length-1].axis=2;}}},getMeasuresByAxis:function(c){var d={};d.axis1={};d.axis1.objArr=[];d.axis1.nameArr=[];d.axis2={};d.axis2.objArr=[];d.axis2.nameArr=[];for(var i=0;i<c.length;i++){if(c[i].axis===1){d.axis1.objArr.push(c[i]);d.axis1.nameArr.push(c[i].name);}else if(c[i].axis===2){d.axis2.objArr.push(c[i]);d.axis2.nameArr.push(c[i].name);}}return d;},getAxisOfMsr:function(m){var a=1;for(var i=0;i<this.chartMeasures.length;i++){if((this.chartMeasures[i]).name===m){a=(this.chartMeasures[i]).axis;break;}}return a;},getSelectedMeasuresCount:function(m){var c=0;for(var i=0;i<m.length;i++){if((m[i].TYPE).toUpperCase()=="MEASURE"&&(m[i].SELECTED))++c;}return c;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCellFormatter:function(o,i,a){var t=this;var f;var c=this.dda_config.chartConfig.type;var v=this.dda_config.chartConfig.value;var b=this.dda_config.chartConfig.axis;if(i){if(c.toUpperCase()=="TABLE"){if(t._isEvaluationThresholdMeasure(o))f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true);}else if((b=='DUAL')&&(v=="ABSOLUTE")&&(c=='BAR'||c=='COLUMN')){if(a[(t.getAxisOfMsr(o))-1])f=this.getChartPercentFormatter(true);else f=this.getChartNumberFormatter(true);}else{f=this.getChartPercentFormatter(true);}}else f=this.getChartNumberFormatter(true);return f;},_getTableCell:function(o,t,i,a){var b=this;if(t&&(o!==t)){return new sap.m.ObjectNumber({number:{path:o,formatter:b._getTableCellFormatter(o,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,c){try{m=window.parseFloat(m);c=window.parseFloat(c);return b._getValueState(m,c);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o,formatter:b._getTableCellFormatter(o,i,a)}})}},formatChartNumbers:function(v){function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}if(i(v)){if(!this.chartFormatter){var d=1;if(d||d==0){this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:d,maxFractionDigits:d});}else{this.chartFormatter=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short'});}}v=this.chartFormatter.format(v);}return v;},pseudoChartFormatter:function(v){return v;},get_hana_client:function(){var a;var c=sap.suite.ui.smartbusiness.lib.Util.cache.getCacheHanaClient();if(c){a=c;return a;}jQuery.ajax({type:"GET",async:false,dataType:"json",url:sap.suite.ui.smartbusiness.lib.Util.utils.appendUrlParameters("/sap/hba/r/sb/core/logic/GetSessionClient.xsjs"),success:function(d,s,x){a=d.sessionClient;},error:function(j,t,e){jQuery.sap.log.error(j.responseText);}});sap.suite.ui.smartbusiness.lib.Util.cache.setCacheHanaClient(a);return a;},getRuntimeChartData:function(d,m,b,c){var t=this;var e=this.getView().byId("vizChartContainer");e.setBusy(true);var D=[];var M=[];d.forEach(function(x){D.push(x)});m.forEach(function(x){M.push(x)});this.COLUMNS_SORT=[];for(var i=0;i<t.oColumns.length;i++){if(t.oColumns[i].sortBy&&t.oColumns[i].sortOrder){if((t.oColumns[i].sortOrder).toUpperCase()=="ASC"||(t.oColumns[i].sortOrder).toUpperCase()=="DESC"){this.COLUMNS_SORT.push({name:t.oColumns[i].sortBy,order:t.oColumns[i].sortOrder});if(t.oColumns[i].sortBy!=t.oColumns[i].name){if((t.oColumns[i].type).toUpperCase()=="DIMENSION"){if((D.indexOf(t.oColumns[i].sortBy))==-1){D.push(t.oColumns[i].sortBy);}}else if((t.oColumns[i].type).toUpperCase()=="MEASURE"){if((M.indexOf(t.oColumns[i].sortBy))==-1){M.push(t.oColumns[i].sortBy);}}}}}}try{var f=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");if(!(this.isCDS)){var H=t.get_hana_client();this.DDA_MODEL.EVALUATION_DATA.FILTERS.results.forEach(function(r,i,a){if(r["NAME"]==="P_SAPClient"&&r["VALUE_1"]==="$$$"){r["VALUE_1"]=H;}});}var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this._oModel.getData().QUERY_SERVICE_URI,entitySet:this._oModel.getData().QUERY_ENTITY_SET,dimension:D,measure:M,filter:this.DDA_MODEL.EVALUATION_DATA.FILTERS.results,sort:this.COLUMNS_SORT,dataLimit:(((this.dda_config.chartConfig.dataLimitations)&&(this.dda_config.chartConfig.dataLimit>0))?(this.dda_config.chartConfig.dataLimit):null),});u.model.read(u.uri,null,null,true,function(a){if(a.results.length){t.oChartData=a.results;t.oChartDataModel.setData({businessData:t.oChartData});if((t.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=='CHOROPLETH'){t.oModelForMap.setData({businessData:t.oChartData});}}else{jQuery.sap.log.info("Chart data Table Returned Empty Results");t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});}e.setBusy(false);},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});e.setBusy(false);});}catch(g){jQuery.sap.log.error(g.toString());t.oChartData=[];t.oChartDataModel.setData({businessData:t.oChartData});e.setBusy(false);}},getChartPercentFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getPercentInstance(f);return function(s){return a(s)?c.format_percentage(Number(s)):s;};},getChartNumberFormatter:function(i){function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};var c=sap.ui.core.format.NumberFormat.getFloatInstance(f);return function(s){return a(s)?c.format(Number(s)):s;};},getIsPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}var a=false;if(t&&t.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){a=true;break;}}}return a;},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME);}}}}return t;},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length){if(t.indexOf(m)!=-1){return true;}}return false;},getDummyDataForChart:function(d,m,M,D){var t=this;M=M||10;D=D||10;var c=[];var a,b={},p;for(var i=0;i<d.length;i++){b[d[i]]=[];for(var j=0;j<M;j++){b[d[i]].push(d[i]+"_"+j);}}p=M-1;for(var i=0;i<D;i++){a={};for(var j=0;j<d.length;j++){a[d[j]]=b[d[j]][p];}for(var j=0;j<m.length;j++){a[m[j]]=t.chartDummyData.MEASURES[i][j];}c.push(a);p--;}c=this.sortChartData(c,d);return c;},sortChartData:function(c,d){var e=[];c.sort(function(a,b){var i=0;while(i<d.length){if(a[d[i]]>b[d[i]]){return-1;}else if(a[d[i]]<b[d[i]]){return 1;}i++;}});var t={};for(var i=0,k=0;i<c.length;i++){var s="";for(var j=0;j<d.length;j++){s+=c[i][d[j]];}if(!t[s]){t[s]=true;e[k++]=c[i];}}return e;},validateChartId:function(e){var c=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[1];var a=c.getValue();if(/^[\w\d\.\_]+$/.test(a)){if(this.DDA_MODEL.getConfigurator().findViewById(a)){if(!this._oModel.getData().ID_EDITABLE){c.setValueState(sap.ui.core.ValueState.None);return true;}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false;}}else{c.setValueState(sap.ui.core.ValueState.None);return true;}}else{c.setValueState(sap.ui.core.ValueState.Error);return false;}},validateChartName:function(){var c=this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[3];var a=c.getValue();if(a){c.setValueState(sap.ui.core.ValueState.None);return true;}else{c.setValueState(sap.ui.core.ValueState.Error);c.focus();return false;}},validateDataLimit:function(e){var d=e?e.getSource():this.getView().getContent()[0].getContent()[0].getMasterPages()[0].getContent()[2].getItems()[7];var a=d.getValue();if(/^\d+$/gi.test(a)){var p=parseInt(a,10);if(p>0){d.setValueState(sap.ui.core.ValueState.None);return true;}}else{d.setValueState(sap.ui.core.ValueState.Error);return false;}},onSave:function(){var t=this;if(t.errorState){sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(t.oApplicationFacade.getResourceBundle().getText("FAILED_TO_LOAD_ODATA"),t.errorMsg);return;}if(this.validateChartName()&&this.validateDataLimit()){var s=this;if(this.currentViewId==this.DDA_MODEL.NEW_VIEWID){this.oApplicationFacade.__newViewAdded=true;this.oApplicationFacade.createdViewId=this.getView().getModel("SB_DDACONFIG").getData().SELECTED_VIEW;}this.busyIndicator.open()&&this.getView().setBusy(true);var m=this.getView().getModel("SB_DDACONFIG").getData();var a=sap.suite.ui.smartbusiness.Adapter.getService("DrilldownServices");a.saveViewConfiguration(this.evaluationId,m,"update",function(){jQuery.sap.log.info("all calls success");s.busyIndicator.close()&&s.getView().setBusy(false);sap.m.MessageToast.show(s._oTextsModel.getResourceBundle().getText("CHART_CONFIG_SAVE_SUCCESS"));s.oApplicationFacade.__refreshModel=1;s.oApplicationFacade.__contextViewId=s.getView().getModel("SB_DDACONFIG").getData()["SELECTED_VIEW"];try{if(sap.suite&&sap.suite.ui&&sap.suite.ui.smartbusiness&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration&&sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration){sap.suite.ui.smartbusiness.drilldown.lib.Configuration.resetDrilldownConfiguration(s.evaluationId);}}catch(e){}if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash({action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.getView().getModel("SB_DDACONFIG").getData().SELECTED_VIEW});s.takeConfigMasterSnapShot();}else{window.history.back();}},function(){jQuery.sap.log.error(x+" failed");s.busyIndicator.close()&&s.getView().setBusy(false);sap.suite.ui.smartbusiness.lib.Util.utils.showErrorMessage(s._oTextsModel.getResourceBundle().getText("SAVE_ERROR"));});}},formatMeasureName:function(s){var l=this.COLUMN_LABEL_MAPPING[s];if(s==this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME){l+="("+this.getView().getModel("i18n").getProperty("KPI_MEASURE")+")";}return l;},formatMeasureNameInList:function(n,t){var a=null;var k=this.DDA_MODEL.EVALUATION_DATA.COLUMN_NAME;var m=this.getView().getModel('SB_DDACONFIG').getData().MAIN_MEASURE;var b=this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE;if(t=="DIMENSION"){a=this.getView().getModel("i18n").getProperty("DIMENSION");}if(t=="MEASURE"){a=this.getView().getModel("i18n").getProperty("MEASURE");if(n==k){a=this.getView().getModel("i18n").getProperty("KPI_MEASURE");}if(n==b){if(n===k){a=this.getView().getModel("i18n").getProperty("KPI_MEASURE_THRESHOLD_MEASURE");}else{a=this.getView().getModel("i18n").getProperty("THRESHOLD_MEASURE");}}}if((this.getView().getModel('SB_DDACONFIG').getData().CHART_TYPE).toUpperCase()=="CHOROPLETH"){if(t=="DIMENSION"){a=this.getView().getModel("i18n").getProperty("GEO_DIMENSION");}if(t=="MEASURE"){if(n==m){a=this.getView().getModel("i18n").getProperty("MAIN_MEASURE");}}}return a;},formatType:function(t){if(t=="MEASURE")t=this.getView().getModel("i18n").getProperty("MEASURE");if(t=="DIMENSION")t=this.getView().getModel("i18n").getProperty("DIMENSION");return t;},sortDimensionsAndMeasures:function(){var c=this;new sap.suite.ui.smartbusiness.lib.ListPersona({title:this.getView().getModel("i18n").getProperty("CHANGE_ORDER"),view:this.getView(),context:'/items',listItemContext:'LABEL',formatter:jQuery.proxy(this.formatMeasureName,this),namedModel:'SB_DDACONFIG',filter:{property:'SELECTED',value:true},callback:function(){c.refreshChart();}}).start();},onBack:function(){var s=this;var r={};if(s.DDA_MODEL.getConfigurator().getAllViews().length){r={action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.oApplicationFacade.configuratorViewId};}else{r={action:"configureSBKPIDrilldown",route:"noDataView",context:"EVALUATIONS_MODELER(ID='"+s.DDA_MODEL.EVALUATION_DATA.ID+"',IS_ACTIVE=1)"};}if(this.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.restoreFromConfigMasterSnapShot();this.getParent().close();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{s.restoreFromConfigMasterSnapShot();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}},onCancel:function(){var s=this;var r={};if(s.DDA_MODEL.getConfigurator().getAllViews().length){r={action:"configureSBKPIDrilldown",route:"configurator",context:s.DDA_MODEL.EVALUATION_DATA.ID+"/"+s.oApplicationFacade.configuratorViewId};}else{r={action:"configureSBKPIDrilldown",route:"noDataView",context:"EVALUATIONS_MODELER(ID='"+s.DDA_MODEL.EVALUATION_DATA.ID+"',IS_ACTIVE=1)"};}if(this.isModelChanged()){new sap.m.Dialog({icon:"sap-icon://warning2",title:s._oTextsModel.getResourceBundle().getText("WARNING"),state:"Error",type:"Message",content:[new sap.m.Text({text:s._oTextsModel.getResourceBundle().getText("ARE_YOU_SURE")})],beginButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("OK"),press:function(){s.restoreFromConfigMasterSnapShot();this.getParent().close();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}}),endButton:new sap.m.Button({text:s._oTextsModel.getResourceBundle().getText("CANCEL"),press:function(){this.getParent().close();}})}).open();}else{s.restoreFromConfigMasterSnapShot();if(s.navigatingWithinDrilldown){sap.suite.ui.smartbusiness.lib.Util.utils.replaceHash(r);}else{window.history.back();}}},onExit:function(){this.restoreFromConfigMasterSnapShot();},enableOrDisableSave:function(){var m=this._config.items.filter(function(s){return s.SELECTED});if(this.dda_config.chartConfig.type.toUpperCase()=="TABLE")this.canSave=true;if(this.dda_config.chartConfig.type.toUpperCase()=="CHOROPLETH")this.canSave=true;if(m.length&&this.canSave){this.getView().byId("save-btn").setEnabled(true);}else{this.getView().byId("save-btn").setEnabled(false);}},isModelChanged:function(){this.currentCopy=this._oModel.getJSON();if(this.initCopy.length==this.currentCopy.length){if(this.initCopy===this.currentCopy){return false;}}return true;},createVizChart:function(d,m){var t=this;var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var b=this.dda_config.chartConfig.mode;var e=this.getView().byId("vizChartContainer");e.removeAllContent();if(c.toUpperCase()==="BAR"||c.toUpperCase()==="COLUMN"||c.toUpperCase()==="TABLE"){if(this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","semanticColors")).getSelectedKey()==="AUTO_SEMANTIC"){if(this.chartMeasures.length<2){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("AUTO_SEMANTICS_CHART_MIN_MEASURE"),{onClose:function(){if(t._config){t.restorePrevConfig();}else{t.restoreFromConfigMasterSnapShot();}t.refreshChart();}});return;}}}var T=this.getTableForViz(this.tableDimensions,this.tableMeasures);if(c.toUpperCase()=="TABLE"){e.addContent(T);setTimeout(function(){e.rerender();},0);}else{var V=this.getVizTypeAndIcon();var f=new sap.suite.ui.commons.ChartContainerContent({icon:V.icon,});var o=new sap.viz.ui5.controls.VizFrame({vizType:V.type,uiConfig:{applicationSet:'fiori'},});o.setVizProperties({plotArea:{dataLabel:{visible:true,formatString:"dataLabelFormatter",hideWhenOverlap:false}},legend:{title:{visible:false},isScrollable:true},title:{visible:false,},valueAxis:{label:{formatString:"yValueAxisFormatter"}}});o.addEventDelegate({onBeforeRendering:function(){var s=t.byId('splitContainer');var H=s.$().css("height");o.setHeight(H);}});if((!(this.chartDimensions.length))||(!(this.chartMeasures.length))){o.setDataset(new sap.viz.ui5.data.FlattenedDataset({}));f.setContent(o);e.addContent(f);e.addContent(T);return;}if((c.toUpperCase()==="BUBBLE")&&(this.chartMeasures.length<3)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("BUBBLE_CHART_MEASURE_COUNT"),{onClose:function(){if(t._config&&(((t._config.CHART_TYPE).toUpperCase()!="BUBBLE")||(t.getSelectedMeasuresCount(t._config.COLUMNS)>=3)))t.restorePrevConfig();else t.restoreFromConfigMasterSnapShot();t.onChartTypeChange();t.refreshChart();}});return;}if((c.toUpperCase()==="COMBINATION")&&(this.chartMeasures.length<2)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("COMBINATION_CHART_MEASURE_COUNT"),{onClose:function(){if(t._config&&(((t._config.CHART_TYPE).toUpperCase()!="COMBINATION")||(t.getSelectedMeasuresCount(t._config.COLUMNS)>=2))){t.restorePrevConfig();}else{t.restoreFromConfigMasterSnapShot();}t.onChartTypeChange();t.refreshChart();}});return;}if((c.toUpperCase()==="BAR"||c.toUpperCase()==="COLUMN")&&(a==="DUAL")){var g=false,h=false,i;for(i=0;i<this.chartMeasures.length;i++){if(this.chartMeasures[i].axis===1)g=true;else if(this.chartMeasures[i].axis===2)h=true;}if(!(g)||!(h)){sap.m.MessageBox.alert(t._oTextsModel.getResourceBundle().getText("STACK_REMOVE_MSG"),{onClose:function(){t.restorePrevConfig();t._updateMeasureDimensionBindings();t.refreshChart();}});return;}}this.addFeedsToVizFrame(o);var D=this.create_vizDataset(d,m);o.setDataset(D);o.setModel(this.oChartDataModel);var j=new sap.viz.ui5.controls.Popover().setFormatString("vizPopOver");j.connect(o.getVizUid());this.setAllVizFormatters();if(a==="DUAL"||c.toUpperCase()==="BUBBLE"){var p=o.getVizProperties();p.valueAxis2={label:{formatString:"y2ValueAxisFormatter"}};o.setVizProperties(p);if((b==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&(v==="ABSOLUTE")&&(c==="BAR"||c==="COLUMN")){this._handleVizDualAxisWhenPercentScale(o,j);}}this.applyColorToViz(o);f.setContent(o);e.addContent(f);e.addContent(T);this.showChartLegendIfApplicable(this.chartDimNames,this.chartMsrNames);}this.canSave=true;this.copyConfigSnapshot();},addFeedsToVizFrame:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=this.getDimensionToBeStacked(this.chartDimensions);var b=[],m=[];for(var i=0;i<t.chartDimNames.length;i++){b.push(t.column_labels_mapping[t.chartDimNames[i]]||t.chartDimNames[i]);}for(var i=0;i<t.chartMsrNames.length;i++){m.push(t.column_labels_mapping[t.chartMsrNames[i]]||t.chartMsrNames[i]);}if(c=="BUBBLE"){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:b});v.addFeed(f);v.addFeed(e);v.addFeed(g);v.addFeed(h);}else if(((c=="BAR")||(c=="COLUMN"))&&(a=="DUAL")){var j=this.getMeasuresByAxis(this.chartMeasures);var k=[],l=[];for(var i=0;i<j.axis1.nameArr.length;i++){k.push(t.column_labels_mapping[j.axis1.nameArr[i]]||j.axis1.nameArr[i]);}for(var i=0;i<j.axis2.nameArr.length;i++){l.push(t.column_labels_mapping[j.axis2.nameArr[i]]||j.axis2.nameArr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:k});var n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:l});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(n);v.addFeed(o);}else if(((c=="BAR")||(c=="COLUMN"))&&(this.isStackDim)&&(d)&&(b.length>1)){var p=b.indexOf(t.column_labels_mapping[(d.name)]);if(p>-1){var D=b.splice(p,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);if(D&&D.length){var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(h);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m});var o=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:b});v.addFeed(f);v.addFeed(o);}},create_vizDataset:function(d,m){var t=this;var c=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis||"SINGLE";var v=this.dda_config.chartConfig.value||"ABSOLUTE";var s=this.isStackMsr;var b=this.getDimensionToBeStacked(d);var e=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/businessData"}});for(var i=0;i<d.length;i++){var f=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var g=new sap.viz.ui5.data.DimensionDefinition({value:"{"+f+"}",name:this.column_labels_mapping[d[i].name]||d[i].name});e.addDimension(g);}if((c=="LINE")||(c=="COMBINATION")||(c=="BUBBLE")||(c=="BAR")||(c=="COLUMN")){for(var i=0;i<m.length;i++){var f=m[i].name;var h=new sap.viz.ui5.data.MeasureDefinition({name:this.column_labels_mapping[f]||f,value:"{"+f+"}"});e.addMeasure(h);}}return e;},applyColorToViz:function(v){var t=this;var c=(this.dda_config.chartConfig.type).toUpperCase();if((c=="BAR")||(c=="COLUMN")||(c=="COMBINATION")||(c=="LINE")){if((this.dda_config.chartConfig.colorScheme).toUpperCase()==="AUTO_SEMANTIC"){var a=this.dda_config.chartConfig.thresholdMeasure||"";var b=[];var d=-1;for(var i=0;i<this.chartMeasures.length;i++){b.push({color:"sapUiChartPaletteSemanticGoodLight1"});if(this.chartMeasures[i].name===a)d=i;}if(d>=0)b[d].color="sapUiChartPaletteSemanticNeutral";this.applyVizCustomColoring(v,this.dda_config.chartConfig.colorScheme,b,a,this.DDA_MODEL.EVALUATION_DATA.GOAL_TYPE);}else if(((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_SEMANTIC")||((this.dda_config.chartConfig.colorScheme).toUpperCase()==="MANUAL_NON_SEMANTIC")){this.setVizCustomColors(v,this.chartMeasures,this.dda_config.chartConfig.colorScheme);}}},applyVizCustomColoring:function(c,a,b,t,i){var d=this;var v=c.getVizProperties();if((a).toUpperCase()==="AUTO_SEMANTIC"){if(((i=="MA")||(i=="MI"))&&t){d.setVizCustomColors(c,b,a);v.plotArea.dataPointStyle={rules:[{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MA")return true;}else if(C[C.measureNames]<r){if(i=="MI")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("GOOD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r!=null&&typeof r!='undefined'){if(C[C.measureNames]>r){if(i=="MI")return true;}else if(C[C.measureNames]<r){if(i=="MA")return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("BAD"))},{callback:function(C){var e=c.getModel().getData().businessData;var f=C._context_row_number;var g=e[f];var r=g[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:(d._oTextsModel.getResourceBundle().getText("NEUTRAL"))}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'},displayName:(d._oTextsModel.getResourceBundle().getText("THRESHOLD_REFERENCE"))}};c.setVizProperties(v);}else{jQuery.sap.log.error("Threshold Measure not available or Goal type is RA . Error Applying Semantic Color");}}else if(((a).toUpperCase()==="MANUAL_SEMANTIC")||((a).toUpperCase()==="MANUAL_NON_SEMANTIC")){d.setVizCustomColors(c,b,a);}},setVizCustomColors:function(f,m,c){var t=this;var C=(this.dda_config.chartConfig.type).toUpperCase();var a=(this.dda_config.chartConfig.axis).toUpperCase();var d=f.getDataset();var b=d.getMeasures();var e="";if((c).toUpperCase()==="AUTO_SEMANTIC"||(c).toUpperCase()==="MANUAL_SEMANTIC")e="sapUiChartPaletteSemanticNeutral";var v=f.getVizProperties();if(((C=="BAR")||(C=="COLUMN"))&&(a=="DUAL")){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];var g=this.getMeasuresByAxis(this.chartMeasures);for(var i=0;i<g.axis1.objArr.length;i++){(v.plotArea.primaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis1.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}for(var i=0;i<g.axis2.objArr.length;i++){(v.plotArea.secondaryValuesColorPalette)[i]=(t.convertCAtoVizColorCode((g.axis2.objArr)[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+(((i+(g.axis1.objArr.length))%11)+1));}}else{v.plotArea.colorPalette=[];for(var i=0;i<b.length;i++){(v.plotArea.colorPalette)[i]=(t.convertCAtoVizColorCode(m[i].color))||(e)||("sapUiChartPaletteQualitativeHue"+((i%11)+1));}}f.setVizProperties(v);},setAllVizFormatters:function(){var t=this;sap.viz.api.env.Format.useDefaultFormatter(false);jQuery.sap.require("sap.ui.core.format.NumberFormat");var c=this.dda_config.chartConfig.type;var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var m=this.dda_config.chartConfig.mode;if(m==="RUNTIME"){var i=this.getIsPercentScaled(this.chartMsrNames);if((this.EVALUATION.getScaling()==-2)&&(a==="DUAL")&&(v==="ABSOLUTE")&&(c==="BAR"||c==="COLUMN")){var b=this.getMeasuresByAxis(this.chartMeasures);var d=this.getIsPercentScaled(b.axis1.nameArr);var e=this.getIsPercentScaled(b.axis2.nameArr);}}var f={locale:function(){},format:function(g,p){if(p=="yValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&(a==="DUAL")&&(c==="BAR"||c==="COLUMN")){if(d){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(g));}else if(p=="y2ValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&(a==="DUAL")&&(c==="BAR"||c==="COLUMN")){if(e){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(Number(g));}else if(p=="dataLabelFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&!((v==="PERCENTAGE"||a==="DUAL")&&(c==="BAR"||c==="COLUMN"))){n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);}return n.format(Number(g));}else if(p=="dataLabelPercentFormatter"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else if(p=="vizPopOver"){if(v==="PERCENTAGE"&&(c==="BAR"||c==="COLUMN")){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else if((m==="RUNTIME")&&(t.EVALUATION.getScaling()==-2)&&i&&!((v==="PERCENTAGE"||a==="DUAL")&&(c==="BAR"||c==="COLUMN"))){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}else{var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);return n.format(Number(g));}}else if(p=="vizPercentPopOver"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(Number(g));}}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(f);},_handleVizDualAxisWhenPercentScale:function(c,v){var t=this;var p=c.getVizProperties();var f={};var a={};var b=this.getMeasuresByAxis(this.chartMeasures);var d=this.getIsPercentScaled(b.axis1.nameArr);var e=this.getIsPercentScaled(b.axis2.nameArr);if(d){for(var i=0;i<b.axis1.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="dataLabelPercentFormatter";a[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis1.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="dataLabelFormatter";a[(t.column_labels_mapping[((b.axis1.nameArr)[i])])]="vizPopOver";}}if(e){for(var i=0;i<b.axis2.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="dataLabelPercentFormatter";a[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis2.nameArr.length;i++){f[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="dataLabelFormatter";a[(t.column_labels_mapping[((b.axis2.nameArr)[i])])]="vizPopOver";}}p.plotArea.dataLabel={visible:true,formatString:f};c.setVizProperties(p);v.setFormatString(a);},getVizTypeAndIcon:function(){var t="bar";var i="sap-icon://bar-chart";var T=this.dda_config.chartConfig.type||"BAR";var a=this.dda_config.chartConfig.axis;var v=this.dda_config.chartConfig.value;var s=(this.isStackMsr||(this.isStackDim&&(this.chartDimensions.length>1)))?true:false;if(T.toUpperCase()=="BAR"){t="bar";i="sap-icon://horizontal-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else if(v==="PERCENTAGE"){t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.toUpperCase()=="COLUMN"){t="column";i="sap-icon://vertical-bar-chart";if(a==="SINGLE"){if(v==="ABSOLUTE"){if(s){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else if(v==="PERCENTAGE"){t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(a==="DUAL"){if(v==="ABSOLUTE"){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else if(v==="PERCENTAGE"){t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.toUpperCase()=="LINE"){t="line";i="sap-icon://line-chart";}else if(T.toUpperCase()=="COMBINATION"){t="combination";i="sap-icon://business-objects-experience";}else if(T.toUpperCase()=="BUBBLE"){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},getTableForViz:function(d,m){var v=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var t=new sap.m.Table({showUnread:true,});for(var i=0;i<d.length;i++){var a=d[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"Begin",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}for(var i=0;i<m.length;i++){var a=m[i].name;var L=new sap.m.Label({text:this.column_labels_mapping[a]||a});var c=new sap.m.Column({hAlign:"End",header:L,minScreenWidth:"Tablet",demandPopin:true,});t.addColumn(c);}var b=new sap.m.ColumnListItem({unread:false,});for(var i=0;i<d.length;i++){var a=((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")?this.dimension_text_property_mapping[d[i].name]:d[i].name;var o=new sap.m.Label({text:"{"+a+"}"});b.addCell(o);}var e=this._oModel.getData()["THRESHOLD_MEASURE"];var f=false;var g=this.dda_config.chartConfig.type;var h=this.dda_config.chartConfig.value;var j=this.dda_config.chartConfig.axis;if(g.toUpperCase()==="TABLE")var M=this.tableMsrNames;else var M=this.chartMsrNames;if(((this.dda_config.chartConfig.mode).toUpperCase()==="RUNTIME")&&(this.EVALUATION.getScaling()==-2)&&this.getIsPercentScaled(M)&&!(((g=='BAR')||(g=='COLUMN'))&&(h=='PERCENTAGE'))){f=true;}var k=[];if(f){if((j=='DUAL')&&(h=="ABSOLUTE")&&(g=='BAR'||g=='COLUMN')){var l=this.getMeasuresByAxis(this.chartMeasures);k.push(this.getIsPercentScaled(l.axis1.nameArr));k.push(this.getIsPercentScaled(l.axis2.nameArr));}}for(var i=0;i<m.length;i++){var a=m[i].name;if(this._oModel.getData()["COLOR_SCHEME"]=="AUTO_SEMANTIC")var o=this._getTableCell(a,e,f,k);else var o=this._getTableCell(a,a,f,k);b.addCell(o);}t.setModel(this.oChartDataModel);t.bindAggregation("items","/businessData",b);v.setContent(t);return v;},convertCAtoVizColorCode:function(c){var C=c;if(c){var s=c.match(/[a-zA-Z]+|[0-9]+/g);if(s[0]==="sapUiChart"){C="sapUiChartPaletteQualitativeHue"+s[1];}else if(s[0]==="sapCaUiChartSemanticColor"){if(s.length===2){C="sapUiChartPaletteSemantic"+s[1];}else if(s.length===3){C="sapUiChartPaletteSemantic"+s[1]+s[2]+"1";}}}return C;},generateViewId:function(c){var x={};x.title="";var p=sap.suite.ui.smartbusiness.lib.IDGenerator.generateViewId(x);var i;p.done(function(I){i=I;c.getView().getModel("SB_DDACONFIG").setProperty("/SELECTED_VIEW",i);c.bindUiToModel();c.copyConfigSnapshot();});},openChoroplethSettingsDialog:function(){this.choroplethSettingsDialog.open();},onChoroplethSettingsOk:function(){if(!this.choroplethSettingsDialog){this._choroplethSettingsDialog=sap.ui.xmlfragment("choroplethSettingsDialog","sap.suite.ui.smartbusiness.designtime.drilldown.view.choroplethSettingsDialog",this);}var c=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var a=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethThresholdMeasure").getSelectedKey();this.updateMeasuresAndDimensionsInmodel(c,a);this.copyConfigSnapshot();this.refreshChart();this.enableOrDisableSave();this.choroplethSettingsDialog.close();},onChoroplethSettingsCancel:function(){this.restorePrevConfig();this.getView().byId(sap.ui.core.Fragment.createId("chartTypeConfig","chartType")).fireChange();this.choroplethSettingsDialog.close();},chooseMeasureForThreshold:function(){var t=this;sap.ui.core.Fragment.byId("choroplethSettingsDialog","displaySelectedParametersGrid").setVisible(false);var a=sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList");this.choroplethSettingsDialog.setTitle(this.oApplicationFacade.getResourceBundle().getText("SELECT_THRESHOLD_MEASURE"));this.choroplethSettingsDialog.destroyBeginButton();a.bindItems({path:"SB_DDACONFIG>/items",template:new sap.m.StandardListItem({title:"{SB_DDACONFIG>NAME}",type:"Active",press:jQuery.proxy(t.selectedThresholdMeasure,t)})});var c=sap.ui.core.Fragment.byId("choroplethSettingsDialog","choroplethKpiMeasure").getSelectedKey();var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true),new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,c)];var F=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"DIMENSION"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)];sap.ui.getCore().byId("choroplethSettingsDialog--thresholdMeasureList").getBinding("items").filter(new sap.ui.model.Filter(f,true));sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList").setVisible(true);},selectedThresholdMeasure:function(e){var t=this;sap.ui.core.Fragment.byId("choroplethSettingsDialog","thresholdMeasureList").setVisible(false);sap.ui.core.Fragment.byId("choroplethSettingsDialog","displaySelectedParametersGrid").setVisible(true);this.choroplethSettingsDialog.setTitle(this.oApplicationFacade.getResourceBundle().getText("CHOROPLETH_MAP_SETTING"));if(!(this.choroplethSettingsDialog.getBeginButton())){this.choroplethSettingsDialog.setBeginButton(new sap.m.Button({text:"{i18n>OK}",press:jQuery.proxy(t.onChoroplethSettingsOk,t)}));}this.getView().getModel('SB_DDACONFIG').getData().THRESHOLD_MEASURE=e.getSource().getTitle();this.getView().getModel('SB_DDACONFIG').updateBindings();},handleMainMeasureChange:function(){var f=[new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE"),new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true),new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.getCore().byId("choroplethSettingsDialog--choroplethKpiMeasure").getSelectedKey())];sap.ui.getCore().byId("choroplethSettingsDialog--choroplethThresholdMeasure").getBinding("items").filter(new sap.ui.model.Filter(f,true));},handleMainMeasureChangechartsettings:function(){var f=[];sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","choroplethKpiMeasurechartsetting")).rerender();var s=sap.ui.getCore().byId(sap.ui.core.Fragment.createId("editChartDialog","thresholdMeasureChart"));var a={"type":(new sap.ui.model.Filter("TYPE",sap.ui.model.FilterOperator.EQ,"MEASURE")),"name":(new sap.ui.model.Filter("NAME",sap.ui.model.FilterOperator.NE,sap.ui.core.Fragment.byId("editChartDialog","choroplethKpiMeasurechartsetting").getSelectedKey())),"selected":(new sap.ui.model.Filter("SELECTED",sap.ui.model.FilterOperator.EQ,true)),};for(var i in a){f.push(a[i]);}var b=s.getItems()?s.getItems():[];if(b.length&&s.getBinding('items')){s.getBinding('items').filter(f);}},helpPopOver:function(e){var t=this;var a=null;var c=null;if(e.getSource().getId()=="choroplethSettingsDialog--kpiMeasureHelp"){a=t.oApplicationFacade.getResourceBundle().getText("MAIN_MEASURE");c=t.oApplicationFacade.getResourceBundle().getText("MAIN_MEASURE_HELP_CONTENT");}else if(e.getSource().getId()=="choroplethSettingsDialog--thresholdMeasureHelp"){a=t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_MEASURE");c=t.oApplicationFacade.getResourceBundle().getText("THRESHOLD_MEASURE_HELP_CONTENT");}this.helpPopOver=new sap.m.ResponsivePopover({contentWidth:'15%',contentHeight:'10%',placement:sap.m.PlacementType.Right,content:new sap.m.Text({text:c,width:"100%"}),title:a,verticalScrolling:true,horizontalScrolling:false});this.helpPopOver.openBy(e.getSource());},updateMeasuresAndDimensionsInmodel:function(m,t){var a=this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().items;var b=a.length;for(var i=0;i<b;i++){if(a[i].NAME==m){a[i].MAIN_MEASURE=true;a[i].SELECTED=true;delete a[i].THRESHOLD_MEASURE;this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().MAIN_MEASURE=m;}else if(a[i].NAME==t){a[i].THRESHOLD_MEASURE=true;a[i].SELECTED=true;delete a[i].MAIN_MEASURE;this.choroplethSettingsDialog.getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE=t;}else{delete a[i].MAIN_MEASURE;delete a[i].THRESHOLD_MEASURE;}}for(var i=0;i<b;i++){if(a[i].TYPE=='DIMENSION'&&a[i].SELECTED){a[i].COLUMNS_ORDER=4;a[i].GEO_DIMENSION=true;}else if(a[i].TYPE=='MEASURE'){if(a[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().MAIN_MEASURE){a[i].COLUMNS_ORDER=1}else if(a[i].NAME==this.getView().getModel("SB_DDACONFIG").getData().THRESHOLD_MEASURE){a[i].COLUMNS_ORDER=2}else{a[i].COLUMNS_ORDER=3}}}this._updateMeasureDimensionBindings();},onThresholdMeasureChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());},genericSelectTooltipChange:function(e){e.getSource().setTooltip(e.getParameters().selectedItem.getText());}});
