/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.metadata");jQuery.sap.require("sap.apf.utils.utils");(function(){'use strict';sap.apf.core.Metadata=function(I,a){this.type="metadata";var t=this;var A=[];var H=(I&&I.constructors&&I.constructors.Hashtable)||sap.apf.utils.Hashtable;var h=new H(I.instances.messageHandler);var o=new H(I.instances.messageHandler);var b=new H(I.instances.messageHandler);var c=new H(I.instances.messageHandler);var d=new H(I.instances.messageHandler);var e=new H(I.instances.messageHandler);var f=new H(I.instances.messageHandler);var g=new H(I.instances.messageHandler);var j=new H(I.instances.messageHandler);var k=new H(I.instances.messageHandler);var l=new H(I.instances.messageHandler);var O=I.constructors.ODataModel||sap.ui.model.odata.ODataModel;var D=false;if(I.deactivateFatalError){D=true;}var m;var n;var E;var s;function p(i){var K;function L(N){if(!K.dataType){K.dataType={};}K.dataType[N]=K[N];}function M(N,P){if(jQuery.isArray(K[P])===true){(K[P]).forEach(function(Q){K[Q.name]=Q.value;});}else if(P!=="dataType"&&typeof(K[P])==="object"){if(Object.keys(K[P]).length===0){K[N]="true";}if(P!==N){jQuery.each(K[P],function(Q,R){K[N]=R;});}}else{K[N]=K[P];}}if(i===null){return{};}K=jQuery.extend(true,{},i);jQuery.each(K,function(P){switch(P){case'type':L(P);break;case'maxLength':L(P);break;case'precision':L(P);break;default:var N=P.split(".").pop();if(N.search("ISO")===0){M(N,P);}else{M(N.replace(/^./,N[0].toLowerCase()),P);}break;}});return K;}function q(i,K){if(c.hasItem(i)!==true){var L;var M={};var R={allParameters:[],keyParameters:[]};if(y(i)){L=G(i);if(L.key&&L.key.propertyRef){L.key.propertyRef.forEach(function(P){M[P.name]=null;});}L.property.forEach(function(P){var N=p(P);N.isKey=M.hasOwnProperty(N.name);R.allParameters.push(N);if(N.isKey){R.keyParameters.push(N);}});}c.setItem(i,R);}if(!K){return c.getItem(i).allParameters;}return c.getItem(i).keyParameters;}function r(i){var P=[];var K;if(y(i)){i=F(i);}K=G(i);K.property.forEach(function(L){P.push(L.name);});return P;}function u(K){var i;if(b.hasItem(K)===true){return b.getItem(K);}var L;var P=[];var M=[];var N=F(K);if(N&&z(N)){var Q=G(N);Q.property.forEach(function(S){P.push(S.name);});}var R=q(K,false);for(i=0;i<R.length;i++){M.push(R[i].name);}L=P.concat(M);b.setItem(K,L);return L;}function v(i){return e.getItem(i);}function w(i){var K;if(G(i)){K=i;}else{K=v(i);K=K||v(i+"Results");}return K;}function x(i){if(o.hasItem(i)===false){var R=[];var K=G(i);K.property.forEach(function(L){if(!(L["sap:filterable"]==="false"||L.filterable&&L.filterable==="true")){R.push(L.name);}});o.setItem(i,R);}return o.getItem(i);}function y(i){return B(i)==="parameters";}function z(i){return B(i)==="aggregate";}function B(i){if(!f.hasItem(i)){var K=G(i);var L=K&&K["sap:semantics"]||"undefined";f.setItem(i,L);}return f.getItem(i);}function C(i,P){if(h.hasItem(i+P)===false){var K=y(i);var L=G(i);var M=m.getODataProperty(L,P);if(!M&&K){var N=F(i);L=G(N);M=m.getODataProperty(L,P);}h.setItem(i+P,p(M));}return h.getItem(i+P);}function F(i){var R=j.getItem(i);if(R){return v(R.toAggregateEntitySet);}return i;}function G(i){if(!i){return undefined;}if(!l.hasItem(i)){var K=m.getODataEntityType(E+i);if(!K){return K;}l.setItem(i,K);}return l.getItem(i);}function J(){n=P();var M;if(!n.getServiceMetadata()){M="5018";if(D){M="11013";}I.instances.messageHandler.putMessage(I.instances.messageHandler.createMessageObject({code:M,aParameters:[a],oCallingObject:t}));t.failed=true;return;}m=n.getMetaModel();i();K();L(n);N();function i(){var Q={};var R=m.getODataEntityContainer()&&m.getODataEntityContainer().entitySet;if(!R){I.instances.messageHandler.putMessage(I.instances.messageHandler.createMessageObject({code:"5041",aParameters:[a],oCallingObject:t}));return;}R.forEach(function(R){var S=R.entityType.split(/[. ]+/).pop();e.setItem(R.name,S);if(!Q.hasOwnProperty(S)){Q[S]=true;A.push(S);}});}function K(){var Q=m.getODataEntityContainer()&&m.getODataEntityContainer().entitySet;if(!Q){return;}var S=Q[0].entityType.split(".");S.pop();E=S.join(".")+".";}function L(Q){var R=Q&&Q.getServiceAnnotations();if(R&&R.aliasDefinitions&&R.aliasDefinitions.Capabilities){s=R.aliasDefinitions.Capabilities+".";}}function N(){var Q=m.getODataEntityContainer();if(!Q||!Q.associationSet){return;}Q.associationSet.forEach(function(R){var S=R.end[0].entitySet,T=R.end[1].entitySet,U,V;if(y(v(S))){U=S;}else if(z(v(S))){V=S;}if(y(v(T))){U=T;}else if(z(v(T))){V=T;}if(!U||!V){return;}var W;var X=G(v(U));var Y;X.navigationProperty.forEach(function($){if(!Y&&$.relationship===R.association){W=$.name;Y=true;}});if(!W){return;}var Z={navigationProperty:W,fromParameterEntitySet:U,toAggregateEntitySet:V,fromIsUnique:undefined,toIsUnique:undefined};if(g.hasItem(U)){Z.fromIsUnique=false;g.getItem(U).fromIsUnique=false;}else{Z.fromIsUnique=true;g.setItem(U,Z);j.setItem(v(U),Z);}if(k.hasItem(V)){k.getItem(V).toIsUnique=false;}else{Z.toIsUnique=true;k.setItem(V,Z);}});}function P(){var Q=I.instances.annotationHandler.getAnnotationsForService(a);var R={loadMetadataAsync:false,annotationURI:Q,json:true};return new O(a,R);}}this.getEntityTypes=function(){return A;};this.getPropertyMetadata=function(i,P){I.instances.messageHandler.check(i!==undefined&&typeof i==="string","sap.apf.core.Metadata:getPropertyMetadata incorrect EntityType name or type");I.instances.messageHandler.check(P!==undefined&&typeof P==="string","sap.apf.core.Metadata:getPropertyMetadata incorrect sPropertyName name or type");var K=w(i);if(!K){return{};}return C(K,P);};this.getUriComponents=function(i){if(!v(i)){if(v(i+"Results")){return{entitySet:i+"Results",navigationProperty:""};}return null;}var R;switch(B(v(i))){case"undefined":return{entitySet:i,navigationProperty:""};case"parameters":R=g.getItem(i);if(!R||R.fromIsUnique===false){return{entitySet:i,navigationProperty:undefined};}return{entitySet:i,navigationProperty:R.navigationProperty};case"aggregate":R=k.getItem(i);if(!R){return{entitySet:i,navigationProperty:""};}if(R.toIsUnique===false){return{entitySet:undefined,navigationProperty:undefined};}return{entitySet:R.fromParameterEntitySet,navigationProperty:R.navigationProperty};default:I.instances.messageHandler.check(false,"metadata : getUriComponents - not handled return value for sap semantics");}};this.getFilterableProperties=function(i){I.instances.messageHandler.check(i!==undefined&&typeof i==="string","sap.apf.core.Metadata:getFilterableProperties incorrect EntityType name or type");var K=w(i);if(!K){return[];}K=F(K);return x(K);};this.getAllPropertiesOfEntitySet=function(i){I.instances.messageHandler.check(i!==undefined&&typeof i==="string","sap.apf.core.Metadata:getAllPropertiesOfEntitySet incorrect EntitySet name or type");var K=w(i);return r(K);};this.getAllProperties=function(){var i=[];var K;this.getEntityTypes().forEach(function(L){K=u(L);if(K.length===0){K=r(L);}i=i.concat(K);});i=sap.apf.utils.eliminateDuplicatesInArray(I.instances.messageHandler,i);return i;};this.getFilterablePropertiesAndParameters=function(){var i=[];var K;var L=this.getEntityTypes();L.forEach(function(M){var N=G(M);N.property.forEach(function(P){if(!(P["sap:filterable"]==="false")&&(P["sap:aggregation-role"]==="dimension")){i.push(P.name);}});K=q(M,false);K.forEach(function(P){i.push(P.name);});});return sap.apf.utils.eliminateDuplicatesInArray(I.instances.messageHandler,i);};this.getParameterEntitySetKeyPropertiesForService=function(){var i=[];this.getEntityTypes().forEach(function(K){q(K,true).forEach(function(L){i.push(L.name);});});i=sap.apf.utils.eliminateDuplicatesInArray(I.instances.messageHandler,i);return i;};this.getAllKeys=function(){var i=[];var K=[];this.getEntityTypes().forEach(function(L){var M=G(L);K=[];if(M.key&&M.key.propertyRef){M.key.propertyRef.forEach(function(N){K.push(N.name);});}i=i.concat(K);});i=sap.apf.utils.eliminateDuplicatesInArray(I.instances.messageHandler,i);return i;};this.getAttributes=function(P){var i=false;var K={};this.getEntityTypes().forEach(function(L){if(!i){K=C(L,P);if(K.name){i=true;}}});return K;};this.getParameterEntitySetKeyProperties=function(i){I.instances.messageHandler.check(i!==undefined&&typeof i==="string","sap.apf.core.Metadata:getParameterEntitySetKeyProperties incorrect EntityType name or type");var K=w(i);if(!K){return[];}return q(K,true);};this.getEntityTypeAnnotations=function(i){var K=w(i);I.instances.messageHandler.check(i!==undefined&&typeof i==="string","sap.apf.core.Metadata:getEntityTypeAnnotations incorrect EntityType name or type");if(d.hasItem(K)===true){return d.getItem(K);}var L={};N(K,L);var M=F(K);if(M!==K){N(M,L);}d.setItem(K,L);return d.getItem(K);function N(K,P){var Q;var R;var S;var T=G(K);for(Q in T){if(T.hasOwnProperty(Q)){if(Q.indexOf(s)!==0){continue;}R=Q.split(".").pop();R=R.replace(/^./,R[0].toLowerCase());for(S in T[Q]){if(T[Q].hasOwnProperty(S)){P[R]=T[Q][S];}}}}}};this.getEntitySets=function(){var i={};var K=[];var L=m.getODataEntityContainer();if(!L){return[];}if(L.associationSet){L.associationSet.forEach(function(M){var N,P,Q;N=w(M.end[0].entitySet);if(!y(N)){return;}Q=M.end[1].entitySet;P=w(Q);if(!y(P)){i[Q]=true;}});}if(L.entitySet){L.entitySet.forEach(function(M){if(!i[M.name]){K.push(M.name);}});}return K;};this.getODataModel=function(){return n;};J();};}());
