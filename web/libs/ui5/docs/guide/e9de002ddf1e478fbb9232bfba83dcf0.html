<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="abstract" content="In this step, we see how the Table that is bound to the People entity set initially requests its data, and how the data can be refreshed. We use the Console tab in the browser developer tools to monitor the communication between the browser and the server. We see the initial request as well as the requests for refreshing the data."/>
<meta name="description" content="In this step, we see how the Table that is bound to the People entity set initially requests its data, and how the data can be refreshed. We use the Console tab in the browser developer tools to monitor the communication between the browser and the server. We see the initial request as well as the requests for refreshing the data."/>

<link rel="stylesheet" type="text/css" href="css/prettify.css?x=7790389412384169"/>
<link rel="stylesheet" type="text/css" href="css/documentation.css?x=7790389412384169"/>
<title>Step 2: Data Access and Client-Server Communication</title>
  <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/themes/base/highlight-query-terms.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/sap/ui/demokit/js/google-code-prettify/prettify.css" />
    <script src="../../resources/sap/ui/demokit/js/sdk-pagehelper.js"></script>
  </head>
<body class="" id="loioe9de002ddf1e478fbb9232bfba83dcf0">
<div id="wrapper"><div id="container">

	<h1 class="title topictitle1">Step 2: Data Access and Client-Server Communication</h1>

	
	<div class="body conbody"><p class="shortdesc">In this step, we see how the <samp class="ph codeph">Table</samp> that is bound to the
			<samp class="ph codeph">People</samp> entity set initially requests its data, and how the data can be
		refreshed. We use the <span class="ph uicontrol">Console</span> tab in the browser developer tools to
		monitor the communication between the browser and the server. We see the initial request as
		well as the requests for refreshing the data.</p>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_bt4_fxc_z1b"><div class="section_title">Preview</div><div type="Preview">
			
			<div class="fig fignone" id="loioe9de002ddf1e478fbb9232bfba83dcf0__fig_blw_dkb_mcb"><div class="figcontainer">
				
				<img class="image" id="loioe9de002ddf1e478fbb9232bfba83dcf0__image_cxt_1kb_mcb" src="loio0abcbb65bba54780948b00c20ce53690_LowRes.png"/>
			<div class="figcap">App with a toolbar that contains a <span class="ph uicontrol">Refresh</span>
					button</div></div></div>

		</div></div>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_tsr_gxc_z1b"><div class="section_title">Coding</div><div type="Coding">
			
			<p class="p">You can view and download all files <span class="ph">at <a class="xref" target="_blank" href="../../explored.html#/sample/sap.ui.core.tutorial.odatav4.02/preview" alt="../../explored.html#/sample/sap.ui.core.tutorial.odatav4.02/preview" title="../../explored.html#/sample/sap.ui.core.tutorial.odatav4.02/preview">OData V4 - Step 2</a></span>.</p>

		</div></div>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_pvc_fyc_z1b"><div class="section_title">webapp/controller/App.controller.js</div><div type="webapp/controller/App.controller.js">
			
			<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-js">sap.ui.define([
	"sap/ui/core/mvc/Controller",
	<span class="ph emphasis emphasis">"sap/m/MessageToast",
	"sap/m/MessageBox",</span>
	"sap/ui/model/json/JSONModel"
], function (Controller, <span class="ph emphasis emphasis">MessageToast, MessageBox,</span> JSONModel) {
	"use strict";

	return Controller.extend("sap.ui.core.tutorial.odatav4.controller.App", {

		onInit : function () {
			var oJSONData = {
				busy : false
			};
			var oModel = new JSONModel(oJSONData);
			this.getView().setModel(oModel, "appView");
		}<span class="ph emphasis emphasis">,

		onRefresh : function () {
			var oBinding = this.byId("peopleList").getBinding("items");

			if (oBinding.hasPendingChanges()) {
				MessageBox.error(this._getText("refreshNotPossibleMessage"));
				return;
			}
			oBinding.refresh();
			MessageToast.show(this._getText("refreshSuccessMessage"));
		},

		_getText : function (sTextId, aArgs) {
			return this.getOwnerComponent().getModel("i18n").getResourceBundle().getText(sTextId, aArgs);

		}</span>
	});
});</pre></div>

			<div class="p">We add the event handler <samp class="ph codeph">onRefresh</samp> to the controller. In this method, we
				retrieve the current data binding of the table. If the binding has unsaved changes,
				we display an error message, otherwise we call <samp class="ph codeph">refresh()</samp> and
				display a success message.<div class="note note"><span class="notetitle">Note</span> At this stage, our app cannot have unsaved changes.
					We will change this in Step 6.</div>
 We also add the private method
					<samp class="ph codeph">_getText</samp> to retrieve translatable texts from the resource
				bundle (<span class="ph filepath">i18n</span> model).</div>

		</div></div>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_pp2_mxc_z1b"><div class="section_title">webapp/view/App.view.xml</div><div type="webapp/view/App.view.xml">
			
			<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint lang-xml">...
&lt;Page title="{i18n&gt;peoplePageTitle}"&gt;
	&lt;content&gt;
		&lt;Table
			id="peopleList"
			growing="true"
			growingThreshold="10"
			items="{
				path: '/People'
			}"&gt;
<span class="ph emphasis emphasis">			&lt;headerToolbar&gt;
				&lt;OverflowToolbar&gt;
					&lt;content&gt;
						&lt;ToolbarSpacer/&gt;
						&lt;Button
								id="refreshUsersButton"
								icon="sap-icon://refresh"
								tooltip="{i18n&gt;refreshButtonText}"
								press="onRefresh"/&gt;
					&lt;/content&gt;
				&lt;/OverflowToolbar&gt;
			&lt;/headerToolbar&gt;</span>
			&lt;columns&gt;
...</pre></div>

			<p class="p">We add the <samp class="ph codeph">headerToolbar</samp> with a single <samp class="ph codeph">Button</samp> to
				the <samp class="ph codeph">Table</samp>. The button has a <samp class="ph codeph">press</samp> event to which
				we attach an event handler called <samp class="ph codeph">onRefresh</samp>.</p>

		</div></div>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_etg_fyc_z1b"><div class="section_title">webapp/i18n/i18n.properties</div><div type="webapp/i18n/i18n.properties">
			
			<div class="div_pre_codeblock"><pre class="pre codeblock prettyprint"># App Descriptor
...

<span class="ph emphasis emphasis"># Toolbar
#XTOL: Tooltip for refresh data
refreshButtonText=Refresh Data</span>

# Table Area
...

<span class="ph emphasis emphasis"># Messages
#XMSG: Message for refresh failed
refreshFailedMessage=Before refreshing, please save or revert your changes

#XMSG: Message for refresh succeeded
refreshSuccessMessage=Data refreshed</span></pre></div>

			<p class="p">We add the tooltip and message texts to the <span class="ph filepath">properties</span> file.</p>

		</div></div>

		<div class="section" id="loioe9de002ddf1e478fbb9232bfba83dcf0__section_kk1_cq1_mcb"><div class="section_title">Under the Hood</div><div type="Under the Hood">
			
			<p class="p">To get more insight into the client-server communication, we open the
					<span class="ph uicontrol">Console</span> tab of the browser developer tools and then
				reload the app.</p>

			<div class="note note"><span class="notetitle">Note</span> 
				<p class="p">To monitor the client-server communication in a productive app, you would use the
						<span class="ph uicontrol">Network</span> tab of the developer tools.</p>

				<p class="p">In this tutorial, we are using a mock server instead of a real OData service so that we can
					execute the code in every environment. The mock server does not generate any
					network traffic, so we use the <span class="ph uicontrol">Console</span> tab to monitor the
					communication.</p>

				<div class="p">If you want to switch to the real service, do the following:<ol class="ol" id="loioe9de002ddf1e478fbb9232bfba83dcf0__ol_d3p_35s_qcb">
						<li class="li">
							<p class="p">In the <span class="ph filepath">index.html</span> file, remove the line
									<samp class="ph codeph">"mockserver.start();"</samp>.</p>

						</li>

						<li class="li">
							<p class="p">Check the URI of the default data source in the
									<span class="ph filepath">manifest.json</span> file. Depending on the
								environment, change it to something that avoids cross-origin
								resource sharing (CORS) problems. For more information, see <a class="xref" href="5bb388fc289d44dca886c8fa25da466e.html">Request Fails Due to Same-Origin Policy (Cross-Origin Resource Sharing (CORS))</a></p>

						</li>

					</ol>
</div>

			</div>

			<p class="p">We search for the following mock server requests:</p>

			<ul class="ul" id="loioe9de002ddf1e478fbb9232bfba83dcf0__ul_asf_23w_mcb">
				<li class="li">
					<p class="p"><a class="extlink" href="http://help.sap.com/disclaimer?site=http%3A%2F%2Fservices.odata.org%2FTripPinRESTierService%2F%28S%28id%29%29%2F%24metadata" alt="http://services.odata.org/TripPinRESTierService/(S(id))/$metadata" title="http://services.odata.org/TripPinRESTierService/(S(id))/$metadata">http://services.odata.org/TripPinRESTierService/(S(id))/$metadata<img src="images/3rd_link.png" class="link-external" alt="Information published on non-SAP site" title="Information published on non-SAP site" border="0"/></a></p>

					<p class="p">This first request fetches the metadata that describes the entities of the service (see also
							<a class="extlink" href="http://help.sap.com/disclaimer?site=http%3A%2F%2Fdocs.oasis-open.org%2Fodata%2Fodata%2Fv4.0%2Fodata-v4.0-part3-csdl.html" alt="http://docs.oasis-open.org/odata/odata/v4.0/odata-v4.0-part3-csdl.html" title="http://docs.oasis-open.org/odata/odata/v4.0/odata-v4.0-part3-csdl.html">OData Version 4.0. Part 3: Common Schema Definition
							Language (CSDL) Plus Errata 03<img src="images/3rd_link.png" class="link-external" alt="Information published on non-SAP site" title="Information published on non-SAP site" border="0"/></a>).</p>

					<p class="p">The server responds with an XML file that describes the entities, for
						example, entity type <samp class="ph codeph">"Person"</samp> has several properties such
						as <samp class="ph codeph">UserName</samp>, <samp class="ph codeph">FirstName</samp>,
							<samp class="ph codeph">LastName</samp>, and <samp class="ph codeph">Age</samp>.</p>

					<div class="note note"><span class="notetitle">Note</span> 
						<p class="p">The URL contains the session ID <samp class="ph codeph">(S(id))</samp>. Since the
							public <span class="ph uicontrol">TripPin</span> service can be used by multiple
							persons at the same time, the session ID separates read and write
							requests from different sources. You could use a different ID or request
							the service without a specified session ID. In the latter case, you will
							get a response with a new, random session ID.</p>

					</div>

				</li>

				<li class="li">
					<p class="p"><a class="extlink" href="http://help.sap.com/disclaimer?site=http%3A%2F%2Fservices.odata.org%2FTripPinRESTierService%2F%28S%28id%29%29%2FPeople%3F%24select%3DAge%2CFirstName%2CLastName%2CUserName%26%24skip%3D0%26%24top%3D10" alt="http://services.odata.org/TripPinRESTierService/(S(id))/People?$select=Age,FirstName,LastName,UserName&amp;$skip=0&amp;$top=10" title="http://services.odata.org/TripPinRESTierService/(S(id))/People?$select=Age,FirstName,LastName,UserName&amp;$skip=0&amp;$top=10">http://services.odata.org/TripPinRESTierService/(S(id))/People?$select=Age,FirstName,LastName,UserName&amp;$skip=0&amp;$top=10<img src="images/3rd_link.png" class="link-external" alt="Information published on non-SAP site" title="Information published on non-SAP site" border="0"/></a>. </p>

					<p class="p">The second request fetches the first 10 entities from the OData service. The
							<samp class="ph codeph">growingThreshold="10"</samp> setting in the implementation of
						the <samp class="ph codeph">Table</samp> control in the <span class="ph filepath">App.view.xml</span>
						file defines that only 10 entities are fetched at the same time from the
							<samp class="ph codeph">'/people'</samp> path. Further data is only loaded when
						requested from the user interface (<samp class="ph codeph">growing="true"</samp>).
						Therefore, there are only 10 entities requested at the same time by using
							<samp class="ph codeph">$skip=0&amp;$top=10</samp> (see <a class="extlink" href="http://help.sap.com/disclaimer?site=http%3A%2F%2Fwww.odata.org%2Fgetting-started%2Fbasic-tutorial%2F%23topskip" alt="http://www.odata.org/getting-started/basic-tutorial/#topskip" title="http://www.odata.org/getting-started/basic-tutorial/#topskip">System Query Option $top and $skip<img src="images/3rd_link.png" class="link-external" alt="Information published on non-SAP site" title="Information published on non-SAP site" border="0"/></a> in the Basic
						Tutorial on the OData home page.)</p>

					<p class="p">This request explicitly lists the fields that should be included in the
						response by using the <samp class="ph codeph">$select</samp> query option. Although the
							<span class="ph uicontrol">TripPin</span> service has more fields in its
							<samp class="ph codeph">People</samp> entity set, only those four are included in the
						response. This is a feature of the OData V4 Model called "automatic
						determination of <samp class="ph codeph">$select</samp>", or
							"auto-<samp class="ph codeph">$select</samp>". It helps restricting the size of
						responses to what is really needed. The <samp class="ph codeph">ODataModel</samp> computes
						the required fields from binding paths specified for controls. This feature
						is not active by default. In our case, this is activated by setting the
							<samp class="ph codeph">autoExpandSelect</samp> property to <samp class="ph codeph">true</samp> when
						instantiating the model in the <span class="ph filepath">manifest.json</span> descriptor
						file .</p>

				</li>

			</ul>

		</div></div>

	</div>

	<div class="related-links"> 

<div class="familylinks">
<div class="parentlink"><br/>
<strong>Parent topic: </strong><a class="link" href="bcdbde6911bd4fc68fd435cf8e306ed0.html" title="In this tutorial, we explore how features of OData V4 can be used in OpenUI5. We write a small app that consumes data from an OData V4 service to understand how to access, modify, aggregate, and filter data in an OData V4 model.">OData V4</a><br/>
</div>
<div class="previouslink"><br/>
<strong>Previous: </strong><a class="link" href="15d84f36c0594cb2b3295aa1f55cb961.html" title="We start by setting up a simple app that loads data from an OData service and displays it in a table. We use a mock server to simulate requests to and responses from the service.">Step 1: The Initial App</a><br/>
</div>
<div class="nextlink"><br/>
<strong>Next: </strong><a class="link" href="96bb6e06fa22491fa65a5040f6da099c.html" title="In this step, we use the automatic data type detection of the OData V4 model to parse, validate, and format user entries. The service metadata contains type information for the properties of each entity.">Step 3: Automatic Data Type Detection</a><br/>
</div>
</div>
<div class="relinfo"><div class="relinfotitle ">Related Information</div>
<div><a class="link" href="54e0ddf695af4a6c978472cecb01c64d.html" title="Bindings connect OpenUI5 view elements to model data, allowing changes in the model to be reflected in the view element and vice versa.">Bindings</a></div>
<div><a class="link" href="../../docs/api/symbols/sap.ui.model.odata.v4.ODataMetaModel.html" alt="../../docs/api/symbols/sap.ui.model.odata.v4.ODataMetaModel.html" title="../../docs/api/symbols/sap.ui.model.odata.v4.ODataMetaModel.html">API Reference:
				<samp class="ph codeph">sap.ui.model.odata.v4.ODataMetaModel</samp></a></div>
<div><a class="link" href="https://ui5.sap.com/#/api/sap.ui.model.odata.v4.ODataListBinding/methods/refresh" alt="https://ui5.sap.com/#/api/sap.ui.model.odata.v4.ODataListBinding/methods/refresh" title="https://ui5.sap.com/#/api/sap.ui.model.odata.v4.ODataListBinding/methods/refresh">API Reference:
				<samp class="ph codeph">sap.ui.model.odata.v4.ODataListBinding.refresh</samp></a></div>
<div><a class="link" href="eadd60ae907646bbb838866566b23182.html" title="In this step, you will learn how to use your browser's developers tools to troubleshoot your OpenUI5 app.">Troubleshooting Tutorial Step 1: Browser Developer Tools</a></div>
</div>
</div>
</div></div>

</body>
</html>